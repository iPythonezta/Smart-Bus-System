function F5(t,i){for(var c=0;c<i.length;c++){const d=i[c];if(typeof d!="string"&&!Array.isArray(d)){for(const y in d)if(y!=="default"&&!(y in t)){const w=Object.getOwnPropertyDescriptor(d,y);w&&Object.defineProperty(t,y,w.get?w:{enumerable:!0,get:()=>d[y]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const w of y)if(w.type==="childList")for(const E of w.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&d(E)}).observe(document,{childList:!0,subtree:!0});function c(y){const w={};return y.integrity&&(w.integrity=y.integrity),y.referrerPolicy&&(w.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?w.credentials="include":y.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(y){if(y.ep)return;y.ep=!0;const w=c(y);fetch(y.href,w)}})();function GE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var PT={exports:{}},e0={};var fI;function B5(){if(fI)return e0;fI=1;var t=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function c(d,y,w){var E=null;if(w!==void 0&&(E=""+w),y.key!==void 0&&(E=""+y.key),"key"in y){w={};for(var s in y)s!=="key"&&(w[s]=y[s])}else w=y;return y=w.ref,{$$typeof:t,type:d,key:E,ref:y!==void 0?y:null,props:w}}return e0.Fragment=i,e0.jsx=c,e0.jsxs=c,e0}var pI;function V5(){return pI||(pI=1,PT.exports=B5()),PT.exports}var C=V5(),OT={exports:{}},xr={};var mI;function U5(){if(mI)return xr;mI=1;var t=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),E=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),z=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),H=Symbol.for("react.activity"),Y=Symbol.iterator;function ie(Me){return Me===null||typeof Me!="object"?null:(Me=Y&&Me[Y]||Me["@@iterator"],typeof Me=="function"?Me:null)}var oe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ee=Object.assign,le={};function ge(Me,ct,vt){this.props=Me,this.context=ct,this.refs=le,this.updater=vt||oe}ge.prototype.isReactComponent={},ge.prototype.setState=function(Me,ct){if(typeof Me!="object"&&typeof Me!="function"&&Me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Me,ct,"setState")},ge.prototype.forceUpdate=function(Me){this.updater.enqueueForceUpdate(this,Me,"forceUpdate")};function pe(){}pe.prototype=ge.prototype;function _e(Me,ct,vt){this.props=Me,this.context=ct,this.refs=le,this.updater=vt||oe}var Re=_e.prototype=new pe;Re.constructor=_e,ee(Re,ge.prototype),Re.isPureReactComponent=!0;var xe=Array.isArray;function Ze(){}var Le={H:null,A:null,T:null,S:null},$e=Object.prototype.hasOwnProperty;function st(Me,ct,vt){var Kt=vt.ref;return{$$typeof:t,type:Me,key:ct,ref:Kt!==void 0?Kt:null,props:vt}}function Et(Me,ct){return st(Me.type,ct,Me.props)}function Ut(Me){return typeof Me=="object"&&Me!==null&&Me.$$typeof===t}function $t(Me){var ct={"=":"=0",":":"=2"};return"$"+Me.replace(/[=:]/g,function(vt){return ct[vt]})}var tt=/\/+/g;function ut(Me,ct){return typeof Me=="object"&&Me!==null&&Me.key!=null?$t(""+Me.key):ct.toString(36)}function on(Me){switch(Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason;default:switch(typeof Me.status=="string"?Me.then(Ze,Ze):(Me.status="pending",Me.then(function(ct){Me.status==="pending"&&(Me.status="fulfilled",Me.value=ct)},function(ct){Me.status==="pending"&&(Me.status="rejected",Me.reason=ct)})),Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason}}throw Me}function Ke(Me,ct,vt,Kt,zn){var Nn=typeof Me;(Nn==="undefined"||Nn==="boolean")&&(Me=null);var Yt=!1;if(Me===null)Yt=!0;else switch(Nn){case"bigint":case"string":case"number":Yt=!0;break;case"object":switch(Me.$$typeof){case t:case i:Yt=!0;break;case j:return Yt=Me._init,Ke(Yt(Me._payload),ct,vt,Kt,zn)}}if(Yt)return zn=zn(Me),Yt=Kt===""?"."+ut(Me,0):Kt,xe(zn)?(vt="",Yt!=null&&(vt=Yt.replace(tt,"$&/")+"/"),Ke(zn,ct,vt,"",function(In){return In})):zn!=null&&(Ut(zn)&&(zn=Et(zn,vt+(zn.key==null||Me&&Me.key===zn.key?"":(""+zn.key).replace(tt,"$&/")+"/")+Yt)),ct.push(zn)),1;Yt=0;var On=Kt===""?".":Kt+":";if(xe(Me))for(var An=0;An<Me.length;An++)Kt=Me[An],Nn=On+ut(Kt,An),Yt+=Ke(Kt,ct,vt,Nn,zn);else if(An=ie(Me),typeof An=="function")for(Me=An.call(Me),An=0;!(Kt=Me.next()).done;)Kt=Kt.value,Nn=On+ut(Kt,An++),Yt+=Ke(Kt,ct,vt,Nn,zn);else if(Nn==="object"){if(typeof Me.then=="function")return Ke(on(Me),ct,vt,Kt,zn);throw ct=String(Me),Error("Objects are not valid as a React child (found: "+(ct==="[object Object]"?"object with keys {"+Object.keys(Me).join(", ")+"}":ct)+"). If you meant to render a collection of children, use an array instead.")}return Yt}function ze(Me,ct,vt){if(Me==null)return Me;var Kt=[],zn=0;return Ke(Me,Kt,"","",function(Nn){return ct.call(vt,Nn,zn++)}),Kt}function Fe(Me){if(Me._status===-1){var ct=Me._result;ct=ct(),ct.then(function(vt){(Me._status===0||Me._status===-1)&&(Me._status=1,Me._result=vt)},function(vt){(Me._status===0||Me._status===-1)&&(Me._status=2,Me._result=vt)}),Me._status===-1&&(Me._status=0,Me._result=ct)}if(Me._status===1)return Me._result.default;throw Me._result}var kt=typeof reportError=="function"?reportError:function(Me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ct=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Me=="object"&&Me!==null&&typeof Me.message=="string"?String(Me.message):String(Me),error:Me});if(!window.dispatchEvent(ct))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Me);return}console.error(Me)},fn={map:ze,forEach:function(Me,ct,vt){ze(Me,function(){ct.apply(this,arguments)},vt)},count:function(Me){var ct=0;return ze(Me,function(){ct++}),ct},toArray:function(Me){return ze(Me,function(ct){return ct})||[]},only:function(Me){if(!Ut(Me))throw Error("React.Children.only expected to receive a single React element child.");return Me}};return xr.Activity=H,xr.Children=fn,xr.Component=ge,xr.Fragment=c,xr.Profiler=y,xr.PureComponent=_e,xr.StrictMode=d,xr.Suspense=O,xr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Le,xr.__COMPILER_RUNTIME={__proto__:null,c:function(Me){return Le.H.useMemoCache(Me)}},xr.cache=function(Me){return function(){return Me.apply(null,arguments)}},xr.cacheSignal=function(){return null},xr.cloneElement=function(Me,ct,vt){if(Me==null)throw Error("The argument must be a React element, but you passed "+Me+".");var Kt=ee({},Me.props),zn=Me.key;if(ct!=null)for(Nn in ct.key!==void 0&&(zn=""+ct.key),ct)!$e.call(ct,Nn)||Nn==="key"||Nn==="__self"||Nn==="__source"||Nn==="ref"&&ct.ref===void 0||(Kt[Nn]=ct[Nn]);var Nn=arguments.length-2;if(Nn===1)Kt.children=vt;else if(1<Nn){for(var Yt=Array(Nn),On=0;On<Nn;On++)Yt[On]=arguments[On+2];Kt.children=Yt}return st(Me.type,zn,Kt)},xr.createContext=function(Me){return Me={$$typeof:E,_currentValue:Me,_currentValue2:Me,_threadCount:0,Provider:null,Consumer:null},Me.Provider=Me,Me.Consumer={$$typeof:w,_context:Me},Me},xr.createElement=function(Me,ct,vt){var Kt,zn={},Nn=null;if(ct!=null)for(Kt in ct.key!==void 0&&(Nn=""+ct.key),ct)$e.call(ct,Kt)&&Kt!=="key"&&Kt!=="__self"&&Kt!=="__source"&&(zn[Kt]=ct[Kt]);var Yt=arguments.length-2;if(Yt===1)zn.children=vt;else if(1<Yt){for(var On=Array(Yt),An=0;An<Yt;An++)On[An]=arguments[An+2];zn.children=On}if(Me&&Me.defaultProps)for(Kt in Yt=Me.defaultProps,Yt)zn[Kt]===void 0&&(zn[Kt]=Yt[Kt]);return st(Me,Nn,zn)},xr.createRef=function(){return{current:null}},xr.forwardRef=function(Me){return{$$typeof:s,render:Me}},xr.isValidElement=Ut,xr.lazy=function(Me){return{$$typeof:j,_payload:{_status:-1,_result:Me},_init:Fe}},xr.memo=function(Me,ct){return{$$typeof:z,type:Me,compare:ct===void 0?null:ct}},xr.startTransition=function(Me){var ct=Le.T,vt={};Le.T=vt;try{var Kt=Me(),zn=Le.S;zn!==null&&zn(vt,Kt),typeof Kt=="object"&&Kt!==null&&typeof Kt.then=="function"&&Kt.then(Ze,kt)}catch(Nn){kt(Nn)}finally{ct!==null&&vt.types!==null&&(ct.types=vt.types),Le.T=ct}},xr.unstable_useCacheRefresh=function(){return Le.H.useCacheRefresh()},xr.use=function(Me){return Le.H.use(Me)},xr.useActionState=function(Me,ct,vt){return Le.H.useActionState(Me,ct,vt)},xr.useCallback=function(Me,ct){return Le.H.useCallback(Me,ct)},xr.useContext=function(Me){return Le.H.useContext(Me)},xr.useDebugValue=function(){},xr.useDeferredValue=function(Me,ct){return Le.H.useDeferredValue(Me,ct)},xr.useEffect=function(Me,ct){return Le.H.useEffect(Me,ct)},xr.useEffectEvent=function(Me){return Le.H.useEffectEvent(Me)},xr.useId=function(){return Le.H.useId()},xr.useImperativeHandle=function(Me,ct,vt){return Le.H.useImperativeHandle(Me,ct,vt)},xr.useInsertionEffect=function(Me,ct){return Le.H.useInsertionEffect(Me,ct)},xr.useLayoutEffect=function(Me,ct){return Le.H.useLayoutEffect(Me,ct)},xr.useMemo=function(Me,ct){return Le.H.useMemo(Me,ct)},xr.useOptimistic=function(Me,ct){return Le.H.useOptimistic(Me,ct)},xr.useReducer=function(Me,ct,vt){return Le.H.useReducer(Me,ct,vt)},xr.useRef=function(Me){return Le.H.useRef(Me)},xr.useState=function(Me){return Le.H.useState(Me)},xr.useSyncExternalStore=function(Me,ct,vt){return Le.H.useSyncExternalStore(Me,ct,vt)},xr.useTransition=function(){return Le.H.useTransition()},xr.version="19.2.0",xr}var gI;function Uw(){return gI||(gI=1,OT.exports=U5()),OT.exports}var Z=Uw();const vr=GE(Z),HE=F5({__proto__:null,default:vr},[Z]);var zT={exports:{}},t0={},LT={exports:{}},NT={};var _I;function $5(){return _I||(_I=1,(function(t){function i(Ke,ze){var Fe=Ke.length;Ke.push(ze);e:for(;0<Fe;){var kt=Fe-1>>>1,fn=Ke[kt];if(0<y(fn,ze))Ke[kt]=ze,Ke[Fe]=fn,Fe=kt;else break e}}function c(Ke){return Ke.length===0?null:Ke[0]}function d(Ke){if(Ke.length===0)return null;var ze=Ke[0],Fe=Ke.pop();if(Fe!==ze){Ke[0]=Fe;e:for(var kt=0,fn=Ke.length,Me=fn>>>1;kt<Me;){var ct=2*(kt+1)-1,vt=Ke[ct],Kt=ct+1,zn=Ke[Kt];if(0>y(vt,Fe))Kt<fn&&0>y(zn,vt)?(Ke[kt]=zn,Ke[Kt]=Fe,kt=Kt):(Ke[kt]=vt,Ke[ct]=Fe,kt=ct);else if(Kt<fn&&0>y(zn,Fe))Ke[kt]=zn,Ke[Kt]=Fe,kt=Kt;else break e}}return ze}function y(Ke,ze){var Fe=Ke.sortIndex-ze.sortIndex;return Fe!==0?Fe:Ke.id-ze.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;t.unstable_now=function(){return w.now()}}else{var E=Date,s=E.now();t.unstable_now=function(){return E.now()-s}}var O=[],z=[],j=1,H=null,Y=3,ie=!1,oe=!1,ee=!1,le=!1,ge=typeof setTimeout=="function"?setTimeout:null,pe=typeof clearTimeout=="function"?clearTimeout:null,_e=typeof setImmediate<"u"?setImmediate:null;function Re(Ke){for(var ze=c(z);ze!==null;){if(ze.callback===null)d(z);else if(ze.startTime<=Ke)d(z),ze.sortIndex=ze.expirationTime,i(O,ze);else break;ze=c(z)}}function xe(Ke){if(ee=!1,Re(Ke),!oe)if(c(O)!==null)oe=!0,Ze||(Ze=!0,$t());else{var ze=c(z);ze!==null&&on(xe,ze.startTime-Ke)}}var Ze=!1,Le=-1,$e=5,st=-1;function Et(){return le?!0:!(t.unstable_now()-st<$e)}function Ut(){if(le=!1,Ze){var Ke=t.unstable_now();st=Ke;var ze=!0;try{e:{oe=!1,ee&&(ee=!1,pe(Le),Le=-1),ie=!0;var Fe=Y;try{t:{for(Re(Ke),H=c(O);H!==null&&!(H.expirationTime>Ke&&Et());){var kt=H.callback;if(typeof kt=="function"){H.callback=null,Y=H.priorityLevel;var fn=kt(H.expirationTime<=Ke);if(Ke=t.unstable_now(),typeof fn=="function"){H.callback=fn,Re(Ke),ze=!0;break t}H===c(O)&&d(O),Re(Ke)}else d(O);H=c(O)}if(H!==null)ze=!0;else{var Me=c(z);Me!==null&&on(xe,Me.startTime-Ke),ze=!1}}break e}finally{H=null,Y=Fe,ie=!1}ze=void 0}}finally{ze?$t():Ze=!1}}}var $t;if(typeof _e=="function")$t=function(){_e(Ut)};else if(typeof MessageChannel<"u"){var tt=new MessageChannel,ut=tt.port2;tt.port1.onmessage=Ut,$t=function(){ut.postMessage(null)}}else $t=function(){ge(Ut,0)};function on(Ke,ze){Le=ge(function(){Ke(t.unstable_now())},ze)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ke){Ke.callback=null},t.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$e=0<Ke?Math.floor(1e3/Ke):5},t.unstable_getCurrentPriorityLevel=function(){return Y},t.unstable_next=function(Ke){switch(Y){case 1:case 2:case 3:var ze=3;break;default:ze=Y}var Fe=Y;Y=ze;try{return Ke()}finally{Y=Fe}},t.unstable_requestPaint=function(){le=!0},t.unstable_runWithPriority=function(Ke,ze){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Fe=Y;Y=Ke;try{return ze()}finally{Y=Fe}},t.unstable_scheduleCallback=function(Ke,ze,Fe){var kt=t.unstable_now();switch(typeof Fe=="object"&&Fe!==null?(Fe=Fe.delay,Fe=typeof Fe=="number"&&0<Fe?kt+Fe:kt):Fe=kt,Ke){case 1:var fn=-1;break;case 2:fn=250;break;case 5:fn=1073741823;break;case 4:fn=1e4;break;default:fn=5e3}return fn=Fe+fn,Ke={id:j++,callback:ze,priorityLevel:Ke,startTime:Fe,expirationTime:fn,sortIndex:-1},Fe>kt?(Ke.sortIndex=Fe,i(z,Ke),c(O)===null&&Ke===c(z)&&(ee?(pe(Le),Le=-1):ee=!0,on(xe,Fe-kt))):(Ke.sortIndex=fn,i(O,Ke),oe||ie||(oe=!0,Ze||(Ze=!0,$t()))),Ke},t.unstable_shouldYield=Et,t.unstable_wrapCallback=function(Ke){var ze=Y;return function(){var Fe=Y;Y=ze;try{return Ke.apply(this,arguments)}finally{Y=Fe}}}})(NT)),NT}var yI;function G5(){return yI||(yI=1,LT.exports=$5()),LT.exports}var kT={exports:{}},Ml={};var xI;function H5(){if(xI)return Ml;xI=1;var t=Uw();function i(O){var z="https://react.dev/errors/"+O;if(1<arguments.length){z+="?args[]="+encodeURIComponent(arguments[1]);for(var j=2;j<arguments.length;j++)z+="&args[]="+encodeURIComponent(arguments[j])}return"Minified React error #"+O+"; visit "+z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(){}var d={d:{f:c,r:function(){throw Error(i(522))},D:c,C:c,L:c,m:c,X:c,S:c,M:c},p:0,findDOMNode:null},y=Symbol.for("react.portal");function w(O,z,j){var H=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:y,key:H==null?null:""+H,children:O,containerInfo:z,implementation:j}}var E=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(O,z){if(O==="font")return"";if(typeof z=="string")return z==="use-credentials"?z:""}return Ml.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=d,Ml.createPortal=function(O,z){var j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!z||z.nodeType!==1&&z.nodeType!==9&&z.nodeType!==11)throw Error(i(299));return w(O,z,null,j)},Ml.flushSync=function(O){var z=E.T,j=d.p;try{if(E.T=null,d.p=2,O)return O()}finally{E.T=z,d.p=j,d.d.f()}},Ml.preconnect=function(O,z){typeof O=="string"&&(z?(z=z.crossOrigin,z=typeof z=="string"?z==="use-credentials"?z:"":void 0):z=null,d.d.C(O,z))},Ml.prefetchDNS=function(O){typeof O=="string"&&d.d.D(O)},Ml.preinit=function(O,z){if(typeof O=="string"&&z&&typeof z.as=="string"){var j=z.as,H=s(j,z.crossOrigin),Y=typeof z.integrity=="string"?z.integrity:void 0,ie=typeof z.fetchPriority=="string"?z.fetchPriority:void 0;j==="style"?d.d.S(O,typeof z.precedence=="string"?z.precedence:void 0,{crossOrigin:H,integrity:Y,fetchPriority:ie}):j==="script"&&d.d.X(O,{crossOrigin:H,integrity:Y,fetchPriority:ie,nonce:typeof z.nonce=="string"?z.nonce:void 0})}},Ml.preinitModule=function(O,z){if(typeof O=="string")if(typeof z=="object"&&z!==null){if(z.as==null||z.as==="script"){var j=s(z.as,z.crossOrigin);d.d.M(O,{crossOrigin:j,integrity:typeof z.integrity=="string"?z.integrity:void 0,nonce:typeof z.nonce=="string"?z.nonce:void 0})}}else z==null&&d.d.M(O)},Ml.preload=function(O,z){if(typeof O=="string"&&typeof z=="object"&&z!==null&&typeof z.as=="string"){var j=z.as,H=s(j,z.crossOrigin);d.d.L(O,j,{crossOrigin:H,integrity:typeof z.integrity=="string"?z.integrity:void 0,nonce:typeof z.nonce=="string"?z.nonce:void 0,type:typeof z.type=="string"?z.type:void 0,fetchPriority:typeof z.fetchPriority=="string"?z.fetchPriority:void 0,referrerPolicy:typeof z.referrerPolicy=="string"?z.referrerPolicy:void 0,imageSrcSet:typeof z.imageSrcSet=="string"?z.imageSrcSet:void 0,imageSizes:typeof z.imageSizes=="string"?z.imageSizes:void 0,media:typeof z.media=="string"?z.media:void 0})}},Ml.preloadModule=function(O,z){if(typeof O=="string")if(z){var j=s(z.as,z.crossOrigin);d.d.m(O,{as:typeof z.as=="string"&&z.as!=="script"?z.as:void 0,crossOrigin:j,integrity:typeof z.integrity=="string"?z.integrity:void 0})}else d.d.m(O)},Ml.requestFormReset=function(O){d.d.r(O)},Ml.unstable_batchedUpdates=function(O,z){return O(z)},Ml.useFormState=function(O,z,j){return E.H.useFormState(O,z,j)},Ml.useFormStatus=function(){return E.H.useHostTransitionStatus()},Ml.version="19.2.0",Ml}var vI;function Tz(){if(vI)return kT.exports;vI=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(i){console.error(i)}}return t(),kT.exports=H5(),kT.exports}var bI;function q5(){if(bI)return t0;bI=1;var t=G5(),i=Uw(),c=Tz();function d(u){var g="https://react.dev/errors/"+u;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var S=2;S<arguments.length;S++)g+="&args[]="+encodeURIComponent(arguments[S])}return"Minified React error #"+u+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function w(u){var g=u,S=u;if(u.alternate)for(;g.return;)g=g.return;else{u=g;do g=u,(g.flags&4098)!==0&&(S=g.return),u=g.return;while(u)}return g.tag===3?S:null}function E(u){if(u.tag===13){var g=u.memoizedState;if(g===null&&(u=u.alternate,u!==null&&(g=u.memoizedState)),g!==null)return g.dehydrated}return null}function s(u){if(u.tag===31){var g=u.memoizedState;if(g===null&&(u=u.alternate,u!==null&&(g=u.memoizedState)),g!==null)return g.dehydrated}return null}function O(u){if(w(u)!==u)throw Error(d(188))}function z(u){var g=u.alternate;if(!g){if(g=w(u),g===null)throw Error(d(188));return g!==u?null:u}for(var S=u,I=g;;){var B=S.return;if(B===null)break;var q=B.alternate;if(q===null){if(I=B.return,I!==null){S=I;continue}break}if(B.child===q.child){for(q=B.child;q;){if(q===S)return O(B),u;if(q===I)return O(B),g;q=q.sibling}throw Error(d(188))}if(S.return!==I.return)S=B,I=q;else{for(var de=!1,Oe=B.child;Oe;){if(Oe===S){de=!0,S=B,I=q;break}if(Oe===I){de=!0,I=B,S=q;break}Oe=Oe.sibling}if(!de){for(Oe=q.child;Oe;){if(Oe===S){de=!0,S=q,I=B;break}if(Oe===I){de=!0,I=q,S=B;break}Oe=Oe.sibling}if(!de)throw Error(d(189))}}if(S.alternate!==I)throw Error(d(190))}if(S.tag!==3)throw Error(d(188));return S.stateNode.current===S?u:g}function j(u){var g=u.tag;if(g===5||g===26||g===27||g===6)return u;for(u=u.child;u!==null;){if(g=j(u),g!==null)return g;u=u.sibling}return null}var H=Object.assign,Y=Symbol.for("react.element"),ie=Symbol.for("react.transitional.element"),oe=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),ge=Symbol.for("react.profiler"),pe=Symbol.for("react.consumer"),_e=Symbol.for("react.context"),Re=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),Ze=Symbol.for("react.suspense_list"),Le=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),st=Symbol.for("react.activity"),Et=Symbol.for("react.memo_cache_sentinel"),Ut=Symbol.iterator;function $t(u){return u===null||typeof u!="object"?null:(u=Ut&&u[Ut]||u["@@iterator"],typeof u=="function"?u:null)}var tt=Symbol.for("react.client.reference");function ut(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===tt?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case ee:return"Fragment";case ge:return"Profiler";case le:return"StrictMode";case xe:return"Suspense";case Ze:return"SuspenseList";case st:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case oe:return"Portal";case _e:return u.displayName||"Context";case pe:return(u._context.displayName||"Context")+".Consumer";case Re:var g=u.render;return u=u.displayName,u||(u=g.displayName||g.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case Le:return g=u.displayName||null,g!==null?g:ut(u.type)||"Memo";case $e:g=u._payload,u=u._init;try{return ut(u(g))}catch{}}return null}var on=Array.isArray,Ke=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ze=c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Fe={pending:!1,data:null,method:null,action:null},kt=[],fn=-1;function Me(u){return{current:u}}function ct(u){0>fn||(u.current=kt[fn],kt[fn]=null,fn--)}function vt(u,g){fn++,kt[fn]=u.current,u.current=g}var Kt=Me(null),zn=Me(null),Nn=Me(null),Yt=Me(null);function On(u,g){switch(vt(Nn,g),vt(zn,u),vt(Kt,null),g.nodeType){case 9:case 11:u=(u=g.documentElement)&&(u=u.namespaceURI)?uv(u):0;break;default:if(u=g.tagName,g=g.namespaceURI)g=uv(g),u=Dm(g,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}ct(Kt),vt(Kt,u)}function An(){ct(Kt),ct(zn),ct(Nn)}function In(u){u.memoizedState!==null&&vt(Yt,u);var g=Kt.current,S=Dm(g,u.type);g!==S&&(vt(zn,u),vt(Kt,S))}function gi(u){zn.current===u&&(ct(Kt),ct(zn)),Yt.current===u&&(ct(Yt),l_._currentValue=Fe)}var ji,Ri;function Rr(u){if(ji===void 0)try{throw Error()}catch(S){var g=S.stack.trim().match(/\n( *(at )?)/);ji=g&&g[1]||"",Ri=-1<S.stack.indexOf(`
    at`)?" (<anonymous>)":-1<S.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ji+u+Ri}var cs=!1;function wr(u,g){if(!u||cs)return"";cs=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var I={DetermineComponentFrameRoot:function(){try{if(g){var xn=function(){throw Error()};if(Object.defineProperty(xn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xn,[])}catch(tn){var Wt=tn}Reflect.construct(u,[],xn)}else{try{xn.call()}catch(tn){Wt=tn}u.call(xn.prototype)}}else{try{throw Error()}catch(tn){Wt=tn}(xn=u())&&typeof xn.catch=="function"&&xn.catch(function(){})}}catch(tn){if(tn&&Wt&&typeof tn.stack=="string")return[tn.stack,Wt.stack]}return[null,null]}};I.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var B=Object.getOwnPropertyDescriptor(I.DetermineComponentFrameRoot,"name");B&&B.configurable&&Object.defineProperty(I.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=I.DetermineComponentFrameRoot(),de=q[0],Oe=q[1];if(de&&Oe){var ot=de.split(`
`),Gt=Oe.split(`
`);for(B=I=0;I<ot.length&&!ot[I].includes("DetermineComponentFrameRoot");)I++;for(;B<Gt.length&&!Gt[B].includes("DetermineComponentFrameRoot");)B++;if(I===ot.length||B===Gt.length)for(I=ot.length-1,B=Gt.length-1;1<=I&&0<=B&&ot[I]!==Gt[B];)B--;for(;1<=I&&0<=B;I--,B--)if(ot[I]!==Gt[B]){if(I!==1||B!==1)do if(I--,B--,0>B||ot[I]!==Gt[B]){var mn=`
`+ot[I].replace(" at new "," at ");return u.displayName&&mn.includes("<anonymous>")&&(mn=mn.replace("<anonymous>",u.displayName)),mn}while(1<=I&&0<=B);break}}}finally{cs=!1,Error.prepareStackTrace=S}return(S=u?u.displayName||u.name:"")?Rr(S):""}function jn(u,g){switch(u.tag){case 26:case 27:case 5:return Rr(u.type);case 16:return Rr("Lazy");case 13:return u.child!==g&&g!==null?Rr("Suspense Fallback"):Rr("Suspense");case 19:return Rr("SuspenseList");case 0:case 15:return wr(u.type,!1);case 11:return wr(u.type.render,!1);case 1:return wr(u.type,!0);case 31:return Rr("Activity");default:return""}}function ti(u){try{var g="",S=null;do g+=jn(u,S),S=u,u=u.return;while(u);return g}catch(I){return`
Error generating stack: `+I.message+`
`+I.stack}}var rr=Object.prototype.hasOwnProperty,et=t.unstable_scheduleCallback,Ot=t.unstable_cancelCallback,nn=t.unstable_shouldYield,Kn=t.unstable_requestPaint,yn=t.unstable_now,Dn=t.unstable_getCurrentPriorityLevel,ci=t.unstable_ImmediatePriority,Yi=t.unstable_UserBlockingPriority,or=t.unstable_NormalPriority,Gr=t.unstable_LowPriority,ea=t.unstable_IdlePriority,vs=t.log,Ol=t.unstable_setDisableYieldValue,ta=null,dr=null;function lo(u){if(typeof vs=="function"&&Ol(u),dr&&typeof dr.setStrictMode=="function")try{dr.setStrictMode(ta,u)}catch{}}var Os=Math.clz32?Math.clz32:Ia,Za=Math.log,Go=Math.LN2;function Ia(u){return u>>>=0,u===0?32:31-(Za(u)/Go|0)|0}var Mr=256,js=262144,Cs=4194304;function bs(u){var g=u&42;if(g!==0)return g;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function us(u,g,S){var I=u.pendingLanes;if(I===0)return 0;var B=0,q=u.suspendedLanes,de=u.pingedLanes;u=u.warmLanes;var Oe=I&134217727;return Oe!==0?(I=Oe&~q,I!==0?B=bs(I):(de&=Oe,de!==0?B=bs(de):S||(S=Oe&~u,S!==0&&(B=bs(S))))):(Oe=I&~q,Oe!==0?B=bs(Oe):de!==0?B=bs(de):S||(S=I&~u,S!==0&&(B=bs(S)))),B===0?0:g!==0&&g!==B&&(g&q)===0&&(q=B&-B,S=g&-g,q>=S||q===32&&(S&4194048)!==0)?g:B}function Ho(u,g){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&g)===0}function Do(u,g){switch(u){case 1:case 2:case 4:case 8:case 64:return g+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Po(){var u=Cs;return Cs<<=1,(Cs&62914560)===0&&(Cs=4194304),u}function wo(u){for(var g=[],S=0;31>S;S++)g.push(u);return g}function Ct(u,g){u.pendingLanes|=g,g!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Rs(u,g,S,I,B,q){var de=u.pendingLanes;u.pendingLanes=S,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=S,u.entangledLanes&=S,u.errorRecoveryDisabledLanes&=S,u.shellSuspendCounter=0;var Oe=u.entanglements,ot=u.expirationTimes,Gt=u.hiddenUpdates;for(S=de&~S;0<S;){var mn=31-Os(S),xn=1<<mn;Oe[mn]=0,ot[mn]=-1;var Wt=Gt[mn];if(Wt!==null)for(Gt[mn]=null,mn=0;mn<Wt.length;mn++){var tn=Wt[mn];tn!==null&&(tn.lane&=-536870913)}S&=~xn}I!==0&&ga(u,I,0),q!==0&&B===0&&u.tag!==0&&(u.suspendedLanes|=q&~(de&~g))}function ga(u,g,S){u.pendingLanes|=g,u.suspendedLanes&=~g;var I=31-Os(g);u.entangledLanes|=g,u.entanglements[I]=u.entanglements[I]|1073741824|S&261930}function qo(u,g){var S=u.entangledLanes|=g;for(u=u.entanglements;S;){var I=31-Os(S),B=1<<I;B&g|u[I]&g&&(u[I]|=g),S&=~B}}function fi(u,g){var S=g&-g;return S=(S&42)!==0?1:Ds(S),(S&(u.suspendedLanes|g))!==0?0:S}function Ds(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function zl(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function _a(){var u=ze.p;return u!==0?u:(u=window.event,u===void 0?32:zb(u.type))}function We(u,g){var S=ze.p;try{return ze.p=u,g()}finally{ze.p=S}}var ne=Math.random().toString(36).slice(2),se="__reactFiber$"+ne,ve="__reactProps$"+ne,je="__reactContainer$"+ne,ke="__reactEvents$"+ne,He="__reactListeners$"+ne,at="__reactHandles$"+ne,qe="__reactResources$"+ne,nt="__reactMarker$"+ne;function Bt(u){delete u[se],delete u[ve],delete u[ke],delete u[He],delete u[at]}function It(u){var g=u[se];if(g)return g;for(var S=u.parentNode;S;){if(g=S[je]||S[se]){if(S=g.alternate,g.child!==null||S!==null&&S.child!==null)for(u=pv(u);u!==null;){if(S=u[se])return S;u=pv(u)}return g}u=S,S=u.parentNode}return null}function vn(u){if(u=u[se]||u[je]){var g=u.tag;if(g===5||g===6||g===13||g===31||g===26||g===27||g===3)return u}return null}function $n(u){var g=u.tag;if(g===5||g===26||g===27||g===6)return u.stateNode;throw Error(d(33))}function Bn(u){var g=u[qe];return g||(g=u[qe]={hoistableStyles:new Map,hoistableScripts:new Map}),g}function Tn(u){u[nt]=!0}var pi=new Set,_i={};function Hi(u,g){Lr(u,g),Lr(u+"Capture",g)}function Lr(u,g){for(_i[u]=g,u=0;u<g.length;u++)pi.add(g[u])}var Ps=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gs={},ds={};function ar(u){return rr.call(ds,u)?!0:rr.call(gs,u)?!1:Ps.test(u)?ds[u]=!0:(gs[u]=!0,!1)}function Ei(u,g,S){if(ar(g))if(S===null)u.removeAttribute(g);else{switch(typeof S){case"undefined":case"function":case"symbol":u.removeAttribute(g);return;case"boolean":var I=g.toLowerCase().slice(0,5);if(I!=="data-"&&I!=="aria-"){u.removeAttribute(g);return}}u.setAttribute(g,""+S)}}function Sr(u,g,S){if(S===null)u.removeAttribute(g);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(g);return}u.setAttribute(g,""+S)}}function mr(u,g,S,I){if(I===null)u.removeAttribute(S);else{switch(typeof I){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(S);return}u.setAttributeNS(g,S,""+I)}}function Oi(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Ir(u){var g=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Fs(u,g,S){var I=Object.getOwnPropertyDescriptor(u.constructor.prototype,g);if(!u.hasOwnProperty(g)&&typeof I<"u"&&typeof I.get=="function"&&typeof I.set=="function"){var B=I.get,q=I.set;return Object.defineProperty(u,g,{configurable:!0,get:function(){return B.call(this)},set:function(de){S=""+de,q.call(this,de)}}),Object.defineProperty(u,g,{enumerable:I.enumerable}),{getValue:function(){return S},setValue:function(de){S=""+de},stopTracking:function(){u._valueTracker=null,delete u[g]}}}}function So(u){if(!u._valueTracker){var g=Ir(u)?"checked":"value";u._valueTracker=Fs(u,g,""+u[g])}}function Wa(u){if(!u)return!1;var g=u._valueTracker;if(!g)return!0;var S=g.getValue(),I="";return u&&(I=Ir(u)?u.checked?"true":"false":u.value),u=I,u!==S?(g.setValue(u),!0):!1}function nc(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var Xs=/[\n"\\]/g;function Bs(u){return u.replace(Xs,function(g){return"\\"+g.charCodeAt(0).toString(16)+" "})}function Oo(u,g,S,I,B,q,de,Oe){u.name="",de!=null&&typeof de!="function"&&typeof de!="symbol"&&typeof de!="boolean"?u.type=de:u.removeAttribute("type"),g!=null?de==="number"?(g===0&&u.value===""||u.value!=g)&&(u.value=""+Oi(g)):u.value!==""+Oi(g)&&(u.value=""+Oi(g)):de!=="submit"&&de!=="reset"||u.removeAttribute("value"),g!=null?na(u,de,Oi(g)):S!=null?na(u,de,Oi(S)):I!=null&&u.removeAttribute("value"),B==null&&q!=null&&(u.defaultChecked=!!q),B!=null&&(u.checked=B&&typeof B!="function"&&typeof B!="symbol"),Oe!=null&&typeof Oe!="function"&&typeof Oe!="symbol"&&typeof Oe!="boolean"?u.name=""+Oi(Oe):u.removeAttribute("name")}function ul(u,g,S,I,B,q,de,Oe){if(q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(u.type=q),g!=null||S!=null){if(!(q!=="submit"&&q!=="reset"||g!=null)){So(u);return}S=S!=null?""+Oi(S):"",g=g!=null?""+Oi(g):S,Oe||g===u.value||(u.value=g),u.defaultValue=g}I=I??B,I=typeof I!="function"&&typeof I!="symbol"&&!!I,u.checked=Oe?u.checked:!!I,u.defaultChecked=!!I,de!=null&&typeof de!="function"&&typeof de!="symbol"&&typeof de!="boolean"&&(u.name=de),So(u)}function na(u,g,S){g==="number"&&nc(u.ownerDocument)===u||u.defaultValue===""+S||(u.defaultValue=""+S)}function To(u,g,S,I){if(u=u.options,g){g={};for(var B=0;B<S.length;B++)g["$"+S[B]]=!0;for(S=0;S<u.length;S++)B=g.hasOwnProperty("$"+u[S].value),u[S].selected!==B&&(u[S].selected=B),B&&I&&(u[S].defaultSelected=!0)}else{for(S=""+Oi(S),g=null,B=0;B<u.length;B++){if(u[B].value===S){u[B].selected=!0,I&&(u[B].defaultSelected=!0);return}g!==null||u[B].disabled||(g=u[B])}g!==null&&(g.selected=!0)}}function Rf(u,g,S){if(g!=null&&(g=""+Oi(g),g!==u.value&&(u.value=g),S==null)){u.defaultValue!==g&&(u.defaultValue=g);return}u.defaultValue=S!=null?""+Oi(S):""}function yh(u,g,S,I){if(g==null){if(I!=null){if(S!=null)throw Error(d(92));if(on(I)){if(1<I.length)throw Error(d(93));I=I[0]}S=I}S==null&&(S=""),g=S}S=Oi(g),u.defaultValue=S,I=u.textContent,I===S&&I!==""&&I!==null&&(u.value=I),So(u)}function ic(u,g){if(g){var S=u.firstChild;if(S&&S===u.lastChild&&S.nodeType===3){S.nodeValue=g;return}}u.textContent=g}var Mf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ia(u,g,S){var I=g.indexOf("--")===0;S==null||typeof S=="boolean"||S===""?I?u.setProperty(g,""):g==="float"?u.cssFloat="":u[g]="":I?u.setProperty(g,S):typeof S!="number"||S===0||Mf.has(g)?g==="float"?u.cssFloat=S:u[g]=(""+S).trim():u[g]=S+"px"}function dl(u,g,S){if(g!=null&&typeof g!="object")throw Error(d(62));if(u=u.style,S!=null){for(var I in S)!S.hasOwnProperty(I)||g!=null&&g.hasOwnProperty(I)||(I.indexOf("--")===0?u.setProperty(I,""):I==="float"?u.cssFloat="":u[I]="");for(var B in g)I=g[B],g.hasOwnProperty(B)&&S[B]!==I&&ia(u,B,I)}else for(var q in g)g.hasOwnProperty(q)&&ia(u,q,g[q])}function zo(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xa=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rc(u){return jc.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function hl(){}var xh=null;function fl(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Ka=null,mu=null;function gg(u){var g=vn(u);if(g&&(u=g.stateNode)){var S=u[ve]||null;e:switch(u=g.stateNode,g.type){case"input":if(Oo(u,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name),g=S.name,S.type==="radio"&&g!=null){for(S=u;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll('input[name="'+Bs(""+g)+'"][type="radio"]'),g=0;g<S.length;g++){var I=S[g];if(I!==u&&I.form===u.form){var B=I[ve]||null;if(!B)throw Error(d(90));Oo(I,B.value,B.defaultValue,B.defaultValue,B.checked,B.defaultChecked,B.type,B.name)}}for(g=0;g<S.length;g++)I=S[g],I.form===u.form&&Wa(I)}break e;case"textarea":Rf(u,S.value,S.defaultValue);break e;case"select":g=S.value,g!=null&&To(u,!!S.multiple,g,!1)}}}var Da=!1;function jp(u,g,S){if(Da)return u(g,S);Da=!0;try{var I=u(g);return I}finally{if(Da=!1,(Ka!==null||mu!==null)&&(is(),Ka&&(g=Ka,u=mu,mu=Ka=null,gg(g),u)))for(g=0;g<u.length;g++)gg(u[g])}}function Ll(u,g){var S=u.stateNode;if(S===null)return null;var I=S[ve]||null;if(I===null)return null;S=I[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(u=u.type,I=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!I;break e;default:u=!1}if(u)return null;if(S&&typeof S!="function")throw Error(d(231,g,typeof S));return S}var ya=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),If=!1;if(ya)try{var Fc={};Object.defineProperty(Fc,"passive",{get:function(){If=!0}}),window.addEventListener("test",Fc,Fc),window.removeEventListener("test",Fc,Fc)}catch{If=!1}var Ya=null,Fi=null,vh=null;function bh(){if(vh)return vh;var u,g=Fi,S=g.length,I,B="value"in Ya?Ya.value:Ya.textContent,q=B.length;for(u=0;u<S&&g[u]===B[u];u++);var de=S-u;for(I=1;I<=de&&g[S-I]===B[q-I];I++);return vh=B.slice(u,1<I?1-I:void 0)}function gu(u){var g=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&g===13&&(u=13)):u=g,u===10&&(u=13),32<=u||u===13?u:0}function wh(){return!0}function Sh(){return!1}function Lo(u){function g(S,I,B,q,de){this._reactName=S,this._targetInst=B,this.type=I,this.nativeEvent=q,this.target=de,this.currentTarget=null;for(var Oe in u)u.hasOwnProperty(Oe)&&(S=u[Oe],this[Oe]=S?S(q):q[Oe]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?wh:Sh,this.isPropagationStopped=Sh,this}return H(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=wh)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=wh)},persist:function(){},isPersistent:wh}),g}var Nl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sc=Lo(Nl),Th=H({},Nl,{view:0,detail:0}),Fp=Lo(Th),_g,rd,Zo,_u=H({},Th,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pa,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Zo&&(Zo&&u.type==="mousemove"?(_g=u.screenX-Zo.screenX,rd=u.screenY-Zo.screenY):rd=_g=0,Zo=u),_g)},movementY:function(u){return"movementY"in u?u.movementY:rd}}),sd=Lo(_u),Df=H({},_u,{dataTransfer:0}),Bc=Lo(Df),Vs=H({},Th,{relatedTarget:0}),Pf=Lo(Vs),yg=H({},Nl,{animationName:0,elapsedTime:0,pseudoElement:0}),xg=Lo(yg),nr=H({},Nl,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),vg=Lo(nr),ey=H({},Nl,{data:0}),bg=Lo(ey),Gn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Of={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pl(u){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(u):(u=Vc[u])?!!g[u]:!1}function Pa(){return pl}var Eh=H({},Th,{key:function(u){if(u.key){var g=Gn[u.key]||u.key;if(g!=="Unidentified")return g}return u.type==="keypress"?(u=gu(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?Of[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pa,charCode:function(u){return u.type==="keypress"?gu(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?gu(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),Mn=Lo(Eh),Bi=H({},_u,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xi=Lo(Bi),Oa=H({},Th,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pa}),Ah=Lo(Oa),sr=H({},Nl,{propertyName:0,elapsedTime:0,pseudoElement:0}),zf=Lo(sr),od=H({},_u,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),Lf=Lo(od),co=H({},Nl,{newState:0,oldState:0}),zs=Lo(co),Yx=[9,13,27,32],ad=ya&&"CompositionEvent"in window,ld=null;ya&&"documentMode"in document&&(ld=document.documentMode);var Nf=ya&&"TextEvent"in window&&!ld,kf=ya&&(!ad||ld&&8<ld&&11>=ld),Bp=" ",Ch=!1;function Ks(u,g){switch(u){case"keyup":return Yx.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oc(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var uo=!1;function Vp(u,g){switch(u){case"compositionend":return oc(g);case"keypress":return g.which!==32?null:(Ch=!0,Bp);case"textInput":return u=g.data,u===Bp&&Ch?null:u;default:return null}}function Rh(u,g){if(uo)return u==="compositionend"||!ad&&Ks(u,g)?(u=bh(),vh=Fi=Ya=null,uo=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return kf&&g.locale!=="ko"?null:g.data;default:return null}}var Ys={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kl(u){var g=u&&u.nodeName&&u.nodeName.toLowerCase();return g==="input"?!!Ys[u.type]:g==="textarea"}function ac(u,g,S,I){Ka?mu?mu.push(I):mu=[I]:Ka=I,g=Sy(g,"onChange"),0<g.length&&(S=new sc("onChange","change",null,S,I),u.push({event:S,listeners:g}))}var es=null,si=null;function wn(u){ov(u,0)}function lc(u){var g=$n(u);if(Wa(g))return u}function Yn(u,g){if(u==="change")return g}var cd=!1;if(ya){var Mh;if(ya){var Hn="oninput"in document;if(!Hn){var Ih=document.createElement("div");Ih.setAttribute("oninput","return;"),Hn=typeof Ih.oninput=="function"}Mh=Hn}else Mh=!1;cd=Mh&&(!document.documentMode||9<document.documentMode)}function jf(){es&&(es.detachEvent("onpropertychange",wg),si=es=null)}function wg(u){if(u.propertyName==="value"&&lc(si)){var g=[];ac(g,si,u,fl(u)),jp(wn,g)}}function cc(u,g,S){u==="focusin"?(jf(),es=g,si=S,es.attachEvent("onpropertychange",wg)):u==="focusout"&&jf()}function Up(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return lc(si)}function ho(u,g){if(u==="click")return lc(g)}function Wo(u,g){if(u==="input"||u==="change")return lc(g)}function ud(u,g){return u===g&&(u!==0||1/u===1/g)||u!==u&&g!==g}var No=typeof Object.is=="function"?Object.is:ud;function Qa(u,g){if(No(u,g))return!0;if(typeof u!="object"||u===null||typeof g!="object"||g===null)return!1;var S=Object.keys(u),I=Object.keys(g);if(S.length!==I.length)return!1;for(I=0;I<S.length;I++){var B=S[I];if(!rr.call(g,B)||!No(u[B],g[B]))return!1}return!0}function io(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function ty(u,g){var S=io(u);u=0;for(var I;S;){if(S.nodeType===3){if(I=u+S.textContent.length,u<=g&&I>=g)return{node:S,offset:g-u};u=I}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=io(S)}}function ny(u,g){return u&&g?u===g?!0:u&&u.nodeType===3?!1:g&&g.nodeType===3?ny(u,g.parentNode):"contains"in u?u.contains(g):u.compareDocumentPosition?!!(u.compareDocumentPosition(g)&16):!1:!1}function Dh(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var g=nc(u.document);g instanceof u.HTMLIFrameElement;){try{var S=typeof g.contentWindow.location.href=="string"}catch{S=!1}if(S)u=g.contentWindow;else break;g=nc(u.document)}return g}function uc(u){var g=u&&u.nodeName&&u.nodeName.toLowerCase();return g&&(g==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||g==="textarea"||u.contentEditable==="true")}var iy=ya&&"documentMode"in document&&11>=document.documentMode,Xo=null,$p=null,yu=null,dd=!1;function Uc(u,g,S){var I=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;dd||Xo==null||Xo!==nc(I)||(I=Xo,"selectionStart"in I&&uc(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),yu&&Qa(yu,I)||(yu=I,I=Sy($p,"onSelect"),0<I.length&&(g=new sc("onSelect","select",null,g,S),u.push({event:g,listeners:I}),g.target=Xo)))}function hd(u,g){var S={};return S[u.toLowerCase()]=g.toLowerCase(),S["Webkit"+u]="webkit"+g,S["Moz"+u]="moz"+g,S}var fd={animationend:hd("Animation","AnimationEnd"),animationiteration:hd("Animation","AnimationIteration"),animationstart:hd("Animation","AnimationStart"),transitionrun:hd("Transition","TransitionRun"),transitionstart:hd("Transition","TransitionStart"),transitioncancel:hd("Transition","TransitionCancel"),transitionend:hd("Transition","TransitionEnd")},Sg={},$c={};ya&&($c=document.createElement("div").style,"AnimationEvent"in window||(delete fd.animationend.animation,delete fd.animationiteration.animation,delete fd.animationstart.animation),"TransitionEvent"in window||delete fd.transitionend.transition);function pd(u){if(Sg[u])return Sg[u];if(!fd[u])return u;var g=fd[u],S;for(S in g)if(g.hasOwnProperty(S)&&S in $c)return Sg[u]=g[S];return u}var Gp=pd("animationend"),Ff=pd("animationiteration"),Hp=pd("animationstart"),Tg=pd("transitionrun"),ml=pd("transitionstart"),md=pd("transitioncancel"),Ph=pd("transitionend"),qp=new Map,Bf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bf.push("scrollEnd");function ra(u,g){qp.set(u,g),Hi(g,[u])}var Gc=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var g=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(g))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},za=[],Hc=0,xa=0;function gd(){for(var u=Hc,g=xa=Hc=0;g<u;){var S=za[g];za[g++]=null;var I=za[g];za[g++]=null;var B=za[g];za[g++]=null;var q=za[g];if(za[g++]=null,I!==null&&B!==null){var de=I.pending;de===null?B.next=B:(B.next=de.next,de.next=B),I.pending=B}q!==0&&_d(S,B,q)}}function qt(u,g,S,I){za[Hc++]=u,za[Hc++]=g,za[Hc++]=S,za[Hc++]=I,xa|=I,u.lanes|=I,u=u.alternate,u!==null&&(u.lanes|=I)}function Vf(u,g,S,I){return qt(u,g,S,I),xu(u)}function gl(u,g){return qt(u,null,null,g),xu(u)}function _d(u,g,S){u.lanes|=S;var I=u.alternate;I!==null&&(I.lanes|=S);for(var B=!1,q=u.return;q!==null;)q.childLanes|=S,I=q.alternate,I!==null&&(I.childLanes|=S),q.tag===22&&(u=q.stateNode,u===null||u._visibility&1||(B=!0)),u=q,q=q.return;return u.tag===3?(q=u.stateNode,B&&g!==null&&(B=31-Os(S),u=q.hiddenUpdates,I=u[B],I===null?u[B]=[g]:I.push(g),g.lane=S|536870912),q):null}function xu(u){if(50<mo)throw mo=0,so=null,Error(d(185));for(var g=u.return;g!==null;)u=g,g=u.return;return u.tag===3?u.stateNode:null}var dc={};function hc(u,g,S,I){this.tag=u,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sa(u,g,S,I){return new hc(u,g,S,I)}function La(u){return u=u.prototype,!(!u||!u.isReactComponent)}function mi(u,g){var S=u.alternate;return S===null?(S=sa(u.tag,g,u.key,u.mode),S.elementType=u.elementType,S.type=u.type,S.stateNode=u.stateNode,S.alternate=u,u.alternate=S):(S.pendingProps=g,S.type=u.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=u.flags&65011712,S.childLanes=u.childLanes,S.lanes=u.lanes,S.child=u.child,S.memoizedProps=u.memoizedProps,S.memoizedState=u.memoizedState,S.updateQueue=u.updateQueue,g=u.dependencies,S.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},S.sibling=u.sibling,S.index=u.index,S.ref=u.ref,S.refCleanup=u.refCleanup,S}function yd(u,g){u.flags&=65011714;var S=u.alternate;return S===null?(u.childLanes=0,u.lanes=g,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=S.childLanes,u.lanes=S.lanes,u.child=S.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=S.memoizedProps,u.memoizedState=S.memoizedState,u.updateQueue=S.updateQueue,u.type=S.type,g=S.dependencies,u.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),u}function Zp(u,g,S,I,B,q){var de=0;if(I=u,typeof u=="function")La(u)&&(de=1);else if(typeof u=="string")de=NS(u,S,Kt.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case st:return u=sa(31,S,g,B),u.elementType=st,u.lanes=q,u;case ee:return xd(S.children,B,q,g);case le:de=8,B|=24;break;case ge:return u=sa(12,S,g,B|2),u.elementType=ge,u.lanes=q,u;case xe:return u=sa(13,S,g,B),u.elementType=xe,u.lanes=q,u;case Ze:return u=sa(19,S,g,B),u.elementType=Ze,u.lanes=q,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case _e:de=10;break e;case pe:de=9;break e;case Re:de=11;break e;case Le:de=14;break e;case $e:de=16,I=null;break e}de=29,S=Error(d(130,u===null?"null":typeof u,"")),I=null}return g=sa(de,S,g,B),g.elementType=u,g.type=I,g.lanes=q,g}function xd(u,g,S,I){return u=sa(7,u,I,g),u.lanes=S,u}function Oh(u,g,S){return u=sa(6,u,null,g),u.lanes=S,u}function ry(u){var g=sa(18,null,null,0);return g.stateNode=u,g}function Fr(u,g,S){return g=sa(4,u.children!==null?u.children:[],u.key,g),g.lanes=S,g.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},g}var Eg=new WeakMap;function Na(u,g){if(typeof u=="object"&&u!==null){var S=Eg.get(u);return S!==void 0?S:(g={value:u,source:g,stack:ti(g)},Eg.set(u,g),g)}return{value:u,source:g,stack:ti(g)}}var zh=[],Lh=0,Wp=null,Uf=0,Ja=[],_l=0,jl=null,fc=1,Fl="";function Bl(u,g){zh[Lh++]=Uf,zh[Lh++]=Wp,Wp=u,Uf=g}function $f(u,g,S){Ja[_l++]=fc,Ja[_l++]=Fl,Ja[_l++]=jl,jl=u;var I=fc;u=Fl;var B=32-Os(I)-1;I&=~(1<<B),S+=1;var q=32-Os(g)+B;if(30<q){var de=B-B%5;q=(I&(1<<de)-1).toString(32),I>>=de,B-=de,fc=1<<32-Os(g)+B|S<<B|I,Fl=q+u}else fc=1<<q|S<<B|I,Fl=u}function Gf(u){u.return!==null&&(Bl(u,1),$f(u,1,0))}function qc(u){for(;u===Wp;)Wp=zh[--Lh],zh[Lh]=null,Uf=zh[--Lh],zh[Lh]=null;for(;u===jl;)jl=Ja[--_l],Ja[_l]=null,Fl=Ja[--_l],Ja[_l]=null,fc=Ja[--_l],Ja[_l]=null}function vd(u,g){Ja[_l++]=fc,Ja[_l++]=Fl,Ja[_l++]=jl,fc=g.id,Fl=g.overflow,jl=u}var ro=null,hs=null,Nr=!1,pc=null,el=!1,vu=Error(d(519));function Vl(u){var g=Error(d(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Nh(Na(g,u)),vu}function Hf(u){var g=u.stateNode,S=u.type,I=u.memoizedProps;switch(g[se]=u,g[ve]=I,S){case"dialog":jr("cancel",g),jr("close",g);break;case"iframe":case"object":case"embed":jr("load",g);break;case"video":case"audio":for(S=0;S<Rm.length;S++)jr(Rm[S],g);break;case"source":jr("error",g);break;case"img":case"image":case"link":jr("error",g),jr("load",g);break;case"details":jr("toggle",g);break;case"input":jr("invalid",g),ul(g,I.value,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name,!0);break;case"select":jr("invalid",g);break;case"textarea":jr("invalid",g),yh(g,I.value,I.defaultValue,I.children)}S=I.children,typeof S!="string"&&typeof S!="number"&&typeof S!="bigint"||g.textContent===""+S||I.suppressHydrationWarning===!0||Im(g.textContent,S)?(I.popover!=null&&(jr("beforetoggle",g),jr("toggle",g)),I.onScroll!=null&&jr("scroll",g),I.onScrollEnd!=null&&jr("scrollend",g),I.onClick!=null&&(g.onclick=hl),g=!0):g=!1,g||Vl(u,!0)}function Xp(u){for(ro=u.return;ro;)switch(ro.tag){case 5:case 31:case 13:el=!1;return;case 27:case 3:el=!0;return;default:ro=ro.return}}function Zc(u){if(u!==ro)return!1;if(!Nr)return Xp(u),Nr=!0,!1;var g=u.tag,S;if((S=g!==3&&g!==27)&&((S=g===5)&&(S=u.type,S=!(S!=="form"&&S!=="button")||dv(u.type,u.memoizedProps)),S=!S),S&&hs&&Vl(u),Xp(u),g===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(d(317));hs=fv(u)}else if(g===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(d(317));hs=fv(u)}else g===27?(g=hs,Hd(u.type)?(u=Ta,Ta=null,hs=u):hs=g):hs=ro?Mc(u.stateNode.nextSibling):null;return!0}function Ul(){hs=ro=null,Nr=!1}function Kp(){var u=pc;return u!==null&&(zi===null?zi=u:zi.push.apply(zi,u),pc=null),u}function Nh(u){pc===null?pc=[u]:pc.push(u)}var Yp=Me(null),yl=null,xl=null;function bu(u,g,S){vt(Yp,g._currentValue),g._currentValue=S}function mc(u){u._currentValue=Yp.current,ct(Yp)}function Ag(u,g,S){for(;u!==null;){var I=u.alternate;if((u.childLanes&g)!==g?(u.childLanes|=g,I!==null&&(I.childLanes|=g)):I!==null&&(I.childLanes&g)!==g&&(I.childLanes|=g),u===S)break;u=u.return}}function qf(u,g,S,I){var B=u.child;for(B!==null&&(B.return=u);B!==null;){var q=B.dependencies;if(q!==null){var de=B.child;q=q.firstContext;e:for(;q!==null;){var Oe=q;q=B;for(var ot=0;ot<g.length;ot++)if(Oe.context===g[ot]){q.lanes|=S,Oe=q.alternate,Oe!==null&&(Oe.lanes|=S),Ag(q.return,S,u),I||(de=null);break e}q=Oe.next}}else if(B.tag===18){if(de=B.return,de===null)throw Error(d(341));de.lanes|=S,q=de.alternate,q!==null&&(q.lanes|=S),Ag(de,S,u),de=null}else de=B.child;if(de!==null)de.return=B;else for(de=B;de!==null;){if(de===u){de=null;break}if(B=de.sibling,B!==null){B.return=de.return,de=B;break}de=de.return}B=de}}function wu(u,g,S,I){u=null;for(var B=g,q=!1;B!==null;){if(!q){if((B.flags&524288)!==0)q=!0;else if((B.flags&262144)!==0)break}if(B.tag===10){var de=B.alternate;if(de===null)throw Error(d(387));if(de=de.memoizedProps,de!==null){var Oe=B.type;No(B.pendingProps.value,de.value)||(u!==null?u.push(Oe):u=[Oe])}}else if(B===Yt.current){if(de=B.alternate,de===null)throw Error(d(387));de.memoizedState.memoizedState!==B.memoizedState.memoizedState&&(u!==null?u.push(l_):u=[l_])}B=B.return}u!==null&&qf(g,u,S,I),g.flags|=262144}function bd(u){for(u=u.firstContext;u!==null;){if(!No(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function gc(u){yl=u,xl=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function Us(u){return Cg(yl,u)}function kh(u,g){return yl===null&&gc(u),Cg(u,g)}function Cg(u,g){var S=g._currentValue;if(g={context:g,memoizedValue:S,next:null},xl===null){if(u===null)throw Error(d(308));xl=g,u.dependencies={lanes:0,firstContext:g},u.flags|=524288}else xl=xl.next=g;return S}var Zf=typeof AbortController<"u"?AbortController:function(){var u=[],g=this.signal={aborted:!1,addEventListener:function(S,I){u.push(I)}};this.abort=function(){g.aborted=!0,u.forEach(function(S){return S()})}},wd=t.unstable_scheduleCallback,Qp=t.unstable_NormalPriority,ts={$$typeof:_e,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wf(){return{controller:new Zf,data:new Map,refCount:0}}function Wc(u){u.refCount--,u.refCount===0&&wd(Qp,function(){u.controller.abort()})}var Xc=null,Xf=0,Su=0,Tu=null;function Kf(u,g){if(Xc===null){var S=Xc=[];Xf=0,Su=by(),Tu={status:"pending",value:void 0,then:function(I){S.push(I)}}}return Xf++,g.then(Yf,Yf),g}function Yf(){if(--Xf===0&&Xc!==null){Tu!==null&&(Tu.status="fulfilled");var u=Xc;Xc=null,Su=0,Tu=null;for(var g=0;g<u.length;g++)(0,u[g])()}}function jh(u,g){var S=[],I={status:"pending",value:null,reason:null,then:function(B){S.push(B)}};return u.then(function(){I.status="fulfilled",I.value=g;for(var B=0;B<S.length;B++)(0,S[B])(g)},function(B){for(I.status="rejected",I.reason=B,B=0;B<S.length;B++)(0,S[B])(void 0)}),I}var Qf=Ke.S;Ke.S=function(u,g){qi=yn(),typeof g=="object"&&g!==null&&typeof g.then=="function"&&Kf(u,g),Qf!==null&&Qf(u,g)};var _c=Me(null);function Jp(){var u=_c.current;return u!==null?u:Qt.pooledCache}function Jf(u,g){g===null?vt(_c,_c.current):vt(_c,g.pool)}function Sd(){var u=Jp();return u===null?null:{parent:ts._currentValue,pool:u}}var Td=Error(d(460)),em=Error(d(474)),tm=Error(d(542)),nm={then:function(){}};function sy(u){return u=u.status,u==="fulfilled"||u==="rejected"}function ep(u,g,S){switch(S=u[S],S===void 0?u.push(g):S!==g&&(g.then(hl,hl),g=S),g.status){case"fulfilled":return g.value;case"rejected":throw u=g.reason,Ed(u),u;default:if(typeof g.status=="string")g.then(hl,hl);else{if(u=Qt,u!==null&&100<u.shellSuspendCounter)throw Error(d(482));u=g,u.status="pending",u.then(function(I){if(g.status==="pending"){var B=g;B.status="fulfilled",B.value=I}},function(I){if(g.status==="pending"){var B=g;B.status="rejected",B.reason=I}})}switch(g.status){case"fulfilled":return g.value;case"rejected":throw u=g.reason,Ed(u),u}throw Yc=g,Td}}function Kc(u){try{var g=u._init;return g(u._payload)}catch(S){throw S!==null&&typeof S=="object"&&typeof S.then=="function"?(Yc=S,Td):S}}var Yc=null;function Rg(){if(Yc===null)throw Error(d(459));var u=Yc;return Yc=null,u}function Ed(u){if(u===Td||u===tm)throw Error(d(483))}var Eu=null,Fh=0;function tp(u){var g=Fh;return Fh+=1,Eu===null&&(Eu=[]),ep(Eu,u,g)}function Au(u,g){g=g.props.ref,u.ref=g!==void 0?g:null}function vl(u,g){throw g.$$typeof===Y?Error(d(525)):(u=Object.prototype.toString.call(g),Error(d(31,u==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":u)))}function Bh(u){function g(Mt,pt){if(u){var Ht=Mt.deletions;Ht===null?(Mt.deletions=[pt],Mt.flags|=16):Ht.push(pt)}}function S(Mt,pt){if(!u)return null;for(;pt!==null;)g(Mt,pt),pt=pt.sibling;return null}function I(Mt){for(var pt=new Map;Mt!==null;)Mt.key!==null?pt.set(Mt.key,Mt):pt.set(Mt.index,Mt),Mt=Mt.sibling;return pt}function B(Mt,pt){return Mt=mi(Mt,pt),Mt.index=0,Mt.sibling=null,Mt}function q(Mt,pt,Ht){return Mt.index=Ht,u?(Ht=Mt.alternate,Ht!==null?(Ht=Ht.index,Ht<pt?(Mt.flags|=67108866,pt):Ht):(Mt.flags|=67108866,pt)):(Mt.flags|=1048576,pt)}function de(Mt){return u&&Mt.alternate===null&&(Mt.flags|=67108866),Mt}function Oe(Mt,pt,Ht,_n){return pt===null||pt.tag!==6?(pt=Oh(Ht,Mt.mode,_n),pt.return=Mt,pt):(pt=B(pt,Ht),pt.return=Mt,pt)}function ot(Mt,pt,Ht,_n){var Pi=Ht.type;return Pi===ee?mn(Mt,pt,Ht.props.children,_n,Ht.key):pt!==null&&(pt.elementType===Pi||typeof Pi=="object"&&Pi!==null&&Pi.$$typeof===$e&&Kc(Pi)===pt.type)?(pt=B(pt,Ht.props),Au(pt,Ht),pt.return=Mt,pt):(pt=Zp(Ht.type,Ht.key,Ht.props,null,Mt.mode,_n),Au(pt,Ht),pt.return=Mt,pt)}function Gt(Mt,pt,Ht,_n){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==Ht.containerInfo||pt.stateNode.implementation!==Ht.implementation?(pt=Fr(Ht,Mt.mode,_n),pt.return=Mt,pt):(pt=B(pt,Ht.children||[]),pt.return=Mt,pt)}function mn(Mt,pt,Ht,_n,Pi){return pt===null||pt.tag!==7?(pt=xd(Ht,Mt.mode,_n,Pi),pt.return=Mt,pt):(pt=B(pt,Ht),pt.return=Mt,pt)}function xn(Mt,pt,Ht){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return pt=Oh(""+pt,Mt.mode,Ht),pt.return=Mt,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case ie:return Ht=Zp(pt.type,pt.key,pt.props,null,Mt.mode,Ht),Au(Ht,pt),Ht.return=Mt,Ht;case oe:return pt=Fr(pt,Mt.mode,Ht),pt.return=Mt,pt;case $e:return pt=Kc(pt),xn(Mt,pt,Ht)}if(on(pt)||$t(pt))return pt=xd(pt,Mt.mode,Ht,null),pt.return=Mt,pt;if(typeof pt.then=="function")return xn(Mt,tp(pt),Ht);if(pt.$$typeof===_e)return xn(Mt,kh(Mt,pt),Ht);vl(Mt,pt)}return null}function Wt(Mt,pt,Ht,_n){var Pi=pt!==null?pt.key:null;if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number"||typeof Ht=="bigint")return Pi!==null?null:Oe(Mt,pt,""+Ht,_n);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case ie:return Ht.key===Pi?ot(Mt,pt,Ht,_n):null;case oe:return Ht.key===Pi?Gt(Mt,pt,Ht,_n):null;case $e:return Ht=Kc(Ht),Wt(Mt,pt,Ht,_n)}if(on(Ht)||$t(Ht))return Pi!==null?null:mn(Mt,pt,Ht,_n,null);if(typeof Ht.then=="function")return Wt(Mt,pt,tp(Ht),_n);if(Ht.$$typeof===_e)return Wt(Mt,pt,kh(Mt,Ht),_n);vl(Mt,Ht)}return null}function tn(Mt,pt,Ht,_n,Pi){if(typeof _n=="string"&&_n!==""||typeof _n=="number"||typeof _n=="bigint")return Mt=Mt.get(Ht)||null,Oe(pt,Mt,""+_n,Pi);if(typeof _n=="object"&&_n!==null){switch(_n.$$typeof){case ie:return Mt=Mt.get(_n.key===null?Ht:_n.key)||null,ot(pt,Mt,_n,Pi);case oe:return Mt=Mt.get(_n.key===null?Ht:_n.key)||null,Gt(pt,Mt,_n,Pi);case $e:return _n=Kc(_n),tn(Mt,pt,Ht,_n,Pi)}if(on(_n)||$t(_n))return Mt=Mt.get(Ht)||null,mn(pt,Mt,_n,Pi,null);if(typeof _n.then=="function")return tn(Mt,pt,Ht,tp(_n),Pi);if(_n.$$typeof===_e)return tn(Mt,pt,Ht,kh(pt,_n),Pi);vl(pt,_n)}return null}function ni(Mt,pt,Ht,_n){for(var Pi=null,os=null,Ti=pt,hr=pt=0,qr=null;Ti!==null&&hr<Ht.length;hr++){Ti.index>hr?(qr=Ti,Ti=null):qr=Ti.sibling;var Zr=Wt(Mt,Ti,Ht[hr],_n);if(Zr===null){Ti===null&&(Ti=qr);break}u&&Ti&&Zr.alternate===null&&g(Mt,Ti),pt=q(Zr,pt,hr),os===null?Pi=Zr:os.sibling=Zr,os=Zr,Ti=qr}if(hr===Ht.length)return S(Mt,Ti),Nr&&Bl(Mt,hr),Pi;if(Ti===null){for(;hr<Ht.length;hr++)Ti=xn(Mt,Ht[hr],_n),Ti!==null&&(pt=q(Ti,pt,hr),os===null?Pi=Ti:os.sibling=Ti,os=Ti);return Nr&&Bl(Mt,hr),Pi}for(Ti=I(Ti);hr<Ht.length;hr++)qr=tn(Ti,Mt,hr,Ht[hr],_n),qr!==null&&(u&&qr.alternate!==null&&Ti.delete(qr.key===null?hr:qr.key),pt=q(qr,pt,hr),os===null?Pi=qr:os.sibling=qr,os=qr);return u&&Ti.forEach(function(Qd){return g(Mt,Qd)}),Nr&&Bl(Mt,hr),Pi}function Di(Mt,pt,Ht,_n){if(Ht==null)throw Error(d(151));for(var Pi=null,os=null,Ti=pt,hr=pt=0,qr=null,Zr=Ht.next();Ti!==null&&!Zr.done;hr++,Zr=Ht.next()){Ti.index>hr?(qr=Ti,Ti=null):qr=Ti.sibling;var Qd=Wt(Mt,Ti,Zr.value,_n);if(Qd===null){Ti===null&&(Ti=qr);break}u&&Ti&&Qd.alternate===null&&g(Mt,Ti),pt=q(Qd,pt,hr),os===null?Pi=Qd:os.sibling=Qd,os=Qd,Ti=qr}if(Zr.done)return S(Mt,Ti),Nr&&Bl(Mt,hr),Pi;if(Ti===null){for(;!Zr.done;hr++,Zr=Ht.next())Zr=xn(Mt,Zr.value,_n),Zr!==null&&(pt=q(Zr,pt,hr),os===null?Pi=Zr:os.sibling=Zr,os=Zr);return Nr&&Bl(Mt,hr),Pi}for(Ti=I(Ti);!Zr.done;hr++,Zr=Ht.next())Zr=tn(Ti,Mt,hr,Zr.value,_n),Zr!==null&&(u&&Zr.alternate!==null&&Ti.delete(Zr.key===null?hr:Zr.key),pt=q(Zr,pt,hr),os===null?Pi=Zr:os.sibling=Zr,os=Zr);return u&&Ti.forEach(function(Mv){return g(Mt,Mv)}),Nr&&Bl(Mt,hr),Pi}function Ts(Mt,pt,Ht,_n){if(typeof Ht=="object"&&Ht!==null&&Ht.type===ee&&Ht.key===null&&(Ht=Ht.props.children),typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case ie:e:{for(var Pi=Ht.key;pt!==null;){if(pt.key===Pi){if(Pi=Ht.type,Pi===ee){if(pt.tag===7){S(Mt,pt.sibling),_n=B(pt,Ht.props.children),_n.return=Mt,Mt=_n;break e}}else if(pt.elementType===Pi||typeof Pi=="object"&&Pi!==null&&Pi.$$typeof===$e&&Kc(Pi)===pt.type){S(Mt,pt.sibling),_n=B(pt,Ht.props),Au(_n,Ht),_n.return=Mt,Mt=_n;break e}S(Mt,pt);break}else g(Mt,pt);pt=pt.sibling}Ht.type===ee?(_n=xd(Ht.props.children,Mt.mode,_n,Ht.key),_n.return=Mt,Mt=_n):(_n=Zp(Ht.type,Ht.key,Ht.props,null,Mt.mode,_n),Au(_n,Ht),_n.return=Mt,Mt=_n)}return de(Mt);case oe:e:{for(Pi=Ht.key;pt!==null;){if(pt.key===Pi)if(pt.tag===4&&pt.stateNode.containerInfo===Ht.containerInfo&&pt.stateNode.implementation===Ht.implementation){S(Mt,pt.sibling),_n=B(pt,Ht.children||[]),_n.return=Mt,Mt=_n;break e}else{S(Mt,pt);break}else g(Mt,pt);pt=pt.sibling}_n=Fr(Ht,Mt.mode,_n),_n.return=Mt,Mt=_n}return de(Mt);case $e:return Ht=Kc(Ht),Ts(Mt,pt,Ht,_n)}if(on(Ht))return ni(Mt,pt,Ht,_n);if($t(Ht)){if(Pi=$t(Ht),typeof Pi!="function")throw Error(d(150));return Ht=Pi.call(Ht),Di(Mt,pt,Ht,_n)}if(typeof Ht.then=="function")return Ts(Mt,pt,tp(Ht),_n);if(Ht.$$typeof===_e)return Ts(Mt,pt,kh(Mt,Ht),_n);vl(Mt,Ht)}return typeof Ht=="string"&&Ht!==""||typeof Ht=="number"||typeof Ht=="bigint"?(Ht=""+Ht,pt!==null&&pt.tag===6?(S(Mt,pt.sibling),_n=B(pt,Ht),_n.return=Mt,Mt=_n):(S(Mt,pt),_n=Oh(Ht,Mt.mode,_n),_n.return=Mt,Mt=_n),de(Mt)):S(Mt,pt)}return function(Mt,pt,Ht,_n){try{Fh=0;var Pi=Ts(Mt,pt,Ht,_n);return Eu=null,Pi}catch(Ti){if(Ti===Td||Ti===tm)throw Ti;var os=sa(29,Ti,null,Mt.mode);return os.lanes=_n,os.return=Mt,os}finally{}}}var yc=Bh(!0),Cu=Bh(!1),va=!1;function np(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Vh(u,g){u=u.updateQueue,g.updateQueue===u&&(g.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function xc(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function vc(u,g,S){var I=u.updateQueue;if(I===null)return null;if(I=I.shared,(Rt&2)!==0){var B=I.pending;return B===null?g.next=g:(g.next=B.next,B.next=g),I.pending=g,g=xu(u),_d(u,null,S),g}return qt(u,I,g,S),xu(u)}function Ru(u,g,S){if(g=g.updateQueue,g!==null&&(g=g.shared,(S&4194048)!==0)){var I=g.lanes;I&=u.pendingLanes,S|=I,g.lanes=S,qo(u,S)}}function Uh(u,g){var S=u.updateQueue,I=u.alternate;if(I!==null&&(I=I.updateQueue,S===I)){var B=null,q=null;if(S=S.firstBaseUpdate,S!==null){do{var de={lane:S.lane,tag:S.tag,payload:S.payload,callback:null,next:null};q===null?B=q=de:q=q.next=de,S=S.next}while(S!==null);q===null?B=q=g:q=q.next=g}else B=q=g;S={baseState:I.baseState,firstBaseUpdate:B,lastBaseUpdate:q,shared:I.shared,callbacks:I.callbacks},u.updateQueue=S;return}u=S.lastBaseUpdate,u===null?S.firstBaseUpdate=g:u.next=g,S.lastBaseUpdate=g}var ip=!1;function Mu(){if(ip){var u=Tu;if(u!==null)throw u}}function bc(u,g,S,I){ip=!1;var B=u.updateQueue;va=!1;var q=B.firstBaseUpdate,de=B.lastBaseUpdate,Oe=B.shared.pending;if(Oe!==null){B.shared.pending=null;var ot=Oe,Gt=ot.next;ot.next=null,de===null?q=Gt:de.next=Gt,de=ot;var mn=u.alternate;mn!==null&&(mn=mn.updateQueue,Oe=mn.lastBaseUpdate,Oe!==de&&(Oe===null?mn.firstBaseUpdate=Gt:Oe.next=Gt,mn.lastBaseUpdate=ot))}if(q!==null){var xn=B.baseState;de=0,mn=Gt=ot=null,Oe=q;do{var Wt=Oe.lane&-536870913,tn=Wt!==Oe.lane;if(tn?(St&Wt)===Wt:(I&Wt)===Wt){Wt!==0&&Wt===Su&&(ip=!0),mn!==null&&(mn=mn.next={lane:0,tag:Oe.tag,payload:Oe.payload,callback:null,next:null});e:{var ni=u,Di=Oe;Wt=g;var Ts=S;switch(Di.tag){case 1:if(ni=Di.payload,typeof ni=="function"){xn=ni.call(Ts,xn,Wt);break e}xn=ni;break e;case 3:ni.flags=ni.flags&-65537|128;case 0:if(ni=Di.payload,Wt=typeof ni=="function"?ni.call(Ts,xn,Wt):ni,Wt==null)break e;xn=H({},xn,Wt);break e;case 2:va=!0}}Wt=Oe.callback,Wt!==null&&(u.flags|=64,tn&&(u.flags|=8192),tn=B.callbacks,tn===null?B.callbacks=[Wt]:tn.push(Wt))}else tn={lane:Wt,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null},mn===null?(Gt=mn=tn,ot=xn):mn=mn.next=tn,de|=Wt;if(Oe=Oe.next,Oe===null){if(Oe=B.shared.pending,Oe===null)break;tn=Oe,Oe=tn.next,tn.next=null,B.lastBaseUpdate=tn,B.shared.pending=null}}while(!0);mn===null&&(ot=xn),B.baseState=ot,B.firstBaseUpdate=Gt,B.lastBaseUpdate=mn,q===null&&(B.shared.lanes=0),Vi|=de,u.lanes=de,u.memoizedState=xn}}function oy(u,g){if(typeof u!="function")throw Error(d(191,u));u.call(g)}function Qc(u,g){var S=u.callbacks;if(S!==null)for(u.callbacks=null,u=0;u<S.length;u++)oy(S[u],g)}var Ad=Me(null),im=Me(0);function rp(u,g){u=ui,vt(im,u),vt(Ad,g),ui=u|g.baseLanes}function $h(){vt(im,ui),vt(Ad,Ad.current)}function bl(){ui=im.current,ct(Ad),ct(im)}var Ko=Me(null),Eo=null;function wc(u){var g=u.alternate;vt(Qs,Qs.current&1),vt(Ko,u),Eo===null&&(g===null||Ad.current!==null||g.memoizedState!==null)&&(Eo=u)}function Gh(u){vt(Qs,Qs.current),vt(Ko,u),Eo===null&&(Eo=u)}function sp(u){u.tag===22?(vt(Qs,Qs.current),vt(Ko,u),Eo===null&&(Eo=u)):wl()}function wl(){vt(Qs,Qs.current),vt(Ko,Ko.current)}function oa(u){ct(Ko),Eo===u&&(Eo=null),ct(Qs)}var Qs=Me(0);function Sc(u){for(var g=u;g!==null;){if(g.tag===13){var S=g.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||i_(S)||Ry(S)))return g}else if(g.tag===19&&(g.memoizedProps.revealOrder==="forwards"||g.memoizedProps.revealOrder==="backwards"||g.memoizedProps.revealOrder==="unstable_legacy-backwards"||g.memoizedProps.revealOrder==="together")){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===u)break;for(;g.sibling===null;){if(g.return===null||g.return===u)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var ka=0,jt=null,fs=null,ws=null,$l=!1,tl=!1,Ln=!1,Hh=0,qh=0,Jc=null,rm=0;function Ls(){throw Error(d(321))}function op(u,g){if(g===null)return!1;for(var S=0;S<g.length&&S<u.length;S++)if(!No(u[S],g[S]))return!1;return!0}function sm(u,g,S,I,B,q){return ka=q,jt=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Ke.H=u===null||u.memoizedState===null?rl:pp,Ln=!1,q=S(I,B),Ln=!1,tl&&(q=ly(g,S,I,B)),ay(u),q}function ay(u){Ke.H=kd;var g=fs!==null&&fs.next!==null;if(ka=0,ws=fs=jt=null,$l=!1,qh=0,Jc=null,g)throw Error(d(300));u===null||Js||(u=u.dependencies,u!==null&&bd(u)&&(Js=!0))}function ly(u,g,S,I){jt=u;var B=0;do{if(tl&&(Jc=null),qh=0,tl=!1,25<=B)throw Error(d(301));if(B+=1,ws=fs=null,u.updateQueue!=null){var q=u.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}Ke.H=mp,q=g(S,I)}while(tl);return q}function ja(){var u=Ke.H,g=u.useState()[0];return g=typeof g.then=="function"?Cd(g):g,u=u.useState()[0],(fs!==null?fs.memoizedState:null)!==u&&(jt.flags|=1024),g}function ap(){var u=Hh!==0;return Hh=0,u}function ko(u,g,S){g.updateQueue=u.updateQueue,g.flags&=-2053,u.lanes&=~S}function Tc(u){if($l){for(u=u.memoizedState;u!==null;){var g=u.queue;g!==null&&(g.pending=null),u=u.next}$l=!1}ka=0,ws=fs=jt=null,tl=!1,qh=Hh=0,Jc=null}function aa(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ws===null?jt.memoizedState=ws=u:ws=ws.next=u,ws}function $s(){if(fs===null){var u=jt.alternate;u=u!==null?u.memoizedState:null}else u=fs.next;var g=ws===null?jt.memoizedState:ws.next;if(g!==null)ws=g,fs=u;else{if(u===null)throw jt.alternate===null?Error(d(467)):Error(d(310));fs=u,u={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},ws===null?jt.memoizedState=ws=u:ws=ws.next=u}return ws}function Zh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Cd(u){var g=qh;return qh+=1,Jc===null&&(Jc=[]),u=ep(Jc,u,g),g=jt,(ws===null?g.memoizedState:ws.next)===null&&(g=g.alternate,Ke.H=g===null||g.memoizedState===null?rl:pp),u}function Wh(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return Cd(u);if(u.$$typeof===_e)return Us(u)}throw Error(d(438,String(u)))}function la(u){var g=null,S=jt.updateQueue;if(S!==null&&(g=S.memoCache),g==null){var I=jt.alternate;I!==null&&(I=I.updateQueue,I!==null&&(I=I.memoCache,I!=null&&(g={data:I.data.map(function(B){return B.slice()}),index:0})))}if(g==null&&(g={data:[],index:0}),S===null&&(S=Zh(),jt.updateQueue=S),S.memoCache=g,S=g.data[g.index],S===void 0)for(S=g.data[g.index]=Array(u),I=0;I<u;I++)S[I]=Et;return g.index++,S}function ir(u,g){return typeof g=="function"?g(u):g}function Iu(u){var g=$s();return Du(g,fs,u)}function Du(u,g,S){var I=u.queue;if(I===null)throw Error(d(311));I.lastRenderedReducer=S;var B=u.baseQueue,q=I.pending;if(q!==null){if(B!==null){var de=B.next;B.next=q.next,q.next=de}g.baseQueue=B=q,I.pending=null}if(q=u.baseState,B===null)u.memoizedState=q;else{g=B.next;var Oe=de=null,ot=null,Gt=g,mn=!1;do{var xn=Gt.lane&-536870913;if(xn!==Gt.lane?(St&xn)===xn:(ka&xn)===xn){var Wt=Gt.revertLane;if(Wt===0)ot!==null&&(ot=ot.next={lane:0,revertLane:0,gesture:null,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null}),xn===Su&&(mn=!0);else if((ka&Wt)===Wt){Gt=Gt.next,Wt===Su&&(mn=!0);continue}else xn={lane:0,revertLane:Gt.revertLane,gesture:null,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null},ot===null?(Oe=ot=xn,de=q):ot=ot.next=xn,jt.lanes|=Wt,Vi|=Wt;xn=Gt.action,Ln&&S(q,xn),q=Gt.hasEagerState?Gt.eagerState:S(q,xn)}else Wt={lane:xn,revertLane:Gt.revertLane,gesture:Gt.gesture,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null},ot===null?(Oe=ot=Wt,de=q):ot=ot.next=Wt,jt.lanes|=xn,Vi|=xn;Gt=Gt.next}while(Gt!==null&&Gt!==g);if(ot===null?de=q:ot.next=Oe,!No(q,u.memoizedState)&&(Js=!0,mn&&(S=Tu,S!==null)))throw S;u.memoizedState=q,u.baseState=de,u.baseQueue=ot,I.lastRenderedState=q}return B===null&&(I.lanes=0),[u.memoizedState,I.dispatch]}function om(u){var g=$s(),S=g.queue;if(S===null)throw Error(d(311));S.lastRenderedReducer=u;var I=S.dispatch,B=S.pending,q=g.memoizedState;if(B!==null){S.pending=null;var de=B=B.next;do q=u(q,de.action),de=de.next;while(de!==B);No(q,g.memoizedState)||(Js=!0),g.memoizedState=q,g.baseQueue===null&&(g.baseState=q),S.lastRenderedState=q}return[q,I]}function Mg(u,g,S){var I=jt,B=$s(),q=Nr;if(q){if(S===void 0)throw Error(d(407));S=S()}else S=g();var de=!No((fs||B).memoizedState,S);if(de&&(B.memoizedState=S,Js=!0),B=B.queue,Pd(nl.bind(null,I,B,u),[u]),B.getSnapshot!==g||de||ws!==null&&ws.memoizedState.tag&1){if(I.flags|=2048,jo(9,{destroy:void 0},am.bind(null,I,B,S,g),null),Qt===null)throw Error(d(349));q||(ka&127)!==0||Ec(I,g,S)}return S}function Ec(u,g,S){u.flags|=16384,u={getSnapshot:g,value:S},g=jt.updateQueue,g===null?(g=Zh(),jt.updateQueue=g,g.stores=[u]):(S=g.stores,S===null?g.stores=[u]:S.push(u))}function am(u,g,S,I){g.value=S,g.getSnapshot=I,Pu(g)&&Vt(u)}function nl(u,g,S){return S(function(){Pu(g)&&Vt(u)})}function Pu(u){var g=u.getSnapshot;u=u.value;try{var S=g();return!No(u,S)}catch{return!0}}function Vt(u){var g=gl(u,2);g!==null&&ns(g,u,2)}function un(u){var g=aa();if(typeof u=="function"){var S=u;if(u=S(),Ln){lo(!0);try{S()}finally{lo(!1)}}}return g.memoizedState=g.baseState=u,g.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ir,lastRenderedState:u},g}function Rd(u,g,S,I){return u.baseState=S,Du(u,fs,typeof I=="function"?I:ir)}function ss(u,g,S,I,B){if(Ld(u))throw Error(d(485));if(u=g.action,u!==null){var q={payload:B,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(de){q.listeners.push(de)}};Ke.T!==null?S(!0):q.isTransition=!1,I(q),S=g.pending,S===null?(q.next=g.pending=q,Ye(g,q)):(q.next=S.next,g.pending=S.next=q)}}function Ye(u,g){var S=g.action,I=g.payload,B=u.state;if(g.isTransition){var q=Ke.T,de={};Ke.T=de;try{var Oe=S(B,I),ot=Ke.S;ot!==null&&ot(de,Oe),lm(u,g,Oe)}catch(Gt){Ou(u,g,Gt)}finally{q!==null&&de.types!==null&&(q.types=de.types),Ke.T=q}}else try{q=S(B,I),lm(u,g,q)}catch(Gt){Ou(u,g,Gt)}}function lm(u,g,S){S!==null&&typeof S=="object"&&typeof S.then=="function"?S.then(function(I){Md(u,g,I)},function(I){return Ou(u,g,I)}):Md(u,g,S)}function Md(u,g,S){g.status="fulfilled",g.value=S,lp(g),u.state=S,g=u.pending,g!==null&&(S=g.next,S===g?u.pending=null:(S=S.next,g.next=S,Ye(u,S)))}function Ou(u,g,S){var I=u.pending;if(u.pending=null,I!==null){I=I.next;do g.status="rejected",g.reason=S,lp(g),g=g.next;while(g!==I)}u.action=null}function lp(u){u=u.listeners;for(var g=0;g<u.length;g++)(0,u[g])()}function cp(u,g){return g}function Id(u,g){if(Nr){var S=Qt.formState;if(S!==null){e:{var I=jt;if(Nr){if(hs){t:{for(var B=hs,q=el;B.nodeType!==8;){if(!q){B=null;break t}if(B=Mc(B.nextSibling),B===null){B=null;break t}}q=B.data,B=q==="F!"||q==="F"?B:null}if(B){hs=Mc(B.nextSibling),I=B.data==="F!";break e}}Vl(I)}I=!1}I&&(g=S[0])}}return S=aa(),S.memoizedState=S.baseState=g,I={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cp,lastRenderedState:g},S.queue=I,S=tu.bind(null,jt,I),I.dispatch=S,I=un(!1),q=Yh.bind(null,jt,!1,I.queue),I=aa(),B={state:g,dispatch:null,action:u,pending:null},I.queue=B,S=ss.bind(null,jt,B,q,S),B.dispatch=S,I.memoizedState=u,[g,S,!1]}function Dd(u){var g=$s();return cy(g,fs,u)}function cy(u,g,S){if(g=Du(u,g,cp)[0],u=Iu(ir)[0],typeof g=="object"&&g!==null&&typeof g.then=="function")try{var I=Cd(g)}catch(de){throw de===Td?tm:de}else I=g;g=$s();var B=g.queue,q=B.dispatch;return S!==g.memoizedState&&(jt.flags|=2048,jo(9,{destroy:void 0},uy.bind(null,B,S),null)),[I,q,u]}function uy(u,g){u.action=g}function Ig(u){var g=$s(),S=fs;if(S!==null)return cy(g,S,u);$s(),g=g.memoizedState,S=$s();var I=S.queue.dispatch;return S.memoizedState=u,[g,I,!1]}function jo(u,g,S,I){return u={tag:u,create:S,deps:I,inst:g,next:null},g=jt.updateQueue,g===null&&(g=Zh(),jt.updateQueue=g),S=g.lastEffect,S===null?g.lastEffect=u.next=u:(I=S.next,S.next=u,u.next=I,g.lastEffect=u),u}function cm(){return $s().memoizedState}function Xh(u,g,S,I){var B=aa();jt.flags|=u,B.memoizedState=jo(1|g,{destroy:void 0},S,I===void 0?null:I)}function up(u,g,S,I){var B=$s();I=I===void 0?null:I;var q=B.memoizedState.inst;fs!==null&&I!==null&&op(I,fs.memoizedState.deps)?B.memoizedState=jo(g,q,S,I):(jt.flags|=u,B.memoizedState=jo(1|g,q,S,I))}function dp(u,g){Xh(8390656,8,u,g)}function Pd(u,g){up(2048,8,u,g)}function Od(u){jt.flags|=4;var g=jt.updateQueue;if(g===null)g=Zh(),jt.updateQueue=g,g.events=[u];else{var S=g.events;S===null?g.events=[u]:S.push(u)}}function Dg(u){var g=$s().memoizedState;return Od({ref:g,nextImpl:u}),function(){if((Rt&2)!==0)throw Error(d(440));return g.impl.apply(void 0,arguments)}}function Pg(u,g){return up(4,2,u,g)}function dy(u,g){return up(4,4,u,g)}function Og(u,g){if(typeof g=="function"){u=u();var S=g(u);return function(){typeof S=="function"?S():g(null)}}if(g!=null)return u=u(),g.current=u,function(){g.current=null}}function hy(u,g,S){S=S!=null?S.concat([u]):null,up(4,4,Og.bind(null,g,u),S)}function Ao(){}function fy(u,g){var S=$s();g=g===void 0?null:g;var I=S.memoizedState;return g!==null&&op(g,I[1])?I[0]:(S.memoizedState=[u,g],u)}function Kh(u,g){var S=$s();g=g===void 0?null:g;var I=S.memoizedState;if(g!==null&&op(g,I[1]))return I[0];if(I=u(),Ln){lo(!0);try{u()}finally{lo(!1)}}return S.memoizedState=[I,g],I}function Ar(u,g,S){return S===void 0||(ka&1073741824)!==0&&(St&261930)===0?u.memoizedState=g:(u.memoizedState=S,u=Ba(),jt.lanes|=u,Vi|=u,S)}function xi(u,g,S,I){return No(S,g)?S:Ad.current!==null?(u=Ar(u,S,I),No(u,g)||(Js=!0),u):(ka&42)===0||(ka&1073741824)!==0&&(St&261930)===0?(Js=!0,u.memoizedState=S):(u=Ba(),jt.lanes|=u,Vi|=u,g)}function um(u,g,S,I,B){var q=ze.p;ze.p=q!==0&&8>q?q:8;var de=Ke.T,Oe={};Ke.T=Oe,Yh(u,!1,g,S);try{var ot=B(),Gt=Ke.S;if(Gt!==null&&Gt(Oe,ot),ot!==null&&typeof ot=="object"&&typeof ot.then=="function"){var mn=jh(ot,I);Gl(u,g,mn,ps(u))}else Gl(u,g,I,ps(u))}catch(xn){Gl(u,g,{then:function(){},status:"rejected",reason:xn},ps())}finally{ze.p=q,de!==null&&Oe.types!==null&&(de.types=Oe.types),Ke.T=de}}function ba(){}function eu(u,g,S,I){if(u.tag!==5)throw Error(d(476));var B=zd(u).queue;um(u,B,g,Fe,S===null?ba:function(){return Ac(u),S(I)})}function zd(u){var g=u.memoizedState;if(g!==null)return g;g={memoizedState:Fe,baseState:Fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ir,lastRenderedState:Fe},next:null};var S={};return g.next={memoizedState:S,baseState:S,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ir,lastRenderedState:S},next:null},u.memoizedState=g,u=u.alternate,u!==null&&(u.memoizedState=g),g}function Ac(u){var g=zd(u);g.next===null&&(g=u.alternate.memoizedState),Gl(u,g.next.queue,{},ps())}function hp(){return Us(l_)}function dm(){return $s().memoizedState}function fp(){return $s().memoizedState}function hm(u){for(var g=u.return;g!==null;){switch(g.tag){case 24:case 3:var S=ps();u=xc(S);var I=vc(g,u,S);I!==null&&(ns(I,g,S),Ru(I,g,S)),g={cache:Wf()},u.payload=g;return}g=g.return}}function il(u,g,S){var I=ps();S={lane:I,revertLane:0,gesture:null,action:S,hasEagerState:!1,eagerState:null,next:null},Ld(u)?Nd(g,S):(S=Vf(u,g,S,I),S!==null&&(ns(S,u,I),nu(S,g,I)))}function tu(u,g,S){var I=ps();Gl(u,g,S,I)}function Gl(u,g,S,I){var B={lane:I,revertLane:0,gesture:null,action:S,hasEagerState:!1,eagerState:null,next:null};if(Ld(u))Nd(g,B);else{var q=u.alternate;if(u.lanes===0&&(q===null||q.lanes===0)&&(q=g.lastRenderedReducer,q!==null))try{var de=g.lastRenderedState,Oe=q(de,S);if(B.hasEagerState=!0,B.eagerState=Oe,No(Oe,de))return qt(u,g,B,0),Qt===null&&gd(),!1}catch{}finally{}if(S=Vf(u,g,B,I),S!==null)return ns(S,u,I),nu(S,g,I),!0}return!1}function Yh(u,g,S,I){if(I={lane:2,revertLane:by(),gesture:null,action:I,hasEagerState:!1,eagerState:null,next:null},Ld(u)){if(g)throw Error(d(479))}else g=Vf(u,S,I,2),g!==null&&ns(g,u,2)}function Ld(u){var g=u.alternate;return u===jt||g!==null&&g===jt}function Nd(u,g){tl=$l=!0;var S=u.pending;S===null?g.next=g:(g.next=S.next,S.next=g),u.pending=g}function nu(u,g,S){if((S&4194048)!==0){var I=g.lanes;I&=u.pendingLanes,S|=I,g.lanes=S,qo(u,S)}}var kd={readContext:Us,use:Wh,useCallback:Ls,useContext:Ls,useEffect:Ls,useImperativeHandle:Ls,useLayoutEffect:Ls,useInsertionEffect:Ls,useMemo:Ls,useReducer:Ls,useRef:Ls,useState:Ls,useDebugValue:Ls,useDeferredValue:Ls,useTransition:Ls,useSyncExternalStore:Ls,useId:Ls,useHostTransitionStatus:Ls,useFormState:Ls,useActionState:Ls,useOptimistic:Ls,useMemoCache:Ls,useCacheRefresh:Ls};kd.useEffectEvent=Ls;var rl={readContext:Us,use:Wh,useCallback:function(u,g){return aa().memoizedState=[u,g===void 0?null:g],u},useContext:Us,useEffect:dp,useImperativeHandle:function(u,g,S){S=S!=null?S.concat([u]):null,Xh(4194308,4,Og.bind(null,g,u),S)},useLayoutEffect:function(u,g){return Xh(4194308,4,u,g)},useInsertionEffect:function(u,g){Xh(4,2,u,g)},useMemo:function(u,g){var S=aa();g=g===void 0?null:g;var I=u();if(Ln){lo(!0);try{u()}finally{lo(!1)}}return S.memoizedState=[I,g],I},useReducer:function(u,g,S){var I=aa();if(S!==void 0){var B=S(g);if(Ln){lo(!0);try{S(g)}finally{lo(!1)}}}else B=g;return I.memoizedState=I.baseState=B,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:B},I.queue=u,u=u.dispatch=il.bind(null,jt,u),[I.memoizedState,u]},useRef:function(u){var g=aa();return u={current:u},g.memoizedState=u},useState:function(u){u=un(u);var g=u.queue,S=tu.bind(null,jt,g);return g.dispatch=S,[u.memoizedState,S]},useDebugValue:Ao,useDeferredValue:function(u,g){var S=aa();return Ar(S,u,g)},useTransition:function(){var u=un(!1);return u=um.bind(null,jt,u.queue,!0,!1),aa().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,g,S){var I=jt,B=aa();if(Nr){if(S===void 0)throw Error(d(407));S=S()}else{if(S=g(),Qt===null)throw Error(d(349));(St&127)!==0||Ec(I,g,S)}B.memoizedState=S;var q={value:S,getSnapshot:g};return B.queue=q,dp(nl.bind(null,I,q,u),[u]),I.flags|=2048,jo(9,{destroy:void 0},am.bind(null,I,q,S,g),null),S},useId:function(){var u=aa(),g=Qt.identifierPrefix;if(Nr){var S=Fl,I=fc;S=(I&~(1<<32-Os(I)-1)).toString(32)+S,g="_"+g+"R_"+S,S=Hh++,0<S&&(g+="H"+S.toString(32)),g+="_"}else S=rm++,g="_"+g+"r_"+S.toString(32)+"_";return u.memoizedState=g},useHostTransitionStatus:hp,useFormState:Id,useActionState:Id,useOptimistic:function(u){var g=aa();g.memoizedState=g.baseState=u;var S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return g.queue=S,g=Yh.bind(null,jt,!0,S),S.dispatch=g,[u,g]},useMemoCache:la,useCacheRefresh:function(){return aa().memoizedState=hm.bind(null,jt)},useEffectEvent:function(u){var g=aa(),S={impl:u};return g.memoizedState=S,function(){if((Rt&2)!==0)throw Error(d(440));return S.impl.apply(void 0,arguments)}}},pp={readContext:Us,use:Wh,useCallback:fy,useContext:Us,useEffect:Pd,useImperativeHandle:hy,useInsertionEffect:Pg,useLayoutEffect:dy,useMemo:Kh,useReducer:Iu,useRef:cm,useState:function(){return Iu(ir)},useDebugValue:Ao,useDeferredValue:function(u,g){var S=$s();return xi(S,fs.memoizedState,u,g)},useTransition:function(){var u=Iu(ir)[0],g=$s().memoizedState;return[typeof u=="boolean"?u:Cd(u),g]},useSyncExternalStore:Mg,useId:dm,useHostTransitionStatus:hp,useFormState:Dd,useActionState:Dd,useOptimistic:function(u,g){var S=$s();return Rd(S,fs,u,g)},useMemoCache:la,useCacheRefresh:fp};pp.useEffectEvent=Dg;var mp={readContext:Us,use:Wh,useCallback:fy,useContext:Us,useEffect:Pd,useImperativeHandle:hy,useInsertionEffect:Pg,useLayoutEffect:dy,useMemo:Kh,useReducer:om,useRef:cm,useState:function(){return om(ir)},useDebugValue:Ao,useDeferredValue:function(u,g){var S=$s();return fs===null?Ar(S,u,g):xi(S,fs.memoizedState,u,g)},useTransition:function(){var u=om(ir)[0],g=$s().memoizedState;return[typeof u=="boolean"?u:Cd(u),g]},useSyncExternalStore:Mg,useId:dm,useHostTransitionStatus:hp,useFormState:Ig,useActionState:Ig,useOptimistic:function(u,g){var S=$s();return fs!==null?Rd(S,fs,u,g):(S.baseState=u,[u,S.queue.dispatch])},useMemoCache:la,useCacheRefresh:fp};mp.useEffectEvent=Dg;function zu(u,g,S,I){g=u.memoizedState,S=S(I,g),S=S==null?g:H({},g,S),u.memoizedState=S,u.lanes===0&&(u.updateQueue.baseState=S)}var Lu={enqueueSetState:function(u,g,S){u=u._reactInternals;var I=ps(),B=xc(I);B.payload=g,S!=null&&(B.callback=S),g=vc(u,B,I),g!==null&&(ns(g,u,I),Ru(g,u,I))},enqueueReplaceState:function(u,g,S){u=u._reactInternals;var I=ps(),B=xc(I);B.tag=1,B.payload=g,S!=null&&(B.callback=S),g=vc(u,B,I),g!==null&&(ns(g,u,I),Ru(g,u,I))},enqueueForceUpdate:function(u,g){u=u._reactInternals;var S=ps(),I=xc(S);I.tag=2,g!=null&&(I.callback=g),g=vc(u,I,S),g!==null&&(ns(g,u,S),Ru(g,u,S))}};function kr(u,g,S,I,B,q,de){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(I,q,de):g.prototype&&g.prototype.isPureReactComponent?!Qa(S,I)||!Qa(B,q):!0}function jd(u,g,S,I){u=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(S,I),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(S,I),g.state!==u&&Lu.enqueueReplaceState(g,g.state,null)}function iu(u,g){var S=g;if("ref"in g){S={};for(var I in g)I!=="ref"&&(S[I]=g[I])}if(u=u.defaultProps){S===g&&(S=H({},S));for(var B in u)S[B]===void 0&&(S[B]=u[B])}return S}function fm(u){Gc(u)}function Nu(u){console.error(u)}function pm(u){Gc(u)}function ku(u,g){try{var S=u.onUncaughtError;S(g.value,{componentStack:g.stack})}catch(I){setTimeout(function(){throw I})}}function mm(u,g,S){try{var I=u.onCaughtError;I(S.value,{componentStack:S.stack,errorBoundary:g.tag===1?g.stateNode:null})}catch(B){setTimeout(function(){throw B})}}function Cc(u,g,S){return S=xc(S),S.tag=3,S.payload={element:null},S.callback=function(){ku(u,g)},S}function gm(u){return u=xc(u),u.tag=3,u}function gp(u,g,S,I){var B=S.type.getDerivedStateFromError;if(typeof B=="function"){var q=I.value;u.payload=function(){return B(q)},u.callback=function(){mm(g,S,I)}}var de=S.stateNode;de!==null&&typeof de.componentDidCatch=="function"&&(u.callback=function(){mm(g,S,I),typeof B!="function"&&(Ii===null?Ii=new Set([this]):Ii.add(this));var Oe=I.stack;this.componentDidCatch(I.value,{componentStack:Oe!==null?Oe:""})})}function _m(u,g,S,I,B){if(S.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){if(g=S.alternate,g!==null&&wu(g,S,B,!0),S=Ko.current,S!==null){switch(S.tag){case 31:case 13:return Eo===null?El():S.alternate===null&&Jn===0&&(Jn=3),S.flags&=-257,S.flags|=65536,S.lanes=B,I===nm?S.flags|=16384:(g=S.updateQueue,g===null?S.updateQueue=new Set([I]):g.add(I),yy(u,I,B)),!1;case 22:return S.flags|=65536,I===nm?S.flags|=16384:(g=S.updateQueue,g===null?(g={transitions:null,markerInstances:null,retryQueue:new Set([I])},S.updateQueue=g):(S=g.retryQueue,S===null?g.retryQueue=new Set([I]):S.add(I)),yy(u,I,B)),!1}throw Error(d(435,S.tag))}return yy(u,I,B),El(),!1}if(Nr)return g=Ko.current,g!==null?((g.flags&65536)===0&&(g.flags|=256),g.flags|=65536,g.lanes=B,I!==vu&&(u=Error(d(422),{cause:I}),Nh(Na(u,S)))):(I!==vu&&(g=Error(d(423),{cause:I}),Nh(Na(g,S))),u=u.current.alternate,u.flags|=65536,B&=-B,u.lanes|=B,I=Na(I,S),B=Cc(u.stateNode,I,B),Uh(u,B),Jn!==4&&(Jn=2)),!1;var q=Error(d(520),{cause:I});if(q=Na(q,S),Ai===null?Ai=[q]:Ai.push(q),Jn!==4&&(Jn=2),g===null)return!0;I=Na(I,S),S=g;do{switch(S.tag){case 3:return S.flags|=65536,u=B&-B,S.lanes|=u,u=Cc(S.stateNode,I,u),Uh(S,u),!1;case 1:if(g=S.type,q=S.stateNode,(S.flags&128)===0&&(typeof g.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Ii===null||!Ii.has(q))))return S.flags|=65536,B&=-B,S.lanes|=B,B=gm(B),gp(B,u,S,I),Uh(S,B),!1}S=S.return}while(S!==null);return!1}var ju=Error(d(461)),Js=!1;function fo(u,g,S,I){g.child=u===null?Cu(g,null,S,I):yc(g,u.child,S,I)}function ym(u,g,S,I,B){S=S.render;var q=g.ref;if("ref"in I){var de={};for(var Oe in I)Oe!=="ref"&&(de[Oe]=I[Oe])}else de=I;return gc(g),I=sm(u,g,S,de,q,B),Oe=ap(),u!==null&&!Js?(ko(u,g,B),Sl(u,g,B)):(Nr&&Oe&&Gf(g),g.flags|=1,fo(u,g,I,B),g.child)}function zg(u,g,S,I,B){if(u===null){var q=S.type;return typeof q=="function"&&!La(q)&&q.defaultProps===void 0&&S.compare===null?(g.tag=15,g.type=q,_p(u,g,q,I,B)):(u=Zp(S.type,null,I,g,g.mode,B),u.ref=g.ref,u.return=g,g.child=u)}if(q=u.child,!Fa(u,B)){var de=q.memoizedProps;if(S=S.compare,S=S!==null?S:Qa,S(de,I)&&u.ref===g.ref)return Sl(u,g,B)}return g.flags|=1,u=mi(q,I),u.ref=g.ref,u.return=g,g.child=u}function _p(u,g,S,I,B){if(u!==null){var q=u.memoizedProps;if(Qa(q,I)&&u.ref===g.ref)if(Js=!1,g.pendingProps=I=q,Fa(u,B))(u.flags&131072)!==0&&(Js=!0);else return g.lanes=u.lanes,Sl(u,g,B)}return vm(u,g,S,I,B)}function Qh(u,g,S,I){var B=I.children,q=u!==null?u.memoizedState:null;if(u===null&&g.stateNode===null&&(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),I.mode==="hidden"){if((g.flags&128)!==0){if(q=q!==null?q.baseLanes|S:S,u!==null){for(I=g.child=u.child,B=0;I!==null;)B=B|I.lanes|I.childLanes,I=I.sibling;I=B&~q}else I=0,g.child=null;return Lg(u,g,q,S,I)}if((S&536870912)!==0)g.memoizedState={baseLanes:0,cachePool:null},u!==null&&Jf(g,q!==null?q.cachePool:null),q!==null?rp(g,q):$h(),sp(g);else return I=g.lanes=536870912,Lg(u,g,q!==null?q.baseLanes|S:S,S,I)}else q!==null?(Jf(g,q.cachePool),rp(g,q),wl(),g.memoizedState=null):(u!==null&&Jf(g,null),$h(),wl());return fo(u,g,B,S),g.child}function Fd(u,g){return u!==null&&u.tag===22||g.stateNode!==null||(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.sibling}function Lg(u,g,S,I,B){var q=Jp();return q=q===null?null:{parent:ts._currentValue,pool:q},g.memoizedState={baseLanes:S,cachePool:q},u!==null&&Jf(g,null),$h(),sp(g),u!==null&&wu(u,g,I,!0),g.childLanes=B,null}function Jh(u,g){return g=bm({mode:g.mode,children:g.children},u.mode),g.ref=u.ref,u.child=g,g.return=u,g}function Ng(u,g,S){return yc(g,u.child,null,S),u=Jh(g,g.pendingProps),u.flags|=2,oa(g),g.memoizedState=null,u}function xm(u,g,S){var I=g.pendingProps,B=(g.flags&128)!==0;if(g.flags&=-129,u===null){if(Nr){if(I.mode==="hidden")return u=Jh(g,I),g.lanes=536870912,Fd(null,u);if(Gh(g),(u=hs)?(u=Cy(u,el),u=u!==null&&u.data==="&"?u:null,u!==null&&(g.memoizedState={dehydrated:u,treeContext:jl!==null?{id:fc,overflow:Fl}:null,retryLane:536870912,hydrationErrors:null},S=ry(u),S.return=g,g.child=S,ro=g,hs=null)):u=null,u===null)throw Vl(g);return g.lanes=536870912,null}return Jh(g,I)}var q=u.memoizedState;if(q!==null){var de=q.dehydrated;if(Gh(g),B)if(g.flags&256)g.flags&=-257,g=Ng(u,g,S);else if(g.memoizedState!==null)g.child=u.child,g.flags|=128,g=null;else throw Error(d(558));else if(Js||wu(u,g,S,!1),B=(S&u.childLanes)!==0,Js||B){if(I=Qt,I!==null&&(de=fi(I,S),de!==0&&de!==q.retryLane))throw q.retryLane=de,gl(u,de),ns(I,u,de),ju;El(),g=Ng(u,g,S)}else u=q.treeContext,hs=Mc(de.nextSibling),ro=g,Nr=!0,pc=null,el=!1,u!==null&&vd(g,u),g=Jh(g,I),g.flags|=4096;return g}return u=mi(u.child,{mode:I.mode,children:I.children}),u.ref=g.ref,g.child=u,u.return=g,u}function yp(u,g){var S=g.ref;if(S===null)u!==null&&u.ref!==null&&(g.flags|=4194816);else{if(typeof S!="function"&&typeof S!="object")throw Error(d(284));(u===null||u.ref!==S)&&(g.flags|=4194816)}}function vm(u,g,S,I,B){return gc(g),S=sm(u,g,S,I,void 0,B),I=ap(),u!==null&&!Js?(ko(u,g,B),Sl(u,g,B)):(Nr&&I&&Gf(g),g.flags|=1,fo(u,g,S,B),g.child)}function kg(u,g,S,I,B,q){return gc(g),g.updateQueue=null,S=ly(g,I,S,B),ay(u),I=ap(),u!==null&&!Js?(ko(u,g,q),Sl(u,g,q)):(Nr&&I&&Gf(g),g.flags|=1,fo(u,g,S,q),g.child)}function jg(u,g,S,I,B){if(gc(g),g.stateNode===null){var q=dc,de=S.contextType;typeof de=="object"&&de!==null&&(q=Us(de)),q=new S(I,q),g.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=Lu,g.stateNode=q,q._reactInternals=g,q=g.stateNode,q.props=I,q.state=g.memoizedState,q.refs={},np(g),de=S.contextType,q.context=typeof de=="object"&&de!==null?Us(de):dc,q.state=g.memoizedState,de=S.getDerivedStateFromProps,typeof de=="function"&&(zu(g,S,de,I),q.state=g.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(de=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),de!==q.state&&Lu.enqueueReplaceState(q,q.state,null),bc(g,I,q,B),Mu(),q.state=g.memoizedState),typeof q.componentDidMount=="function"&&(g.flags|=4194308),I=!0}else if(u===null){q=g.stateNode;var Oe=g.memoizedProps,ot=iu(S,Oe);q.props=ot;var Gt=q.context,mn=S.contextType;de=dc,typeof mn=="object"&&mn!==null&&(de=Us(mn));var xn=S.getDerivedStateFromProps;mn=typeof xn=="function"||typeof q.getSnapshotBeforeUpdate=="function",Oe=g.pendingProps!==Oe,mn||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(Oe||Gt!==de)&&jd(g,q,I,de),va=!1;var Wt=g.memoizedState;q.state=Wt,bc(g,I,q,B),Mu(),Gt=g.memoizedState,Oe||Wt!==Gt||va?(typeof xn=="function"&&(zu(g,S,xn,I),Gt=g.memoizedState),(ot=va||kr(g,S,ot,I,Wt,Gt,de))?(mn||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(g.flags|=4194308)):(typeof q.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=I,g.memoizedState=Gt),q.props=I,q.state=Gt,q.context=de,I=ot):(typeof q.componentDidMount=="function"&&(g.flags|=4194308),I=!1)}else{q=g.stateNode,Vh(u,g),de=g.memoizedProps,mn=iu(S,de),q.props=mn,xn=g.pendingProps,Wt=q.context,Gt=S.contextType,ot=dc,typeof Gt=="object"&&Gt!==null&&(ot=Us(Gt)),Oe=S.getDerivedStateFromProps,(Gt=typeof Oe=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(de!==xn||Wt!==ot)&&jd(g,q,I,ot),va=!1,Wt=g.memoizedState,q.state=Wt,bc(g,I,q,B),Mu();var tn=g.memoizedState;de!==xn||Wt!==tn||va||u!==null&&u.dependencies!==null&&bd(u.dependencies)?(typeof Oe=="function"&&(zu(g,S,Oe,I),tn=g.memoizedState),(mn=va||kr(g,S,mn,I,Wt,tn,ot)||u!==null&&u.dependencies!==null&&bd(u.dependencies))?(Gt||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(I,tn,ot),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(I,tn,ot)),typeof q.componentDidUpdate=="function"&&(g.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof q.componentDidUpdate!="function"||de===u.memoizedProps&&Wt===u.memoizedState||(g.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||de===u.memoizedProps&&Wt===u.memoizedState||(g.flags|=1024),g.memoizedProps=I,g.memoizedState=tn),q.props=I,q.state=tn,q.context=ot,I=mn):(typeof q.componentDidUpdate!="function"||de===u.memoizedProps&&Wt===u.memoizedState||(g.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||de===u.memoizedProps&&Wt===u.memoizedState||(g.flags|=1024),I=!1)}return q=I,yp(u,g),I=(g.flags&128)!==0,q||I?(q=g.stateNode,S=I&&typeof S.getDerivedStateFromError!="function"?null:q.render(),g.flags|=1,u!==null&&I?(g.child=yc(g,u.child,null,B),g.child=yc(g,null,S,B)):fo(u,g,S,B),g.memoizedState=q.state,u=g.child):u=Sl(u,g,B),u}function Fg(u,g,S,I){return Ul(),g.flags|=256,fo(u,g,S,I),g.child}var Bg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vg(u){return{baseLanes:u,cachePool:Sd()}}function Br(u,g,S){return u=u!==null?u.childLanes&~S:0,g&&(u|=Xn),u}function Ug(u,g,S){var I=g.pendingProps,B=!1,q=(g.flags&128)!==0,de;if((de=q)||(de=u!==null&&u.memoizedState===null?!1:(Qs.current&2)!==0),de&&(B=!0,g.flags&=-129),de=(g.flags&32)!==0,g.flags&=-33,u===null){if(Nr){if(B?wc(g):wl(),(u=hs)?(u=Cy(u,el),u=u!==null&&u.data!=="&"?u:null,u!==null&&(g.memoizedState={dehydrated:u,treeContext:jl!==null?{id:fc,overflow:Fl}:null,retryLane:536870912,hydrationErrors:null},S=ry(u),S.return=g,g.child=S,ro=g,hs=null)):u=null,u===null)throw Vl(g);return Ry(u)?g.lanes=32:g.lanes=536870912,null}var Oe=I.children;return I=I.fallback,B?(wl(),B=g.mode,Oe=bm({mode:"hidden",children:Oe},B),I=xd(I,B,S,null),Oe.return=g,I.return=g,Oe.sibling=I,g.child=Oe,I=g.child,I.memoizedState=Vg(S),I.childLanes=Br(u,de,S),g.memoizedState=Bg,Fd(null,I)):(wc(g),$g(g,Oe))}var ot=u.memoizedState;if(ot!==null&&(Oe=ot.dehydrated,Oe!==null)){if(q)g.flags&256?(wc(g),g.flags&=-257,g=Gg(u,g,S)):g.memoizedState!==null?(wl(),g.child=u.child,g.flags|=128,g=null):(wl(),Oe=I.fallback,B=g.mode,I=bm({mode:"visible",children:I.children},B),Oe=xd(Oe,B,S,null),Oe.flags|=2,I.return=g,Oe.return=g,I.sibling=Oe,g.child=I,yc(g,u.child,null,S),I=g.child,I.memoizedState=Vg(S),I.childLanes=Br(u,de,S),g.memoizedState=Bg,g=Fd(null,I));else if(wc(g),Ry(Oe)){if(de=Oe.nextSibling&&Oe.nextSibling.dataset,de)var Gt=de.dgst;de=Gt,I=Error(d(419)),I.stack="",I.digest=de,Nh({value:I,source:null,stack:null}),g=Gg(u,g,S)}else if(Js||wu(u,g,S,!1),de=(S&u.childLanes)!==0,Js||de){if(de=Qt,de!==null&&(I=fi(de,S),I!==0&&I!==ot.retryLane))throw ot.retryLane=I,gl(u,I),ns(de,u,I),ju;i_(Oe)||El(),g=Gg(u,g,S)}else i_(Oe)?(g.flags|=192,g.child=u.child,g=null):(u=ot.treeContext,hs=Mc(Oe.nextSibling),ro=g,Nr=!0,pc=null,el=!1,u!==null&&vd(g,u),g=$g(g,I.children),g.flags|=4096);return g}return B?(wl(),Oe=I.fallback,B=g.mode,ot=u.child,Gt=ot.sibling,I=mi(ot,{mode:"hidden",children:I.children}),I.subtreeFlags=ot.subtreeFlags&65011712,Gt!==null?Oe=mi(Gt,Oe):(Oe=xd(Oe,B,S,null),Oe.flags|=2),Oe.return=g,I.return=g,I.sibling=Oe,g.child=I,Fd(null,I),I=g.child,Oe=u.child.memoizedState,Oe===null?Oe=Vg(S):(B=Oe.cachePool,B!==null?(ot=ts._currentValue,B=B.parent!==ot?{parent:ot,pool:ot}:B):B=Sd(),Oe={baseLanes:Oe.baseLanes|S,cachePool:B}),I.memoizedState=Oe,I.childLanes=Br(u,de,S),g.memoizedState=Bg,Fd(u.child,I)):(wc(g),S=u.child,u=S.sibling,S=mi(S,{mode:"visible",children:I.children}),S.return=g,S.sibling=null,u!==null&&(de=g.deletions,de===null?(g.deletions=[u],g.flags|=16):de.push(u)),g.child=S,g.memoizedState=null,S)}function $g(u,g){return g=bm({mode:"visible",children:g},u.mode),g.return=u,u.child=g}function bm(u,g){return u=sa(22,u,null,g),u.lanes=0,u}function Gg(u,g,S){return yc(g,u.child,null,S),u=$g(g,g.pendingProps.children),u.flags|=2,g.memoizedState=null,u}function ef(u,g,S){u.lanes|=g;var I=u.alternate;I!==null&&(I.lanes|=g),Ag(u.return,g,S)}function Bd(u,g,S,I,B,q){var de=u.memoizedState;de===null?u.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:I,tail:S,tailMode:B,treeForkCount:q}:(de.isBackwards=g,de.rendering=null,de.renderingStartTime=0,de.last=I,de.tail=S,de.tailMode=B,de.treeForkCount=q)}function wm(u,g,S){var I=g.pendingProps,B=I.revealOrder,q=I.tail;I=I.children;var de=Qs.current,Oe=(de&2)!==0;if(Oe?(de=de&1|2,g.flags|=128):de&=1,vt(Qs,de),fo(u,g,I,S),I=Nr?Uf:0,!Oe&&u!==null&&(u.flags&128)!==0)e:for(u=g.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&ef(u,S,g);else if(u.tag===19)ef(u,S,g);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===g)break e;for(;u.sibling===null;){if(u.return===null||u.return===g)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(B){case"forwards":for(S=g.child,B=null;S!==null;)u=S.alternate,u!==null&&Sc(u)===null&&(B=S),S=S.sibling;S=B,S===null?(B=g.child,g.child=null):(B=S.sibling,S.sibling=null),Bd(g,!1,B,S,q,I);break;case"backwards":case"unstable_legacy-backwards":for(S=null,B=g.child,g.child=null;B!==null;){if(u=B.alternate,u!==null&&Sc(u)===null){g.child=B;break}u=B.sibling,B.sibling=S,S=B,B=u}Bd(g,!0,S,null,q,I);break;case"together":Bd(g,!1,null,null,void 0,I);break;default:g.memoizedState=null}return g.child}function Sl(u,g,S){if(u!==null&&(g.dependencies=u.dependencies),Vi|=g.lanes,(S&g.childLanes)===0)if(u!==null){if(wu(u,g,S,!1),(S&g.childLanes)===0)return null}else return null;if(u!==null&&g.child!==u.child)throw Error(d(153));if(g.child!==null){for(u=g.child,S=mi(u,u.pendingProps),g.child=S,S.return=g;u.sibling!==null;)u=u.sibling,S=S.sibling=mi(u,u.pendingProps),S.return=g;S.sibling=null}return g.child}function Fa(u,g){return(u.lanes&g)!==0?!0:(u=u.dependencies,!!(u!==null&&bd(u)))}function Sm(u,g,S){switch(g.tag){case 3:On(g,g.stateNode.containerInfo),bu(g,ts,u.memoizedState.cache),Ul();break;case 27:case 5:In(g);break;case 4:On(g,g.stateNode.containerInfo);break;case 10:bu(g,g.type,g.memoizedProps.value);break;case 31:if(g.memoizedState!==null)return g.flags|=128,Gh(g),null;break;case 13:var I=g.memoizedState;if(I!==null)return I.dehydrated!==null?(wc(g),g.flags|=128,null):(S&g.child.childLanes)!==0?Ug(u,g,S):(wc(g),u=Sl(u,g,S),u!==null?u.sibling:null);wc(g);break;case 19:var B=(u.flags&128)!==0;if(I=(S&g.childLanes)!==0,I||(wu(u,g,S,!1),I=(S&g.childLanes)!==0),B){if(I)return wm(u,g,S);g.flags|=128}if(B=g.memoizedState,B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),vt(Qs,Qs.current),I)break;return null;case 22:return g.lanes=0,Qh(u,g,S,g.pendingProps);case 24:bu(g,ts,u.memoizedState.cache)}return Sl(u,g,S)}function Ss(u,g,S){if(u!==null)if(u.memoizedProps!==g.pendingProps)Js=!0;else{if(!Fa(u,S)&&(g.flags&128)===0)return Js=!1,Sm(u,g,S);Js=(u.flags&131072)!==0}else Js=!1,Nr&&(g.flags&1048576)!==0&&$f(g,Uf,g.index);switch(g.lanes=0,g.tag){case 16:e:{var I=g.pendingProps;if(u=Kc(g.elementType),g.type=u,typeof u=="function")La(u)?(I=iu(u,I),g.tag=1,g=jg(null,g,u,I,S)):(g.tag=0,g=vm(null,g,u,I,S));else{if(u!=null){var B=u.$$typeof;if(B===Re){g.tag=11,g=ym(null,g,u,I,S);break e}else if(B===Le){g.tag=14,g=zg(null,g,u,I,S);break e}}throw g=ut(u)||u,Error(d(306,g,""))}}return g;case 0:return vm(u,g,g.type,g.pendingProps,S);case 1:return I=g.type,B=iu(I,g.pendingProps),jg(u,g,I,B,S);case 3:e:{if(On(g,g.stateNode.containerInfo),u===null)throw Error(d(387));I=g.pendingProps;var q=g.memoizedState;B=q.element,Vh(u,g),bc(g,I,null,S);var de=g.memoizedState;if(I=de.cache,bu(g,ts,I),I!==q.cache&&qf(g,[ts],S,!0),Mu(),I=de.element,q.isDehydrated)if(q={element:I,isDehydrated:!1,cache:de.cache},g.updateQueue.baseState=q,g.memoizedState=q,g.flags&256){g=Fg(u,g,I,S);break e}else if(I!==B){B=Na(Error(d(424)),g),Nh(B),g=Fg(u,g,I,S);break e}else{switch(u=g.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(hs=Mc(u.firstChild),ro=g,Nr=!0,pc=null,el=!0,S=Cu(g,null,I,S),g.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling}else{if(Ul(),I===B){g=Sl(u,g,S);break e}fo(u,g,I,S)}g=g.child}return g;case 26:return yp(u,g),u===null?(S=Mb(g.type,null,g.pendingProps,null))?g.memoizedState=S:Nr||(S=g.type,u=g.pendingProps,I=Ty(Nn.current).createElement(S),I[se]=g,I[ve]=u,Sa(I,S,u),Tn(I),g.stateNode=I):g.memoizedState=Mb(g.type,u.memoizedProps,g.pendingProps,u.memoizedState),null;case 27:return In(g),u===null&&Nr&&(I=g.stateNode=mv(g.type,g.pendingProps,Nn.current),ro=g,el=!0,B=hs,Hd(g.type)?(Ta=B,hs=Mc(I.firstChild)):hs=B),fo(u,g,g.pendingProps.children,S),yp(u,g),u===null&&(g.flags|=4194304),g.child;case 5:return u===null&&Nr&&((B=I=hs)&&(I=PS(I,g.type,g.pendingProps,el),I!==null?(g.stateNode=I,ro=g,hs=Mc(I.firstChild),el=!1,B=!0):B=!1),B||Vl(g)),In(g),B=g.type,q=g.pendingProps,de=u!==null?u.memoizedProps:null,I=q.children,dv(B,q)?I=null:de!==null&&dv(B,de)&&(g.flags|=32),g.memoizedState!==null&&(B=sm(u,g,ja,null,null,S),l_._currentValue=B),yp(u,g),fo(u,g,I,S),g.child;case 6:return u===null&&Nr&&((u=S=hs)&&(S=Tb(S,g.pendingProps,el),S!==null?(g.stateNode=S,ro=g,hs=null,u=!0):u=!1),u||Vl(g)),null;case 13:return Ug(u,g,S);case 4:return On(g,g.stateNode.containerInfo),I=g.pendingProps,u===null?g.child=yc(g,null,I,S):fo(u,g,I,S),g.child;case 11:return ym(u,g,g.type,g.pendingProps,S);case 7:return fo(u,g,g.pendingProps,S),g.child;case 8:return fo(u,g,g.pendingProps.children,S),g.child;case 12:return fo(u,g,g.pendingProps.children,S),g.child;case 10:return I=g.pendingProps,bu(g,g.type,I.value),fo(u,g,I.children,S),g.child;case 9:return B=g.type._context,I=g.pendingProps.children,gc(g),B=Us(B),I=I(B),g.flags|=1,fo(u,g,I,S),g.child;case 14:return zg(u,g,g.type,g.pendingProps,S);case 15:return _p(u,g,g.type,g.pendingProps,S);case 19:return wm(u,g,S);case 31:return xm(u,g,S);case 22:return Qh(u,g,S,g.pendingProps);case 24:return gc(g),I=Us(ts),u===null?(B=Jp(),B===null&&(B=Qt,q=Wf(),B.pooledCache=q,q.refCount++,q!==null&&(B.pooledCacheLanes|=S),B=q),g.memoizedState={parent:I,cache:B},np(g),bu(g,ts,B)):((u.lanes&S)!==0&&(Vh(u,g),bc(g,null,null,S),Mu()),B=u.memoizedState,q=g.memoizedState,B.parent!==I?(B={parent:I,cache:I},g.memoizedState=B,g.lanes===0&&(g.memoizedState=g.updateQueue.baseState=B),bu(g,ts,I)):(I=q.cache,bu(g,ts,I),I!==B.cache&&qf(g,[ts],S,!0))),fo(u,g,g.pendingProps.children,S),g.child;case 29:throw g.pendingProps}throw Error(d(156,g.tag))}function Fo(u){u.flags|=4}function Fu(u,g,S,I,B){if((g=(u.mode&32)!==0)&&(g=!1),g){if(u.flags|=16777216,(B&335544128)===B)if(u.stateNode.complete)u.flags|=8192;else if(Jr())u.flags|=8192;else throw Yc=nm,em}else u.flags&=-16777217}function tf(u,g){if(g.type!=="stylesheet"||(g.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!Dy(g))if(Jr())u.flags|=8192;else throw Yc=nm,em}function nf(u,g){g!==null&&(u.flags|=4),u.flags&16384&&(g=u.tag!==22?Po():536870912,u.lanes|=g,Ui|=g)}function rf(u,g){if(!Nr)switch(u.tailMode){case"hidden":g=u.tail;for(var S=null;g!==null;)g.alternate!==null&&(S=g),g=g.sibling;S===null?u.tail=null:S.sibling=null;break;case"collapsed":S=u.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?g||u.tail===null?u.tail=null:u.tail.sibling=null:I.sibling=null}}function _s(u){var g=u.alternate!==null&&u.alternate.child===u.child,S=0,I=0;if(g)for(var B=u.child;B!==null;)S|=B.lanes|B.childLanes,I|=B.subtreeFlags&65011712,I|=B.flags&65011712,B.return=u,B=B.sibling;else for(B=u.child;B!==null;)S|=B.lanes|B.childLanes,I|=B.subtreeFlags,I|=B.flags,B.return=u,B=B.sibling;return u.subtreeFlags|=I,u.childLanes=S,g}function Qx(u,g,S){var I=g.pendingProps;switch(qc(g),g.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _s(g),null;case 1:return _s(g),null;case 3:return S=g.stateNode,I=null,u!==null&&(I=u.memoizedState.cache),g.memoizedState.cache!==I&&(g.flags|=2048),mc(ts),An(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(u===null||u.child===null)&&(Zc(g)?Fo(g):u===null||u.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Kp())),_s(g),null;case 26:var B=g.type,q=g.memoizedState;return u===null?(Fo(g),q!==null?(_s(g),tf(g,q)):(_s(g),Fu(g,B,null,I,S))):q?q!==u.memoizedState?(Fo(g),_s(g),tf(g,q)):(_s(g),g.flags&=-16777217):(u=u.memoizedProps,u!==I&&Fo(g),_s(g),Fu(g,B,u,I,S)),null;case 27:if(gi(g),S=Nn.current,B=g.type,u!==null&&g.stateNode!=null)u.memoizedProps!==I&&Fo(g);else{if(!I){if(g.stateNode===null)throw Error(d(166));return _s(g),null}u=Kt.current,Zc(g)?Hf(g):(u=mv(B,I,S),g.stateNode=u,Fo(g))}return _s(g),null;case 5:if(gi(g),B=g.type,u!==null&&g.stateNode!=null)u.memoizedProps!==I&&Fo(g);else{if(!I){if(g.stateNode===null)throw Error(d(166));return _s(g),null}if(q=Kt.current,Zc(g))Hf(g);else{var de=Ty(Nn.current);switch(q){case 1:q=de.createElementNS("http://www.w3.org/2000/svg",B);break;case 2:q=de.createElementNS("http://www.w3.org/1998/Math/MathML",B);break;default:switch(B){case"svg":q=de.createElementNS("http://www.w3.org/2000/svg",B);break;case"math":q=de.createElementNS("http://www.w3.org/1998/Math/MathML",B);break;case"script":q=de.createElement("div"),q.innerHTML="<script><\/script>",q=q.removeChild(q.firstChild);break;case"select":q=typeof I.is=="string"?de.createElement("select",{is:I.is}):de.createElement("select"),I.multiple?q.multiple=!0:I.size&&(q.size=I.size);break;default:q=typeof I.is=="string"?de.createElement(B,{is:I.is}):de.createElement(B)}}q[se]=g,q[ve]=I;e:for(de=g.child;de!==null;){if(de.tag===5||de.tag===6)q.appendChild(de.stateNode);else if(de.tag!==4&&de.tag!==27&&de.child!==null){de.child.return=de,de=de.child;continue}if(de===g)break e;for(;de.sibling===null;){if(de.return===null||de.return===g)break e;de=de.return}de.sibling.return=de.return,de=de.sibling}g.stateNode=q;e:switch(Sa(q,B,I),B){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}I&&Fo(g)}}return _s(g),Fu(g,g.type,u===null?null:u.memoizedProps,g.pendingProps,S),null;case 6:if(u&&g.stateNode!=null)u.memoizedProps!==I&&Fo(g);else{if(typeof I!="string"&&g.stateNode===null)throw Error(d(166));if(u=Nn.current,Zc(g)){if(u=g.stateNode,S=g.memoizedProps,I=null,B=ro,B!==null)switch(B.tag){case 27:case 5:I=B.memoizedProps}u[se]=g,u=!!(u.nodeValue===S||I!==null&&I.suppressHydrationWarning===!0||Im(u.nodeValue,S)),u||Vl(g,!0)}else u=Ty(u).createTextNode(I),u[se]=g,g.stateNode=u}return _s(g),null;case 31:if(S=g.memoizedState,u===null||u.memoizedState!==null){if(I=Zc(g),S!==null){if(u===null){if(!I)throw Error(d(318));if(u=g.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(d(557));u[se]=g}else Ul(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;_s(g),u=!1}else S=Kp(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=S),u=!0;if(!u)return g.flags&256?(oa(g),g):(oa(g),null);if((g.flags&128)!==0)throw Error(d(558))}return _s(g),null;case 13:if(I=g.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(B=Zc(g),I!==null&&I.dehydrated!==null){if(u===null){if(!B)throw Error(d(318));if(B=g.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(d(317));B[se]=g}else Ul(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;_s(g),B=!1}else B=Kp(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=B),B=!0;if(!B)return g.flags&256?(oa(g),g):(oa(g),null)}return oa(g),(g.flags&128)!==0?(g.lanes=S,g):(S=I!==null,u=u!==null&&u.memoizedState!==null,S&&(I=g.child,B=null,I.alternate!==null&&I.alternate.memoizedState!==null&&I.alternate.memoizedState.cachePool!==null&&(B=I.alternate.memoizedState.cachePool.pool),q=null,I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(q=I.memoizedState.cachePool.pool),q!==B&&(I.flags|=2048)),S!==u&&S&&(g.child.flags|=8192),nf(g,g.updateQueue),_s(g),null);case 4:return An(),u===null&&go(g.stateNode.containerInfo),_s(g),null;case 10:return mc(g.type),_s(g),null;case 19:if(ct(Qs),I=g.memoizedState,I===null)return _s(g),null;if(B=(g.flags&128)!==0,q=I.rendering,q===null)if(B)rf(I,!1);else{if(Jn!==0||u!==null&&(u.flags&128)!==0)for(u=g.child;u!==null;){if(q=Sc(u),q!==null){for(g.flags|=128,rf(I,!1),u=q.updateQueue,g.updateQueue=u,nf(g,u),g.subtreeFlags=0,u=S,S=g.child;S!==null;)yd(S,u),S=S.sibling;return vt(Qs,Qs.current&1|2),Nr&&Bl(g,I.treeForkCount),g.child}u=u.sibling}I.tail!==null&&yn()>di&&(g.flags|=128,B=!0,rf(I,!1),g.lanes=4194304)}else{if(!B)if(u=Sc(q),u!==null){if(g.flags|=128,B=!0,u=u.updateQueue,g.updateQueue=u,nf(g,u),rf(I,!0),I.tail===null&&I.tailMode==="hidden"&&!q.alternate&&!Nr)return _s(g),null}else 2*yn()-I.renderingStartTime>di&&S!==536870912&&(g.flags|=128,B=!0,rf(I,!1),g.lanes=4194304);I.isBackwards?(q.sibling=g.child,g.child=q):(u=I.last,u!==null?u.sibling=q:g.child=q,I.last=q)}return I.tail!==null?(u=I.tail,I.rendering=u,I.tail=u.sibling,I.renderingStartTime=yn(),u.sibling=null,S=Qs.current,vt(Qs,B?S&1|2:S&1),Nr&&Bl(g,I.treeForkCount),u):(_s(g),null);case 22:case 23:return oa(g),bl(),I=g.memoizedState!==null,u!==null?u.memoizedState!==null!==I&&(g.flags|=8192):I&&(g.flags|=8192),I?(S&536870912)!==0&&(g.flags&128)===0&&(_s(g),g.subtreeFlags&6&&(g.flags|=8192)):_s(g),S=g.updateQueue,S!==null&&nf(g,S.retryQueue),S=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(S=u.memoizedState.cachePool.pool),I=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(I=g.memoizedState.cachePool.pool),I!==S&&(g.flags|=2048),u!==null&&ct(_c),null;case 24:return S=null,u!==null&&(S=u.memoizedState.cache),g.memoizedState.cache!==S&&(g.flags|=2048),mc(ts),_s(g),null;case 25:return null;case 30:return null}throw Error(d(156,g.tag))}function py(u,g){switch(qc(g),g.tag){case 1:return u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 3:return mc(ts),An(),u=g.flags,(u&65536)!==0&&(u&128)===0?(g.flags=u&-65537|128,g):null;case 26:case 27:case 5:return gi(g),null;case 31:if(g.memoizedState!==null){if(oa(g),g.alternate===null)throw Error(d(340));Ul()}return u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 13:if(oa(g),u=g.memoizedState,u!==null&&u.dehydrated!==null){if(g.alternate===null)throw Error(d(340));Ul()}return u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 19:return ct(Qs),null;case 4:return An(),null;case 10:return mc(g.type),null;case 22:case 23:return oa(g),bl(),u!==null&&ct(_c),u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 24:return mc(ts),null;case 25:return null;default:return null}}function Tm(u,g){switch(qc(g),g.tag){case 3:mc(ts),An();break;case 26:case 27:case 5:gi(g);break;case 4:An();break;case 31:g.memoizedState!==null&&oa(g);break;case 13:oa(g);break;case 19:ct(Qs);break;case 10:mc(g.type);break;case 22:case 23:oa(g),bl(),u!==null&&ct(_c);break;case 24:mc(ts)}}function Vd(u,g){try{var S=g.updateQueue,I=S!==null?S.lastEffect:null;if(I!==null){var B=I.next;S=B;do{if((S.tag&u)===u){I=void 0;var q=S.create,de=S.inst;I=q(),de.destroy=I}S=S.next}while(S!==B)}}catch(Oe){Ur(g,g.return,Oe)}}function Hl(u,g,S){try{var I=g.updateQueue,B=I!==null?I.lastEffect:null;if(B!==null){var q=B.next;I=q;do{if((I.tag&u)===u){var de=I.inst,Oe=de.destroy;if(Oe!==void 0){de.destroy=void 0,B=g;var ot=S,Gt=Oe;try{Gt()}catch(mn){Ur(B,ot,mn)}}}I=I.next}while(I!==q)}}catch(mn){Ur(g,g.return,mn)}}function xp(u){var g=u.updateQueue;if(g!==null){var S=u.stateNode;try{Qc(g,S)}catch(I){Ur(u,u.return,I)}}}function sf(u,g,S){S.props=iu(u.type,u.memoizedProps),S.state=u.memoizedState;try{S.componentWillUnmount()}catch(I){Ur(u,g,I)}}function sl(u,g){try{var S=u.ref;if(S!==null){switch(u.tag){case 26:case 27:case 5:var I=u.stateNode;break;case 30:I=u.stateNode;break;default:I=u.stateNode}typeof S=="function"?u.refCleanup=S(I):S.current=I}}catch(B){Ur(u,g,B)}}function po(u,g){var S=u.ref,I=u.refCleanup;if(S!==null)if(typeof I=="function")try{I()}catch(B){Ur(u,g,B)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof S=="function")try{S(null)}catch(B){Ur(u,g,B)}else S.current=null}function Co(u){var g=u.type,S=u.memoizedProps,I=u.stateNode;try{e:switch(g){case"button":case"input":case"select":case"textarea":S.autoFocus&&I.focus();break e;case"img":S.src?I.src=S.src:S.srcSet&&(I.srcset=S.srcSet)}}catch(B){Ur(u,u.return,B)}}function ql(u,g,S){try{var I=u.stateNode;IS(I,u.type,S,g),I[ve]=g}catch(B){Ur(u,u.return,B)}}function Tl(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Hd(u.type)||u.tag===4}function Hg(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||Tl(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Hd(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function qg(u,g,S){var I=u.tag;if(I===5||I===6)u=u.stateNode,g?(S.nodeType===9?S.body:S.nodeName==="HTML"?S.ownerDocument.body:S).insertBefore(u,g):(g=S.nodeType===9?S.body:S.nodeName==="HTML"?S.ownerDocument.body:S,g.appendChild(u),S=S._reactRootContainer,S!=null||g.onclick!==null||(g.onclick=hl));else if(I!==4&&(I===27&&Hd(u.type)&&(S=u.stateNode,g=null),u=u.child,u!==null))for(qg(u,g,S),u=u.sibling;u!==null;)qg(u,g,S),u=u.sibling}function Em(u,g,S){var I=u.tag;if(I===5||I===6)u=u.stateNode,g?S.insertBefore(u,g):S.appendChild(u);else if(I!==4&&(I===27&&Hd(u.type)&&(S=u.stateNode),u=u.child,u!==null))for(Em(u,g,S),u=u.sibling;u!==null;)Em(u,g,S),u=u.sibling}function my(u){var g=u.stateNode,S=u.memoizedProps;try{for(var I=u.type,B=g.attributes;B.length;)g.removeAttributeNode(B[0]);Sa(g,I,S),g[se]=u,g[ve]=S}catch(q){Ur(u,u.return,q)}}var Zl=!1,Hr=!1,f=!1,n=typeof WeakSet=="function"?WeakSet:Set,a=null;function p(u,g){if(u=u.containerInfo,cv=Ep,u=Dh(u),uc(u)){if("selectionStart"in u)var S={start:u.selectionStart,end:u.selectionEnd};else e:{S=(S=u.ownerDocument)&&S.defaultView||window;var I=S.getSelection&&S.getSelection();if(I&&I.rangeCount!==0){S=I.anchorNode;var B=I.anchorOffset,q=I.focusNode;I=I.focusOffset;try{S.nodeType,q.nodeType}catch{S=null;break e}var de=0,Oe=-1,ot=-1,Gt=0,mn=0,xn=u,Wt=null;t:for(;;){for(var tn;xn!==S||B!==0&&xn.nodeType!==3||(Oe=de+B),xn!==q||I!==0&&xn.nodeType!==3||(ot=de+I),xn.nodeType===3&&(de+=xn.nodeValue.length),(tn=xn.firstChild)!==null;)Wt=xn,xn=tn;for(;;){if(xn===u)break t;if(Wt===S&&++Gt===B&&(Oe=de),Wt===q&&++mn===I&&(ot=de),(tn=xn.nextSibling)!==null)break;xn=Wt,Wt=xn.parentNode}xn=tn}S=Oe===-1||ot===-1?null:{start:Oe,end:ot}}else S=null}S=S||{start:0,end:0}}else S=null;for(e_={focusedElem:u,selectionRange:S},Ep=!1,a=g;a!==null;)if(g=a,u=g.child,(g.subtreeFlags&1028)!==0&&u!==null)u.return=g,a=u;else for(;a!==null;){switch(g=a,q=g.alternate,u=g.flags,g.tag){case 0:if((u&4)!==0&&(u=g.updateQueue,u=u!==null?u.events:null,u!==null))for(S=0;S<u.length;S++)B=u[S],B.ref.impl=B.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&q!==null){u=void 0,S=g,B=q.memoizedProps,q=q.memoizedState,I=S.stateNode;try{var ni=iu(S.type,B);u=I.getSnapshotBeforeUpdate(ni,q),I.__reactInternalSnapshotBeforeUpdate=u}catch(Di){Ur(S,S.return,Di)}}break;case 3:if((u&1024)!==0){if(u=g.stateNode.containerInfo,S=u.nodeType,S===9)Sp(u);else if(S===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":Sp(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(d(163))}if(u=g.sibling,u!==null){u.return=g.return,a=u;break}a=g.return}}function x(u,g,S){var I=S.flags;switch(S.tag){case 0:case 11:case 15:ye(u,S),I&4&&Vd(5,S);break;case 1:if(ye(u,S),I&4)if(u=S.stateNode,g===null)try{u.componentDidMount()}catch(de){Ur(S,S.return,de)}else{var B=iu(S.type,g.memoizedProps);g=g.memoizedState;try{u.componentDidUpdate(B,g,u.__reactInternalSnapshotBeforeUpdate)}catch(de){Ur(S,S.return,de)}}I&64&&xp(S),I&512&&sl(S,S.return);break;case 3:if(ye(u,S),I&64&&(u=S.updateQueue,u!==null)){if(g=null,S.child!==null)switch(S.child.tag){case 27:case 5:g=S.child.stateNode;break;case 1:g=S.child.stateNode}try{Qc(u,g)}catch(de){Ur(S,S.return,de)}}break;case 27:g===null&&I&4&&my(S);case 26:case 5:ye(u,S),g===null&&I&4&&Co(S),I&512&&sl(S,S.return);break;case 12:ye(u,S);break;case 31:ye(u,S),I&4&&F(u,S);break;case 13:ye(u,S),I&4&&G(u,S),I&64&&(u=S.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(S=tv.bind(null,S),qd(u,S))));break;case 22:if(I=S.memoizedState!==null||Zl,!I){g=g!==null&&g.memoizedState!==null||Hr,B=Zl;var q=Hr;Zl=I,(Hr=g)&&!q?Ce(u,S,(S.subtreeFlags&8772)!==0):ye(u,S),Zl=B,Hr=q}break;case 30:break;default:ye(u,S)}}function b(u){var g=u.alternate;g!==null&&(u.alternate=null,b(g)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(g=u.stateNode,g!==null&&Bt(g)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var T=null,M=!1;function D(u,g,S){for(S=S.child;S!==null;)k(u,g,S),S=S.sibling}function k(u,g,S){if(dr&&typeof dr.onCommitFiberUnmount=="function")try{dr.onCommitFiberUnmount(ta,S)}catch{}switch(S.tag){case 26:Hr||po(S,g),D(u,g,S),S.memoizedState?S.memoizedState.count--:S.stateNode&&(S=S.stateNode,S.parentNode.removeChild(S));break;case 27:Hr||po(S,g);var I=T,B=M;Hd(S.type)&&(T=S.stateNode,M=!1),D(u,g,S),lf(S.stateNode),T=I,M=B;break;case 5:Hr||po(S,g);case 6:if(I=T,B=M,T=null,D(u,g,S),T=I,M=B,T!==null)if(M)try{(T.nodeType===9?T.body:T.nodeName==="HTML"?T.ownerDocument.body:T).removeChild(S.stateNode)}catch(q){Ur(S,g,q)}else try{T.removeChild(S.stateNode)}catch(q){Ur(S,g,q)}break;case 18:T!==null&&(M?(u=T,Om(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,S.stateNode),Yd(u)):Om(T,S.stateNode));break;case 4:I=T,B=M,T=S.stateNode.containerInfo,M=!0,D(u,g,S),T=I,M=B;break;case 0:case 11:case 14:case 15:Hl(2,S,g),Hr||Hl(4,S,g),D(u,g,S);break;case 1:Hr||(po(S,g),I=S.stateNode,typeof I.componentWillUnmount=="function"&&sf(S,g,I)),D(u,g,S);break;case 21:D(u,g,S);break;case 22:Hr=(I=Hr)||S.memoizedState!==null,D(u,g,S),Hr=I;break;default:D(u,g,S)}}function F(u,g){if(g.memoizedState===null&&(u=g.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{Yd(u)}catch(S){Ur(g,g.return,S)}}}function G(u,g){if(g.memoizedState===null&&(u=g.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{Yd(u)}catch(S){Ur(g,g.return,S)}}function V(u){switch(u.tag){case 31:case 13:case 19:var g=u.stateNode;return g===null&&(g=u.stateNode=new n),g;case 22:return u=u.stateNode,g=u._retryCache,g===null&&(g=u._retryCache=new n),g;default:throw Error(d(435,u.tag))}}function W(u,g){var S=V(u);g.forEach(function(I){if(!S.has(I)){S.add(I);var B=Xg.bind(null,u,I);I.then(B,B)}})}function K(u,g){var S=g.deletions;if(S!==null)for(var I=0;I<S.length;I++){var B=S[I],q=u,de=g,Oe=de;e:for(;Oe!==null;){switch(Oe.tag){case 27:if(Hd(Oe.type)){T=Oe.stateNode,M=!1;break e}break;case 5:T=Oe.stateNode,M=!1;break e;case 3:case 4:T=Oe.stateNode.containerInfo,M=!0;break e}Oe=Oe.return}if(T===null)throw Error(d(160));k(q,de,B),T=null,M=!1,q=B.alternate,q!==null&&(q.return=null),B.return=null}if(g.subtreeFlags&13886)for(g=g.child;g!==null;)ae(g,u),g=g.sibling}var J=null;function ae(u,g){var S=u.alternate,I=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:K(g,u),re(u),I&4&&(Hl(3,u,u.return),Vd(3,u),Hl(5,u,u.return));break;case 1:K(g,u),re(u),I&512&&(Hr||S===null||po(S,S.return)),I&64&&Zl&&(u=u.updateQueue,u!==null&&(I=u.callbacks,I!==null&&(S=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=S===null?I:S.concat(I))));break;case 26:var B=J;if(K(g,u),re(u),I&512&&(Hr||S===null||po(S,S.return)),I&4){var q=S!==null?S.memoizedState:null;if(I=u.memoizedState,S===null)if(I===null)if(u.stateNode===null){e:{I=u.type,S=u.memoizedProps,B=B.ownerDocument||B;t:switch(I){case"title":q=B.getElementsByTagName("title")[0],(!q||q[nt]||q[se]||q.namespaceURI==="http://www.w3.org/2000/svg"||q.hasAttribute("itemprop"))&&(q=B.createElement(I),B.head.insertBefore(q,B.querySelector("head > title"))),Sa(q,I,S),q[se]=u,Tn(q),I=q;break e;case"link":var de=o_("link","href",B).get(I+(S.href||""));if(de){for(var Oe=0;Oe<de.length;Oe++)if(q=de[Oe],q.getAttribute("href")===(S.href==null||S.href===""?null:S.href)&&q.getAttribute("rel")===(S.rel==null?null:S.rel)&&q.getAttribute("title")===(S.title==null?null:S.title)&&q.getAttribute("crossorigin")===(S.crossOrigin==null?null:S.crossOrigin)){de.splice(Oe,1);break t}}q=B.createElement(I),Sa(q,I,S),B.head.appendChild(q);break;case"meta":if(de=o_("meta","content",B).get(I+(S.content||""))){for(Oe=0;Oe<de.length;Oe++)if(q=de[Oe],q.getAttribute("content")===(S.content==null?null:""+S.content)&&q.getAttribute("name")===(S.name==null?null:S.name)&&q.getAttribute("property")===(S.property==null?null:S.property)&&q.getAttribute("http-equiv")===(S.httpEquiv==null?null:S.httpEquiv)&&q.getAttribute("charset")===(S.charSet==null?null:S.charSet)){de.splice(Oe,1);break t}}q=B.createElement(I),Sa(q,I,S),B.head.appendChild(q);break;default:throw Error(d(468,I))}q[se]=u,Tn(q),I=q}u.stateNode=I}else vv(B,u.type,u.stateNode);else u.stateNode=xv(B,I,u.memoizedProps);else q!==I?(q===null?S.stateNode!==null&&(S=S.stateNode,S.parentNode.removeChild(S)):q.count--,I===null?vv(B,u.type,u.stateNode):xv(B,I,u.memoizedProps)):I===null&&u.stateNode!==null&&ql(u,u.memoizedProps,S.memoizedProps)}break;case 27:K(g,u),re(u),I&512&&(Hr||S===null||po(S,S.return)),S!==null&&I&4&&ql(u,u.memoizedProps,S.memoizedProps);break;case 5:if(K(g,u),re(u),I&512&&(Hr||S===null||po(S,S.return)),u.flags&32){B=u.stateNode;try{ic(B,"")}catch(ni){Ur(u,u.return,ni)}}I&4&&u.stateNode!=null&&(B=u.memoizedProps,ql(u,B,S!==null?S.memoizedProps:B)),I&1024&&(f=!0);break;case 6:if(K(g,u),re(u),I&4){if(u.stateNode===null)throw Error(d(162));I=u.memoizedProps,S=u.stateNode;try{S.nodeValue=I}catch(ni){Ur(u,u.return,ni)}}break;case 3:if(jm=null,B=J,J=zm(g.containerInfo),K(g,u),J=B,re(u),I&4&&S!==null&&S.memoizedState.isDehydrated)try{Yd(g.containerInfo)}catch(ni){Ur(u,u.return,ni)}f&&(f=!1,ue(u));break;case 4:I=J,J=zm(u.stateNode.containerInfo),K(g,u),re(u),J=I;break;case 12:K(g,u),re(u);break;case 31:K(g,u),re(u),I&4&&(I=u.updateQueue,I!==null&&(u.updateQueue=null,W(u,I)));break;case 13:K(g,u),re(u),u.child.flags&8192&&u.memoizedState!==null!=(S!==null&&S.memoizedState!==null)&&(ii=yn()),I&4&&(I=u.updateQueue,I!==null&&(u.updateQueue=null,W(u,I)));break;case 22:B=u.memoizedState!==null;var ot=S!==null&&S.memoizedState!==null,Gt=Zl,mn=Hr;if(Zl=Gt||B,Hr=mn||ot,K(g,u),Hr=mn,Zl=Gt,re(u),I&8192)e:for(g=u.stateNode,g._visibility=B?g._visibility&-2:g._visibility|1,B&&(S===null||ot||Zl||Hr||fe(u)),S=null,g=u;;){if(g.tag===5||g.tag===26){if(S===null){ot=S=g;try{if(q=ot.stateNode,B)de=q.style,typeof de.setProperty=="function"?de.setProperty("display","none","important"):de.display="none";else{Oe=ot.stateNode;var xn=ot.memoizedProps.style,Wt=xn!=null&&xn.hasOwnProperty("display")?xn.display:null;Oe.style.display=Wt==null||typeof Wt=="boolean"?"":(""+Wt).trim()}}catch(ni){Ur(ot,ot.return,ni)}}}else if(g.tag===6){if(S===null){ot=g;try{ot.stateNode.nodeValue=B?"":ot.memoizedProps}catch(ni){Ur(ot,ot.return,ni)}}}else if(g.tag===18){if(S===null){ot=g;try{var tn=ot.stateNode;B?Ay(tn,!0):Ay(ot.stateNode,!1)}catch(ni){Ur(ot,ot.return,ni)}}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===u)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===u)break e;for(;g.sibling===null;){if(g.return===null||g.return===u)break e;S===g&&(S=null),g=g.return}S===g&&(S=null),g.sibling.return=g.return,g=g.sibling}I&4&&(I=u.updateQueue,I!==null&&(S=I.retryQueue,S!==null&&(I.retryQueue=null,W(u,S))));break;case 19:K(g,u),re(u),I&4&&(I=u.updateQueue,I!==null&&(u.updateQueue=null,W(u,I)));break;case 30:break;case 21:break;default:K(g,u),re(u)}}function re(u){var g=u.flags;if(g&2){try{for(var S,I=u.return;I!==null;){if(Tl(I)){S=I;break}I=I.return}if(S==null)throw Error(d(160));switch(S.tag){case 27:var B=S.stateNode,q=Hg(u);Em(u,q,B);break;case 5:var de=S.stateNode;S.flags&32&&(ic(de,""),S.flags&=-33);var Oe=Hg(u);Em(u,Oe,de);break;case 3:case 4:var ot=S.stateNode.containerInfo,Gt=Hg(u);qg(u,Gt,ot);break;default:throw Error(d(161))}}catch(mn){Ur(u,u.return,mn)}u.flags&=-3}g&4096&&(u.flags&=-4097)}function ue(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var g=u;ue(g),g.tag===5&&g.flags&1024&&g.stateNode.reset(),u=u.sibling}}function ye(u,g){if(g.subtreeFlags&8772)for(g=g.child;g!==null;)x(u,g.alternate,g),g=g.sibling}function fe(u){for(u=u.child;u!==null;){var g=u;switch(g.tag){case 0:case 11:case 14:case 15:Hl(4,g,g.return),fe(g);break;case 1:po(g,g.return);var S=g.stateNode;typeof S.componentWillUnmount=="function"&&sf(g,g.return,S),fe(g);break;case 27:lf(g.stateNode);case 26:case 5:po(g,g.return),fe(g);break;case 22:g.memoizedState===null&&fe(g);break;case 30:fe(g);break;default:fe(g)}u=u.sibling}}function Ce(u,g,S){for(S=S&&(g.subtreeFlags&8772)!==0,g=g.child;g!==null;){var I=g.alternate,B=u,q=g,de=q.flags;switch(q.tag){case 0:case 11:case 15:Ce(B,q,S),Vd(4,q);break;case 1:if(Ce(B,q,S),I=q,B=I.stateNode,typeof B.componentDidMount=="function")try{B.componentDidMount()}catch(Gt){Ur(I,I.return,Gt)}if(I=q,B=I.updateQueue,B!==null){var Oe=I.stateNode;try{var ot=B.shared.hiddenCallbacks;if(ot!==null)for(B.shared.hiddenCallbacks=null,B=0;B<ot.length;B++)oy(ot[B],Oe)}catch(Gt){Ur(I,I.return,Gt)}}S&&de&64&&xp(q),sl(q,q.return);break;case 27:my(q);case 26:case 5:Ce(B,q,S),S&&I===null&&de&4&&Co(q),sl(q,q.return);break;case 12:Ce(B,q,S);break;case 31:Ce(B,q,S),S&&de&4&&F(B,q);break;case 13:Ce(B,q,S),S&&de&4&&G(B,q);break;case 22:q.memoizedState===null&&Ce(B,q,S),sl(q,q.return);break;case 30:break;default:Ce(B,q,S)}g=g.sibling}}function be(u,g){var S=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(S=u.memoizedState.cachePool.pool),u=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(u=g.memoizedState.cachePool.pool),u!==S&&(u!=null&&u.refCount++,S!=null&&Wc(S))}function De(u,g){u=null,g.alternate!==null&&(u=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==u&&(g.refCount++,u!=null&&Wc(u))}function Te(u,g,S,I){if(g.subtreeFlags&10256)for(g=g.child;g!==null;)Se(u,g,S,I),g=g.sibling}function Se(u,g,S,I){var B=g.flags;switch(g.tag){case 0:case 11:case 15:Te(u,g,S,I),B&2048&&Vd(9,g);break;case 1:Te(u,g,S,I);break;case 3:Te(u,g,S,I),B&2048&&(u=null,g.alternate!==null&&(u=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==u&&(g.refCount++,u!=null&&Wc(u)));break;case 12:if(B&2048){Te(u,g,S,I),u=g.stateNode;try{var q=g.memoizedProps,de=q.id,Oe=q.onPostCommit;typeof Oe=="function"&&Oe(de,g.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(ot){Ur(g,g.return,ot)}}else Te(u,g,S,I);break;case 31:Te(u,g,S,I);break;case 13:Te(u,g,S,I);break;case 23:break;case 22:q=g.stateNode,de=g.alternate,g.memoizedState!==null?q._visibility&2?Te(u,g,S,I):Xe(u,g):q._visibility&2?Te(u,g,S,I):(q._visibility|=2,Pe(u,g,S,I,(g.subtreeFlags&10256)!==0||!1)),B&2048&&be(de,g);break;case 24:Te(u,g,S,I),B&2048&&De(g.alternate,g);break;default:Te(u,g,S,I)}}function Pe(u,g,S,I,B){for(B=B&&((g.subtreeFlags&10256)!==0||!1),g=g.child;g!==null;){var q=u,de=g,Oe=S,ot=I,Gt=de.flags;switch(de.tag){case 0:case 11:case 15:Pe(q,de,Oe,ot,B),Vd(8,de);break;case 23:break;case 22:var mn=de.stateNode;de.memoizedState!==null?mn._visibility&2?Pe(q,de,Oe,ot,B):Xe(q,de):(mn._visibility|=2,Pe(q,de,Oe,ot,B)),B&&Gt&2048&&be(de.alternate,de);break;case 24:Pe(q,de,Oe,ot,B),B&&Gt&2048&&De(de.alternate,de);break;default:Pe(q,de,Oe,ot,B)}g=g.sibling}}function Xe(u,g){if(g.subtreeFlags&10256)for(g=g.child;g!==null;){var S=u,I=g,B=I.flags;switch(I.tag){case 22:Xe(S,I),B&2048&&be(I.alternate,I);break;case 24:Xe(S,I),B&2048&&De(I.alternate,I);break;default:Xe(S,I)}g=g.sibling}}var Ge=8192;function dt(u,g,S){if(u.subtreeFlags&Ge)for(u=u.child;u!==null;)it(u,g,S),u=u.sibling}function it(u,g,S){switch(u.tag){case 26:dt(u,g,S),u.flags&Ge&&u.memoizedState!==null&&Db(S,J,u.memoizedState,u.memoizedProps);break;case 5:dt(u,g,S);break;case 3:case 4:var I=J;J=zm(u.stateNode.containerInfo),dt(u,g,S),J=I;break;case 22:u.memoizedState===null&&(I=u.alternate,I!==null&&I.memoizedState!==null?(I=Ge,Ge=16777216,dt(u,g,S),Ge=I):dt(u,g,S));break;default:dt(u,g,S)}}function gt(u){var g=u.alternate;if(g!==null&&(u=g.child,u!==null)){g.child=null;do g=u.sibling,u.sibling=null,u=g;while(u!==null)}}function Ft(u){var g=u.deletions;if((u.flags&16)!==0){if(g!==null)for(var S=0;S<g.length;S++){var I=g[S];a=I,_t(I,u)}gt(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)Je(u),u=u.sibling}function Je(u){switch(u.tag){case 0:case 11:case 15:Ft(u),u.flags&2048&&Hl(9,u,u.return);break;case 3:Ft(u);break;case 12:Ft(u);break;case 22:var g=u.stateNode;u.memoizedState!==null&&g._visibility&2&&(u.return===null||u.return.tag!==13)?(g._visibility&=-3,Ve(u)):Ft(u);break;default:Ft(u)}}function Ve(u){var g=u.deletions;if((u.flags&16)!==0){if(g!==null)for(var S=0;S<g.length;S++){var I=g[S];a=I,_t(I,u)}gt(u)}for(u=u.child;u!==null;){switch(g=u,g.tag){case 0:case 11:case 15:Hl(8,g,g.return),Ve(g);break;case 22:S=g.stateNode,S._visibility&2&&(S._visibility&=-3,Ve(g));break;default:Ve(g)}u=u.sibling}}function _t(u,g){for(;a!==null;){var S=a;switch(S.tag){case 0:case 11:case 15:Hl(8,S,g);break;case 23:case 22:if(S.memoizedState!==null&&S.memoizedState.cachePool!==null){var I=S.memoizedState.cachePool.pool;I!=null&&I.refCount++}break;case 24:Wc(S.memoizedState.cache)}if(I=S.child,I!==null)I.return=S,a=I;else e:for(S=u;a!==null;){I=a;var B=I.sibling,q=I.return;if(b(I),I===S){a=null;break e}if(B!==null){B.return=q,a=B;break e}a=q}}}var rt={getCacheForType:function(u){var g=Us(ts),S=g.data.get(u);return S===void 0&&(S=u(),g.data.set(u,S)),S},cacheSignal:function(){return Us(ts).controller.signal}},Pt=typeof WeakMap=="function"?WeakMap:Map,Rt=0,Qt=null,bt=null,St=0,Jt=0,cn=null,rn=!1,pn=!1,Fn=!1,ui=0,Jn=0,Vi=0,Vn=0,Mi=0,Xn=0,Ui=0,Ai=null,zi=null,Li=!1,ii=0,qi=0,di=1/0,gr=null,Ii=null,Pn=0,Si=null,Tr=null,Dr=0,Vr=0,Yr=null,ca=null,mo=0,so=null;function ps(){return(Rt&2)!==0&&St!==0?St&-St:Ke.T!==null?by():_a()}function Ba(){if(Xn===0)if((St&536870912)===0||Nr){var u=js;js<<=1,(js&3932160)===0&&(js=262144),Xn=u}else Xn=536870912;return u=Ko.current,u!==null&&(u.flags|=32),Xn}function ns(u,g,S){(u===Qt&&(Jt===2||Jt===9)||u.cancelPendingCommit!==null)&&(Qr(u,0),Er(u,St,Xn,!1)),Ct(u,S),((Rt&2)===0||u!==Qt)&&(u===Qt&&((Rt&2)===0&&(Vn|=S),Jn===4&&Er(u,St,Xn,!1)),wa(u))}function Va(u,g,S){if((Rt&6)!==0)throw Error(d(327));var I=!S&&(g&127)===0&&(g&u.expiredLanes)===0||Ho(u,g),B=I?al(u,g):Bu(u,g,!0),q=I;do{if(B===0){pn&&!I&&Er(u,g,0,!1);break}else{if(S=u.current.alternate,q&&!oo(S)){B=Bu(u,g,!1),q=!1;continue}if(B===2){if(q=g,u.errorRecoveryDisabledLanes&q)var de=0;else de=u.pendingLanes&-536870913,de=de!==0?de:de&536870912?536870912:0;if(de!==0){g=de;e:{var Oe=u;B=Ai;var ot=Oe.current.memoizedState.isDehydrated;if(ot&&(Qr(Oe,de).flags|=256),de=Bu(Oe,de,!1),de!==2){if(Fn&&!ot){Oe.errorRecoveryDisabledLanes|=q,Vn|=q,B=4;break e}q=zi,zi=B,q!==null&&(zi===null?zi=q:zi.push.apply(zi,q))}B=de}if(q=!1,B!==2)continue}}if(B===1){Qr(u,0),Er(u,g,0,!0);break}e:{switch(I=u,q=B,q){case 0:case 1:throw Error(d(345));case 4:if((g&4194048)!==g)break;case 6:Er(I,g,Xn,!rn);break e;case 2:zi=null;break;case 3:case 5:break;default:throw Error(d(329))}if((g&62914560)===g&&(B=ii+300-yn(),10<B)){if(Er(I,g,Xn,!rn),us(I,0,!0)!==0)break e;Dr=g,I.timeoutHandle=hv(ol.bind(null,I,S,zi,gr,Li,g,Xn,Vn,Ui,rn,q,"Throttled",-0,0),B);break e}ol(I,S,zi,gr,Li,g,Xn,Vn,Ui,rn,q,null,-0,0)}}break}while(!0);wa(u)}function ol(u,g,S,I,B,q,de,Oe,ot,Gt,mn,xn,Wt,tn){if(u.timeoutHandle=-1,xn=g.subtreeFlags,xn&8192||(xn&16785408)===16785408){xn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:hl},it(g,q,xn);var ni=(q&62914560)===q?ii-yn():(q&4194048)===q?qi-yn():0;if(ni=bv(xn,ni),ni!==null){Dr=q,u.cancelPendingCommit=ni(cb.bind(null,u,g,q,S,I,B,de,Oe,ot,mn,xn,null,Wt,tn)),Er(u,q,de,!Gt);return}}cb(u,g,q,S,I,B,de,Oe,ot)}function oo(u){for(var g=u;;){var S=g.tag;if((S===0||S===11||S===15)&&g.flags&16384&&(S=g.updateQueue,S!==null&&(S=S.stores,S!==null)))for(var I=0;I<S.length;I++){var B=S[I],q=B.getSnapshot;B=B.value;try{if(!No(q(),B))return!1}catch{return!1}}if(S=g.child,g.subtreeFlags&16384&&S!==null)S.return=g,g=S;else{if(g===u)break;for(;g.sibling===null;){if(g.return===null||g.return===u)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Er(u,g,S,I){g&=~Mi,g&=~Vn,u.suspendedLanes|=g,u.pingedLanes&=~g,I&&(u.warmLanes|=g),I=u.expirationTimes;for(var B=g;0<B;){var q=31-Os(B),de=1<<q;I[q]=-1,B&=~de}S!==0&&ga(u,S,g)}function is(){return(Rt&6)===0?(Cm(0),!1):!0}function ur(){if(bt!==null){if(Jt===0)var u=bt.return;else u=bt,xl=yl=null,Tc(u),Eu=null,Fh=0,u=bt;for(;u!==null;)Tm(u.alternate,u),u=u.return;bt=null}}function Qr(u,g){var S=u.timeoutHandle;S!==-1&&(u.timeoutHandle=-1,Ey(S)),S=u.cancelPendingCommit,S!==null&&(u.cancelPendingCommit=null,S()),Dr=0,ur(),Qt=u,bt=S=mi(u.current,null),St=g,Jt=0,cn=null,rn=!1,pn=Ho(u,g),Fn=!1,Ui=Xn=Mi=Vn=Vi=Jn=0,zi=Ai=null,Li=!1,(g&8)!==0&&(g|=g&32);var I=u.entangledLanes;if(I!==0)for(u=u.entanglements,I&=g;0<I;){var B=31-Os(I),q=1<<B;g|=u[B],I&=~q}return ui=g,gd(),S}function eo(u,g){jt=null,Ke.H=kd,g===Td||g===tm?(g=Rg(),Jt=3):g===em?(g=Rg(),Jt=4):Jt=g===ju?8:g!==null&&typeof g=="object"&&typeof g.then=="function"?6:1,cn=g,bt===null&&(Jn=1,ku(u,Na(g,u.current)))}function Jr(){var u=Ko.current;return u===null?!0:(St&4194048)===St?Eo===null:(St&62914560)===St||(St&536870912)!==0?u===Eo:!1}function Ua(){var u=Ke.H;return Ke.H=kd,u===null?kd:u}function Ud(){var u=Ke.A;return Ke.A=rt,u}function El(){Jn=4,rn||(St&4194048)!==St&&Ko.current!==null||(pn=!0),(Vi&134217727)===0&&(Vn&134217727)===0||Qt===null||Er(Qt,St,Xn,!1)}function Bu(u,g,S){var I=Rt;Rt|=2;var B=Ua(),q=Ud();(Qt!==u||St!==g)&&(gr=null,Qr(u,g)),g=!1;var de=Jn;e:do try{if(Jt!==0&&bt!==null){var Oe=bt,ot=cn;switch(Jt){case 8:ur(),de=6;break e;case 3:case 2:case 9:case 6:Ko.current===null&&(g=!0);var Gt=Jt;if(Jt=0,cn=null,Al(u,Oe,ot,Gt),S&&pn){de=0;break e}break;default:Gt=Jt,Jt=0,cn=null,Al(u,Oe,ot,Gt)}}of(),de=Jn;break}catch(mn){eo(u,mn)}while(!0);return g&&u.shellSuspendCounter++,xl=yl=null,Rt=I,Ke.H=B,Ke.A=q,bt===null&&(Qt=null,St=0,gd()),de}function of(){for(;bt!==null;)Gs(bt)}function al(u,g){var S=Rt;Rt|=2;var I=Ua(),B=Ud();Qt!==u||St!==g?(gr=null,di=yn()+500,Qr(u,g)):pn=Ho(u,g);e:do try{if(Jt!==0&&bt!==null){g=bt;var q=cn;t:switch(Jt){case 1:Jt=0,cn=null,Al(u,g,q,1);break;case 2:case 9:if(sy(q)){Jt=0,cn=null,$a(g);break}g=function(){Jt!==2&&Jt!==9||Qt!==u||(Jt=7),wa(u)},q.then(g,g);break e;case 3:Jt=7;break e;case 4:Jt=5;break e;case 7:sy(q)?(Jt=0,cn=null,$a(g)):(Jt=0,cn=null,Al(u,g,q,7));break;case 5:var de=null;switch(bt.tag){case 26:de=bt.memoizedState;case 5:case 27:var Oe=bt;if(de?Dy(de):Oe.stateNode.complete){Jt=0,cn=null;var ot=Oe.sibling;if(ot!==null)bt=ot;else{var Gt=Oe.return;Gt!==null?(bt=Gt,vp(Gt)):bt=null}break t}}Jt=0,cn=null,Al(u,g,q,5);break;case 6:Jt=0,cn=null,Al(u,g,q,6);break;case 8:ur(),Jn=6;break e;default:throw Error(d(462))}}Rc();break}catch(mn){eo(u,mn)}while(!0);return xl=yl=null,Ke.H=I,Ke.A=B,Rt=S,bt!==null?0:(Qt=null,St=0,gd(),Jn)}function Rc(){for(;bt!==null&&!nn();)Gs(bt)}function Gs(u){var g=Ss(u.alternate,u,ui);u.memoizedProps=u.pendingProps,g===null?vp(u):bt=g}function $a(u){var g=u,S=g.alternate;switch(g.tag){case 15:case 0:g=kg(S,g,g.pendingProps,g.type,void 0,St);break;case 11:g=kg(S,g,g.pendingProps,g.type.render,g.ref,St);break;case 5:Tc(g);default:Tm(S,g),g=bt=yd(g,ui),g=Ss(S,g,ui)}u.memoizedProps=u.pendingProps,g===null?vp(u):bt=g}function Al(u,g,S,I){xl=yl=null,Tc(g),Eu=null,Fh=0;var B=g.return;try{if(_m(u,B,g,S,St)){Jn=1,ku(u,Na(S,u.current)),bt=null;return}}catch(q){if(B!==null)throw bt=B,q;Jn=1,ku(u,Na(S,u.current)),bt=null;return}g.flags&32768?(Nr||I===1?u=!0:pn||(St&536870912)!==0?u=!1:(rn=u=!0,(I===2||I===9||I===3||I===6)&&(I=Ko.current,I!==null&&I.tag===13&&(I.flags|=16384))),bp(g,u)):vp(g)}function vp(u){var g=u;do{if((g.flags&32768)!==0){bp(g,rn);return}u=g.return;var S=Qx(g.alternate,g,ui);if(S!==null){bt=S;return}if(g=g.sibling,g!==null){bt=g;return}bt=g=u}while(g!==null);Jn===0&&(Jn=5)}function bp(u,g){do{var S=py(u.alternate,u);if(S!==null){S.flags&=32767,bt=S;return}if(S=u.return,S!==null&&(S.flags|=32768,S.subtreeFlags=0,S.deletions=null),!g&&(u=u.sibling,u!==null)){bt=u;return}bt=u=S}while(u!==null);Jn=6,bt=null}function cb(u,g,S,I,B,q,de,Oe,ot){u.cancelPendingCommit=null;do gy();while(Pn!==0);if((Rt&6)!==0)throw Error(d(327));if(g!==null){if(g===u.current)throw Error(d(177));if(q=g.lanes|g.childLanes,q|=xa,Rs(u,S,q,de,Oe,ot),u===Qt&&(bt=Qt=null,St=0),Tr=g,Si=u,Dr=S,Vr=q,Yr=B,ca=I,(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,xy(or,function(){return _y(),null})):(u.callbackNode=null,u.callbackPriority=0),I=(g.flags&13878)!==0,(g.subtreeFlags&13878)!==0||I){I=Ke.T,Ke.T=null,B=ze.p,ze.p=2,de=Rt,Rt|=4;try{p(u,g,S)}finally{Rt=de,ze.p=B,Ke.T=I}}Pn=1,Jx(),Zg(),ub()}}function Jx(){if(Pn===1){Pn=0;var u=Si,g=Tr,S=(g.flags&13878)!==0;if((g.subtreeFlags&13878)!==0||S){S=Ke.T,Ke.T=null;var I=ze.p;ze.p=2;var B=Rt;Rt|=4;try{ae(g,u);var q=e_,de=Dh(u.containerInfo),Oe=q.focusedElem,ot=q.selectionRange;if(de!==Oe&&Oe&&Oe.ownerDocument&&ny(Oe.ownerDocument.documentElement,Oe)){if(ot!==null&&uc(Oe)){var Gt=ot.start,mn=ot.end;if(mn===void 0&&(mn=Gt),"selectionStart"in Oe)Oe.selectionStart=Gt,Oe.selectionEnd=Math.min(mn,Oe.value.length);else{var xn=Oe.ownerDocument||document,Wt=xn&&xn.defaultView||window;if(Wt.getSelection){var tn=Wt.getSelection(),ni=Oe.textContent.length,Di=Math.min(ot.start,ni),Ts=ot.end===void 0?Di:Math.min(ot.end,ni);!tn.extend&&Di>Ts&&(de=Ts,Ts=Di,Di=de);var Mt=ty(Oe,Di),pt=ty(Oe,Ts);if(Mt&&pt&&(tn.rangeCount!==1||tn.anchorNode!==Mt.node||tn.anchorOffset!==Mt.offset||tn.focusNode!==pt.node||tn.focusOffset!==pt.offset)){var Ht=xn.createRange();Ht.setStart(Mt.node,Mt.offset),tn.removeAllRanges(),Di>Ts?(tn.addRange(Ht),tn.extend(pt.node,pt.offset)):(Ht.setEnd(pt.node,pt.offset),tn.addRange(Ht))}}}}for(xn=[],tn=Oe;tn=tn.parentNode;)tn.nodeType===1&&xn.push({element:tn,left:tn.scrollLeft,top:tn.scrollTop});for(typeof Oe.focus=="function"&&Oe.focus(),Oe=0;Oe<xn.length;Oe++){var _n=xn[Oe];_n.element.scrollLeft=_n.left,_n.element.scrollTop=_n.top}}Ep=!!cv,e_=cv=null}finally{Rt=B,ze.p=I,Ke.T=S}}u.current=g,Pn=2}}function Zg(){if(Pn===2){Pn=0;var u=Si,g=Tr,S=(g.flags&8772)!==0;if((g.subtreeFlags&8772)!==0||S){S=Ke.T,Ke.T=null;var I=ze.p;ze.p=2;var B=Rt;Rt|=4;try{x(u,g.alternate,g)}finally{Rt=B,ze.p=I,Ke.T=S}}Pn=3}}function ub(){if(Pn===4||Pn===3){Pn=0,Kn();var u=Si,g=Tr,S=Dr,I=ca;(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?Pn=5:(Pn=0,Tr=Si=null,ev(u,u.pendingLanes));var B=u.pendingLanes;if(B===0&&(Ii=null),zl(S),g=g.stateNode,dr&&typeof dr.onCommitFiberRoot=="function")try{dr.onCommitFiberRoot(ta,g,void 0,(g.current.flags&128)===128)}catch{}if(I!==null){g=Ke.T,B=ze.p,ze.p=2,Ke.T=null;try{for(var q=u.onRecoverableError,de=0;de<I.length;de++){var Oe=I[de];q(Oe.value,{componentStack:Oe.stack})}}finally{Ke.T=g,ze.p=B}}(Dr&3)!==0&&gy(),wa(u),B=u.pendingLanes,(S&261930)!==0&&(B&42)!==0?u===so?mo++:(mo=0,so=u):mo=0,Cm(0)}}function ev(u,g){(u.pooledCacheLanes&=g)===0&&(g=u.pooledCache,g!=null&&(u.pooledCache=null,Wc(g)))}function gy(){return Jx(),Zg(),ub(),_y()}function _y(){if(Pn!==5)return!1;var u=Si,g=Vr;Vr=0;var S=zl(Dr),I=Ke.T,B=ze.p;try{ze.p=32>S?32:S,Ke.T=null,S=Yr,Yr=null;var q=Si,de=Dr;if(Pn=0,Tr=Si=null,Dr=0,(Rt&6)!==0)throw Error(d(331));var Oe=Rt;if(Rt|=4,Je(q.current),Se(q,q.current,de,S),Rt=Oe,Cm(0,!1),dr&&typeof dr.onPostCommitFiberRoot=="function")try{dr.onPostCommitFiberRoot(ta,q)}catch{}return!0}finally{ze.p=B,Ke.T=I,ev(u,g)}}function ru(u,g,S){g=Na(S,g),g=Cc(u.stateNode,g,2),u=vc(u,g,2),u!==null&&(Ct(u,2),wa(u))}function Ur(u,g,S){if(u.tag===3)ru(u,u,S);else for(;g!==null;){if(g.tag===3){ru(g,u,S);break}else if(g.tag===1){var I=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Ii===null||!Ii.has(I))){u=Na(S,u),S=gm(2),I=vc(g,S,2),I!==null&&(gp(S,I,g,u),Ct(I,2),wa(I));break}}g=g.return}}function yy(u,g,S){var I=u.pingCache;if(I===null){I=u.pingCache=new Pt;var B=new Set;I.set(g,B)}else B=I.get(g),B===void 0&&(B=new Set,I.set(g,B));B.has(S)||(Fn=!0,B.add(S),u=db.bind(null,u,g,S),g.then(u,u))}function db(u,g,S){var I=u.pingCache;I!==null&&I.delete(g),u.pingedLanes|=u.suspendedLanes&S,u.warmLanes&=~S,Qt===u&&(St&S)===S&&(Jn===4||Jn===3&&(St&62914560)===St&&300>yn()-ii?(Rt&2)===0&&Qr(u,0):Mi|=S,Ui===St&&(Ui=0)),wa(u)}function Wg(u,g){g===0&&(g=Po()),u=gl(u,g),u!==null&&(Ct(u,g),wa(u))}function tv(u){var g=u.memoizedState,S=0;g!==null&&(S=g.retryLane),Wg(u,S)}function Xg(u,g){var S=0;switch(u.tag){case 31:case 13:var I=u.stateNode,B=u.memoizedState;B!==null&&(S=B.retryLane);break;case 19:I=u.stateNode;break;case 22:I=u.stateNode._retryCache;break;default:throw Error(d(314))}I!==null&&I.delete(g),Wg(u,S)}function xy(u,g){return et(u,g)}var Kg=null,$d=null,Yg=!1,Am=!1,vy=!1,Gd=0;function wa(u){u!==$d&&u.next===null&&($d===null?Kg=$d=u:$d=$d.next=u),Am=!0,Yg||(Yg=!0,mb())}function Cm(u,g){if(!vy&&Am){vy=!0;do for(var S=!1,I=Kg;I!==null;){if(u!==0){var B=I.pendingLanes;if(B===0)var q=0;else{var de=I.suspendedLanes,Oe=I.pingedLanes;q=(1<<31-Os(42|u)+1)-1,q&=B&~(de&~Oe),q=q&201326741?q&201326741|1:q?q|2:0}q!==0&&(S=!0,pb(I,q))}else q=St,q=us(I,I===Qt?q:0,I.cancelPendingCommit!==null||I.timeoutHandle!==-1),(q&3)===0||Ho(I,q)||(S=!0,pb(I,q));I=I.next}while(S);vy=!1}}function nv(){iv()}function iv(){Am=Yg=!1;var u=0;Gd!==0&&Pm()&&(u=Gd);for(var g=yn(),S=null,I=Kg;I!==null;){var B=I.next,q=hb(I,g);q===0?(I.next=null,S===null?Kg=B:S.next=B,B===null&&($d=S)):(S=I,(u!==0||(q&3)!==0)&&(Am=!0)),I=B}Pn!==0&&Pn!==5||Cm(u),Gd!==0&&(Gd=0)}function hb(u,g){for(var S=u.suspendedLanes,I=u.pingedLanes,B=u.expirationTimes,q=u.pendingLanes&-62914561;0<q;){var de=31-Os(q),Oe=1<<de,ot=B[de];ot===-1?((Oe&S)===0||(Oe&I)!==0)&&(B[de]=Do(Oe,g)):ot<=g&&(u.expiredLanes|=Oe),q&=~Oe}if(g=Qt,S=St,S=us(u,u===g?S:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),I=u.callbackNode,S===0||u===g&&(Jt===2||Jt===9)||u.cancelPendingCommit!==null)return I!==null&&I!==null&&Ot(I),u.callbackNode=null,u.callbackPriority=0;if((S&3)===0||Ho(u,S)){if(g=S&-S,g===u.callbackPriority)return g;switch(I!==null&&Ot(I),zl(S)){case 2:case 8:S=Yi;break;case 32:S=or;break;case 268435456:S=ea;break;default:S=or}return I=fb.bind(null,u),S=et(S,I),u.callbackPriority=g,u.callbackNode=S,g}return I!==null&&I!==null&&Ot(I),u.callbackPriority=2,u.callbackNode=null,2}function fb(u,g){if(Pn!==0&&Pn!==5)return u.callbackNode=null,u.callbackPriority=0,null;var S=u.callbackNode;if(gy()&&u.callbackNode!==S)return null;var I=St;return I=us(u,u===Qt?I:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),I===0?null:(Va(u,I,g),hb(u,yn()),u.callbackNode!=null&&u.callbackNode===S?fb.bind(null,u):null)}function pb(u,g){if(gy())return null;Va(u,g,!0)}function mb(){n_(function(){(Rt&6)!==0?et(ci,nv):iv()})}function by(){if(Gd===0){var u=Su;u===0&&(u=Mr,Mr<<=1,(Mr&261888)===0&&(Mr=256)),Gd=u}return Gd}function gb(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:rc(""+u)}function rv(u,g){var S=g.ownerDocument.createElement("input");return S.name=g.name,S.value=g.value,u.id&&S.setAttribute("form",u.id),g.parentNode.insertBefore(S,g),u=new FormData(u),S.parentNode.removeChild(S),u}function RS(u,g,S,I,B){if(g==="submit"&&S&&S.stateNode===B){var q=gb((B[ve]||null).action),de=I.submitter;de&&(g=(g=de[ve]||null)?gb(g.formAction):de.getAttribute("formAction"),g!==null&&(q=g,de=null));var Oe=new sc("action","action",null,I,B);u.push({event:Oe,listeners:[{instance:null,listener:function(){if(I.defaultPrevented){if(Gd!==0){var ot=de?rv(B,de):new FormData(B);eu(S,{pending:!0,data:ot,method:B.method,action:q},null,ot)}}else typeof q=="function"&&(Oe.preventDefault(),ot=de?rv(B,de):new FormData(B),eu(S,{pending:!0,data:ot,method:B.method,action:q},q,ot))},currentTarget:B}]})}}for(var sv=0;sv<Bf.length;sv++){var wy=Bf[sv],_b=wy.toLowerCase(),yb=wy[0].toUpperCase()+wy.slice(1);ra(_b,"on"+yb)}ra(Gp,"onAnimationEnd"),ra(Ff,"onAnimationIteration"),ra(Hp,"onAnimationStart"),ra("dblclick","onDoubleClick"),ra("focusin","onFocus"),ra("focusout","onBlur"),ra(Tg,"onTransitionRun"),ra(ml,"onTransitionStart"),ra(md,"onTransitionCancel"),ra(Ph,"onTransitionEnd"),Lr("onMouseEnter",["mouseout","mouseover"]),Lr("onMouseLeave",["mouseout","mouseover"]),Lr("onPointerEnter",["pointerout","pointerover"]),Lr("onPointerLeave",["pointerout","pointerover"]),Hi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Hi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Hi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Hi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Hi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Hi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rm));function ov(u,g){g=(g&4)!==0;for(var S=0;S<u.length;S++){var I=u[S],B=I.event;I=I.listeners;e:{var q=void 0;if(g)for(var de=I.length-1;0<=de;de--){var Oe=I[de],ot=Oe.instance,Gt=Oe.currentTarget;if(Oe=Oe.listener,ot!==q&&B.isPropagationStopped())break e;q=Oe,B.currentTarget=Gt;try{q(B)}catch(mn){Gc(mn)}B.currentTarget=null,q=ot}else for(de=0;de<I.length;de++){if(Oe=I[de],ot=Oe.instance,Gt=Oe.currentTarget,Oe=Oe.listener,ot!==q&&B.isPropagationStopped())break e;q=Oe,B.currentTarget=Gt;try{q(B)}catch(mn){Gc(mn)}B.currentTarget=null,q=ot}}}}function jr(u,g){var S=g[ke];S===void 0&&(S=g[ke]=new Set);var I=u+"__bubble";S.has(I)||(av(g,u,2,!1),S.add(I))}function Qg(u,g,S){var I=0;g&&(I|=4),av(S,u,I,g)}var su="_reactListening"+Math.random().toString(36).slice(2);function go(u){if(!u[su]){u[su]=!0,pi.forEach(function(S){S!=="selectionchange"&&(xb.has(S)||Qg(S,!1,u),Qg(S,!0,u))});var g=u.nodeType===9?u:u.ownerDocument;g===null||g[su]||(g[su]=!0,Qg("selectionchange",!1,g))}}function av(u,g,S,I){switch(zb(g)){case 2:var B=c_;break;case 8:B=Ob;break;default:B=zy}S=B.bind(null,g,S,u),B=void 0,!If||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(B=!0),I?B!==void 0?u.addEventListener(g,S,{capture:!0,passive:B}):u.addEventListener(g,S,!0):B!==void 0?u.addEventListener(g,S,{passive:B}):u.addEventListener(g,S,!1)}function wp(u,g,S,I,B){var q=I;if((g&1)===0&&(g&2)===0&&I!==null)e:for(;;){if(I===null)return;var de=I.tag;if(de===3||de===4){var Oe=I.stateNode.containerInfo;if(Oe===B)break;if(de===4)for(de=I.return;de!==null;){var ot=de.tag;if((ot===3||ot===4)&&de.stateNode.containerInfo===B)return;de=de.return}for(;Oe!==null;){if(de=It(Oe),de===null)return;if(ot=de.tag,ot===5||ot===6||ot===26||ot===27){I=q=de;continue e}Oe=Oe.parentNode}}I=I.return}jp(function(){var Gt=q,mn=fl(S),xn=[];e:{var Wt=qp.get(u);if(Wt!==void 0){var tn=sc,ni=u;switch(u){case"keypress":if(gu(S)===0)break e;case"keydown":case"keyup":tn=Mn;break;case"focusin":ni="focus",tn=Pf;break;case"focusout":ni="blur",tn=Pf;break;case"beforeblur":case"afterblur":tn=Pf;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tn=sd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tn=Bc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tn=Ah;break;case Gp:case Ff:case Hp:tn=xg;break;case Ph:tn=zf;break;case"scroll":case"scrollend":tn=Fp;break;case"wheel":tn=Lf;break;case"copy":case"cut":case"paste":tn=vg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tn=Xi;break;case"toggle":case"beforetoggle":tn=zs}var Di=(g&4)!==0,Ts=!Di&&(u==="scroll"||u==="scrollend"),Mt=Di?Wt!==null?Wt+"Capture":null:Wt;Di=[];for(var pt=Gt,Ht;pt!==null;){var _n=pt;if(Ht=_n.stateNode,_n=_n.tag,_n!==5&&_n!==26&&_n!==27||Ht===null||Mt===null||(_n=Ll(pt,Mt),_n!=null&&Di.push(Jg(pt,_n,Ht))),Ts)break;pt=pt.return}0<Di.length&&(Wt=new tn(Wt,ni,null,S,mn),xn.push({event:Wt,listeners:Di}))}}if((g&7)===0){e:{if(Wt=u==="mouseover"||u==="pointerover",tn=u==="mouseout"||u==="pointerout",Wt&&S!==xh&&(ni=S.relatedTarget||S.fromElement)&&(It(ni)||ni[je]))break e;if((tn||Wt)&&(Wt=mn.window===mn?mn:(Wt=mn.ownerDocument)?Wt.defaultView||Wt.parentWindow:window,tn?(ni=S.relatedTarget||S.toElement,tn=Gt,ni=ni?It(ni):null,ni!==null&&(Ts=w(ni),Di=ni.tag,ni!==Ts||Di!==5&&Di!==27&&Di!==6)&&(ni=null)):(tn=null,ni=Gt),tn!==ni)){if(Di=sd,_n="onMouseLeave",Mt="onMouseEnter",pt="mouse",(u==="pointerout"||u==="pointerover")&&(Di=Xi,_n="onPointerLeave",Mt="onPointerEnter",pt="pointer"),Ts=tn==null?Wt:$n(tn),Ht=ni==null?Wt:$n(ni),Wt=new Di(_n,pt+"leave",tn,S,mn),Wt.target=Ts,Wt.relatedTarget=Ht,_n=null,It(mn)===Gt&&(Di=new Di(Mt,pt+"enter",ni,S,mn),Di.target=Ht,Di.relatedTarget=Ts,_n=Di),Ts=_n,tn&&ni)t:{for(Di=MS,Mt=tn,pt=ni,Ht=0,_n=Mt;_n;_n=Di(_n))Ht++;_n=0;for(var Pi=pt;Pi;Pi=Di(Pi))_n++;for(;0<Ht-_n;)Mt=Di(Mt),Ht--;for(;0<_n-Ht;)pt=Di(pt),_n--;for(;Ht--;){if(Mt===pt||pt!==null&&Mt===pt.alternate){Di=Mt;break t}Mt=Di(Mt),pt=Di(pt)}Di=null}else Di=null;tn!==null&&vb(xn,Wt,tn,Di,!1),ni!==null&&Ts!==null&&vb(xn,Ts,ni,Di,!0)}}e:{if(Wt=Gt?$n(Gt):window,tn=Wt.nodeName&&Wt.nodeName.toLowerCase(),tn==="select"||tn==="input"&&Wt.type==="file")var os=Yn;else if(kl(Wt))if(cd)os=Wo;else{os=Up;var Ti=cc}else tn=Wt.nodeName,!tn||tn.toLowerCase()!=="input"||Wt.type!=="checkbox"&&Wt.type!=="radio"?Gt&&zo(Gt.elementType)&&(os=Yn):os=ho;if(os&&(os=os(u,Gt))){ac(xn,os,S,mn);break e}Ti&&Ti(u,Wt,Gt),u==="focusout"&&Gt&&Wt.type==="number"&&Gt.memoizedProps.value!=null&&na(Wt,"number",Wt.value)}switch(Ti=Gt?$n(Gt):window,u){case"focusin":(kl(Ti)||Ti.contentEditable==="true")&&(Xo=Ti,$p=Gt,yu=null);break;case"focusout":yu=$p=Xo=null;break;case"mousedown":dd=!0;break;case"contextmenu":case"mouseup":case"dragend":dd=!1,Uc(xn,S,mn);break;case"selectionchange":if(iy)break;case"keydown":case"keyup":Uc(xn,S,mn)}var hr;if(ad)e:{switch(u){case"compositionstart":var qr="onCompositionStart";break e;case"compositionend":qr="onCompositionEnd";break e;case"compositionupdate":qr="onCompositionUpdate";break e}qr=void 0}else uo?Ks(u,S)&&(qr="onCompositionEnd"):u==="keydown"&&S.keyCode===229&&(qr="onCompositionStart");qr&&(kf&&S.locale!=="ko"&&(uo||qr!=="onCompositionStart"?qr==="onCompositionEnd"&&uo&&(hr=bh()):(Ya=mn,Fi="value"in Ya?Ya.value:Ya.textContent,uo=!0)),Ti=Sy(Gt,qr),0<Ti.length&&(qr=new bg(qr,u,null,S,mn),xn.push({event:qr,listeners:Ti}),hr?qr.data=hr:(hr=oc(S),hr!==null&&(qr.data=hr)))),(hr=Nf?Vp(u,S):Rh(u,S))&&(qr=Sy(Gt,"onBeforeInput"),0<qr.length&&(Ti=new bg("onBeforeInput","beforeinput",null,S,mn),xn.push({event:Ti,listeners:qr}),Ti.data=hr)),RS(xn,u,Gt,S,mn)}ov(xn,g)})}function Jg(u,g,S){return{instance:u,listener:g,currentTarget:S}}function Sy(u,g){for(var S=g+"Capture",I=[];u!==null;){var B=u,q=B.stateNode;if(B=B.tag,B!==5&&B!==26&&B!==27||q===null||(B=Ll(u,S),B!=null&&I.unshift(Jg(u,B,q)),B=Ll(u,g),B!=null&&I.push(Jg(u,B,q))),u.tag===3)return I;u=u.return}return[]}function MS(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function vb(u,g,S,I,B){for(var q=g._reactName,de=[];S!==null&&S!==I;){var Oe=S,ot=Oe.alternate,Gt=Oe.stateNode;if(Oe=Oe.tag,ot!==null&&ot===I)break;Oe!==5&&Oe!==26&&Oe!==27||Gt===null||(ot=Gt,B?(Gt=Ll(S,q),Gt!=null&&de.unshift(Jg(S,Gt,ot))):B||(Gt=Ll(S,q),Gt!=null&&de.push(Jg(S,Gt,ot)))),S=S.return}de.length!==0&&u.push({event:g,listeners:de})}var Mm=/\r\n?/g,bb=/\u0000|\uFFFD/g;function af(u){return(typeof u=="string"?u:""+u).replace(Mm,`
`).replace(bb,"")}function Im(u,g){return g=af(g),af(u)===g}function Ms(u,g,S,I,B,q){switch(S){case"children":typeof I=="string"?g==="body"||g==="textarea"&&I===""||ic(u,I):(typeof I=="number"||typeof I=="bigint")&&g!=="body"&&ic(u,""+I);break;case"className":Sr(u,"class",I);break;case"tabIndex":Sr(u,"tabindex",I);break;case"dir":case"role":case"viewBox":case"width":case"height":Sr(u,S,I);break;case"style":dl(u,I,q);break;case"data":if(g!=="object"){Sr(u,"data",I);break}case"src":case"href":if(I===""&&(g!=="a"||S!=="href")){u.removeAttribute(S);break}if(I==null||typeof I=="function"||typeof I=="symbol"||typeof I=="boolean"){u.removeAttribute(S);break}I=rc(""+I),u.setAttribute(S,I);break;case"action":case"formAction":if(typeof I=="function"){u.setAttribute(S,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof q=="function"&&(S==="formAction"?(g!=="input"&&Ms(u,g,"name",B.name,B,null),Ms(u,g,"formEncType",B.formEncType,B,null),Ms(u,g,"formMethod",B.formMethod,B,null),Ms(u,g,"formTarget",B.formTarget,B,null)):(Ms(u,g,"encType",B.encType,B,null),Ms(u,g,"method",B.method,B,null),Ms(u,g,"target",B.target,B,null)));if(I==null||typeof I=="symbol"||typeof I=="boolean"){u.removeAttribute(S);break}I=rc(""+I),u.setAttribute(S,I);break;case"onClick":I!=null&&(u.onclick=hl);break;case"onScroll":I!=null&&jr("scroll",u);break;case"onScrollEnd":I!=null&&jr("scrollend",u);break;case"dangerouslySetInnerHTML":if(I!=null){if(typeof I!="object"||!("__html"in I))throw Error(d(61));if(S=I.__html,S!=null){if(B.children!=null)throw Error(d(60));u.innerHTML=S}}break;case"multiple":u.multiple=I&&typeof I!="function"&&typeof I!="symbol";break;case"muted":u.muted=I&&typeof I!="function"&&typeof I!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(I==null||typeof I=="function"||typeof I=="boolean"||typeof I=="symbol"){u.removeAttribute("xlink:href");break}S=rc(""+I),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",S);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":I!=null&&typeof I!="function"&&typeof I!="symbol"?u.setAttribute(S,""+I):u.removeAttribute(S);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":I&&typeof I!="function"&&typeof I!="symbol"?u.setAttribute(S,""):u.removeAttribute(S);break;case"capture":case"download":I===!0?u.setAttribute(S,""):I!==!1&&I!=null&&typeof I!="function"&&typeof I!="symbol"?u.setAttribute(S,I):u.removeAttribute(S);break;case"cols":case"rows":case"size":case"span":I!=null&&typeof I!="function"&&typeof I!="symbol"&&!isNaN(I)&&1<=I?u.setAttribute(S,I):u.removeAttribute(S);break;case"rowSpan":case"start":I==null||typeof I=="function"||typeof I=="symbol"||isNaN(I)?u.removeAttribute(S):u.setAttribute(S,I);break;case"popover":jr("beforetoggle",u),jr("toggle",u),Ei(u,"popover",I);break;case"xlinkActuate":mr(u,"http://www.w3.org/1999/xlink","xlink:actuate",I);break;case"xlinkArcrole":mr(u,"http://www.w3.org/1999/xlink","xlink:arcrole",I);break;case"xlinkRole":mr(u,"http://www.w3.org/1999/xlink","xlink:role",I);break;case"xlinkShow":mr(u,"http://www.w3.org/1999/xlink","xlink:show",I);break;case"xlinkTitle":mr(u,"http://www.w3.org/1999/xlink","xlink:title",I);break;case"xlinkType":mr(u,"http://www.w3.org/1999/xlink","xlink:type",I);break;case"xmlBase":mr(u,"http://www.w3.org/XML/1998/namespace","xml:base",I);break;case"xmlLang":mr(u,"http://www.w3.org/XML/1998/namespace","xml:lang",I);break;case"xmlSpace":mr(u,"http://www.w3.org/XML/1998/namespace","xml:space",I);break;case"is":Ei(u,"is",I);break;case"innerText":case"textContent":break;default:(!(2<S.length)||S[0]!=="o"&&S[0]!=="O"||S[1]!=="n"&&S[1]!=="N")&&(S=Xa.get(S)||S,Ei(u,S,I))}}function lv(u,g,S,I,B,q){switch(S){case"style":dl(u,I,q);break;case"dangerouslySetInnerHTML":if(I!=null){if(typeof I!="object"||!("__html"in I))throw Error(d(61));if(S=I.__html,S!=null){if(B.children!=null)throw Error(d(60));u.innerHTML=S}}break;case"children":typeof I=="string"?ic(u,I):(typeof I=="number"||typeof I=="bigint")&&ic(u,""+I);break;case"onScroll":I!=null&&jr("scroll",u);break;case"onScrollEnd":I!=null&&jr("scrollend",u);break;case"onClick":I!=null&&(u.onclick=hl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_i.hasOwnProperty(S))e:{if(S[0]==="o"&&S[1]==="n"&&(B=S.endsWith("Capture"),g=S.slice(2,B?S.length-7:void 0),q=u[ve]||null,q=q!=null?q[S]:null,typeof q=="function"&&u.removeEventListener(g,q,B),typeof I=="function")){typeof q!="function"&&q!==null&&(S in u?u[S]=null:u.hasAttribute(S)&&u.removeAttribute(S)),u.addEventListener(g,I,B);break e}S in u?u[S]=I:I===!0?u.setAttribute(S,""):Ei(u,S,I)}}}function Sa(u,g,S){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jr("error",u),jr("load",u);var I=!1,B=!1,q;for(q in S)if(S.hasOwnProperty(q)){var de=S[q];if(de!=null)switch(q){case"src":I=!0;break;case"srcSet":B=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(d(137,g));default:Ms(u,g,q,de,S,null)}}B&&Ms(u,g,"srcSet",S.srcSet,S,null),I&&Ms(u,g,"src",S.src,S,null);return;case"input":jr("invalid",u);var Oe=q=de=B=null,ot=null,Gt=null;for(I in S)if(S.hasOwnProperty(I)){var mn=S[I];if(mn!=null)switch(I){case"name":B=mn;break;case"type":de=mn;break;case"checked":ot=mn;break;case"defaultChecked":Gt=mn;break;case"value":q=mn;break;case"defaultValue":Oe=mn;break;case"children":case"dangerouslySetInnerHTML":if(mn!=null)throw Error(d(137,g));break;default:Ms(u,g,I,mn,S,null)}}ul(u,q,Oe,ot,Gt,de,B,!1);return;case"select":jr("invalid",u),I=de=q=null;for(B in S)if(S.hasOwnProperty(B)&&(Oe=S[B],Oe!=null))switch(B){case"value":q=Oe;break;case"defaultValue":de=Oe;break;case"multiple":I=Oe;default:Ms(u,g,B,Oe,S,null)}g=q,S=de,u.multiple=!!I,g!=null?To(u,!!I,g,!1):S!=null&&To(u,!!I,S,!0);return;case"textarea":jr("invalid",u),q=B=I=null;for(de in S)if(S.hasOwnProperty(de)&&(Oe=S[de],Oe!=null))switch(de){case"value":I=Oe;break;case"defaultValue":B=Oe;break;case"children":q=Oe;break;case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(d(91));break;default:Ms(u,g,de,Oe,S,null)}yh(u,I,B,q);return;case"option":for(ot in S)if(S.hasOwnProperty(ot)&&(I=S[ot],I!=null))switch(ot){case"selected":u.selected=I&&typeof I!="function"&&typeof I!="symbol";break;default:Ms(u,g,ot,I,S,null)}return;case"dialog":jr("beforetoggle",u),jr("toggle",u),jr("cancel",u),jr("close",u);break;case"iframe":case"object":jr("load",u);break;case"video":case"audio":for(I=0;I<Rm.length;I++)jr(Rm[I],u);break;case"image":jr("error",u),jr("load",u);break;case"details":jr("toggle",u);break;case"embed":case"source":case"link":jr("error",u),jr("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Gt in S)if(S.hasOwnProperty(Gt)&&(I=S[Gt],I!=null))switch(Gt){case"children":case"dangerouslySetInnerHTML":throw Error(d(137,g));default:Ms(u,g,Gt,I,S,null)}return;default:if(zo(g)){for(mn in S)S.hasOwnProperty(mn)&&(I=S[mn],I!==void 0&&lv(u,g,mn,I,S,void 0));return}}for(Oe in S)S.hasOwnProperty(Oe)&&(I=S[Oe],I!=null&&Ms(u,g,Oe,I,S,null))}function IS(u,g,S,I){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var B=null,q=null,de=null,Oe=null,ot=null,Gt=null,mn=null;for(tn in S){var xn=S[tn];if(S.hasOwnProperty(tn)&&xn!=null)switch(tn){case"checked":break;case"value":break;case"defaultValue":ot=xn;default:I.hasOwnProperty(tn)||Ms(u,g,tn,null,I,xn)}}for(var Wt in I){var tn=I[Wt];if(xn=S[Wt],I.hasOwnProperty(Wt)&&(tn!=null||xn!=null))switch(Wt){case"type":q=tn;break;case"name":B=tn;break;case"checked":Gt=tn;break;case"defaultChecked":mn=tn;break;case"value":de=tn;break;case"defaultValue":Oe=tn;break;case"children":case"dangerouslySetInnerHTML":if(tn!=null)throw Error(d(137,g));break;default:tn!==xn&&Ms(u,g,Wt,tn,I,xn)}}Oo(u,de,Oe,ot,Gt,mn,q,B);return;case"select":tn=de=Oe=Wt=null;for(q in S)if(ot=S[q],S.hasOwnProperty(q)&&ot!=null)switch(q){case"value":break;case"multiple":tn=ot;default:I.hasOwnProperty(q)||Ms(u,g,q,null,I,ot)}for(B in I)if(q=I[B],ot=S[B],I.hasOwnProperty(B)&&(q!=null||ot!=null))switch(B){case"value":Wt=q;break;case"defaultValue":Oe=q;break;case"multiple":de=q;default:q!==ot&&Ms(u,g,B,q,I,ot)}g=Oe,S=de,I=tn,Wt!=null?To(u,!!S,Wt,!1):!!I!=!!S&&(g!=null?To(u,!!S,g,!0):To(u,!!S,S?[]:"",!1));return;case"textarea":tn=Wt=null;for(Oe in S)if(B=S[Oe],S.hasOwnProperty(Oe)&&B!=null&&!I.hasOwnProperty(Oe))switch(Oe){case"value":break;case"children":break;default:Ms(u,g,Oe,null,I,B)}for(de in I)if(B=I[de],q=S[de],I.hasOwnProperty(de)&&(B!=null||q!=null))switch(de){case"value":Wt=B;break;case"defaultValue":tn=B;break;case"children":break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(d(91));break;default:B!==q&&Ms(u,g,de,B,I,q)}Rf(u,Wt,tn);return;case"option":for(var ni in S)if(Wt=S[ni],S.hasOwnProperty(ni)&&Wt!=null&&!I.hasOwnProperty(ni))switch(ni){case"selected":u.selected=!1;break;default:Ms(u,g,ni,null,I,Wt)}for(ot in I)if(Wt=I[ot],tn=S[ot],I.hasOwnProperty(ot)&&Wt!==tn&&(Wt!=null||tn!=null))switch(ot){case"selected":u.selected=Wt&&typeof Wt!="function"&&typeof Wt!="symbol";break;default:Ms(u,g,ot,Wt,I,tn)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Di in S)Wt=S[Di],S.hasOwnProperty(Di)&&Wt!=null&&!I.hasOwnProperty(Di)&&Ms(u,g,Di,null,I,Wt);for(Gt in I)if(Wt=I[Gt],tn=S[Gt],I.hasOwnProperty(Gt)&&Wt!==tn&&(Wt!=null||tn!=null))switch(Gt){case"children":case"dangerouslySetInnerHTML":if(Wt!=null)throw Error(d(137,g));break;default:Ms(u,g,Gt,Wt,I,tn)}return;default:if(zo(g)){for(var Ts in S)Wt=S[Ts],S.hasOwnProperty(Ts)&&Wt!==void 0&&!I.hasOwnProperty(Ts)&&lv(u,g,Ts,void 0,I,Wt);for(mn in I)Wt=I[mn],tn=S[mn],!I.hasOwnProperty(mn)||Wt===tn||Wt===void 0&&tn===void 0||lv(u,g,mn,Wt,I,tn);return}}for(var Mt in S)Wt=S[Mt],S.hasOwnProperty(Mt)&&Wt!=null&&!I.hasOwnProperty(Mt)&&Ms(u,g,Mt,null,I,Wt);for(xn in I)Wt=I[xn],tn=S[xn],!I.hasOwnProperty(xn)||Wt===tn||Wt==null&&tn==null||Ms(u,g,xn,Wt,I,tn)}function wb(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function DS(){if(typeof performance.getEntriesByType=="function"){for(var u=0,g=0,S=performance.getEntriesByType("resource"),I=0;I<S.length;I++){var B=S[I],q=B.transferSize,de=B.initiatorType,Oe=B.duration;if(q&&Oe&&wb(de)){for(de=0,Oe=B.responseEnd,I+=1;I<S.length;I++){var ot=S[I],Gt=ot.startTime;if(Gt>Oe)break;var mn=ot.transferSize,xn=ot.initiatorType;mn&&wb(xn)&&(ot=ot.responseEnd,de+=mn*(ot<Oe?1:(Oe-Gt)/(ot-Gt)))}if(--I,g+=8*(q+de)/(B.duration/1e3),u++,10<u)break}}if(0<u)return g/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var cv=null,e_=null;function Ty(u){return u.nodeType===9?u:u.ownerDocument}function uv(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Dm(u,g){if(u===0)switch(g){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&g==="foreignObject"?0:u}function dv(u,g){return u==="textarea"||u==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.children=="bigint"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Hs=null;function Pm(){var u=window.event;return u&&u.type==="popstate"?u===Hs?!1:(Hs=u,!0):(Hs=null,!1)}var hv=typeof setTimeout=="function"?setTimeout:void 0,Ey=typeof clearTimeout=="function"?clearTimeout:void 0,t_=typeof Promise=="function"?Promise:void 0,n_=typeof queueMicrotask=="function"?queueMicrotask:typeof t_<"u"?function(u){return t_.resolve(null).then(u).catch(Sb)}:hv;function Sb(u){setTimeout(function(){throw u})}function Hd(u){return u==="head"}function Om(u,g){var S=g,I=0;do{var B=S.nextSibling;if(u.removeChild(S),B&&B.nodeType===8)if(S=B.data,S==="/$"||S==="/&"){if(I===0){u.removeChild(B),Yd(g);return}I--}else if(S==="$"||S==="$?"||S==="$~"||S==="$!"||S==="&")I++;else if(S==="html")lf(u.ownerDocument.documentElement);else if(S==="head"){S=u.ownerDocument.head,lf(S);for(var q=S.firstChild;q;){var de=q.nextSibling,Oe=q.nodeName;q[nt]||Oe==="SCRIPT"||Oe==="STYLE"||Oe==="LINK"&&q.rel.toLowerCase()==="stylesheet"||S.removeChild(q),q=de}}else S==="body"&&lf(u.ownerDocument.body);S=B}while(S);Yd(g)}function Ay(u,g){var S=u;u=0;do{var I=S.nextSibling;if(S.nodeType===1?g?(S._stashedDisplay=S.style.display,S.style.display="none"):(S.style.display=S._stashedDisplay||"",S.getAttribute("style")===""&&S.removeAttribute("style")):S.nodeType===3&&(g?(S._stashedText=S.nodeValue,S.nodeValue=""):S.nodeValue=S._stashedText||""),I&&I.nodeType===8)if(S=I.data,S==="/$"){if(u===0)break;u--}else S!=="$"&&S!=="$?"&&S!=="$~"&&S!=="$!"||u++;S=I}while(S)}function Sp(u){var g=u.firstChild;for(g&&g.nodeType===10&&(g=g.nextSibling);g;){var S=g;switch(g=g.nextSibling,S.nodeName){case"HTML":case"HEAD":case"BODY":Sp(S),Bt(S);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(S.rel.toLowerCase()==="stylesheet")continue}u.removeChild(S)}}function PS(u,g,S,I){for(;u.nodeType===1;){var B=S;if(u.nodeName.toLowerCase()!==g.toLowerCase()){if(!I&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(I){if(!u[nt])switch(g){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(q=u.getAttribute("rel"),q==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(q!==B.rel||u.getAttribute("href")!==(B.href==null||B.href===""?null:B.href)||u.getAttribute("crossorigin")!==(B.crossOrigin==null?null:B.crossOrigin)||u.getAttribute("title")!==(B.title==null?null:B.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(q=u.getAttribute("src"),(q!==(B.src==null?null:B.src)||u.getAttribute("type")!==(B.type==null?null:B.type)||u.getAttribute("crossorigin")!==(B.crossOrigin==null?null:B.crossOrigin))&&q&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(g==="input"&&u.type==="hidden"){var q=B.name==null?null:""+B.name;if(B.type==="hidden"&&u.getAttribute("name")===q)return u}else return u;if(u=Mc(u.nextSibling),u===null)break}return null}function Tb(u,g,S){if(g==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!S||(u=Mc(u.nextSibling),u===null))return null;return u}function Cy(u,g){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!g||(u=Mc(u.nextSibling),u===null))return null;return u}function i_(u){return u.data==="$?"||u.data==="$~"}function Ry(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function qd(u,g){var S=u.ownerDocument;if(u.data==="$~")u._reactRetry=g;else if(u.data!=="$?"||S.readyState!=="loading")g();else{var I=function(){g(),S.removeEventListener("DOMContentLoaded",I)};S.addEventListener("DOMContentLoaded",I),u._reactRetry=I}}function Mc(u){for(;u!=null;u=u.nextSibling){var g=u.nodeType;if(g===1||g===3)break;if(g===8){if(g=u.data,g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"||g==="F!"||g==="F")break;if(g==="/$"||g==="/&")return null}}return u}var Ta=null;function fv(u){u=u.nextSibling;for(var g=0;u;){if(u.nodeType===8){var S=u.data;if(S==="/$"||S==="/&"){if(g===0)return Mc(u.nextSibling);g--}else S!=="$"&&S!=="$!"&&S!=="$?"&&S!=="$~"&&S!=="&"||g++}u=u.nextSibling}return null}function pv(u){u=u.previousSibling;for(var g=0;u;){if(u.nodeType===8){var S=u.data;if(S==="$"||S==="$!"||S==="$?"||S==="$~"||S==="&"){if(g===0)return u;g--}else S!=="/$"&&S!=="/&"||g++}u=u.previousSibling}return null}function mv(u,g,S){switch(g=Ty(S),u){case"html":if(u=g.documentElement,!u)throw Error(d(452));return u;case"head":if(u=g.head,!u)throw Error(d(453));return u;case"body":if(u=g.body,!u)throw Error(d(454));return u;default:throw Error(d(451))}}function lf(u){for(var g=u.attributes;g.length;)u.removeAttributeNode(g[0]);Bt(u)}var Ic=new Map,Eb=new Set;function zm(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var Vu=ze.d;ze.d={f:gv,r:_v,D:Ab,C:Cb,L:My,m:Uu,X:OS,S:Rb,M:zS};function gv(){var u=Vu.f(),g=is();return u||g}function _v(u){var g=vn(u);g!==null&&g.tag===5&&g.type==="form"?Ac(g):Vu.r(u)}var Tp=typeof document>"u"?null:document;function yv(u,g,S){var I=Tp;if(I&&typeof g=="string"&&g){var B=Bs(g);B='link[rel="'+u+'"][href="'+B+'"]',typeof S=="string"&&(B+='[crossorigin="'+S+'"]'),Eb.has(B)||(Eb.add(B),u={rel:u,crossOrigin:S,href:g},I.querySelector(B)===null&&(g=I.createElement("link"),Sa(g,"link",u),Tn(g),I.head.appendChild(g)))}}function Ab(u){Vu.D(u),yv("dns-prefetch",u,null)}function Cb(u,g){Vu.C(u,g),yv("preconnect",u,g)}function My(u,g,S){Vu.L(u,g,S);var I=Tp;if(I&&u&&g){var B='link[rel="preload"][as="'+Bs(g)+'"]';g==="image"&&S&&S.imageSrcSet?(B+='[imagesrcset="'+Bs(S.imageSrcSet)+'"]',typeof S.imageSizes=="string"&&(B+='[imagesizes="'+Bs(S.imageSizes)+'"]')):B+='[href="'+Bs(u)+'"]';var q=B;switch(g){case"style":q=Lm(u);break;case"script":q=Nm(u)}Ic.has(q)||(u=H({rel:"preload",href:g==="image"&&S&&S.imageSrcSet?void 0:u,as:g},S),Ic.set(q,u),I.querySelector(B)!==null||g==="style"&&I.querySelector(r_(q))||g==="script"&&I.querySelector(Zd(q))||(g=I.createElement("link"),Sa(g,"link",u),Tn(g),I.head.appendChild(g)))}}function Uu(u,g){Vu.m(u,g);var S=Tp;if(S&&u){var I=g&&typeof g.as=="string"?g.as:"script",B='link[rel="modulepreload"][as="'+Bs(I)+'"][href="'+Bs(u)+'"]',q=B;switch(I){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":q=Nm(u)}if(!Ic.has(q)&&(u=H({rel:"modulepreload",href:u},g),Ic.set(q,u),S.querySelector(B)===null)){switch(I){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(S.querySelector(Zd(q)))return}I=S.createElement("link"),Sa(I,"link",u),Tn(I),S.head.appendChild(I)}}}function Rb(u,g,S){Vu.S(u,g,S);var I=Tp;if(I&&u){var B=Bn(I).hoistableStyles,q=Lm(u);g=g||"default";var de=B.get(q);if(!de){var Oe={loading:0,preload:null};if(de=I.querySelector(r_(q)))Oe.loading=5;else{u=H({rel:"stylesheet",href:u,"data-precedence":g},S),(S=Ic.get(q))&&km(u,S);var ot=de=I.createElement("link");Tn(ot),Sa(ot,"link",u),ot._p=new Promise(function(Gt,mn){ot.onload=Gt,ot.onerror=mn}),ot.addEventListener("load",function(){Oe.loading|=1}),ot.addEventListener("error",function(){Oe.loading|=2}),Oe.loading|=4,s_(de,g,I)}de={type:"stylesheet",instance:de,count:1,state:Oe},B.set(q,de)}}}function OS(u,g){Vu.X(u,g);var S=Tp;if(S&&u){var I=Bn(S).hoistableScripts,B=Nm(u),q=I.get(B);q||(q=S.querySelector(Zd(B)),q||(u=H({src:u,async:!0},g),(g=Ic.get(B))&&Iy(u,g),q=S.createElement("script"),Tn(q),Sa(q,"link",u),S.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},I.set(B,q))}}function zS(u,g){Vu.M(u,g);var S=Tp;if(S&&u){var I=Bn(S).hoistableScripts,B=Nm(u),q=I.get(B);q||(q=S.querySelector(Zd(B)),q||(u=H({src:u,async:!0,type:"module"},g),(g=Ic.get(B))&&Iy(u,g),q=S.createElement("script"),Tn(q),Sa(q,"link",u),S.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},I.set(B,q))}}function Mb(u,g,S,I){var B=(B=Nn.current)?zm(B):null;if(!B)throw Error(d(446));switch(u){case"meta":case"title":return null;case"style":return typeof S.precedence=="string"&&typeof S.href=="string"?(g=Lm(S.href),S=Bn(B).hoistableStyles,I=S.get(g),I||(I={type:"style",instance:null,count:0,state:null},S.set(g,I)),I):{type:"void",instance:null,count:0,state:null};case"link":if(S.rel==="stylesheet"&&typeof S.href=="string"&&typeof S.precedence=="string"){u=Lm(S.href);var q=Bn(B).hoistableStyles,de=q.get(u);if(de||(B=B.ownerDocument||B,de={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},q.set(u,de),(q=B.querySelector(r_(u)))&&!q._p&&(de.instance=q,de.state.loading=5),Ic.has(u)||(S={rel:"preload",as:"style",href:S.href,crossOrigin:S.crossOrigin,integrity:S.integrity,media:S.media,hrefLang:S.hrefLang,referrerPolicy:S.referrerPolicy},Ic.set(u,S),q||LS(B,u,S,de.state))),g&&I===null)throw Error(d(528,""));return de}if(g&&I!==null)throw Error(d(529,""));return null;case"script":return g=S.async,S=S.src,typeof S=="string"&&g&&typeof g!="function"&&typeof g!="symbol"?(g=Nm(S),S=Bn(B).hoistableScripts,I=S.get(g),I||(I={type:"script",instance:null,count:0,state:null},S.set(g,I)),I):{type:"void",instance:null,count:0,state:null};default:throw Error(d(444,u))}}function Lm(u){return'href="'+Bs(u)+'"'}function r_(u){return'link[rel="stylesheet"]['+u+"]"}function Ib(u){return H({},u,{"data-precedence":u.precedence,precedence:null})}function LS(u,g,S,I){u.querySelector('link[rel="preload"][as="style"]['+g+"]")?I.loading=1:(g=u.createElement("link"),I.preload=g,g.addEventListener("load",function(){return I.loading|=1}),g.addEventListener("error",function(){return I.loading|=2}),Sa(g,"link",S),Tn(g),u.head.appendChild(g))}function Nm(u){return'[src="'+Bs(u)+'"]'}function Zd(u){return"script[async]"+u}function xv(u,g,S){if(g.count++,g.instance===null)switch(g.type){case"style":var I=u.querySelector('style[data-href~="'+Bs(S.href)+'"]');if(I)return g.instance=I,Tn(I),I;var B=H({},S,{"data-href":S.href,"data-precedence":S.precedence,href:null,precedence:null});return I=(u.ownerDocument||u).createElement("style"),Tn(I),Sa(I,"style",B),s_(I,S.precedence,u),g.instance=I;case"stylesheet":B=Lm(S.href);var q=u.querySelector(r_(B));if(q)return g.state.loading|=4,g.instance=q,Tn(q),q;I=Ib(S),(B=Ic.get(B))&&km(I,B),q=(u.ownerDocument||u).createElement("link"),Tn(q);var de=q;return de._p=new Promise(function(Oe,ot){de.onload=Oe,de.onerror=ot}),Sa(q,"link",I),g.state.loading|=4,s_(q,S.precedence,u),g.instance=q;case"script":return q=Nm(S.src),(B=u.querySelector(Zd(q)))?(g.instance=B,Tn(B),B):(I=S,(B=Ic.get(q))&&(I=H({},S),Iy(I,B)),u=u.ownerDocument||u,B=u.createElement("script"),Tn(B),Sa(B,"link",I),u.head.appendChild(B),g.instance=B);case"void":return null;default:throw Error(d(443,g.type))}else g.type==="stylesheet"&&(g.state.loading&4)===0&&(I=g.instance,g.state.loading|=4,s_(I,S.precedence,u));return g.instance}function s_(u,g,S){for(var I=S.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),B=I.length?I[I.length-1]:null,q=B,de=0;de<I.length;de++){var Oe=I[de];if(Oe.dataset.precedence===g)q=Oe;else if(q!==B)break}q?q.parentNode.insertBefore(u,q.nextSibling):(g=S.nodeType===9?S.head:S,g.insertBefore(u,g.firstChild))}function km(u,g){u.crossOrigin==null&&(u.crossOrigin=g.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=g.referrerPolicy),u.title==null&&(u.title=g.title)}function Iy(u,g){u.crossOrigin==null&&(u.crossOrigin=g.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=g.referrerPolicy),u.integrity==null&&(u.integrity=g.integrity)}var jm=null;function o_(u,g,S){if(jm===null){var I=new Map,B=jm=new Map;B.set(S,I)}else B=jm,I=B.get(S),I||(I=new Map,B.set(S,I));if(I.has(u))return I;for(I.set(u,null),S=S.getElementsByTagName(u),B=0;B<S.length;B++){var q=S[B];if(!(q[nt]||q[se]||u==="link"&&q.getAttribute("rel")==="stylesheet")&&q.namespaceURI!=="http://www.w3.org/2000/svg"){var de=q.getAttribute(g)||"";de=u+de;var Oe=I.get(de);Oe?Oe.push(q):I.set(de,[q])}}return I}function vv(u,g,S){u=u.ownerDocument||u,u.head.insertBefore(S,g==="title"?u.querySelector("head > title"):null)}function NS(u,g,S){if(S===1||g.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof g.precedence!="string"||typeof g.href!="string"||g.href==="")break;return!0;case"link":if(typeof g.rel!="string"||typeof g.href!="string"||g.href===""||g.onLoad||g.onError)break;switch(g.rel){case"stylesheet":return u=g.disabled,typeof g.precedence=="string"&&u==null;default:return!0}case"script":if(g.async&&typeof g.async!="function"&&typeof g.async!="symbol"&&!g.onLoad&&!g.onError&&g.src&&typeof g.src=="string")return!0}return!1}function Dy(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function Db(u,g,S,I){if(S.type==="stylesheet"&&(typeof I.media!="string"||matchMedia(I.media).matches!==!1)&&(S.state.loading&4)===0){if(S.instance===null){var B=Lm(I.href),q=g.querySelector(r_(B));if(q){g=q._p,g!==null&&typeof g=="object"&&typeof g.then=="function"&&(u.count++,u=Fm.bind(u),g.then(u,u)),S.state.loading|=4,S.instance=q,Tn(q);return}q=g.ownerDocument||g,I=Ib(I),(B=Ic.get(B))&&km(I,B),q=q.createElement("link"),Tn(q);var de=q;de._p=new Promise(function(Oe,ot){de.onload=Oe,de.onerror=ot}),Sa(q,"link",I),S.instance=q}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(S,g),(g=S.state.preload)&&(S.state.loading&3)===0&&(u.count++,S=Fm.bind(u),g.addEventListener("load",S),g.addEventListener("error",S))}}var Py=0;function bv(u,g){return u.stylesheets&&u.count===0&&Bm(u,u.stylesheets),0<u.count||0<u.imgCount?function(S){var I=setTimeout(function(){if(u.stylesheets&&Bm(u,u.stylesheets),u.unsuspend){var q=u.unsuspend;u.unsuspend=null,q()}},6e4+g);0<u.imgBytes&&Py===0&&(Py=62500*DS());var B=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&Bm(u,u.stylesheets),u.unsuspend)){var q=u.unsuspend;u.unsuspend=null,q()}},(u.imgBytes>Py?50:800)+g);return u.unsuspend=S,function(){u.unsuspend=null,clearTimeout(I),clearTimeout(B)}}:null}function Fm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Bm(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var a_=null;function Bm(u,g){u.stylesheets=null,u.unsuspend!==null&&(u.count++,a_=new Map,g.forEach(kS,u),a_=null,Fm.call(u))}function kS(u,g){if(!(g.state.loading&4)){var S=a_.get(u);if(S)var I=S.get(null);else{S=new Map,a_.set(u,S);for(var B=u.querySelectorAll("link[data-precedence],style[data-precedence]"),q=0;q<B.length;q++){var de=B[q];(de.nodeName==="LINK"||de.getAttribute("media")!=="not all")&&(S.set(de.dataset.precedence,de),I=de)}I&&S.set(null,I)}B=g.instance,de=B.getAttribute("data-precedence"),q=S.get(de)||I,q===I&&S.set(null,B),S.set(de,B),this.count++,I=Fm.bind(this),B.addEventListener("load",I),B.addEventListener("error",I),q?q.parentNode.insertBefore(B,q.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(B,u.firstChild)),g.state.loading|=4}}var l_={$$typeof:_e,Provider:null,Consumer:null,_currentValue:Fe,_currentValue2:Fe,_threadCount:0};function jS(u,g,S,I,B,q,de,Oe,ot){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=wo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wo(0),this.hiddenUpdates=wo(null),this.identifierPrefix=I,this.onUncaughtError=B,this.onCaughtError=q,this.onRecoverableError=de,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ot,this.incompleteTransitions=new Map}function Pb(u,g,S,I,B,q,de,Oe,ot,Gt,mn,xn){return u=new jS(u,g,S,de,ot,Gt,mn,xn,Oe),g=1,q===!0&&(g|=24),q=sa(3,null,null,g),u.current=q,q.stateNode=u,g=Wf(),g.refCount++,u.pooledCache=g,g.refCount++,q.memoizedState={element:I,isDehydrated:S,cache:g},np(q),u}function wv(u){return u?(u=dc,u):dc}function Wd(u,g,S,I,B,q){B=wv(B),I.context===null?I.context=B:I.pendingContext=B,I=xc(g),I.payload={element:S},q=q===void 0?null:q,q!==null&&(I.callback=q),S=vc(u,I,g),S!==null&&(ns(S,u,g),Ru(S,u,g))}function Sv(u,g){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var S=u.retryLane;u.retryLane=S!==0&&S<g?S:g}}function Oy(u,g){Sv(u,g),(u=u.alternate)&&Sv(u,g)}function Vm(u){if(u.tag===13||u.tag===31){var g=gl(u,67108864);g!==null&&ns(g,u,67108864),Oy(u,67108864)}}function Um(u){if(u.tag===13||u.tag===31){var g=ps();g=Ds(g);var S=gl(u,g);S!==null&&ns(S,u,g),Oy(u,g)}}var Ep=!0;function c_(u,g,S,I){var B=Ke.T;Ke.T=null;var q=ze.p;try{ze.p=2,zy(u,g,S,I)}finally{ze.p=q,Ke.T=B}}function Ob(u,g,S,I){var B=Ke.T;Ke.T=null;var q=ze.p;try{ze.p=8,zy(u,g,S,I)}finally{ze.p=q,Ke.T=B}}function zy(u,g,S,I){if(Ep){var B=Ly(I);if(B===null)wp(u,g,I,u_,S),Ev(u,I);else if(Nb(B,u,g,S,I))I.stopPropagation();else if(Ev(u,I),g&4&&-1<Lb.indexOf(u)){for(;B!==null;){var q=vn(B);if(q!==null)switch(q.tag){case 3:if(q=q.stateNode,q.current.memoizedState.isDehydrated){var de=bs(q.pendingLanes);if(de!==0){var Oe=q;for(Oe.pendingLanes|=2,Oe.entangledLanes|=2;de;){var ot=1<<31-Os(de);Oe.entanglements[1]|=ot,de&=~ot}wa(q),(Rt&6)===0&&(di=yn()+500,Cm(0))}}break;case 31:case 13:Oe=gl(q,2),Oe!==null&&ns(Oe,q,2),is(),Oy(q,2)}if(q=Ly(I),q===null&&wp(u,g,I,u_,S),q===B)break;B=q}B!==null&&I.stopPropagation()}else wp(u,g,I,null,S)}}function Ly(u){return u=fl(u),Tv(u)}var u_=null;function Tv(u){if(u_=null,u=It(u),u!==null){var g=w(u);if(g===null)u=null;else{var S=g.tag;if(S===13){if(u=E(g),u!==null)return u;u=null}else if(S===31){if(u=s(g),u!==null)return u;u=null}else if(S===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;u=null}else g!==u&&(u=null)}}return u_=u,null}function zb(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Dn()){case ci:return 2;case Yi:return 8;case or:case Gr:return 32;case ea:return 268435456;default:return 32}default:return 32}}var d_=!1,ou=null,Xd=null,cf=null,$m=new Map,Ap=new Map,Kd=[],Lb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ev(u,g){switch(u){case"focusin":case"focusout":ou=null;break;case"dragenter":case"dragleave":Xd=null;break;case"mouseover":case"mouseout":cf=null;break;case"pointerover":case"pointerout":$m.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ap.delete(g.pointerId)}}function Gm(u,g,S,I,B,q){return u===null||u.nativeEvent!==q?(u={blockedOn:g,domEventName:S,eventSystemFlags:I,nativeEvent:q,targetContainers:[B]},g!==null&&(g=vn(g),g!==null&&Vm(g)),u):(u.eventSystemFlags|=I,g=u.targetContainers,B!==null&&g.indexOf(B)===-1&&g.push(B),u)}function Nb(u,g,S,I,B){switch(g){case"focusin":return ou=Gm(ou,u,g,S,I,B),!0;case"dragenter":return Xd=Gm(Xd,u,g,S,I,B),!0;case"mouseover":return cf=Gm(cf,u,g,S,I,B),!0;case"pointerover":var q=B.pointerId;return $m.set(q,Gm($m.get(q)||null,u,g,S,I,B)),!0;case"gotpointercapture":return q=B.pointerId,Ap.set(q,Gm(Ap.get(q)||null,u,g,S,I,B)),!0}return!1}function kb(u){var g=It(u.target);if(g!==null){var S=w(g);if(S!==null){if(g=S.tag,g===13){if(g=E(S),g!==null){u.blockedOn=g,We(u.priority,function(){Um(S)});return}}else if(g===31){if(g=s(S),g!==null){u.blockedOn=g,We(u.priority,function(){Um(S)});return}}else if(g===3&&S.stateNode.current.memoizedState.isDehydrated){u.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}u.blockedOn=null}function h_(u){if(u.blockedOn!==null)return!1;for(var g=u.targetContainers;0<g.length;){var S=Ly(u.nativeEvent);if(S===null){S=u.nativeEvent;var I=new S.constructor(S.type,S);xh=I,S.target.dispatchEvent(I),xh=null}else return g=vn(S),g!==null&&Vm(g),u.blockedOn=S,!1;g.shift()}return!0}function Av(u,g,S){h_(u)&&S.delete(g)}function Cp(){d_=!1,ou!==null&&h_(ou)&&(ou=null),Xd!==null&&h_(Xd)&&(Xd=null),cf!==null&&h_(cf)&&(cf=null),$m.forEach(Av),Ap.forEach(Av)}function f_(u,g){u.blockedOn===g&&(u.blockedOn=null,d_||(d_=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Cp)))}var p_=null;function Cv(u){p_!==u&&(p_=u,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){p_===u&&(p_=null);for(var g=0;g<u.length;g+=3){var S=u[g],I=u[g+1],B=u[g+2];if(typeof I!="function"){if(Tv(I||S)===null)continue;break}var q=vn(S);q!==null&&(u.splice(g,3),g-=3,eu(q,{pending:!0,data:B,method:S.method,action:I},I,B))}}))}function Yd(u){function g(ot){return f_(ot,u)}ou!==null&&f_(ou,u),Xd!==null&&f_(Xd,u),cf!==null&&f_(cf,u),$m.forEach(g),Ap.forEach(g);for(var S=0;S<Kd.length;S++){var I=Kd[S];I.blockedOn===u&&(I.blockedOn=null)}for(;0<Kd.length&&(S=Kd[0],S.blockedOn===null);)kb(S),S.blockedOn===null&&Kd.shift();if(S=(u.ownerDocument||u).$$reactFormReplay,S!=null)for(I=0;I<S.length;I+=3){var B=S[I],q=S[I+1],de=B[ve]||null;if(typeof q=="function")de||Cv(S);else if(de){var Oe=null;if(q&&q.hasAttribute("formAction")){if(B=q,de=q[ve]||null)Oe=de.formAction;else if(Tv(B)!==null)continue}else Oe=de.action;typeof Oe=="function"?S[I+1]=Oe:(S.splice(I,3),I-=3),Cv(S)}}}function jb(){function u(q){q.canIntercept&&q.info==="react-transition"&&q.intercept({handler:function(){return new Promise(function(de){return B=de})},focusReset:"manual",scroll:"manual"})}function g(){B!==null&&(B(),B=null),I||setTimeout(S,20)}function S(){if(!I&&!navigation.transition){var q=navigation.currentEntry;q&&q.url!=null&&navigation.navigate(q.url,{state:q.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var I=!1,B=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",g),navigation.addEventListener("navigateerror",g),setTimeout(S,100),function(){I=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",g),navigation.removeEventListener("navigateerror",g),B!==null&&(B(),B=null)}}}function Ny(u){this._internalRoot=u}uf.prototype.render=Ny.prototype.render=function(u){var g=this._internalRoot;if(g===null)throw Error(d(409));var S=g.current,I=ps();Wd(S,I,u,g,null,null)},uf.prototype.unmount=Ny.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var g=u.containerInfo;Wd(u.current,2,null,u,null,null),is(),g[je]=null}};function uf(u){this._internalRoot=u}uf.prototype.unstable_scheduleHydration=function(u){if(u){var g=_a();u={blockedOn:null,target:u,priority:g};for(var S=0;S<Kd.length&&g!==0&&g<Kd[S].priority;S++);Kd.splice(S,0,u),S===0&&kb(u)}};var Rv=i.version;if(Rv!=="19.2.0")throw Error(d(527,Rv,"19.2.0"));ze.findDOMNode=function(u){var g=u._reactInternals;if(g===void 0)throw typeof u.render=="function"?Error(d(188)):(u=Object.keys(u).join(","),Error(d(268,u)));return u=z(g),u=u!==null?j(u):null,u=u===null?null:u.stateNode,u};var Fb={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Ke,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var m_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!m_.isDisabled&&m_.supportsFiber)try{ta=m_.inject(Fb),dr=m_}catch{}}return t0.createRoot=function(u,g){if(!y(u))throw Error(d(299));var S=!1,I="",B=fm,q=Nu,de=pm;return g!=null&&(g.unstable_strictMode===!0&&(S=!0),g.identifierPrefix!==void 0&&(I=g.identifierPrefix),g.onUncaughtError!==void 0&&(B=g.onUncaughtError),g.onCaughtError!==void 0&&(q=g.onCaughtError),g.onRecoverableError!==void 0&&(de=g.onRecoverableError)),g=Pb(u,1,!1,null,null,S,I,null,B,q,de,jb),u[je]=g.current,go(u),new Ny(g)},t0.hydrateRoot=function(u,g,S){if(!y(u))throw Error(d(299));var I=!1,B="",q=fm,de=Nu,Oe=pm,ot=null;return S!=null&&(S.unstable_strictMode===!0&&(I=!0),S.identifierPrefix!==void 0&&(B=S.identifierPrefix),S.onUncaughtError!==void 0&&(q=S.onUncaughtError),S.onCaughtError!==void 0&&(de=S.onCaughtError),S.onRecoverableError!==void 0&&(Oe=S.onRecoverableError),S.formState!==void 0&&(ot=S.formState)),g=Pb(u,1,!0,g,S??null,I,B,ot,q,de,Oe,jb),g.context=wv(null),S=g.current,I=ps(),I=Ds(I),B=xc(I),B.callback=null,vc(S,B,I),S=I,g.current.lanes=S,Ct(g,S),wa(g),u[je]=g.current,go(u),new uf(g)},t0.version="19.2.0",t0}var wI;function Z5(){if(wI)return zT.exports;wI=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(i){console.error(i)}}return t(),zT.exports=q5(),zT.exports}var W5=Z5();var SI="popstate";function X5(t={}){function i(d,y){let{pathname:w,search:E,hash:s}=d.location;return I2("",{pathname:w,search:E,hash:s},y.state&&y.state.usr||null,y.state&&y.state.key||"default")}function c(d,y){return typeof y=="string"?y:T0(y)}return Y5(i,c,null,t)}function vo(t,i){if(t===!1||t===null||typeof t>"u")throw new Error(i)}function Ju(t,i){if(!t){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function K5(){return Math.random().toString(36).substring(2,10)}function TI(t,i){return{usr:t.state,key:t.key,idx:i}}function I2(t,i,c=null,d){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof i=="string"?Ix(i):i,state:c,key:i&&i.key||d||K5()}}function T0({pathname:t="/",search:i="",hash:c=""}){return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),c&&c!=="#"&&(t+=c.charAt(0)==="#"?c:"#"+c),t}function Ix(t){let i={};if(t){let c=t.indexOf("#");c>=0&&(i.hash=t.substring(c),t=t.substring(0,c));let d=t.indexOf("?");d>=0&&(i.search=t.substring(d),t=t.substring(0,d)),t&&(i.pathname=t)}return i}function Y5(t,i,c,d={}){let{window:y=document.defaultView,v5Compat:w=!1}=d,E=y.history,s="POP",O=null,z=j();z==null&&(z=0,E.replaceState({...E.state,idx:z},""));function j(){return(E.state||{idx:null}).idx}function H(){s="POP";let le=j(),ge=le==null?null:le-z;z=le,O&&O({action:s,location:ee.location,delta:ge})}function Y(le,ge){s="PUSH";let pe=I2(ee.location,le,ge);z=j()+1;let _e=TI(pe,z),Re=ee.createHref(pe);try{E.pushState(_e,"",Re)}catch(xe){if(xe instanceof DOMException&&xe.name==="DataCloneError")throw xe;y.location.assign(Re)}w&&O&&O({action:s,location:ee.location,delta:1})}function ie(le,ge){s="REPLACE";let pe=I2(ee.location,le,ge);z=j();let _e=TI(pe,z),Re=ee.createHref(pe);E.replaceState(_e,"",Re),w&&O&&O({action:s,location:ee.location,delta:0})}function oe(le){return Q5(le)}let ee={get action(){return s},get location(){return t(y,E)},listen(le){if(O)throw new Error("A history only accepts one active listener");return y.addEventListener(SI,H),O=le,()=>{y.removeEventListener(SI,H),O=null}},createHref(le){return i(y,le)},createURL:oe,encodeLocation(le){let ge=oe(le);return{pathname:ge.pathname,search:ge.search,hash:ge.hash}},push:Y,replace:ie,go(le){return E.go(le)}};return ee}function Q5(t,i=!1){let c="http://localhost";typeof window<"u"&&(c=window.location.origin!=="null"?window.location.origin:window.location.href),vo(c,"No window.location.(origin|href) available to create URL");let d=typeof t=="string"?t:T0(t);return d=d.replace(/ $/,"%20"),!i&&d.startsWith("//")&&(d=c+d),new URL(d,c)}function Ez(t,i,c="/"){return J5(t,i,c,!1)}function J5(t,i,c,d){let y=typeof i=="string"?Ix(i):i,w=Op(y.pathname||"/",c);if(w==null)return null;let E=Az(t);eV(E);let s=null;for(let O=0;s==null&&O<E.length;++O){let z=dV(w);s=cV(E[O],z,d)}return s}function Az(t,i=[],c=[],d="",y=!1){let w=(E,s,O=y,z)=>{let j={relativePath:z===void 0?E.path||"":z,caseSensitive:E.caseSensitive===!0,childrenIndex:s,route:E};if(j.relativePath.startsWith("/")){if(!j.relativePath.startsWith(d)&&O)return;vo(j.relativePath.startsWith(d),`Absolute route path "${j.relativePath}" nested under path "${d}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),j.relativePath=j.relativePath.slice(d.length)}let H=Pp([d,j.relativePath]),Y=c.concat(j);E.children&&E.children.length>0&&(vo(E.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${H}".`),Az(E.children,i,Y,H,O)),!(E.path==null&&!E.index)&&i.push({path:H,score:aV(H,E.index),routesMeta:Y})};return t.forEach((E,s)=>{if(E.path===""||!E.path?.includes("?"))w(E,s);else for(let O of Cz(E.path))w(E,s,!0,O)}),i}function Cz(t){let i=t.split("/");if(i.length===0)return[];let[c,...d]=i,y=c.endsWith("?"),w=c.replace(/\?$/,"");if(d.length===0)return y?[w,""]:[w];let E=Cz(d.join("/")),s=[];return s.push(...E.map(O=>O===""?w:[w,O].join("/"))),y&&s.push(...E),s.map(O=>t.startsWith("/")&&O===""?"/":O)}function eV(t){t.sort((i,c)=>i.score!==c.score?c.score-i.score:lV(i.routesMeta.map(d=>d.childrenIndex),c.routesMeta.map(d=>d.childrenIndex)))}var tV=/^:[\w-]+$/,nV=3,iV=2,rV=1,sV=10,oV=-2,EI=t=>t==="*";function aV(t,i){let c=t.split("/"),d=c.length;return c.some(EI)&&(d+=oV),i&&(d+=iV),c.filter(y=>!EI(y)).reduce((y,w)=>y+(tV.test(w)?nV:w===""?rV:sV),d)}function lV(t,i){return t.length===i.length&&t.slice(0,-1).every((d,y)=>d===i[y])?t[t.length-1]-i[i.length-1]:0}function cV(t,i,c=!1){let{routesMeta:d}=t,y={},w="/",E=[];for(let s=0;s<d.length;++s){let O=d[s],z=s===d.length-1,j=w==="/"?i:i.slice(w.length)||"/",H=cw({path:O.relativePath,caseSensitive:O.caseSensitive,end:z},j),Y=O.route;if(!H&&z&&c&&!d[d.length-1].route.index&&(H=cw({path:O.relativePath,caseSensitive:O.caseSensitive,end:!1},j)),!H)return null;Object.assign(y,H.params),E.push({params:y,pathname:Pp([w,H.pathname]),pathnameBase:gV(Pp([w,H.pathnameBase])),route:Y}),H.pathnameBase!=="/"&&(w=Pp([w,H.pathnameBase]))}return E}function cw(t,i){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[c,d]=uV(t.path,t.caseSensitive,t.end),y=i.match(c);if(!y)return null;let w=y[0],E=w.replace(/(.)\/+$/,"$1"),s=y.slice(1);return{params:d.reduce((z,{paramName:j,isOptional:H},Y)=>{if(j==="*"){let oe=s[Y]||"";E=w.slice(0,w.length-oe.length).replace(/(.)\/+$/,"$1")}const ie=s[Y];return H&&!ie?z[j]=void 0:z[j]=(ie||"").replace(/%2F/g,"/"),z},{}),pathname:w,pathnameBase:E,pattern:t}}function uV(t,i=!1,c=!0){Ju(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let d=[],y="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(E,s,O)=>(d.push({paramName:s,isOptional:O!=null}),O?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(d.push({paramName:"*"}),y+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):c?y+="\\/*$":t!==""&&t!=="/"&&(y+="(?:(?=\\/|$))"),[new RegExp(y,i?void 0:"i"),d]}function dV(t){try{return t.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return Ju(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${i}).`),t}}function Op(t,i){if(i==="/")return t;if(!t.toLowerCase().startsWith(i.toLowerCase()))return null;let c=i.endsWith("/")?i.length-1:i.length,d=t.charAt(c);return d&&d!=="/"?null:t.slice(c)||"/"}var hV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,fV=t=>hV.test(t);function pV(t,i="/"){let{pathname:c,search:d="",hash:y=""}=typeof t=="string"?Ix(t):t,w;if(c)if(fV(c))w=c;else{if(c.includes("//")){let E=c;c=c.replace(/\/\/+/g,"/"),Ju(!1,`Pathnames cannot have embedded double slashes - normalizing ${E} -> ${c}`)}c.startsWith("/")?w=AI(c.substring(1),"/"):w=AI(c,i)}else w=i;return{pathname:w,search:_V(d),hash:yV(y)}}function AI(t,i){let c=i.replace(/\/+$/,"").split("/");return t.split("/").forEach(y=>{y===".."?c.length>1&&c.pop():y!=="."&&c.push(y)}),c.length>1?c.join("/"):"/"}function jT(t,i,c,d){return`Cannot include a '${t}' character in a manually specified \`to.${i}\` field [${JSON.stringify(d)}].  Please separate it out to the \`to.${c}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function mV(t){return t.filter((i,c)=>c===0||i.route.path&&i.route.path.length>0)}function qE(t){let i=mV(t);return i.map((c,d)=>d===i.length-1?c.pathname:c.pathnameBase)}function ZE(t,i,c,d=!1){let y;typeof t=="string"?y=Ix(t):(y={...t},vo(!y.pathname||!y.pathname.includes("?"),jT("?","pathname","search",y)),vo(!y.pathname||!y.pathname.includes("#"),jT("#","pathname","hash",y)),vo(!y.search||!y.search.includes("#"),jT("#","search","hash",y)));let w=t===""||y.pathname==="",E=w?"/":y.pathname,s;if(E==null)s=c;else{let H=i.length-1;if(!d&&E.startsWith("..")){let Y=E.split("/");for(;Y[0]==="..";)Y.shift(),H-=1;y.pathname=Y.join("/")}s=H>=0?i[H]:"/"}let O=pV(y,s),z=E&&E!=="/"&&E.endsWith("/"),j=(w||E===".")&&c.endsWith("/");return!O.pathname.endsWith("/")&&(z||j)&&(O.pathname+="/"),O}var Pp=t=>t.join("/").replace(/\/\/+/g,"/"),gV=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),_V=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,yV=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function xV(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Rz=["POST","PUT","PATCH","DELETE"];new Set(Rz);var vV=["GET",...Rz];new Set(vV);var Dx=Z.createContext(null);Dx.displayName="DataRouter";var $w=Z.createContext(null);$w.displayName="DataRouterState";Z.createContext(!1);var Mz=Z.createContext({isTransitioning:!1});Mz.displayName="ViewTransition";var bV=Z.createContext(new Map);bV.displayName="Fetchers";var wV=Z.createContext(null);wV.displayName="Await";var mh=Z.createContext(null);mh.displayName="Navigation";var G0=Z.createContext(null);G0.displayName="Location";var td=Z.createContext({outlet:null,matches:[],isDataRoute:!1});td.displayName="Route";var WE=Z.createContext(null);WE.displayName="RouteError";function SV(t,{relative:i}={}){vo(Px(),"useHref() may be used only in the context of a <Router> component.");let{basename:c,navigator:d}=Z.useContext(mh),{hash:y,pathname:w,search:E}=H0(t,{relative:i}),s=w;return c!=="/"&&(s=w==="/"?c:Pp([c,w])),d.createHref({pathname:s,search:E,hash:y})}function Px(){return Z.useContext(G0)!=null}function ag(){return vo(Px(),"useLocation() may be used only in the context of a <Router> component."),Z.useContext(G0).location}var Iz="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Dz(t){Z.useContext(mh).static||Z.useLayoutEffect(t)}function lg(){let{isDataRoute:t}=Z.useContext(td);return t?jV():TV()}function TV(){vo(Px(),"useNavigate() may be used only in the context of a <Router> component.");let t=Z.useContext(Dx),{basename:i,navigator:c}=Z.useContext(mh),{matches:d}=Z.useContext(td),{pathname:y}=ag(),w=JSON.stringify(qE(d)),E=Z.useRef(!1);return Dz(()=>{E.current=!0}),Z.useCallback((O,z={})=>{if(Ju(E.current,Iz),!E.current)return;if(typeof O=="number"){c.go(O);return}let j=ZE(O,JSON.parse(w),y,z.relative==="path");t==null&&i!=="/"&&(j.pathname=j.pathname==="/"?i:Pp([i,j.pathname])),(z.replace?c.replace:c.push)(j,z.state,z)},[i,c,w,y,t])}var EV=Z.createContext(null);function AV(t){let i=Z.useContext(td).outlet;return Z.useMemo(()=>i&&Z.createElement(EV.Provider,{value:t},i),[i,t])}function XE(){let{matches:t}=Z.useContext(td),i=t[t.length-1];return i?i.params:{}}function H0(t,{relative:i}={}){let{matches:c}=Z.useContext(td),{pathname:d}=ag(),y=JSON.stringify(qE(c));return Z.useMemo(()=>ZE(t,JSON.parse(y),d,i==="path"),[t,y,d,i])}function CV(t,i){return Pz(t,i)}function Pz(t,i,c,d,y){vo(Px(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:w}=Z.useContext(mh),{matches:E}=Z.useContext(td),s=E[E.length-1],O=s?s.params:{},z=s?s.pathname:"/",j=s?s.pathnameBase:"/",H=s&&s.route;{let pe=H&&H.path||"";Oz(z,!H||pe.endsWith("*")||pe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${z}" (under <Route path="${pe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${pe}"> to <Route path="${pe==="/"?"*":`${pe}/*`}">.`)}let Y=ag(),ie;if(i){let pe=typeof i=="string"?Ix(i):i;vo(j==="/"||pe.pathname?.startsWith(j),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${j}" but pathname "${pe.pathname}" was given in the \`location\` prop.`),ie=pe}else ie=Y;let oe=ie.pathname||"/",ee=oe;if(j!=="/"){let pe=j.replace(/^\//,"").split("/");ee="/"+oe.replace(/^\//,"").split("/").slice(pe.length).join("/")}let le=Ez(t,{pathname:ee});Ju(H||le!=null,`No routes matched location "${ie.pathname}${ie.search}${ie.hash}" `),Ju(le==null||le[le.length-1].route.element!==void 0||le[le.length-1].route.Component!==void 0||le[le.length-1].route.lazy!==void 0,`Matched leaf route at location "${ie.pathname}${ie.search}${ie.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ge=PV(le&&le.map(pe=>Object.assign({},pe,{params:Object.assign({},O,pe.params),pathname:Pp([j,w.encodeLocation?w.encodeLocation(pe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:pe.pathname]),pathnameBase:pe.pathnameBase==="/"?j:Pp([j,w.encodeLocation?w.encodeLocation(pe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:pe.pathnameBase])})),E,c,d,y);return i&&ge?Z.createElement(G0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ie},navigationType:"POP"}},ge):ge}function RV(){let t=kV(),i=xV(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),c=t instanceof Error?t.stack:null,d="rgba(200,200,200, 0.5)",y={padding:"0.5rem",backgroundColor:d},w={padding:"2px 4px",backgroundColor:d},E=null;return console.error("Error handled by React Router default ErrorBoundary:",t),E=Z.createElement(Z.Fragment,null,Z.createElement("p",null," Hey developer "),Z.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Z.createElement("code",{style:w},"ErrorBoundary")," or"," ",Z.createElement("code",{style:w},"errorElement")," prop on your route.")),Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},i),c?Z.createElement("pre",{style:y},c):null,E)}var MV=Z.createElement(RV,null),IV=class extends Z.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){this.props.onError?this.props.onError(t,i):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?Z.createElement(td.Provider,{value:this.props.routeContext},Z.createElement(WE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function DV({routeContext:t,match:i,children:c}){let d=Z.useContext(Dx);return d&&d.static&&d.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=i.route.id),Z.createElement(td.Provider,{value:t},c)}function PV(t,i=[],c=null,d=null,y=null){if(t==null){if(!c)return null;if(c.errors)t=c.matches;else if(i.length===0&&!c.initialized&&c.matches.length>0)t=c.matches;else return null}let w=t,E=c?.errors;if(E!=null){let j=w.findIndex(H=>H.route.id&&E?.[H.route.id]!==void 0);vo(j>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(E).join(",")}`),w=w.slice(0,Math.min(w.length,j+1))}let s=!1,O=-1;if(c)for(let j=0;j<w.length;j++){let H=w[j];if((H.route.HydrateFallback||H.route.hydrateFallbackElement)&&(O=j),H.route.id){let{loaderData:Y,errors:ie}=c,oe=H.route.loader&&!Y.hasOwnProperty(H.route.id)&&(!ie||ie[H.route.id]===void 0);if(H.route.lazy||oe){s=!0,O>=0?w=w.slice(0,O+1):w=[w[0]];break}}}let z=c&&d?(j,H)=>{d(j,{location:c.location,params:c.matches?.[0]?.params??{},errorInfo:H})}:void 0;return w.reduceRight((j,H,Y)=>{let ie,oe=!1,ee=null,le=null;c&&(ie=E&&H.route.id?E[H.route.id]:void 0,ee=H.route.errorElement||MV,s&&(O<0&&Y===0?(Oz("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),oe=!0,le=null):O===Y&&(oe=!0,le=H.route.hydrateFallbackElement||null)));let ge=i.concat(w.slice(0,Y+1)),pe=()=>{let _e;return ie?_e=ee:oe?_e=le:H.route.Component?_e=Z.createElement(H.route.Component,null):H.route.element?_e=H.route.element:_e=j,Z.createElement(DV,{match:H,routeContext:{outlet:j,matches:ge,isDataRoute:c!=null},children:_e})};return c&&(H.route.ErrorBoundary||H.route.errorElement||Y===0)?Z.createElement(IV,{location:c.location,revalidation:c.revalidation,component:ee,error:ie,children:pe(),routeContext:{outlet:null,matches:ge,isDataRoute:!0},onError:z}):pe()},null)}function KE(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OV(t){let i=Z.useContext(Dx);return vo(i,KE(t)),i}function zV(t){let i=Z.useContext($w);return vo(i,KE(t)),i}function LV(t){let i=Z.useContext(td);return vo(i,KE(t)),i}function YE(t){let i=LV(t),c=i.matches[i.matches.length-1];return vo(c.route.id,`${t} can only be used on routes that contain a unique "id"`),c.route.id}function NV(){return YE("useRouteId")}function kV(){let t=Z.useContext(WE),i=zV("useRouteError"),c=YE("useRouteError");return t!==void 0?t:i.errors?.[c]}function jV(){let{router:t}=OV("useNavigate"),i=YE("useNavigate"),c=Z.useRef(!1);return Dz(()=>{c.current=!0}),Z.useCallback(async(y,w={})=>{Ju(c.current,Iz),c.current&&(typeof y=="number"?t.navigate(y):await t.navigate(y,{fromRouteId:i,...w}))},[t,i])}var CI={};function Oz(t,i,c){!i&&!CI[t]&&(CI[t]=!0,Ju(!1,c))}Z.memo(FV);function FV({routes:t,future:i,state:c,unstable_onError:d}){return Pz(t,void 0,c,d,i)}function E0({to:t,replace:i,state:c,relative:d}){vo(Px(),"<Navigate> may be used only in the context of a <Router> component.");let{static:y}=Z.useContext(mh);Ju(!y,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:w}=Z.useContext(td),{pathname:E}=ag(),s=lg(),O=ZE(t,qE(w),E,d==="path"),z=JSON.stringify(O);return Z.useEffect(()=>{s(JSON.parse(z),{replace:i,state:c,relative:d})},[s,z,d,i,c]),null}function BV(t){return AV(t.context)}function Aa(t){vo(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function VV({basename:t="/",children:i=null,location:c,navigationType:d="POP",navigator:y,static:w=!1}){vo(!Px(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let E=t.replace(/^\/*/,"/"),s=Z.useMemo(()=>({basename:E,navigator:y,static:w,future:{}}),[E,y,w]);typeof c=="string"&&(c=Ix(c));let{pathname:O="/",search:z="",hash:j="",state:H=null,key:Y="default"}=c,ie=Z.useMemo(()=>{let oe=Op(O,E);return oe==null?null:{location:{pathname:oe,search:z,hash:j,state:H,key:Y},navigationType:d}},[E,O,z,j,H,Y,d]);return Ju(ie!=null,`<Router basename="${E}"> is not able to match the URL "${O}${z}${j}" because it does not start with the basename, so the <Router> won't render anything.`),ie==null?null:Z.createElement(mh.Provider,{value:s},Z.createElement(G0.Provider,{children:i,value:ie}))}function UV({children:t,location:i}){return CV(D2(t),i)}function D2(t,i=[]){let c=[];return Z.Children.forEach(t,(d,y)=>{if(!Z.isValidElement(d))return;let w=[...i,y];if(d.type===Z.Fragment){c.push.apply(c,D2(d.props.children,w));return}vo(d.type===Aa,`[${typeof d.type=="string"?d.type:d.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),vo(!d.props.index||!d.props.children,"An index route cannot have child routes.");let E={id:d.props.id||w.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,middleware:d.props.middleware,loader:d.props.loader,action:d.props.action,hydrateFallbackElement:d.props.hydrateFallbackElement,HydrateFallback:d.props.HydrateFallback,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.hasErrorBoundary===!0||d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(E.children=D2(d.props.children,w)),c.push(E)}),c}var H1="get",q1="application/x-www-form-urlencoded";function Gw(t){return t!=null&&typeof t.tagName=="string"}function $V(t){return Gw(t)&&t.tagName.toLowerCase()==="button"}function GV(t){return Gw(t)&&t.tagName.toLowerCase()==="form"}function HV(t){return Gw(t)&&t.tagName.toLowerCase()==="input"}function qV(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function ZV(t,i){return t.button===0&&(!i||i==="_self")&&!qV(t)}var x1=null;function WV(){if(x1===null)try{new FormData(document.createElement("form"),0),x1=!1}catch{x1=!0}return x1}var XV=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function FT(t){return t!=null&&!XV.has(t)?(Ju(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${q1}"`),null):t}function KV(t,i){let c,d,y,w,E;if(GV(t)){let s=t.getAttribute("action");d=s?Op(s,i):null,c=t.getAttribute("method")||H1,y=FT(t.getAttribute("enctype"))||q1,w=new FormData(t)}else if($V(t)||HV(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let O=t.getAttribute("formaction")||s.getAttribute("action");if(d=O?Op(O,i):null,c=t.getAttribute("formmethod")||s.getAttribute("method")||H1,y=FT(t.getAttribute("formenctype"))||FT(s.getAttribute("enctype"))||q1,w=new FormData(s,t),!WV()){let{name:z,type:j,value:H}=t;if(j==="image"){let Y=z?`${z}.`:"";w.append(`${Y}x`,"0"),w.append(`${Y}y`,"0")}else z&&w.append(z,H)}}else{if(Gw(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');c=H1,d=null,y=q1,E=t}return w&&y==="text/plain"&&(E=w,w=void 0),{action:d,method:c.toLowerCase(),encType:y,formData:w,body:E}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function QE(t,i){if(t===!1||t===null||typeof t>"u")throw new Error(i)}function YV(t,i,c){let d=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return d.pathname==="/"?d.pathname=`_root.${c}`:i&&Op(d.pathname,i)==="/"?d.pathname=`${i.replace(/\/$/,"")}/_root.${c}`:d.pathname=`${d.pathname.replace(/\/$/,"")}.${c}`,d}async function QV(t,i){if(t.id in i)return i[t.id];try{let c=await import(t.module);return i[t.id]=c,c}catch(c){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(c),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function JV(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function eU(t,i,c){let d=await Promise.all(t.map(async y=>{let w=i.routes[y.route.id];if(w){let E=await QV(w,c);return E.links?E.links():[]}return[]}));return rU(d.flat(1).filter(JV).filter(y=>y.rel==="stylesheet"||y.rel==="preload").map(y=>y.rel==="stylesheet"?{...y,rel:"prefetch",as:"style"}:{...y,rel:"prefetch"}))}function RI(t,i,c,d,y,w){let E=(O,z)=>c[z]?O.route.id!==c[z].route.id:!0,s=(O,z)=>c[z].pathname!==O.pathname||c[z].route.path?.endsWith("*")&&c[z].params["*"]!==O.params["*"];return w==="assets"?i.filter((O,z)=>E(O,z)||s(O,z)):w==="data"?i.filter((O,z)=>{let j=d.routes[O.route.id];if(!j||!j.hasLoader)return!1;if(E(O,z)||s(O,z))return!0;if(O.route.shouldRevalidate){let H=O.route.shouldRevalidate({currentUrl:new URL(y.pathname+y.search+y.hash,window.origin),currentParams:c[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:O.params,defaultShouldRevalidate:!0});if(typeof H=="boolean")return H}return!0}):[]}function tU(t,i,{includeHydrateFallback:c}={}){return nU(t.map(d=>{let y=i.routes[d.route.id];if(!y)return[];let w=[y.module];return y.clientActionModule&&(w=w.concat(y.clientActionModule)),y.clientLoaderModule&&(w=w.concat(y.clientLoaderModule)),c&&y.hydrateFallbackModule&&(w=w.concat(y.hydrateFallbackModule)),y.imports&&(w=w.concat(y.imports)),w}).flat(1))}function nU(t){return[...new Set(t)]}function iU(t){let i={},c=Object.keys(t).sort();for(let d of c)i[d]=t[d];return i}function rU(t,i){let c=new Set;return new Set(i),t.reduce((d,y)=>{let w=JSON.stringify(iU(y));return c.has(w)||(c.add(w),d.push({key:w,link:y})),d},[])}function zz(){let t=Z.useContext(Dx);return QE(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function sU(){let t=Z.useContext($w);return QE(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var JE=Z.createContext(void 0);JE.displayName="FrameworkContext";function Lz(){let t=Z.useContext(JE);return QE(t,"You must render this element inside a <HydratedRouter> element"),t}function oU(t,i){let c=Z.useContext(JE),[d,y]=Z.useState(!1),[w,E]=Z.useState(!1),{onFocus:s,onBlur:O,onMouseEnter:z,onMouseLeave:j,onTouchStart:H}=i,Y=Z.useRef(null);Z.useEffect(()=>{if(t==="render"&&E(!0),t==="viewport"){let ee=ge=>{ge.forEach(pe=>{E(pe.isIntersecting)})},le=new IntersectionObserver(ee,{threshold:.5});return Y.current&&le.observe(Y.current),()=>{le.disconnect()}}},[t]),Z.useEffect(()=>{if(d){let ee=setTimeout(()=>{E(!0)},100);return()=>{clearTimeout(ee)}}},[d]);let ie=()=>{y(!0)},oe=()=>{y(!1),E(!1)};return c?t!=="intent"?[w,Y,{}]:[w,Y,{onFocus:n0(s,ie),onBlur:n0(O,oe),onMouseEnter:n0(z,ie),onMouseLeave:n0(j,oe),onTouchStart:n0(H,ie)}]:[!1,Y,{}]}function n0(t,i){return c=>{t&&t(c),c.defaultPrevented||i(c)}}function aU({page:t,...i}){let{router:c}=zz(),d=Z.useMemo(()=>Ez(c.routes,t,c.basename),[c.routes,t,c.basename]);return d?Z.createElement(cU,{page:t,matches:d,...i}):null}function lU(t){let{manifest:i,routeModules:c}=Lz(),[d,y]=Z.useState([]);return Z.useEffect(()=>{let w=!1;return eU(t,i,c).then(E=>{w||y(E)}),()=>{w=!0}},[t,i,c]),d}function cU({page:t,matches:i,...c}){let d=ag(),{manifest:y,routeModules:w}=Lz(),{basename:E}=zz(),{loaderData:s,matches:O}=sU(),z=Z.useMemo(()=>RI(t,i,O,y,d,"data"),[t,i,O,y,d]),j=Z.useMemo(()=>RI(t,i,O,y,d,"assets"),[t,i,O,y,d]),H=Z.useMemo(()=>{if(t===d.pathname+d.search+d.hash)return[];let oe=new Set,ee=!1;if(i.forEach(ge=>{let pe=y.routes[ge.route.id];!pe||!pe.hasLoader||(!z.some(_e=>_e.route.id===ge.route.id)&&ge.route.id in s&&w[ge.route.id]?.shouldRevalidate||pe.hasClientLoader?ee=!0:oe.add(ge.route.id))}),oe.size===0)return[];let le=YV(t,E,"data");return ee&&oe.size>0&&le.searchParams.set("_routes",i.filter(ge=>oe.has(ge.route.id)).map(ge=>ge.route.id).join(",")),[le.pathname+le.search]},[E,s,d,y,z,i,t,w]),Y=Z.useMemo(()=>tU(j,y),[j,y]),ie=lU(j);return Z.createElement(Z.Fragment,null,H.map(oe=>Z.createElement("link",{key:oe,rel:"prefetch",as:"fetch",href:oe,...c})),Y.map(oe=>Z.createElement("link",{key:oe,rel:"modulepreload",href:oe,...c})),ie.map(({key:oe,link:ee})=>Z.createElement("link",{key:oe,nonce:c.nonce,...ee})))}function uU(...t){return i=>{t.forEach(c=>{typeof c=="function"?c(i):c!=null&&(c.current=i)})}}var Nz=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Nz&&(window.__reactRouterVersion="7.9.6")}catch{}function dU({basename:t,children:i,window:c}){let d=Z.useRef();d.current==null&&(d.current=X5({window:c,v5Compat:!0}));let y=d.current,[w,E]=Z.useState({action:y.action,location:y.location}),s=Z.useCallback(O=>{Z.startTransition(()=>E(O))},[E]);return Z.useLayoutEffect(()=>y.listen(s),[y,s]),Z.createElement(VV,{basename:t,children:i,location:w.location,navigationType:w.action,navigator:y})}var kz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,eA=Z.forwardRef(function({onClick:i,discover:c="render",prefetch:d="none",relative:y,reloadDocument:w,replace:E,state:s,target:O,to:z,preventScrollReset:j,viewTransition:H,...Y},ie){let{basename:oe}=Z.useContext(mh),ee=typeof z=="string"&&kz.test(z),le,ge=!1;if(typeof z=="string"&&ee&&(le=z,Nz))try{let st=new URL(window.location.href),Et=z.startsWith("//")?new URL(st.protocol+z):new URL(z),Ut=Op(Et.pathname,oe);Et.origin===st.origin&&Ut!=null?z=Ut+Et.search+Et.hash:ge=!0}catch{Ju(!1,`<Link to="${z}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let pe=SV(z,{relative:y}),[_e,Re,xe]=oU(d,Y),Ze=pU(z,{replace:E,state:s,target:O,preventScrollReset:j,relative:y,viewTransition:H});function Le(st){i&&i(st),st.defaultPrevented||Ze(st)}let $e=Z.createElement("a",{...Y,...xe,href:le||pe,onClick:ge||w?i:Le,ref:uU(ie,Re),target:O,"data-discover":!ee&&c==="render"?"true":void 0});return _e&&!ee?Z.createElement(Z.Fragment,null,$e,Z.createElement(aU,{page:pe})):$e});eA.displayName="Link";var jz=Z.forwardRef(function({"aria-current":i="page",caseSensitive:c=!1,className:d="",end:y=!1,style:w,to:E,viewTransition:s,children:O,...z},j){let H=H0(E,{relative:z.relative}),Y=ag(),ie=Z.useContext($w),{navigator:oe,basename:ee}=Z.useContext(mh),le=ie!=null&&xU(H)&&s===!0,ge=oe.encodeLocation?oe.encodeLocation(H).pathname:H.pathname,pe=Y.pathname,_e=ie&&ie.navigation&&ie.navigation.location?ie.navigation.location.pathname:null;c||(pe=pe.toLowerCase(),_e=_e?_e.toLowerCase():null,ge=ge.toLowerCase()),_e&&ee&&(_e=Op(_e,ee)||_e);const Re=ge!=="/"&&ge.endsWith("/")?ge.length-1:ge.length;let xe=pe===ge||!y&&pe.startsWith(ge)&&pe.charAt(Re)==="/",Ze=_e!=null&&(_e===ge||!y&&_e.startsWith(ge)&&_e.charAt(ge.length)==="/"),Le={isActive:xe,isPending:Ze,isTransitioning:le},$e=xe?i:void 0,st;typeof d=="function"?st=d(Le):st=[d,xe?"active":null,Ze?"pending":null,le?"transitioning":null].filter(Boolean).join(" ");let Et=typeof w=="function"?w(Le):w;return Z.createElement(eA,{...z,"aria-current":$e,className:st,ref:j,style:Et,to:E,viewTransition:s},typeof O=="function"?O(Le):O)});jz.displayName="NavLink";var hU=Z.forwardRef(({discover:t="render",fetcherKey:i,navigate:c,reloadDocument:d,replace:y,state:w,method:E=H1,action:s,onSubmit:O,relative:z,preventScrollReset:j,viewTransition:H,...Y},ie)=>{let oe=_U(),ee=yU(s,{relative:z}),le=E.toLowerCase()==="get"?"get":"post",ge=typeof s=="string"&&kz.test(s),pe=_e=>{if(O&&O(_e),_e.defaultPrevented)return;_e.preventDefault();let Re=_e.nativeEvent.submitter,xe=Re?.getAttribute("formmethod")||E;oe(Re||_e.currentTarget,{fetcherKey:i,method:xe,navigate:c,replace:y,state:w,relative:z,preventScrollReset:j,viewTransition:H})};return Z.createElement("form",{ref:ie,method:le,action:ee,onSubmit:d?O:pe,...Y,"data-discover":!ge&&t==="render"?"true":void 0})});hU.displayName="Form";function fU(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Fz(t){let i=Z.useContext(Dx);return vo(i,fU(t)),i}function pU(t,{target:i,replace:c,state:d,preventScrollReset:y,relative:w,viewTransition:E}={}){let s=lg(),O=ag(),z=H0(t,{relative:w});return Z.useCallback(j=>{if(ZV(j,i)){j.preventDefault();let H=c!==void 0?c:T0(O)===T0(z);s(t,{replace:H,state:d,preventScrollReset:y,relative:w,viewTransition:E})}},[O,s,z,c,d,i,t,y,w,E])}var mU=0,gU=()=>`__${String(++mU)}__`;function _U(){let{router:t}=Fz("useSubmit"),{basename:i}=Z.useContext(mh),c=NV();return Z.useCallback(async(d,y={})=>{let{action:w,method:E,encType:s,formData:O,body:z}=KV(d,i);if(y.navigate===!1){let j=y.fetcherKey||gU();await t.fetch(j,c,y.action||w,{preventScrollReset:y.preventScrollReset,formData:O,body:z,formMethod:y.method||E,formEncType:y.encType||s,flushSync:y.flushSync})}else await t.navigate(y.action||w,{preventScrollReset:y.preventScrollReset,formData:O,body:z,formMethod:y.method||E,formEncType:y.encType||s,replace:y.replace,state:y.state,fromRouteId:c,flushSync:y.flushSync,viewTransition:y.viewTransition})},[t,i,c])}function yU(t,{relative:i}={}){let{basename:c}=Z.useContext(mh),d=Z.useContext(td);vo(d,"useFormAction must be used inside a RouteContext");let[y]=d.matches.slice(-1),w={...H0(t||".",{relative:i})},E=ag();if(t==null){w.search=E.search;let s=new URLSearchParams(w.search),O=s.getAll("index");if(O.some(j=>j==="")){s.delete("index"),O.filter(H=>H).forEach(H=>s.append("index",H));let j=s.toString();w.search=j?`?${j}`:""}}return(!t||t===".")&&y.route.index&&(w.search=w.search?w.search.replace(/^\?/,"?index&"):"?index"),c!=="/"&&(w.pathname=w.pathname==="/"?c:Pp([c,w.pathname])),T0(w)}function xU(t,{relative:i}={}){let c=Z.useContext(Mz);vo(c!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:d}=Fz("useViewTransitionState"),y=H0(t,{relative:i});if(!c.isTransitioning)return!1;let w=Op(c.currentLocation.pathname,d)||c.currentLocation.pathname,E=Op(c.nextLocation.pathname,d)||c.nextLocation.pathname;return cw(y.pathname,E)!=null||cw(y.pathname,w)!=null}var ah=Tz();const vU=GE(ah);var Ox=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},bU={setTimeout:(t,i)=>setTimeout(t,i),clearTimeout:t=>clearTimeout(t),setInterval:(t,i)=>setInterval(t,i),clearInterval:t=>clearInterval(t)},wU=class{#e=bU;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,i){return this.#e.setTimeout(t,i)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,i){return this.#e.setInterval(t,i)}clearInterval(t){this.#e.clearInterval(t)}},E_=new wU;function SU(t){setTimeout(t,0)}var j_=typeof window>"u"||"Deno"in globalThis;function Jl(){}function TU(t,i){return typeof t=="function"?t(i):t}function P2(t){return typeof t=="number"&&t>=0&&t!==1/0}function Bz(t,i){return Math.max(t+(i||0)-Date.now(),0)}function ng(t,i){return typeof t=="function"?t(i):t}function qu(t,i){return typeof t=="function"?t(i):t}function MI(t,i){const{type:c="all",exact:d,fetchStatus:y,predicate:w,queryKey:E,stale:s}=t;if(E){if(d){if(i.queryHash!==tA(E,i.options))return!1}else if(!A0(i.queryKey,E))return!1}if(c!=="all"){const O=i.isActive();if(c==="active"&&!O||c==="inactive"&&O)return!1}return!(typeof s=="boolean"&&i.isStale()!==s||y&&y!==i.state.fetchStatus||w&&!w(i))}function II(t,i){const{exact:c,status:d,predicate:y,mutationKey:w}=t;if(w){if(!i.options.mutationKey)return!1;if(c){if(F_(i.options.mutationKey)!==F_(w))return!1}else if(!A0(i.options.mutationKey,w))return!1}return!(d&&i.state.status!==d||y&&!y(i))}function tA(t,i){return(i?.queryKeyHashFn||F_)(t)}function F_(t){return JSON.stringify(t,(i,c)=>O2(c)?Object.keys(c).sort().reduce((d,y)=>(d[y]=c[y],d),{}):c)}function A0(t,i){return t===i?!0:typeof t!=typeof i?!1:t&&i&&typeof t=="object"&&typeof i=="object"?Object.keys(i).every(c=>A0(t[c],i[c])):!1}var EU=Object.prototype.hasOwnProperty;function Vz(t,i){if(t===i)return t;const c=DI(t)&&DI(i);if(!c&&!(O2(t)&&O2(i)))return i;const y=(c?t:Object.keys(t)).length,w=c?i:Object.keys(i),E=w.length,s=c?new Array(E):{};let O=0;for(let z=0;z<E;z++){const j=c?z:w[z],H=t[j],Y=i[j];if(H===Y){s[j]=H,(c?z<y:EU.call(t,j))&&O++;continue}if(H===null||Y===null||typeof H!="object"||typeof Y!="object"){s[j]=Y;continue}const ie=Vz(H,Y);s[j]=ie,ie===H&&O++}return y===E&&O===y?t:s}function uw(t,i){if(!i||Object.keys(t).length!==Object.keys(i).length)return!1;for(const c in t)if(t[c]!==i[c])return!1;return!0}function DI(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function O2(t){if(!PI(t))return!1;const i=t.constructor;if(i===void 0)return!0;const c=i.prototype;return!(!PI(c)||!c.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function PI(t){return Object.prototype.toString.call(t)==="[object Object]"}function AU(t){return new Promise(i=>{E_.setTimeout(i,t)})}function z2(t,i,c){return typeof c.structuralSharing=="function"?c.structuralSharing(t,i):c.structuralSharing!==!1?Vz(t,i):i}function CU(t,i,c=0){const d=[...t,i];return c&&d.length>c?d.slice(1):d}function RU(t,i,c=0){const d=[i,...t];return c&&d.length>c?d.slice(0,-1):d}var nA=Symbol();function Uz(t,i){return!t.queryFn&&i?.initialPromise?()=>i.initialPromise:!t.queryFn||t.queryFn===nA?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function $z(t,i){return typeof t=="function"?t(...i):!!t}var MU=class extends Ox{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!j_&&window.addEventListener){const i=()=>t();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(i=>{i(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},iA=new MU;function L2(){let t,i;const c=new Promise((y,w)=>{t=y,i=w});c.status="pending",c.catch(()=>{});function d(y){Object.assign(c,y),delete c.resolve,delete c.reject}return c.resolve=y=>{d({status:"fulfilled",value:y}),t(y)},c.reject=y=>{d({status:"rejected",reason:y}),i(y)},c}var IU=SU;function DU(){let t=[],i=0,c=s=>{s()},d=s=>{s()},y=IU;const w=s=>{i?t.push(s):y(()=>{c(s)})},E=()=>{const s=t;t=[],s.length&&y(()=>{d(()=>{s.forEach(O=>{c(O)})})})};return{batch:s=>{let O;i++;try{O=s()}finally{i--,i||E()}return O},batchCalls:s=>(...O)=>{w(()=>{s(...O)})},schedule:w,setNotifyFunction:s=>{c=s},setBatchNotifyFunction:s=>{d=s},setScheduler:s=>{y=s}}}var Ra=DU(),PU=class extends Ox{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!j_&&window.addEventListener){const i=()=>t(!0),c=()=>t(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",c,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",c)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(c=>{c(t)}))}isOnline(){return this.#e}},dw=new PU;function OU(t){return Math.min(1e3*2**t,3e4)}function Gz(t){return(t??"online")==="online"?dw.isOnline():!0}var N2=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function Hz(t){let i=!1,c=0,d;const y=L2(),w=()=>y.status!=="pending",E=ee=>{if(!w()){const le=new N2(ee);Y(le),t.onCancel?.(le)}},s=()=>{i=!0},O=()=>{i=!1},z=()=>iA.isFocused()&&(t.networkMode==="always"||dw.isOnline())&&t.canRun(),j=()=>Gz(t.networkMode)&&t.canRun(),H=ee=>{w()||(d?.(),y.resolve(ee))},Y=ee=>{w()||(d?.(),y.reject(ee))},ie=()=>new Promise(ee=>{d=le=>{(w()||z())&&ee(le)},t.onPause?.()}).then(()=>{d=void 0,w()||t.onContinue?.()}),oe=()=>{if(w())return;let ee;const le=c===0?t.initialPromise:void 0;try{ee=le??t.fn()}catch(ge){ee=Promise.reject(ge)}Promise.resolve(ee).then(H).catch(ge=>{if(w())return;const pe=t.retry??(j_?0:3),_e=t.retryDelay??OU,Re=typeof _e=="function"?_e(c,ge):_e,xe=pe===!0||typeof pe=="number"&&c<pe||typeof pe=="function"&&pe(c,ge);if(i||!xe){Y(ge);return}c++,t.onFail?.(c,ge),AU(Re).then(()=>z()?void 0:ie()).then(()=>{i?Y(ge):oe()})})};return{promise:y,status:()=>y.status,cancel:E,continue:()=>(d?.(),y),cancelRetry:s,continueRetry:O,canStart:j,start:()=>(j()?oe():ie().then(oe),y)}}var qz=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),P2(this.gcTime)&&(this.#e=E_.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(j_?1/0:300*1e3))}clearGcTimeout(){this.#e&&(E_.clearTimeout(this.#e),this.#e=void 0)}},zU=class extends qz{#e;#t;#n;#r;#i;#o;#a;constructor(t){super(),this.#a=!1,this.#o=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#r=t.client,this.#n=this.#r.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#e=zI(this.options),this.state=t.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(t){if(this.options={...this.#o,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const i=zI(this.options);i.data!==void 0&&(this.setState(OI(i.data,i.dataUpdatedAt)),this.#e=i)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(t,i){const c=z2(this.state.data,t,this.options);return this.#s({data:c,type:"success",dataUpdatedAt:i?.updatedAt,manual:i?.manual}),c}setState(t,i){this.#s({type:"setState",state:t,setStateOptions:i})}cancel(t){const i=this.#i?.promise;return this.#i?.cancel(t),i?i.then(Jl).catch(Jl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(t=>qu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===nA||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ng(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Bz(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(i=>i.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(i=>i.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(i=>i!==t),this.observers.length||(this.#i&&(this.#a?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(t,i){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&i?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(t&&this.setOptions(t),!this.options.queryFn){const s=this.observers.find(O=>O.options.queryFn);s&&this.setOptions(s.options)}const c=new AbortController,d=s=>{Object.defineProperty(s,"signal",{enumerable:!0,get:()=>(this.#a=!0,c.signal)})},y=()=>{const s=Uz(this.options,i),z=(()=>{const j={client:this.#r,queryKey:this.queryKey,meta:this.meta};return d(j),j})();return this.#a=!1,this.options.persister?this.options.persister(s,z,this):s(z)},E=(()=>{const s={fetchOptions:i,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:y};return d(s),s})();this.options.behavior?.onFetch(E,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==E.fetchOptions?.meta)&&this.#s({type:"fetch",meta:E.fetchOptions?.meta}),this.#i=Hz({initialPromise:i?.initialPromise,fn:E.fetchFn,onCancel:s=>{s instanceof N2&&s.revert&&this.setState({...this.#t,fetchStatus:"idle"}),c.abort()},onFail:(s,O)=>{this.#s({type:"failed",failureCount:s,error:O})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:E.options.retry,retryDelay:E.options.retryDelay,networkMode:E.options.networkMode,canRun:()=>!0});try{const s=await this.#i.start();if(s===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(s),this.#n.config.onSuccess?.(s,this),this.#n.config.onSettled?.(s,this.state.error,this),s}catch(s){if(s instanceof N2){if(s.silent)return this.#i.promise;if(s.revert){if(this.state.data===void 0)throw s;return this.state.data}}throw this.#s({type:"error",error:s}),this.#n.config.onError?.(s,this),this.#n.config.onSettled?.(this.state.data,s,this),s}finally{this.scheduleGc()}}#s(t){const i=c=>{switch(t.type){case"failed":return{...c,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...c,fetchStatus:"paused"};case"continue":return{...c,fetchStatus:"fetching"};case"fetch":return{...c,...Zz(c.data,this.options),fetchMeta:t.meta??null};case"success":const d={...c,...OI(t.data,t.dataUpdatedAt),dataUpdateCount:c.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=t.manual?d:void 0,d;case"error":const y=t.error;return{...c,error:y,errorUpdateCount:c.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:c.fetchFailureCount+1,fetchFailureReason:y,fetchStatus:"idle",status:"error"};case"invalidate":return{...c,isInvalidated:!0};case"setState":return{...c,...t.state}}};this.state=i(this.state),Ra.batch(()=>{this.observers.forEach(c=>{c.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:t})})}};function Zz(t,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Gz(i.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function OI(t,i){return{data:t,dataUpdatedAt:i??Date.now(),error:null,isInvalidated:!1,status:"success"}}function zI(t){const i=typeof t.initialData=="function"?t.initialData():t.initialData,c=i!==void 0,d=c?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:c?d??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:c?"success":"pending",fetchStatus:"idle"}}var LU=class extends Ox{constructor(t,i){super(),this.options=i,this.#e=t,this.#s=null,this.#a=L2(),this.bindMethods(),this.setOptions(i)}#e;#t=void 0;#n=void 0;#r=void 0;#i;#o;#a;#s;#m;#h;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),LI(this.#t,this.options)?this.#d():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return k2(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return k2(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#b(),this.#t.removeObserver(this)}setOptions(t){const i=this.options,c=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof qu(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),i._defaulted&&!uw(this.options,i)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const d=this.hasListeners();d&&NI(this.#t,c,this.options,i)&&this.#d(),this.updateResult(),d&&(this.#t!==c||qu(this.options.enabled,this.#t)!==qu(i.enabled,this.#t)||ng(this.options.staleTime,this.#t)!==ng(i.staleTime,this.#t))&&this.#g();const y=this.#_();d&&(this.#t!==c||qu(this.options.enabled,this.#t)!==qu(i.enabled,this.#t)||y!==this.#l)&&this.#y(y)}getOptimisticResult(t){const i=this.#e.getQueryCache().build(this.#e,t),c=this.createResult(i,t);return kU(this,c)&&(this.#r=c,this.#o=this.options,this.#i=this.#t.state),c}getCurrentResult(){return this.#r}trackResult(t,i){return new Proxy(t,{get:(c,d)=>(this.trackProp(d),i?.(d),d==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(c,d))})}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=this.#e.defaultQueryOptions(t),c=this.#e.getQueryCache().build(this.#e,i);return c.fetch().then(()=>this.createResult(c,i))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#d(t){this.#w();let i=this.#t.fetch(this.options,t);return t?.throwOnError||(i=i.catch(Jl)),i}#g(){this.#v();const t=ng(this.options.staleTime,this.#t);if(j_||this.#r.isStale||!P2(t))return;const c=Bz(this.#r.dataUpdatedAt,t)+1;this.#c=E_.setTimeout(()=>{this.#r.isStale||this.updateResult()},c)}#_(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(t){this.#b(),this.#l=t,!(j_||qu(this.options.enabled,this.#t)===!1||!P2(this.#l)||this.#l===0)&&(this.#u=E_.setInterval(()=>{(this.options.refetchIntervalInBackground||iA.isFocused())&&this.#d()},this.#l))}#x(){this.#g(),this.#y(this.#_())}#v(){this.#c&&(E_.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(E_.clearInterval(this.#u),this.#u=void 0)}createResult(t,i){const c=this.#t,d=this.options,y=this.#r,w=this.#i,E=this.#o,O=t!==c?t.state:this.#n,{state:z}=t;let j={...z},H=!1,Y;if(i._optimisticResults){const $e=this.hasListeners(),st=!$e&&LI(t,i),Et=$e&&NI(t,c,i,d);(st||Et)&&(j={...j,...Zz(z.data,t.options)}),i._optimisticResults==="isRestoring"&&(j.fetchStatus="idle")}let{error:ie,errorUpdatedAt:oe,status:ee}=j;Y=j.data;let le=!1;if(i.placeholderData!==void 0&&Y===void 0&&ee==="pending"){let $e;y?.isPlaceholderData&&i.placeholderData===E?.placeholderData?($e=y.data,le=!0):$e=typeof i.placeholderData=="function"?i.placeholderData(this.#f?.state.data,this.#f):i.placeholderData,$e!==void 0&&(ee="success",Y=z2(y?.data,$e,i),H=!0)}if(i.select&&Y!==void 0&&!le)if(y&&Y===w?.data&&i.select===this.#m)Y=this.#h;else try{this.#m=i.select,Y=i.select(Y),Y=z2(y?.data,Y,i),this.#h=Y,this.#s=null}catch($e){this.#s=$e}this.#s&&(ie=this.#s,Y=this.#h,oe=Date.now(),ee="error");const ge=j.fetchStatus==="fetching",pe=ee==="pending",_e=ee==="error",Re=pe&&ge,xe=Y!==void 0,Le={status:ee,fetchStatus:j.fetchStatus,isPending:pe,isSuccess:ee==="success",isError:_e,isInitialLoading:Re,isLoading:Re,data:Y,dataUpdatedAt:j.dataUpdatedAt,error:ie,errorUpdatedAt:oe,failureCount:j.fetchFailureCount,failureReason:j.fetchFailureReason,errorUpdateCount:j.errorUpdateCount,isFetched:j.dataUpdateCount>0||j.errorUpdateCount>0,isFetchedAfterMount:j.dataUpdateCount>O.dataUpdateCount||j.errorUpdateCount>O.errorUpdateCount,isFetching:ge,isRefetching:ge&&!pe,isLoadingError:_e&&!xe,isPaused:j.fetchStatus==="paused",isPlaceholderData:H,isRefetchError:_e&&xe,isStale:rA(t,i),refetch:this.refetch,promise:this.#a,isEnabled:qu(i.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const $e=Ut=>{Le.status==="error"?Ut.reject(Le.error):Le.data!==void 0&&Ut.resolve(Le.data)},st=()=>{const Ut=this.#a=Le.promise=L2();$e(Ut)},Et=this.#a;switch(Et.status){case"pending":t.queryHash===c.queryHash&&$e(Et);break;case"fulfilled":(Le.status==="error"||Le.data!==Et.value)&&st();break;case"rejected":(Le.status!=="error"||Le.error!==Et.reason)&&st();break}}return Le}updateResult(){const t=this.#r,i=this.createResult(this.#t,this.options);if(this.#i=this.#t.state,this.#o=this.options,this.#i.data!==void 0&&(this.#f=this.#t),uw(i,t))return;this.#r=i;const c=()=>{if(!t)return!0;const{notifyOnChangeProps:d}=this.options,y=typeof d=="function"?d():d;if(y==="all"||!y&&!this.#p.size)return!0;const w=new Set(y??this.#p);return this.options.throwOnError&&w.add("error"),Object.keys(this.#r).some(E=>{const s=E;return this.#r[s]!==t[s]&&w.has(s)})};this.#S({listeners:c()})}#w(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const i=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(i?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#S(t){Ra.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function NU(t,i){return qu(i.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&i.retryOnMount===!1)}function LI(t,i){return NU(t,i)||t.state.data!==void 0&&k2(t,i,i.refetchOnMount)}function k2(t,i,c){if(qu(i.enabled,t)!==!1&&ng(i.staleTime,t)!=="static"){const d=typeof c=="function"?c(t):c;return d==="always"||d!==!1&&rA(t,i)}return!1}function NI(t,i,c,d){return(t!==i||qu(d.enabled,t)===!1)&&(!c.suspense||t.state.status!=="error")&&rA(t,c)}function rA(t,i){return qu(i.enabled,t)!==!1&&t.isStaleByTime(ng(i.staleTime,t))}function kU(t,i){return!uw(t.getCurrentResult(),i)}function kI(t){return{onFetch:(i,c)=>{const d=i.options,y=i.fetchOptions?.meta?.fetchMore?.direction,w=i.state.data?.pages||[],E=i.state.data?.pageParams||[];let s={pages:[],pageParams:[]},O=0;const z=async()=>{let j=!1;const H=oe=>{Object.defineProperty(oe,"signal",{enumerable:!0,get:()=>(i.signal.aborted?j=!0:i.signal.addEventListener("abort",()=>{j=!0}),i.signal)})},Y=Uz(i.options,i.fetchOptions),ie=async(oe,ee,le)=>{if(j)return Promise.reject();if(ee==null&&oe.pages.length)return Promise.resolve(oe);const pe=(()=>{const Ze={client:i.client,queryKey:i.queryKey,pageParam:ee,direction:le?"backward":"forward",meta:i.options.meta};return H(Ze),Ze})(),_e=await Y(pe),{maxPages:Re}=i.options,xe=le?RU:CU;return{pages:xe(oe.pages,_e,Re),pageParams:xe(oe.pageParams,ee,Re)}};if(y&&w.length){const oe=y==="backward",ee=oe?jU:jI,le={pages:w,pageParams:E},ge=ee(d,le);s=await ie(le,ge,oe)}else{const oe=t??w.length;do{const ee=O===0?E[0]??d.initialPageParam:jI(d,s);if(O>0&&ee==null)break;s=await ie(s,ee),O++}while(O<oe)}return s};i.options.persister?i.fetchFn=()=>i.options.persister?.(z,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},c):i.fetchFn=z}}}function jI(t,{pages:i,pageParams:c}){const d=i.length-1;return i.length>0?t.getNextPageParam(i[d],i,c[d],c):void 0}function jU(t,{pages:i,pageParams:c}){return i.length>0?t.getPreviousPageParam?.(i[0],i,c[0],c):void 0}var FU=class extends qz{#e;#t;#n;#r;constructor(t){super(),this.#e=t.client,this.mutationId=t.mutationId,this.#n=t.mutationCache,this.#t=[],this.state=t.state||Wz(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(i=>i!==t),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(t){const i=()=>{this.#i({type:"continue"})},c={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=Hz({fn:()=>this.options.mutationFn?this.options.mutationFn(t,c):Promise.reject(new Error("No mutationFn found")),onFail:(w,E)=>{this.#i({type:"failed",failureCount:w,error:E})},onPause:()=>{this.#i({type:"pause"})},onContinue:i,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const d=this.state.status==="pending",y=!this.#r.canStart();try{if(d)i();else{this.#i({type:"pending",variables:t,isPaused:y}),await this.#n.config.onMutate?.(t,this,c);const E=await this.options.onMutate?.(t,c);E!==this.state.context&&this.#i({type:"pending",context:E,variables:t,isPaused:y})}const w=await this.#r.start();return await this.#n.config.onSuccess?.(w,t,this.state.context,this,c),await this.options.onSuccess?.(w,t,this.state.context,c),await this.#n.config.onSettled?.(w,null,this.state.variables,this.state.context,this,c),await this.options.onSettled?.(w,null,t,this.state.context,c),this.#i({type:"success",data:w}),w}catch(w){try{throw await this.#n.config.onError?.(w,t,this.state.context,this,c),await this.options.onError?.(w,t,this.state.context,c),await this.#n.config.onSettled?.(void 0,w,this.state.variables,this.state.context,this,c),await this.options.onSettled?.(void 0,w,t,this.state.context,c),w}finally{this.#i({type:"error",error:w})}}finally{this.#n.runNext(this)}}#i(t){const i=c=>{switch(t.type){case"failed":return{...c,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...c,isPaused:!0};case"continue":return{...c,isPaused:!1};case"pending":return{...c,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...c,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...c,data:void 0,error:t.error,failureCount:c.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=i(this.state),Ra.batch(()=>{this.#t.forEach(c=>{c.onMutationUpdate(t)}),this.#n.notify({mutation:this,type:"updated",action:t})})}};function Wz(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var BU=class extends Ox{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,i,c){const d=new FU({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(i),state:c});return this.add(d),d}add(t){this.#e.add(t);const i=v1(t);if(typeof i=="string"){const c=this.#t.get(i);c?c.push(t):this.#t.set(i,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const i=v1(t);if(typeof i=="string"){const c=this.#t.get(i);if(c)if(c.length>1){const d=c.indexOf(t);d!==-1&&c.splice(d,1)}else c[0]===t&&this.#t.delete(i)}}this.notify({type:"removed",mutation:t})}canRun(t){const i=v1(t);if(typeof i=="string"){const d=this.#t.get(i)?.find(y=>y.state.status==="pending");return!d||d===t}else return!0}runNext(t){const i=v1(t);return typeof i=="string"?this.#t.get(i)?.find(d=>d!==t&&d.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ra.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const i={exact:!0,...t};return this.getAll().find(c=>II(i,c))}findAll(t={}){return this.getAll().filter(i=>II(t,i))}notify(t){Ra.batch(()=>{this.listeners.forEach(i=>{i(t)})})}resumePausedMutations(){const t=this.getAll().filter(i=>i.state.isPaused);return Ra.batch(()=>Promise.all(t.map(i=>i.continue().catch(Jl))))}};function v1(t){return t.options.scope?.id}var VU=class extends Ox{#e;#t=void 0;#n;#r;constructor(i,c){super(),this.#e=i,this.setOptions(c),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(i){const c=this.options;this.options=this.#e.defaultMutationOptions(i),uw(this.options,c)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),c?.mutationKey&&this.options.mutationKey&&F_(c.mutationKey)!==F_(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(i){this.#i(),this.#o(i)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#i(),this.#o()}mutate(i,c){return this.#r=c,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(i)}#i(){const i=this.#n?.state??Wz();this.#t={...i,isPending:i.status==="pending",isSuccess:i.status==="success",isError:i.status==="error",isIdle:i.status==="idle",mutate:this.mutate,reset:this.reset}}#o(i){Ra.batch(()=>{if(this.#r&&this.hasListeners()){const c=this.#t.variables,d=this.#t.context,y={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};i?.type==="success"?(this.#r.onSuccess?.(i.data,c,d,y),this.#r.onSettled?.(i.data,null,c,d,y)):i?.type==="error"&&(this.#r.onError?.(i.error,c,d,y),this.#r.onSettled?.(void 0,i.error,c,d,y))}this.listeners.forEach(c=>{c(this.#t)})})}},UU=class extends Ox{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,i,c){const d=i.queryKey,y=i.queryHash??tA(d,i);let w=this.get(y);return w||(w=new zU({client:t,queryKey:d,queryHash:y,options:t.defaultQueryOptions(i),state:c,defaultOptions:t.getQueryDefaults(d)}),this.add(w)),w}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const i=this.#e.get(t.queryHash);i&&(t.destroy(),i===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Ra.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const i={exact:!0,...t};return this.getAll().find(c=>MI(i,c))}findAll(t={}){const i=this.getAll();return Object.keys(t).length>0?i.filter(c=>MI(t,c)):i}notify(t){Ra.batch(()=>{this.listeners.forEach(i=>{i(t)})})}onFocus(){Ra.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Ra.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},$U=class{#e;#t;#n;#r;#i;#o;#a;#s;constructor(t={}){this.#e=t.queryCache||new UU,this.#t=t.mutationCache||new BU,this.#n=t.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=iA.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=dw.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const i=this.defaultQueryOptions({queryKey:t});return this.#e.get(i.queryHash)?.state.data}ensureQueryData(t){const i=this.defaultQueryOptions(t),c=this.#e.build(this,i),d=c.state.data;return d===void 0?this.fetchQuery(t):(t.revalidateIfStale&&c.isStaleByTime(ng(i.staleTime,c))&&this.prefetchQuery(i),Promise.resolve(d))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:i,state:c})=>{const d=c.data;return[i,d]})}setQueryData(t,i,c){const d=this.defaultQueryOptions({queryKey:t}),w=this.#e.get(d.queryHash)?.state.data,E=TU(i,w);if(E!==void 0)return this.#e.build(this,d).setData(E,{...c,manual:!0})}setQueriesData(t,i,c){return Ra.batch(()=>this.#e.findAll(t).map(({queryKey:d})=>[d,this.setQueryData(d,i,c)]))}getQueryState(t){const i=this.defaultQueryOptions({queryKey:t});return this.#e.get(i.queryHash)?.state}removeQueries(t){const i=this.#e;Ra.batch(()=>{i.findAll(t).forEach(c=>{i.remove(c)})})}resetQueries(t,i){const c=this.#e;return Ra.batch(()=>(c.findAll(t).forEach(d=>{d.reset()}),this.refetchQueries({type:"active",...t},i)))}cancelQueries(t,i={}){const c={revert:!0,...i},d=Ra.batch(()=>this.#e.findAll(t).map(y=>y.cancel(c)));return Promise.all(d).then(Jl).catch(Jl)}invalidateQueries(t,i={}){return Ra.batch(()=>(this.#e.findAll(t).forEach(c=>{c.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},i)))}refetchQueries(t,i={}){const c={...i,cancelRefetch:i.cancelRefetch??!0},d=Ra.batch(()=>this.#e.findAll(t).filter(y=>!y.isDisabled()&&!y.isStatic()).map(y=>{let w=y.fetch(void 0,c);return c.throwOnError||(w=w.catch(Jl)),y.state.fetchStatus==="paused"?Promise.resolve():w}));return Promise.all(d).then(Jl)}fetchQuery(t){const i=this.defaultQueryOptions(t);i.retry===void 0&&(i.retry=!1);const c=this.#e.build(this,i);return c.isStaleByTime(ng(i.staleTime,c))?c.fetch(i):Promise.resolve(c.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Jl).catch(Jl)}fetchInfiniteQuery(t){return t.behavior=kI(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Jl).catch(Jl)}ensureInfiniteQueryData(t){return t.behavior=kI(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return dw.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,i){this.#r.set(F_(t),{queryKey:t,defaultOptions:i})}getQueryDefaults(t){const i=[...this.#r.values()],c={};return i.forEach(d=>{A0(t,d.queryKey)&&Object.assign(c,d.defaultOptions)}),c}setMutationDefaults(t,i){this.#i.set(F_(t),{mutationKey:t,defaultOptions:i})}getMutationDefaults(t){const i=[...this.#i.values()],c={};return i.forEach(d=>{A0(t,d.mutationKey)&&Object.assign(c,d.defaultOptions)}),c}defaultQueryOptions(t){if(t._defaulted)return t;const i={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return i.queryHash||(i.queryHash=tA(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===nA&&(i.enabled=!1),i}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},Xz=Z.createContext(void 0),nd=t=>{const i=Z.useContext(Xz);if(!i)throw new Error("No QueryClient set, use QueryClientProvider to set one");return i},GU=({client:t,children:i})=>(Z.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),C.jsx(Xz.Provider,{value:t,children:i})),Kz=Z.createContext(!1),HU=()=>Z.useContext(Kz);Kz.Provider;function qU(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var ZU=Z.createContext(qU()),WU=()=>Z.useContext(ZU),XU=(t,i)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(i.isReset()||(t.retryOnMount=!1))},KU=t=>{Z.useEffect(()=>{t.clearReset()},[t])},YU=({result:t,errorResetBoundary:i,throwOnError:c,query:d,suspense:y})=>t.isError&&!i.isReset()&&!t.isFetching&&d&&(y&&t.data===void 0||$z(c,[t.error,d])),QU=t=>{if(t.suspense){const c=y=>y==="static"?y:Math.max(y??1e3,1e3),d=t.staleTime;t.staleTime=typeof d=="function"?(...y)=>c(d(...y)):c(d),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},JU=(t,i)=>t.isLoading&&t.isFetching&&!i,e6=(t,i)=>t?.suspense&&i.isPending,FI=(t,i,c)=>i.fetchOptimistic(t).catch(()=>{c.clearReset()});function t6(t,i,c){const d=HU(),y=WU(),w=nd(),E=w.defaultQueryOptions(t);w.getDefaultOptions().queries?._experimental_beforeQuery?.(E),E._optimisticResults=d?"isRestoring":"optimistic",QU(E),XU(E,y),KU(y);const s=!w.getQueryCache().get(E.queryHash),[O]=Z.useState(()=>new i(w,E)),z=O.getOptimisticResult(E),j=!d&&t.subscribed!==!1;if(Z.useSyncExternalStore(Z.useCallback(H=>{const Y=j?O.subscribe(Ra.batchCalls(H)):Jl;return O.updateResult(),Y},[O,j]),()=>O.getCurrentResult(),()=>O.getCurrentResult()),Z.useEffect(()=>{O.setOptions(E)},[E,O]),e6(E,z))throw FI(E,O,y);if(YU({result:z,errorResetBoundary:y,throwOnError:E.throwOnError,query:w.getQueryCache().get(E.queryHash),suspense:E.suspense}))throw z.error;return w.getDefaultOptions().queries?._experimental_afterQuery?.(E,z),E.experimental_prefetchInRender&&!j_&&JU(z,d)&&(s?FI(E,O,y):w.getQueryCache().get(E.queryHash)?.promise)?.catch(Jl).finally(()=>{O.updateResult()}),E.notifyOnChangeProps?z:O.trackResult(z)}function $o(t,i){return t6(t,LU)}function Ns(t,i){const c=nd(),[d]=Z.useState(()=>new VU(c,t));Z.useEffect(()=>{d.setOptions(t)},[d,t]);const y=Z.useSyncExternalStore(Z.useCallback(E=>d.subscribe(Ra.batchCalls(E)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),w=Z.useCallback((E,s)=>{d.mutate(E,s).catch(Jl)},[d]);if(y.error&&$z(d.options.throwOnError,[y.error]))throw y.error;return{...y,mutate:w,mutateAsync:y.mutate}}var n6=function(){return null};const i6=new $U({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:0},mutations:{retry:0}}}),r6=({children:t})=>C.jsxs(GU,{client:i6,children:[t,C.jsx(n6,{initialIsOpen:!1})]}),pr=t=>typeof t=="string",i0=()=>{let t,i;const c=new Promise((d,y)=>{t=d,i=y});return c.resolve=t,c.reject=i,c},BI=t=>t==null?"":""+t,s6=(t,i,c)=>{t.forEach(d=>{i[d]&&(c[d]=i[d])})},o6=/###/g,VI=t=>t&&t.indexOf("###")>-1?t.replace(o6,"."):t,UI=t=>!t||pr(t),d0=(t,i,c)=>{const d=pr(i)?i.split("."):i;let y=0;for(;y<d.length-1;){if(UI(t))return{};const w=VI(d[y]);!t[w]&&c&&(t[w]=new c),Object.prototype.hasOwnProperty.call(t,w)?t=t[w]:t={},++y}return UI(t)?{}:{obj:t,k:VI(d[y])}},$I=(t,i,c)=>{const{obj:d,k:y}=d0(t,i,Object);if(d!==void 0||i.length===1){d[y]=c;return}let w=i[i.length-1],E=i.slice(0,i.length-1),s=d0(t,E,Object);for(;s.obj===void 0&&E.length;)w=`${E[E.length-1]}.${w}`,E=E.slice(0,E.length-1),s=d0(t,E,Object),s?.obj&&typeof s.obj[`${s.k}.${w}`]<"u"&&(s.obj=void 0);s.obj[`${s.k}.${w}`]=c},a6=(t,i,c,d)=>{const{obj:y,k:w}=d0(t,i,Object);y[w]=y[w]||[],y[w].push(c)},hw=(t,i)=>{const{obj:c,k:d}=d0(t,i);if(c&&Object.prototype.hasOwnProperty.call(c,d))return c[d]},l6=(t,i,c)=>{const d=hw(t,c);return d!==void 0?d:hw(i,c)},Yz=(t,i,c)=>{for(const d in i)d!=="__proto__"&&d!=="constructor"&&(d in t?pr(t[d])||t[d]instanceof String||pr(i[d])||i[d]instanceof String?c&&(t[d]=i[d]):Yz(t[d],i[d],c):t[d]=i[d]);return t},Jy=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var c6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const u6=t=>pr(t)?t.replace(/[&<>"'\/]/g,i=>c6[i]):t;class d6{constructor(i){this.capacity=i,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(i){const c=this.regExpMap.get(i);if(c!==void 0)return c;const d=new RegExp(i);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(i,d),this.regExpQueue.push(i),d}}const h6=[" ",",","?","!",";"],f6=new d6(20),p6=(t,i,c)=>{i=i||"",c=c||"";const d=h6.filter(E=>i.indexOf(E)<0&&c.indexOf(E)<0);if(d.length===0)return!0;const y=f6.getRegExp(`(${d.map(E=>E==="?"?"\\?":E).join("|")})`);let w=!y.test(t);if(!w){const E=t.indexOf(c);E>0&&!y.test(t.substring(0,E))&&(w=!0)}return w},j2=(t,i,c=".")=>{if(!t)return;if(t[i])return Object.prototype.hasOwnProperty.call(t,i)?t[i]:void 0;const d=i.split(c);let y=t;for(let w=0;w<d.length;){if(!y||typeof y!="object")return;let E,s="";for(let O=w;O<d.length;++O)if(O!==w&&(s+=c),s+=d[O],E=y[s],E!==void 0){if(["string","number","boolean"].indexOf(typeof E)>-1&&O<d.length-1)continue;w+=O-w+1;break}y=E}return y},C0=t=>t?.replace("_","-"),m6={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,i){console?.[t]?.apply?.(console,i)}};class fw{constructor(i,c={}){this.init(i,c)}init(i,c={}){this.prefix=c.prefix||"i18next:",this.logger=i||m6,this.options=c,this.debug=c.debug}log(...i){return this.forward(i,"log","",!0)}warn(...i){return this.forward(i,"warn","",!0)}error(...i){return this.forward(i,"error","")}deprecate(...i){return this.forward(i,"warn","WARNING DEPRECATED: ",!0)}forward(i,c,d,y){return y&&!this.debug?null:(pr(i[0])&&(i[0]=`${d}${this.prefix} ${i[0]}`),this.logger[c](i))}create(i){return new fw(this.logger,{prefix:`${this.prefix}:${i}:`,...this.options})}clone(i){return i=i||this.options,i.prefix=i.prefix||this.prefix,new fw(this.logger,i)}}var _f=new fw;class Hw{constructor(){this.observers={}}on(i,c){return i.split(" ").forEach(d=>{this.observers[d]||(this.observers[d]=new Map);const y=this.observers[d].get(c)||0;this.observers[d].set(c,y+1)}),this}off(i,c){if(this.observers[i]){if(!c){delete this.observers[i];return}this.observers[i].delete(c)}}emit(i,...c){this.observers[i]&&Array.from(this.observers[i].entries()).forEach(([y,w])=>{for(let E=0;E<w;E++)y(...c)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([y,w])=>{for(let E=0;E<w;E++)y.apply(y,[i,...c])})}}class GI extends Hw{constructor(i,c={ns:["translation"],defaultNS:"translation"}){super(),this.data=i||{},this.options=c,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(i){this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}removeNamespaces(i){const c=this.options.ns.indexOf(i);c>-1&&this.options.ns.splice(c,1)}getResource(i,c,d,y={}){const w=y.keySeparator!==void 0?y.keySeparator:this.options.keySeparator,E=y.ignoreJSONStructure!==void 0?y.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;i.indexOf(".")>-1?s=i.split("."):(s=[i,c],d&&(Array.isArray(d)?s.push(...d):pr(d)&&w?s.push(...d.split(w)):s.push(d)));const O=hw(this.data,s);return!O&&!c&&!d&&i.indexOf(".")>-1&&(i=s[0],c=s[1],d=s.slice(2).join(".")),O||!E||!pr(d)?O:j2(this.data?.[i]?.[c],d,w)}addResource(i,c,d,y,w={silent:!1}){const E=w.keySeparator!==void 0?w.keySeparator:this.options.keySeparator;let s=[i,c];d&&(s=s.concat(E?d.split(E):d)),i.indexOf(".")>-1&&(s=i.split("."),y=c,c=s[1]),this.addNamespaces(c),$I(this.data,s,y),w.silent||this.emit("added",i,c,d,y)}addResources(i,c,d,y={silent:!1}){for(const w in d)(pr(d[w])||Array.isArray(d[w]))&&this.addResource(i,c,w,d[w],{silent:!0});y.silent||this.emit("added",i,c,d)}addResourceBundle(i,c,d,y,w,E={silent:!1,skipCopy:!1}){let s=[i,c];i.indexOf(".")>-1&&(s=i.split("."),y=d,d=c,c=s[1]),this.addNamespaces(c);let O=hw(this.data,s)||{};E.skipCopy||(d=JSON.parse(JSON.stringify(d))),y?Yz(O,d,w):O={...O,...d},$I(this.data,s,O),E.silent||this.emit("added",i,c,d)}removeResourceBundle(i,c){this.hasResourceBundle(i,c)&&delete this.data[i][c],this.removeNamespaces(c),this.emit("removed",i,c)}hasResourceBundle(i,c){return this.getResource(i,c)!==void 0}getResourceBundle(i,c){return c||(c=this.options.defaultNS),this.getResource(i,c)}getDataByLanguage(i){return this.data[i]}hasLanguageSomeTranslations(i){const c=this.getDataByLanguage(i);return!!(c&&Object.keys(c)||[]).find(y=>c[y]&&Object.keys(c[y]).length>0)}toJSON(){return this.data}}var Qz={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,i,c,d,y){return t.forEach(w=>{i=this.processors[w]?.process(i,c,d,y)??i}),i}};const Jz=Symbol("i18next/PATH_KEY");function g6(){const t=[],i=Object.create(null);let c;return i.get=(d,y)=>(c?.revoke?.(),y===Jz?t:(t.push(y),c=Proxy.revocable(d,i),c.proxy)),Proxy.revocable(Object.create(null),i).proxy}function F2(t,i){const{[Jz]:c}=t(g6());return c.join(i?.keySeparator??".")}const HI={},BT=t=>!pr(t)&&typeof t!="boolean"&&typeof t!="number";class pw extends Hw{constructor(i,c={}){super(),s6(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],i,this),this.options=c,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=_f.create("translator")}changeLanguage(i){i&&(this.language=i)}exists(i,c={interpolation:{}}){const d={...c};if(i==null)return!1;const y=this.resolve(i,d);if(y?.res===void 0)return!1;const w=BT(y.res);return!(d.returnObjects===!1&&w)}extractFromKey(i,c){let d=c.nsSeparator!==void 0?c.nsSeparator:this.options.nsSeparator;d===void 0&&(d=":");const y=c.keySeparator!==void 0?c.keySeparator:this.options.keySeparator;let w=c.ns||this.options.defaultNS||[];const E=d&&i.indexOf(d)>-1,s=!this.options.userDefinedKeySeparator&&!c.keySeparator&&!this.options.userDefinedNsSeparator&&!c.nsSeparator&&!p6(i,d,y);if(E&&!s){const O=i.match(this.interpolator.nestingRegexp);if(O&&O.length>0)return{key:i,namespaces:pr(w)?[w]:w};const z=i.split(d);(d!==y||d===y&&this.options.ns.indexOf(z[0])>-1)&&(w=z.shift()),i=z.join(y)}return{key:i,namespaces:pr(w)?[w]:w}}translate(i,c,d){let y=typeof c=="object"?{...c}:c;if(typeof y!="object"&&this.options.overloadTranslationOptionHandler&&(y=this.options.overloadTranslationOptionHandler(arguments)),typeof y=="object"&&(y={...y}),y||(y={}),i==null)return"";typeof i=="function"&&(i=F2(i,{...this.options,...y})),Array.isArray(i)||(i=[String(i)]);const w=y.returnDetails!==void 0?y.returnDetails:this.options.returnDetails,E=y.keySeparator!==void 0?y.keySeparator:this.options.keySeparator,{key:s,namespaces:O}=this.extractFromKey(i[i.length-1],y),z=O[O.length-1];let j=y.nsSeparator!==void 0?y.nsSeparator:this.options.nsSeparator;j===void 0&&(j=":");const H=y.lng||this.language,Y=y.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(H?.toLowerCase()==="cimode")return Y?w?{res:`${z}${j}${s}`,usedKey:s,exactUsedKey:s,usedLng:H,usedNS:z,usedParams:this.getUsedParamsDetails(y)}:`${z}${j}${s}`:w?{res:s,usedKey:s,exactUsedKey:s,usedLng:H,usedNS:z,usedParams:this.getUsedParamsDetails(y)}:s;const ie=this.resolve(i,y);let oe=ie?.res;const ee=ie?.usedKey||s,le=ie?.exactUsedKey||s,ge=["[object Number]","[object Function]","[object RegExp]"],pe=y.joinArrays!==void 0?y.joinArrays:this.options.joinArrays,_e=!this.i18nFormat||this.i18nFormat.handleAsObject,Re=y.count!==void 0&&!pr(y.count),xe=pw.hasDefaultValue(y),Ze=Re?this.pluralResolver.getSuffix(H,y.count,y):"",Le=y.ordinal&&Re?this.pluralResolver.getSuffix(H,y.count,{ordinal:!1}):"",$e=Re&&!y.ordinal&&y.count===0,st=$e&&y[`defaultValue${this.options.pluralSeparator}zero`]||y[`defaultValue${Ze}`]||y[`defaultValue${Le}`]||y.defaultValue;let Et=oe;_e&&!oe&&xe&&(Et=st);const Ut=BT(Et),$t=Object.prototype.toString.apply(Et);if(_e&&Et&&Ut&&ge.indexOf($t)<0&&!(pr(pe)&&Array.isArray(Et))){if(!y.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const tt=this.options.returnedObjectHandler?this.options.returnedObjectHandler(ee,Et,{...y,ns:O}):`key '${s} (${this.language})' returned an object instead of string.`;return w?(ie.res=tt,ie.usedParams=this.getUsedParamsDetails(y),ie):tt}if(E){const tt=Array.isArray(Et),ut=tt?[]:{},on=tt?le:ee;for(const Ke in Et)if(Object.prototype.hasOwnProperty.call(Et,Ke)){const ze=`${on}${E}${Ke}`;xe&&!oe?ut[Ke]=this.translate(ze,{...y,defaultValue:BT(st)?st[Ke]:void 0,joinArrays:!1,ns:O}):ut[Ke]=this.translate(ze,{...y,joinArrays:!1,ns:O}),ut[Ke]===ze&&(ut[Ke]=Et[Ke])}oe=ut}}else if(_e&&pr(pe)&&Array.isArray(oe))oe=oe.join(pe),oe&&(oe=this.extendTranslation(oe,i,y,d));else{let tt=!1,ut=!1;!this.isValidLookup(oe)&&xe&&(tt=!0,oe=st),this.isValidLookup(oe)||(ut=!0,oe=s);const Ke=(y.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&ut?void 0:oe,ze=xe&&st!==oe&&this.options.updateMissing;if(ut||tt||ze){if(this.logger.log(ze?"updateKey":"missingKey",H,z,s,ze?st:oe),E){const Me=this.resolve(s,{...y,keySeparator:!1});Me&&Me.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Fe=[];const kt=this.languageUtils.getFallbackCodes(this.options.fallbackLng,y.lng||this.language);if(this.options.saveMissingTo==="fallback"&&kt&&kt[0])for(let Me=0;Me<kt.length;Me++)Fe.push(kt[Me]);else this.options.saveMissingTo==="all"?Fe=this.languageUtils.toResolveHierarchy(y.lng||this.language):Fe.push(y.lng||this.language);const fn=(Me,ct,vt)=>{const Kt=xe&&vt!==oe?vt:Ke;this.options.missingKeyHandler?this.options.missingKeyHandler(Me,z,ct,Kt,ze,y):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(Me,z,ct,Kt,ze,y),this.emit("missingKey",Me,z,ct,oe)};this.options.saveMissing&&(this.options.saveMissingPlurals&&Re?Fe.forEach(Me=>{const ct=this.pluralResolver.getSuffixes(Me,y);$e&&y[`defaultValue${this.options.pluralSeparator}zero`]&&ct.indexOf(`${this.options.pluralSeparator}zero`)<0&&ct.push(`${this.options.pluralSeparator}zero`),ct.forEach(vt=>{fn([Me],s+vt,y[`defaultValue${vt}`]||st)})}):fn(Fe,s,st))}oe=this.extendTranslation(oe,i,y,ie,d),ut&&oe===s&&this.options.appendNamespaceToMissingKey&&(oe=`${z}${j}${s}`),(ut||tt)&&this.options.parseMissingKeyHandler&&(oe=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${z}${j}${s}`:s,tt?oe:void 0,y))}return w?(ie.res=oe,ie.usedParams=this.getUsedParamsDetails(y),ie):oe}extendTranslation(i,c,d,y,w){if(this.i18nFormat?.parse)i=this.i18nFormat.parse(i,{...this.options.interpolation.defaultVariables,...d},d.lng||this.language||y.usedLng,y.usedNS,y.usedKey,{resolved:y});else if(!d.skipInterpolation){d.interpolation&&this.interpolator.init({...d,interpolation:{...this.options.interpolation,...d.interpolation}});const O=pr(i)&&(d?.interpolation?.skipOnVariables!==void 0?d.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let z;if(O){const H=i.match(this.interpolator.nestingRegexp);z=H&&H.length}let j=d.replace&&!pr(d.replace)?d.replace:d;if(this.options.interpolation.defaultVariables&&(j={...this.options.interpolation.defaultVariables,...j}),i=this.interpolator.interpolate(i,j,d.lng||this.language||y.usedLng,d),O){const H=i.match(this.interpolator.nestingRegexp),Y=H&&H.length;z<Y&&(d.nest=!1)}!d.lng&&y&&y.res&&(d.lng=this.language||y.usedLng),d.nest!==!1&&(i=this.interpolator.nest(i,(...H)=>w?.[0]===H[0]&&!d.context?(this.logger.warn(`It seems you are nesting recursively key: ${H[0]} in key: ${c[0]}`),null):this.translate(...H,c),d)),d.interpolation&&this.interpolator.reset()}const E=d.postProcess||this.options.postProcess,s=pr(E)?[E]:E;return i!=null&&s?.length&&d.applyPostProcessor!==!1&&(i=Qz.handle(s,i,c,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...y,usedParams:this.getUsedParamsDetails(d)},...d}:d,this)),i}resolve(i,c={}){let d,y,w,E,s;return pr(i)&&(i=[i]),i.forEach(O=>{if(this.isValidLookup(d))return;const z=this.extractFromKey(O,c),j=z.key;y=j;let H=z.namespaces;this.options.fallbackNS&&(H=H.concat(this.options.fallbackNS));const Y=c.count!==void 0&&!pr(c.count),ie=Y&&!c.ordinal&&c.count===0,oe=c.context!==void 0&&(pr(c.context)||typeof c.context=="number")&&c.context!=="",ee=c.lngs?c.lngs:this.languageUtils.toResolveHierarchy(c.lng||this.language,c.fallbackLng);H.forEach(le=>{this.isValidLookup(d)||(s=le,!HI[`${ee[0]}-${le}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(s)&&(HI[`${ee[0]}-${le}`]=!0,this.logger.warn(`key "${y}" for languages "${ee.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),ee.forEach(ge=>{if(this.isValidLookup(d))return;E=ge;const pe=[j];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(pe,j,ge,le,c);else{let Re;Y&&(Re=this.pluralResolver.getSuffix(ge,c.count,c));const xe=`${this.options.pluralSeparator}zero`,Ze=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(Y&&(c.ordinal&&Re.indexOf(Ze)===0&&pe.push(j+Re.replace(Ze,this.options.pluralSeparator)),pe.push(j+Re),ie&&pe.push(j+xe)),oe){const Le=`${j}${this.options.contextSeparator||"_"}${c.context}`;pe.push(Le),Y&&(c.ordinal&&Re.indexOf(Ze)===0&&pe.push(Le+Re.replace(Ze,this.options.pluralSeparator)),pe.push(Le+Re),ie&&pe.push(Le+xe))}}let _e;for(;_e=pe.pop();)this.isValidLookup(d)||(w=_e,d=this.getResource(ge,le,_e,c))}))})}),{res:d,usedKey:y,exactUsedKey:w,usedLng:E,usedNS:s}}isValidLookup(i){return i!==void 0&&!(!this.options.returnNull&&i===null)&&!(!this.options.returnEmptyString&&i==="")}getResource(i,c,d,y={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(i,c,d,y):this.resourceStore.getResource(i,c,d,y)}getUsedParamsDetails(i={}){const c=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],d=i.replace&&!pr(i.replace);let y=d?i.replace:i;if(d&&typeof i.count<"u"&&(y.count=i.count),this.options.interpolation.defaultVariables&&(y={...this.options.interpolation.defaultVariables,...y}),!d){y={...y};for(const w of c)delete y[w]}return y}static hasDefaultValue(i){const c="defaultValue";for(const d in i)if(Object.prototype.hasOwnProperty.call(i,d)&&c===d.substring(0,c.length)&&i[d]!==void 0)return!0;return!1}}class qI{constructor(i){this.options=i,this.supportedLngs=this.options.supportedLngs||!1,this.logger=_f.create("languageUtils")}getScriptPartFromCode(i){if(i=C0(i),!i||i.indexOf("-")<0)return null;const c=i.split("-");return c.length===2||(c.pop(),c[c.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(c.join("-"))}getLanguagePartFromCode(i){if(i=C0(i),!i||i.indexOf("-")<0)return i;const c=i.split("-");return this.formatLanguageCode(c[0])}formatLanguageCode(i){if(pr(i)&&i.indexOf("-")>-1){let c;try{c=Intl.getCanonicalLocales(i)[0]}catch{}return c&&this.options.lowerCaseLng&&(c=c.toLowerCase()),c||(this.options.lowerCaseLng?i.toLowerCase():i)}return this.options.cleanCode||this.options.lowerCaseLng?i.toLowerCase():i}isSupportedCode(i){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(i=this.getLanguagePartFromCode(i)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(i)>-1}getBestMatchFromCodes(i){if(!i)return null;let c;return i.forEach(d=>{if(c)return;const y=this.formatLanguageCode(d);(!this.options.supportedLngs||this.isSupportedCode(y))&&(c=y)}),!c&&this.options.supportedLngs&&i.forEach(d=>{if(c)return;const y=this.getScriptPartFromCode(d);if(this.isSupportedCode(y))return c=y;const w=this.getLanguagePartFromCode(d);if(this.isSupportedCode(w))return c=w;c=this.options.supportedLngs.find(E=>{if(E===w)return E;if(!(E.indexOf("-")<0&&w.indexOf("-")<0)&&(E.indexOf("-")>0&&w.indexOf("-")<0&&E.substring(0,E.indexOf("-"))===w||E.indexOf(w)===0&&w.length>1))return E})}),c||(c=this.getFallbackCodes(this.options.fallbackLng)[0]),c}getFallbackCodes(i,c){if(!i)return[];if(typeof i=="function"&&(i=i(c)),pr(i)&&(i=[i]),Array.isArray(i))return i;if(!c)return i.default||[];let d=i[c];return d||(d=i[this.getScriptPartFromCode(c)]),d||(d=i[this.formatLanguageCode(c)]),d||(d=i[this.getLanguagePartFromCode(c)]),d||(d=i.default),d||[]}toResolveHierarchy(i,c){const d=this.getFallbackCodes((c===!1?[]:c)||this.options.fallbackLng||[],i),y=[],w=E=>{E&&(this.isSupportedCode(E)?y.push(E):this.logger.warn(`rejecting language code not found in supportedLngs: ${E}`))};return pr(i)&&(i.indexOf("-")>-1||i.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&w(this.formatLanguageCode(i)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&w(this.getScriptPartFromCode(i)),this.options.load!=="currentOnly"&&w(this.getLanguagePartFromCode(i))):pr(i)&&w(this.formatLanguageCode(i)),d.forEach(E=>{y.indexOf(E)<0&&w(this.formatLanguageCode(E))}),y}}const ZI={zero:0,one:1,two:2,few:3,many:4,other:5},WI={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class _6{constructor(i,c={}){this.languageUtils=i,this.options=c,this.logger=_f.create("pluralResolver"),this.pluralRulesCache={}}addRule(i,c){this.rules[i]=c}clearCache(){this.pluralRulesCache={}}getRule(i,c={}){const d=C0(i==="dev"?"en":i),y=c.ordinal?"ordinal":"cardinal",w=JSON.stringify({cleanedCode:d,type:y});if(w in this.pluralRulesCache)return this.pluralRulesCache[w];let E;try{E=new Intl.PluralRules(d,{type:y})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),WI;if(!i.match(/-|_/))return WI;const O=this.languageUtils.getLanguagePartFromCode(i);E=this.getRule(O,c)}return this.pluralRulesCache[w]=E,E}needsPlural(i,c={}){let d=this.getRule(i,c);return d||(d=this.getRule("dev",c)),d?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(i,c,d={}){return this.getSuffixes(i,d).map(y=>`${c}${y}`)}getSuffixes(i,c={}){let d=this.getRule(i,c);return d||(d=this.getRule("dev",c)),d?d.resolvedOptions().pluralCategories.sort((y,w)=>ZI[y]-ZI[w]).map(y=>`${this.options.prepend}${c.ordinal?`ordinal${this.options.prepend}`:""}${y}`):[]}getSuffix(i,c,d={}){const y=this.getRule(i,d);return y?`${this.options.prepend}${d.ordinal?`ordinal${this.options.prepend}`:""}${y.select(c)}`:(this.logger.warn(`no plural rule found for: ${i}`),this.getSuffix("dev",c,d))}}const XI=(t,i,c,d=".",y=!0)=>{let w=l6(t,i,c);return!w&&y&&pr(c)&&(w=j2(t,c,d),w===void 0&&(w=j2(i,c,d))),w},VT=t=>t.replace(/\$/g,"$$$$");class y6{constructor(i={}){this.logger=_f.create("interpolator"),this.options=i,this.format=i?.interpolation?.format||(c=>c),this.init(i)}init(i={}){i.interpolation||(i.interpolation={escapeValue:!0});const{escape:c,escapeValue:d,useRawValueToEscape:y,prefix:w,prefixEscaped:E,suffix:s,suffixEscaped:O,formatSeparator:z,unescapeSuffix:j,unescapePrefix:H,nestingPrefix:Y,nestingPrefixEscaped:ie,nestingSuffix:oe,nestingSuffixEscaped:ee,nestingOptionsSeparator:le,maxReplaces:ge,alwaysFormat:pe}=i.interpolation;this.escape=c!==void 0?c:u6,this.escapeValue=d!==void 0?d:!0,this.useRawValueToEscape=y!==void 0?y:!1,this.prefix=w?Jy(w):E||"{{",this.suffix=s?Jy(s):O||"}}",this.formatSeparator=z||",",this.unescapePrefix=j?"":H||"-",this.unescapeSuffix=this.unescapePrefix?"":j||"",this.nestingPrefix=Y?Jy(Y):ie||Jy("$t("),this.nestingSuffix=oe?Jy(oe):ee||Jy(")"),this.nestingOptionsSeparator=le||",",this.maxReplaces=ge||1e3,this.alwaysFormat=pe!==void 0?pe:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const i=(c,d)=>c?.source===d?(c.lastIndex=0,c):new RegExp(d,"g");this.regexp=i(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=i(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=i(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(i,c,d,y){let w,E,s;const O=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},z=ie=>{if(ie.indexOf(this.formatSeparator)<0){const ge=XI(c,O,ie,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(ge,void 0,d,{...y,...c,interpolationkey:ie}):ge}const oe=ie.split(this.formatSeparator),ee=oe.shift().trim(),le=oe.join(this.formatSeparator).trim();return this.format(XI(c,O,ee,this.options.keySeparator,this.options.ignoreJSONStructure),le,d,{...y,...c,interpolationkey:ee})};this.resetRegExp();const j=y?.missingInterpolationHandler||this.options.missingInterpolationHandler,H=y?.interpolation?.skipOnVariables!==void 0?y.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:ie=>VT(ie)},{regex:this.regexp,safeValue:ie=>this.escapeValue?VT(this.escape(ie)):VT(ie)}].forEach(ie=>{for(s=0;w=ie.regex.exec(i);){const oe=w[1].trim();if(E=z(oe),E===void 0)if(typeof j=="function"){const le=j(i,w,y);E=pr(le)?le:""}else if(y&&Object.prototype.hasOwnProperty.call(y,oe))E="";else if(H){E=w[0];continue}else this.logger.warn(`missed to pass in variable ${oe} for interpolating ${i}`),E="";else!pr(E)&&!this.useRawValueToEscape&&(E=BI(E));const ee=ie.safeValue(E);if(i=i.replace(w[0],ee),H?(ie.regex.lastIndex+=E.length,ie.regex.lastIndex-=w[0].length):ie.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),i}nest(i,c,d={}){let y,w,E;const s=(O,z)=>{const j=this.nestingOptionsSeparator;if(O.indexOf(j)<0)return O;const H=O.split(new RegExp(`${j}[ ]*{`));let Y=`{${H[1]}`;O=H[0],Y=this.interpolate(Y,E);const ie=Y.match(/'/g),oe=Y.match(/"/g);((ie?.length??0)%2===0&&!oe||oe.length%2!==0)&&(Y=Y.replace(/'/g,'"'));try{E=JSON.parse(Y),z&&(E={...z,...E})}catch(ee){return this.logger.warn(`failed parsing options string in nesting for key ${O}`,ee),`${O}${j}${Y}`}return E.defaultValue&&E.defaultValue.indexOf(this.prefix)>-1&&delete E.defaultValue,O};for(;y=this.nestingRegexp.exec(i);){let O=[];E={...d},E=E.replace&&!pr(E.replace)?E.replace:E,E.applyPostProcessor=!1,delete E.defaultValue;const z=/{.*}/.test(y[1])?y[1].lastIndexOf("}")+1:y[1].indexOf(this.formatSeparator);if(z!==-1&&(O=y[1].slice(z).split(this.formatSeparator).map(j=>j.trim()).filter(Boolean),y[1]=y[1].slice(0,z)),w=c(s.call(this,y[1].trim(),E),E),w&&y[0]===i&&!pr(w))return w;pr(w)||(w=BI(w)),w||(this.logger.warn(`missed to resolve ${y[1]} for nesting ${i}`),w=""),O.length&&(w=O.reduce((j,H)=>this.format(j,H,d.lng,{...d,interpolationkey:y[1].trim()}),w.trim())),i=i.replace(y[0],w),this.regexp.lastIndex=0}return i}}const x6=t=>{let i=t.toLowerCase().trim();const c={};if(t.indexOf("(")>-1){const d=t.split("(");i=d[0].toLowerCase().trim();const y=d[1].substring(0,d[1].length-1);i==="currency"&&y.indexOf(":")<0?c.currency||(c.currency=y.trim()):i==="relativetime"&&y.indexOf(":")<0?c.range||(c.range=y.trim()):y.split(";").forEach(E=>{if(E){const[s,...O]=E.split(":"),z=O.join(":").trim().replace(/^'+|'+$/g,""),j=s.trim();c[j]||(c[j]=z),z==="false"&&(c[j]=!1),z==="true"&&(c[j]=!0),isNaN(z)||(c[j]=parseInt(z,10))}})}return{formatName:i,formatOptions:c}},KI=t=>{const i={};return(c,d,y)=>{let w=y;y&&y.interpolationkey&&y.formatParams&&y.formatParams[y.interpolationkey]&&y[y.interpolationkey]&&(w={...w,[y.interpolationkey]:void 0});const E=d+JSON.stringify(w);let s=i[E];return s||(s=t(C0(d),y),i[E]=s),s(c)}},v6=t=>(i,c,d)=>t(C0(c),d)(i);class b6{constructor(i={}){this.logger=_f.create("formatter"),this.options=i,this.init(i)}init(i,c={interpolation:{}}){this.formatSeparator=c.interpolation.formatSeparator||",";const d=c.cacheInBuiltFormats?KI:v6;this.formats={number:d((y,w)=>{const E=new Intl.NumberFormat(y,{...w});return s=>E.format(s)}),currency:d((y,w)=>{const E=new Intl.NumberFormat(y,{...w,style:"currency"});return s=>E.format(s)}),datetime:d((y,w)=>{const E=new Intl.DateTimeFormat(y,{...w});return s=>E.format(s)}),relativetime:d((y,w)=>{const E=new Intl.RelativeTimeFormat(y,{...w});return s=>E.format(s,w.range||"day")}),list:d((y,w)=>{const E=new Intl.ListFormat(y,{...w});return s=>E.format(s)})}}add(i,c){this.formats[i.toLowerCase().trim()]=c}addCached(i,c){this.formats[i.toLowerCase().trim()]=KI(c)}format(i,c,d,y={}){const w=c.split(this.formatSeparator);if(w.length>1&&w[0].indexOf("(")>1&&w[0].indexOf(")")<0&&w.find(s=>s.indexOf(")")>-1)){const s=w.findIndex(O=>O.indexOf(")")>-1);w[0]=[w[0],...w.splice(1,s)].join(this.formatSeparator)}return w.reduce((s,O)=>{const{formatName:z,formatOptions:j}=x6(O);if(this.formats[z]){let H=s;try{const Y=y?.formatParams?.[y.interpolationkey]||{},ie=Y.locale||Y.lng||y.locale||y.lng||d;H=this.formats[z](s,ie,{...j,...y,...Y})}catch(Y){this.logger.warn(Y)}return H}else this.logger.warn(`there was no format function for ${z}`);return s},i)}}const w6=(t,i)=>{t.pending[i]!==void 0&&(delete t.pending[i],t.pendingCount--)};class S6 extends Hw{constructor(i,c,d,y={}){super(),this.backend=i,this.store=c,this.services=d,this.languageUtils=d.languageUtils,this.options=y,this.logger=_f.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=y.maxParallelReads||10,this.readingCalls=0,this.maxRetries=y.maxRetries>=0?y.maxRetries:5,this.retryTimeout=y.retryTimeout>=1?y.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(d,y.backend,y)}queueLoad(i,c,d,y){const w={},E={},s={},O={};return i.forEach(z=>{let j=!0;c.forEach(H=>{const Y=`${z}|${H}`;!d.reload&&this.store.hasResourceBundle(z,H)?this.state[Y]=2:this.state[Y]<0||(this.state[Y]===1?E[Y]===void 0&&(E[Y]=!0):(this.state[Y]=1,j=!1,E[Y]===void 0&&(E[Y]=!0),w[Y]===void 0&&(w[Y]=!0),O[H]===void 0&&(O[H]=!0)))}),j||(s[z]=!0)}),(Object.keys(w).length||Object.keys(E).length)&&this.queue.push({pending:E,pendingCount:Object.keys(E).length,loaded:{},errors:[],callback:y}),{toLoad:Object.keys(w),pending:Object.keys(E),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(O)}}loaded(i,c,d){const y=i.split("|"),w=y[0],E=y[1];c&&this.emit("failedLoading",w,E,c),!c&&d&&this.store.addResourceBundle(w,E,d,void 0,void 0,{skipCopy:!0}),this.state[i]=c?-1:2,c&&d&&(this.state[i]=0);const s={};this.queue.forEach(O=>{a6(O.loaded,[w],E),w6(O,i),c&&O.errors.push(c),O.pendingCount===0&&!O.done&&(Object.keys(O.loaded).forEach(z=>{s[z]||(s[z]={});const j=O.loaded[z];j.length&&j.forEach(H=>{s[z][H]===void 0&&(s[z][H]=!0)})}),O.done=!0,O.errors.length?O.callback(O.errors):O.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(O=>!O.done)}read(i,c,d,y=0,w=this.retryTimeout,E){if(!i.length)return E(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:i,ns:c,fcName:d,tried:y,wait:w,callback:E});return}this.readingCalls++;const s=(z,j)=>{if(this.readingCalls--,this.waitingReads.length>0){const H=this.waitingReads.shift();this.read(H.lng,H.ns,H.fcName,H.tried,H.wait,H.callback)}if(z&&j&&y<this.maxRetries){setTimeout(()=>{this.read.call(this,i,c,d,y+1,w*2,E)},w);return}E(z,j)},O=this.backend[d].bind(this.backend);if(O.length===2){try{const z=O(i,c);z&&typeof z.then=="function"?z.then(j=>s(null,j)).catch(s):s(null,z)}catch(z){s(z)}return}return O(i,c,s)}prepareLoading(i,c,d={},y){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),y&&y();pr(i)&&(i=this.languageUtils.toResolveHierarchy(i)),pr(c)&&(c=[c]);const w=this.queueLoad(i,c,d,y);if(!w.toLoad.length)return w.pending.length||y(),null;w.toLoad.forEach(E=>{this.loadOne(E)})}load(i,c,d){this.prepareLoading(i,c,{},d)}reload(i,c,d){this.prepareLoading(i,c,{reload:!0},d)}loadOne(i,c=""){const d=i.split("|"),y=d[0],w=d[1];this.read(y,w,"read",void 0,void 0,(E,s)=>{E&&this.logger.warn(`${c}loading namespace ${w} for language ${y} failed`,E),!E&&s&&this.logger.log(`${c}loaded namespace ${w} for language ${y}`,s),this.loaded(i,E,s)})}saveMissing(i,c,d,y,w,E={},s=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(c)){this.logger.warn(`did not save key "${d}" as the namespace "${c}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(d==null||d==="")){if(this.backend?.create){const O={...E,isUpdate:w},z=this.backend.create.bind(this.backend);if(z.length<6)try{let j;z.length===5?j=z(i,c,d,y,O):j=z(i,c,d,y),j&&typeof j.then=="function"?j.then(H=>s(null,H)).catch(s):s(null,j)}catch(j){s(j)}else z(i,c,d,y,s,O)}!i||!i[0]||this.store.addResource(i[0],c,d,y)}}}const YI=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let i={};if(typeof t[1]=="object"&&(i=t[1]),pr(t[1])&&(i.defaultValue=t[1]),pr(t[2])&&(i.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const c=t[3]||t[2];Object.keys(c).forEach(d=>{i[d]=c[d]})}return i},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),QI=t=>(pr(t.ns)&&(t.ns=[t.ns]),pr(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),pr(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),b1=()=>{},T6=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(c=>{typeof t[c]=="function"&&(t[c]=t[c].bind(t))})};class h0 extends Hw{constructor(i={},c){if(super(),this.options=QI(i),this.services={},this.logger=_f,this.modules={external:[]},T6(this),c&&!this.isInitialized&&!i.isClone){if(!this.options.initAsync)return this.init(i,c),this;setTimeout(()=>{this.init(i,c)},0)}}init(i={},c){this.isInitializing=!0,typeof i=="function"&&(c=i,i={}),i.defaultNS==null&&i.ns&&(pr(i.ns)?i.defaultNS=i.ns:i.ns.indexOf("translation")<0&&(i.defaultNS=i.ns[0]));const d=YI();this.options={...d,...this.options,...QI(i)},this.options.interpolation={...d.interpolation,...this.options.interpolation},i.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=i.keySeparator),i.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=i.nsSeparator);const y=z=>z?typeof z=="function"?new z:z:null;if(!this.options.isClone){this.modules.logger?_f.init(y(this.modules.logger),this.options):_f.init(null,this.options);let z;this.modules.formatter?z=this.modules.formatter:z=b6;const j=new qI(this.options);this.store=new GI(this.options.resources,this.options);const H=this.services;H.logger=_f,H.resourceStore=this.store,H.languageUtils=j,H.pluralResolver=new _6(j,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==d.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),z&&(!this.options.interpolation.format||this.options.interpolation.format===d.interpolation.format)&&(H.formatter=y(z),H.formatter.init&&H.formatter.init(H,this.options),this.options.interpolation.format=H.formatter.format.bind(H.formatter)),H.interpolator=new y6(this.options),H.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},H.backendConnector=new S6(y(this.modules.backend),H.resourceStore,H,this.options),H.backendConnector.on("*",(ie,...oe)=>{this.emit(ie,...oe)}),this.modules.languageDetector&&(H.languageDetector=y(this.modules.languageDetector),H.languageDetector.init&&H.languageDetector.init(H,this.options.detection,this.options)),this.modules.i18nFormat&&(H.i18nFormat=y(this.modules.i18nFormat),H.i18nFormat.init&&H.i18nFormat.init(this)),this.translator=new pw(this.services,this.options),this.translator.on("*",(ie,...oe)=>{this.emit(ie,...oe)}),this.modules.external.forEach(ie=>{ie.init&&ie.init(this)})}if(this.format=this.options.interpolation.format,c||(c=b1),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const z=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);z.length>0&&z[0]!=="dev"&&(this.options.lng=z[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(z=>{this[z]=(...j)=>this.store[z](...j)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(z=>{this[z]=(...j)=>(this.store[z](...j),this)});const s=i0(),O=()=>{const z=(j,H)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),s.resolve(H),c(j,H)};if(this.languages&&!this.isInitialized)return z(null,this.t.bind(this));this.changeLanguage(this.options.lng,z)};return this.options.resources||!this.options.initAsync?O():setTimeout(O,0),s}loadResources(i,c=b1){let d=c;const y=pr(i)?i:this.language;if(typeof i=="function"&&(d=i),!this.options.resources||this.options.partialBundledLanguages){if(y?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return d();const w=[],E=s=>{if(!s||s==="cimode")return;this.services.languageUtils.toResolveHierarchy(s).forEach(z=>{z!=="cimode"&&w.indexOf(z)<0&&w.push(z)})};y?E(y):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(O=>E(O)),this.options.preload?.forEach?.(s=>E(s)),this.services.backendConnector.load(w,this.options.ns,s=>{!s&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),d(s)})}else d(null)}reloadResources(i,c,d){const y=i0();return typeof i=="function"&&(d=i,i=void 0),typeof c=="function"&&(d=c,c=void 0),i||(i=this.languages),c||(c=this.options.ns),d||(d=b1),this.services.backendConnector.reload(i,c,w=>{y.resolve(),d(w)}),y}use(i){if(!i)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!i.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return i.type==="backend"&&(this.modules.backend=i),(i.type==="logger"||i.log&&i.warn&&i.error)&&(this.modules.logger=i),i.type==="languageDetector"&&(this.modules.languageDetector=i),i.type==="i18nFormat"&&(this.modules.i18nFormat=i),i.type==="postProcessor"&&Qz.addPostProcessor(i),i.type==="formatter"&&(this.modules.formatter=i),i.type==="3rdParty"&&this.modules.external.push(i),this}setResolvedLanguage(i){if(!(!i||!this.languages)&&!(["cimode","dev"].indexOf(i)>-1)){for(let c=0;c<this.languages.length;c++){const d=this.languages[c];if(!(["cimode","dev"].indexOf(d)>-1)&&this.store.hasLanguageSomeTranslations(d)){this.resolvedLanguage=d;break}}!this.resolvedLanguage&&this.languages.indexOf(i)<0&&this.store.hasLanguageSomeTranslations(i)&&(this.resolvedLanguage=i,this.languages.unshift(i))}}changeLanguage(i,c){this.isLanguageChangingTo=i;const d=i0();this.emit("languageChanging",i);const y=s=>{this.language=s,this.languages=this.services.languageUtils.toResolveHierarchy(s),this.resolvedLanguage=void 0,this.setResolvedLanguage(s)},w=(s,O)=>{O?this.isLanguageChangingTo===i&&(y(O),this.translator.changeLanguage(O),this.isLanguageChangingTo=void 0,this.emit("languageChanged",O),this.logger.log("languageChanged",O)):this.isLanguageChangingTo=void 0,d.resolve((...z)=>this.t(...z)),c&&c(s,(...z)=>this.t(...z))},E=s=>{!i&&!s&&this.services.languageDetector&&(s=[]);const O=pr(s)?s:s&&s[0],z=this.store.hasLanguageSomeTranslations(O)?O:this.services.languageUtils.getBestMatchFromCodes(pr(s)?[s]:s);z&&(this.language||y(z),this.translator.language||this.translator.changeLanguage(z),this.services.languageDetector?.cacheUserLanguage?.(z)),this.loadResources(z,j=>{w(j,z)})};return!i&&this.services.languageDetector&&!this.services.languageDetector.async?E(this.services.languageDetector.detect()):!i&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(E):this.services.languageDetector.detect(E):E(i),d}getFixedT(i,c,d){const y=(w,E,...s)=>{let O;typeof E!="object"?O=this.options.overloadTranslationOptionHandler([w,E].concat(s)):O={...E},O.lng=O.lng||y.lng,O.lngs=O.lngs||y.lngs,O.ns=O.ns||y.ns,O.keyPrefix!==""&&(O.keyPrefix=O.keyPrefix||d||y.keyPrefix);const z=this.options.keySeparator||".";let j;return O.keyPrefix&&Array.isArray(w)?j=w.map(H=>(typeof H=="function"&&(H=F2(H,{...this.options,...E})),`${O.keyPrefix}${z}${H}`)):(typeof w=="function"&&(w=F2(w,{...this.options,...E})),j=O.keyPrefix?`${O.keyPrefix}${z}${w}`:w),this.t(j,O)};return pr(i)?y.lng=i:y.lngs=i,y.ns=c,y.keyPrefix=d,y}t(...i){return this.translator?.translate(...i)}exists(...i){return this.translator?.exists(...i)}setDefaultNamespace(i){this.options.defaultNS=i}hasLoadedNamespace(i,c={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const d=c.lng||this.resolvedLanguage||this.languages[0],y=this.options?this.options.fallbackLng:!1,w=this.languages[this.languages.length-1];if(d.toLowerCase()==="cimode")return!0;const E=(s,O)=>{const z=this.services.backendConnector.state[`${s}|${O}`];return z===-1||z===0||z===2};if(c.precheck){const s=c.precheck(this,E);if(s!==void 0)return s}return!!(this.hasResourceBundle(d,i)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||E(d,i)&&(!y||E(w,i)))}loadNamespaces(i,c){const d=i0();return this.options.ns?(pr(i)&&(i=[i]),i.forEach(y=>{this.options.ns.indexOf(y)<0&&this.options.ns.push(y)}),this.loadResources(y=>{d.resolve(),c&&c(y)}),d):(c&&c(),Promise.resolve())}loadLanguages(i,c){const d=i0();pr(i)&&(i=[i]);const y=this.options.preload||[],w=i.filter(E=>y.indexOf(E)<0&&this.services.languageUtils.isSupportedCode(E));return w.length?(this.options.preload=y.concat(w),this.loadResources(E=>{d.resolve(),c&&c(E)}),d):(c&&c(),Promise.resolve())}dir(i){if(i||(i=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!i)return"rtl";try{const y=new Intl.Locale(i);if(y&&y.getTextInfo){const w=y.getTextInfo();if(w&&w.direction)return w.direction}}catch{}const c=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],d=this.services?.languageUtils||new qI(YI());return i.toLowerCase().indexOf("-latn")>1?"ltr":c.indexOf(d.getLanguagePartFromCode(i))>-1||i.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(i={},c){const d=new h0(i,c);return d.createInstance=h0.createInstance,d}cloneInstance(i={},c=b1){const d=i.forkResourceStore;d&&delete i.forkResourceStore;const y={...this.options,...i,isClone:!0},w=new h0(y);if((i.debug!==void 0||i.prefix!==void 0)&&(w.logger=w.logger.clone(i)),["store","services","language"].forEach(s=>{w[s]=this[s]}),w.services={...this.services},w.services.utils={hasLoadedNamespace:w.hasLoadedNamespace.bind(w)},d){const s=Object.keys(this.store.data).reduce((O,z)=>(O[z]={...this.store.data[z]},O[z]=Object.keys(O[z]).reduce((j,H)=>(j[H]={...O[z][H]},j),O[z]),O),{});w.store=new GI(s,y),w.services.resourceStore=w.store}return w.translator=new pw(w.services,y),w.translator.on("*",(s,...O)=>{w.emit(s,...O)}),w.init(y,c),w.translator.options=y,w.translator.backendConnector.services.utils={hasLoadedNamespace:w.hasLoadedNamespace.bind(w)},w}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const tc=h0.createInstance();tc.createInstance;tc.dir;tc.init;tc.loadResources;tc.reloadResources;tc.use;tc.changeLanguage;tc.getFixedT;tc.t;tc.exists;tc.setDefaultNamespace;tc.hasLoadedNamespace;tc.loadNamespaces;tc.loadLanguages;const E6=(t,i,c,d)=>{const y=[c,{code:i,...d||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(y,"warn","react-i18next::",!0);B_(y[0])&&(y[0]=`react-i18next:: ${y[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...y):console?.warn&&console.warn(...y)},JI={},eL=(t,i,c,d)=>{B_(c)&&JI[c]||(B_(c)&&(JI[c]=new Date),E6(t,i,c,d))},tL=(t,i)=>()=>{if(t.isInitialized)i();else{const c=()=>{setTimeout(()=>{t.off("initialized",c)},0),i()};t.on("initialized",c)}},B2=(t,i,c)=>{t.loadNamespaces(i,tL(t,c))},eD=(t,i,c,d)=>{if(B_(c)&&(c=[c]),t.options.preload&&t.options.preload.indexOf(i)>-1)return B2(t,c,d);c.forEach(y=>{t.options.ns.indexOf(y)<0&&t.options.ns.push(y)}),t.loadLanguages(i,tL(t,d))},A6=(t,i,c={})=>!i.languages||!i.languages.length?(eL(i,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:i.languages}),!0):i.hasLoadedNamespace(t,{lng:c.lng,precheck:(d,y)=>{if(c.bindI18n&&c.bindI18n.indexOf("languageChanging")>-1&&d.services.backendConnector.backend&&d.isLanguageChangingTo&&!y(d.isLanguageChangingTo,t))return!1}}),B_=t=>typeof t=="string",C6=t=>typeof t=="object"&&t!==null,R6=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,M6={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},I6=t=>M6[t],D6=t=>t.replace(R6,I6);let V2={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:D6};const P6=(t={})=>{V2={...V2,...t}},O6=()=>V2;let nL;const z6=t=>{nL=t},L6=()=>nL,N6={type:"3rdParty",init(t){P6(t.options.react),z6(t)}},k6=Z.createContext();class j6{constructor(){this.usedNamespaces={}}addUsedNamespaces(i){i.forEach(c=>{this.usedNamespaces[c]||(this.usedNamespaces[c]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var UT={exports:{}},$T={};var tD;function F6(){if(tD)return $T;tD=1;var t=Uw();function i(H,Y){return H===Y&&(H!==0||1/H===1/Y)||H!==H&&Y!==Y}var c=typeof Object.is=="function"?Object.is:i,d=t.useState,y=t.useEffect,w=t.useLayoutEffect,E=t.useDebugValue;function s(H,Y){var ie=Y(),oe=d({inst:{value:ie,getSnapshot:Y}}),ee=oe[0].inst,le=oe[1];return w(function(){ee.value=ie,ee.getSnapshot=Y,O(ee)&&le({inst:ee})},[H,ie,Y]),y(function(){return O(ee)&&le({inst:ee}),H(function(){O(ee)&&le({inst:ee})})},[H]),E(ie),ie}function O(H){var Y=H.getSnapshot;H=H.value;try{var ie=Y();return!c(H,ie)}catch{return!0}}function z(H,Y){return Y()}var j=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?z:s;return $T.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:j,$T}var nD;function B6(){return nD||(nD=1,UT.exports=F6()),UT.exports}var V6=B6();const U6=(t,i)=>B_(i)?i:C6(i)&&B_(i.defaultValue)?i.defaultValue:Array.isArray(t)?t[t.length-1]:t,$6={t:U6,ready:!1},G6=()=>()=>{},Lc=(t,i={})=>{const{i18n:c}=i,{i18n:d,defaultNS:y}=Z.useContext(k6)||{},w=c||d||L6();w&&!w.reportNamespaces&&(w.reportNamespaces=new j6),w||eL(w,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const E=Z.useMemo(()=>({...O6(),...w?.options?.react,...i}),[w,i]),{useSuspense:s,keyPrefix:O}=E,z=y||w?.options?.defaultNS,j=B_(z)?[z]:z||["translation"],H=Z.useMemo(()=>j,j);w?.reportNamespaces?.addUsedNamespaces?.(H);const Y=Z.useRef(0),ie=Z.useCallback(st=>{if(!w)return G6;const{bindI18n:Et,bindI18nStore:Ut}=E,$t=()=>{Y.current+=1,st()};return Et&&w.on(Et,$t),Ut&&w.store.on(Ut,$t),()=>{Et&&Et.split(" ").forEach(tt=>w.off(tt,$t)),Ut&&Ut.split(" ").forEach(tt=>w.store.off(tt,$t))}},[w,E]),oe=Z.useRef(),ee=Z.useCallback(()=>{if(!w)return $6;const st=!!(w.isInitialized||w.initializedStoreOnce)&&H.every(on=>A6(on,w,E)),Et=i.lng||w.language,Ut=Y.current,$t=oe.current;if($t&&$t.ready===st&&$t.lng===Et&&$t.keyPrefix===O&&$t.revision===Ut)return $t;const ut={t:w.getFixedT(Et,E.nsMode==="fallback"?H:H[0],O),ready:st,lng:Et,keyPrefix:O,revision:Ut};return oe.current=ut,ut},[w,H,O,E,i.lng]),[le,ge]=Z.useState(0),{t:pe,ready:_e}=V6.useSyncExternalStore(ie,ee,ee);Z.useEffect(()=>{if(w&&!_e&&!s){const st=()=>ge(Et=>Et+1);i.lng?eD(w,i.lng,H,st):B2(w,H,st)}},[w,i.lng,H,_e,s,le]);const Re=w||{},xe=Z.useRef(null),Ze=Z.useRef(),Le=st=>{const Et=Object.getOwnPropertyDescriptors(st);Et.__original&&delete Et.__original;const Ut=Object.create(Object.getPrototypeOf(st),Et);if(!Object.prototype.hasOwnProperty.call(Ut,"__original"))try{Object.defineProperty(Ut,"__original",{value:st,writable:!1,enumerable:!1,configurable:!1})}catch{}return Ut},$e=Z.useMemo(()=>{const st=Re,Et=st?.language;let Ut=st;st&&(xe.current&&xe.current.__original===st?Ze.current!==Et?(Ut=Le(st),xe.current=Ut,Ze.current=Et):Ut=xe.current:(Ut=Le(st),xe.current=Ut,Ze.current=Et));const $t=[pe,Ut,_e];return $t.t=pe,$t.i18n=Ut,$t.ready=_e,$t},[pe,Re,_e,Re.resolvedLanguage,Re.language,Re.languages]);if(w&&s&&!_e)throw new Promise(st=>{const Et=()=>st();i.lng?eD(w,i.lng,H,Et):B2(w,H,Et)});return $e},H6={title:"Smart Bus Islamabad",subtitle:"Intelligent Public Transport System"},q6={dashboard:"Dashboard",buses:"Buses",routes:"Routes",stops:"Stops",displays:"Display Units",ads:"Advertisements",announcements:"Announcements",users:"Users",settings:"Settings",logout:"Logout"},Z6={login:"Login",email:"Email",password:"Password",forgotPassword:"Forgot Password?",welcomeBack:"Welcome back",loginSubtitle:"Sign in to access the Smart Bus system",loggingIn:"Logging in...",loginError:"Invalid credentials",logout:"Logout",logoutSuccess:"Logged out successfully"},W6={title:"Dashboard",overview:"Overview",totalBuses:"Total Buses",activeBuses:"Active Buses",totalRoutes:"Routes",totalStops:"Stops",onlineDisplays:"Online Displays",activeAnnouncements:"Active Announcements",liveMap:"Live Bus Locations",recentActivity:"Recent Activity"},X6={title:"Buses",addBus:"Add Bus",editBus:"Edit Bus",deleteBus:"Delete Bus",registrationNumber:"Registration Number",capacity:"Capacity",status:"Status",assignedRoute:"Assigned Route",lastSeen:"Last Seen",location:"Location",speed:"Speed",active:"Active",inactive:"Inactive",maintenance:"Maintenance",assignRoute:"Assign Route",unassign:"Unassign",viewDetails:"View Details",nextStops:"Next Stops",eta:"ETA",speedChart:"Speed Over Time",noRoute:"No route assigned"},K6={title:"Routes",addRoute:"Add Route",editRoute:"Edit Route",deleteRoute:"Delete Route",routeName:"Route Name",routeCode:"Route Code",description:"Description",color:"Color",stops:"Stops",addStops:"Add Stops",reorderStops:"Reorder Stops",sequence:"Sequence",distance:"Distance from Previous",viewRoute:"View Route",totalStops:"Total Stops",routeLength:"Route Length"},Y6={title:"Stops",addStop:"Add Stop",editStop:"Edit Stop",deleteStop:"Delete Stop",stopName:"Stop Name",description:"Description",latitude:"Latitude",longitude:"Longitude",searchPlaceholder:"Search stops or places...",clickToPlace:"Click on map to place stop",dragToAdjust:"Drag marker to adjust position",nearbyStops:"Nearby Stops",searchByProximity:"Search by proximity",radius:"Radius (meters)"},Q6={title:"Display Units",addDisplay:"Add Display",editDisplay:"Edit Display",deleteDisplay:"Delete Display",displayName:"Display Name",assignedStop:"Assigned Stop",status:"Status",online:"Online",offline:"Offline",location:"Location",currentContent:"Current Content",simulator:"Open Simulator",viewSimulation:"View Simulation"},J6={title:"Advertisements",addAd:"Add Advertisement",editAd:"Edit Advertisement",deleteAd:"Delete Advertisement",adTitle:"Title",contentUrl:"Content URL",mediaType:"Media Type",duration:"Duration (seconds)",image:"Image",video:"Video",schedule:"Schedule",addSchedule:"Add Schedule",startTime:"Start Time",endTime:"End Time",priority:"Priority",targetDisplays:"Target Displays",preview:"Preview",upload:"Upload"},e8={title:"Announcements",addAnnouncement:"Add Announcement",editAnnouncement:"Edit Announcement",deleteAnnouncement:"Delete Announcement",message:"Message",messageUrdu:"Message (Urdu)",severity:"Severity",info:"Info",warning:"Warning",emergency:"Emergency",startTime:"Start Time",endTime:"End Time",target:"Target",all:"All Displays",route:"Specific Routes",display:"Specific Displays",emergencyOverride:"Emergency Override",overrideNow:"Override Now",clearOverride:"Clear Override",active:"Active",scheduled:"Scheduled",expired:"Expired"},t8={title:"Users",addUser:"Add User",editUser:"Edit User",deleteUser:"Delete User",name:"Name",email:"Email",role:"Role",admin:"Admin",staff:"Staff",createdAt:"Created At",auditLogs:"Audit Logs",action:"Action",entity:"Entity",timestamp:"Timestamp"},n8={title:"Settings",general:"General",apiEndpoint:"API Endpoint",mapboxKey:"Mapbox API Key",language:"Language",english:"English",urdu:"",theme:"Theme",light:"Light",dark:"Dark",save:"Save Settings",saved:"Settings saved successfully"},i8={simulator:"SMD Simulator",nextBus:"Next Bus",arriving:"Arriving",minutes:"min",onTime:"On Time",delayed:"Delayed",noData:"No data available",controls:"Controls",online:"Online",offline:"Offline",toggleStatus:"Toggle Status",forceEmergency:"Force Emergency",fastForward:"Fast Forward",languageToggle:"Language Toggle",fullscreen:"Fullscreen",exitFullscreen:"Exit Fullscreen",connectivity:"Connectivity",lastUpdate:"Last Update"},r8={save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",search:"Search",filter:"Filter",loading:"Loading...",noData:"No data available",error:"An error occurred",success:"Success",confirm:"Confirm",confirmDelete:"Are you sure you want to delete this item?",yes:"Yes",no:"No",close:"Close",back:"Back",next:"Next",previous:"Previous",actions:"Actions",viewDetails:"View Details",createdAt:"Created At",updatedAt:"Updated At"},s8={app:H6,nav:q6,auth:Z6,dashboard:W6,buses:X6,routes:K6,stops:Y6,displays:Q6,ads:J6,announcements:e8,users:t8,settings:n8,smd:i8,common:r8},o8={title:"   ",subtitle:"      "},a8={dashboard:" ",buses:"",routes:"",stops:"",displays:" ",ads:"",announcements:"",users:"",settings:"",logout:" "},l8={login:" ",email:" ",password:" ",forgotPassword:"   ",welcomeBack:" ",loginSubtitle:"         ",loggingIn:"    ...",loginError:" ",logout:" ",logoutSuccess:"     "},c8={title:" ",overview:"",totalBuses:" ",activeBuses:" ",totalRoutes:"",totalStops:"",onlineDisplays:"  ",activeAnnouncements:" ",liveMap:"  ",recentActivity:" "},u8={title:"",addBus:"  ",editBus:"   ",deleteBus:"  ",registrationNumber:" ",capacity:"",status:"",assignedRoute:"  ",lastSeen:"   ",location:"",speed:"",active:"",inactive:" ",maintenance:" ",assignRoute:"  ",unassign:" ",viewDetails:" ",nextStops:" ",eta:"  ",speedChart:"   ",noRoute:"   "},d8={title:"",addRoute:"  ",editRoute:"   ",deleteRoute:"  ",routeName:"  ",routeCode:"  ",description:"",color:"",stops:"",addStops:"  ",reorderStops:"   ",sequence:"",distance:"  ",viewRoute:" ",totalStops:" ",routeLength:"  "},h8={title:"",addStop:"  ",editStop:"   ",deleteStop:"  ",stopName:"  ",description:"",latitude:" ",longitude:" ",searchPlaceholder:"    ...",clickToPlace:"       ",dragToAdjust:"      ",nearbyStops:" ",searchByProximity:"   ",radius:" ()"},f8={title:" ",addDisplay:"  ",editDisplay:"   ",deleteDisplay:"  ",displayName:"  ",assignedStop:"  ",status:"",online:" ",offline:" ",location:"",currentContent:" ",simulator:" ",viewSimulation:" "},p8={title:"",addAd:"  ",editAd:"   ",deleteAd:"  ",adTitle:"",contentUrl:"  URL",mediaType:"  ",duration:" ()",image:"",video:"",schedule:"",addSchedule:"  ",startTime:"  ",endTime:"  ",priority:"",targetDisplays:" ",preview:" ",upload:"  "},m8={title:"",addAnnouncement:"  ",editAnnouncement:"   ",deleteAnnouncement:"  ",message:"",messageUrdu:" ()",severity:"",info:"",warning:"",emergency:"",startTime:"  ",endTime:"  ",target:"",all:" ",route:" ",display:" ",emergencyOverride:"  ",overrideNow:"   ",clearOverride:"   ",active:"",scheduled:" ",expired:" "},g8={title:"",addUser:"  ",editUser:"   ",deleteUser:"  ",name:"",email:" ",role:"",admin:"",staff:"",createdAt:"  ",auditLogs:" ",action:"",entity:"",timestamp:" "},_8={title:"",general:"",apiEndpoint:"API  ",mapboxKey:"Mapbox API ",language:"",english:"English",urdu:"",theme:"",light:"",dark:"",save:"  ",saved:"     "},y8={simulator:"SMD ",nextBus:" ",arriving:"  ",minutes:"",onTime:" ",delayed:"",noData:"   ",controls:"",online:" ",offline:" ",toggleStatus:"  ",forceEmergency:"   ",fastForward:"  ",languageToggle:" ",fullscreen:" ",exitFullscreen:"    ",connectivity:"",lastUpdate:"  "},x8={save:" ",cancel:" ",delete:" ",edit:" ",add:" ",search:" ",filter:" ",loading:"   ...",noData:"   ",error:"   ",success:"",confirm:" ",confirmDelete:"         ",yes:"",no:"",close:" ",back:"",next:"",previous:"",actions:"",viewDetails:" ",createdAt:"  ",updatedAt:"   "},v8={app:o8,nav:a8,auth:l8,dashboard:c8,buses:u8,routes:d8,stops:h8,displays:f8,ads:p8,announcements:m8,users:g8,settings:_8,smd:y8,common:x8},b8={en:{translation:s8},ur:{translation:v8}};tc.use(N6).init({resources:b8,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});function iL(t,i){return function(){return t.apply(i,arguments)}}const{toString:w8}=Object.prototype,{getPrototypeOf:sA}=Object,{iterator:qw,toStringTag:rL}=Symbol,Zw=(t=>i=>{const c=w8.call(i);return t[c]||(t[c]=c.slice(8,-1).toLowerCase())})(Object.create(null)),gh=t=>(t=t.toLowerCase(),i=>Zw(i)===t),Ww=t=>i=>typeof i===t,{isArray:zx}=Array,wx=Ww("undefined");function q0(t){return t!==null&&!wx(t)&&t.constructor!==null&&!wx(t.constructor)&&Oc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const sL=gh("ArrayBuffer");function S8(t){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(t):i=t&&t.buffer&&sL(t.buffer),i}const T8=Ww("string"),Oc=Ww("function"),oL=Ww("number"),Z0=t=>t!==null&&typeof t=="object",E8=t=>t===!0||t===!1,Z1=t=>{if(Zw(t)!=="object")return!1;const i=sA(t);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(rL in t)&&!(qw in t)},A8=t=>{if(!Z0(t)||q0(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},C8=gh("Date"),R8=gh("File"),M8=gh("Blob"),I8=gh("FileList"),D8=t=>Z0(t)&&Oc(t.pipe),P8=t=>{let i;return t&&(typeof FormData=="function"&&t instanceof FormData||Oc(t.append)&&((i=Zw(t))==="formdata"||i==="object"&&Oc(t.toString)&&t.toString()==="[object FormData]"))},O8=gh("URLSearchParams"),[z8,L8,N8,k8]=["ReadableStream","Request","Response","Headers"].map(gh),j8=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function W0(t,i,{allOwnKeys:c=!1}={}){if(t===null||typeof t>"u")return;let d,y;if(typeof t!="object"&&(t=[t]),zx(t))for(d=0,y=t.length;d<y;d++)i.call(null,t[d],d,t);else{if(q0(t))return;const w=c?Object.getOwnPropertyNames(t):Object.keys(t),E=w.length;let s;for(d=0;d<E;d++)s=w[d],i.call(null,t[s],s,t)}}function aL(t,i){if(q0(t))return null;i=i.toLowerCase();const c=Object.keys(t);let d=c.length,y;for(;d-- >0;)if(y=c[d],i===y.toLowerCase())return y;return null}const A_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,lL=t=>!wx(t)&&t!==A_;function U2(){const{caseless:t,skipUndefined:i}=lL(this)&&this||{},c={},d=(y,w)=>{const E=t&&aL(c,w)||w;Z1(c[E])&&Z1(y)?c[E]=U2(c[E],y):Z1(y)?c[E]=U2({},y):zx(y)?c[E]=y.slice():(!i||!wx(y))&&(c[E]=y)};for(let y=0,w=arguments.length;y<w;y++)arguments[y]&&W0(arguments[y],d);return c}const F8=(t,i,c,{allOwnKeys:d}={})=>(W0(i,(y,w)=>{c&&Oc(y)?t[w]=iL(y,c):t[w]=y},{allOwnKeys:d}),t),B8=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),V8=(t,i,c,d)=>{t.prototype=Object.create(i.prototype,d),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:i.prototype}),c&&Object.assign(t.prototype,c)},U8=(t,i,c,d)=>{let y,w,E;const s={};if(i=i||{},t==null)return i;do{for(y=Object.getOwnPropertyNames(t),w=y.length;w-- >0;)E=y[w],(!d||d(E,t,i))&&!s[E]&&(i[E]=t[E],s[E]=!0);t=c!==!1&&sA(t)}while(t&&(!c||c(t,i))&&t!==Object.prototype);return i},$8=(t,i,c)=>{t=String(t),(c===void 0||c>t.length)&&(c=t.length),c-=i.length;const d=t.indexOf(i,c);return d!==-1&&d===c},G8=t=>{if(!t)return null;if(zx(t))return t;let i=t.length;if(!oL(i))return null;const c=new Array(i);for(;i-- >0;)c[i]=t[i];return c},H8=(t=>i=>t&&i instanceof t)(typeof Uint8Array<"u"&&sA(Uint8Array)),q8=(t,i)=>{const d=(t&&t[qw]).call(t);let y;for(;(y=d.next())&&!y.done;){const w=y.value;i.call(t,w[0],w[1])}},Z8=(t,i)=>{let c;const d=[];for(;(c=t.exec(i))!==null;)d.push(c);return d},W8=gh("HTMLFormElement"),X8=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(c,d,y){return d.toUpperCase()+y}),iD=(({hasOwnProperty:t})=>(i,c)=>t.call(i,c))(Object.prototype),K8=gh("RegExp"),cL=(t,i)=>{const c=Object.getOwnPropertyDescriptors(t),d={};W0(c,(y,w)=>{let E;(E=i(y,w,t))!==!1&&(d[w]=E||y)}),Object.defineProperties(t,d)},Y8=t=>{cL(t,(i,c)=>{if(Oc(t)&&["arguments","caller","callee"].indexOf(c)!==-1)return!1;const d=t[c];if(Oc(d)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+c+"'")})}})},Q8=(t,i)=>{const c={},d=y=>{y.forEach(w=>{c[w]=!0})};return zx(t)?d(t):d(String(t).split(i)),c},J8=()=>{},e$=(t,i)=>t!=null&&Number.isFinite(t=+t)?t:i;function t$(t){return!!(t&&Oc(t.append)&&t[rL]==="FormData"&&t[qw])}const n$=t=>{const i=new Array(10),c=(d,y)=>{if(Z0(d)){if(i.indexOf(d)>=0)return;if(q0(d))return d;if(!("toJSON"in d)){i[y]=d;const w=zx(d)?[]:{};return W0(d,(E,s)=>{const O=c(E,y+1);!wx(O)&&(w[s]=O)}),i[y]=void 0,w}}return d};return c(t,0)},i$=gh("AsyncFunction"),r$=t=>t&&(Z0(t)||Oc(t))&&Oc(t.then)&&Oc(t.catch),uL=((t,i)=>t?setImmediate:i?((c,d)=>(A_.addEventListener("message",({source:y,data:w})=>{y===A_&&w===c&&d.length&&d.shift()()},!1),y=>{d.push(y),A_.postMessage(c,"*")}))(`axios@${Math.random()}`,[]):c=>setTimeout(c))(typeof setImmediate=="function",Oc(A_.postMessage)),s$=typeof queueMicrotask<"u"?queueMicrotask.bind(A_):typeof process<"u"&&process.nextTick||uL,o$=t=>t!=null&&Oc(t[qw]),sn={isArray:zx,isArrayBuffer:sL,isBuffer:q0,isFormData:P8,isArrayBufferView:S8,isString:T8,isNumber:oL,isBoolean:E8,isObject:Z0,isPlainObject:Z1,isEmptyObject:A8,isReadableStream:z8,isRequest:L8,isResponse:N8,isHeaders:k8,isUndefined:wx,isDate:C8,isFile:R8,isBlob:M8,isRegExp:K8,isFunction:Oc,isStream:D8,isURLSearchParams:O8,isTypedArray:H8,isFileList:I8,forEach:W0,merge:U2,extend:F8,trim:j8,stripBOM:B8,inherits:V8,toFlatObject:U8,kindOf:Zw,kindOfTest:gh,endsWith:$8,toArray:G8,forEachEntry:q8,matchAll:Z8,isHTMLForm:W8,hasOwnProperty:iD,hasOwnProp:iD,reduceDescriptors:cL,freezeMethods:Y8,toObjectSet:Q8,toCamelCase:X8,noop:J8,toFiniteNumber:e$,findKey:aL,global:A_,isContextDefined:lL,isSpecCompliantForm:t$,toJSONObject:n$,isAsyncFn:i$,isThenable:r$,setImmediate:uL,asap:s$,isIterable:o$};function Cr(t,i,c,d,y){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",i&&(this.code=i),c&&(this.config=c),d&&(this.request=d),y&&(this.response=y,this.status=y.status?y.status:null)}sn.inherits(Cr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:sn.toJSONObject(this.config),code:this.code,status:this.status}}});const dL=Cr.prototype,hL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{hL[t]={value:t}});Object.defineProperties(Cr,hL);Object.defineProperty(dL,"isAxiosError",{value:!0});Cr.from=(t,i,c,d,y,w)=>{const E=Object.create(dL);sn.toFlatObject(t,E,function(j){return j!==Error.prototype},z=>z!=="isAxiosError");const s=t&&t.message?t.message:"Error",O=i==null&&t?t.code:i;return Cr.call(E,s,O,c,d,y),t&&E.cause==null&&Object.defineProperty(E,"cause",{value:t,configurable:!0}),E.name=t&&t.name||"Error",w&&Object.assign(E,w),E};const a$=null;function $2(t){return sn.isPlainObject(t)||sn.isArray(t)}function fL(t){return sn.endsWith(t,"[]")?t.slice(0,-2):t}function rD(t,i,c){return t?t.concat(i).map(function(y,w){return y=fL(y),!c&&w?"["+y+"]":y}).join(c?".":""):i}function l$(t){return sn.isArray(t)&&!t.some($2)}const c$=sn.toFlatObject(sn,{},null,function(i){return/^is[A-Z]/.test(i)});function Xw(t,i,c){if(!sn.isObject(t))throw new TypeError("target must be an object");i=i||new FormData,c=sn.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ee,le){return!sn.isUndefined(le[ee])});const d=c.metaTokens,y=c.visitor||j,w=c.dots,E=c.indexes,O=(c.Blob||typeof Blob<"u"&&Blob)&&sn.isSpecCompliantForm(i);if(!sn.isFunction(y))throw new TypeError("visitor must be a function");function z(oe){if(oe===null)return"";if(sn.isDate(oe))return oe.toISOString();if(sn.isBoolean(oe))return oe.toString();if(!O&&sn.isBlob(oe))throw new Cr("Blob is not supported. Use a Buffer instead.");return sn.isArrayBuffer(oe)||sn.isTypedArray(oe)?O&&typeof Blob=="function"?new Blob([oe]):Buffer.from(oe):oe}function j(oe,ee,le){let ge=oe;if(oe&&!le&&typeof oe=="object"){if(sn.endsWith(ee,"{}"))ee=d?ee:ee.slice(0,-2),oe=JSON.stringify(oe);else if(sn.isArray(oe)&&l$(oe)||(sn.isFileList(oe)||sn.endsWith(ee,"[]"))&&(ge=sn.toArray(oe)))return ee=fL(ee),ge.forEach(function(_e,Re){!(sn.isUndefined(_e)||_e===null)&&i.append(E===!0?rD([ee],Re,w):E===null?ee:ee+"[]",z(_e))}),!1}return $2(oe)?!0:(i.append(rD(le,ee,w),z(oe)),!1)}const H=[],Y=Object.assign(c$,{defaultVisitor:j,convertValue:z,isVisitable:$2});function ie(oe,ee){if(!sn.isUndefined(oe)){if(H.indexOf(oe)!==-1)throw Error("Circular reference detected in "+ee.join("."));H.push(oe),sn.forEach(oe,function(ge,pe){(!(sn.isUndefined(ge)||ge===null)&&y.call(i,ge,sn.isString(pe)?pe.trim():pe,ee,Y))===!0&&ie(ge,ee?ee.concat(pe):[pe])}),H.pop()}}if(!sn.isObject(t))throw new TypeError("data must be an object");return ie(t),i}function sD(t){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(d){return i[d]})}function oA(t,i){this._pairs=[],t&&Xw(t,this,i)}const pL=oA.prototype;pL.append=function(i,c){this._pairs.push([i,c])};pL.toString=function(i){const c=i?function(d){return i.call(this,d,sD)}:sD;return this._pairs.map(function(y){return c(y[0])+"="+c(y[1])},"").join("&")};function u$(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function mL(t,i,c){if(!i)return t;const d=c&&c.encode||u$;sn.isFunction(c)&&(c={serialize:c});const y=c&&c.serialize;let w;if(y?w=y(i,c):w=sn.isURLSearchParams(i)?i.toString():new oA(i,c).toString(d),w){const E=t.indexOf("#");E!==-1&&(t=t.slice(0,E)),t+=(t.indexOf("?")===-1?"?":"&")+w}return t}class oD{constructor(){this.handlers=[]}use(i,c,d){return this.handlers.push({fulfilled:i,rejected:c,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){sn.forEach(this.handlers,function(d){d!==null&&i(d)})}}const gL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},d$=typeof URLSearchParams<"u"?URLSearchParams:oA,h$=typeof FormData<"u"?FormData:null,f$=typeof Blob<"u"?Blob:null,p$={isBrowser:!0,classes:{URLSearchParams:d$,FormData:h$,Blob:f$},protocols:["http","https","file","blob","url","data"]},aA=typeof window<"u"&&typeof document<"u",G2=typeof navigator=="object"&&navigator||void 0,m$=aA&&(!G2||["ReactNative","NativeScript","NS"].indexOf(G2.product)<0),g$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",_$=aA&&window.location.href||"http://localhost",y$=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:aA,hasStandardBrowserEnv:m$,hasStandardBrowserWebWorkerEnv:g$,navigator:G2,origin:_$},Symbol.toStringTag,{value:"Module"})),Il={...y$,...p$};function x$(t,i){return Xw(t,new Il.classes.URLSearchParams,{visitor:function(c,d,y,w){return Il.isNode&&sn.isBuffer(c)?(this.append(d,c.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)},...i})}function v$(t){return sn.matchAll(/\w+|\[(\w*)]/g,t).map(i=>i[0]==="[]"?"":i[1]||i[0])}function b$(t){const i={},c=Object.keys(t);let d;const y=c.length;let w;for(d=0;d<y;d++)w=c[d],i[w]=t[w];return i}function _L(t){function i(c,d,y,w){let E=c[w++];if(E==="__proto__")return!0;const s=Number.isFinite(+E),O=w>=c.length;return E=!E&&sn.isArray(y)?y.length:E,O?(sn.hasOwnProp(y,E)?y[E]=[y[E],d]:y[E]=d,!s):((!y[E]||!sn.isObject(y[E]))&&(y[E]=[]),i(c,d,y[E],w)&&sn.isArray(y[E])&&(y[E]=b$(y[E])),!s)}if(sn.isFormData(t)&&sn.isFunction(t.entries)){const c={};return sn.forEachEntry(t,(d,y)=>{i(v$(d),y,c,0)}),c}return null}function w$(t,i,c){if(sn.isString(t))try{return(i||JSON.parse)(t),sn.trim(t)}catch(d){if(d.name!=="SyntaxError")throw d}return(c||JSON.stringify)(t)}const X0={transitional:gL,adapter:["xhr","http","fetch"],transformRequest:[function(i,c){const d=c.getContentType()||"",y=d.indexOf("application/json")>-1,w=sn.isObject(i);if(w&&sn.isHTMLForm(i)&&(i=new FormData(i)),sn.isFormData(i))return y?JSON.stringify(_L(i)):i;if(sn.isArrayBuffer(i)||sn.isBuffer(i)||sn.isStream(i)||sn.isFile(i)||sn.isBlob(i)||sn.isReadableStream(i))return i;if(sn.isArrayBufferView(i))return i.buffer;if(sn.isURLSearchParams(i))return c.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let s;if(w){if(d.indexOf("application/x-www-form-urlencoded")>-1)return x$(i,this.formSerializer).toString();if((s=sn.isFileList(i))||d.indexOf("multipart/form-data")>-1){const O=this.env&&this.env.FormData;return Xw(s?{"files[]":i}:i,O&&new O,this.formSerializer)}}return w||y?(c.setContentType("application/json",!1),w$(i)):i}],transformResponse:[function(i){const c=this.transitional||X0.transitional,d=c&&c.forcedJSONParsing,y=this.responseType==="json";if(sn.isResponse(i)||sn.isReadableStream(i))return i;if(i&&sn.isString(i)&&(d&&!this.responseType||y)){const E=!(c&&c.silentJSONParsing)&&y;try{return JSON.parse(i,this.parseReviver)}catch(s){if(E)throw s.name==="SyntaxError"?Cr.from(s,Cr.ERR_BAD_RESPONSE,this,null,this.response):s}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Il.classes.FormData,Blob:Il.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};sn.forEach(["delete","get","head","post","put","patch"],t=>{X0.headers[t]={}});const S$=sn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),T$=t=>{const i={};let c,d,y;return t&&t.split(`
`).forEach(function(E){y=E.indexOf(":"),c=E.substring(0,y).trim().toLowerCase(),d=E.substring(y+1).trim(),!(!c||i[c]&&S$[c])&&(c==="set-cookie"?i[c]?i[c].push(d):i[c]=[d]:i[c]=i[c]?i[c]+", "+d:d)}),i},aD=Symbol("internals");function r0(t){return t&&String(t).trim().toLowerCase()}function W1(t){return t===!1||t==null?t:sn.isArray(t)?t.map(W1):String(t)}function E$(t){const i=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=c.exec(t);)i[d[1]]=d[2];return i}const A$=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function GT(t,i,c,d,y){if(sn.isFunction(d))return d.call(this,i,c);if(y&&(i=c),!!sn.isString(i)){if(sn.isString(d))return i.indexOf(d)!==-1;if(sn.isRegExp(d))return d.test(i)}}function C$(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,c,d)=>c.toUpperCase()+d)}function R$(t,i){const c=sn.toCamelCase(" "+i);["get","set","has"].forEach(d=>{Object.defineProperty(t,d+c,{value:function(y,w,E){return this[d].call(this,i,y,w,E)},configurable:!0})})}let zc=class{constructor(i){i&&this.set(i)}set(i,c,d){const y=this;function w(s,O,z){const j=r0(O);if(!j)throw new Error("header name must be a non-empty string");const H=sn.findKey(y,j);(!H||y[H]===void 0||z===!0||z===void 0&&y[H]!==!1)&&(y[H||O]=W1(s))}const E=(s,O)=>sn.forEach(s,(z,j)=>w(z,j,O));if(sn.isPlainObject(i)||i instanceof this.constructor)E(i,c);else if(sn.isString(i)&&(i=i.trim())&&!A$(i))E(T$(i),c);else if(sn.isObject(i)&&sn.isIterable(i)){let s={},O,z;for(const j of i){if(!sn.isArray(j))throw TypeError("Object iterator must return a key-value pair");s[z=j[0]]=(O=s[z])?sn.isArray(O)?[...O,j[1]]:[O,j[1]]:j[1]}E(s,c)}else i!=null&&w(c,i,d);return this}get(i,c){if(i=r0(i),i){const d=sn.findKey(this,i);if(d){const y=this[d];if(!c)return y;if(c===!0)return E$(y);if(sn.isFunction(c))return c.call(this,y,d);if(sn.isRegExp(c))return c.exec(y);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,c){if(i=r0(i),i){const d=sn.findKey(this,i);return!!(d&&this[d]!==void 0&&(!c||GT(this,this[d],d,c)))}return!1}delete(i,c){const d=this;let y=!1;function w(E){if(E=r0(E),E){const s=sn.findKey(d,E);s&&(!c||GT(d,d[s],s,c))&&(delete d[s],y=!0)}}return sn.isArray(i)?i.forEach(w):w(i),y}clear(i){const c=Object.keys(this);let d=c.length,y=!1;for(;d--;){const w=c[d];(!i||GT(this,this[w],w,i,!0))&&(delete this[w],y=!0)}return y}normalize(i){const c=this,d={};return sn.forEach(this,(y,w)=>{const E=sn.findKey(d,w);if(E){c[E]=W1(y),delete c[w];return}const s=i?C$(w):String(w).trim();s!==w&&delete c[w],c[s]=W1(y),d[s]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const c=Object.create(null);return sn.forEach(this,(d,y)=>{d!=null&&d!==!1&&(c[y]=i&&sn.isArray(d)?d.join(", "):d)}),c}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,c])=>i+": "+c).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...c){const d=new this(i);return c.forEach(y=>d.set(y)),d}static accessor(i){const d=(this[aD]=this[aD]={accessors:{}}).accessors,y=this.prototype;function w(E){const s=r0(E);d[s]||(R$(y,E),d[s]=!0)}return sn.isArray(i)?i.forEach(w):w(i),this}};zc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);sn.reduceDescriptors(zc.prototype,({value:t},i)=>{let c=i[0].toUpperCase()+i.slice(1);return{get:()=>t,set(d){this[c]=d}}});sn.freezeMethods(zc);function HT(t,i){const c=this||X0,d=i||c,y=zc.from(d.headers);let w=d.data;return sn.forEach(t,function(s){w=s.call(c,w,y.normalize(),i?i.status:void 0)}),y.normalize(),w}function yL(t){return!!(t&&t.__CANCEL__)}function Lx(t,i,c){Cr.call(this,t??"canceled",Cr.ERR_CANCELED,i,c),this.name="CanceledError"}sn.inherits(Lx,Cr,{__CANCEL__:!0});function xL(t,i,c){const d=c.config.validateStatus;!c.status||!d||d(c.status)?t(c):i(new Cr("Request failed with status code "+c.status,[Cr.ERR_BAD_REQUEST,Cr.ERR_BAD_RESPONSE][Math.floor(c.status/100)-4],c.config,c.request,c))}function M$(t){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return i&&i[1]||""}function I$(t,i){t=t||10;const c=new Array(t),d=new Array(t);let y=0,w=0,E;return i=i!==void 0?i:1e3,function(O){const z=Date.now(),j=d[w];E||(E=z),c[y]=O,d[y]=z;let H=w,Y=0;for(;H!==y;)Y+=c[H++],H=H%t;if(y=(y+1)%t,y===w&&(w=(w+1)%t),z-E<i)return;const ie=j&&z-j;return ie?Math.round(Y*1e3/ie):void 0}}function D$(t,i){let c=0,d=1e3/i,y,w;const E=(z,j=Date.now())=>{c=j,y=null,w&&(clearTimeout(w),w=null),t(...z)};return[(...z)=>{const j=Date.now(),H=j-c;H>=d?E(z,j):(y=z,w||(w=setTimeout(()=>{w=null,E(y)},d-H)))},()=>y&&E(y)]}const mw=(t,i,c=3)=>{let d=0;const y=I$(50,250);return D$(w=>{const E=w.loaded,s=w.lengthComputable?w.total:void 0,O=E-d,z=y(O),j=E<=s;d=E;const H={loaded:E,total:s,progress:s?E/s:void 0,bytes:O,rate:z||void 0,estimated:z&&s&&j?(s-E)/z:void 0,event:w,lengthComputable:s!=null,[i?"download":"upload"]:!0};t(H)},c)},lD=(t,i)=>{const c=t!=null;return[d=>i[0]({lengthComputable:c,total:t,loaded:d}),i[1]]},cD=t=>(...i)=>sn.asap(()=>t(...i)),P$=Il.hasStandardBrowserEnv?((t,i)=>c=>(c=new URL(c,Il.origin),t.protocol===c.protocol&&t.host===c.host&&(i||t.port===c.port)))(new URL(Il.origin),Il.navigator&&/(msie|trident)/i.test(Il.navigator.userAgent)):()=>!0,O$=Il.hasStandardBrowserEnv?{write(t,i,c,d,y,w,E){if(typeof document>"u")return;const s=[`${t}=${encodeURIComponent(i)}`];sn.isNumber(c)&&s.push(`expires=${new Date(c).toUTCString()}`),sn.isString(d)&&s.push(`path=${d}`),sn.isString(y)&&s.push(`domain=${y}`),w===!0&&s.push("secure"),sn.isString(E)&&s.push(`SameSite=${E}`),document.cookie=s.join("; ")},read(t){if(typeof document>"u")return null;const i=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return i?decodeURIComponent(i[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function z$(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function L$(t,i){return i?t.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):t}function vL(t,i,c){let d=!z$(i);return t&&(d||c==!1)?L$(t,i):i}const uD=t=>t instanceof zc?{...t}:t;function V_(t,i){i=i||{};const c={};function d(z,j,H,Y){return sn.isPlainObject(z)&&sn.isPlainObject(j)?sn.merge.call({caseless:Y},z,j):sn.isPlainObject(j)?sn.merge({},j):sn.isArray(j)?j.slice():j}function y(z,j,H,Y){if(sn.isUndefined(j)){if(!sn.isUndefined(z))return d(void 0,z,H,Y)}else return d(z,j,H,Y)}function w(z,j){if(!sn.isUndefined(j))return d(void 0,j)}function E(z,j){if(sn.isUndefined(j)){if(!sn.isUndefined(z))return d(void 0,z)}else return d(void 0,j)}function s(z,j,H){if(H in i)return d(z,j);if(H in t)return d(void 0,z)}const O={url:w,method:w,data:w,baseURL:E,transformRequest:E,transformResponse:E,paramsSerializer:E,timeout:E,timeoutMessage:E,withCredentials:E,withXSRFToken:E,adapter:E,responseType:E,xsrfCookieName:E,xsrfHeaderName:E,onUploadProgress:E,onDownloadProgress:E,decompress:E,maxContentLength:E,maxBodyLength:E,beforeRedirect:E,transport:E,httpAgent:E,httpsAgent:E,cancelToken:E,socketPath:E,responseEncoding:E,validateStatus:s,headers:(z,j,H)=>y(uD(z),uD(j),H,!0)};return sn.forEach(Object.keys({...t,...i}),function(j){const H=O[j]||y,Y=H(t[j],i[j],j);sn.isUndefined(Y)&&H!==s||(c[j]=Y)}),c}const bL=t=>{const i=V_({},t);let{data:c,withXSRFToken:d,xsrfHeaderName:y,xsrfCookieName:w,headers:E,auth:s}=i;if(i.headers=E=zc.from(E),i.url=mL(vL(i.baseURL,i.url,i.allowAbsoluteUrls),t.params,t.paramsSerializer),s&&E.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),sn.isFormData(c)){if(Il.hasStandardBrowserEnv||Il.hasStandardBrowserWebWorkerEnv)E.setContentType(void 0);else if(sn.isFunction(c.getHeaders)){const O=c.getHeaders(),z=["content-type","content-length"];Object.entries(O).forEach(([j,H])=>{z.includes(j.toLowerCase())&&E.set(j,H)})}}if(Il.hasStandardBrowserEnv&&(d&&sn.isFunction(d)&&(d=d(i)),d||d!==!1&&P$(i.url))){const O=y&&w&&O$.read(w);O&&E.set(y,O)}return i},N$=typeof XMLHttpRequest<"u",k$=N$&&function(t){return new Promise(function(c,d){const y=bL(t);let w=y.data;const E=zc.from(y.headers).normalize();let{responseType:s,onUploadProgress:O,onDownloadProgress:z}=y,j,H,Y,ie,oe;function ee(){ie&&ie(),oe&&oe(),y.cancelToken&&y.cancelToken.unsubscribe(j),y.signal&&y.signal.removeEventListener("abort",j)}let le=new XMLHttpRequest;le.open(y.method.toUpperCase(),y.url,!0),le.timeout=y.timeout;function ge(){if(!le)return;const _e=zc.from("getAllResponseHeaders"in le&&le.getAllResponseHeaders()),xe={data:!s||s==="text"||s==="json"?le.responseText:le.response,status:le.status,statusText:le.statusText,headers:_e,config:t,request:le};xL(function(Le){c(Le),ee()},function(Le){d(Le),ee()},xe),le=null}"onloadend"in le?le.onloadend=ge:le.onreadystatechange=function(){!le||le.readyState!==4||le.status===0&&!(le.responseURL&&le.responseURL.indexOf("file:")===0)||setTimeout(ge)},le.onabort=function(){le&&(d(new Cr("Request aborted",Cr.ECONNABORTED,t,le)),le=null)},le.onerror=function(Re){const xe=Re&&Re.message?Re.message:"Network Error",Ze=new Cr(xe,Cr.ERR_NETWORK,t,le);Ze.event=Re||null,d(Ze),le=null},le.ontimeout=function(){let Re=y.timeout?"timeout of "+y.timeout+"ms exceeded":"timeout exceeded";const xe=y.transitional||gL;y.timeoutErrorMessage&&(Re=y.timeoutErrorMessage),d(new Cr(Re,xe.clarifyTimeoutError?Cr.ETIMEDOUT:Cr.ECONNABORTED,t,le)),le=null},w===void 0&&E.setContentType(null),"setRequestHeader"in le&&sn.forEach(E.toJSON(),function(Re,xe){le.setRequestHeader(xe,Re)}),sn.isUndefined(y.withCredentials)||(le.withCredentials=!!y.withCredentials),s&&s!=="json"&&(le.responseType=y.responseType),z&&([Y,oe]=mw(z,!0),le.addEventListener("progress",Y)),O&&le.upload&&([H,ie]=mw(O),le.upload.addEventListener("progress",H),le.upload.addEventListener("loadend",ie)),(y.cancelToken||y.signal)&&(j=_e=>{le&&(d(!_e||_e.type?new Lx(null,t,le):_e),le.abort(),le=null)},y.cancelToken&&y.cancelToken.subscribe(j),y.signal&&(y.signal.aborted?j():y.signal.addEventListener("abort",j)));const pe=M$(y.url);if(pe&&Il.protocols.indexOf(pe)===-1){d(new Cr("Unsupported protocol "+pe+":",Cr.ERR_BAD_REQUEST,t));return}le.send(w||null)})},j$=(t,i)=>{const{length:c}=t=t?t.filter(Boolean):[];if(i||c){let d=new AbortController,y;const w=function(z){if(!y){y=!0,s();const j=z instanceof Error?z:this.reason;d.abort(j instanceof Cr?j:new Lx(j instanceof Error?j.message:j))}};let E=i&&setTimeout(()=>{E=null,w(new Cr(`timeout ${i} of ms exceeded`,Cr.ETIMEDOUT))},i);const s=()=>{t&&(E&&clearTimeout(E),E=null,t.forEach(z=>{z.unsubscribe?z.unsubscribe(w):z.removeEventListener("abort",w)}),t=null)};t.forEach(z=>z.addEventListener("abort",w));const{signal:O}=d;return O.unsubscribe=()=>sn.asap(s),O}},F$=function*(t,i){let c=t.byteLength;if(c<i){yield t;return}let d=0,y;for(;d<c;)y=d+i,yield t.slice(d,y),d=y},B$=async function*(t,i){for await(const c of V$(t))yield*F$(c,i)},V$=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const i=t.getReader();try{for(;;){const{done:c,value:d}=await i.read();if(c)break;yield d}}finally{await i.cancel()}},dD=(t,i,c,d)=>{const y=B$(t,i);let w=0,E,s=O=>{E||(E=!0,d&&d(O))};return new ReadableStream({async pull(O){try{const{done:z,value:j}=await y.next();if(z){s(),O.close();return}let H=j.byteLength;if(c){let Y=w+=H;c(Y)}O.enqueue(new Uint8Array(j))}catch(z){throw s(z),z}},cancel(O){return s(O),y.return()}},{highWaterMark:2})},hD=64*1024,{isFunction:w1}=sn,U$=(({Request:t,Response:i})=>({Request:t,Response:i}))(sn.global),{ReadableStream:fD,TextEncoder:pD}=sn.global,mD=(t,...i)=>{try{return!!t(...i)}catch{return!1}},$$=t=>{t=sn.merge.call({skipUndefined:!0},U$,t);const{fetch:i,Request:c,Response:d}=t,y=i?w1(i):typeof fetch=="function",w=w1(c),E=w1(d);if(!y)return!1;const s=y&&w1(fD),O=y&&(typeof pD=="function"?(oe=>ee=>oe.encode(ee))(new pD):async oe=>new Uint8Array(await new c(oe).arrayBuffer())),z=w&&s&&mD(()=>{let oe=!1;const ee=new c(Il.origin,{body:new fD,method:"POST",get duplex(){return oe=!0,"half"}}).headers.has("Content-Type");return oe&&!ee}),j=E&&s&&mD(()=>sn.isReadableStream(new d("").body)),H={stream:j&&(oe=>oe.body)};y&&["text","arrayBuffer","blob","formData","stream"].forEach(oe=>{!H[oe]&&(H[oe]=(ee,le)=>{let ge=ee&&ee[oe];if(ge)return ge.call(ee);throw new Cr(`Response type '${oe}' is not supported`,Cr.ERR_NOT_SUPPORT,le)})});const Y=async oe=>{if(oe==null)return 0;if(sn.isBlob(oe))return oe.size;if(sn.isSpecCompliantForm(oe))return(await new c(Il.origin,{method:"POST",body:oe}).arrayBuffer()).byteLength;if(sn.isArrayBufferView(oe)||sn.isArrayBuffer(oe))return oe.byteLength;if(sn.isURLSearchParams(oe)&&(oe=oe+""),sn.isString(oe))return(await O(oe)).byteLength},ie=async(oe,ee)=>{const le=sn.toFiniteNumber(oe.getContentLength());return le??Y(ee)};return async oe=>{let{url:ee,method:le,data:ge,signal:pe,cancelToken:_e,timeout:Re,onDownloadProgress:xe,onUploadProgress:Ze,responseType:Le,headers:$e,withCredentials:st="same-origin",fetchOptions:Et}=bL(oe),Ut=i||fetch;Le=Le?(Le+"").toLowerCase():"text";let $t=j$([pe,_e&&_e.toAbortSignal()],Re),tt=null;const ut=$t&&$t.unsubscribe&&(()=>{$t.unsubscribe()});let on;try{if(Ze&&z&&le!=="get"&&le!=="head"&&(on=await ie($e,ge))!==0){let Me=new c(ee,{method:"POST",body:ge,duplex:"half"}),ct;if(sn.isFormData(ge)&&(ct=Me.headers.get("content-type"))&&$e.setContentType(ct),Me.body){const[vt,Kt]=lD(on,mw(cD(Ze)));ge=dD(Me.body,hD,vt,Kt)}}sn.isString(st)||(st=st?"include":"omit");const Ke=w&&"credentials"in c.prototype,ze={...Et,signal:$t,method:le.toUpperCase(),headers:$e.normalize().toJSON(),body:ge,duplex:"half",credentials:Ke?st:void 0};tt=w&&new c(ee,ze);let Fe=await(w?Ut(tt,Et):Ut(ee,ze));const kt=j&&(Le==="stream"||Le==="response");if(j&&(xe||kt&&ut)){const Me={};["status","statusText","headers"].forEach(zn=>{Me[zn]=Fe[zn]});const ct=sn.toFiniteNumber(Fe.headers.get("content-length")),[vt,Kt]=xe&&lD(ct,mw(cD(xe),!0))||[];Fe=new d(dD(Fe.body,hD,vt,()=>{Kt&&Kt(),ut&&ut()}),Me)}Le=Le||"text";let fn=await H[sn.findKey(H,Le)||"text"](Fe,oe);return!kt&&ut&&ut(),await new Promise((Me,ct)=>{xL(Me,ct,{data:fn,headers:zc.from(Fe.headers),status:Fe.status,statusText:Fe.statusText,config:oe,request:tt})})}catch(Ke){throw ut&&ut(),Ke&&Ke.name==="TypeError"&&/Load failed|fetch/i.test(Ke.message)?Object.assign(new Cr("Network Error",Cr.ERR_NETWORK,oe,tt),{cause:Ke.cause||Ke}):Cr.from(Ke,Ke&&Ke.code,oe,tt)}}},G$=new Map,wL=t=>{let i=t&&t.env||{};const{fetch:c,Request:d,Response:y}=i,w=[d,y,c];let E=w.length,s=E,O,z,j=G$;for(;s--;)O=w[s],z=j.get(O),z===void 0&&j.set(O,z=s?new Map:$$(i)),j=z;return z};wL();const lA={http:a$,xhr:k$,fetch:{get:wL}};sn.forEach(lA,(t,i)=>{if(t){try{Object.defineProperty(t,"name",{value:i})}catch{}Object.defineProperty(t,"adapterName",{value:i})}});const gD=t=>`- ${t}`,H$=t=>sn.isFunction(t)||t===null||t===!1;function q$(t,i){t=sn.isArray(t)?t:[t];const{length:c}=t;let d,y;const w={};for(let E=0;E<c;E++){d=t[E];let s;if(y=d,!H$(d)&&(y=lA[(s=String(d)).toLowerCase()],y===void 0))throw new Cr(`Unknown adapter '${s}'`);if(y&&(sn.isFunction(y)||(y=y.get(i))))break;w[s||"#"+E]=y}if(!y){const E=Object.entries(w).map(([O,z])=>`adapter ${O} `+(z===!1?"is not supported by the environment":"is not available in the build"));let s=c?E.length>1?`since :
`+E.map(gD).join(`
`):" "+gD(E[0]):"as no adapter specified";throw new Cr("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return y}const SL={getAdapter:q$,adapters:lA};function qT(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Lx(null,t)}function _D(t){return qT(t),t.headers=zc.from(t.headers),t.data=HT.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),SL.getAdapter(t.adapter||X0.adapter,t)(t).then(function(d){return qT(t),d.data=HT.call(t,t.transformResponse,d),d.headers=zc.from(d.headers),d},function(d){return yL(d)||(qT(t),d&&d.response&&(d.response.data=HT.call(t,t.transformResponse,d.response),d.response.headers=zc.from(d.response.headers))),Promise.reject(d)})}const TL="1.13.2",Kw={};["object","boolean","number","function","string","symbol"].forEach((t,i)=>{Kw[t]=function(d){return typeof d===t||"a"+(i<1?"n ":" ")+t}});const yD={};Kw.transitional=function(i,c,d){function y(w,E){return"[Axios v"+TL+"] Transitional option '"+w+"'"+E+(d?". "+d:"")}return(w,E,s)=>{if(i===!1)throw new Cr(y(E," has been removed"+(c?" in "+c:"")),Cr.ERR_DEPRECATED);return c&&!yD[E]&&(yD[E]=!0,console.warn(y(E," has been deprecated since v"+c+" and will be removed in the near future"))),i?i(w,E,s):!0}};Kw.spelling=function(i){return(c,d)=>(console.warn(`${d} is likely a misspelling of ${i}`),!0)};function Z$(t,i,c){if(typeof t!="object")throw new Cr("options must be an object",Cr.ERR_BAD_OPTION_VALUE);const d=Object.keys(t);let y=d.length;for(;y-- >0;){const w=d[y],E=i[w];if(E){const s=t[w],O=s===void 0||E(s,w,t);if(O!==!0)throw new Cr("option "+w+" must be "+O,Cr.ERR_BAD_OPTION_VALUE);continue}if(c!==!0)throw new Cr("Unknown option "+w,Cr.ERR_BAD_OPTION)}}const X1={assertOptions:Z$,validators:Kw},pf=X1.validators;let O_=class{constructor(i){this.defaults=i||{},this.interceptors={request:new oD,response:new oD}}async request(i,c){try{return await this._request(i,c)}catch(d){if(d instanceof Error){let y={};Error.captureStackTrace?Error.captureStackTrace(y):y=new Error;const w=y.stack?y.stack.replace(/^.+\n/,""):"";try{d.stack?w&&!String(d.stack).endsWith(w.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+w):d.stack=w}catch{}}throw d}}_request(i,c){typeof i=="string"?(c=c||{},c.url=i):c=i||{},c=V_(this.defaults,c);const{transitional:d,paramsSerializer:y,headers:w}=c;d!==void 0&&X1.assertOptions(d,{silentJSONParsing:pf.transitional(pf.boolean),forcedJSONParsing:pf.transitional(pf.boolean),clarifyTimeoutError:pf.transitional(pf.boolean)},!1),y!=null&&(sn.isFunction(y)?c.paramsSerializer={serialize:y}:X1.assertOptions(y,{encode:pf.function,serialize:pf.function},!0)),c.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?c.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:c.allowAbsoluteUrls=!0),X1.assertOptions(c,{baseUrl:pf.spelling("baseURL"),withXsrfToken:pf.spelling("withXSRFToken")},!0),c.method=(c.method||this.defaults.method||"get").toLowerCase();let E=w&&sn.merge(w.common,w[c.method]);w&&sn.forEach(["delete","get","head","post","put","patch","common"],oe=>{delete w[oe]}),c.headers=zc.concat(E,w);const s=[];let O=!0;this.interceptors.request.forEach(function(ee){typeof ee.runWhen=="function"&&ee.runWhen(c)===!1||(O=O&&ee.synchronous,s.unshift(ee.fulfilled,ee.rejected))});const z=[];this.interceptors.response.forEach(function(ee){z.push(ee.fulfilled,ee.rejected)});let j,H=0,Y;if(!O){const oe=[_D.bind(this),void 0];for(oe.unshift(...s),oe.push(...z),Y=oe.length,j=Promise.resolve(c);H<Y;)j=j.then(oe[H++],oe[H++]);return j}Y=s.length;let ie=c;for(;H<Y;){const oe=s[H++],ee=s[H++];try{ie=oe(ie)}catch(le){ee.call(this,le);break}}try{j=_D.call(this,ie)}catch(oe){return Promise.reject(oe)}for(H=0,Y=z.length;H<Y;)j=j.then(z[H++],z[H++]);return j}getUri(i){i=V_(this.defaults,i);const c=vL(i.baseURL,i.url,i.allowAbsoluteUrls);return mL(c,i.params,i.paramsSerializer)}};sn.forEach(["delete","get","head","options"],function(i){O_.prototype[i]=function(c,d){return this.request(V_(d||{},{method:i,url:c,data:(d||{}).data}))}});sn.forEach(["post","put","patch"],function(i){function c(d){return function(w,E,s){return this.request(V_(s||{},{method:i,headers:d?{"Content-Type":"multipart/form-data"}:{},url:w,data:E}))}}O_.prototype[i]=c(),O_.prototype[i+"Form"]=c(!0)});let W$=class EL{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let c;this.promise=new Promise(function(w){c=w});const d=this;this.promise.then(y=>{if(!d._listeners)return;let w=d._listeners.length;for(;w-- >0;)d._listeners[w](y);d._listeners=null}),this.promise.then=y=>{let w;const E=new Promise(s=>{d.subscribe(s),w=s}).then(y);return E.cancel=function(){d.unsubscribe(w)},E},i(function(w,E,s){d.reason||(d.reason=new Lx(w,E,s),c(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const c=this._listeners.indexOf(i);c!==-1&&this._listeners.splice(c,1)}toAbortSignal(){const i=new AbortController,c=d=>{i.abort(d)};return this.subscribe(c),i.signal.unsubscribe=()=>this.unsubscribe(c),i.signal}static source(){let i;return{token:new EL(function(y){i=y}),cancel:i}}};function X$(t){return function(c){return t.apply(null,c)}}function K$(t){return sn.isObject(t)&&t.isAxiosError===!0}const H2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(H2).forEach(([t,i])=>{H2[i]=t});function AL(t){const i=new O_(t),c=iL(O_.prototype.request,i);return sn.extend(c,O_.prototype,i,{allOwnKeys:!0}),sn.extend(c,i,null,{allOwnKeys:!0}),c.create=function(y){return AL(V_(t,y))},c}const Jo=AL(X0);Jo.Axios=O_;Jo.CanceledError=Lx;Jo.CancelToken=W$;Jo.isCancel=yL;Jo.VERSION=TL;Jo.toFormData=Xw;Jo.AxiosError=Cr;Jo.Cancel=Jo.CanceledError;Jo.all=function(i){return Promise.all(i)};Jo.spread=X$;Jo.isAxiosError=K$;Jo.mergeConfig=V_;Jo.AxiosHeaders=zc;Jo.formToJSON=t=>_L(sn.isHTMLForm(t)?new FormData(t):t);Jo.getAdapter=SL.getAdapter;Jo.HttpStatusCode=H2;Jo.default=Jo;const{Axios:cae,AxiosError:uae,CanceledError:dae,isCancel:hae,CancelToken:fae,VERSION:pae,all:mae,Cancel:gae,isAxiosError:_ae,spread:yae,toFormData:xae,AxiosHeaders:vae,HttpStatusCode:bae,formToJSON:wae,getAdapter:Sae,mergeConfig:Tae}=Jo,Y$="http://localhost:8000/api";class Q${client;constructor(){this.client=Jo.create({baseURL:Y$,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(i=>{if(!(i.url||"").includes("/login")){const y=localStorage.getItem("auth_token");y&&(i.headers.Authorization=`Token ${y}`)}return i},i=>Promise.reject(i)),this.client.interceptors.response.use(i=>i,async i=>{const d=(i.config?.url||"").includes("/login"),y=localStorage.getItem("auth_token");return i.response?.status===401&&!d&&y&&(this.clearAuth(),window.location.href="/login"),Promise.reject(i)})}getToken(){return localStorage.getItem("auth_token")}setToken(i){localStorage.setItem("auth_token",i)}clearTokens(){localStorage.removeItem("auth_token"),localStorage.removeItem("user")}async get(i,c){return(await this.client.get(i,c)).data}async post(i,c,d){return(await this.client.post(i,c,d)).data}async patch(i,c,d){return(await this.client.patch(i,c,d)).data}async put(i,c,d){return(await this.client.put(i,c,d)).data}async delete(i,c){return(await this.client.delete(i,c)).data}setAuthToken(i){this.setToken(i)}clearAuth(){this.clearTokens()}isAuthenticated(){return!!this.getToken()}}const Ni=new Q$,S1={login:t=>Ni.post("/login/",t),getMe:()=>Ni.get("/me/"),logout:async()=>{Ni.clearAuth()}},xD={getUsers:()=>Ni.get("/users/"),registerUser:t=>Ni.post("/register/",t)},Sx={getStops:async t=>{const i=new URLSearchParams;t?.search&&i.append("search",t.search);const c=i.toString();return Ni.get(`/stops/${c?`?${c}`:""}`)},getStop:t=>Ni.get(`/stops/${t}/`),createStop:t=>Ni.post("/stops/",t),updateStop:(t,i)=>Ni.patch(`/stops/${t}/`,i),deleteStop:t=>Ni.delete(`/stops/${t}/`),getETAs:async(t,i)=>{const c=new URLSearchParams;i?.route_id&&c.append("route_id",i.route_id.toString());const d=c.toString();return Ni.get(`/stops/${t}/etas/${d?`?${d}`:""}`)}},Xu={getRoutes:async t=>{const i=new URLSearchParams;t?.search&&i.append("search",t.search);const c=i.toString();return Ni.get(`/routes/${c?`?${c}`:""}`)},getRoute:t=>Ni.get(`/routes/${t}/`),createRoute:t=>Ni.post("/routes/",t),updateRoute:(t,i)=>Ni.patch(`/routes/${t}/`,i),deleteRoute:t=>Ni.delete(`/routes/${t}/`),addStopToRoute:(t,i)=>Ni.post(`/routes/${t}/stops/`,i),removeStopFromRoute:(t,i)=>Ni.delete(`/routes/${t}/stops/${i}/`),reorderRouteStops:(t,i)=>Ni.put(`/routes/${t}/stops/reorder/`,{route_stop_ids:i}),getETAs:t=>Ni.get(`/routes/${t}/etas/`)},Ku={getBuses:async t=>{const i=new URLSearchParams;t?.status&&i.append("status",t.status),t?.route_id&&i.append("route_id",t.route_id.toString()),t?.search&&i.append("search",t.search);const c=i.toString(),d=await Ni.get(`/buses/${c?`?${c}`:""}`);return console.log("[DEBUG] getBuses response:",d),d},getBus:async t=>{const i=await Ni.get(`/buses/${t}/`);return console.log("[DEBUG] getBus response:",i),i},createBus:t=>Ni.post("/buses/",t),updateBus:(t,i)=>Ni.patch(`/buses/${t}/`,i),deleteBus:t=>Ni.delete(`/buses/${t}/`),updateLocation:(t,i)=>Ni.post(`/buses/${t}/location/`,i),startTrip:(t,i)=>Ni.post(`/buses/${t}/start-trip/`,i||{}),endTrip:(t,i)=>Ni.post(`/buses/${t}/end-trip/`,i||{}),getActiveBuses:()=>Ni.get("/buses/active/")},ax={getDisplays:async t=>{const i=new URLSearchParams;t?.search&&i.append("search",t.search),t?.status&&i.append("status",t.status),t?.stop_id&&i.append("stop_id",t.stop_id.toString());const c=i.toString();return Ni.get(`/displays/${c?`?${c}`:""}`)},getDisplay:t=>Ni.get(`/displays/${t}/`),createDisplay:t=>Ni.post("/displays/",t),updateDisplay:(t,i)=>Ni.patch(`/displays/${t}/`,i),deleteDisplay:t=>Ni.delete(`/displays/${t}/`),sendHeartbeat:(t,i)=>Ni.post(`/displays/${t}/heartbeat/`,{status:i}),getDisplayContent:t=>Ni.get(`/displays/${t}/content/`)},Km={getAds:async t=>{const i=new URLSearchParams;t?.search&&i.append("search",t.search),t?.media_type&&i.append("media_type",t.media_type);const c=i.toString();return Ni.get(`/advertisements/${c?`?${c}`:""}`)},getAd:t=>Ni.get(`/advertisements/${t}/`),createAd:t=>Ni.post("/advertisements/",t),updateAd:(t,i)=>Ni.patch(`/advertisements/${t}/`,i),deleteAd:t=>Ni.delete(`/advertisements/${t}/`),getSchedules:async t=>{const i=new URLSearchParams;t?.ad_id&&i.append("ad_id",t.ad_id.toString()),t?.display_id&&i.append("display_id",t.display_id.toString()),t?.active!==void 0&&i.append("active",t.active.toString());const c=i.toString();return Ni.get(`/ad-schedules/${c?`?${c}`:""}`)},getSchedule:t=>Ni.get(`/ad-schedules/${t}/`),createSchedule:t=>Ni.post("/ad-schedules/",t),updateSchedule:(t,i)=>Ni.patch(`/ad-schedules/${t}/`,i),deleteSchedule:t=>Ni.delete(`/ad-schedules/${t}/`)},T1={getAnnouncements:async t=>{const i=new URLSearchParams;t?.search&&i.append("search",t.search),t?.severity&&i.append("severity",t.severity),t?.active!==void 0&&i.append("active",t.active.toString()),t?.route_id&&i.append("route_id",t.route_id.toString());const c=i.toString();return Ni.get(`/announcements/${c?`?${c}`:""}`)},getAnnouncement:t=>Ni.get(`/announcements/${t}/`),createAnnouncement:t=>Ni.post("/announcements/",t),updateAnnouncement:(t,i)=>Ni.patch(`/announcements/${t}/`,i),deleteAnnouncement:t=>Ni.delete(`/announcements/${t}/`)},J$={getStats:()=>Ni.get("/dashboard/stats/"),getRecentActivity:()=>Promise.resolve([])},CL=Z.createContext(void 0),eG=({children:t})=>{const[i,c]=Z.useState(null),[d,y]=Z.useState(!0),w=lg();Z.useEffect(()=>{(async()=>{if(Ni.isAuthenticated())try{const j=await S1.getMe();c(j),localStorage.setItem("user",JSON.stringify(j))}catch(j){console.error("Failed to fetch user:",j),Ni.clearAuth(),c(null),localStorage.removeItem("user")}else{const j=localStorage.getItem("user");if(j)try{c(JSON.parse(j))}catch{localStorage.removeItem("user")}}y(!1)})()},[]);const E=async z=>{try{const j=await S1.login(z),{token:H}=j;Ni.setAuthToken(H);const Y=await S1.getMe();c(Y),localStorage.setItem("user",JSON.stringify(Y)),w("/dashboard")}catch(j){throw console.error("Login failed:",j),j}},s=async()=>{try{await S1.logout()}catch(z){console.error("Logout error:",z)}finally{Ni.clearAuth(),c(null),localStorage.removeItem("user"),w("/login")}},O={user:i,isLoading:d,isAuthenticated:!!i,isAdmin:i?.user_type==="ADMIN",login:E,logout:s};return C.jsx(CL.Provider,{value:O,children:t})},Nx=()=>{const t=Z.useContext(CL);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},vD=t=>{let i;const c=new Set,d=(z,j)=>{const H=typeof z=="function"?z(i):z;if(!Object.is(H,i)){const Y=i;i=j??(typeof H!="object"||H===null)?H:Object.assign({},i,H),c.forEach(ie=>ie(i,Y))}},y=()=>i,s={setState:d,getState:y,getInitialState:()=>O,subscribe:z=>(c.add(z),()=>c.delete(z))},O=i=t(d,y,s);return s},tG=(t=>t?vD(t):vD),nG=t=>t;function iG(t,i=nG){const c=vr.useSyncExternalStore(t.subscribe,vr.useCallback(()=>i(t.getState()),[t,i]),vr.useCallback(()=>i(t.getInitialState()),[t,i]));return vr.useDebugValue(c),c}const bD=t=>{const i=tG(t),c=d=>iG(i,d);return Object.assign(c,i),c},cA=(t=>t?bD(t):bD);function rG(t,i){let c;try{c=t()}catch{return}return{getItem:y=>{var w;const E=O=>O===null?null:JSON.parse(O,void 0),s=(w=c.getItem(y))!=null?w:null;return s instanceof Promise?s.then(E):E(s)},setItem:(y,w)=>c.setItem(y,JSON.stringify(w,void 0)),removeItem:y=>c.removeItem(y)}}const q2=t=>i=>{try{const c=t(i);return c instanceof Promise?c:{then(d){return q2(d)(c)},catch(d){return this}}}catch(c){return{then(d){return this},catch(d){return q2(d)(c)}}}},sG=(t,i)=>(c,d,y)=>{let w={storage:rG(()=>localStorage),partialize:ee=>ee,version:0,merge:(ee,le)=>({...le,...ee}),...i},E=!1;const s=new Set,O=new Set;let z=w.storage;if(!z)return t((...ee)=>{console.warn(`[zustand persist middleware] Unable to update item '${w.name}', the given storage is currently unavailable.`),c(...ee)},d,y);const j=()=>{const ee=w.partialize({...d()});return z.setItem(w.name,{state:ee,version:w.version})},H=y.setState;y.setState=(ee,le)=>(H(ee,le),j());const Y=t((...ee)=>(c(...ee),j()),d,y);y.getInitialState=()=>Y;let ie;const oe=()=>{var ee,le;if(!z)return;E=!1,s.forEach(pe=>{var _e;return pe((_e=d())!=null?_e:Y)});const ge=((le=w.onRehydrateStorage)==null?void 0:le.call(w,(ee=d())!=null?ee:Y))||void 0;return q2(z.getItem.bind(z))(w.name).then(pe=>{if(pe)if(typeof pe.version=="number"&&pe.version!==w.version){if(w.migrate){const _e=w.migrate(pe.state,pe.version);return _e instanceof Promise?_e.then(Re=>[!0,Re]):[!0,_e]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,pe.state];return[!1,void 0]}).then(pe=>{var _e;const[Re,xe]=pe;if(ie=w.merge(xe,(_e=d())!=null?_e:Y),c(ie,!0),Re)return j()}).then(()=>{ge?.(ie,void 0),ie=d(),E=!0,O.forEach(pe=>pe(ie))}).catch(pe=>{ge?.(void 0,pe)})};return y.persist={setOptions:ee=>{w={...w,...ee},ee.storage&&(z=ee.storage)},clearStorage:()=>{z?.removeItem(w.name)},getOptions:()=>w,rehydrate:()=>oe(),hasHydrated:()=>E,onHydrate:ee=>(s.add(ee),()=>{s.delete(ee)}),onFinishHydration:ee=>(O.add(ee),()=>{O.delete(ee)})},w.skipHydration||oe(),ie||Y},oG=sG,Yw=cA()(oG(t=>({sidebarOpen:!0,language:"en",theme:"light",mapCenter:[33.6844,73.0479],mapZoom:12,setSidebarOpen:i=>t({sidebarOpen:i}),toggleSidebar:()=>t(i=>({sidebarOpen:!i.sidebarOpen})),setLanguage:i=>t({language:i}),setTheme:i=>t({theme:i}),setMapCenter:i=>t({mapCenter:i}),setMapZoom:i=>t({mapZoom:i})}),{name:"smdb-ui-storage"}));cA(t=>({toasts:[],addToast:i=>{const c=Math.random().toString(36).substr(2,9);t(d=>({toasts:[...d.toasts,{...i,id:c}]})),setTimeout(()=>{t(d=>({toasts:d.toasts.filter(y=>y.id!==c)}))},5e3)},removeToast:i=>t(c=>({toasts:c.toasts.filter(d=>d.id!==i)}))}));cA(t=>({isFullscreen:!1,isOnline:!0,currentLanguage:"en",simulatedTime:new Date,emergencyOverride:!1,setFullscreen:i=>t({isFullscreen:i}),setOnline:i=>t({isOnline:i}),setSMDLanguage:i=>t({currentLanguage:i}),setSimulatedTime:i=>t({simulatedTime:i}),setEmergencyOverride:i=>t({emergencyOverride:i})}));function ls(t,i,{checkForDefaultPrevented:c=!0}={}){return function(y){if(t?.(y),c===!1||!y.defaultPrevented)return i?.(y)}}function wD(t,i){if(typeof t=="function")return t(i);t!=null&&(t.current=i)}function kx(...t){return i=>{let c=!1;const d=t.map(y=>{const w=wD(y,i);return!c&&typeof w=="function"&&(c=!0),w});if(c)return()=>{for(let y=0;y<d.length;y++){const w=d[y];typeof w=="function"?w():wD(t[y],null)}}}}function Mo(...t){return Z.useCallback(kx(...t),t)}function aG(t,i){const c=Z.createContext(i),d=w=>{const{children:E,...s}=w,O=Z.useMemo(()=>s,Object.values(s));return C.jsx(c.Provider,{value:O,children:E})};d.displayName=t+"Provider";function y(w){const E=Z.useContext(c);if(E)return E;if(i!==void 0)return i;throw new Error(`\`${w}\` must be used within \`${t}\``)}return[d,y]}function K0(t,i=[]){let c=[];function d(w,E){const s=Z.createContext(E),O=c.length;c=[...c,E];const z=H=>{const{scope:Y,children:ie,...oe}=H,ee=Y?.[t]?.[O]||s,le=Z.useMemo(()=>oe,Object.values(oe));return C.jsx(ee.Provider,{value:le,children:ie})};z.displayName=w+"Provider";function j(H,Y){const ie=Y?.[t]?.[O]||s,oe=Z.useContext(ie);if(oe)return oe;if(E!==void 0)return E;throw new Error(`\`${H}\` must be used within \`${w}\``)}return[z,j]}const y=()=>{const w=c.map(E=>Z.createContext(E));return function(s){const O=s?.[t]||w;return Z.useMemo(()=>({[`__scope${t}`]:{...s,[t]:O}}),[s,O])}};return y.scopeName=t,[d,lG(y,...i)]}function lG(...t){const i=t[0];if(t.length===1)return i;const c=()=>{const d=t.map(y=>({useScope:y(),scopeName:y.scopeName}));return function(w){const E=d.reduce((s,{useScope:O,scopeName:z})=>{const H=O(w)[`__scope${z}`];return{...s,...H}},{});return Z.useMemo(()=>({[`__scope${i.scopeName}`]:E}),[E])}};return c.scopeName=i.scopeName,c}function SD(t){const i=cG(t),c=Z.forwardRef((d,y)=>{const{children:w,...E}=d,s=Z.Children.toArray(w),O=s.find(dG);if(O){const z=O.props.children,j=s.map(H=>H===O?Z.Children.count(z)>1?Z.Children.only(null):Z.isValidElement(z)?z.props.children:null:H);return C.jsx(i,{...E,ref:y,children:Z.isValidElement(z)?Z.cloneElement(z,void 0,j):null})}return C.jsx(i,{...E,ref:y,children:w})});return c.displayName=`${t}.Slot`,c}function cG(t){const i=Z.forwardRef((c,d)=>{const{children:y,...w}=c;if(Z.isValidElement(y)){const E=fG(y),s=hG(w,y.props);return y.type!==Z.Fragment&&(s.ref=d?kx(d,E):E),Z.cloneElement(y,s)}return Z.Children.count(y)>1?Z.Children.only(null):null});return i.displayName=`${t}.SlotClone`,i}var uG=Symbol("radix.slottable");function dG(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===uG}function hG(t,i){const c={...i};for(const d in i){const y=t[d],w=i[d];/^on[A-Z]/.test(d)?y&&w?c[d]=(...s)=>{const O=w(...s);return y(...s),O}:y&&(c[d]=y):d==="style"?c[d]={...y,...w}:d==="className"&&(c[d]=[y,w].filter(Boolean).join(" "))}return{...t,...c}}function fG(t){let i=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=Object.getOwnPropertyDescriptor(t,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}function RL(t){const i=t+"CollectionProvider",[c,d]=K0(i),[y,w]=c(i,{collectionRef:{current:null},itemMap:new Map}),E=ee=>{const{scope:le,children:ge}=ee,pe=vr.useRef(null),_e=vr.useRef(new Map).current;return C.jsx(y,{scope:le,itemMap:_e,collectionRef:pe,children:ge})};E.displayName=i;const s=t+"CollectionSlot",O=SD(s),z=vr.forwardRef((ee,le)=>{const{scope:ge,children:pe}=ee,_e=w(s,ge),Re=Mo(le,_e.collectionRef);return C.jsx(O,{ref:Re,children:pe})});z.displayName=s;const j=t+"CollectionItemSlot",H="data-radix-collection-item",Y=SD(j),ie=vr.forwardRef((ee,le)=>{const{scope:ge,children:pe,..._e}=ee,Re=vr.useRef(null),xe=Mo(le,Re),Ze=w(j,ge);return vr.useEffect(()=>(Ze.itemMap.set(Re,{ref:Re,..._e}),()=>void Ze.itemMap.delete(Re))),C.jsx(Y,{[H]:"",ref:xe,children:pe})});ie.displayName=j;function oe(ee){const le=w(t+"CollectionConsumer",ee);return vr.useCallback(()=>{const pe=le.collectionRef.current;if(!pe)return[];const _e=Array.from(pe.querySelectorAll(`[${H}]`));return Array.from(le.itemMap.values()).sort((Ze,Le)=>_e.indexOf(Ze.ref.current)-_e.indexOf(Le.ref.current))},[le.collectionRef,le.itemMap])}return[{Provider:E,Slot:z,ItemSlot:ie},oe,d]}function pG(t){const i=mG(t),c=Z.forwardRef((d,y)=>{const{children:w,...E}=d,s=Z.Children.toArray(w),O=s.find(_G);if(O){const z=O.props.children,j=s.map(H=>H===O?Z.Children.count(z)>1?Z.Children.only(null):Z.isValidElement(z)?z.props.children:null:H);return C.jsx(i,{...E,ref:y,children:Z.isValidElement(z)?Z.cloneElement(z,void 0,j):null})}return C.jsx(i,{...E,ref:y,children:w})});return c.displayName=`${t}.Slot`,c}function mG(t){const i=Z.forwardRef((c,d)=>{const{children:y,...w}=c;if(Z.isValidElement(y)){const E=xG(y),s=yG(w,y.props);return y.type!==Z.Fragment&&(s.ref=d?kx(d,E):E),Z.cloneElement(y,s)}return Z.Children.count(y)>1?Z.Children.only(null):null});return i.displayName=`${t}.SlotClone`,i}var gG=Symbol("radix.slottable");function _G(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===gG}function yG(t,i){const c={...i};for(const d in i){const y=t[d],w=i[d];/^on[A-Z]/.test(d)?y&&w?c[d]=(...s)=>{const O=w(...s);return y(...s),O}:y&&(c[d]=y):d==="style"?c[d]={...y,...w}:d==="className"&&(c[d]=[y,w].filter(Boolean).join(" "))}return{...t,...c}}function xG(t){let i=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=Object.getOwnPropertyDescriptor(t,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}var vG=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],As=vG.reduce((t,i)=>{const c=pG(`Primitive.${i}`),d=Z.forwardRef((y,w)=>{const{asChild:E,...s}=y,O=E?c:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),C.jsx(O,{...s,ref:w})});return d.displayName=`Primitive.${i}`,{...t,[i]:d}},{});function ML(t,i){t&&ah.flushSync(()=>t.dispatchEvent(i))}function lh(t){const i=Z.useRef(t);return Z.useEffect(()=>{i.current=t}),Z.useMemo(()=>(...c)=>i.current?.(...c),[])}function bG(t,i=globalThis?.document){const c=lh(t);Z.useEffect(()=>{const d=y=>{y.key==="Escape"&&c(y)};return i.addEventListener("keydown",d,{capture:!0}),()=>i.removeEventListener("keydown",d,{capture:!0})},[c,i])}var wG="DismissableLayer",Z2="dismissableLayer.update",SG="dismissableLayer.pointerDownOutside",TG="dismissableLayer.focusOutside",TD,IL=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Qw=Z.forwardRef((t,i)=>{const{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:d,onPointerDownOutside:y,onFocusOutside:w,onInteractOutside:E,onDismiss:s,...O}=t,z=Z.useContext(IL),[j,H]=Z.useState(null),Y=j?.ownerDocument??globalThis?.document,[,ie]=Z.useState({}),oe=Mo(i,Le=>H(Le)),ee=Array.from(z.layers),[le]=[...z.layersWithOutsidePointerEventsDisabled].slice(-1),ge=ee.indexOf(le),pe=j?ee.indexOf(j):-1,_e=z.layersWithOutsidePointerEventsDisabled.size>0,Re=pe>=ge,xe=AG(Le=>{const $e=Le.target,st=[...z.branches].some(Et=>Et.contains($e));!Re||st||(y?.(Le),E?.(Le),Le.defaultPrevented||s?.())},Y),Ze=CG(Le=>{const $e=Le.target;[...z.branches].some(Et=>Et.contains($e))||(w?.(Le),E?.(Le),Le.defaultPrevented||s?.())},Y);return bG(Le=>{pe===z.layers.size-1&&(d?.(Le),!Le.defaultPrevented&&s&&(Le.preventDefault(),s()))},Y),Z.useEffect(()=>{if(j)return c&&(z.layersWithOutsidePointerEventsDisabled.size===0&&(TD=Y.body.style.pointerEvents,Y.body.style.pointerEvents="none"),z.layersWithOutsidePointerEventsDisabled.add(j)),z.layers.add(j),ED(),()=>{c&&z.layersWithOutsidePointerEventsDisabled.size===1&&(Y.body.style.pointerEvents=TD)}},[j,Y,c,z]),Z.useEffect(()=>()=>{j&&(z.layers.delete(j),z.layersWithOutsidePointerEventsDisabled.delete(j),ED())},[j,z]),Z.useEffect(()=>{const Le=()=>ie({});return document.addEventListener(Z2,Le),()=>document.removeEventListener(Z2,Le)},[]),C.jsx(As.div,{...O,ref:oe,style:{pointerEvents:_e?Re?"auto":"none":void 0,...t.style},onFocusCapture:ls(t.onFocusCapture,Ze.onFocusCapture),onBlurCapture:ls(t.onBlurCapture,Ze.onBlurCapture),onPointerDownCapture:ls(t.onPointerDownCapture,xe.onPointerDownCapture)})});Qw.displayName=wG;var EG="DismissableLayerBranch",DL=Z.forwardRef((t,i)=>{const c=Z.useContext(IL),d=Z.useRef(null),y=Mo(i,d);return Z.useEffect(()=>{const w=d.current;if(w)return c.branches.add(w),()=>{c.branches.delete(w)}},[c.branches]),C.jsx(As.div,{...t,ref:y})});DL.displayName=EG;function AG(t,i=globalThis?.document){const c=lh(t),d=Z.useRef(!1),y=Z.useRef(()=>{});return Z.useEffect(()=>{const w=s=>{if(s.target&&!d.current){let O=function(){PL(SG,c,z,{discrete:!0})};const z={originalEvent:s};s.pointerType==="touch"?(i.removeEventListener("click",y.current),y.current=O,i.addEventListener("click",y.current,{once:!0})):O()}else i.removeEventListener("click",y.current);d.current=!1},E=window.setTimeout(()=>{i.addEventListener("pointerdown",w)},0);return()=>{window.clearTimeout(E),i.removeEventListener("pointerdown",w),i.removeEventListener("click",y.current)}},[i,c]),{onPointerDownCapture:()=>d.current=!0}}function CG(t,i=globalThis?.document){const c=lh(t),d=Z.useRef(!1);return Z.useEffect(()=>{const y=w=>{w.target&&!d.current&&PL(TG,c,{originalEvent:w},{discrete:!1})};return i.addEventListener("focusin",y),()=>i.removeEventListener("focusin",y)},[i,c]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}function ED(){const t=new CustomEvent(Z2);document.dispatchEvent(t)}function PL(t,i,c,{discrete:d}){const y=c.originalEvent.target,w=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:c});i&&y.addEventListener(t,i,{once:!0}),d?ML(y,w):y.dispatchEvent(w)}var RG=Qw,MG=DL,cl=globalThis?.document?Z.useLayoutEffect:()=>{},IG="Portal",Jw=Z.forwardRef((t,i)=>{const{container:c,...d}=t,[y,w]=Z.useState(!1);cl(()=>w(!0),[]);const E=c||y&&globalThis?.document?.body;return E?vU.createPortal(C.jsx(As.div,{...d,ref:i}),E):null});Jw.displayName=IG;function DG(t,i){return Z.useReducer((c,d)=>i[c][d]??c,t)}var Y0=t=>{const{present:i,children:c}=t,d=PG(i),y=typeof c=="function"?c({present:d.isPresent}):Z.Children.only(c),w=Mo(d.ref,OG(y));return typeof c=="function"||d.isPresent?Z.cloneElement(y,{ref:w}):null};Y0.displayName="Presence";function PG(t){const[i,c]=Z.useState(),d=Z.useRef(null),y=Z.useRef(t),w=Z.useRef("none"),E=t?"mounted":"unmounted",[s,O]=DG(E,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Z.useEffect(()=>{const z=E1(d.current);w.current=s==="mounted"?z:"none"},[s]),cl(()=>{const z=d.current,j=y.current;if(j!==t){const Y=w.current,ie=E1(z);t?O("MOUNT"):ie==="none"||z?.display==="none"?O("UNMOUNT"):O(j&&Y!==ie?"ANIMATION_OUT":"UNMOUNT"),y.current=t}},[t,O]),cl(()=>{if(i){let z;const j=i.ownerDocument.defaultView??window,H=ie=>{const ee=E1(d.current).includes(CSS.escape(ie.animationName));if(ie.target===i&&ee&&(O("ANIMATION_END"),!y.current)){const le=i.style.animationFillMode;i.style.animationFillMode="forwards",z=j.setTimeout(()=>{i.style.animationFillMode==="forwards"&&(i.style.animationFillMode=le)})}},Y=ie=>{ie.target===i&&(w.current=E1(d.current))};return i.addEventListener("animationstart",Y),i.addEventListener("animationcancel",H),i.addEventListener("animationend",H),()=>{j.clearTimeout(z),i.removeEventListener("animationstart",Y),i.removeEventListener("animationcancel",H),i.removeEventListener("animationend",H)}}else O("ANIMATION_END")},[i,O]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:Z.useCallback(z=>{d.current=z?getComputedStyle(z):null,c(z)},[])}}function E1(t){return t?.animationName||"none"}function OG(t){let i=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=Object.getOwnPropertyDescriptor(t,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}var zG=HE[" useInsertionEffect ".trim().toString()]||cl;function gw({prop:t,defaultProp:i,onChange:c=()=>{},caller:d}){const[y,w,E]=LG({defaultProp:i,onChange:c}),s=t!==void 0,O=s?t:y;{const j=Z.useRef(t!==void 0);Z.useEffect(()=>{const H=j.current;H!==s&&console.warn(`${d} is changing from ${H?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),j.current=s},[s,d])}const z=Z.useCallback(j=>{if(s){const H=NG(j)?j(t):j;H!==t&&E.current?.(H)}else w(j)},[s,t,w,E]);return[O,z]}function LG({defaultProp:t,onChange:i}){const[c,d]=Z.useState(t),y=Z.useRef(c),w=Z.useRef(i);return zG(()=>{w.current=i},[i]),Z.useEffect(()=>{y.current!==c&&(w.current?.(c),y.current=c)},[c,y]),[c,d,w]}function NG(t){return typeof t=="function"}var OL=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),kG="VisuallyHidden",uA=Z.forwardRef((t,i)=>C.jsx(As.span,{...t,ref:i,style:{...OL,...t.style}}));uA.displayName=kG;var dA="ToastProvider",[hA,jG,FG]=RL("Toast"),[zL]=K0("Toast",[FG]),[BG,eS]=zL(dA),LL=t=>{const{__scopeToast:i,label:c="Notification",duration:d=5e3,swipeDirection:y="right",swipeThreshold:w=50,children:E}=t,[s,O]=Z.useState(null),[z,j]=Z.useState(0),H=Z.useRef(!1),Y=Z.useRef(!1);return c.trim()||console.error(`Invalid prop \`label\` supplied to \`${dA}\`. Expected non-empty \`string\`.`),C.jsx(hA.Provider,{scope:i,children:C.jsx(BG,{scope:i,label:c,duration:d,swipeDirection:y,swipeThreshold:w,toastCount:z,viewport:s,onViewportChange:O,onToastAdd:Z.useCallback(()=>j(ie=>ie+1),[]),onToastRemove:Z.useCallback(()=>j(ie=>ie-1),[]),isFocusedToastEscapeKeyDownRef:H,isClosePausedRef:Y,children:E})})};LL.displayName=dA;var NL="ToastViewport",VG=["F8"],W2="toast.viewportPause",X2="toast.viewportResume",kL=Z.forwardRef((t,i)=>{const{__scopeToast:c,hotkey:d=VG,label:y="Notifications ({hotkey})",...w}=t,E=eS(NL,c),s=jG(c),O=Z.useRef(null),z=Z.useRef(null),j=Z.useRef(null),H=Z.useRef(null),Y=Mo(i,H,E.onViewportChange),ie=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),oe=E.toastCount>0;Z.useEffect(()=>{const le=ge=>{d.length!==0&&d.every(_e=>ge[_e]||ge.code===_e)&&H.current?.focus()};return document.addEventListener("keydown",le),()=>document.removeEventListener("keydown",le)},[d]),Z.useEffect(()=>{const le=O.current,ge=H.current;if(oe&&le&&ge){const pe=()=>{if(!E.isClosePausedRef.current){const Ze=new CustomEvent(W2);ge.dispatchEvent(Ze),E.isClosePausedRef.current=!0}},_e=()=>{if(E.isClosePausedRef.current){const Ze=new CustomEvent(X2);ge.dispatchEvent(Ze),E.isClosePausedRef.current=!1}},Re=Ze=>{!le.contains(Ze.relatedTarget)&&_e()},xe=()=>{le.contains(document.activeElement)||_e()};return le.addEventListener("focusin",pe),le.addEventListener("focusout",Re),le.addEventListener("pointermove",pe),le.addEventListener("pointerleave",xe),window.addEventListener("blur",pe),window.addEventListener("focus",_e),()=>{le.removeEventListener("focusin",pe),le.removeEventListener("focusout",Re),le.removeEventListener("pointermove",pe),le.removeEventListener("pointerleave",xe),window.removeEventListener("blur",pe),window.removeEventListener("focus",_e)}}},[oe,E.isClosePausedRef]);const ee=Z.useCallback(({tabbingDirection:le})=>{const pe=s().map(_e=>{const Re=_e.ref.current,xe=[Re,...eH(Re)];return le==="forwards"?xe:xe.reverse()});return(le==="forwards"?pe.reverse():pe).flat()},[s]);return Z.useEffect(()=>{const le=H.current;if(le){const ge=pe=>{const _e=pe.altKey||pe.ctrlKey||pe.metaKey;if(pe.key==="Tab"&&!_e){const xe=document.activeElement,Ze=pe.shiftKey;if(pe.target===le&&Ze){z.current?.focus();return}const st=ee({tabbingDirection:Ze?"backwards":"forwards"}),Et=st.findIndex(Ut=>Ut===xe);ZT(st.slice(Et+1))?pe.preventDefault():Ze?z.current?.focus():j.current?.focus()}};return le.addEventListener("keydown",ge),()=>le.removeEventListener("keydown",ge)}},[s,ee]),C.jsxs(MG,{ref:O,role:"region","aria-label":y.replace("{hotkey}",ie),tabIndex:-1,style:{pointerEvents:oe?void 0:"none"},children:[oe&&C.jsx(K2,{ref:z,onFocusFromOutsideViewport:()=>{const le=ee({tabbingDirection:"forwards"});ZT(le)}}),C.jsx(hA.Slot,{scope:c,children:C.jsx(As.ol,{tabIndex:-1,...w,ref:Y})}),oe&&C.jsx(K2,{ref:j,onFocusFromOutsideViewport:()=>{const le=ee({tabbingDirection:"backwards"});ZT(le)}})]})});kL.displayName=NL;var jL="ToastFocusProxy",K2=Z.forwardRef((t,i)=>{const{__scopeToast:c,onFocusFromOutsideViewport:d,...y}=t,w=eS(jL,c);return C.jsx(uA,{tabIndex:0,...y,ref:i,style:{position:"fixed"},onFocus:E=>{const s=E.relatedTarget;!w.viewport?.contains(s)&&d()}})});K2.displayName=jL;var Q0="Toast",UG="toast.swipeStart",$G="toast.swipeMove",GG="toast.swipeCancel",HG="toast.swipeEnd",FL=Z.forwardRef((t,i)=>{const{forceMount:c,open:d,defaultOpen:y,onOpenChange:w,...E}=t,[s,O]=gw({prop:d,defaultProp:y??!0,onChange:w,caller:Q0});return C.jsx(Y0,{present:c||s,children:C.jsx(WG,{open:s,...E,ref:i,onClose:()=>O(!1),onPause:lh(t.onPause),onResume:lh(t.onResume),onSwipeStart:ls(t.onSwipeStart,z=>{z.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ls(t.onSwipeMove,z=>{const{x:j,y:H}=z.detail.delta;z.currentTarget.setAttribute("data-swipe","move"),z.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${j}px`),z.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${H}px`)}),onSwipeCancel:ls(t.onSwipeCancel,z=>{z.currentTarget.setAttribute("data-swipe","cancel"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),z.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),z.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ls(t.onSwipeEnd,z=>{const{x:j,y:H}=z.detail.delta;z.currentTarget.setAttribute("data-swipe","end"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),z.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),z.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${j}px`),z.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${H}px`),O(!1)})})})});FL.displayName=Q0;var[qG,ZG]=zL(Q0,{onClose(){}}),WG=Z.forwardRef((t,i)=>{const{__scopeToast:c,type:d="foreground",duration:y,open:w,onClose:E,onEscapeKeyDown:s,onPause:O,onResume:z,onSwipeStart:j,onSwipeMove:H,onSwipeCancel:Y,onSwipeEnd:ie,...oe}=t,ee=eS(Q0,c),[le,ge]=Z.useState(null),pe=Mo(i,ut=>ge(ut)),_e=Z.useRef(null),Re=Z.useRef(null),xe=y||ee.duration,Ze=Z.useRef(0),Le=Z.useRef(xe),$e=Z.useRef(0),{onToastAdd:st,onToastRemove:Et}=ee,Ut=lh(()=>{le?.contains(document.activeElement)&&ee.viewport?.focus(),E()}),$t=Z.useCallback(ut=>{!ut||ut===1/0||(window.clearTimeout($e.current),Ze.current=new Date().getTime(),$e.current=window.setTimeout(Ut,ut))},[Ut]);Z.useEffect(()=>{const ut=ee.viewport;if(ut){const on=()=>{$t(Le.current),z?.()},Ke=()=>{const ze=new Date().getTime()-Ze.current;Le.current=Le.current-ze,window.clearTimeout($e.current),O?.()};return ut.addEventListener(W2,Ke),ut.addEventListener(X2,on),()=>{ut.removeEventListener(W2,Ke),ut.removeEventListener(X2,on)}}},[ee.viewport,xe,O,z,$t]),Z.useEffect(()=>{w&&!ee.isClosePausedRef.current&&$t(xe)},[w,xe,ee.isClosePausedRef,$t]),Z.useEffect(()=>(st(),()=>Et()),[st,Et]);const tt=Z.useMemo(()=>le?qL(le):null,[le]);return ee.viewport?C.jsxs(C.Fragment,{children:[tt&&C.jsx(XG,{__scopeToast:c,role:"status","aria-live":d==="foreground"?"assertive":"polite",children:tt}),C.jsx(qG,{scope:c,onClose:Ut,children:ah.createPortal(C.jsx(hA.ItemSlot,{scope:c,children:C.jsx(RG,{asChild:!0,onEscapeKeyDown:ls(s,()=>{ee.isFocusedToastEscapeKeyDownRef.current||Ut(),ee.isFocusedToastEscapeKeyDownRef.current=!1}),children:C.jsx(As.li,{tabIndex:0,"data-state":w?"open":"closed","data-swipe-direction":ee.swipeDirection,...oe,ref:pe,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:ls(t.onKeyDown,ut=>{ut.key==="Escape"&&(s?.(ut.nativeEvent),ut.nativeEvent.defaultPrevented||(ee.isFocusedToastEscapeKeyDownRef.current=!0,Ut()))}),onPointerDown:ls(t.onPointerDown,ut=>{ut.button===0&&(_e.current={x:ut.clientX,y:ut.clientY})}),onPointerMove:ls(t.onPointerMove,ut=>{if(!_e.current)return;const on=ut.clientX-_e.current.x,Ke=ut.clientY-_e.current.y,ze=!!Re.current,Fe=["left","right"].includes(ee.swipeDirection),kt=["left","up"].includes(ee.swipeDirection)?Math.min:Math.max,fn=Fe?kt(0,on):0,Me=Fe?0:kt(0,Ke),ct=ut.pointerType==="touch"?10:2,vt={x:fn,y:Me},Kt={originalEvent:ut,delta:vt};ze?(Re.current=vt,A1($G,H,Kt,{discrete:!1})):AD(vt,ee.swipeDirection,ct)?(Re.current=vt,A1(UG,j,Kt,{discrete:!1}),ut.target.setPointerCapture(ut.pointerId)):(Math.abs(on)>ct||Math.abs(Ke)>ct)&&(_e.current=null)}),onPointerUp:ls(t.onPointerUp,ut=>{const on=Re.current,Ke=ut.target;if(Ke.hasPointerCapture(ut.pointerId)&&Ke.releasePointerCapture(ut.pointerId),Re.current=null,_e.current=null,on){const ze=ut.currentTarget,Fe={originalEvent:ut,delta:on};AD(on,ee.swipeDirection,ee.swipeThreshold)?A1(HG,ie,Fe,{discrete:!0}):A1(GG,Y,Fe,{discrete:!0}),ze.addEventListener("click",kt=>kt.preventDefault(),{once:!0})}})})})}),ee.viewport)})]}):null}),XG=t=>{const{__scopeToast:i,children:c,...d}=t,y=eS(Q0,i),[w,E]=Z.useState(!1),[s,O]=Z.useState(!1);return QG(()=>E(!0)),Z.useEffect(()=>{const z=window.setTimeout(()=>O(!0),1e3);return()=>window.clearTimeout(z)},[]),s?null:C.jsx(Jw,{asChild:!0,children:C.jsx(uA,{...d,children:w&&C.jsxs(C.Fragment,{children:[y.label," ",c]})})})},KG="ToastTitle",BL=Z.forwardRef((t,i)=>{const{__scopeToast:c,...d}=t;return C.jsx(As.div,{...d,ref:i})});BL.displayName=KG;var YG="ToastDescription",VL=Z.forwardRef((t,i)=>{const{__scopeToast:c,...d}=t;return C.jsx(As.div,{...d,ref:i})});VL.displayName=YG;var UL="ToastAction",$L=Z.forwardRef((t,i)=>{const{altText:c,...d}=t;return c.trim()?C.jsx(HL,{altText:c,asChild:!0,children:C.jsx(fA,{...d,ref:i})}):(console.error(`Invalid prop \`altText\` supplied to \`${UL}\`. Expected non-empty \`string\`.`),null)});$L.displayName=UL;var GL="ToastClose",fA=Z.forwardRef((t,i)=>{const{__scopeToast:c,...d}=t,y=ZG(GL,c);return C.jsx(HL,{asChild:!0,children:C.jsx(As.button,{type:"button",...d,ref:i,onClick:ls(t.onClick,y.onClose)})})});fA.displayName=GL;var HL=Z.forwardRef((t,i)=>{const{__scopeToast:c,altText:d,...y}=t;return C.jsx(As.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,...y,ref:i})});function qL(t){const i=[];return Array.from(t.childNodes).forEach(d=>{if(d.nodeType===d.TEXT_NODE&&d.textContent&&i.push(d.textContent),JG(d)){const y=d.ariaHidden||d.hidden||d.style.display==="none",w=d.dataset.radixToastAnnounceExclude==="";if(!y)if(w){const E=d.dataset.radixToastAnnounceAlt;E&&i.push(E)}else i.push(...qL(d))}}),i}function A1(t,i,c,{discrete:d}){const y=c.originalEvent.currentTarget,w=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:c});i&&y.addEventListener(t,i,{once:!0}),d?ML(y,w):y.dispatchEvent(w)}var AD=(t,i,c=0)=>{const d=Math.abs(t.x),y=Math.abs(t.y),w=d>y;return i==="left"||i==="right"?w&&d>c:!w&&y>c};function QG(t=()=>{}){const i=lh(t);cl(()=>{let c=0,d=0;return c=window.requestAnimationFrame(()=>d=window.requestAnimationFrame(i)),()=>{window.cancelAnimationFrame(c),window.cancelAnimationFrame(d)}},[i])}function JG(t){return t.nodeType===t.ELEMENT_NODE}function eH(t){const i=[],c=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const y=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||y?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)i.push(c.currentNode);return i}function ZT(t){const i=document.activeElement;return t.some(c=>c===i?!0:(c.focus(),document.activeElement!==i))}var tH=LL,ZL=kL,WL=FL,XL=BL,KL=VL,YL=$L,QL=fA;function JL(t){var i,c,d="";if(typeof t=="string"||typeof t=="number")d+=t;else if(typeof t=="object")if(Array.isArray(t)){var y=t.length;for(i=0;i<y;i++)t[i]&&(c=JL(t[i]))&&(d&&(d+=" "),d+=c)}else for(c in t)t[c]&&(d&&(d+=" "),d+=c);return d}function eN(){for(var t,i,c=0,d="",y=arguments.length;c<y;c++)(t=arguments[c])&&(i=JL(t))&&(d&&(d+=" "),d+=i);return d}const CD=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,RD=eN,tN=(t,i)=>c=>{var d;if(i?.variants==null)return RD(t,c?.class,c?.className);const{variants:y,defaultVariants:w}=i,E=Object.keys(y).map(z=>{const j=c?.[z],H=w?.[z];if(j===null)return null;const Y=CD(j)||CD(H);return y[z][Y]}),s=c&&Object.entries(c).reduce((z,j)=>{let[H,Y]=j;return Y===void 0||(z[H]=Y),z},{}),O=i==null||(d=i.compoundVariants)===null||d===void 0?void 0:d.reduce((z,j)=>{let{class:H,className:Y,...ie}=j;return Object.entries(ie).every(oe=>{let[ee,le]=oe;return Array.isArray(le)?le.includes({...w,...s}[ee]):{...w,...s}[ee]===le})?[...z,H,Y]:z},[]);return RD(t,E,O,c?.class,c?.className)};const nH=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iH=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,c,d)=>d?d.toUpperCase():c.toLowerCase()),MD=t=>{const i=iH(t);return i.charAt(0).toUpperCase()+i.slice(1)},nN=(...t)=>t.filter((i,c,d)=>!!i&&i.trim()!==""&&d.indexOf(i)===c).join(" ").trim(),rH=t=>{for(const i in t)if(i.startsWith("aria-")||i==="role"||i==="title")return!0};var sH={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const oH=Z.forwardRef(({color:t="currentColor",size:i=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:y="",children:w,iconNode:E,...s},O)=>Z.createElement("svg",{ref:O,...sH,width:i,height:i,stroke:t,strokeWidth:d?Number(c)*24/Number(i):c,className:nN("lucide",y),...!w&&!rH(s)&&{"aria-hidden":"true"},...s},[...E.map(([z,j])=>Z.createElement(z,j)),...Array.isArray(w)?w:[w]]));const Ci=(t,i)=>{const c=Z.forwardRef(({className:d,...y},w)=>Z.createElement(oH,{ref:w,iconNode:i,className:nN(`lucide-${nH(MD(t))}`,`lucide-${t}`,d),...y}));return c.displayName=MD(t),c};const aH=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],R0=Ci("activity",aH);const lH=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],C_=Ci("arrow-left",lH);const cH=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],uH=Ci("arrow-right",cH);const dH=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],iN=Ci("bell",dH);const hH=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],rN=Ci("building-2",hH);const fH=[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]],fu=Ci("bus",fH);const pH=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],R_=Ci("calendar",pH);const mH=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],pA=Ci("check",mH);const gH=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],sN=Ci("chevron-down",gH);const _H=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],yH=Ci("chevron-right",_H);const xH=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],vH=Ci("chevron-left",xH);const bH=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],wH=Ci("chevron-up",bH);const SH=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],lx=Ci("circle-alert",SH);const TH=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ID=Ci("circle-check-big",TH);const EH=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],mA=Ci("clock",EH);const AH=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],DD=Ci("database",AH);const CH=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],RH=Ci("external-link",CH);const MH=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],oN=Ci("eye",MH);const IH=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],PD=Ci("gauge",IH);const DH=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],aN=Ci("globe",DH);const PH=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],cx=Ci("image",PH);const OH=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],K1=Ci("info",OH);const zH=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],LH=Ci("layout-dashboard",zH);const NH=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],z_=Ci("loader-circle",NH);const kH=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],jH=Ci("log-out",kH);const FH=[["path",{d:"M12.75 7.09a3 3 0 0 1 2.16 2.16",key:"1d4wjd"}],["path",{d:"M17.072 17.072c-1.634 2.17-3.527 3.912-4.471 4.727a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 1.432-4.568",key:"12yil7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.475 2.818A8 8 0 0 1 20 10c0 1.183-.31 2.377-.81 3.533",key:"lhrkcz"}],["path",{d:"M9.13 9.13a3 3 0 0 0 3.74 3.74",key:"13wojd"}]],Y2=Ci("map-pin-off",FH);const BH=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Dl=Ci("map-pin",BH);const VH=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],UH=Ci("maximize",VH);const $H=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],lN=Ci("megaphone",$H);const GH=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],HH=Ci("menu",GH);const qH=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],ZH=Ci("minimize",qH);const WH=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],M_=Ci("monitor",WH);const XH=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],yf=Ci("navigation",XH);const KH=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],YH=Ci("pause",KH);const QH=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],_w=Ci("pencil",QH);const JH=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Q2=Ci("play",JH);const eq=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ed=Ci("plus",eq);const tq=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],nq=Ci("power-off",tq);const iq=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],rq=Ci("power",iq);const sq=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],oq=Ci("refresh-cw",sq);const aq=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],L_=Ci("route",aq);const lq=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],cq=Ci("save",lq);const uq=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],J0=Ci("search",uq);const dq=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],J2=Ci("settings",dq);const hq=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Y1=Ci("shield",hq);const fq=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],pq=Ci("signal",fq);const mq=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],OD=Ci("square",mq);const gq=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],_q=Ci("star",gq);const yq=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],xq=Ci("thermometer",yq);const vq=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],U_=Ci("trash-2",vq);const bq=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],xf=Ci("triangle-alert",bq);const wq=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],eE=Ci("user-check",wq);const Sq=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Tq=Ci("user-plus",Sq);const Eq=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],cN=Ci("user",Eq);const Aq=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],uN=Ci("users",Aq);const Cq=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Rq=Ci("volume-2",Cq);const Mq=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Iq=Ci("volume-x",Mq);const Dq=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Pq=Ci("wifi",Dq);const Oq=[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]],dN=Ci("youtube",Oq);const zq=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],tS=Ci("x",zq);const Lq=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],yw=Ci("zap",Lq),Nq=(t,i)=>{const c=new Array(t.length+i.length);for(let d=0;d<t.length;d++)c[d]=t[d];for(let d=0;d<i.length;d++)c[t.length+d]=i[d];return c},kq=(t,i)=>({classGroupId:t,validator:i}),hN=(t=new Map,i=null,c)=>({nextPart:t,validators:i,classGroupId:c}),xw="-",zD=[],jq="arbitrary..",Fq=t=>{const i=Vq(t),{conflictingClassGroups:c,conflictingClassGroupModifiers:d}=t;return{getClassGroupId:E=>{if(E.startsWith("[")&&E.endsWith("]"))return Bq(E);const s=E.split(xw),O=s[0]===""&&s.length>1?1:0;return fN(s,O,i)},getConflictingClassGroupIds:(E,s)=>{if(s){const O=d[E],z=c[E];return O?z?Nq(z,O):O:z||zD}return c[E]||zD}}},fN=(t,i,c)=>{if(t.length-i===0)return c.classGroupId;const y=t[i],w=c.nextPart.get(y);if(w){const z=fN(t,i+1,w);if(z)return z}const E=c.validators;if(E===null)return;const s=i===0?t.join(xw):t.slice(i).join(xw),O=E.length;for(let z=0;z<O;z++){const j=E[z];if(j.validator(s))return j.classGroupId}},Bq=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const i=t.slice(1,-1),c=i.indexOf(":"),d=i.slice(0,c);return d?jq+d:void 0})(),Vq=t=>{const{theme:i,classGroups:c}=t;return Uq(c,i)},Uq=(t,i)=>{const c=hN();for(const d in t){const y=t[d];gA(y,c,d,i)}return c},gA=(t,i,c,d)=>{const y=t.length;for(let w=0;w<y;w++){const E=t[w];$q(E,i,c,d)}},$q=(t,i,c,d)=>{if(typeof t=="string"){Gq(t,i,c);return}if(typeof t=="function"){Hq(t,i,c,d);return}qq(t,i,c,d)},Gq=(t,i,c)=>{const d=t===""?i:pN(i,t);d.classGroupId=c},Hq=(t,i,c,d)=>{if(Zq(t)){gA(t(d),i,c,d);return}i.validators===null&&(i.validators=[]),i.validators.push(kq(c,t))},qq=(t,i,c,d)=>{const y=Object.entries(t),w=y.length;for(let E=0;E<w;E++){const[s,O]=y[E];gA(O,pN(i,s),c,d)}},pN=(t,i)=>{let c=t;const d=i.split(xw),y=d.length;for(let w=0;w<y;w++){const E=d[w];let s=c.nextPart.get(E);s||(s=hN(),c.nextPart.set(E,s)),c=s}return c},Zq=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,Wq=t=>{if(t<1)return{get:()=>{},set:()=>{}};let i=0,c=Object.create(null),d=Object.create(null);const y=(w,E)=>{c[w]=E,i++,i>t&&(i=0,d=c,c=Object.create(null))};return{get(w){let E=c[w];if(E!==void 0)return E;if((E=d[w])!==void 0)return y(w,E),E},set(w,E){w in c?c[w]=E:y(w,E)}}},tE="!",LD=":",Xq=[],ND=(t,i,c,d,y)=>({modifiers:t,hasImportantModifier:i,baseClassName:c,maybePostfixModifierPosition:d,isExternal:y}),Kq=t=>{const{prefix:i,experimentalParseClassName:c}=t;let d=y=>{const w=[];let E=0,s=0,O=0,z;const j=y.length;for(let ee=0;ee<j;ee++){const le=y[ee];if(E===0&&s===0){if(le===LD){w.push(y.slice(O,ee)),O=ee+1;continue}if(le==="/"){z=ee;continue}}le==="["?E++:le==="]"?E--:le==="("?s++:le===")"&&s--}const H=w.length===0?y:y.slice(O);let Y=H,ie=!1;H.endsWith(tE)?(Y=H.slice(0,-1),ie=!0):H.startsWith(tE)&&(Y=H.slice(1),ie=!0);const oe=z&&z>O?z-O:void 0;return ND(w,ie,Y,oe)};if(i){const y=i+LD,w=d;d=E=>E.startsWith(y)?w(E.slice(y.length)):ND(Xq,!1,E,void 0,!0)}if(c){const y=d;d=w=>c({className:w,parseClassName:y})}return d},Yq=t=>{const i=new Map;return t.orderSensitiveModifiers.forEach((c,d)=>{i.set(c,1e6+d)}),c=>{const d=[];let y=[];for(let w=0;w<c.length;w++){const E=c[w],s=E[0]==="[",O=i.has(E);s||O?(y.length>0&&(y.sort(),d.push(...y),y=[]),d.push(E)):y.push(E)}return y.length>0&&(y.sort(),d.push(...y)),d}},Qq=t=>({cache:Wq(t.cacheSize),parseClassName:Kq(t),sortModifiers:Yq(t),...Fq(t)}),Jq=/\s+/,e9=(t,i)=>{const{parseClassName:c,getClassGroupId:d,getConflictingClassGroupIds:y,sortModifiers:w}=i,E=[],s=t.trim().split(Jq);let O="";for(let z=s.length-1;z>=0;z-=1){const j=s[z],{isExternal:H,modifiers:Y,hasImportantModifier:ie,baseClassName:oe,maybePostfixModifierPosition:ee}=c(j);if(H){O=j+(O.length>0?" "+O:O);continue}let le=!!ee,ge=d(le?oe.substring(0,ee):oe);if(!ge){if(!le){O=j+(O.length>0?" "+O:O);continue}if(ge=d(oe),!ge){O=j+(O.length>0?" "+O:O);continue}le=!1}const pe=Y.length===0?"":Y.length===1?Y[0]:w(Y).join(":"),_e=ie?pe+tE:pe,Re=_e+ge;if(E.indexOf(Re)>-1)continue;E.push(Re);const xe=y(ge,le);for(let Ze=0;Ze<xe.length;++Ze){const Le=xe[Ze];E.push(_e+Le)}O=j+(O.length>0?" "+O:O)}return O},t9=(...t)=>{let i=0,c,d,y="";for(;i<t.length;)(c=t[i++])&&(d=mN(c))&&(y&&(y+=" "),y+=d);return y},mN=t=>{if(typeof t=="string")return t;let i,c="";for(let d=0;d<t.length;d++)t[d]&&(i=mN(t[d]))&&(c&&(c+=" "),c+=i);return c},n9=(t,...i)=>{let c,d,y,w;const E=O=>{const z=i.reduce((j,H)=>H(j),t());return c=Qq(z),d=c.cache.get,y=c.cache.set,w=s,s(O)},s=O=>{const z=d(O);if(z)return z;const j=e9(O,c);return y(O,j),j};return w=E,(...O)=>w(t9(...O))},i9=[],Ea=t=>{const i=c=>c[t]||i9;return i.isThemeGetter=!0,i},gN=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,_N=/^\((?:(\w[\w-]*):)?(.+)\)$/i,r9=/^\d+\/\d+$/,s9=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,o9=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,a9=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,l9=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,c9=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ex=t=>r9.test(t),$r=t=>!!t&&!Number.isNaN(Number(t)),Ym=t=>!!t&&Number.isInteger(Number(t)),WT=t=>t.endsWith("%")&&$r(t.slice(0,-1)),Ip=t=>s9.test(t),u9=()=>!0,d9=t=>o9.test(t)&&!a9.test(t),yN=()=>!1,h9=t=>l9.test(t),f9=t=>c9.test(t),p9=t=>!vi(t)&&!bi(t),m9=t=>jx(t,bN,yN),vi=t=>gN.test(t),w_=t=>jx(t,wN,d9),XT=t=>jx(t,v9,$r),kD=t=>jx(t,xN,yN),g9=t=>jx(t,vN,f9),C1=t=>jx(t,SN,h9),bi=t=>_N.test(t),s0=t=>Fx(t,wN),_9=t=>Fx(t,b9),jD=t=>Fx(t,xN),y9=t=>Fx(t,bN),x9=t=>Fx(t,vN),R1=t=>Fx(t,SN,!0),jx=(t,i,c)=>{const d=gN.exec(t);return d?d[1]?i(d[1]):c(d[2]):!1},Fx=(t,i,c=!1)=>{const d=_N.exec(t);return d?d[1]?i(d[1]):c:!1},xN=t=>t==="position"||t==="percentage",vN=t=>t==="image"||t==="url",bN=t=>t==="length"||t==="size"||t==="bg-size",wN=t=>t==="length",v9=t=>t==="number",b9=t=>t==="family-name",SN=t=>t==="shadow",w9=()=>{const t=Ea("color"),i=Ea("font"),c=Ea("text"),d=Ea("font-weight"),y=Ea("tracking"),w=Ea("leading"),E=Ea("breakpoint"),s=Ea("container"),O=Ea("spacing"),z=Ea("radius"),j=Ea("shadow"),H=Ea("inset-shadow"),Y=Ea("text-shadow"),ie=Ea("drop-shadow"),oe=Ea("blur"),ee=Ea("perspective"),le=Ea("aspect"),ge=Ea("ease"),pe=Ea("animate"),_e=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Re=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],xe=()=>[...Re(),bi,vi],Ze=()=>["auto","hidden","clip","visible","scroll"],Le=()=>["auto","contain","none"],$e=()=>[bi,vi,O],st=()=>[ex,"full","auto",...$e()],Et=()=>[Ym,"none","subgrid",bi,vi],Ut=()=>["auto",{span:["full",Ym,bi,vi]},Ym,bi,vi],$t=()=>[Ym,"auto",bi,vi],tt=()=>["auto","min","max","fr",bi,vi],ut=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],on=()=>["start","end","center","stretch","center-safe","end-safe"],Ke=()=>["auto",...$e()],ze=()=>[ex,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...$e()],Fe=()=>[t,bi,vi],kt=()=>[...Re(),jD,kD,{position:[bi,vi]}],fn=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Me=()=>["auto","cover","contain",y9,m9,{size:[bi,vi]}],ct=()=>[WT,s0,w_],vt=()=>["","none","full",z,bi,vi],Kt=()=>["",$r,s0,w_],zn=()=>["solid","dashed","dotted","double"],Nn=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Yt=()=>[$r,WT,jD,kD],On=()=>["","none",oe,bi,vi],An=()=>["none",$r,bi,vi],In=()=>["none",$r,bi,vi],gi=()=>[$r,bi,vi],ji=()=>[ex,"full",...$e()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ip],breakpoint:[Ip],color:[u9],container:[Ip],"drop-shadow":[Ip],ease:["in","out","in-out"],font:[p9],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ip],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ip],shadow:[Ip],spacing:["px",$r],text:[Ip],"text-shadow":[Ip],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",ex,vi,bi,le]}],container:["container"],columns:[{columns:[$r,vi,bi,s]}],"break-after":[{"break-after":_e()}],"break-before":[{"break-before":_e()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:xe()}],overflow:[{overflow:Ze()}],"overflow-x":[{"overflow-x":Ze()}],"overflow-y":[{"overflow-y":Ze()}],overscroll:[{overscroll:Le()}],"overscroll-x":[{"overscroll-x":Le()}],"overscroll-y":[{"overscroll-y":Le()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:st()}],"inset-x":[{"inset-x":st()}],"inset-y":[{"inset-y":st()}],start:[{start:st()}],end:[{end:st()}],top:[{top:st()}],right:[{right:st()}],bottom:[{bottom:st()}],left:[{left:st()}],visibility:["visible","invisible","collapse"],z:[{z:[Ym,"auto",bi,vi]}],basis:[{basis:[ex,"full","auto",s,...$e()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[$r,ex,"auto","initial","none",vi]}],grow:[{grow:["",$r,bi,vi]}],shrink:[{shrink:["",$r,bi,vi]}],order:[{order:[Ym,"first","last","none",bi,vi]}],"grid-cols":[{"grid-cols":Et()}],"col-start-end":[{col:Ut()}],"col-start":[{"col-start":$t()}],"col-end":[{"col-end":$t()}],"grid-rows":[{"grid-rows":Et()}],"row-start-end":[{row:Ut()}],"row-start":[{"row-start":$t()}],"row-end":[{"row-end":$t()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":tt()}],"auto-rows":[{"auto-rows":tt()}],gap:[{gap:$e()}],"gap-x":[{"gap-x":$e()}],"gap-y":[{"gap-y":$e()}],"justify-content":[{justify:[...ut(),"normal"]}],"justify-items":[{"justify-items":[...on(),"normal"]}],"justify-self":[{"justify-self":["auto",...on()]}],"align-content":[{content:["normal",...ut()]}],"align-items":[{items:[...on(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...on(),{baseline:["","last"]}]}],"place-content":[{"place-content":ut()}],"place-items":[{"place-items":[...on(),"baseline"]}],"place-self":[{"place-self":["auto",...on()]}],p:[{p:$e()}],px:[{px:$e()}],py:[{py:$e()}],ps:[{ps:$e()}],pe:[{pe:$e()}],pt:[{pt:$e()}],pr:[{pr:$e()}],pb:[{pb:$e()}],pl:[{pl:$e()}],m:[{m:Ke()}],mx:[{mx:Ke()}],my:[{my:Ke()}],ms:[{ms:Ke()}],me:[{me:Ke()}],mt:[{mt:Ke()}],mr:[{mr:Ke()}],mb:[{mb:Ke()}],ml:[{ml:Ke()}],"space-x":[{"space-x":$e()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":$e()}],"space-y-reverse":["space-y-reverse"],size:[{size:ze()}],w:[{w:[s,"screen",...ze()]}],"min-w":[{"min-w":[s,"screen","none",...ze()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[E]},...ze()]}],h:[{h:["screen","lh",...ze()]}],"min-h":[{"min-h":["screen","lh","none",...ze()]}],"max-h":[{"max-h":["screen","lh",...ze()]}],"font-size":[{text:["base",c,s0,w_]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[d,bi,XT]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",WT,vi]}],"font-family":[{font:[_9,vi,i]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[y,bi,vi]}],"line-clamp":[{"line-clamp":[$r,"none",bi,XT]}],leading:[{leading:[w,...$e()]}],"list-image":[{"list-image":["none",bi,vi]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",bi,vi]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Fe()}],"text-color":[{text:Fe()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...zn(),"wavy"]}],"text-decoration-thickness":[{decoration:[$r,"from-font","auto",bi,w_]}],"text-decoration-color":[{decoration:Fe()}],"underline-offset":[{"underline-offset":[$r,"auto",bi,vi]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:$e()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",bi,vi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",bi,vi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:kt()}],"bg-repeat":[{bg:fn()}],"bg-size":[{bg:Me()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Ym,bi,vi],radial:["",bi,vi],conic:[Ym,bi,vi]},x9,g9]}],"bg-color":[{bg:Fe()}],"gradient-from-pos":[{from:ct()}],"gradient-via-pos":[{via:ct()}],"gradient-to-pos":[{to:ct()}],"gradient-from":[{from:Fe()}],"gradient-via":[{via:Fe()}],"gradient-to":[{to:Fe()}],rounded:[{rounded:vt()}],"rounded-s":[{"rounded-s":vt()}],"rounded-e":[{"rounded-e":vt()}],"rounded-t":[{"rounded-t":vt()}],"rounded-r":[{"rounded-r":vt()}],"rounded-b":[{"rounded-b":vt()}],"rounded-l":[{"rounded-l":vt()}],"rounded-ss":[{"rounded-ss":vt()}],"rounded-se":[{"rounded-se":vt()}],"rounded-ee":[{"rounded-ee":vt()}],"rounded-es":[{"rounded-es":vt()}],"rounded-tl":[{"rounded-tl":vt()}],"rounded-tr":[{"rounded-tr":vt()}],"rounded-br":[{"rounded-br":vt()}],"rounded-bl":[{"rounded-bl":vt()}],"border-w":[{border:Kt()}],"border-w-x":[{"border-x":Kt()}],"border-w-y":[{"border-y":Kt()}],"border-w-s":[{"border-s":Kt()}],"border-w-e":[{"border-e":Kt()}],"border-w-t":[{"border-t":Kt()}],"border-w-r":[{"border-r":Kt()}],"border-w-b":[{"border-b":Kt()}],"border-w-l":[{"border-l":Kt()}],"divide-x":[{"divide-x":Kt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Kt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...zn(),"hidden","none"]}],"divide-style":[{divide:[...zn(),"hidden","none"]}],"border-color":[{border:Fe()}],"border-color-x":[{"border-x":Fe()}],"border-color-y":[{"border-y":Fe()}],"border-color-s":[{"border-s":Fe()}],"border-color-e":[{"border-e":Fe()}],"border-color-t":[{"border-t":Fe()}],"border-color-r":[{"border-r":Fe()}],"border-color-b":[{"border-b":Fe()}],"border-color-l":[{"border-l":Fe()}],"divide-color":[{divide:Fe()}],"outline-style":[{outline:[...zn(),"none","hidden"]}],"outline-offset":[{"outline-offset":[$r,bi,vi]}],"outline-w":[{outline:["",$r,s0,w_]}],"outline-color":[{outline:Fe()}],shadow:[{shadow:["","none",j,R1,C1]}],"shadow-color":[{shadow:Fe()}],"inset-shadow":[{"inset-shadow":["none",H,R1,C1]}],"inset-shadow-color":[{"inset-shadow":Fe()}],"ring-w":[{ring:Kt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Fe()}],"ring-offset-w":[{"ring-offset":[$r,w_]}],"ring-offset-color":[{"ring-offset":Fe()}],"inset-ring-w":[{"inset-ring":Kt()}],"inset-ring-color":[{"inset-ring":Fe()}],"text-shadow":[{"text-shadow":["none",Y,R1,C1]}],"text-shadow-color":[{"text-shadow":Fe()}],opacity:[{opacity:[$r,bi,vi]}],"mix-blend":[{"mix-blend":[...Nn(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Nn()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[$r]}],"mask-image-linear-from-pos":[{"mask-linear-from":Yt()}],"mask-image-linear-to-pos":[{"mask-linear-to":Yt()}],"mask-image-linear-from-color":[{"mask-linear-from":Fe()}],"mask-image-linear-to-color":[{"mask-linear-to":Fe()}],"mask-image-t-from-pos":[{"mask-t-from":Yt()}],"mask-image-t-to-pos":[{"mask-t-to":Yt()}],"mask-image-t-from-color":[{"mask-t-from":Fe()}],"mask-image-t-to-color":[{"mask-t-to":Fe()}],"mask-image-r-from-pos":[{"mask-r-from":Yt()}],"mask-image-r-to-pos":[{"mask-r-to":Yt()}],"mask-image-r-from-color":[{"mask-r-from":Fe()}],"mask-image-r-to-color":[{"mask-r-to":Fe()}],"mask-image-b-from-pos":[{"mask-b-from":Yt()}],"mask-image-b-to-pos":[{"mask-b-to":Yt()}],"mask-image-b-from-color":[{"mask-b-from":Fe()}],"mask-image-b-to-color":[{"mask-b-to":Fe()}],"mask-image-l-from-pos":[{"mask-l-from":Yt()}],"mask-image-l-to-pos":[{"mask-l-to":Yt()}],"mask-image-l-from-color":[{"mask-l-from":Fe()}],"mask-image-l-to-color":[{"mask-l-to":Fe()}],"mask-image-x-from-pos":[{"mask-x-from":Yt()}],"mask-image-x-to-pos":[{"mask-x-to":Yt()}],"mask-image-x-from-color":[{"mask-x-from":Fe()}],"mask-image-x-to-color":[{"mask-x-to":Fe()}],"mask-image-y-from-pos":[{"mask-y-from":Yt()}],"mask-image-y-to-pos":[{"mask-y-to":Yt()}],"mask-image-y-from-color":[{"mask-y-from":Fe()}],"mask-image-y-to-color":[{"mask-y-to":Fe()}],"mask-image-radial":[{"mask-radial":[bi,vi]}],"mask-image-radial-from-pos":[{"mask-radial-from":Yt()}],"mask-image-radial-to-pos":[{"mask-radial-to":Yt()}],"mask-image-radial-from-color":[{"mask-radial-from":Fe()}],"mask-image-radial-to-color":[{"mask-radial-to":Fe()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":Re()}],"mask-image-conic-pos":[{"mask-conic":[$r]}],"mask-image-conic-from-pos":[{"mask-conic-from":Yt()}],"mask-image-conic-to-pos":[{"mask-conic-to":Yt()}],"mask-image-conic-from-color":[{"mask-conic-from":Fe()}],"mask-image-conic-to-color":[{"mask-conic-to":Fe()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:kt()}],"mask-repeat":[{mask:fn()}],"mask-size":[{mask:Me()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",bi,vi]}],filter:[{filter:["","none",bi,vi]}],blur:[{blur:On()}],brightness:[{brightness:[$r,bi,vi]}],contrast:[{contrast:[$r,bi,vi]}],"drop-shadow":[{"drop-shadow":["","none",ie,R1,C1]}],"drop-shadow-color":[{"drop-shadow":Fe()}],grayscale:[{grayscale:["",$r,bi,vi]}],"hue-rotate":[{"hue-rotate":[$r,bi,vi]}],invert:[{invert:["",$r,bi,vi]}],saturate:[{saturate:[$r,bi,vi]}],sepia:[{sepia:["",$r,bi,vi]}],"backdrop-filter":[{"backdrop-filter":["","none",bi,vi]}],"backdrop-blur":[{"backdrop-blur":On()}],"backdrop-brightness":[{"backdrop-brightness":[$r,bi,vi]}],"backdrop-contrast":[{"backdrop-contrast":[$r,bi,vi]}],"backdrop-grayscale":[{"backdrop-grayscale":["",$r,bi,vi]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[$r,bi,vi]}],"backdrop-invert":[{"backdrop-invert":["",$r,bi,vi]}],"backdrop-opacity":[{"backdrop-opacity":[$r,bi,vi]}],"backdrop-saturate":[{"backdrop-saturate":[$r,bi,vi]}],"backdrop-sepia":[{"backdrop-sepia":["",$r,bi,vi]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":$e()}],"border-spacing-x":[{"border-spacing-x":$e()}],"border-spacing-y":[{"border-spacing-y":$e()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",bi,vi]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[$r,"initial",bi,vi]}],ease:[{ease:["linear","initial",ge,bi,vi]}],delay:[{delay:[$r,bi,vi]}],animate:[{animate:["none",pe,bi,vi]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[ee,bi,vi]}],"perspective-origin":[{"perspective-origin":xe()}],rotate:[{rotate:An()}],"rotate-x":[{"rotate-x":An()}],"rotate-y":[{"rotate-y":An()}],"rotate-z":[{"rotate-z":An()}],scale:[{scale:In()}],"scale-x":[{"scale-x":In()}],"scale-y":[{"scale-y":In()}],"scale-z":[{"scale-z":In()}],"scale-3d":["scale-3d"],skew:[{skew:gi()}],"skew-x":[{"skew-x":gi()}],"skew-y":[{"skew-y":gi()}],transform:[{transform:[bi,vi,"","none","gpu","cpu"]}],"transform-origin":[{origin:xe()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:ji()}],"translate-x":[{"translate-x":ji()}],"translate-y":[{"translate-y":ji()}],"translate-z":[{"translate-z":ji()}],"translate-none":["translate-none"],accent:[{accent:Fe()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Fe()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",bi,vi]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":$e()}],"scroll-mx":[{"scroll-mx":$e()}],"scroll-my":[{"scroll-my":$e()}],"scroll-ms":[{"scroll-ms":$e()}],"scroll-me":[{"scroll-me":$e()}],"scroll-mt":[{"scroll-mt":$e()}],"scroll-mr":[{"scroll-mr":$e()}],"scroll-mb":[{"scroll-mb":$e()}],"scroll-ml":[{"scroll-ml":$e()}],"scroll-p":[{"scroll-p":$e()}],"scroll-px":[{"scroll-px":$e()}],"scroll-py":[{"scroll-py":$e()}],"scroll-ps":[{"scroll-ps":$e()}],"scroll-pe":[{"scroll-pe":$e()}],"scroll-pt":[{"scroll-pt":$e()}],"scroll-pr":[{"scroll-pr":$e()}],"scroll-pb":[{"scroll-pb":$e()}],"scroll-pl":[{"scroll-pl":$e()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",bi,vi]}],fill:[{fill:["none",...Fe()]}],"stroke-w":[{stroke:[$r,s0,w_,XT]}],stroke:[{stroke:["none",...Fe()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},S9=n9(w9);function xs(...t){return S9(eN(t))}function T9(t,i="en"){const c=typeof t=="string"?new Date(t):t;return new Intl.DateTimeFormat(i,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(c)}const E9=tH,TN=Z.forwardRef(({className:t,...i},c)=>C.jsx(ZL,{ref:c,className:xs("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...i}));TN.displayName=ZL.displayName;const A9=tN("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),EN=Z.forwardRef(({className:t,variant:i,...c},d)=>C.jsx(WL,{ref:d,className:xs(A9({variant:i}),t),...c}));EN.displayName=WL.displayName;const C9=Z.forwardRef(({className:t,...i},c)=>C.jsx(YL,{ref:c,className:xs("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...i}));C9.displayName=YL.displayName;const AN=Z.forwardRef(({className:t,...i},c)=>C.jsx(QL,{ref:c,className:xs("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...i,children:C.jsx(tS,{className:"h-4 w-4"})}));AN.displayName=QL.displayName;const CN=Z.forwardRef(({className:t,...i},c)=>C.jsx(XL,{ref:c,className:xs("text-sm font-semibold",t),...i}));CN.displayName=XL.displayName;const RN=Z.forwardRef(({className:t,...i},c)=>C.jsx(KL,{ref:c,className:xs("text-sm opacity-90",t),...i}));RN.displayName=KL.displayName;const R9=5,M9=5e3;let KT=0;function I9(){return KT=(KT+1)%Number.MAX_SAFE_INTEGER,KT.toString()}const YT=new Map,FD=t=>{if(YT.has(t))return;const i=setTimeout(()=>{YT.delete(t),f0({type:"REMOVE_TOAST",toastId:t})},M9);YT.set(t,i)},D9=(t,i)=>{switch(i.type){case"ADD_TOAST":return{...t,toasts:[i.toast,...t.toasts].slice(0,R9)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(c=>c.id===i.toast.id?{...c,...i.toast}:c)};case"DISMISS_TOAST":{const{toastId:c}=i;return c?FD(c):t.toasts.forEach(d=>{FD(d.id)}),{...t,toasts:t.toasts.map(d=>d.id===c||c===void 0?{...d,open:!1}:d)}}case"REMOVE_TOAST":return i.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(c=>c.id!==i.toastId)}}},Q1=[];let J1={toasts:[]};function f0(t){J1=D9(J1,t),Q1.forEach(i=>{i(J1)})}function yo({...t}){const i=I9(),c=y=>f0({type:"UPDATE_TOAST",toast:{...y,id:i}}),d=()=>f0({type:"DISMISS_TOAST",toastId:i});return f0({type:"ADD_TOAST",toast:{...t,id:i,open:!0,onOpenChange:y=>{y||d()}}}),{id:i,dismiss:d,update:c}}function Y_(){const[t,i]=Z.useState(J1);return Z.useEffect(()=>(Q1.push(i),()=>{const c=Q1.indexOf(i);c>-1&&Q1.splice(c,1)}),[t]),{...t,toast:yo,dismiss:c=>f0({type:"DISMISS_TOAST",toastId:c})}}function P9(){const{toasts:t}=Y_();return C.jsxs(E9,{children:[t.map(function({id:i,title:c,description:d,action:y,...w}){return C.jsxs(EN,{...w,children:[C.jsxs("div",{className:"grid gap-1",children:[c&&C.jsx(CN,{children:c}),d&&C.jsx(RN,{children:d})]}),y,C.jsx(AN,{})]},i)}),C.jsx(TN,{})]})}var O9=Symbol.for("react.lazy"),vw=HE[" use ".trim().toString()];function z9(t){return typeof t=="object"&&t!==null&&"then"in t}function MN(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===O9&&"_payload"in t&&z9(t._payload)}function IN(t){const i=N9(t),c=Z.forwardRef((d,y)=>{let{children:w,...E}=d;MN(w)&&typeof vw=="function"&&(w=vw(w._payload));const s=Z.Children.toArray(w),O=s.find(j9);if(O){const z=O.props.children,j=s.map(H=>H===O?Z.Children.count(z)>1?Z.Children.only(null):Z.isValidElement(z)?z.props.children:null:H);return C.jsx(i,{...E,ref:y,children:Z.isValidElement(z)?Z.cloneElement(z,void 0,j):null})}return C.jsx(i,{...E,ref:y,children:w})});return c.displayName=`${t}.Slot`,c}var L9=IN("Slot");function N9(t){const i=Z.forwardRef((c,d)=>{let{children:y,...w}=c;if(MN(y)&&typeof vw=="function"&&(y=vw(y._payload)),Z.isValidElement(y)){const E=B9(y),s=F9(w,y.props);return y.type!==Z.Fragment&&(s.ref=d?kx(d,E):E),Z.cloneElement(y,s)}return Z.Children.count(y)>1?Z.Children.only(null):null});return i.displayName=`${t}.SlotClone`,i}var k9=Symbol("radix.slottable");function j9(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===k9}function F9(t,i){const c={...i};for(const d in i){const y=t[d],w=i[d];/^on[A-Z]/.test(d)?y&&w?c[d]=(...s)=>{const O=w(...s);return y(...s),O}:y&&(c[d]=y):d==="style"?c[d]={...y,...w}:d==="className"&&(c[d]=[y,w].filter(Boolean).join(" "))}return{...t,...c}}function B9(t){let i=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=Object.getOwnPropertyDescriptor(t,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}const V9=tN("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:scale-[1.02] active:scale-[0.98]",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:scale-[1.02]",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:scale-[1.02]",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:scale-[1.02]",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-xl px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Un=Z.forwardRef(({className:t,variant:i,size:c,asChild:d=!1,...y},w)=>{const E=d?L9:"button";return C.jsx(E,{className:xs(V9({variant:i,size:c,className:t})),ref:w,...y})});Un.displayName="Button";const br=Z.forwardRef(({className:t,type:i,...c},d)=>C.jsx("input",{type:i,className:xs("flex h-10 w-full rounded-xl border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:d,...c}));br.displayName="Input";var U9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],$9=U9.reduce((t,i)=>{const c=IN(`Primitive.${i}`),d=Z.forwardRef((y,w)=>{const{asChild:E,...s}=y,O=E?c:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),C.jsx(O,{...s,ref:w})});return d.displayName=`Primitive.${i}`,{...t,[i]:d}},{}),G9="Label",DN=Z.forwardRef((t,i)=>C.jsx($9.label,{...t,ref:i,onMouseDown:c=>{c.target.closest("button, input, select, textarea")||(t.onMouseDown?.(c),!c.defaultPrevented&&c.detail>1&&c.preventDefault())}}));DN.displayName=G9;var PN=DN;const Zi=Z.forwardRef(({className:t,...i},c)=>C.jsx(PN,{ref:c,className:xs("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...i}));Zi.displayName=PN.displayName;const li=Z.forwardRef(({className:t,...i},c)=>C.jsx("div",{ref:c,className:xs("rounded-2xl border border-border bg-card text-card-foreground shadow-sm",t),...i}));li.displayName="Card";const zr=Z.forwardRef(({className:t,...i},c)=>C.jsx("div",{ref:c,className:xs("flex flex-col space-y-1.5 p-6",t),...i}));zr.displayName="CardHeader";const ys=Z.forwardRef(({className:t,...i},c)=>C.jsx("h3",{ref:c,className:xs("text-2xl font-semibold leading-none tracking-tight",t),...i}));ys.displayName="CardTitle";const ON=Z.forwardRef(({className:t,...i},c)=>C.jsx("p",{ref:c,className:xs("text-sm text-muted-foreground",t),...i}));ON.displayName="CardDescription";const hi=Z.forwardRef(({className:t,...i},c)=>C.jsx("div",{ref:c,className:xs("p-6 pt-0",t),...i}));hi.displayName="CardContent";const H9=Z.forwardRef(({className:t,...i},c)=>C.jsx("div",{ref:c,className:xs("flex items-center p-6 pt-0",t),...i}));H9.displayName="CardFooter";const q9=()=>{const{t}=Lc(),{login:i,isAuthenticated:c}=Nx(),[d,y]=Z.useState(""),[w,E]=Z.useState(""),[s,O]=Z.useState(!1),[z,j]=Z.useState("");if(c)return C.jsx(E0,{to:"/dashboard",replace:!0});const H=async Y=>{Y.preventDefault(),j(""),O(!0);try{await i({email:d,password:w})}catch{j(t("auth.loginError"))}finally{O(!1)}};return C.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-teal-50 via-background to-orange-50 p-4",children:C.jsxs(li,{className:"w-full max-w-md",children:[C.jsxs(zr,{className:"space-y-1 text-center",children:[C.jsx("div",{className:"flex justify-center mb-4",children:C.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl flex items-center justify-center",children:C.jsx("span",{className:"text-white font-bold text-2xl",children:"SB"})})}),C.jsx(ys,{className:"text-3xl",children:t("auth.welcomeBack")}),C.jsx(ON,{children:t("auth.loginSubtitle")})]}),C.jsx(hi,{children:C.jsxs("form",{onSubmit:H,className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"email",children:t("auth.email")}),C.jsx(br,{id:"email",type:"email",placeholder:"admin@smartbus.pk",value:d,onChange:Y=>y(Y.target.value),required:!0,disabled:s})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"password",children:t("auth.password")}),C.jsx(br,{id:"password",type:"password",placeholder:"",value:w,onChange:Y=>E(Y.target.value),required:!0,disabled:s})]}),z&&C.jsx("div",{className:"text-sm text-destructive bg-destructive/10 px-3 py-2 rounded-lg",children:z}),C.jsx(Un,{type:"submit",className:"w-full",disabled:s,children:t(s?"auth.loggingIn":"auth.login")})]})})]})})};var ew={exports:{}},Z9=ew.exports,BD;function W9(){return BD||(BD=1,(function(t,i){(function(c,d){t.exports=d()})(Z9,(function(){var c,d,y;function w(s,O){if(!c)c=O;else if(!d)d=O;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",j={};c(j),y=O(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}w(["exports"],(function(s){var O=1e-6,z=typeof Float32Array<"u"?Float32Array:Array;function j(o,e){var r=e[0],l=e[1],h=e[2],m=e[3],_=r*m-h*l;return _?(o[0]=m*(_=1/_),o[1]=-l*_,o[2]=-h*_,o[3]=r*_,o):null}function H(){var o=new z(9);return z!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Y(o,e){var r=e[0],l=e[1],h=e[2],m=e[3],_=e[4],v=e[5],A=e[6],R=e[7],P=e[8];return o[0]=_*P-v*R,o[1]=h*R-l*P,o[2]=l*v-h*_,o[3]=v*A-m*P,o[4]=r*P-h*A,o[5]=h*m-r*v,o[6]=m*R-_*A,o[7]=l*A-r*R,o[8]=r*_-l*m,o}function ie(o,e,r){var l=e[0],h=e[1],m=e[2],_=e[3],v=e[4],A=e[5],R=e[6],P=e[7],L=e[8],N=r[0],U=r[1],$=r[2],X=r[3],Q=r[4],te=r[5],ce=r[6],he=r[7],me=r[8];return o[0]=N*l+U*_+$*R,o[1]=N*h+U*v+$*P,o[2]=N*m+U*A+$*L,o[3]=X*l+Q*_+te*R,o[4]=X*h+Q*v+te*P,o[5]=X*m+Q*A+te*L,o[6]=ce*l+he*_+me*R,o[7]=ce*h+he*v+me*P,o[8]=ce*m+he*A+me*L,o}function oe(){var o=new z(16);return z!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function ee(o){var e=new z(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e}function le(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ge(o,e){var r=e[0],l=e[1],h=e[2],m=e[3],_=e[4],v=e[5],A=e[6],R=e[7],P=e[8],L=e[9],N=e[10],U=e[11],$=e[12],X=e[13],Q=e[14],te=e[15],ce=r*v-l*_,he=r*A-h*_,me=r*R-m*_,Ie=l*A-h*v,Ee=l*R-m*v,Ne=h*R-m*A,Be=P*X-L*$,Ue=P*Q-N*$,ft=P*te-U*$,Qe=L*Q-N*X,mt=L*te-U*X,wt=N*te-U*Q,Dt=ce*wt-he*mt+me*Qe+Ie*ft-Ee*Ue+Ne*Be;return Dt?(o[0]=(v*wt-A*mt+R*Qe)*(Dt=1/Dt),o[1]=(h*mt-l*wt-m*Qe)*Dt,o[2]=(X*Ne-Q*Ee+te*Ie)*Dt,o[3]=(N*Ee-L*Ne-U*Ie)*Dt,o[4]=(A*ft-_*wt-R*Ue)*Dt,o[5]=(r*wt-h*ft+m*Ue)*Dt,o[6]=(Q*me-$*Ne-te*he)*Dt,o[7]=(P*Ne-N*me+U*he)*Dt,o[8]=(_*mt-v*ft+R*Be)*Dt,o[9]=(l*ft-r*mt-m*Be)*Dt,o[10]=($*Ee-X*me+te*ce)*Dt,o[11]=(L*me-P*Ee-U*ce)*Dt,o[12]=(v*Ue-_*Qe-A*Be)*Dt,o[13]=(r*Qe-l*Ue+h*Be)*Dt,o[14]=(X*he-$*Ie-Q*ce)*Dt,o[15]=(P*Ie-L*he+N*ce)*Dt,o):null}function pe(o,e,r){var l=e[0],h=e[1],m=e[2],_=e[3],v=e[4],A=e[5],R=e[6],P=e[7],L=e[8],N=e[9],U=e[10],$=e[11],X=e[12],Q=e[13],te=e[14],ce=e[15],he=r[0],me=r[1],Ie=r[2],Ee=r[3];return o[0]=he*l+me*v+Ie*L+Ee*X,o[1]=he*h+me*A+Ie*N+Ee*Q,o[2]=he*m+me*R+Ie*U+Ee*te,o[3]=he*_+me*P+Ie*$+Ee*ce,o[4]=(he=r[4])*l+(me=r[5])*v+(Ie=r[6])*L+(Ee=r[7])*X,o[5]=he*h+me*A+Ie*N+Ee*Q,o[6]=he*m+me*R+Ie*U+Ee*te,o[7]=he*_+me*P+Ie*$+Ee*ce,o[8]=(he=r[8])*l+(me=r[9])*v+(Ie=r[10])*L+(Ee=r[11])*X,o[9]=he*h+me*A+Ie*N+Ee*Q,o[10]=he*m+me*R+Ie*U+Ee*te,o[11]=he*_+me*P+Ie*$+Ee*ce,o[12]=(he=r[12])*l+(me=r[13])*v+(Ie=r[14])*L+(Ee=r[15])*X,o[13]=he*h+me*A+Ie*N+Ee*Q,o[14]=he*m+me*R+Ie*U+Ee*te,o[15]=he*_+me*P+Ie*$+Ee*ce,o}function _e(o,e,r){var l,h,m,_,v,A,R,P,L,N,U,$,X=r[0],Q=r[1],te=r[2];return e===o?(o[12]=e[0]*X+e[4]*Q+e[8]*te+e[12],o[13]=e[1]*X+e[5]*Q+e[9]*te+e[13],o[14]=e[2]*X+e[6]*Q+e[10]*te+e[14],o[15]=e[3]*X+e[7]*Q+e[11]*te+e[15]):(h=e[1],m=e[2],_=e[3],v=e[4],A=e[5],R=e[6],P=e[7],L=e[8],N=e[9],U=e[10],$=e[11],o[0]=l=e[0],o[1]=h,o[2]=m,o[3]=_,o[4]=v,o[5]=A,o[6]=R,o[7]=P,o[8]=L,o[9]=N,o[10]=U,o[11]=$,o[12]=l*X+v*Q+L*te+e[12],o[13]=h*X+A*Q+N*te+e[13],o[14]=m*X+R*Q+U*te+e[14],o[15]=_*X+P*Q+$*te+e[15]),o}function Re(o,e,r){var l=r[0],h=r[1],m=r[2];return o[0]=e[0]*l,o[1]=e[1]*l,o[2]=e[2]*l,o[3]=e[3]*l,o[4]=e[4]*h,o[5]=e[5]*h,o[6]=e[6]*h,o[7]=e[7]*h,o[8]=e[8]*m,o[9]=e[9]*m,o[10]=e[10]*m,o[11]=e[11]*m,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function xe(o,e,r){var l=Math.sin(r),h=Math.cos(r),m=e[4],_=e[5],v=e[6],A=e[7],R=e[8],P=e[9],L=e[10],N=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=m*h+R*l,o[5]=_*h+P*l,o[6]=v*h+L*l,o[7]=A*h+N*l,o[8]=R*h-m*l,o[9]=P*h-_*l,o[10]=L*h-v*l,o[11]=N*h-A*l,o}function Ze(o,e,r){var l=Math.sin(r),h=Math.cos(r),m=e[0],_=e[1],v=e[2],A=e[3],R=e[8],P=e[9],L=e[10],N=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=m*h-R*l,o[1]=_*h-P*l,o[2]=v*h-L*l,o[3]=A*h-N*l,o[8]=m*l+R*h,o[9]=_*l+P*h,o[10]=v*l+L*h,o[11]=A*l+N*h,o}function Le(o,e,r){var l=Math.sin(r),h=Math.cos(r),m=e[0],_=e[1],v=e[2],A=e[3],R=e[4],P=e[5],L=e[6],N=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=m*h+R*l,o[1]=_*h+P*l,o[2]=v*h+L*l,o[3]=A*h+N*l,o[4]=R*h-m*l,o[5]=P*h-_*l,o[6]=L*h-v*l,o[7]=N*h-A*l,o}function $e(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function st(o,e,r){var l,h,m,_=r[0],v=r[1],A=r[2],R=Math.sqrt(_*_+v*v+A*A);return R<O?null:(_*=R=1/R,v*=R,A*=R,l=Math.sin(e),h=Math.cos(e),o[0]=_*_*(m=1-h)+h,o[1]=v*_*m+A*l,o[2]=A*_*m-v*l,o[3]=0,o[4]=_*v*m-A*l,o[5]=v*v*m+h,o[6]=A*v*m+_*l,o[7]=0,o[8]=_*A*m+v*l,o[9]=v*A*m-_*l,o[10]=A*A*m+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function Et(o,e){var r=e[0],l=e[1],h=e[2],m=e[4],_=e[5],v=e[6],A=e[8],R=e[9],P=e[10];return o[0]=Math.sqrt(r*r+l*l+h*h),o[1]=Math.sqrt(m*m+_*_+v*v),o[2]=Math.sqrt(A*A+R*R+P*P),o}function Ut(o,e){var r=e[0],l=e[1],h=e[2],m=e[3],_=r+r,v=l+l,A=h+h,R=r*_,P=l*_,L=l*v,N=h*_,U=h*v,$=h*A,X=m*_,Q=m*v,te=m*A;return o[0]=1-L-$,o[1]=P+te,o[2]=N-Q,o[3]=0,o[4]=P-te,o[5]=1-R-$,o[6]=U+X,o[7]=0,o[8]=N+Q,o[9]=U-X,o[10]=1-R-L,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}var $t=pe;function tt(){var o=new z(3);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function ut(o){var e=new z(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function on(o){var e=o[0],r=o[1],l=o[2];return Math.sqrt(e*e+r*r+l*l)}function Ke(o,e,r){var l=new z(3);return l[0]=o,l[1]=e,l[2]=r,l}function ze(o,e,r,l){return o[0]=e,o[1]=r,o[2]=l,o}function Fe(o,e,r){return o[0]=e[0]+r[0],o[1]=e[1]+r[1],o[2]=e[2]+r[2],o}function kt(o,e,r){return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],o}function fn(o,e,r){return o[0]=e[0]*r[0],o[1]=e[1]*r[1],o[2]=e[2]*r[2],o}function Me(o,e,r){return o[0]=Math.min(e[0],r[0]),o[1]=Math.min(e[1],r[1]),o[2]=Math.min(e[2],r[2]),o}function ct(o,e,r){return o[0]=Math.max(e[0],r[0]),o[1]=Math.max(e[1],r[1]),o[2]=Math.max(e[2],r[2]),o}function vt(o,e,r){return o[0]=e[0]*r,o[1]=e[1]*r,o[2]=e[2]*r,o}function Kt(o,e,r,l){return o[0]=e[0]+r[0]*l,o[1]=e[1]+r[1]*l,o[2]=e[2]+r[2]*l,o}function zn(o,e){var r=e[0]-o[0],l=e[1]-o[1],h=e[2]-o[2];return Math.sqrt(r*r+l*l+h*h)}function Nn(o,e){var r=e[0]-o[0],l=e[1]-o[1],h=e[2]-o[2];return r*r+l*l+h*h}function Yt(o){var e=o[0],r=o[1],l=o[2];return e*e+r*r+l*l}function On(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function An(o,e){var r=e[0],l=e[1],h=e[2],m=r*r+l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),o[0]=e[0]*m,o[1]=e[1]*m,o[2]=e[2]*m,o}function In(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function gi(o,e,r){var l=e[0],h=e[1],m=e[2],_=r[0],v=r[1],A=r[2];return o[0]=h*A-m*v,o[1]=m*_-l*A,o[2]=l*v-h*_,o}function ji(o,e,r,l){var h=e[0],m=e[1],_=e[2];return o[0]=h+l*(r[0]-h),o[1]=m+l*(r[1]-m),o[2]=_+l*(r[2]-_),o}function Ri(o,e,r){var l=e[0],h=e[1],m=e[2],_=r[3]*l+r[7]*h+r[11]*m+r[15];return o[0]=(r[0]*l+r[4]*h+r[8]*m+r[12])/(_=_||1),o[1]=(r[1]*l+r[5]*h+r[9]*m+r[13])/_,o[2]=(r[2]*l+r[6]*h+r[10]*m+r[14])/_,o}function Rr(o,e,r){var l=e[0],h=e[1],m=e[2];return o[0]=l*r[0]+h*r[3]+m*r[6],o[1]=l*r[1]+h*r[4]+m*r[7],o[2]=l*r[2]+h*r[5]+m*r[8],o}function cs(o,e,r){var l=r[0],h=r[1],m=r[2],_=r[3],v=e[0],A=e[1],R=e[2],P=h*R-m*A,L=m*v-l*R,N=l*A-h*v;return o[0]=v+_*(P+=P)+h*(N+=N)-m*(L+=L),o[1]=A+_*L+m*P-l*N,o[2]=R+_*N+l*L-h*P,o}function wr(o){return o[0]=0,o[1]=0,o[2]=0,o}function jn(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var ti=kt,rr=fn,et=on;function Ot(){var o=new z(4);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function nn(o,e,r){return o[0]=e[0]*r,o[1]=e[1]*r,o[2]=e[2]*r,o[3]=e[3]*r,o}function Kn(o,e){var r=e[0],l=e[1],h=e[2],m=e[3],_=r*r+l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),o[0]=r*_,o[1]=l*_,o[2]=h*_,o[3]=m*_,o}function yn(o,e,r){var l=e[0],h=e[1],m=e[2],_=e[3];return o[0]=r[0]*l+r[4]*h+r[8]*m+r[12]*_,o[1]=r[1]*l+r[5]*h+r[9]*m+r[13]*_,o[2]=r[2]*l+r[6]*h+r[10]*m+r[14]*_,o[3]=r[3]*l+r[7]*h+r[11]*m+r[15]*_,o}function Dn(){var o=new z(4);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function ci(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Yi(o,e,r){r*=.5;var l=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(r),A=Math.cos(r);return o[0]=l*A+_*v,o[1]=h*A+m*v,o[2]=m*A-h*v,o[3]=_*A-l*v,o}function or(o,e,r){r*=.5;var l=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(r),A=Math.cos(r);return o[0]=l*A-m*v,o[1]=h*A+_*v,o[2]=m*A+l*v,o[3]=_*A-h*v,o}tt(),Ot();var Gr,ea,vs,Ol=Kn,ta=(Gr=tt(),ea=Ke(1,0,0),vs=Ke(0,1,0),function(o,e,r){var l=In(e,r);return l<-.999999?(gi(Gr,ea,e),et(Gr)<1e-6&&gi(Gr,vs,e),An(Gr,Gr),(function(h,m,_){_*=.5;var v=Math.sin(_);h[0]=v*m[0],h[1]=v*m[1],h[2]=v*m[2],h[3]=Math.cos(_)})(o,Gr,Math.PI),o):l>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(gi(Gr,e,r),o[0]=Gr[0],o[1]=Gr[1],o[2]=Gr[2],o[3]=1+l,Ol(o,o))});function dr(){var o=new z(2);return z!=Float32Array&&(o[0]=0,o[1]=0),o}function lo(o,e){var r=new z(2);return r[0]=o,r[1]=e,r}function Os(o,e,r){return o[0]=e,o[1]=r,o}function Za(o,e,r){return o[0]=e[0]+r[0],o[1]=e[1]+r[1],o}function Go(o,e,r){return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o}function Ia(o,e,r){return o[0]=e[0]*r,o[1]=e[1]*r,o}function Mr(o){var e=o[0],r=o[1];return Math.sqrt(e*e+r*r)}function js(o,e){var r=e[0],l=e[1],h=r*r+l*l;return h>0&&(h=1/Math.sqrt(h)),o[0]=e[0]*h,o[1]=e[1]*h,o}function Cs(o,e){return o[0]*e[0]+o[1]*e[1]}Dn(),Dn(),H();var bs,us,Ho=Go;function Do(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}dr();var Po=(function(){if(us)return bs;function o(e,r,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=h}return us=1,bs=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<r)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=m/_}var v=0,A=1;for(l=e,h=0;h<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<r));h++)e>m?v=l:A=l,l=.5*(A-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},bs})(),wo=Do(Po);function Ct(o,e){this.x=o,this.y=e}function Rs(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(!Rs(o[r],e[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const r in o)if(!Rs(o[r],e[r]))return!1;return!0}return o===e}Ct.prototype={clone(){return new Ct(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,r=o.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),r=Math.sin(o),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround(o,e){const r=Math.cos(o),l=Math.sin(o),h=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ct},Ct.convert=function(o){if(o instanceof Ct)return o;if(Array.isArray(o))return new Ct(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Ct(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const ga=Math.PI/180,qo=180/Math.PI;function fi(o){return o*ga}function Ds(o){return o*qo}const zl=[[0,0],[1,0],[1,1],[0,1]];function _a(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,r=e*o;return 4*(o<.5?r:3*(o-e)+r-.75)}function We(o,e,r,l){const h=new wo(o,e,r,l);return function(m){return h.solve(m)}}const ne=We(.25,.1,.25,1);function se(o,e,r){return Math.min(r,Math.max(e,o))}function ve(o,e,r){return(r=se((r-o)/(e-o),0,1))*r*(3-2*r)}function je(o,e,r){const l=r-e,h=((o-e)%l+l)%l+e;return h===e?r:h}function ke(o,e,r){if(!o.length)return r(null,[]);let l=o.length;const h=new Array(o.length);let m=null;o.forEach(((_,v)=>{e(_,((A,R)=>{A&&(m=A),h[v]=R,--l==0&&r(m,h)}))}))}let He=1;function at(){return He++}function qe(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log2(o)))}function nt(o,e){o.forEach((r=>{e[r]&&(e[r]=e[r].bind(e))}))}function Bt(o,e,r){const l={};for(const h in o)l[h]=e.call(this,o[h],h,o);return l}function It(o,e,r){const l={};for(const h in o)e.call(this,o[h],h,o)&&(l[h]=o[h]);return l}function vn(o){return Array.isArray(o)?o.map(vn):typeof o=="object"&&o?Bt(o,vn):o}function $n(o,e){for(let r=0;r<o.length;r++)if(e.indexOf(o[r])>=0)return!0;return!1}const Bn={};function Tn(o){Bn[o]||(typeof console<"u"&&console.warn(o),Bn[o]=!0)}function pi(o,e,r){return(r.y-o.y)*(e.x-o.x)>(e.y-o.y)*(r.x-o.x)}function _i(o){let e=0;for(let r,l,h=0,m=o.length,_=m-1;h<m;_=h++)r=o[h],l=o[_],e+=(l.x-r.x)*(r.y+l.y);return e}function Hi([o,e,r]){const l=fi(e+90),h=fi(r);return{x:o*Math.cos(l)*Math.sin(h),y:o*Math.sin(l)*Math.sin(h),z:o*Math.cos(h),azimuthal:e,polar:r}}function Lr(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function Ps(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,l,h,m)=>{const _=h||m;return e[l]=!_||_.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let gs=null;function ds(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function ar(o,e,r,l){for(;e<r;){const h=e+r>>1;o[h]<l?e=h+1:r=h}return e}function Ei(o,e,r,l){for(;e<r;){const h=e+r>>1;o[h]<=l?e=h+1:r=h}return e}function Sr(o){return o>0?1/(1.001-o):1+o}function mr(o){return o>0?1-1/(1.001-o):-o}function Oi(o,e,r){return(o-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const Ir={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ir.API_URL)return null;try{const o=new URL(Ir.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Fs(o){return Ir.API_URL_REGEX.test(o)}function So(o){return Ir.API_SPRITE_REGEX.test(o)}let Wa,nc,Xs,Bs,Oo,ul;function na(){return Wa==null&&(Wa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Wa}const To={now:()=>Bs!==void 0?Bs:performance.now(),setNow(o){Bs=o},restoreNow(){Bs=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:r,height:l}=o;Oo||(Oo=document.createElement("canvas"));const h=Oo.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(r>Oo.width||l>Oo.height)&&(Oo.width=r,Oo.height=l),h.clearRect(-e,-e,r+2*e,l+2*e),h.drawImage(o,0,0,r,l),h.getImageData(-e,-e,r+2*e,l+2*e)},resolveURL:o=>(nc||(nc=document.createElement("a")),nc.href=o,nc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xs==null&&(Xs=window.matchMedia("(prefers-reduced-motion: reduce)")),Xs.matches)},hasCanvasFingerprintNoise(){if(ul!==void 0)return ul;if(!na())return ul=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let r=0;for(let h=0;h<o.width;++h)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(h,0,1,1);const l=e.getImageData(0,0,o.width,o.height);r=0;for(let h=0;h<l.data.length;++h)if(h%4!=3&&r++!==l.data[h])return ul=!0,!0;return ul=!1,!1}};function Rf(o,e){const r=o.indexOf("?");if(r<0)return`${o}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(o.slice(r));for(const h in e)l.set(h,e[h]);return`${o.slice(0,r)}?${l.toString()}`}function yh(o,e={persistentParams:[]}){const r=o.indexOf("?");if(r<0)return o;const l=new URLSearchParams,h=new URLSearchParams(o.slice(r));for(const _ of e.persistentParams){const v=h.get(_);v&&l.set(_,v)}const m=l.toString();return`${o.slice(0,r)}${m.length>0?`?${m}`:""}`}const ic="mapbox-tiles";let Mf=500,ia=50;const dl=["language","worldview","jobid"];let zo,Xa;function jc(){try{return caches}catch{}}function rc(){const o=jc();o&&zo==null&&(zo=o.open(ic))}let hl=1/0;const xh={supported:!1,testSupport:function(o){!mu&&Ka&&(gg?jp(o):fl=o)}};let fl,Ka,mu=!1,gg=!1;const Da=typeof self<"u"?self:{};function jp(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Ka),o.isContextLost())return;xh.supported=!0}catch{}o.deleteTexture(e),mu=!0}Da.document&&(Ka=Da.document.createElement("img"),Ka.onload=function(){fl&&jp(fl),fl=null,gg=!0},Ka.onerror=function(){mu=!0,fl=null},Ka.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ll={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ll);class ya extends Error{constructor(e,r,l){r===401&&Fs(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const If=Lr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Fc=function(o,e){if(!(/^file:/.test(r=o.url)||/^file:/.test(If())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(l,h){const m=new AbortController,_=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:If(),referrerPolicy:l.referrerPolicy,signal:m.signal});let v=!1,A=!1;const R=(P=_.url).indexOf("sku=")>0&&Fs(P);var P;l.type==="json"&&_.headers.set("Accept","application/json");const L=(U,$,X)=>{if(A)return;if(U&&U.message!=="SecurityError"&&Tn(U.toString()),$&&X)return N($);const Q=Date.now();fetch(_).then((te=>{if(te.ok){const ce=R?te.clone():null;return N(te,ce,Q)}return h(new ya(te.statusText,te.status,l.url))})).catch((te=>{te.name!=="AbortError"&&h(new Error(`${te.message} ${l.url}`))}))},N=(U,$,X)=>{(l.type==="arrayBuffer"?U.arrayBuffer():l.type==="json"?U.json():U.text()).then((Q=>{A||($&&X&&(function(te,ce,he){if(rc(),zo==null)return;const me=Ps(ce.headers.get("Cache-Control")||"");if(me["no-store"])return;const Ie={status:ce.status,statusText:ce.statusText,headers:new Headers};ce.headers.forEach(((Be,Ue)=>Ie.headers.set(Ue,Be))),me["max-age"]&&Ie.headers.set("Expires",new Date(he+1e3*me["max-age"]).toUTCString());const Ee=Ie.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-he<42e4)return;let Ne=yh(te.url,{persistentParams:dl});if(ce.status===206){const Be=te.headers.get("Range");if(!Be)return;Ie.status=200,Ne=Rf(Ne,{range:Be})}(function(Be,Ue){if(Xa===void 0)try{new Response(new ReadableStream),Xa=!0}catch{Xa=!1}Xa?Ue(Be.body):Be.blob().then(Ue).catch((ft=>Tn(ft.message)))})(ce,(Be=>{const Ue=new Response((ft=ce.status)!==200&&ft!==404&&[101,103,204,205,304].includes(ft)?null:Be,Ie);var ft;rc(),zo?.then((Qe=>Qe.put(Ne,Ue))).catch((Qe=>Tn(Qe.message)))}))})(_,$,X),v=!0,h(null,Q,U.headers))})).catch((Q=>{A||h(new Error(Q.message))}))};return R?(function(U,$){if(rc(),zo==null)return $(null);zo.then((X=>{let Q=yh(U.url,{persistentParams:dl});const te=U.headers.get("Range");te&&(Q=Rf(Q,{range:te})),X.match(Q).then((ce=>{const he=(function(me){if(!me)return!1;const Ie=new Date(me.headers.get("Expires")||0),Ee=Ps(me.headers.get("Cache-Control")||"");return Number(Ie)>Date.now()&&!Ee["no-cache"]})(ce);X.delete(Q).catch($),he&&X.put(Q,ce.clone()).catch($),$(null,ce,he)})).catch($)})).catch($)})(_,L):L(null,null),{cancel:()=>{A=!0,v||m.abort()}}})(o,e);if(Lr(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var r;return(function(l,h){const m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(l.type==="json")try{_=JSON.parse(m.response)}catch(A){return h(A)}const v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((A=>{const R=A.split(": "),P=R.shift(),L=R.join(": ");v.append(P,L)})),h(null,_,v)}else h(new ya(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}})(o,e)},Ya=function(o,e){return Fc(Object.assign(o,{type:"arrayBuffer"}),e)};function Fi(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const vh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bh,gu;bh=[],gu=0;const wh=function(o,e){if(xh.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),gu>=Ir.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bh.push(m),m}gu++;let r=!1;const l=()=>{if(!r)for(r=!0,gu--;bh.length&&gu<Ir.MAX_PARALLEL_IMAGE_REQUESTS;){const m=bh.shift(),{requestParameters:_,callback:v,cancelled:A}=m;A||(m.cancel=wh(_,v).cancel)}},h=Ya(o,((m,_,v)=>{l(),m?e(m):_&&(self.createImageBitmap?(function(A,R){const P=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(P).then((L=>{R(null,L)})).catch((L=>{R(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((A,R)=>e(A,R,v))):(function(A,R){const P=new Image;P.onload=()=>{R(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame((()=>{P.src=vh}))},P.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(A)],{type:"image/png"});P.src=A.byteLength?URL.createObjectURL(L):vh})(_,((A,R)=>e(A,R,v))))}));return{cancel:()=>{h.cancel(),l()}}};var Sh,Lo,Nl,sc={exports:{}},Th={exports:{}},Fp={exports:{}},_g=(function(){if(Nl)return sc.exports;Nl=1;var o=(Sh||(Sh=1,Th.exports=function(r,l){var h,m,_,v,A,R,P,L;for(m=r.length-(h=3&r.length),_=l,A=3432918353,R=461845907,L=0;L<m;)P=255&r.charCodeAt(L)|(255&r.charCodeAt(++L))<<8|(255&r.charCodeAt(++L))<<16|(255&r.charCodeAt(++L))<<24,++L,_=27492+(65535&(v=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*R+(((P>>>16)*R&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&r.charCodeAt(L+2))<<16;case 2:P^=(255&r.charCodeAt(L+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&r.charCodeAt(L)))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*R+(((P>>>16)*R&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Th.exports),e=(Lo||(Lo=1,Fp.exports=function(r,l){for(var h,m=r.length,_=l^m,v=0;m>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:_^=(255&r.charCodeAt(v+2))<<16;case 2:_^=(255&r.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Fp.exports);return sc.exports=o,sc.exports.murmur3=o,sc.exports.murmur2=e,sc.exports})(),rd=Do(_g);class Zo{constructor(e,...r){Object.assign(this,r[0]||{}),this.type=e}}class _u extends Zo{constructor(e,r={}){super("error",Object.assign({error:e},r))}}function sd(o,e,r){r[o]&&r[o].indexOf(e)!==-1||(r[o]=r[o]||[],r[o].push(e))}function Df(o,e,r){if(r&&r[o]){const l=r[o].indexOf(e);l!==-1&&r[o].splice(l,1)}}class Bc{on(e,r){return this._listeners=this._listeners||{},sd(e,r,this._listeners),this}off(e,r){return Df(e,r,this._listeners),Df(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},sd(e,r,this._oneTimeListeners),this):new Promise((l=>{this.once(e,l)}))}fire(e,r){const l=typeof e=="string"?new Zo(e,r):e,h=l.type;if(this.listens(h)){l.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of m)A.call(this,l);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of _)Df(h,A,this._oneTimeListeners),A.call(this,l);const v=this._eventedParent;if(v){const A=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(l,A),v.fire(l)}}else l instanceof _u&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class Vs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Vs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,l]=e.split("");return new Vs({name:r,iconsetId:l})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return Vs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Pf,yg={},xg=(function(){if(Pf)return yg;Pf=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function r(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function l(m){return(_=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:_>1?1:_;var _}function h(m,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(_-m)*v*6:2*v<1?_:3*v<2?m+(_-m)*(2/3-v)*6:m}try{yg.parseCSSColor=function(m){var _,v=m.replace(/ /g,"").toLowerCase();if(v in o)return o[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var A=v.indexOf("("),R=v.indexOf(")");if(A!==-1&&R+1===v.length){var P=v.substr(0,A),L=v.substr(A+1,R-(A+1)).split(","),N=1;switch(P){case"rgba":if(L.length!==4)return null;N=l(L.pop());case"rgb":return L.length!==3?null:[r(L[0]),r(L[1]),r(L[2]),N];case"hsla":if(L.length!==4)return null;N=l(L.pop());case"hsl":if(L.length!==3)return null;var U=(parseFloat(L[0])%360+360)%360/360,$=l(L[1]),X=l(L[2]),Q=X<=.5?X*($+1):X+$-X*$,te=2*X-Q;return[e(255*h(te,Q,U+1/3)),e(255*h(te,Q,U)),e(255*h(te,Q,U-1/3)),N];default:return null}}return null}}catch{}return yg})();class nr{constructor(e,r,l,h=1){this.r=e,this.g=r,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof nr)return e;if(typeof e!="string")return;const r=xg.parseCSSColor(e);return r?new nr(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[e,r,l,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*l)},${h})`}toNonPremultipliedRenderColor(e){const{r,g:l,b:h,a:m}=this;return new ey(e,r,l,h,m)}toPremultipliedRenderColor(e){const{r,g:l,b:h,a:m}=this;return new bg(e,r*m,l*m,h*m,m)}clone(){return new nr(this.r,this.g,this.b,this.a)}}class vg{constructor(e,r,l,h,m,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const v=e.image.height,A=v*v;this.premultiplied?(r=m===0?0:r/m*(v-1),l=m===0?0:l/m*(v-1),h=m===0?0:h/m*(v-1)):(r*=v-1,l*=v-1,h*=v-1);const R=Math.floor(r),P=Math.floor(l),L=Math.floor(h),N=Math.ceil(r),U=Math.ceil(l),$=Math.ceil(h),X=r-R,Q=l-P,te=h-L,ce=e.image.data,he=4*(R+P*A+L*v),me=4*(R+P*A+$*v),Ie=4*(R+U*A+L*v),Ee=4*(R+U*A+$*v),Ne=4*(N+P*A+L*v),Be=4*(N+P*A+$*v),Ue=4*(N+U*A+L*v),ft=4*(N+U*A+$*v);if(he<0||ft>=ce.length)throw new Error("out of range");this.r=Gn(Gn(Gn(ce[he],ce[me],te),Gn(ce[Ie],ce[Ee],te),Q),Gn(Gn(ce[Ne],ce[Be],te),Gn(ce[Ue],ce[ft],te),Q),X)/255*(this.premultiplied?m:1),this.g=Gn(Gn(Gn(ce[he+1],ce[me+1],te),Gn(ce[Ie+1],ce[Ee+1],te),Q),Gn(Gn(ce[Ne+1],ce[Be+1],te),Gn(ce[Ue+1],ce[ft+1],te),Q),X)/255*(this.premultiplied?m:1),this.b=Gn(Gn(Gn(ce[he+2],ce[me+2],te),Gn(ce[Ie+2],ce[Ee+2],te),Q),Gn(Gn(ce[Ne+2],ce[Be+2],te),Gn(ce[Ue+2],ce[ft+2],te),Q),X)/255*(this.premultiplied?m:1),this.a=m}else this.r=r,this.g=l,this.b=h,this.a=m}toArray(){const{r:e,g:r,b:l,a:h}=this;return[255*e,255*r,255*l,h]}toHslaArray(){let{r:e,g:r,b:l,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const $=1/h;e*=$,r*=$,l*=$}const m=Math.min(Math.max(e,0),1),_=Math.min(Math.max(r,0),1),v=Math.min(Math.max(l,0),1),A=Math.min(m,_,v),R=Math.max(m,_,v),P=R-A,L=.5*(A+R);if(P===0)return[0,0,100*L,h];const N=L>.5?P/(2-R-A):P/(R+A);let U;switch(R){case m:U=60*((_-v)/P+(_<v?6:0));break;case _:U=60*((v-m)/P+2);break;default:U=60*((m-_)/P+4)}return[U,100*N,100*L,h]}toArray01(){const{r:e,g:r,b:l,a:h}=this;return[e,r,l,h]}toArray01Scaled(e){const{r,g:l,b:h}=this;return[r*e,l*e,h*e]}toArray01Linear(){const{r:e,g:r,b:l,a:h}=this;return[Math.pow(e,2.2),Math.pow(r,2.2),Math.pow(l,2.2),h]}}class ey extends vg{constructor(e,r,l,h,m){super(e,r,l,h,m,!1)}}class bg extends vg{constructor(e,r,l,h,m){super(e,r,l,h,m,!0)}}function Gn(o,e,r){return o*(1-r)+e*r}function Of(o,e,r){return o.map(((l,h)=>Gn(l,e[h],r)))}nr.black=new nr(0,0,0,1),nr.white=new nr(1,1,1,1),nr.transparent=new nr(0,0,0,0),nr.red=new nr(1,0,0,1),nr.blue=new nr(0,0,1,1);var Vc=Object.freeze({__proto__:null,array:Of,color:function(o,e,r){return new nr(Gn(o.r,e.r,r),Gn(o.g,e.g,r),Gn(o.b,e.b,r),Gn(o.a,e.a,r))},number:Gn});class pl extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Pa{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,h]of r)this.bindings[l]=h}concat(e){return new Pa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Eh={kind:"null"},Mn={kind:"number"},Bi={kind:"string"},Xi={kind:"boolean"},Oa={kind:"color"},Ah={kind:"object"},sr={kind:"value"},zf={kind:"collator"},od={kind:"formatted"},Lf={kind:"resolvedImage"};function co(o,e){return{kind:"array",itemType:o,N:e}}function zs(o){if(o.kind==="array"){const e=zs(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Yx=[Eh,Mn,Bi,Xi,Oa,od,Ah,co(sr),Lf];function ad(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ad(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const r of Yx)if(!ad(r,e))return null}}return`Expected ${zs(o)} but found ${zs(e)} instead.`}function ld(o,e){return e.some((r=>r.kind===o.kind))}function Nf(o,e){return e.some((r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o))}function kf(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&kf(o.itemType,e.itemType):o.kind===e.kind}class Bp{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ch{constructor(e,r,l,h,m){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=l,this.fontStack=h,this.textColor=m}}class Ks{constructor(e){this.sections=e}static fromString(e){return new Ks([new Ch(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof Ks?e:Ks.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const h=r.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(r.text);const l={};r.fontStack&&(l["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(l["font-scale"]=r.scale),r.textColor&&(l["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class oc{constructor(e,r={}){if(this.id=Vs.from(e),this.options=Object.assign({},r),r.transform){const{a:l,b:h,c:m,d:_,e:v,f:A}=r.transform;this.options.transform=new DOMMatrix([l,h,m,_,v,A])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:l,d:h,e:m,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:l,d:h,e:m,f:_}})}static parse(e){let r,l,h,m;try{({name:r,iconsetId:l,params:h,transform:m}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:_,b:v,c:A,d:R,e:P,f:L}=m||{};return new oc({name:r,iconsetId:l},{params:h,transform:new DOMMatrix([_,v,A,R,P,L])})}scaleSelf(e,r){return this.options.transform.scaleSelf(e,r),this}}class uo{constructor(e,r,l,h,m=!1){this.primaryId=Vs.from(e),this.primaryOptions=r,l&&(this.secondaryId=Vs.from(l)),this.secondaryOptions=h,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new oc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new oc(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?uo.build({name:e}):e}static build(e,r,l,h){return!e||typeof e=="object"&&!("name"in e)?null:new uo(e,l,r,h)}}function Vp(o,e,r,l){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,e,r,l]:[o,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rh(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof nr||o instanceof Bp||o instanceof Ks||o instanceof uo)return!0;if(Array.isArray(o)){for(const e of o)if(!Rh(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Rh(o[e]))return!1;return!0}return!1}function Ys(o){if(o===null)return Eh;if(typeof o=="string")return Bi;if(typeof o=="boolean")return Xi;if(typeof o=="number")return Mn;if(o instanceof nr)return Oa;if(o instanceof Bp)return zf;if(o instanceof Ks)return od;if(o instanceof uo)return Lf;if(Array.isArray(o)){const e=o.length;let r;for(const l of o){const h=Ys(l);if(r){if(r===h)continue;r=sr;break}r=h}return co(r||sr,e)}return Ah}function kl(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Ks||o instanceof uo||o instanceof nr?o.toString():JSON.stringify(o)}class ac{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Rh(e[1]))return r.error("invalid value");const l=e[1];let h=Ys(l);const m=r.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new ac(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof nr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ks?this.value.serialize():this.value}}class es{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const si={string:Bi,number:Mn,boolean:Xi,object:Ah};class wn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,h=1;const m=e[0];if(m==="array"){let v,A;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in si)||R==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=si[R],h++}else v=sr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);A=e[2],h++}l=co(v,A)}else l=si[m];const _=[];for(;h<e.length;h++){const v=r.parse(e[h],h,sr);if(!v)return null;_.push(v)}return new wn(l,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!ad(this.type,Ys(l)))return l;if(r===this.args.length-1)throw new es(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${zs(Ys(l))} but was expected to be of type ${zs(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){r.push(l.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&r.push(h)}}return r.concat(this.args.map((l=>l.serialize())))}}class lc{constructor(e){this.type=od,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let A=null;if(v["font-scale"]&&(A=r.parseObjectValue(v["font-scale"],_,"font-scale",Mn),!A))return null;let R=null;if(v["text-font"]&&(R=r.parseObjectValue(v["text-font"],_,"text-font",co(Bi)),!R))return null;let P=null;if(v["text-color"]&&(P=r.parseObjectValue(v["text-color"],_,"text-color",Oa),!P))return null;const L=h[h.length-1];L.scale=A,L.font=R,L.textColor=P}else{const A=r.parse(e[_],_,sr);if(!A)return null;const R=A.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:A,scale:null,font:null,textColor:null})}}return new lc(h)}evaluate(e){return new Ks(this.sections.map((r=>{const l=r.content.evaluate(e);return kf(Ys(l),Lf)?new Ch("",l,null,null,null):new Ch(kl(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const l={};r.scale&&(l["font-scale"]=r.scale.serialize()),r.font&&(l["text-font"]=r.font.serialize()),r.textColor&&(l["text-color"]=r.textColor.serialize()),e.push(l)}return e}}class Yn{constructor(e,r,l,h){this._imageWarnHistory={},this.type=Lf,this.namePrimary=e,this.nameSecondary=r,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let l=1;const h=[];function m(){if(l<e.length){const v=r.parse(e[l],l++,Bi);return v?(h.push({image:v,options:{}}),!0):(r.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(l<e.length){const A=e[l];if((v=A)===null||typeof v!="object"||Array.isArray(v))return!0;const R=A.params,P=A.iconset,L=r.concat(l);if(!R&&!P)return l++,!0;if(R){if(typeof R!="object"||R.constructor!==Object)return L.error('Image options "params" should be an object'),!1;const N={},U=L.concat(void 0,"params");for(const $ in R){if(!$)return U.error("Image parameter name should be non-empty"),!1;const X=U.concat(void 0,$).parse(R[$],void 0,Oa,void 0,{typeAnnotation:"coerce"});if(!X)return!1;N[$]=X}h[h.length-1].options.params=N}if(P){if(typeof P!="object"||P.constructor!==Object)return L.error('Image options "iconset" should be an object'),!1;if(!P.id)return L.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=P}return l++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!_())return;return new Yn(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,r){const l={};if(r){for(const h in r)if(r[h])try{l[h]=r[h].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=uo.build(r,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const m=h.getPrimary().id;if(h.available=e.availableImages.some((_=>Vs.isEqual(_,m))),h.available){const _=h.getSecondary()?h.getSecondary().id:null;_&&(h.available=e.availableImages.some((v=>Vs.isEqual(v,_))))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const l={};if(r&&(l.iconset={id:r}),e){l.params={};for(const h in e)e[h]&&(l.params[h]=e[h].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function cd(o){return Hn(o)?"string":Ih(o)?"number":jf(o)?"boolean":Array.isArray(o)?"array":o===null?"null":Mh(o)?"object":typeof o}function Mh(o){return o!=null&&!Array.isArray(o)&&typeof o!="function"&&!(o instanceof String||o instanceof Number||o instanceof Boolean)&&typeof o=="object"}function Hn(o){return typeof o=="string"||o instanceof String}function Ih(o){return typeof o=="number"||o instanceof Number}function jf(o){return typeof o=="boolean"||o instanceof Boolean}const wg={"to-boolean":Xi,"to-color":Oa,"to-number":Mn,"to-string":Bi};class cc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0],h=[];let m=Eh;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);m=co(r.expectedType.itemType,_)}else{if(!(_>0&&Rh(e[1][0])))return null;m=co(Ys(e[1][0]),_)}for(let v=0;v<_;v++){const A=e[1][v];let R;if(Array.isArray(A))R=r.parse(A,void 0,m.itemType);else{const P=cd(A);if(P!==m.itemType.kind)return r.error(`Expected ${m.itemType.kind} but found ${P}.`);R=r.registry.literal.parse(["literal",A===void 0?null:A],r)}if(!R)return null;h.push(R)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");m=wg[l];for(let _=1;_<e.length;_++){const v=r.parse(e[_],_,sr);if(!v)return null;h.push(v)}}return new cc(m,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,l;for(const h of this.args){if(r=h.evaluate(e),l=null,r instanceof nr)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Vp(r[0],r[1],r[2],r[3]),!l))return new nr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new es(l||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new es(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ks.fromString(kl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?uo.build(kl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((r=>r.evaluate(e))):kl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new lc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Yn(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((r=>{e.push(r.serialize())})),e}}const Up=["Unknown","Point","LineString","Polygon"];class ho{constructor(e,r,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r,this.iconImageUseTheme=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Up[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-e[0])+this.featureDistanceData.bearing[1]*(h*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=nr.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Wo{constructor(e,r,l,h,m){this.name=e,this.type=r,this._evaluate=l,this.args=h,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const r=Wo.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,r){const l=e[0],h=Wo.definitions[l];if(!h)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let A=null,R=-1;for(const[P,L]of _){if(Array.isArray(P)&&P.length!==e.length-1)continue;v.push(P),R++,A=new Hf(r.registry,r.path,null,r.scope,void 0,r._scope,r.options,r.iconImageUseTheme);const N=[];let U=!1;for(let $=1;$<e.length;$++){const X=e[$],Q=Array.isArray(P)?P[$-1]:P.type,te=A.parse(X,1+N.length,Q);if(!te){U=!0;break}N.push(te)}if(!U)if(Array.isArray(P)&&P.length!==N.length)A.error(`Expected ${P.length} arguments, but found ${N.length} instead.`);else{for(let $=0;$<N.length;$++){const X=Array.isArray(P)?P[$]:P.type,Q=N[$];A.concat($+1).checkSubtype(X,Q.type)}if(A.errors.length===0)return new Wo(l,m,L,N,R)}}if(v.length===1)r.errors.push(...A.errors);else{const P=(v.length?v:_.map((([N])=>N))).map(ud).join(" | "),L=[];for(let N=1;N<e.length;N++){const U=r.parse(e[N],1+L.length);if(!U)return null;L.push(zs(U.type))}r.error(`Expected arguments of type ${P}, but found (${L.join(", ")}) instead.`)}return null}static register(e,r){Wo.definitions=r;for(const l in r)e[l]=Wo}}function ud(o){return Array.isArray(o)?`(${o.map(zs).join(", ")})`:`(${zs(o.type)}...)`}class No{constructor(e,r,l){this.type=zf,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const h=l["case-sensitive"]===void 0?r.parse(!1,1,Xi):r.parseObjectValue(l["case-sensitive"],1,"case-sensitive",Xi);if(!h)return null;const m=l["diacritic-sensitive"]===void 0?r.parse(!1,1,Xi):r.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",Xi);if(!m)return null;let _=null;return l.locale&&(_=r.parseObjectValue(l.locale,1,"locale",Bi),!_)?null:new No(h,m,_)}evaluate(e){return new Bp(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Qa(o,e,r=0,l=o.length-1,h=ty){for(;l>r;){if(l-r>600){const A=l-r+1,R=e-r+1,P=Math.log(A),L=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*L*(A-L)/A)*(R-A/2<0?-1:1);Qa(o,e,Math.max(r,Math.floor(e-R*L/A+N)),Math.min(l,Math.floor(e+(A-R)*L/A+N)),h)}const m=o[e];let _=r,v=l;for(io(o,r,e),h(o[l],m)>0&&io(o,r,l);_<v;){for(io(o,_,v),_++,v--;h(o[_],m)<0;)_++;for(;h(o[v],m)>0;)v--}h(o[r],m)===0?io(o,r,v):(v++,io(o,v,l)),v<=e&&(r=v+1),e<=v&&(l=v-1)}}function io(o,e,r){const l=o[e];o[e]=o[r],o[r]=l}function ty(o,e){return o<e?-1:o>e?1:0}function ny(o){let e=0;for(let r,l,h=0,m=o.length,_=m-1;h<m;_=h++)r=o[h],l=o[_],e+=(l.x-r.x)*(r.y+l.y);return e}function Dh(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function uc(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function iy(o,e,r){const l=o[0]-e[0],h=o[1]-e[1],m=o[0]-r[0],_=o[1]-r[1];return l*_-m*h==0&&l*m<=0&&h*_<=0}function Xo(o,e,r=!1){let l=!1;for(let v=0,A=e.length;v<A;v++){const R=e[v];for(let P=0,L=R.length,N=L-1;P<L;N=P++){const U=R[N],$=R[P];if(iy(o,U,$))return r;(m=U)[1]>(h=o)[1]!=(_=$)[1]>h[1]&&h[0]<(_[0]-m[0])*(h[1]-m[1])/(_[1]-m[1])+m[0]&&(l=!l)}}var h,m,_;return l}function $p(o,e,r,l){const h=l[0]-r[0],m=l[1]-r[1],_=(o[0]-r[0])*m-h*(o[1]-r[1]),v=(e[0]-r[0])*m-h*(e[1]-r[1]);return _>0&&v<0||_<0&&v>0}function yu(o,e,r,l){return(h=[l[0]-r[0],l[1]-r[1]])[0]*(m=[e[0]-o[0],e[1]-o[1]])[1]-h[1]*m[0]!=0&&!(!$p(o,e,r,l)||!$p(r,l,o,e));var h,m}function dd(o){const e=new Ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of o[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),r.x<l.x&&(r.x=l.x),r.y<l.y&&(r.y=l.y);return{min:e,max:r}}const Uc=8192;function hd(o,e){const r=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*Uc),Math.round(l*h*Uc)]}function fd(o,e){for(let r=0;r<e.length;r++)if(Xo(o,e[r]))return!0;return!1}function Sg(o,e,r){for(const l of r)for(let h=0,m=l.length,_=m-1;h<m;_=h++)if(yu(o,e,l[_],l[h]))return!0;return!1}function $c(o,e){for(let r=0;r<o.length;++r)if(!Xo(o[r],e))return!1;for(let r=0;r<o.length-1;++r)if(Sg(o[r],o[r+1],e))return!1;return!0}function pd(o,e){for(let r=0;r<e.length;r++)if($c(o,e[r]))return!0;return!1}function Gp(o,e,r){const l=[];for(let h=0;h<o.length;h++){const m=[];for(let _=0;_<o[h].length;_++){const v=hd(o[h][_],r);Dh(e,v),m.push(v)}l.push(m)}return l}function Ff(o,e,r){const l=[];for(let h=0;h<o.length;h++){const m=Gp(o[h],e,r);l.push(m)}return l}function Hp(o,e,r,l){if(o[0]<r[0]||o[0]>r[2]){const h=.5*l;let m=o[0]-r[0]>h?-l:r[0]-o[0]>h?l:0;m===0&&(m=o[0]-r[2]>h?-l:r[2]-o[0]>h?l:0),o[0]+=m}Dh(e,o)}function Tg(o,e,r,l){const h=Math.pow(2,l.z)*Uc,m=[l.x*Uc,l.y*Uc],_=[];if(!o)return _;for(const v of o)for(const A of v){const R=[A.x+m[0],A.y+m[1]];Hp(R,e,r,h),_.push(R)}return _}function ml(o,e,r,l){const h=Math.pow(2,l.z)*Uc,m=[l.x*Uc,l.y*Uc],_=[];if(!o)return _;for(const A of o){const R=[];for(const P of A){const L=[P.x+m[0],P.y+m[1]];Dh(e,L),R.push(L)}_.push(R)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const A of _)for(const R of A)Hp(R,e,r,h)}var v;return _}class md{constructor(e,r){this.type=Xi,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Rh(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const m=l.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new md(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new md(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new md(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const v=Gp(l.coordinates,m,_),A=Tg(r.geometry(),h,m,_);if(!uc(h,m))return!1;for(const R of A)if(!Xo(R,v))return!1}if(l.type==="MultiPolygon"){const v=Ff(l.coordinates,m,_),A=Tg(r.geometry(),h,m,_);if(!uc(h,m))return!1;for(const R of A)if(!fd(R,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(l.type==="Polygon"){const v=Gp(l.coordinates,m,_),A=ml(r.geometry(),h,m,_);if(!uc(h,m))return!1;for(const R of A)if(!$c(R,v))return!1}if(l.type==="MultiPolygon"){const v=Ff(l.coordinates,m,_),A=ml(r.geometry(),h,m,_);if(!uc(h,m))return!1;for(const R of A)if(!pd(R,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ph={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},qp=1/298.257223563,Bf=qp*(2-qp),ra=Math.PI/180;class Gc{static fromTile(e,r,l){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/ra;return new Gc(m,l)}static get units(){return Ph}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!Ph[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Ph).join(", ")}`);const l=6378.137*ra*(r?Ph[r]:1),h=Math.cos(e*ra),m=1/(1-Bf*(1-h*h)),_=Math.sqrt(m);this.kx=l*_*h,this.ky=l*_*m*(1-Bf)}distance(e,r){const l=xa(e[0]-r[0])*this.kx,h=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+h*h)}bearing(e,r){const l=xa(r[0]-e[0])*this.kx;return Math.atan2(l,(r[1]-e[1])*this.ky)/ra}destination(e,r,l){const h=l*ra;return this.offset(e,Math.sin(h)*r,Math.cos(h)*r)}offset(e,r,l){return[e[0]+r/this.kx,e[1]+l/this.ky]}lineDistance(e){let r=0;for(let l=0;l<e.length-1;l++)r+=this.distance(e[l],e[l+1]);return r}area(e){let r=0;for(let l=0;l<e.length;l++){const h=e[l];for(let m=0,_=h.length,v=_-1;m<_;v=m++)r+=xa(h[m][0]-h[v][0])*(h[m][1]+h[v][1])*(l?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let l=0;if(r<=0)return e[0];for(let h=0;h<e.length-1;h++){const m=e[h],_=e[h+1],v=this.distance(m,_);if(l+=v,l>r)return Hc(m,_,(r-(l-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,r,l){let[h,m]=r,_=xa(l[0]-h)*this.kx,v=(l[1]-m)*this.ky;if(_!==0||v!==0){const A=(xa(e[0]-h)*this.kx*_+(e[1]-m)*this.ky*v)/(_*_+v*v);A>1?(h=l[0],m=l[1]):A>0&&(h+=_/this.kx*A,m+=v/this.ky*A)}return _=xa(e[0]-h)*this.kx,v=(e[1]-m)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(e,r){let l=1/0,h=e[0][0],m=e[0][1],_=0,v=0;for(let A=0;A<e.length-1;A++){let R=e[A][0],P=e[A][1],L=xa(e[A+1][0]-R)*this.kx,N=(e[A+1][1]-P)*this.ky,U=0;L===0&&N===0||(U=(xa(r[0]-R)*this.kx*L+(r[1]-P)*this.ky*N)/(L*L+N*N),U>1?(R=e[A+1][0],P=e[A+1][1]):U>0&&(R+=L/this.kx*U,P+=N/this.ky*U)),L=xa(r[0]-R)*this.kx,N=(r[1]-P)*this.ky;const $=L*L+N*N;$<l&&(l=$,h=R,m=P,_=A,v=U)}return{point:[h,m],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(e,r,l){let h=this.pointOnLine(l,e),m=this.pointOnLine(l,r);if(h.index>m.index||h.index===m.index&&h.t>m.t){const R=h;h=m,m=R}const _=[h.point],v=h.index+1,A=m.index;!za(l[v],_[0])&&v<=A&&_.push(l[v]);for(let R=v+1;R<=A;R++)_.push(l[R]);return za(l[A],m.point)||_.push(m.point),_}lineSliceAlong(e,r,l){let h=0;const m=[];for(let _=0;_<l.length-1;_++){const v=l[_],A=l[_+1],R=this.distance(v,A);if(h+=R,h>e&&m.length===0&&m.push(Hc(v,A,(e-(h-R))/R)),h>=r)return m.push(Hc(v,A,(r-(h-R))/R)),m;h>e&&m.push(A)}return m}bufferPoint(e,r){const l=r/this.ky,h=r/this.kx;return[e[0]-h,e[1]-l,e[0]+h,e[1]+l]}bufferBBox(e,r){const l=r/this.ky,h=r/this.kx;return[e[0]-h,e[1]-l,e[2]+h,e[3]+l]}insideBBox(e,r){return xa(e[0]-r[0])>=0&&xa(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function za(o,e){return o[0]===e[0]&&o[1]===e[1]}function Hc(o,e,r){const l=xa(e[0]-o[0]);return[o[0]+l*r,o[1]+(e[1]-o[1])*r]}function xa(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class gd{constructor(e=[],r=((l,h)=>l<h?-1:l>h?1:0)){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,h=r[e];for(;e>0;){const m=e-1>>1,_=r[m];if(l(h,_)>=0)break;r[e]=_,e=m}r[e]=h}_down(e){const{data:r,compare:l}=this,h=this.length>>1,m=r[e];for(;e<h;){let _=1+(e<<1);const v=_+1;if(v<this.length&&l(r[v],r[_])<0&&(_=v),l(r[_],m)>=0)break;r[e]=r[_],e=_}r[e]=m}}var qt=8192;function Vf(o,e){return e.dist-o.dist}const gl=100,_d=50;function xu(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==o[r])return!1;return!0}function dc(o){return o[1]-o[0]+1}function hc(o,e){const r=o[1]>=o[0]&&o[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function sa(o,e){if(o[0]>o[1])return[null,null];const r=dc(o);if(e){if(r===2)return[o,null];const l=Math.floor(r/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}{if(r===1)return[o,null];const l=Math.floor(r/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}}function La(o,e){const r=[1/0,1/0,-1/0,-1/0];if(!hc(e,o.length))return r;for(let l=e[0];l<=e[1];++l)Dh(r,o[l]);return r}function mi(o){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<o.length;++r)for(let l=0;l<o[r].length;++l)Dh(e,o[r][l]);return e}function yd(o,e,r){if(xu(o)||xu(e))return NaN;let l=0,h=0;return o[2]<e[0]&&(l=e[0]-o[2]),o[0]>e[2]&&(l=o[0]-e[2]),o[1]>e[3]&&(h=o[1]-e[3]),o[3]<e[1]&&(h=e[1]-o[3]),r.distance([0,0],[l,h])}function Zp(o){return 360*o-180}function xd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Oh(o,e){const r=Math.pow(2,e.z),l=(o.y/qt+e.y)/r;return[Zp((o.x/qt+e.x)/r),xd(l)]}function ry(o,e){const r=[];for(let l=0;l<o.length;++l)r.push(Oh(o[l],e));return r}function Fr(o,e,r){const l=r.pointOnLine(e,o).point;return r.distance(o,l)}function Eg(o,e,r,l,h){const m=r.slice(l[0],l[1]+1);let _=1/0;for(let v=e[0];v<=e[1];++v)if((_=Math.min(_,Fr(o[v],m,h)))===0)return 0;return _}function Na(o,e,r,l,h){const m=Math.min(h.pointToSegmentDistance(o,r,l),h.pointToSegmentDistance(e,r,l)),_=Math.min(h.pointToSegmentDistance(r,o,e),h.pointToSegmentDistance(l,o,e));return Math.min(m,_)}function zh(o,e,r,l,h){if(!hc(e,o.length)||!hc(l,r.length))return NaN;let m=1/0;for(let _=e[0];_<e[1];++_)for(let v=l[0];v<l[1];++v){if(yu(o[_],o[_+1],r[v],r[v+1]))return 0;m=Math.min(m,Na(o[_],o[_+1],r[v],r[v+1],h))}return m}function Lh(o,e,r,l,h){if(!hc(e,o.length)||!hc(l,r.length))return NaN;let m=1/0;for(let _=e[0];_<=e[1];++_)for(let v=l[0];v<=l[1];++v)if((m=Math.min(m,h.distance(o[_],r[v])))===0)return m;return m}function Wp(o,e,r){if(Xo(o,e,!0))return 0;let l=1/0;for(const h of e){const m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&(l=Math.min(l,r.pointToSegmentDistance(o,h[m-1],h[0])))===0||(l=Math.min(l,Fr(o,h,r)))===0)return l}return l}function Uf(o,e,r,l){if(!hc(e,o.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Xo(o[m],r,!0))return 0;let h=1/0;for(let m=e[0];m<e[1];++m)for(const _ of r)for(let v=0,A=_.length,R=A-1;v<A;R=v++){if(yu(o[m],o[m+1],_[R],_[v]))return 0;h=Math.min(h,Na(o[m],o[m+1],_[R],_[v],l))}return h}function Ja(o,e){for(const r of o)for(let l=0;l<=r.length-1;++l)if(Xo(r[l],e,!0))return!0;return!1}function _l(o,e,r,l=1/0){const h=mi(o),m=mi(e);if(l!==1/0&&yd(h,m,r)>=l)return l;if(uc(h,m)){if(Ja(o,e))return 0}else if(Ja(e,o))return 0;let _=l;for(const v of o)for(let A=0,R=v.length,P=R-1;A<R;P=A++)for(const L of e)for(let N=0,U=L.length,$=U-1;N<U;$=N++){if(yu(v[P],v[A],L[$],L[N]))return 0;_=Math.min(_,Na(v[P],v[A],L[$],L[N],r))}return _}function jl(o,e,r,l,h,m,_){if(m===null||_===null)return;const v=yd(La(l,m),La(h,_),r);v<e&&o.push({dist:v,range1:m,range2:_})}function fc(o,e,r,l,h=1/0){let m=Math.min(l.distance(o[0],r[0][0]),h);if(m===0)return m;const _=new gd([{dist:0,range1:[0,o.length-1],range2:[0,0]}],Vf),v=e?_d:gl,A=mi(r);for(;_.length;){const R=_.pop();if(R.dist>=m)continue;const P=R.range1;if(dc(P)<=v){if(!hc(P,o.length))return NaN;if(e){const L=Uf(o,P,r,l);if((m=Math.min(m,L))===0)return m}else for(let L=P[0];L<=P[1];++L){const N=Wp(o[L],r,l);if((m=Math.min(m,N))===0)return m}}else{const L=sa(P,e);if(L[0]!==null){const N=yd(La(o,L[0]),A,l);N<m&&_.push({dist:N,range1:L[0],range2:[0,0]})}if(L[1]!==null){const N=yd(La(o,L[1]),A,l);N<m&&_.push({dist:N,range1:L[1],range2:[0,0]})}}}return m}function Fl(o,e,r,l,h,m=1/0){let _=Math.min(m,h.distance(o[0],r[0]));if(_===0)return _;const v=new gd([{dist:0,range1:[0,o.length-1],range2:[0,r.length-1]}],Vf),A=e?_d:gl,R=l?_d:gl;for(;v.length;){const P=v.pop();if(P.dist>=_)continue;const L=P.range1,N=P.range2;if(dc(L)<=A&&dc(N)<=R){if(!hc(L,o.length)||!hc(N,r.length))return NaN;if(e&&l?_=Math.min(_,zh(o,L,r,N,h)):e||l?e&&!l?_=Math.min(_,Eg(r,N,o,L,h)):!e&&l&&(_=Math.min(_,Eg(o,L,r,N,h))):_=Math.min(_,Lh(o,L,r,N,h)),_===0)return _}else{const U=sa(L,e),$=sa(N,l);jl(v,_,h,o,r,U[0],$[0]),jl(v,_,h,o,r,U[0],$[1]),jl(v,_,h,o,r,U[1],$[0]),jl(v,_,h,o,r,U[1],$[1])}}return _}function Bl(o,e,r,l,h=1/0){let m=h;const _=La(o,[0,o.length-1]);for(const v of r)if(!(m!==1/0&&yd(_,La(v,[0,v.length-1]),l)>=m)&&(m=Math.min(m,Fl(o,e,v,!0,l,m)),m===0))return m;return m}function $f(o,e,r,l,h=1/0){let m=h;const _=La(o,[0,o.length-1]);for(const v of r){if(m!==1/0&&yd(_,mi(v),l)>=m)continue;const A=fc(o,e,v,l,m);if(isNaN(A))return A;if((m=Math.min(m,A))===0)return m}return m}function Gf(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class qc{constructor(e,r){this.type=Mn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Rh(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let h=0;h<l.features.length;++h)if(Gf(l.features[h].geometry.type))return new qc(l,l.features[h].geometry)}else if(l.type==="Feature"){if(Gf(l.geometry.type))return new qc(l,l.geometry)}else if(Gf(l.type))return new qc(l,l)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),l=e.canonicalID();if(r!=null&&l!=null){if(e.geometryType()==="Point")return(function(h,m,_){const v=[];for(const R of h)for(const P of R)v.push(Oh(P,m));const A=new Gc(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Fl(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A):_.type==="MultiLineString"?Bl(v,!1,_.coordinates,A):_.type==="Polygon"||_.type==="MultiPolygon"?$f(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,A):null})(r,l,this.geometries);if(e.geometryType()==="LineString")return(function(h,m,_){const v=[];for(const R of h){const P=[];for(const L of R)P.push(Oh(L,m));v.push(P)}const A=new Gc(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Bl(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,A);if(_.type==="MultiLineString"){let R=1/0;for(let P=0;P<_.coordinates.length;P++){const L=Bl(_.coordinates[P],!0,v,A,R);if(isNaN(L))return L;if((R=Math.min(R,L))===0)return R}return R}if(_.type==="Polygon"||_.type==="MultiPolygon"){let R=1/0;for(let P=0;P<v.length;P++){const L=$f(v[P],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,A,R);if(isNaN(L))return L;if((R=Math.min(R,L))===0)return R}return R}return null})(r,l,this.geometries);if(e.geometryType()==="Polygon")return(function(h,m,_){const v=[];for(const R of(function(P,L){const N=P.length;if(N<=1)return[P];const U=[];let $,X;for(let Q=0;Q<N;Q++){const te=ny(P[Q]);te!==0&&(P[Q].area=Math.abs(te),X===void 0&&(X=te<0),X===te<0?($&&U.push($),$=[P[Q]]):$.push(P[Q]))}return $&&U.push($),U})(h)){const P=[];for(let L=0;L<R.length;++L)P.push(ry(R[L],m));v.push(P)}const A=new Gc(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return $f(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,A);if(_.type==="MultiLineString"){let R=1/0;for(let P=0;P<_.coordinates.length;P++){const L=$f(_.coordinates[P],!0,v,A,R);if(isNaN(L))return L;if((R=Math.min(R,L))===0)return R}return R}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(R,P,L){let N=1/0;for(const U of R)for(const $ of P){const X=_l(U,$,L,N);if(isNaN(X))return X;if((N=Math.min(N,X))===0)return N}return N})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,A):null})(r,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function vd(o){if(o instanceof Wo&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof md||o instanceof qc)return!1;if(o instanceof vu)return o.featureConstant;let e=!0;return o.eachChild((r=>{e&&!vd(r)&&(e=!1)})),e}function ro(o){if(o instanceof Wo&&o.name==="feature-state")return!1;let e=!0;return o.eachChild((r=>{e&&!ro(r)&&(e=!1)})),e}function hs(o,e){if(o instanceof Wo&&e.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild((l=>{r&&!hs(l,e)&&(r=!1)})),r}function Nr(o,e,r){return[o,e,r].filter(Boolean).join("")}function pc(o,e){switch(o){case"string":return kl(e);case"number":return+e;case"boolean":return!!e;case"color":return nr.parse(e);case"formatted":return Ks.fromString(kl(e));case"resolvedImage":return uo.build(kl(e))}return e}function el(o,e,r,l){return l!==void 0&&(o=l*Math.round(o/l)),e!==void 0&&o<e&&(o=e),r!==void 0&&o>r&&(o=r),o}class vu{constructor(e,r,l,h=!1){this.type=e,this.key=r,this.scope=l,this.featureConstant=h}static parse(e,r){let l=r.expectedType;if(l==null&&(l=sr),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const h=r.parse(e[1],1);if(!(h instanceof ac))return r.error("Key name of 'config' expression must be a string literal.");let m,_=!0;const v=kl(h.value);if(e.length>=3){const A=r.parse(e[2],2);if(!(A instanceof ac))return r.error("Scope of 'config' expression must be a string literal.");m=kl(A.value)}if(r.options){const A=Nr(v,m,r._scope),R=r.options.get(A);R&&(_=vd(R.value||R.default))}return new vu(l,v,m,_)}evaluate(e){const r=Nr(this.key,this.scope,e.scope),l=e.getConfig(r);if(!l)return null;const{type:h,value:m,values:_,minValue:v,maxValue:A,stepValue:R}=l,P=l.default.evaluate(e);let L=P;if(m){const N=e.scope;e.scope=(N||"").split("").slice(1).join(""),L=m.evaluate(e),e.scope=N}return h&&(L=pc(h,L)),L===void 0||v===void 0&&A===void 0&&R===void 0||(typeof L=="number"?L=el(L,v,A,R):Array.isArray(L)&&(L=L.map((N=>typeof N=="number"?el(N,v,A,R):N)))),m!==void 0&&L!==void 0&&_&&!_.includes(L)&&(L=P,h&&(L=pc(h,L))),(h&&h!==this.type||L!==void 0&&!kf(Ys(L),this.type))&&(L=pc(this.type.kind,L)),L}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Vl{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new Vl(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Hf{constructor(e,r=[],l,h=new Pa,m=[],_,v,A){this.registry=e,this.path=r,this.key=r.map((R=>typeof R=="string"?`['${R}']`:`[${R}]`)).join(""),this.scope=h,this.errors=m,this.expectedType=l,this._scope=_,this.options=v,this.iconImageUseTheme=A}parse(e,r,l,h,m={}){return r||l?this.concat(r,null,l,h)._parse(e,m):this._parse(e,m)}parseObjectValue(e,r,l,h,m,_={}){return this.concat(r,l,h,m)._parse(e,_)}_parse(e,r){function l(h,m,_){return _==="assert"?new wn(m,[h]):_==="coerce"?new cc(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let m=h.parse(e,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,v=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else m=l(m,_,r.typeAnnotation||"coerce");else m=l(m,_,r.typeAnnotation||"assert")}if(!(m instanceof ac)&&m.type.kind!=="resolvedImage"&&Xp(m)){const _=new ho(this._scope,this.options,this.iconImageUseTheme);try{m=new ac(m.type,m.evaluate(_))}catch(v){return this.error(v.message),null}}return m}return cc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l,h){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof r=="string"?m.concat(r):m;const _=h?this.scope.concat(h):this.scope;return new Hf(this.registry,m,l||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...r){const l=`${this.key}${r.map((h=>`[${h}]`)).join("")}`;this.errors.push(new pl(l,e))}checkSubtype(e,r){const l=ad(e,r);return l&&this.error(l),l}}function Xp(o){if(o instanceof Vl)return Xp(o.boundExpression);if(o instanceof Wo&&o.name==="error"||o instanceof No||o instanceof md||o instanceof qc||o instanceof vu)return!1;const e=o instanceof cc||o instanceof wn;let r=!0;return o.eachChild((l=>{r=e?r&&Xp(l):r&&l instanceof ac})),!!r&&vd(o)&&hs(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zc(o,e){const r=o.length-1;let l,h,m=0,_=r,v=0;for(;m<=_;)if(v=Math.floor((m+_)/2),l=o[v],h=o[v+1],l<=e){if(v===r||e<h)return v;m=v+1}else{if(!(l>e))throw new es("Input is not a number.");_=v-1}return 0}class Ul{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,m]of l)this.labels.push(h),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,Mn);if(!l)return null;const h=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],A=e[_+1],R=_,P=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const L=r.parse(A,P,m);if(!L)return null;m=m||L.type,h.push([v,L])}return new Ul(m,l,h)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return l[0].evaluate(e);const m=r.length;return h>=r[m-1]?l[m-1].evaluate(e):l[Zc(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const Kp=.95047,Nh=1.08883,Yp=4/29,yl=6/29,xl=3*yl*yl,bu=yl*yl*yl,mc=Math.PI/180,Ag=180/Math.PI;function qf(o){return o>bu?Math.pow(o,1/3):o/xl+Yp}function wu(o){return o>yl?o*o*o:xl*(o-Yp)}function bd(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function gc(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Us(o){const e=gc(o.r),r=gc(o.g),l=gc(o.b),h=qf((.4124564*e+.3575761*r+.1804375*l)/Kp),m=qf((.2126729*e+.7151522*r+.072175*l)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-qf((.0193339*e+.119192*r+.9503041*l)/Nh)),alpha:o.a}}function kh(o){let e=(o.l+16)/116,r=isNaN(o.a)?e:e+o.a/500,l=isNaN(o.b)?e:e-o.b/200;return e=1*wu(e),r=Kp*wu(r),l=Nh*wu(l),new nr(bd(3.2404542*r-1.5371385*e-.4985314*l),bd(-.969266*r+1.8760108*e+.041556*l),bd(.0556434*r-.2040259*e+1.0572252*l),o.alpha)}function Cg(o,e,r){const l=e-o;return o+r*(l>180||l<-180?l-360*Math.round(l/360):l)}const Zf={forward:Us,reverse:kh,interpolate:function(o,e,r){return{l:Gn(o.l,e.l,r),a:Gn(o.a,e.a,r),b:Gn(o.b,e.b,r),alpha:Gn(o.alpha,e.alpha,r)}}},wd={forward:function(o){const{l:e,a:r,b:l}=Us(o),h=Math.atan2(l,r)*Ag;return{h:h<0?h+360:h,c:Math.sqrt(r*r+l*l),l:e,alpha:o.a}},reverse:function(o){const e=o.h*mc,r=o.c;return kh({l:o.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:o.alpha})},interpolate:function(o,e,r){return{h:Cg(o.h,e.h,r),c:Gn(o.c,e.c,r),l:Gn(o.l,e.l,r),alpha:Gn(o.alpha,e.alpha,r)}}};var Qp=Object.freeze({__proto__:null,hcl:wd,lab:Zf});class ts{constructor(e,r,l,h,m){this.type=e,this.operator=r,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of m)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,r,l,h){let m=0;if(e.name==="exponential")m=Wf(r,e.base,l,h);else if(e.name==="linear")m=Wf(r,1,l,h);else if(e.name==="cubic-bezier"){const _=e.controlPoints;m=new wo(_[0],_[1],_[2],_[3]).solve(Wf(r,1,l,h))}return m}static parse(e,r){let[l,h,m,..._]=e;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const R=h[1];if(typeof R!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:R}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const R=h.slice(1);if(R.length!==4||R.some((P=>typeof P!="number"||P<0||P>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:R}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,Mn),!m)return null;const v=[];let A=null;l==="interpolate-hcl"||l==="interpolate-lab"?A=Oa:r.expectedType&&r.expectedType.kind!=="value"&&(A=r.expectedType);for(let R=0;R<_.length;R+=2){const P=_[R],L=_[R+1],N=R+3,U=R+4;if(typeof P!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(v.length&&v[v.length-1][0]>=P)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=r.parse(L,U,A);if(!$)return null;A=A||$.type,v.push([P,$])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new ts(A,l,h,m,v):r.error(`Type ${zs(A)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return l[0].evaluate(e);const m=r.length;if(h>=r[m-1])return l[m-1].evaluate(e);const _=Zc(r,h),v=ts.interpolationFactor(this.interpolation,h,r[_],r[_+1]),A=l[_].evaluate(e),R=l[_+1].evaluate(e);return this.operator==="interpolate"?Vc[this.type.kind.toLowerCase()](A,R,v):this.operator==="interpolate-hcl"?wd.reverse(wd.interpolate(wd.forward(A),wd.forward(R),v)):Zf.reverse(Zf.interpolate(Zf.forward(A),Zf.forward(R),v))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)r.push(this.labels[l],this.outputs[l].serialize());return r}}function Wf(o,e,r,l){const h=l-r,m=o-r;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class Wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const h=r.expectedType;h&&h.kind!=="value"&&(l=h);const m=[];for(const v of e.slice(1)){const A=r.parse(v,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!A)return null;l=l||A.type,m.push(A)}const _=h&&m.some((v=>ad(h,v.type)));return new Wc(_?sr:l,m)}evaluate(e){let r,l=null,h=0;for(const m of this.args){if(h++,l=m.evaluate(e),l&&l instanceof uo&&!l.available&&(r||(r=l),l=null,h===this.args.length))return r;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((r=>{e.push(r.serialize())})),e}}class Xc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=r.parse(e[m+1],m+1);if(!v)return null;l.push([_,v])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return h?new Xc(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,l]of this.bindings)e.push(r,l.serialize());return e.push(this.result.serialize()),e}}class Xf{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Mn),h=r.parse(e[2],2,co(r.expectedType||sr));return l&&h?new Xf(h.type.itemType,l,h):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new es("Array index out of bounds: negative index");if(r>=l.length)throw new es("Array index out of bounds: index exceeds array size");if(r!==Math.floor(r))throw new es("Array index must be an integer. Use at-interpolated for fractional indices");return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Su{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Mn),h=r.parse(e[2],2,co(r.expectedType||sr));return l&&h?new Su(h.type.itemType,l,h):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new es(`Array index out of bounds: ${r} < 0.`);if(r>l.length-1)throw new es(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r===Math.floor(r))return l[r];const h=Math.floor(r),m=Math.ceil(r),_=l[h],v=l[m];if(typeof _!="number"||typeof v!="number")throw new es(`Cannot interpolate between non-number values at index ${r}.`);const A=r-h;return _*(1-A)+v*A}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Tu{constructor(e,r){this.type=Xi,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,sr),h=r.parse(e[2],2,sr);return l&&h?ld(l.type,[Xi,Bi,Mn,Eh,sr])?new Tu(l,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${zs(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Nf(r,["boolean","string","number","null"]))throw new es(`Expected first argument to be of type boolean, string, number or null, but found ${zs(Ys(r))} instead.`);if(!Nf(l,["string","array"]))throw new es(`Expected second argument to be of type array or string, but found ${zs(Ys(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Kf{constructor(e,r,l){this.type=Mn,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,sr),h=r.parse(e[2],2,sr);if(!l||!h)return null;if(!ld(l.type,[Xi,Bi,Mn,Eh,sr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${zs(l.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Mn);return m?new Kf(l,h,m):null}return new Kf(l,h)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Nf(r,["boolean","string","number","null"]))throw new es(`Expected first argument to be of type boolean, string, number or null, but found ${zs(Ys(r))} instead.`);if(!Nf(l,["string","array"]))throw new es(`Expected second argument to be of type array or string, but found ${zs(Ys(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(r,h)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Yf{constructor(e,r,l,h,m,_){this.inputType=e,this.type=r,this.input=l,this.cases=h,this.outputs=m,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const m={},_=[];for(let R=2;R<e.length-1;R+=2){let P=e[R];const L=e[R+1];Array.isArray(P)||(P=[P]);const N=r.concat(R);if(P.length===0)return N.error("Expected at least one branch label.");for(const $ of P){if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(l){if(N.checkSubtype(l,Ys($)))return null}else l=Ys($);if(m[String($)]!==void 0)return N.error("Branch labels must be unique.");m[String($)]=_.length}const U=r.parse(L,R,h);if(!U)return null;h=h||U.type,_.push(U)}const v=r.parse(e[1],1,sr);if(!v)return null;const A=r.parse(e[e.length-1],e.length-1,h);return A?v.type.kind!=="value"&&r.concat(1).checkSubtype(l,v.type)?null:new Yf(l,h,v,m,_,A):null}evaluate(e){const r=this.input.evaluate(e);return(kf(Ys(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),l=[],h={};for(const _ of r){const v=h[this.cases[_]];v===void 0?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[v][1].push(_)}const m=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of l)e.push(v.length===1?m(v[0]):v.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class jh{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const v=r.parse(e[_],_,Xi);if(!v)return null;const A=r.parse(e[_+1],_+1,l);if(!A)return null;h.push([v,A]),l=l||A.type}const m=r.parse(e[e.length-1],e.length-1,l);return m?new jh(l,h,m):null}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((r=>{e.push(r.serialize())})),e}}class Qf{constructor(e,r,l,h){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,sr),h=r.parse(e[2],2,Mn);if(!l||!h)return null;if(!ld(l.type,[co(sr),Bi,sr]))return r.error(`Expected first argument to be of type array or string, but found ${zs(l.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Mn);return m?new Qf(l.type,l,h,m):null}return new Qf(l.type,l,h)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Nf(r,["string","array"]))throw new es(`Expected first argument to be of type array or string, but found ${zs(Ys(r))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return r.slice(l,h)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class _c{constructor(e,r){this.type=co(Bi),this.str=e,this.delimiter=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Bi),h=r.parse(e[2],2,Bi);return l&&h?new _c(l,h):void 0}evaluate(e){const r=this.str.evaluate(e),l=this.delimiter.evaluate(e);return r.split(l)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Jp(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jf(o,e,r,l){return l.compare(e,r)===0}function Sd(o,e,r){const l=o!=="=="&&o!=="!=";return class zN{constructor(m,_,v){this.type=Xi,this.lhs=m,this.rhs=_,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const v=m[0];let A=_.parse(m[1],1,sr);if(!A)return null;if(!Jp(v,A.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${zs(A.type)}'.`);let R=_.parse(m[2],2,sr);if(!R)return null;if(!Jp(v,R.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${zs(R.type)}'.`);if(A.type.kind!==R.type.kind&&A.type.kind!=="value"&&R.type.kind!=="value")return _.error(`Cannot compare types '${zs(A.type)}' and '${zs(R.type)}'.`);l&&(A.type.kind==="value"&&R.type.kind!=="value"?A=new wn(R.type,[A]):A.type.kind!=="value"&&R.type.kind==="value"&&(R=new wn(A.type,[R])));let P=null;if(m.length===4){if(A.type.kind!=="string"&&R.type.kind!=="string"&&A.type.kind!=="value"&&R.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(m[3],3,zf),!P)return null}return new zN(A,R,P)}evaluate(m){const _=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const A=Ys(_),R=Ys(v);if(A.kind!==R.kind||A.kind!=="string"&&A.kind!=="number")throw new es(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${A.kind}, ${R.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const A=Ys(_),R=Ys(v);if(A.kind!=="string"||R.kind!=="string")return e(m,_,v)}return this.collator?r(m,_,v,this.collator.evaluate(m)):e(m,_,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild((_=>{m.push(_.serialize())})),m}}}const Td=Sd("==",(function(o,e,r){return e===r}),Jf),em=Sd("!=",(function(o,e,r){return e!==r}),(function(o,e,r,l){return!Jf(0,e,r,l)})),tm=Sd("<",(function(o,e,r){return e<r}),(function(o,e,r,l){return l.compare(e,r)<0})),nm=Sd(">",(function(o,e,r){return e>r}),(function(o,e,r,l){return l.compare(e,r)>0})),sy=Sd("<=",(function(o,e,r){return e<=r}),(function(o,e,r,l){return l.compare(e,r)<=0})),ep=Sd(">=",(function(o,e,r){return e>=r}),(function(o,e,r,l){return l.compare(e,r)>=0}));class Kc{constructor(e,r,l,h,m,_){this.type=Bi,this.number=e,this.locale=r,this.currency=l,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,Mn);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=r.parseObjectValue(h.locale,2,"locale",Bi),!m))return null;let _=null;if(h.currency&&(_=r.parseObjectValue(h.currency,2,"currency",Bi),!_))return null;let v=null;if(h.unit&&(v=r.parseObjectValue(h.unit,2,"unit",Bi),!v))return null;let A=null;if(h["min-fraction-digits"]&&(A=r.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Mn),!A))return null;let R=null;return h["max-fraction-digits"]&&(R=r.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Mn),!R)?null:new Kc(l,m,_,v,A,R)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Yc{constructor(e){this.type=Mn,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${zs(l.type)} instead.`):new Yc(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new es(`Expected value to be of type string or array, but found ${zs(Ys(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((r=>{e.push(r.serialize())})),e}}function Rg(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ed={"==":Td,"!=":em,">":nm,"<":tm,">=":ep,"<=":sy,array:wn,at:Xf,"at-interpolated":Su,boolean:wn,case:jh,coalesce:Wc,collator:No,format:lc,image:Yn,in:Tu,"index-of":Kf,interpolate:ts,"interpolate-hcl":ts,"interpolate-lab":ts,length:Yc,let:Xc,literal:ac,match:Yf,number:wn,"number-format":Kc,object:wn,slice:Qf,step:Ul,string:wn,"to-boolean":cc,"to-color":cc,"to-number":cc,"to-string":cc,var:Vl,within:md,distance:qc,config:vu,split:_c};function Eu(o,[e,r,l,h]){e=e.evaluate(o),r=r.evaluate(o),l=l.evaluate(o);const m=h?h.evaluate(o):1,_=Vp(e,r,l,m);if(_)throw new es(_);return new nr(e/255,r/255,l/255,m)}function Fh(o,[e,r,l,h]){e=e.evaluate(o),r=r.evaluate(o),l=l.evaluate(o);const m=h?h.evaluate(o):1,_=(function(R,P,L,N){return typeof R=="number"&&R>=0&&R<=360?typeof P=="number"&&P>=0&&P<=100&&typeof L=="number"&&L>=0&&L<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[R,P,L,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[R,P,L,N]:[R,P,L]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[R,P,L,N]:[R,P,L]).join(", ")}]: 'h' must be between 0 and 360.`})(e,r,l,m);if(_)throw new es(_);const v=`hsla(${e}, ${r}%, ${l}%, ${m})`,A=nr.parse(v);if(!A)throw new es(`Failed to parse HSLA color: ${v}`);return A}function tp(o,e){return o in e}function Au(o,e){const r=e[o];return r===void 0?null:r}function vl(o){return{type:o}}function Bh(o){if(o instanceof vu)return new Set([o.key]);let e=new Set;return o.eachChild((r=>{e=new Set([...e,...Bh(r)])})),e}function yc(o){if(o instanceof Wo&&o.name==="is-active-floor")return!0;let e=!1;return o.eachChild((r=>{!e&&yc(r)&&(e=!0)})),e}function Cu(o){return{result:"success",value:o}}function va(o){return{result:"error",value:o}}function np(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Vh(o){return o["property-type"]==="data-driven"}function xc(o){return np(o.expression,"measure-light")}function vc(o){return np(o.expression,"zoom")}function Ru(o){return!!o.expression&&o.expression.interpolated}function Uh(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function ip(o){return o}function Mu(o,e){const r=e.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",h=l||!(l||o.property!==void 0),m=o.type||(Ru(e)?"exponential":"interval");if(r&&((o=Object.assign({},o)).stops&&(o.stops=o.stops.map((R=>[R[0],nr.parse(R[1])]))),o.default=nr.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Qp[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,v,A;if(m==="exponential")_=Ad;else if(m==="interval")_=Qc;else if(m==="categorical"){_=oy,v=Object.create(null);for(const R of o.stops)v[R[0]]=R[1];A=typeof o.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=im}if(l){const R={},P=[];for(let U=0;U<o.stops.length;U++){const $=o.stops[U],X=$[0].zoom;R[X]===void 0&&(R[X]={zoom:X,type:o.type,property:o.property,default:o.default,stops:[]},P.push(X)),R[X].stops.push([$[0].value,$[1]])}const L=[];for(const U of P)L.push([R[U].zoom,Mu(R[U],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:ts.interpolationFactor.bind(void 0,N),zoomStops:L.map((U=>U[0])),evaluate:({zoom:U},$)=>Ad({stops:L,base:o.base},e,U).evaluate(U,$)}}if(h){const R=m==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ts.interpolationFactor.bind(void 0,R),zoomStops:o.stops.map((P=>P[0])),evaluate:({zoom:P})=>_(o,e,P,v,A)}}return{kind:"source",evaluate(R,P){const L=P&&P.properties?P.properties[o.property]:void 0;return L===void 0?bc(o.default,e.default):_(o,e,L,v,A)}}}function bc(o,e,r){return o!==void 0?o:e!==void 0?e:r!==void 0?r:void 0}function oy(o,e,r,l,h){return bc(typeof r===h?l[r]:void 0,o.default,e.default)}function Qc(o,e,r){if(!Ih(r))return bc(o.default,e.default);const l=o.stops.length;if(l===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[l-1][0])return o.stops[l-1][1];const h=Zc(o.stops.map((m=>m[0])),r);return o.stops[h][1]}function Ad(o,e,r){const l=o.base!==void 0?o.base:1;if(!Ih(r))return bc(o.default,e.default);const h=o.stops.length;if(h===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[h-1][0])return o.stops[h-1][1];const m=Zc(o.stops.map((P=>P[0])),r),_=(function(P,L,N,U){const $=U-N,X=P-N;return $===0?0:L===1?X/$:(Math.pow(L,X)-1)/(Math.pow(L,$)-1)})(r,l,o.stops[m][0],o.stops[m+1][0]),v=o.stops[m][1],A=o.stops[m+1][1];let R=Vc[e.type]||ip;if(o.colorSpace&&o.colorSpace!=="rgb"){const P=Qp[o.colorSpace];R=(L,N)=>P.reverse(P.interpolate(P.forward(L),P.forward(N),_))}return typeof v.evaluate=="function"?{evaluate(...P){const L=v.evaluate.apply(void 0,P),N=A.evaluate.apply(void 0,P);if(L!==void 0&&N!==void 0)return R(L,N,_)}}:R(v,A,_)}function im(o,e,r){return e.type==="color"?r=nr.parse(r):e.type==="formatted"?r=Ks.fromString(r.toString()):e.type==="resolvedImage"?r=uo.build(r.toString()):cd(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),bc(r,o.default,e.default)}Wo.register(Ed,{error:[{kind:"error"},[Bi],(o,[e])=>{throw new es(e.evaluate(o))}],typeof:[Bi,[sr],(o,[e])=>zs(Ys(e.evaluate(o)))],"to-rgba":[co(Mn,4),[Oa],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[co(Mn,4),[Oa],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Oa,[Mn,Mn,Mn],Eu],rgba:[Oa,[Mn,Mn,Mn,Mn],Eu],hsl:[Oa,[Mn,Mn,Mn],Fh],hsla:[Oa,[Mn,Mn,Mn,Mn],Fh],has:{type:Xi,overloads:[[[Bi],(o,[e])=>tp(e.evaluate(o),o.properties())],[[Bi,Ah],(o,[e,r])=>tp(e.evaluate(o),r.evaluate(o))]]},get:{type:sr,overloads:[[[Bi],(o,[e])=>Au(e.evaluate(o),o.properties())],[[Bi,Ah],(o,[e,r])=>Au(e.evaluate(o),r.evaluate(o))]]},"feature-state":[sr,[Bi],(o,[e])=>Au(e.evaluate(o),o.featureState||{})],properties:[Ah,[],o=>o.properties()],"geometry-type":[Bi,[],o=>o.geometryType()],worldview:[Bi,[],o=>o.globals.worldview||""],"is-active-floor":[Xi,vl(Bi),(o,e)=>{if(!(o.globals.activeFloors&&o.globals.activeFloors.size>0))return!1;const r=o.globals.activeFloors;return e.some((l=>{const h=l.evaluate(o);return r.has(h)}))}],id:[sr,[],o=>o.id()],zoom:[Mn,[],o=>o.globals.zoom],pitch:[Mn,[],o=>o.globals.pitch||0],"distance-from-center":[Mn,[],o=>o.distanceFromCenter()],"measure-light":[Mn,[Bi],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[Mn,[],o=>o.globals.heatmapDensity||0],"line-progress":[Mn,[],o=>o.globals.lineProgress||0],"raster-value":[Mn,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[Mn,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[Mn,[],o=>o.globals.skyRadialProgress||0],accumulated:[sr,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Mn,vl(Mn),(o,e)=>{let r=0;for(const l of e)r+=l.evaluate(o);return r}],"*":[Mn,vl(Mn),(o,e)=>{let r=1;for(const l of e)r*=l.evaluate(o);return r}],"-":{type:Mn,overloads:[[[Mn,Mn],(o,[e,r])=>e.evaluate(o)-r.evaluate(o)],[[Mn],(o,[e])=>-e.evaluate(o)]]},"/":[Mn,[Mn,Mn],(o,[e,r])=>e.evaluate(o)/r.evaluate(o)],"%":[Mn,[Mn,Mn],(o,[e,r])=>e.evaluate(o)%r.evaluate(o)],ln2:[Mn,[],()=>Math.LN2],pi:[Mn,[],()=>Math.PI],e:[Mn,[],()=>Math.E],"^":[Mn,[Mn,Mn],(o,[e,r])=>Math.pow(e.evaluate(o),r.evaluate(o))],sqrt:[Mn,[Mn],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Mn,[Mn],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Mn,[Mn],(o,[e])=>Math.log(e.evaluate(o))],log2:[Mn,[Mn],(o,[e])=>Math.log2(e.evaluate(o))],sin:[Mn,[Mn],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Mn,[Mn],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Mn,[Mn],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Mn,[Mn],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Mn,[Mn],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Mn,[Mn],(o,[e])=>Math.atan(e.evaluate(o))],min:[Mn,vl(Mn),(o,e)=>Math.min(...e.map((r=>r.evaluate(o))))],max:[Mn,vl(Mn),(o,e)=>Math.max(...e.map((r=>r.evaluate(o))))],abs:[Mn,[Mn],(o,[e])=>Math.abs(e.evaluate(o))],round:[Mn,[Mn],(o,[e])=>{const r=e.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[Mn,[Mn],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Mn,[Mn],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Xi,[Bi,sr],(o,[e,r])=>o.properties()[e.value]===r.value],"filter-id-==":[Xi,[sr],(o,[e])=>o.id()===e.value],"filter-type-==":[Xi,[Bi],(o,[e])=>o.geometryType()===e.value],"filter-<":[Xi,[Bi,sr],(o,[e,r])=>{const l=o.properties()[e.value],h=r.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Xi,[sr],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[Xi,[Bi,sr],(o,[e,r])=>{const l=o.properties()[e.value],h=r.value;return typeof l==typeof h&&l>h}],"filter-id->":[Xi,[sr],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[Xi,[Bi,sr],(o,[e,r])=>{const l=o.properties()[e.value],h=r.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Xi,[sr],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[Xi,[Bi,sr],(o,[e,r])=>{const l=o.properties()[e.value],h=r.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Xi,[sr],(o,[e])=>{const r=o.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[Xi,[sr],(o,[e])=>e.value in o.properties()],"filter-has-id":[Xi,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Xi,[co(Bi)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Xi,[co(sr)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Xi,[Bi,co(sr)],(o,[e,r])=>r.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Xi,[Bi,co(sr)],(o,[e,r])=>(function(l,h,m,_){for(;m<=_;){const v=m+_>>1;if(h[v]===l)return!0;h[v]>l?_=v-1:m=v+1}return!1})(o.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Xi,overloads:[[[Xi,Xi],(o,[e,r])=>e.evaluate(o)&&r.evaluate(o)],[vl(Xi),(o,e)=>{for(const r of e)if(!r.evaluate(o))return!1;return!0}]]},any:{type:Xi,overloads:[[[Xi,Xi],(o,[e,r])=>e.evaluate(o)||r.evaluate(o)],[vl(Xi),(o,e)=>{for(const r of e)if(r.evaluate(o))return!0;return!1}]]},"!":[Xi,[Xi],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Xi,[Bi],(o,[e])=>{const r=o.globals&&o.globals.isSupportedScript;return!r||r(e.evaluate(o))}],upcase:[Bi,[Bi],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Bi,[Bi],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Bi,vl(sr),(o,e)=>e.map((r=>kl(r.evaluate(o)))).join("")],"resolved-locale":[Bi,[zf],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[Mn,[Mn,Mn,sr],(o,e)=>{const[r,l,h]=e.map((_=>_.evaluate(o)));if(r>l||r===l)return r;let m;if(typeof h=="string")m=(function(_){let v=0;if(_.length===0)return v;for(let A=0;A<_.length;A++)v=(v<<5)-v+_.charCodeAt(A),v|=0;return v})(h);else{if(typeof h!="number")throw new es(`Invalid seed input: ${h}`);m=h}return r+Rg(m)()*(l-r)}]});class rp{constructor(e,r,l,h,m){this.expression=e,this._warningHistory={},this._scope=l,this._options=h,this._iconImageUseTheme=m,this._evaluator=new ho(l,h,m),this._defaultValue=r?(function(_){return _.type==="color"&&(Uh(_.default)||Array.isArray(_.default))?new nr(0,0,0,0):_.type==="color"?nr.parse(_.default)||null:_.default===void 0?null:_.default})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Bh(e),this.isIndoorDependent=yc(e)}evaluateWithoutErrorHandling(e,r,l,h,m,_,v,A){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,h,m,_,v,A,R){this._evaluator||(this._evaluator=new ho(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=A||null,this._evaluator.iconImageUseTheme=R||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new es(`Expected value to be one of ${Object.keys(this._enumValues).map((L=>JSON.stringify(L))).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function $h(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ed}function bl(o,e,r,l,h){const m=new Hf(Ed,[],e?(function(v){const A={color:Oa,string:Bi,number:Mn,enum:Bi,boolean:Xi,formatted:od,resolvedImage:Lf};return v.type==="array"?co(A[v.value]||sr,v.length):A[v.type]})(e):void 0,void 0,void 0,r,l,h),_=m.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Cu(new rp(_,e,r,l,h)):va(m.errors)}class Ko{constructor(e,r,l,h){this.kind=e,this._styleExpression=r,this.isLightConstant=l,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!ro(r.expression),this.configDependencies=Bh(r.expression),this.isIndoorDependent=yc(r.expression)}evaluateWithoutErrorHandling(e,r,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,h,m,_)}evaluate(e,r,l,h,m,_,v){return this._styleExpression.evaluate(e,r,l,h,m,_,void 0,void 0,v)}}class Eo{constructor(e,r,l,h,m,_){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ro(r.expression),this.isIndoorDependent=yc(r.expression),this.isLightConstant=m,this.isLineProgressConstant=_,this.configDependencies=Bh(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,h,m,_)}evaluate(e,r,l,h,m,_){return this._styleExpression.evaluate(e,r,l,h,m,_)}interpolationFactor(e,r,l){return this.interpolationType?ts.interpolationFactor(this.interpolationType,e,r,l):0}}function wc(o,e,r,l,h){if((o=bl(o,e,r,l,h)).result==="error")return o;const m=o.value.expression,_=vd(m);if(!_&&!Vh(e))return va([new pl("","data expressions not supported")]);const v=hs(m,["zoom","pitch","distance-from-center"]);if(!v&&!vc(e))return va([new pl("","zoom expressions not supported")]);const A=hs(m,["measure-light"]);if(!A&&!xc(e))return va([new pl("","measure-light expression not supported")]);const R=hs(m,["line-progress"]);if(!R&&!(function(N){return np(N.expression,"line-progress")})(e))return va([new pl("","line-progress expression not supported")]);const P=e.expression&&e.expression.relaxZoomRestriction,L=sp(m);return L||v||P?L instanceof pl?va([L]):L instanceof ts&&!Ru(e)?va([new pl("",'"interpolate" expressions cannot be used with this property')]):Cu(L?new Eo(_&&R?"camera":"composite",o.value,L.labels,L instanceof ts?L.interpolation:void 0,A,R):new Ko(_&&R?"constant":"source",o.value,A,R)):va([new pl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Gh{constructor(e,r){this._parameters=e,this._specification=r,Object.assign(this,Mu(this._parameters,this._specification))}static deserialize(e){return new Gh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function sp(o){let e=null;if(o instanceof Xc)e=sp(o.result);else if(o instanceof Wc){for(const r of o.args)if(e=sp(r),e)break}else(o instanceof Ul||o instanceof ts)&&o.input instanceof Wo&&o.input.name==="zoom"&&(e=o);return e instanceof pl||o.eachChild((r=>{const l=sp(r);l instanceof pl?e=l:e&&l&&e!==l&&(e=new pl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var wl,oa,Qs=(function(){if(oa)return wl;oa=1,wl=e;var o=3;function e(r,l,h){var m=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var _=new Int32Array(this.arrayBuffer);r=_[0],this.d=(l=_[1])+2*(h=_[2]);for(var v=0;v<this.d*this.d;v++){var A=_[o+v],R=_[o+v+1];m.push(A===R?null:_.subarray(A,R))}var P=_[o+m.length+1];this.keys=_.subarray(_[o+m.length],P),this.bboxes=_.subarray(P),this.insert=this._insertReadonly}else{this.d=l+2*h;for(var L=0;L<this.d*this.d;L++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=h,this.scale=l/r,this.uid=0;var N=h/l*r;this.min=-N,this.max=r+N}return e.prototype.insert=function(r,l,h,m,_){this._forEachCell(l,h,m,_,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,l,h,m,_,v){this.cells[_].push(v)},e.prototype.query=function(r,l,h,m,_){var v=this.min,A=this.max;if(r<=v&&l<=v&&A<=h&&A<=m&&!_)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(r,l,h,m,this._queryCell,R,{},_),R},e.prototype._queryCell=function(r,l,h,m,_,v,A,R){var P=this.cells[_];if(P!==null)for(var L=this.keys,N=this.bboxes,U=0;U<P.length;U++){var $=P[U];if(A[$]===void 0){var X=4*$;(R?R(N[X+0],N[X+1],N[X+2],N[X+3]):r<=N[X+2]&&l<=N[X+3]&&h>=N[X+0]&&m>=N[X+1])?(A[$]=!0,v.push(L[$])):A[$]=!1}}},e.prototype._forEachCell=function(r,l,h,m,_,v,A,R){for(var P=this._convertToCellCoord(r),L=this._convertToCellCoord(l),N=this._convertToCellCoord(h),U=this._convertToCellCoord(m),$=P;$<=N;$++)for(var X=L;X<=U;X++){var Q=this.d*X+$;if((!R||R(this._convertFromCellCoord($),this._convertFromCellCoord(X),this._convertFromCellCoord($+1),this._convertFromCellCoord(X+1)))&&_.call(this,r,l,h,m,Q,v,A,R))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,l=o+this.cells.length+1+1,h=0,m=0;m<this.cells.length;m++)h+=this.cells[m].length;var _=new Int32Array(l+h+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=l,A=0;A<r.length;A++){var R=r[A];_[o+A]=v,_.set(R,v),v+=R.length}return _[o+r.length]=v,_.set(this.keys,v),_[o+r.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},wl})(),Sc=Do(Qs);const ka={};function jt(o,e,r={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),ka[e]={klass:o,omit:r.omit||[]}}jt(Object,"Object"),Sc.serialize=function(o,e){const r=o.toArrayBuffer();return e&&e.add(r),{buffer:r}},Sc.deserialize=function(o){return new Sc(o.buffer)},Object.defineProperty(Sc,"name",{value:"Grid"}),jt(Sc,"Grid"),delete Ct.prototype.constructor,typeof DOMMatrix<"u"&&jt(DOMMatrix,"DOMMatrix"),jt(nr,"Color"),jt(Error,"Error"),jt(Ks,"Formatted"),jt(Ch,"FormattedSection"),jt(ya,"AJAXError"),jt(uo,"ResolvedImage"),jt(Gh,"StylePropertyFunction"),jt(rp,"StyleExpression",{omit:["_evaluator"]}),jt(Vs,"ImageId"),jt(oc,"ImageVariant"),jt(Eo,"ZoomDependentExpression"),jt(Ko,"ZoomConstantExpression"),jt(Wo,"CompoundExpression",{omit:["_evaluate"]});for(const o in Ed)ka[Ed[o]._classRegistryKey]||jt(Ed[o],`Expression${o}`);function fs(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ws(o){return self.ImageBitmap&&o instanceof ImageBitmap}function $l(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(fs(o)||ws(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const r=[];for(const l of o)r.push($l(l,e));return r}if(o instanceof Map){const r={$name:"Map",entries:[]};for(const[l,h]of o.entries())r.entries.push($l(l),$l(h,e));return r}if(o instanceof Set){const r={$name:"Set"};let l=0;for(const h of o.values())r[++l]=$l(h);return r}if(o instanceof DOMMatrix){const r={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of l)r[h]=o[h];return r}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const r=o.constructor,l=r._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const h=r.serialize?r.serialize(o,e):{};if(!r.serialize){for(const m in o)o.hasOwnProperty(m)&&(ka[l].omit.indexOf(m)>=0||(h[m]=$l(o[m],e)));o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof o)}function tl(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||fs(o)||ws(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(tl);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const h=o.entries||[],m=new Map;for(let _=0;_<h.length;_+=2)m.set(tl(h[_]),tl(h[_+1]));return m}if(e==="Set"){const h=new Set;for(const m of Object.keys(o))m!=="$name"&&h.add(tl(o[m]));return h}if(e==="DOMMatrix"){let h;return h=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(o.value);const{klass:r}=ka[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(o);const l=Object.create(r.prototype);for(const h of Object.keys(o))h!=="$name"&&(l[h]=tl(o[h]));return l}throw new Error("can't deserialize object of type "+typeof o)}const Ln={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Hh(o){for(const e of o)if(rm(e.charCodeAt(0)))return!0;return!1}function qh(o){for(const e of o)if(!Jc(e.charCodeAt(0)))return!1;return!0}function Jc(o){return!(Ln.Arabic(o)||Ln["Arabic Supplement"](o)||Ln["Arabic Extended-A"](o)||Ln["Arabic Presentation Forms-A"](o)||Ln["Arabic Presentation Forms-B"](o))}function rm(o){return!(o!==746&&o!==747&&(o<4352||!(Ln["Bopomofo Extended"](o)||Ln.Bopomofo(o)||Ln["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Ln["CJK Compatibility Ideographs"](o)||Ln["CJK Compatibility"](o)||Ln["CJK Radicals Supplement"](o)||Ln["CJK Strokes"](o)||!(!Ln["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Ln["CJK Unified Ideographs Extension A"](o)||Ln["CJK Unified Ideographs"](o)||Ln["Enclosed CJK Letters and Months"](o)||Ln["Hangul Compatibility Jamo"](o)||Ln["Hangul Jamo Extended-A"](o)||Ln["Hangul Jamo Extended-B"](o)||Ln["Hangul Jamo"](o)||Ln["Hangul Syllables"](o)||Ln.Hiragana(o)||Ln["Ideographic Description Characters"](o)||Ln.Kanbun(o)||Ln["Kangxi Radicals"](o)||Ln["Katakana Phonetic Extensions"](o)||Ln.Katakana(o)&&o!==12540||!(!Ln["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Ln["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Ln["Unified Canadian Aboriginal Syllabics"](o)||Ln["Unified Canadian Aboriginal Syllabics Extended"](o)||Ln["Vertical Forms"](o)||Ln["Yijing Hexagram Symbols"](o)||Ln["Yi Syllables"](o)||Ln["Yi Radicals"](o))))}function Ls(o){return!(rm(o)||(function(e){return!!(Ln["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ln["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ln["Letterlike Symbols"](e)||Ln["Number Forms"](e)||Ln["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ln["Control Pictures"](e)&&e!==9251||Ln["Optical Character Recognition"](e)||Ln["Enclosed Alphanumerics"](e)||Ln["Geometric Shapes"](e)||Ln["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ln["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ln["CJK Symbols and Punctuation"](e)||Ln.Katakana(e)||Ln["Private Use Area"](e)||Ln["CJK Compatibility Forms"](e)||Ln["Small Form Variants"](e)||Ln["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(o))}function op(o){return Ln.Arabic(o)||Ln["Arabic Supplement"](o)||Ln["Arabic Extended-A"](o)||Ln["Arabic Presentation Forms-A"](o)||Ln["Arabic Presentation Forms-B"](o)}function sm(o){return o>=1424&&o<=2303||Ln["Arabic Presentation Forms-A"](o)||Ln["Arabic Presentation Forms-B"](o)}function ay(o,e){return!(!e&&sm(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Ln.Khmer(o))}function ly(o){for(const e of o)if(sm(e.charCodeAt(0)))return!0;return!1}const ja={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let ap=null,ko=ja.unavailable,Tc=null;const aa=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ko=ja.error),ap&&ap(o)};function $s(){Zh.fire(new Zo("pluginStateChange",{pluginStatus:ko,pluginURL:Tc}))}const Zh=new Bc,Cd=function(){return ko},Wh=function(){if(ko!==ja.deferred||!Tc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ko=ja.loading,$s(),Tc&&Ya({url:Tc},(o=>{o?aa(o):(ko=ja.loaded,$s())}))},la={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ko===ja.loaded||la.applyArabicShaping!=null,isLoading:()=>ko===ja.loading,setState(o){ko=o.pluginStatus,Tc=o.pluginURL},isParsing:()=>ko===ja.parsing,isParsed:()=>ko===ja.parsed,getPluginURL:()=>Tc};class ir{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview,this.activeFloors=r.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(r,l){for(const h of r)if(!ay(h.charCodeAt(0),l))return!1;return!0})(e,la.isLoaded())}}class Iu{constructor(e,r,l,h,m){this.property=e,this.value=r,this.expression=(function(_,v,A,R,P){if(Uh(_))return new Gh(_,v);if($h(_)||Array.isArray(_)&&_.length>0){const L=wc(_,v,A,R,P);if(L.result==="error")throw new Error(L.value.map((N=>`${N.key}: ${N.message}`)).join(", "));return L.value}{let L=_;return typeof _=="string"&&v.type==="color"&&(L=nr.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>L}}})(r===void 0?e.specification.default:r,e.specification,l,h,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l,h){return this.property.possiblyEvaluate(this,e,r,l,h)}}class Du{constructor(e,r,l,h){this.property=e,this.value=new Iu(e,void 0,r,l,h)}transitioned(e,r){return new Mg(this.property,this.value,r,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Mg(this.property,this.value,null,{},0)}}class om{constructor(e,r,l,h){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=l,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return vn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Du(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Iu(this._values[e].property,r===null?void 0:vn(r),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,r){r&&(this._options=r);const l=this._properties.properties;if(e)for(const h in e){const m=e[h];if(h.endsWith("-transition")){const _=h.slice(0,-11);l[_]&&this.setTransition(_,m)}else l.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(e){return vn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Du(this._values[e].property)),this._values[e].transition=vn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const h=this.getTransition(r);h!==void 0&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const l=new Ec(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,r._values[h]);return l}untransitioned(){const e=new Ec(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Mg{constructor(e,r,l,h,m){const _=h.delay||0,v=h.duration||0;m=m||0,this.property=e,this.value=r,this.begin=m+_,this.end=this.begin+v,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const h=e.now||0,m=this.value.possiblyEvaluate(e,r,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(e,r,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,l),m,_a(v))}}return m}}class Ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const h=new Pu(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,r,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class am{constructor(e,r,l,h){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=l,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return vn(this._values[e].value)}setValue(e,r){this._values[e]=new Iu(this._values[e].property,r===null?void 0:vn(r),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l,h){const m=new Pu(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(e,r,l,h);return m}isIndoorDependent(){return this._isIndoorDependent}}class nl{constructor(e,r,l,h){this.property=e,this.value=r,this.parameters=l,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,h){return this.property.evaluate(this.value,this.parameters,e,r,l,h,this.iconImageUseTheme)}}class Pu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Vt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,l){const h=Vc[this.specification.type];return h?h(e,r,l):e}}class un{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,h,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new nl(this,{kind:"constant",value:e.expression.evaluate(r,null,{},l,h,void 0,m)},r):new nl(this,e.expression,r,m)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new nl(this,{kind:"constant",value:void 0},e.parameters);const h=Vc[this.specification.type];return h?new nl(this,{kind:"constant",value:h(e.value.value,r.value.value,l)},e.parameters):e}evaluate(e,r,l,h,m,_,v){return e.kind==="constant"?e.value:e.evaluate(r,l,h,m,_,void 0,v)}}class Rd{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,h){return!!e.expression.evaluate(r,null,{},l,h)}interpolate(){return!1}}class ss{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new ir(0,{});for(const l in e){const h=e[l];h.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new Iu(h,void 0),_=this.defaultTransitionablePropertyValues[l]=new Du(h);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(r)}}}jt(un,"DataDrivenProperty"),jt(Vt,"DataConstantProperty"),jt(Rd,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function lm(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Md(o){if(Array.isArray(o))return o.map(Md);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const r in o)e[r]=Md(o[r]);return e}return lm(o)}function Ou(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Ou(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function lp(o,e="",r=null,l="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ou(o)||(o=jo(o));const h=o;let m=!0;try{m=(function(P){if(!Dd(P))return P;let L=Md(P);return Id(L),L=cp(L),L})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let _=null,v=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){v=Ye[`filter_${l}`];const P=bl(m,v,e,r);if(P.result==="error")throw new Error(P.value.map((L=>`${L.key}: ${L.message}`)).join(", "));_=(L,N,U)=>P.value.evaluate(L,N,{},U)}let A=null,R=null;if(m!==h){const P=bl(h,v,e,r);if(P.result==="error")throw new Error(P.value.map((L=>`${L.key}: ${L.message}`)).join(", "));A=(L,N,U,$,X)=>P.value.evaluate(L,N,{},U,void 0,void 0,$,X),R=!vd(P.value.expression)}return{filter:_,dynamicFilter:A||void 0,needGeometry:Ig(m),needFeature:!!R}}function cp(o){if(!Array.isArray(o))return o;const e=(function(r){if(cy.has(r[0])){for(let l=1;l<r.length;l++)if(Dd(r[l]))return!0}return r})(o);return e===!0?e:e.map((r=>cp(r)))}function Id(o){let e=!1;const r=[];if(o[0]==="case"){for(let l=1;l<o.length-1;l+=2)e=e||Dd(o[l]),r.push(o[l+1]);r.push(o[o.length-1])}else if(o[0]==="match"){e=e||Dd(o[1]);for(let l=2;l<o.length-1;l+=2)r.push(o[l+1]);r.push(o[o.length-1])}else if(o[0]==="step"){e=e||Dd(o[1]);for(let l=1;l<o.length-1;l+=2)r.push(o[l+1])}e&&(o.length=0,o.push("any",...r));for(let l=1;l<o.length;l++)Id(o[l])}function Dd(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<o.length;r++)if(Dd(o[r]))return!0;return!1}const cy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uy(o,e){return o<e?-1:o>e?1:0}function Ig(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(Ig(o[e]))return!0;return!1}function jo(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?cm(o[1],o[2],"=="):e==="!="?dp(cm(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?cm(o[1],o[2],e):e==="any"?(r=o.slice(1),["any"].concat(r.map(jo))):e==="all"?["all"].concat(o.slice(1).map(jo)):e==="none"?["all"].concat(o.slice(1).map(jo).map(dp)):e==="in"?Xh(o[1],o.slice(2)):e==="!in"?dp(Xh(o[1],o.slice(2))):e==="has"?up(o[1]):e!=="!has"||dp(up(o[1]));var r}function cm(o,e,r){switch(o){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,o,e]}}function Xh(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",o,["literal",e.sort(uy)]]:["filter-in-small",o,["literal",e]]}}function up(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function dp(o){return["!",o]}const Pd="";function Od(o,e){return e?`${o}${Pd}${e}`:o}let Dg;const Pg=()=>Dg||(Dg=new ss({"icon-size":new un(Ye.layout_symbol["icon-size"]),"icon-image":new un(Ye.layout_symbol["icon-image"]),"icon-rotate":new un(Ye.layout_symbol["icon-rotate"]),"icon-offset":new un(Ye.layout_symbol["icon-offset"])}));class dy{constructor(e,r,l,h,m,_){this.cachedIconPrimary=null;const v=bl(e,Ye.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=r,l){this.properties=new Pu(Pg()),this.unevaluatedLayout=new am(Pg(),h,m,_);for(const A in l)this.unevaluatedLayout.setValue(A,l[A])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,r,l){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,r,l))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const Og="-transition",hy=new Set(["fill","line","background","hillshade","raster"]);class Ao extends Bc{constructor(e,r,l,h,m,_){if(super(),this.id=e.id,this.fqid=Od(this.id,l),this.type=e.type,this.scope=l,this.lut=h,this.options=m,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=bl(this.filter,Ye[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),r.layout&&(this._unevaluatedLayout=new am(r.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),r.paint){this._transitionablePaint=new om(r.paint,this.scope,m);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pu(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&hy.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((r=>{this.appearances.push(new dy(r.condition,r.name,r.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Og)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,r){const l=this._transitionablePaint,h=l._properties.properties;if(e.endsWith(Og)){const L=e.slice(0,-11);return h[L]&&l.setTransition(L,r||void 0),!1}if(!h[e])return!1;const m=l._values[e],_=m.value.isDataDriven(),v=m.value;l.setValue(e,r),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...l.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||l.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const A=l._values[e].value,R=A.isDataDriven(),P=e.endsWith("pattern")||e==="line-dasharray";return R||_||P||this._handleOverridablePaintPropertyUpdate(e,v,A)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,l){return null}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((r=>r.serialize()))),It(e,((r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof nl&&Vh(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}for(const e of this.appearances)if(!ro(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=lp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,r,l){return{}}queryRadius(e){}queryIntersectsFeature(e,r,l,h,m,_,v,A,R){}}const fy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kh{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ar{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&r.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xi(o,e=1){let r=0,l=0;return{members:o.map((h=>{const m=fy[h.type].BYTES_PER_ELEMENT,_=r=um(r,Math.max(e,m)),v=h.components||1;return l=Math.max(l,m),r+=m*v,{name:h.name,type:h.type,components:v,offset:_}})),size:um(r,Math.max(l,e)),alignment:e}}function um(o,e){return Math.ceil(o/e)*e}class ba extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=l,e}}ba.prototype.bytesPerElement=4,jt(ba,"StructArrayLayout2i4");class eu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=h,e}}eu.prototype.bytesPerElement=6,jt(eu,"StructArrayLayout3i6");class zd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,h)}emplace(e,r,l,h,m){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=m,e}}zd.prototype.bytesPerElement=8,jt(zd,"StructArrayLayout4i8");class Ac extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ac.prototype.bytesPerElement=4,jt(Ac,"StructArrayLayout1f4");class hp extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const m=4*e,_=2*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.float32[_+1]=h,e}}hp.prototype.bytesPerElement=8,jt(hp,"StructArrayLayout2i1f8");class dm extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=h,e}}dm.prototype.bytesPerElement=8,jt(dm,"StructArrayLayout3i8");class fp extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,h,m)}emplace(e,r,l,h,m,_){const v=5*e;return this.int16[v+0]=r,this.int16[v+1]=l,this.int16[v+2]=h,this.int16[v+3]=m,this.int16[v+4]=_,e}}fp.prototype.bytesPerElement=10,jt(fp,"StructArrayLayout5i10");class hm extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,h,m,_,v)}emplace(e,r,l,h,m,_,v,A){const R=6*e,P=12*e,L=3*e;return this.int16[R+0]=r,this.int16[R+1]=l,this.uint8[P+4]=h,this.uint8[P+5]=m,this.uint8[P+6]=_,this.uint8[P+7]=v,this.float32[L+2]=A,e}}hm.prototype.bytesPerElement=12,jt(hm,"StructArrayLayout2i4ub1f12");class il extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=l,this.float32[m+2]=h,e}}il.prototype.bytesPerElement=12,jt(il,"StructArrayLayout3f12");class tu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,h,m)}emplace(e,r,l,h,m,_){const v=6*e,A=3*e;return this.uint16[v+0]=r,this.uint16[v+1]=l,this.uint16[v+2]=h,this.uint16[v+3]=m,this.float32[A+2]=_,e}}tu.prototype.bytesPerElement=12,jt(tu,"StructArrayLayout4ui1f12");class Gl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,h)}emplace(e,r,l,h,m){const _=4*e;return this.uint16[_+0]=r,this.uint16[_+1]=l,this.uint16[_+2]=h,this.uint16[_+3]=m,e}}Gl.prototype.bytesPerElement=8,jt(Gl,"StructArrayLayout4ui8");class Yh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,m,_)}emplace(e,r,l,h,m,_,v){const A=6*e;return this.int16[A+0]=r,this.int16[A+1]=l,this.int16[A+2]=h,this.int16[A+3]=m,this.int16[A+4]=_,this.int16[A+5]=v,e}}Yh.prototype.bytesPerElement=12,jt(Yh,"StructArrayLayout6i12");class Ld extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R,P,L,N){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,l,h,m,_,v,A,R,P,L,N)}emplace(e,r,l,h,m,_,v,A,R,P,L,N,U){const $=12*e;return this.int16[$+0]=r,this.int16[$+1]=l,this.int16[$+2]=h,this.int16[$+3]=m,this.uint16[$+4]=_,this.uint16[$+5]=v,this.uint16[$+6]=A,this.uint16[$+7]=R,this.int16[$+8]=P,this.int16[$+9]=L,this.int16[$+10]=N,this.int16[$+11]=U,e}}Ld.prototype.bytesPerElement=24,jt(Ld,"StructArrayLayout4i4ui4i24");class Nd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,m,_)}emplace(e,r,l,h,m,_,v){const A=10*e,R=5*e;return this.int16[A+0]=r,this.int16[A+1]=l,this.int16[A+2]=h,this.float32[R+2]=m,this.float32[R+3]=_,this.float32[R+4]=v,e}}Nd.prototype.bytesPerElement=20,jt(Nd,"StructArrayLayout3i3f20");class nu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,h)}emplace(e,r,l,h,m){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=m,e}}nu.prototype.bytesPerElement=16,jt(nu,"StructArrayLayout4f16");class kd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}kd.prototype.bytesPerElement=4,jt(kd,"StructArrayLayout1ul4");class rl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=l,e}}rl.prototype.bytesPerElement=4,jt(rl,"StructArrayLayout2ui4");class pp extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R,P,L,N,U){const $=this.length;return this.resize($+1),this.emplace($,e,r,l,h,m,_,v,A,R,P,L,N,U)}emplace(e,r,l,h,m,_,v,A,R,P,L,N,U,$){const X=20*e,Q=10*e;return this.int16[X+0]=r,this.int16[X+1]=l,this.int16[X+2]=h,this.int16[X+3]=m,this.int16[X+4]=_,this.float32[Q+3]=v,this.float32[Q+4]=A,this.float32[Q+5]=R,this.float32[Q+6]=P,this.int16[X+14]=L,this.uint32[Q+8]=N,this.uint16[X+18]=U,this.uint16[X+19]=$,e}}pp.prototype.bytesPerElement=40,jt(pp,"StructArrayLayout5i4f1i1ul2ui40");class mp extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,h,m,_,v)}emplace(e,r,l,h,m,_,v,A){const R=8*e;return this.int16[R+0]=r,this.int16[R+1]=l,this.int16[R+2]=h,this.int16[R+4]=m,this.int16[R+5]=_,this.int16[R+6]=v,this.int16[R+7]=A,e}}mp.prototype.bytesPerElement=16,jt(mp,"StructArrayLayout3i2i2i16");class zu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,h,m)}emplace(e,r,l,h,m,_){const v=4*e,A=8*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[A+6]=m,this.int16[A+7]=_,e}}zu.prototype.bytesPerElement=16,jt(zu,"StructArrayLayout2f1f2i16");class Lu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,m,_)}emplace(e,r,l,h,m,_,v){const A=20*e,R=5*e;return this.uint8[A+0]=r,this.uint8[A+1]=l,this.float32[R+1]=h,this.float32[R+2]=m,this.float32[R+3]=_,this.float32[R+4]=v,e}}Lu.prototype.bytesPerElement=20,jt(Lu,"StructArrayLayout2ub4f20");class kr extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=l,this.uint16[m+2]=h,e}}kr.prototype.bytesPerElement=6,jt(kr,"StructArrayLayout3ui6");class jd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie)}emplace(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie,Ee){const Ne=30*e,Be=15*e,Ue=60*e;return this.int16[Ne+0]=r,this.int16[Ne+1]=l,this.int16[Ne+2]=h,this.float32[Be+2]=m,this.float32[Be+3]=_,this.uint16[Ne+8]=v,this.uint16[Ne+9]=A,this.uint32[Be+5]=R,this.uint32[Be+6]=P,this.uint32[Be+7]=L,this.uint16[Ne+16]=N,this.uint16[Ne+17]=U,this.uint16[Ne+18]=$,this.float32[Be+10]=X,this.float32[Be+11]=Q,this.uint8[Ue+48]=te,this.uint8[Ue+49]=ce,this.uint8[Ue+50]=he,this.uint32[Be+13]=me,this.int16[Ne+28]=Ie,this.uint8[Ue+58]=Ee,e}}jd.prototype.bytesPerElement=60,jt(jd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class iu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie,Ee,Ne,Be,Ue,ft,Qe,mt,wt,Dt,Xt,Nt,Tt){const Lt=this.length;return this.resize(Lt+1),this.emplace(Lt,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie,Ee,Ne,Be,Ue,ft,Qe,mt,wt,Dt,Xt,Nt,Tt)}emplace(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie,Ee,Ne,Be,Ue,ft,Qe,mt,wt,Dt,Xt,Nt,Tt,Lt){const ht=20*e,lt=40*e,zt=80*e;return this.float32[ht+0]=r,this.float32[ht+1]=l,this.int16[lt+4]=h,this.int16[lt+5]=m,this.int16[lt+6]=_,this.int16[lt+7]=v,this.int16[lt+8]=A,this.int16[lt+9]=R,this.int16[lt+10]=P,this.int16[lt+11]=L,this.int16[lt+12]=N,this.uint16[lt+13]=U,this.uint16[lt+14]=$,this.uint16[lt+15]=X,this.uint16[lt+16]=Q,this.uint16[lt+17]=te,this.uint16[lt+18]=ce,this.uint16[lt+19]=he,this.uint16[lt+20]=me,this.uint16[lt+21]=Ie,this.uint16[lt+22]=Ee,this.uint16[lt+23]=Ne,this.uint16[lt+24]=Be,this.uint16[lt+25]=Ue,this.uint16[lt+26]=ft,this.uint16[lt+27]=Qe,this.uint32[ht+14]=mt,this.float32[ht+15]=wt,this.float32[ht+16]=Dt,this.float32[ht+17]=Xt,this.float32[ht+18]=Nt,this.uint8[zt+76]=Tt,this.uint16[lt+39]=Lt,e}}iu.prototype.bytesPerElement=80,jt(iu,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class fm extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,m,_)}emplace(e,r,l,h,m,_,v){const A=6*e;return this.float32[A+0]=r,this.float32[A+1]=l,this.float32[A+2]=h,this.float32[A+3]=m,this.float32[A+4]=_,this.float32[A+5]=v,e}}fm.prototype.bytesPerElement=24,jt(fm,"StructArrayLayout6f24");class Nu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,h,m)}emplace(e,r,l,h,m,_){const v=5*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=h,this.float32[v+3]=m,this.float32[v+4]=_,e}}Nu.prototype.bytesPerElement=20,jt(Nu,"StructArrayLayout5f20");class pm extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,h,m,_,v)}emplace(e,r,l,h,m,_,v,A){const R=7*e;return this.float32[R+0]=r,this.float32[R+1]=l,this.float32[R+2]=h,this.float32[R+3]=m,this.float32[R+4]=_,this.float32[R+5]=v,this.float32[R+6]=A,e}}pm.prototype.bytesPerElement=28,jt(pm,"StructArrayLayout7f28");class ku extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R,P,L){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,l,h,m,_,v,A,R,P,L)}emplace(e,r,l,h,m,_,v,A,R,P,L,N){const U=11*e;return this.float32[U+0]=r,this.float32[U+1]=l,this.float32[U+2]=h,this.float32[U+3]=m,this.float32[U+4]=_,this.float32[U+5]=v,this.float32[U+6]=A,this.float32[U+7]=R,this.float32[U+8]=P,this.float32[U+9]=L,this.float32[U+10]=N,e}}ku.prototype.bytesPerElement=44,jt(ku,"StructArrayLayout11f44");class mm extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,l,h,m,_,v,A,R)}emplace(e,r,l,h,m,_,v,A,R,P){const L=9*e;return this.float32[L+0]=r,this.float32[L+1]=l,this.float32[L+2]=h,this.float32[L+3]=m,this.float32[L+4]=_,this.float32[L+5]=v,this.float32[L+6]=A,this.float32[L+7]=R,this.float32[L+8]=P,e}}mm.prototype.bytesPerElement=36,jt(mm,"StructArrayLayout9f36");class Cc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=l,e}}Cc.prototype.bytesPerElement=8,jt(Cc,"StructArrayLayout2f8");class gm extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,h)}emplace(e,r,l,h,m){const _=6*e;return this.uint32[3*e+0]=r,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=m,e}}gm.prototype.bytesPerElement=12,jt(gm,"StructArrayLayout1ul3ui12");class gp extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}gp.prototype.bytesPerElement=2,jt(gp,"StructArrayLayout1ui2");class _m extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q){const te=this.length;return this.resize(te+1),this.emplace(te,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q)}emplace(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te){const ce=16*e;return this.float32[ce+0]=r,this.float32[ce+1]=l,this.float32[ce+2]=h,this.float32[ce+3]=m,this.float32[ce+4]=_,this.float32[ce+5]=v,this.float32[ce+6]=A,this.float32[ce+7]=R,this.float32[ce+8]=P,this.float32[ce+9]=L,this.float32[ce+10]=N,this.float32[ce+11]=U,this.float32[ce+12]=$,this.float32[ce+13]=X,this.float32[ce+14]=Q,this.float32[ce+15]=te,e}}_m.prototype.bytesPerElement=64,jt(_m,"StructArrayLayout16f64");class ju extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,m,_,v){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,h,m,_,v)}emplace(e,r,l,h,m,_,v,A){const R=10*e,P=5*e;return this.uint16[R+0]=r,this.uint16[R+1]=l,this.uint16[R+2]=h,this.uint16[R+3]=m,this.float32[P+2]=_,this.float32[P+3]=v,this.float32[P+4]=A,e}}ju.prototype.bytesPerElement=20,jt(ju,"StructArrayLayout4ui3f20");class Js extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Js.prototype.bytesPerElement=2,jt(Js,"StructArrayLayout1i2");class fo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}fo.prototype.bytesPerElement=1,jt(fo,"StructArrayLayout1ub1");class ym extends Kh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ym.prototype.size=40;class zg extends pp{get(e){return new ym(this,e)}}jt(zg,"CollisionBoxArray");class _p extends Kh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}_p.prototype.size=60;class Qh extends jd{get(e){return new _p(this,e)}}jt(Qh,"PlacedSymbolArray");class Fd extends Kh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Fd.prototype.size=80;class Lg extends iu{get(e){return new Fd(this,e)}}jt(Lg,"SymbolInstanceArray");class Jh extends Ac{getoffsetX(e){return this.float32[1*e+0]}}jt(Jh,"GlyphOffsetArray");class Ng extends ba{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}jt(Ng,"SymbolLineVertexArray");class xm extends Kh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xm.prototype.size=12;class yp extends gm{get(e){return new xm(this,e)}}jt(yp,"FeatureIndexArray");class vm extends rl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}jt(vm,"FillExtrusionCentroidArray");class kg extends Kh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}kg.prototype.size=6;class jg extends eu{get(e){return new kg(this,e)}}jt(jg,"FillExtrusionWallArray");const Fg=xi([{name:"a_pos",components:2,type:"Int16"}],4),Bg=xi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Vg=xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Br{constructor(e=[]){this.segments=e}_prepareSegment(e,r,l,h){let m=this.segments[this.segments.length-1];return e>Br.MAX_VERTEX_ARRAY_LENGTH&&Tn(`Max vertices per segment is ${Br.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Br.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:r,primitiveOffset:l,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(e,r,l,h){return this._prepareSegment(e,r.length,l.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,h){return new Br([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function Ug(o,e){return 256*(o=se(Math.floor(o),0,255))+se(Math.floor(e),0,255)}Br.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt(Br,"SegmentVector");const $g=xi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),bm=xi([{name:"a_pattern_b",components:4,type:"Uint16"}]),Gg=xi([{name:"a_dash",components:4,type:"Uint16"}]);class ef{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,l,h){this.ids.push(Bd(e)),this.positions.push(r,l,h)}eachPosition(e,r){const l=Bd(e);let h=0,m=this.ids.length-1;for(;h<m;){const _=h+m>>1;this.ids[_]>=l?m=_:h=_+1}for(;this.ids[h]===l;)r(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,r){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return wm(l,h,0,l.length-1),r&&(r.add(l.buffer),r.add(h.buffer)),{ids:l,positions:h}}static deserialize(e){const r=new ef;let l;r.ids=e.ids,r.positions=e.positions;for(const h of r.ids)h!==l&&r.uniqueIds.push(h),l=h;return r.indexed=!0,r}}function Bd(o){const e=+o;return Number.isSafeInteger(e)?e:rd(String(o))}function wm(o,e,r,l){for(;r<l;){const h=o[r+l>>1];let m=r-1,_=l+1;for(;;){do m++;while(o[m]<h);do _--;while(o[_]>h);if(m>=_)break;Sl(o,m,_),Sl(e,3*m,3*_),Sl(e,3*m+1,3*_+1),Sl(e,3*m+2,3*_+2)}_-r<l-_?(wm(o,e,r,_),r=_+1):(wm(o,e,_+1,l),l=_)}}function Sl(o,e,r){const l=o[e];o[e]=o[r],o[r]=l}jt(ef,"FeaturePositionMap");class Fa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Sm extends Fa{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Ss extends Fa{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Fo extends Fa{constructor(e){super(e),this.current=[0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Fu extends Fa{constructor(e){super(e),this.current=[0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class tf extends Fa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class nf extends Fa{constructor(e){super(e),this.current=nr.transparent.toPremultipliedRenderColor(null)}set(e,r,l){this.fetchUniformLocation(e,r)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const rf=new Float32Array(16);class _s extends Fa{constructor(e){super(e),this.current=rf}set(e,r,l){if(this.fetchUniformLocation(e,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Qx=new Float32Array(9),py=new Float32Array(4);class Tm extends Fa{constructor(e){super(e),this.current=py}set(e,r,l){if(this.fetchUniformLocation(e,r)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Vd(o){return[Ug(255*o.r,255*o.g),Ug(255*o.b,255*o.a)]}function Hl(o,e,r,l,h,m,_,v){return!!o&&(o.kind==="composite"||o.kind==="source"?o.evaluate(new ir(0,{brightness:m,worldview:v}),e,r,h,l,_)==="none":o.value==="none")}class xp{constructor(e,r,l,h){this.value=e,this.uniformNames=r.map((m=>`u_${m}`)),this.type=l,this.context=h}setUniform(e,r,l,h,m){const _=h.constantOr(this.value);r.set(e,m,_ instanceof nr?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,r){return this.type==="color"?new nf(e):new Ss(e)}}class sf{constructor(e,r){this.uniformNames=r.map((l=>`u_${l}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,r){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(e,r,l,h,m){let _=null;m!=="u_pattern"&&m!=="u_dash"||(_=this.pattern),m==="u_pattern_b"&&(_=this.patternTransition),m==="u_pixel_ratio"&&(_=this.pixelRatio),_&&r.set(e,m,_)}getBinding(e,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new tf(e):new Ss(e)}}class sl{constructor(e,r,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map((m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,r,l,h,m,_,v,A){const R=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ir(0,{brightness:_,worldview:A}),r,{},m,h,v):this.expression.kind==="constant"&&this.expression.value,L=Hl(this.lutExpression,r,{},h,m,_,v,A);this.paintVertexArray.resize(e),this._setPaintValue(R,e,P,L?null:this.context.lut)}updatePaintArray(e,r,l,h,m,_,v,A){const R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:A},l,h,void 0,m):this.expression.kind==="constant"&&this.expression.value,P=Hl(this.lutExpression,l,h,m,void 0,v,void 0,A);this._setPaintValue(e,r,R,P?null:this.context.lut)}_setPaintValue(e,r,l,h){if(this.type==="color"){const m=Vd(l.toPremultipliedRenderColor(h));for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class po{constructor(e,r,l,h,m,_){this.expression=e,this.uniformNames=r.map((v=>`u_${v}_t`)),this.type=l,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=r.map((v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,r,l,h,m,_,v,A){const R=this.expression.evaluate(new ir(this.context.zoom,{brightness:_,worldview:A}),r,{},m,h,v),P=this.expression.evaluate(new ir(this.context.zoom+1,{brightness:_,worldview:A}),r,{},m,h,v),L=Hl(this.lutExpression,r,{},h,m,_,v,A),N=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(N,e,R,P,L?null:this.context.lut)}updatePaintArray(e,r,l,h,m,_,v,A){const R=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:A},l,h,void 0,m),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:A},l,h,void 0,m),L=Hl(this.lutExpression,l,h,m,void 0,v,void 0,A);this._setPaintValue(e,r,R,P,L?null:this.context.lut)}_setPaintValue(e,r,l,h,m){if(this.type==="color"){const _=Vd(l.toPremultipliedRenderColor(m)),v=Vd(l.toPremultipliedRenderColor(m));for(let A=e;A<r;A++)this.paintVertexArray.emplace(A,_[0],_[1],v[0],v[1])}else{for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,l,h,m){const _=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=se(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);r.set(e,m,v)}getBinding(e,r){return new Ss(e)}}class Co{constructor(e,r,l,h,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(l==="array"?Gg:$g).members;for(let _=0;_<r.length;++_);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Gl}populatePaintArray(e,r,l,h){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,h,m,_,v){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,r,l,h){if(!h||!l)return;const m=h[l[0]],_=h[l[1]];if(m){if(m){const{tl:v,br:A,pixelRatio:R}=m;for(let P=e;P<r;P++)this.paintVertexArray.emplace(P,v[0],v[1],A[0],A[1],R)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:A}=_;for(let R=e;R<r;R++)this.paintTransitionVertexArray.emplace(R,v[0],v[1],A[0],A[1])}}}upload(e){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,bm.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ql{constructor(e,r,l=(()=>!0)){this.binders={},this._buffers=[],this.context=r;const h=[];for(const m in e.paint._values){const _=e.paint.get(m);if(m.endsWith("-use-theme")||!l(m)||!(_ instanceof nl&&Vh(_.property.specification)))continue;const v=qg(m,e.type),A=_.value,R=_.property.specification.type,P=!!_.property.useIntegerZoom,L=m==="line-dasharray"||m.endsWith("pattern"),N=e.paint.get(`${m}-use-theme`),U=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(A.kind!=="constant"||U)if(A.kind==="source"||U||L){const $=Zl(m,R,"source");this.binders[m]=L?new Co(A,v,R,$,e.id):new sl(A,v,R,$),h.push(`/a_${m}`)}else{const $=Zl(m,R,"composite");this.binders[m]=new po(A,v,R,P,r,$),h.push(`/z_${m}`)}else this.binders[m]=L?new sf(A.value,v):new xp(A.value,v,R,r),h.push(`/u_${m}`);N&&(this.binders[m].lutExpression=N.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof sl||r instanceof po?r.maxValue:0}populatePaintArrays(e,r,l,h,m,_,v,A){for(const R in this.binders){const P=this.binders[R];P.context=this.context,(P instanceof sl||P instanceof po||P instanceof Co)&&P.populatePaintArray(e,r,l,h,m,_,v,A)}}setConstantPatternPositions(e,r){for(const l in this.binders){const h=this.binders[l];h instanceof sf&&h.setConstantPatternPositions(e,r)}}getPatternTransitionVertexBuffer(e){const r=this.binders[e];return r instanceof Co?r.paintTransitionVertexBuffer:null}updatePaintArrays(e,r,l,h,m,_,v,A,R,P){let L=!1;const N=Object.keys(e),U=N.length!==0&&!A,$=U?N:r.uniqueIds;this.context.lut=m.lut;for(const X in this.binders){const Q=this.binders[X];if(Q.context=this.context,(Q instanceof sl||Q instanceof po||Q instanceof Co)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const te=m.paint.get(X);Q.expression=te.value;for(const ce of $){const he=e[ce.toString()];r.eachPosition(ce,((me,Ie,Ee)=>{const Ne=h.feature(me);Q.updatePaintArray(Ie,Ee,Ne,he,_,v,R,P)}))}if(!U)for(const ce of l.uniqueIds){const he=e[ce.toString()];l.eachPosition(ce,((me,Ie,Ee)=>{const Ne=h.feature(me);Q.updatePaintArray(Ie,Ee,Ne,he,_,v,R,P)}))}L=!0}}return L}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof xp||l instanceof sf)&&e.push(...l.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof xp||h instanceof sf||h instanceof po)for(const m of h.uniformNames)r.push({name:m,property:l,binding:h.getBinding(e,m)})}return r}setUniforms(e,r,l,h,m){for(const{name:_,property:v,binding:A}of l)this.binders[v].setUniform(e,A,m,h.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof sl||r instanceof po||r instanceof Co)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof Co&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof sl||l instanceof po||l instanceof Co)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof sl||r instanceof po||r instanceof Co)&&r.destroy()}}}class Tl{constructor(e,r,l=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new ql(h,r,l);this.needsUpload=!1,this._featureMap=new ef,this._featureMapWithoutIds=new ef,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,l,h,m,_,v,A,R){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,r,h,m,_,v,A,R);r.id!==void 0?this._featureMap.add(r.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,h,m,_,v,A){for(const R of l)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,R,h,m,_,v||0,A)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Hg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function qg(o,e){return Hg[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Em={"line-pattern":{source:tu,composite:tu},"fill-pattern":{source:tu,composite:tu},"fill-extrusion-pattern":{source:tu,composite:tu},"line-dasharray":{source:Gl,composite:Gl}},my={color:{source:Cc,composite:nu},number:{source:Ac,composite:Cc}};function Zl(o,e,r){const l=Em[o];return l&&l[r]||my[e][r]}jt(xp,"ConstantBinder"),jt(sf,"PatternConstantBinder"),jt(sl,"SourceExpressionBinder"),jt(Co,"PatternCompositeBinder"),jt(po,"CompositeExpressionBinder"),jt(ql,"ProgramConfiguration",{omit:["_buffers"]}),jt(Tl,"ProgramConfigurationSet");const Hr=qt/Math.PI/2,f=5,n=6,a=16383,p=64,x=[p,32,16],b=-Hr,T=Hr;function M(o,e,r,l=Hr){return r=fi(r),[o*Math.sin(r)*l,-e*l,o*Math.cos(r)*l]}function D(o,e,r){return M(Math.cos(fi(o)),Math.sin(fi(o)),e,r)}const k=63710088e-1,F=2*Math.PI*k;class G{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new G(je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,h=e.lat*r,m=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return k*Math.acos(Math.min(m,1))}toBounds(e=0){const r=360*e/40075017,l=r/Math.cos(Math.PI/180*this.lat);return new V({lng:this.lng-l,lat:this.lat-r},{lng:this.lng+l,lat:this.lat+r})}toEcef(e){return D(this.lat,this.lng,Hr+e*Hr/k)}static convert(e){if(e instanceof G)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new G(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new G(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class V{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}setSouthWest(e){return this._sw=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}extend(e){const r=this._sw,l=this._ne;let h,m;if(e instanceof G)h=e,m=e;else{if(!(e instanceof V))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(V.convert(e)):this.extend(G.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(G.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return r||l?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new G(h.lng,h.lat),this._ne=new G(m.lng,m.lat)),this}getCenter(){return new G((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new G(this.getWest(),this.getNorth())}getSouthEast(){return new G(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=G.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){if(e)return e instanceof V?e:new V(e)}}const W=0,K=25.5;function J(o){return F*Math.cos(o*Math.PI/180)}function ae(o){return(180+o)/360}function re(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ue(o,e){return o/J(e)}function ye(o){return 360*o-180}function fe(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Ce(o,e){return o*J(fe(e))}const be=85.051129;function De(o){return Math.cos(fi(se(o,-be,be)))}function Te(o,e){const r=se(e,W,K),l=Math.pow(2,r);return De(o)*F/(512*l)}function Se(o){return 1/Math.cos(o*Math.PI/180)}function Pe(o,e=0){const r=Math.exp(Math.PI*(1-(o.y+e/qt)/(1<<o.z)*2));return 80150034*r/(r*r+1)/qt/(1<<o.z)}class Xe{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=G.convert(e);return new Xe(ae(l.lng),re(l.lat),ue(r,l.lat))}toLngLat(){return new G(ye(this.x),fe(this.y))}toAltitude(){return Ce(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F*Se(fe(this.y))}}function Ge(o,e,r,l,h,m,_,v,A){const R=(e+l)/2,P=(r+h)/2,L=new Ct(R,P);v(L),(function(N,U,$,X,Q,te){const ce=$-Q,he=X-te;return Math.abs((X-U)*ce-($-N)*he)/Math.hypot(ce,he)})(L.x,L.y,m.x,m.y,_.x,_.y)>=A?(Ge(o,e,r,R,P,m,L,v,A),Ge(o,R,P,l,h,L,_,v,A)):o.push(_)}function dt(o,e,r){let l=o[0],h=l.x,m=l.y;e(l);const _=[l];for(let v=1;v<o.length;v++){const A=o[v],{x:R,y:P}=A;e(A),Ge(_,h,m,R,P,l,A,e,r),h=R,m=P,l=A}return _}function it(o,e,r,l){if(l(e,r)){const h=e.add(r)._mult(.5);it(o,e,h,l),it(o,h,r,l)}else o.push(r)}function gt(o,e){let r=o[0];const l=[r];for(let h=1;h<o.length;h++){const m=o[h];it(l,r,m,e),r=m}return l}const Ft=Math.pow(2,14)-1,Je=-Ft-1;function Ve(o,e){const r=Math.round(o.x*e),l=Math.round(o.y*e);return o.x=se(r,Je,Ft),o.y=se(l,Je,Ft),(r<o.x||r>o.x+1||l<o.y||l>o.y+1)&&Tn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function _t(o,e,r){const l=o.loadGeometry(),h=o.extent,m=qt/h;if(e&&r&&r.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:A,y:R,projection:P}=r,L=N=>{const U=ye((e.x+N.x/h)/_),$=fe((e.y+N.y/h)/_),X=P.project(U,$);N.x=(X.x*v-A)*h,N.y=(X.y*v-R)*h};for(let N=0;N<l.length;N++)if(o.type!==1)l[N]=dt(l[N],L,1);else{const U=[];for(const $ of l[N])$.x<0||$.x>=h||$.y<0||$.y>=h||(L($),U.push($));l[N]=U}}for(const _ of l)for(const v of _)Ve(v,m);return l}function rt(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?_t(o):[]}}class Pt{constructor(e,r,l,h,m){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=m,e.readFields(Rt,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,l=[];let h,m=1,_=0,v=0,A=0;for(;e.pos<r;){if(_<=0){const R=e.readVarint();m=7&R,_=R>>3}if(_--,m===1||m===2)v+=e.readSVarint(),A+=e.readSVarint(),m===1&&(h&&l.push(h),h=[]),h&&h.push(new Ct(v,A));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&l.push(h),l}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let l=1,h=0,m=0,_=0,v=1/0,A=-1/0,R=1/0,P=-1/0;for(;e.pos<r;){if(h<=0){const L=e.readVarint();l=7&L,h=L>>3}if(h--,l===1||l===2)m+=e.readSVarint(),_+=e.readSVarint(),m<v&&(v=m),m>A&&(A=m),_<R&&(R=_),_>P&&(P=_);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,R,A,P]}toGeoJSON(e,r,l){const h=this.extent*Math.pow(2,l),m=this.extent*e,_=this.extent*r,v=this.loadGeometry();function A(N){return[360*(N.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+_)/h)*Math.PI))-90]}function R(N){return N.map(A)}let P;if(this.type===1){const N=[];for(const $ of v)N.push($[0]);const U=R(N);P=N.length===1?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U}}else if(this.type===2){const N=v.map(R);P=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=(function($){const X=$.length;if(X<=1)return[$];const Q=[];let te,ce;for(let he=0;he<X;he++){const me=Qt($[he]);me!==0&&(ce===void 0&&(ce=me<0),ce===me<0?(te&&Q.push(te),te=[$[he]]):te&&te.push($[he]))}return te&&Q.push(te),Q})(v),U=[];for(const $ of N)U.push($.map(R));P=U.length===1?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U}}}const L={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function Rt(o,e,r){o===1?e.id=r.readVarint():o===2?(function(l,h){const m=l.readVarint()+l.pos;for(;l.pos<m;){const _=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[_]=v}})(r,e):o===3?e.type=r.readVarint():o===4&&(e._geometry=r.pos)}function Qt(o){let e=0;for(let r,l,h=0,m=o.length,_=m-1;h<m;_=h++)r=o[h],l=o[_],e+=(l.x-r.x)*(r.y+l.y);return e}Pt.types=["Unknown","Point","LineString","Polygon"];class bt{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(St,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Pt(this._pbf,r,this.extent,this._keys,this._values)}}function St(o,e,r){o===15?e.version=r.readVarint():o===1?e.name=r.readString():o===5?e.extent=r.readVarint():o===2?e._features.push(r.pos):o===3?e._keys.push(r.readString()):o===4&&e._values.push((function(l){let h=null;const m=l.readVarint()+l.pos;for(;l.pos<m;){const _=l.readVarint()>>3;h=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(r))}class Jt{constructor(e,r){this.layers=e.readFields(cn,{},r)}}function cn(o,e,r){if(o===3){const l=new bt(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}const rn="3d_elevation_id",pn="level";class Fn{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,l){return this.get(e,!0,r,l)}optional(e,r,l){return this.get(e,!1,r,l)}success(){return this._valid}get(e,r,l,h){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?l(h?h(m):m):r&&(this._valid=!1),this}}class ui{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,l){return this.featureFunc(e,r,l)}parseVertex(e,r,l){return this.vertexFunc(e,r,l)}}const Jn=new ui(((o,e,r)=>o.reset(e).require(rn,(l=>{r.id=l})).optional("fixed_height_relative",(l=>{r.constantHeight=l}),Vn.decodeRelativeHeight).geometry((l=>{r.bounds=l}),dd).success()),((o,e,r)=>o.reset(e).require(rn,(l=>{r.id=l})).require("elevation_idx",(l=>{r.idx=l})).require("extent",(l=>{r.extent=l})).require("height_relative",(l=>{r.height=l}),Vn.decodeRelativeHeight).geometry((l=>{r.position=l}),Vn.getPoint).success())),Vi=new ui(((o,e,r)=>o.reset(e).require(rn,(l=>{r.id=l})).optional("fixed_height",(l=>{r.constantHeight=l}),Vn.decodeMetricHeight).geometry((l=>{r.bounds=l}),dd).success()),((o,e,r)=>o.reset(e).require(rn,(l=>{r.id=l})).require("elevation_idx",(l=>{r.idx=l})).require("extent",(l=>{r.extent=l})).require("height",(l=>{r.height=l}),Vn.decodeMetricHeight).geometry((l=>{r.position=l}),Vn.getPoint).success()));class Vn{static getPoint(e){return lo(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Vi:void 0:Jn}static parse(e){const r=[],l=[],h=e.length,m=new Fn;for(let _=0;_<h;_++){const v=e.feature(_),A=v.properties.version,R=Vn.getVersionSchema(A);if(R===void 0){Tn(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const P=v.properties.type;if(!P)continue;const L=Pt.types[v.type];if(L==="Point"&&P==="curve_point"){const N={};R.parseVertex(m,v,N)&&r.push(N)}else if(L==="Polygon"&&P==="curve_meta"){const N={};R.parseFeature(m,v,N)&&l.push(N)}}return{vertices:r,features:l}}}class Mi{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const h=Cs(r,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/h;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,!0}}class Xn{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const h=In(r,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/h;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,r,l){if((function(U,$){var X=U[0],Q=U[1],te=U[2],ce=$[0],he=$[1],me=$[2];return Math.abs(X-ce)<=O*Math.max(1,Math.abs(X),Math.abs(ce))&&Math.abs(Q-he)<=O*Math.max(1,Math.abs(Q),Math.abs(he))&&Math.abs(te-me)<=O*Math.max(1,Math.abs(te),Math.abs(me))})(this.pos,e)||r===0)return l[0]=l[1]=l[2]=0,!1;const[h,m,_]=this.dir,v=this.pos[0]-e[0],A=this.pos[1]-e[1],R=this.pos[2]-e[2],P=h*h+m*m+_*_,L=2*(v*h+A*m+R*_),N=L*L-4*P*(v*v+A*A+R*R-r*r);if(N<0){const U=Math.max(-L/2,0),$=v+h*U,X=A+m*U,Q=R+_*U,te=Math.hypot($,X,Q);return l[0]=$*r/te,l[1]=X*r/te,l[2]=Q*r/te,!1}{const U=(-L-Math.sqrt(N))/(2*P);if(U<0){const $=Math.hypot(v,A,R);return l[0]=v*r/$,l[1]=A*r/$,l[2]=R*r/$,!1}return l[0]=v+h*U,l[1]=A+m*U,l[2]=R+_*U,!0}}}class Ui{constructor(e,r,l,h,m){this.TL=e,this.TR=r,this.BR=l,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(e,r,l){const h=[-1,1,1],m=[1,1,1],_=[1,-1,1],v=[-1,-1,1],A=Ri(h,h,e),R=Ri(m,m,e),P=Ri(_,_,e),L=Ri(v,v,e);return new Ui(A,R,P,L,r/l)}}function Ai(o,e,r){let l=1/0,h=-1/0;const m=[];for(const _ of o){ti(m,_,e);const v=In(m,r);l=Math.min(l,v),h=Math.max(h,v)}return[l,h]}function zi(o,e){let r=!0;for(let l=0;l<o.planes.length;l++){const h=o.planes[l];let m=0;for(let _=0;_<e.length;_++)m+=+(In(h,e[_])+h[3]>=0);if(m===0)return 0;m!==e.length&&(r=!1)}return r?2:1}function Li(o,e){for(const r of o.projections){const l=Ai(e,o.points[0],r.axis);if(r.projection[1]<l[0]||r.projection[0]>l[1])return 0}return 1}function ii(o,e){let r=0;const l=[0,0,0,0];for(let _=0;_<o.length;_++)l[0]=o[_][0],l[1]=o[_][1],l[2]=o[_][2],l[3]=1,(h=l)[0]*(m=e)[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3]>=0&&r++;var h,m;return r}class qi{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=di.fromPoints(this.points),this.projections=[],this.frustumEdges=[ti([],this.points[2],this.points[3]),ti([],this.points[0],this.points[3]),ti([],this.points[4],this.points[0]),ti([],this.points[5],this.points[1]),ti([],this.points[6],this.points[2]),ti([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const h=[0,-l[2],l[1]],m=[l[2],0,-l[0]];this.projections.push({axis:h,projection:Ai(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:Ai(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,r,l,h){const m=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>{const P=yn([],R,e),L=1/P[3]/r*m;return(N=P)[0]=(U=P)[0]*($=[L,L,h?1/P[3]:L,L])[0],N[1]=U[1]*$[1],N[2]=U[2]*$[2],N[3]=U[3]*$[3],N;var N,U,$})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((R=>{const P=An([],gi([],ti([],_[R[0]],_[R[1]]),ti([],_[R[2]],_[R[1]]))),L=-In(P,_[R[1]]);return P.concat(L)})),A=[];for(let R=0;R<_.length;R++)A.push([_[R][0],_[R][1],_[R][2]]);return new qi(A,v)}intersectsPrecise(e,r,l){for(let h=0;h<r.length;h++)if(!ii(e,r[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!ii(e,this.planes[h]))return 0;for(const h of l)for(const m of this.frustumEdges){const _=gi([],h,m),v=on(_);if(v===0)continue;vt(_,_,1/v);const A=Ai(this.points,this.points[0],_),R=Ai(e,this.points[0],_);if(A[0]>R[1]||R[0]>A[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const l=r[3];if(In([r[0],r[1],r[2]],e)+l<0)return!1}return!0}}class di{static fromPoints(e){const r=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of e)Me(r,r,h),ct(l,l,h);return new di(r,l)}static fromTileIdAndHeight(e,r,l){const h=1<<e.canonical.z,m=e.canonical.x,_=e.canonical.y;return new di([m/h,_/h,r],[(m+1)/h,(_+1)/h,l])}static applyTransform(e,r){const l=e.getCorners();for(let h=0;h<l.length;++h)Ri(l[h],l[h],r);return di.fromPoints(l)}static applyTransformFast(e,r){const l=[r[12],r[13],r[14]],h=[...l];for(let m=0;m<3;m++)for(let _=0;_<3;_++){const v=r[4*_+m],A=v*e.min[_],R=v*e.max[_];l[m]+=Math.min(A,R),h[m]+=Math.max(A,R)}return new di(l,h)}static projectAabbCorners(e,r){const l=e.getCorners();for(let h=0;h<l.length;++h)Ri(l[h],l[h],r);return l}constructor(e,r){this.min=e,this.max=r,this.center=vt([],Fe([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=ut(this.min),h=ut(this.max);for(let m=0;m<r.length;m++)l[m]=r[m]?this.min[m]:this.center[m],h[m]=r[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new di(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Li(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Li(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}jt(di,"Aabb");class gr{constructor(e,r){this.feature=e,this.metersToTile=r,this.index=0}get(){const e=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,l=r[1],h=-r[0],m=(e.extent+1)*this.metersToTile;return[new Ct(Math.trunc(e.position[0]+l*m),Math.trunc(e.position[1]+h*m)),new Ct(Math.trunc(e.position[0]-l*m),Math.trunc(e.position[1]-h*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ii{constructor(e,r,l,h,m,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[dr(),dr(),dr(),dr(),dr(),dr(),dr()],this.id=e,this.heightRange={min:l,max:l},this.safeArea=r,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=m,this.edges=this.edges.filter((v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((A=this.vertices[v.a].position)[0]===(R=this.vertices[v.b].position)[0]&&A[1]===R[1]);var A,R})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:lo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const A=this.vertices[v.a].position,R=this.vertices[v.b].position,P=Go(dr(),R,A),L=Mr(P),N=Ia(dr(),P,1/L);this.edgeProps.push({vec:P,dir:N,len:L});const U=this.vertexProps[v.a].dir,$=this.vertexProps[v.b].dir;Za(U,U,N),Za($,$,N)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||js(v.dir,v.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[l,h]=r;return Gn(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,h)}computeSlopeNormal(e,r){const l=this.getClosestEdge(e);if(!l)return Ke(0,0,1);const h=l[0],m=this.edges[h],_=this.edgeProps[h].vec,v=Ke(_[0],_[1],(this.vertices[m.b].height-this.vertices[m.a].height)*r),A=Ke(v[1],-v[0],0);gi(A,A,v);const R=on(A);return R>0?vt(A,A,1/R):ze(A,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,l=Number.POSITIVE_INFINITY,h=0;const[m,_,v,A,R,P,L]=this._tmpVec2;Os(L,e.x,e.y);const N=new Mi(L,null);for(let U=0;U<this.edges.length;U++){const $=this.edges[U],X=this.edgeProps[U].dir;N.dir=X;const Q=this.vertices[$.a].position,te=this.vertices[$.b].position,ce=N.intersectsPlane(Q,this.vertexProps[$.a].dir,m),he=N.intersectsPlane(te,this.vertexProps[$.b].dir,_);if(!ce||!he)continue;Go(v,_,m),Go(A,L,m);const me=Cs(v,v),Ie=me>0?Cs(A,v)/me:0,Ee=se(Ie,0,1),Ne=Math.abs((Ie-Ee)*this.edgeProps[U].len);Go(R,L,Q),Os(P,X[1],-X[0]);const Be=Ne+Math.abs(Cs(R,P));Be<l&&(r=U,l=Be,h=Ee)}return[r,h]}tessellate(e){const r=tt(),l=tt(),h=tt(),m=tt();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,A=this.edges[_].b,{position:R,height:P,extent:L}=this.vertices[v],{position:N,height:U,extent:$}=this.vertices[A],X=this.vertexProps[v].dir,Q=this.vertexProps[A].dir;if(ze(r,R[0]/e,R[1]/e,P),ze(l,N[0]/e,N[1]/e,U),ze(h,X[1],-X[0],0),vt(h,h,L),ze(m,Q[1],-Q[0],0),vt(m,m,$),this.distSqLines(Ke(r[0]+.5*h[0],r[1]+.5*h[1],r[2]+.5*h[2]),Ke(l[0]-.5*m[0],l[1]-.5*m[1],l[2]-.5*m[2]),Ke(r[0]-.5*h[0],r[1]-.5*h[1],r[2]-.5*h[2]),Ke(l[0]+.5*m[0],l[1]+.5*m[1],l[2]+.5*m[2]))<=.0025000000000000005)continue;const te=this.vertices.length,ce=Za(dr(),R,N);this.vertices.push({position:Ia(ce,ce,.5),height:.5*(P+U),extent:.5*(L+$)});const he=Za(dr(),X,Q);this.vertexProps.push({dir:js(he,he)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:te}),this.edges.push({a:te,b:A});const me=Go(dr(),this.vertices[te].position,R),Ie=Mr(me),Ee={vec:me,dir:Ia(dr(),me,1/Ie),len:Ie};this.edgeProps.push(Ee),this.edgeProps.push(Ee)}}distSqLines(e,r,l,h){const m=kt(tt(),r,e),_=kt(tt(),h,l),v=kt(tt(),e,l),A=In(m,m),R=In(m,_),P=In(m,v),L=In(_,_),N=In(_,v),U=A*L-R*R;if(U===0)return Nn(ji(m,l,h,In(v,_)/In(_,_)),e);const $=(A*N-R*P)/U;return Nn(ji(m,e,r,(R*N-P*L)/U),ji(_,l,h,$))}}class Pn{static parseFrom(e,r){const l=Vn.parse(e);if(!l)return[];let{vertices:h,features:m}=l;const _=1/Pe(r);m.sort(((P,L)=>P.id-L.id)),h.sort(((P,L)=>P.id-L.id||P.idx-L.idx)),h=h.filter(((P,L,N)=>L===N.findIndex((U=>U.id===P.id&&U.idx===P.idx))));const v=new Array;let A=0;const R=h.length;for(const P of m){if(P.constantHeight){v.push(new Ii(P.id,P.bounds,P.constantHeight));continue}for(;A!==R&&h[A].id<P.id;)A++;if(A===R||h[A].id!==P.id)continue;const L=new Array,N=new Array,U=A;for(;A!==R&&h[A].id===P.id;){const $=h[A];if(L.push({position:$.position,height:$.height,extent:$.extent}),A!==U&&h[A-1].idx===$.idx-1){const X=A-U;N.push({a:X-1,b:X})}A++}v.push(new Ii(P.id,P.bounds,void 0,L,N,_))}return v}static getElevationFeature(e,r){if(!r)return;const l=+e.properties[rn];return Number.isNaN(l)?void 0:r.find((h=>h.id===l))}}class Si{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*qt,this.yOffset=(e.y*this.zScale-r.y)*qt)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,l){const h=this.constantElevation(r,l);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),l))}computeBiasedHeight(e,r){return r<=0?e:e+r*ve(0,r,e>=0?e:Math.abs(.5*e))}}jt(Ii,"ElevationFeature");class Tr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ba,this.indexArray=new kr,this.segments=new Br,this.programConfigurations=new Tl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ac),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,h){}populate(e,r,l,h){const m=this.layers[0],_=[];let v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(const{feature:R,id:P,index:L,sourceLayerIndex:N}of e){const U=this.layers[0]._featureFilter.needGeometry,$=rt(R,U);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),$,l))continue;const X=v?v.evaluate($,{},l):void 0,Q={id:P,properties:R.properties,type:R.type,sourceLayerIndex:N,index:L,geometry:U?$.geometry:_t(R,l,h),patterns:{},sortKey:X};_.push(Q)}v&&_.sort(((R,P)=>R.sortKey-P.sortKey));let A=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Yh,A=h.projection);for(const R of _){const{geometry:P,index:L,sourceLayerIndex:N}=R,U=e[L].feature;this.addFeature(R,P,L,r.availableImages,l,A,r.brightness,r.elevationFeatures),r.featureIndex.insert(U,P,L,N,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,r,l,h,m,_,v){this.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Bg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,r,l,h,m,_,v,A){let R;this.elevationMode!=="none"&&(R=Pn.getElevationFeature(e,A));for(const P of r)for(const L of P){const N=L.x,U=L.y;if(N<0||N>=qt||U<0||U>=qt)continue;if(_){const Q=_.projectTilePoint(N,U,m),te=_.upVector(m,N,U);this.addGlobeExtVertex(Q,te),this.addGlobeExtVertex(Q,te),this.addGlobeExtVertex(Q,te),this.addGlobeExtVertex(Q,te)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),X=$.vertexLength;if(this.addCircleVertex(N,U,-1,-1),this.addCircleVertex(N,U,1,-1),this.addCircleVertex(N,U,1,1),this.addCircleVertex(N,U,-1,1),this.elevationMode!=="none"){const Q=R?R.pointElevation(new Ct(N,U)):0;this.hasElevation=this.hasElevation||Q!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,m,v,void 0,this.worldview)}addCircleVertex(e,r,l,h){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*r+(h+1)/2)}addGlobeExtVertex(e,r){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function Dr(o,e){for(let r=0;r<o.length;r++)if(oo(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(oo(o,e[r]))return!0;return!!mo(o,e)}function Vr(o,e,r){return!!oo(o,e)||!!ns(e,o,r)}function Yr(o,e){if(o.length===1)return ol(e,o[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let h=0;h<l.length;h++)if(oo(o,l[h]))return!0}for(let r=0;r<o.length;r++)if(ol(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(mo(o,e[r]))return!0;return!1}function ca(o,e,r){if(o.length>1){if(mo(o,e))return!0;for(let l=0;l<e.length;l++)if(ns(e[l],o,r))return!0}for(let l=0;l<o.length;l++)if(ns(o[l],e,r))return!0;return!1}function mo(o,e){if(o.length===0||e.length===0)return!1;for(let r=0;r<o.length-1;r++){const l=o[r],h=o[r+1];for(let m=0;m<e.length-1;m++)if(so(l,h,e[m],e[m+1]))return!0}return!1}function so(o,e,r,l){return pi(o,r,l)!==pi(e,r,l)&&pi(o,e,r)!==pi(o,e,l)}function ps(o,e,r){return(o.x-r.x)*(e.y-r.y)-(o.y-r.y)*(e.x-r.x)}function Ba(o,e,r,l){const h=ps(o,e,l),m=ps(o,e,r);if(Math.sign(h)===Math.sign(m))return;const _=ps(r,l,o),v=_+m-h;return Math.sign(_)!==Math.sign(v)?[_/(_-v),m/(m-h)]:void 0}function ns(o,e,r){const l=r*r;if(e.length===1)return o.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Va(o,e[h-1],e[h])<l)return!0;return!1}function Va(o,e,r){const l=e.distSqr(r);if(l===0)return o.distSqr(e);const h=((o.x-e.x)*(r.x-e.x)+(o.y-e.y)*(r.y-e.y))/l;return o.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function ol(o,e){let r,l,h,m=!1;for(let _=0;_<o.length;_++){r=o[_];for(let v=0,A=r.length-1;v<r.length;A=v++)l=r[v],h=r[A],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(m=!m)}return m}function oo(o,e){let r=!1;for(let l=0,h=o.length-1;l<o.length;h=l++){const m=o[l],_=o[h];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function Er(o,e,r,l,h){for(const _ of o)if(e<=_.x&&r<=_.y&&l>=_.x&&h>=_.y)return!0;const m=[new Ct(e,r),new Ct(e,h),new Ct(l,h),new Ct(l,r)];if(o.length>2){for(const _ of m)if(oo(o,_))return!0}for(let _=0;_<o.length-1;_++)if(is(o[_],o[_+1],m))return!0;return!1}function is(o,e,r){const l=r[0],h=r[2];if(o.x<l.x&&e.x<l.x||o.x>h.x&&e.x>h.x||o.y<l.y&&e.y<l.y||o.y>h.y&&e.y>h.y)return!1;const m=pi(o,e,r[0]);return m!==pi(o,e,r[1])||m!==pi(o,e,r[2])||m!==pi(o,e,r[3])}function ur(o,e,r,l,h,m){let _=e.y-o.y,v=o.x-e.x;if(m=m||0){const A=_*_+v*v;if(A===0)return!0;const R=Math.sqrt(A);_/=R,v/=R}return!((r.x-o.x)*_+(r.y-o.y)*v-m<0||(l.x-o.x)*_+(l.y-o.y)*v-m<0||(h.x-o.x)*_+(h.y-o.y)*v-m<0)}function Qr(o,e,r,l,h,m,_){return!(ur(o,e,l,h,m,_)||ur(e,r,l,h,m,_)||ur(r,o,l,h,m,_)||ur(l,h,o,e,r,_)||ur(h,m,o,e,r,_)||ur(m,l,o,e,r,_))}function eo(o,e,r){const l=e.paint.get(o).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(o)}function Jr(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ua(o,e,r,l,h){if(!e[0]&&!e[1])return o;const m=Ct.convert(e)._mult(h);r==="viewport"&&m._rotate(-l);const _=[];for(let v=0;v<o.length;v++)_.push(o[v].sub(m));return _}function Ud(o,e,r,l){const h=Ct.convert(o)._mult(l);return e==="viewport"&&h._rotate(-r),h}let El,Bu;function of(o,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[o*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}jt(Tr,"CircleBucket",{omit:["layers"]});class al{constructor(e,r,l){this.z=e,this.x=r,this.y=l,this.key=$a(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const r=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>r&&e.y===this.y>>r}url(e,r){const l=(function(m,_,v){var A=of(256*m,256*(_=Math.pow(2,v)-_-1),v),R=of(256*(m+1),256*(_+1),v);return A[0]+","+A[1]+","+R[0]+","+R[1]})(this.x,this.y,this.z),h=(function(m,_,v){let A,R="";for(let P=m;P>0;P--)A=1<<P-1,R+=(_&A?1:0)+(v&A?2:0);return R})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rc{constructor(e,r){this.wrap=e,this.canonical=r,this.key=$a(e,r.z,r.z,r.x,r.y)}}class Gs{constructor(e,r,l,h,m){this.overscaledZ=e,this.wrap=r,this.canonical=new al(l,+h,+m),this.key=r===0&&e===l?this.canonical.key:$a(r,e,l,h,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Gs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gs(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return $a(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return $a(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Gs(r,this.wrap,r,l,h),new Gs(r,this.wrap,r,l+1,h),new Gs(r,this.wrap,r,l,h+1),new Gs(r,this.wrap,r,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $a(o,e,r,l,h){const m=1<<Math.min(r,22);let _=m*(h%m)+l%m;return o&&r<22&&(_+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-r)))),16*(32*_+r)+(e-r)}const Al=[o=>{let e=o.canonical.x-1,r=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,r--),new Gs(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,r=o.wrap;return e===1<<o.canonical.z&&(e=0,r++),new Gs(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>new Gs(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Gs(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];jt(al,"CanonicalTileID"),jt(Gs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const vp=xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:bp}=vp,cb=xi([{name:"a_pos_3",components:3,type:"Int16"}]);var Jx=xi([{name:"a_pos",type:"Int16",components:2}]);function Zg(o){return o*Hr/k}const ub=[new di([b,b,b],[T,T,T]),new di([b,b,b],[0,0,T]),new di([0,b,b],[T,0,T]),new di([b,0,b],[0,T,T]),new di([0,0,b],[T,T,T])];function ev(o,e,r,l=!0){const h=vt([],o._camera.position,o.worldSize),m=[e,r,1,1];yn(m,m,o.pixelMatrixInverse),nn(m,m,1/m[3]);const _=An([],ti([],m,h)),v=o.globeMatrix,A=[v[12],v[13],v[14]],R=ti([],A,h),P=on(R),L=An([],R),N=o.worldSize/(2*Math.PI),U=In(L,_),$=Math.asin(N/P);if($<Math.acos(U)){if(!l)return null;const ft=[],Qe=[];vt(ft,_,P/U),An(Qe,ti(Qe,ft,R)),An(_,Fe(_,R,vt(_,Qe,Math.tan($)*P)))}const X=[];new Xn(h,_).closestPointOnSphere(A,N,X);const Q=An([],ds(v,0)),te=An([],ds(v,1)),ce=An([],ds(v,2)),he=In(Q,X),me=In(te,X),Ie=In(ce,X),Ee=Ds(Math.asin(-me/N));let Ne=Ds(Math.atan2(he,Ie));Ne=o.center.lng+(function(ft,Qe){const mt=(Qe-ft+180)%360-180;return mt<-180?mt+360:mt})(o.center.lng,Ne);const Be=ae(Ne),Ue=se(re(Ee),0,1);return new Xe(Be,Ue)}class gy{constructor(e,r,l){this.a=ti([],e,l),this.b=ti([],r,l),this.center=l;const h=An([],this.a),m=An([],this.b);this.angle=Math.acos(In(h,m))}}function _y(o,e){if(o.angle===0)return null;let r;return r=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),r<0||r>1?null:(function(l,h,m,_){const v=Math.sin(m);return l*(Math.sin((1-_)*m)/v)+h*(Math.sin(_*m)/v)})(o.a[e],o.b[e],o.angle,se(r,0,1))+o.center[e]}function ru(o){if(o.z<=1)return ub[o.z+2*o.y+o.x];const e=tv(Wg(o));return di.fromPoints(e)}function Ur(o,e,r){return vt(o,o,1-r),Kt(o,o,e,r)}function yy(o,e,r){for(const l of o)Ri(l,l,e),vt(l,l,r)}function db(o,e,r,l){const h=e/o.worldSize,m=o.globeMatrix;if(r.z<=1){const Ue=ru(r).getCorners();return yy(Ue,m,h),di.fromPoints(Ue)}const _=Wg(r,l),v=tv(_,Hr+Zg(o._tileCoverLift));yy(v,m,h);const A=Number.MAX_VALUE,R=[-A,-A,-A],P=[A,A,A];if(_.contains(o.center)){for(const Qe of v)Me(P,P,Qe),ct(R,R,Qe);R[2]=0;const Ue=o.point,ft=[Ue.x*h,Ue.y*h,0];return Me(P,P,ft),ct(R,R,ft),new di(P,R)}if(o._tileCoverLift>0){for(const Ue of v)Me(P,P,Ue),ct(R,R,Ue);return new di(P,R)}const L=[m[12]*h,m[13]*h,m[14]*h],N=_.getCenter(),U=se(o.center.lat,-be,be),$=se(N.lat,-be,be),X=ae(o.center.lng),Q=re(U);let te=X-ae(N.lng);const ce=Q-re($);te>.5?te-=1:te<-.5&&(te+=1);let he=0;Math.abs(te)>Math.abs(ce)?he=te>=0?1:3:(he=ce>=0?0:2,Kt(L,L,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(fi(ce>=0?_.getSouth():_.getNorth()))*Hr));const me=v[he],Ie=v[(he+1)%4],Ee=new gy(me,Ie,L),Ne=[_y(Ee,0)||me[0],_y(Ee,1)||me[1],_y(Ee,2)||me[2]],Be=wa(o.zoom);if(Be>0){const Ue=(function({x:Qe,y:mt,z:wt},Dt,Xt,Nt,Tt){const Lt=1/(1<<wt);let ht=Qe*Lt,lt=ht+Lt,zt=mt*Lt,Zt=zt+Lt,At=0;const gn=(ht+lt)/2-Nt;return gn>.5?At=-1:gn<-.5&&(At=1),ht=((ht+At)*Dt-(Nt*=Dt))*Xt+Nt,lt=((lt+At)*Dt-Nt)*Xt+Nt,zt=(zt*Dt-(Tt*=Dt))*Xt+Tt,Zt=(Zt*Dt-Tt)*Xt+Tt,[[ht,Zt,0],[lt,Zt,0],[lt,zt,0],[ht,zt,0]]})(r,e,o._pixelsPerMercatorPixel,X,Q);for(let Qe=0;Qe<v.length;Qe++)Ur(v[Qe],Ue[Qe],Be);const ft=Fe([],Ue[he],Ue[(he+1)%4]);vt(ft,ft,.5),Ur(Ne,ft,Be)}for(const Ue of v)Me(P,P,Ue),ct(R,R,Ue);return P[2]=Math.min(me[2],Ie[2]),Me(P,P,Ne),ct(R,R,Ne),new di(P,R)}function Wg({x:o,y:e,z:r},l=!1){const h=1/(1<<r),m=new G(ye(o*h),e===(1<<r)-1&&l?-90:fe((e+1)*h)),_=new G(ye((o+1)*h),e===0&&l?90:fe(e*h));return new V(m,_)}function tv(o,e=Hr){const r=fi(o.getNorth()),l=fi(o.getSouth()),h=Math.cos(r),m=Math.cos(l),_=Math.sin(r),v=Math.sin(l),A=o.getWest(),R=o.getEast();return[M(m,v,A,e),M(m,v,R,e),M(h,_,R,e),M(h,_,A,e)]}function Xg(o,e,r,l){const h=1<<r.z,m=(o/qt+r.x)/h;return D(fe((e/qt+r.y)/h),ye(m),l)}function xy({min:o,max:e}){return a/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const Kg=new Float64Array(16);function $d(o){const e=xy(o),r=$e(Kg,[e,e,e]);return _e(r,r,On([],o.min))}function Yg(o){const e=(l=o.min,(r=Kg)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=l[0],r[13]=l[1],r[14]=l[2],r[15]=1,r);var r,l;const h=1/xy(o);return Re(e,e,[h,h,h])}function Am(o){const e=qt/(2*Math.PI);return o/(2*Math.PI)/e}function vy(o,e){return qt/(512*Math.pow(2,o))*xy(ru(e))}function Gd(o,e,r,l,h){const m=Am(r),_=[o,e,-r/(2*Math.PI)],v=le(new Float64Array(16));return _e(v,v,_),Re(v,v,[m,m,m]),xe(v,v,fi(-h)),Ze(v,v,fi(-l)),v}function wa(o){return ve(f,n,o)}function Cm(o,e){const r=D(e.lat,e.lng),l=(function($){const X=D($._center.lat,$._center.lng);let Q=gi([],Ke(0,1,0),X);const te=st([],-$.angle,X);Q=Ri(Q,Q,te),st(te,-$._pitch,Q);const ce=An([],X);return vt(ce,ce,Zg($.cameraToCenterDistance/$.pixelsPerMeter)),Ri(ce,ce,te),Fe([],X,ce)})(o);return _=(h=kt([],l,r))[0],v=h[1],A=h[2],R=(m=r)[0],P=m[1],L=m[2],U=(N=Math.sqrt((_*_+v*v+A*A)*(R*R+P*P+L*L)))&&In(h,m)/N,Math.acos(Math.min(Math.max(U,-1),1));var h,m,_,v,A,R,P,L,N,U}function nv(o,e){return Cm(o,e)>Math.PI/2*1.01}const iv=fi(85),hb=Math.cos(iv),fb=Math.sin(iv),pb=oe(),mb=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function by(o,e,r,l,h,m,_,v,A){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(A*=o.pixelToTileUnitsFactor);const R=o.tileID.canonical,P=r.projection.upVectorScale(R,r.center.lat,r.worldSize).metersToTile;for(const L of e)for(const N of L){const U=N.add(v),$=h&&r.elevation?r.elevation.exaggeration()*h.getElevationAt(U.x,U.y,!0):0,X=r.projection.projectTilePoint(U.x,U.y,R);if($>0){const he=r.projection.upVector(R,U.x,U.y);X.x+=he[0]*P*$,X.y+=he[1]*P*$,X.z+=he[2]*P*$}const Q=m?U:gb(X.x,X.y,X.z,l),te=m?o.tilespaceRays.map((he=>sv(he,$))):o.queryGeometry.screenGeometry,ce=yn([],[X.x,X.y,X.z,1],l);if(!_&&m?A*=ce[3]/r.cameraToCenterDistance:_&&!m&&(A*=r.cameraToCenterDistance/ce[3]),m){const he=fe((N.y/qt+R.y)/(1<<R.z));A/=r.projection.pixelsPerMeter(he,1)/ue(1,he)}if(Vr(te,Q,A))return!0}return!1}function gb(o,e,r,l){const h=yn([],[o,e,r,1],l);return new Ct(h[0]/h[3],h[1]/h[3])}const rv=Ke(0,0,0),RS=Ke(0,0,1);function sv(o,e){const r=tt();return rv[2]=e,o.intersectsPlane(rv,RS,r),new Ct(r[0],r[1])}class wy extends Tr{}let _b,yb,Rm,xb;function ov(o,{width:e,height:r},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*r*l);return o.width=e,o.height=r,o.data=h,o}function jr(o,e,r){const{width:l,height:h}=e;l===o.width&&h===o.height||(Qg(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,h)},r,null),o.width=l,o.height=h,o.data=e.data)}function Qg(o,e,r,l,h,m,_,v){if(h.width===0||h.height===0)return e;if(h.width>o.width||h.height>o.height||r.x>o.width-h.width||r.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const A=o.data,R=e.data,P=m===4&&v;for(let L=0;L<h.height;L++){const N=((r.y+L)*o.width+r.x)*m,U=((l.y+L)*e.width+l.x)*m;if(P)for(let $=0;$<h.width;$++){const X=N+$*m+3,Q=U+$*m;R[Q+0]=255,R[Q+1]=255,R[Q+2]=255,R[Q+3]=A[X]}else if(_)for(let $=0;$<h.width;$++){const X=N+$*m,Q=U+$*m,te=new nr(A[X+0]/255,A[X+1]/255,A[X+2]/255,A[X+3]).toNonPremultipliedRenderColor(_).toArray();R[Q+0]=te[0],R[Q+1]=te[1],R[Q+2]=te[2],R[Q+3]=te[3]}else for(let $=0;$<h.width*m;$++)R[U+$]=A[N+$]}return e}jt(wy,"HeatmapBucket",{omit:["layers"]});class su{constructor(e,r){ov(this,e,1,r)}resize(e){jr(this,new su(e),1)}clone(){return new su({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,h,m){Qg(e,r,l,h,m,1,null)}}class go{constructor(e,r){ov(this,e,4,r)}resize(e){jr(this,new go(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,h,m,_,v){Qg(e,r,l,h,m,4,_,v)}}class av{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function wp(o){const e={},r=o.resolution||256,l=o.clips?o.clips.length:1,h=o.image||new go({width:r,height:l}),m=(_,v,A)=>{e[o.evaluationKey]=A;const R=o.expression.evaluate(e),P=R?R.toNonPremultipliedRenderColor(null):null;P&&(h.data[_+v+0]=Math.floor(255*P.r),h.data[_+v+1]=Math.floor(255*P.g),h.data[_+v+2]=Math.floor(255*P.b),h.data[_+v+3]=Math.floor(255*P.a))};if(o.clips)for(let _=0,v=0;_<l;++_,v+=4*r)for(let A=0,R=0;A<r;A++,R+=4){const P=A/(r-1),{start:L,end:N}=o.clips[_];m(v,R,L*(1-P)+N*P)}else for(let _=0,v=0;_<r;_++,v+=4)m(0,v,_/(r-1));return h}jt(su,"AlphaImage"),jt(go,"RGBAImage");const Jg=xi([{name:"a_pos",components:2,type:"Int16"}],4),Sy=xi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),MS=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),vb=xi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Mm(o,e,r=2){const l=e&&e.length,h=l?e[0]*r:o.length;let m=bb(o,0,h,r,!0);const _=[];if(!m||m.next===m.prev)return _;let v,A,R;if(l&&(m=(function(P,L,N,U){const $=[];for(let X=0,Q=L.length;X<Q;X++){const te=bb(P,L[X]*U,X<Q-1?L[X+1]*U:P.length,U,!1);te===te.next&&(te.steiner=!0),$.push(Ty(te))}$.sort(wb);for(let X=0;X<$.length;X++)N=DS($[X],N);return N})(o,e,m,r)),o.length>80*r){v=o[0],A=o[1];let P=v,L=A;for(let N=r;N<h;N+=r){const U=o[N],$=o[N+1];U<v&&(v=U),$<A&&(A=$),U>P&&(P=U),$>L&&(L=$)}R=Math.max(P-v,L-A),R=R!==0?32767/R:0}return Im(m,_,r,v,A,R,0),_}function bb(o,e,r,l,h){let m;if(h===(function(_,v,A,R){let P=0;for(let L=v,N=A-R;L<A;L+=R)P+=(_[N]-_[L])*(_[L+1]+_[N+1]),N=L;return P})(o,e,r,l)>0)for(let _=e;_<r;_+=l)m=Hd(_/l|0,o[_],o[_+1],m);else for(let _=r-l;_>=e;_-=l)m=Hd(_/l|0,o[_],o[_+1],m);return m&&Pm(m,m.next)&&(Om(m),m=m.next),m}function af(o,e){if(!o)return o;e||(e=o);let r,l=o;do if(r=!1,l.steiner||!Pm(l,l.next)&&Hs(l.prev,l,l.next)!==0)l=l.next;else{if(Om(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function Im(o,e,r,l,h,m,_){if(!o)return;!_&&m&&(function(A,R,P,L){let N=A;do N.z===0&&(N.z=e_(N.x,N.y,R,P,L)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==A);N.prevZ.nextZ=null,N.prevZ=null,(function(U){let $,X=1;do{let Q,te=U;U=null;let ce=null;for($=0;te;){$++;let he=te,me=0;for(let Ee=0;Ee<X&&(me++,he=he.nextZ,he);Ee++);let Ie=X;for(;me>0||Ie>0&&he;)me!==0&&(Ie===0||!he||te.z<=he.z)?(Q=te,te=te.nextZ,me--):(Q=he,he=he.nextZ,Ie--),ce?ce.nextZ=Q:U=Q,Q.prevZ=ce,ce=Q;te=he}ce.nextZ=null,X*=2}while($>1)})(N)})(o,l,h,m);let v=o;for(;o.prev!==o.next;){const A=o.prev,R=o.next;if(m?lv(o,l,h,m):Ms(o))e.push(A.i,o.i,R.i),Om(o),o=R.next,v=R.next;else if((o=R)===v){_?_===1?Im(o=Sa(af(o),e),e,r,l,h,m,2):_===2&&IS(o,e,r,l,h,m):Im(af(o),e,r,l,h,m,1);break}}}function Ms(o){const e=o.prev,r=o,l=o.next;if(Hs(e,r,l)>=0)return!1;const h=e.x,m=r.x,_=l.x,v=e.y,A=r.y,R=l.y,P=Math.min(h,m,_),L=Math.min(v,A,R),N=Math.max(h,m,_),U=Math.max(v,A,R);let $=l.next;for(;$!==e;){if($.x>=P&&$.x<=N&&$.y>=L&&$.y<=U&&Dm(h,v,m,A,_,R,$.x,$.y)&&Hs($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function lv(o,e,r,l){const h=o.prev,m=o,_=o.next;if(Hs(h,m,_)>=0)return!1;const v=h.x,A=m.x,R=_.x,P=h.y,L=m.y,N=_.y,U=Math.min(v,A,R),$=Math.min(P,L,N),X=Math.max(v,A,R),Q=Math.max(P,L,N),te=e_(U,$,e,r,l),ce=e_(X,Q,e,r,l);let he=o.prevZ,me=o.nextZ;for(;he&&he.z>=te&&me&&me.z<=ce;){if(he.x>=U&&he.x<=X&&he.y>=$&&he.y<=Q&&he!==h&&he!==_&&Dm(v,P,A,L,R,N,he.x,he.y)&&Hs(he.prev,he,he.next)>=0||(he=he.prevZ,me.x>=U&&me.x<=X&&me.y>=$&&me.y<=Q&&me!==h&&me!==_&&Dm(v,P,A,L,R,N,me.x,me.y)&&Hs(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;he&&he.z>=te;){if(he.x>=U&&he.x<=X&&he.y>=$&&he.y<=Q&&he!==h&&he!==_&&Dm(v,P,A,L,R,N,he.x,he.y)&&Hs(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;me&&me.z<=ce;){if(me.x>=U&&me.x<=X&&me.y>=$&&me.y<=Q&&me!==h&&me!==_&&Dm(v,P,A,L,R,N,me.x,me.y)&&Hs(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function Sa(o,e){let r=o;do{const l=r.prev,h=r.next.next;!Pm(l,h)&&hv(l,r,r.next,h)&&n_(l,h)&&n_(h,l)&&(e.push(l.i,r.i,h.i),Om(r),Om(r.next),r=o=h),r=r.next}while(r!==o);return af(r)}function IS(o,e,r,l,h,m){let _=o;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&dv(_,v)){let A=Sb(_,v);return _=af(_,_.next),A=af(A,A.next),Im(_,e,r,l,h,m,0),void Im(A,e,r,l,h,m,0)}v=v.next}_=_.next}while(_!==o)}function wb(o,e){let r=o.x-e.x;return r===0&&(r=o.y-e.y,r===0)&&(r=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function DS(o,e){const r=(function(h,m){let _=m;const v=h.x,A=h.y;let R,P=-1/0;if(Pm(h,_))return _;do{if(Pm(h,_.next))return _.next;if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const X=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(X<=v&&X>P&&(P=X,R=_.x<_.next.x?_:_.next,X===v))return R}_=_.next}while(_!==m);if(!R)return null;const L=R,N=R.x,U=R.y;let $=1/0;_=R;do{if(v>=_.x&&_.x>=N&&v!==_.x&&uv(A<U?v:P,A,N,U,A<U?P:v,A,_.x,_.y)){const X=Math.abs(A-_.y)/(v-_.x);n_(_,h)&&(X<$||X===$&&(_.x>R.x||_.x===R.x&&cv(R,_)))&&(R=_,$=X)}_=_.next}while(_!==L);return R})(o,e);if(!r)return e;const l=Sb(r,o);return af(l,l.next),af(r,r.next)}function cv(o,e){return Hs(o.prev,o,e.prev)<0&&Hs(e.next,o,o.next)<0}function e_(o,e,r,l,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*h|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ty(o){let e=o,r=o;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==o);return r}function uv(o,e,r,l,h,m,_,v){return(h-_)*(e-v)>=(o-_)*(m-v)&&(o-_)*(l-v)>=(r-_)*(e-v)&&(r-_)*(m-v)>=(h-_)*(l-v)}function Dm(o,e,r,l,h,m,_,v){return!(o===_&&e===v)&&uv(o,e,r,l,h,m,_,v)}function dv(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!(function(r,l){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==l.i&&h.next.i!==l.i&&hv(h,h.next,r,l))return!0;h=h.next}while(h!==r);return!1})(o,e)&&(n_(o,e)&&n_(e,o)&&(function(r,l){let h=r,m=!1;const _=(r.x+l.x)/2,v=(r.y+l.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==r);return m})(o,e)&&(Hs(o.prev,o,e.prev)||Hs(o,e.prev,e))||Pm(o,e)&&Hs(o.prev,o,o.next)>0&&Hs(e.prev,e,e.next)>0)}function Hs(o,e,r){return(e.y-o.y)*(r.x-e.x)-(e.x-o.x)*(r.y-e.y)}function Pm(o,e){return o.x===e.x&&o.y===e.y}function hv(o,e,r,l){const h=t_(Hs(o,e,r)),m=t_(Hs(o,e,l)),_=t_(Hs(r,l,o)),v=t_(Hs(r,l,e));return h!==m&&_!==v||!(h!==0||!Ey(o,r,e))||!(m!==0||!Ey(o,l,e))||!(_!==0||!Ey(r,o,l))||!(v!==0||!Ey(r,e,l))}function Ey(o,e,r){return e.x<=Math.max(o.x,r.x)&&e.x>=Math.min(o.x,r.x)&&e.y<=Math.max(o.y,r.y)&&e.y>=Math.min(o.y,r.y)}function t_(o){return o>0?1:o<0?-1:0}function n_(o,e){return Hs(o.prev,o,o.next)<0?Hs(o,e,o.next)>=0&&Hs(o,o.prev,e)>=0:Hs(o,e,o.prev)<0||Hs(o,o.next,e)<0}function Sb(o,e){const r=Ay(o.i,o.x,o.y),l=Ay(e.i,e.x,e.y),h=o.next,m=e.prev;return o.next=e,e.prev=o,r.next=h,h.prev=r,l.next=r,r.prev=l,m.next=l,l.prev=m,l}function Hd(o,e,r,l){const h=Ay(o,e,r);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Om(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Ay(o,e,r){return{i:o,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sp(o,e){const r=o.length;if(r<=1)return[o];const l=[];let h,m;for(let _=0;_<r;_++){const v=_i(o[_]);v!==0&&(o[_].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(h&&l.push(h),h=[o[_]]):h.push(o[_]))}if(h&&l.push(h),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(Qa(l[_],e,1,l[_].length-1,PS),l[_]=l[_].slice(0,e));return l}function PS(o,e){return e.area-o.area}function Tb(o,e,r=1){if(!o)return null;const l=typeof o=="string"?uo.from(o).getPrimary():o.getPrimary(),h=typeof o=="string"?null:o.getSecondary();for(const m of[l,h]){if(!m)continue;const _=m.id.toString();e.has(_)||e.set(_,[]),m.scaleSelf(r),e.get(_).push(m)}return{primary:l.toString(),secondary:h?h.toString():null}}function Cy(o,e,r,l){const h=l.patternDependencies;let m=!1;for(const _ of e){const v=_.paint.get(`${o}-pattern`);v.isConstant()||(m=!0),Tb(v.constantOr(null),h,r)&&(m=!0)}return m}function i_(o,e,r,l,h,m){const _=m.patternDependencies;for(const v of e){const A=v.paint.get(`${o}-pattern`).value;if(A.kind!=="constant"){let R=A.evaluate({zoom:l},r,{},m.availableImages);R=R&&R.name?R.name:R;const P=Tb(R,_,h);if(!P)continue;const{primary:L,secondary:N}=P;L&&(r.patterns[v.id]=[L,N].filter(Boolean))}}return r}class Ry{constructor(){this.polygons=new Map}add(e,...r){const l=this.polygons.get(e);l?l.push(...r):this.polygons.set(e,r)}merge(e){for(const[r,l]of e.polygons)this.add(r,...l)}}class qd{constructor(){this.portals=[]}static isOnBorder(e,r){return e<=0&&r<=0||e>=qt&&r>=qt}static evaluate(e){if(e.length===0)return new qd;let r=[];for(const A of e)r.push(...A.portals);if(r.length===0)return new qd;for(const A of r){const R=A.va,P=A.vb;(qd.isOnBorder(R.x,P.x)||qd.isOnBorder(R.y,P.y))&&(A.type="border")}const l=r.filter((A=>A.type!=="unevaluated")),h=r.filter((A=>A.type==="unevaluated"));if(h.length===0)return new qd;h.sort(((A,R)=>A.hash===R.hash?A.isTunnel===R.isTunnel?0:A.isTunnel?-1:1:A.hash<R.hash?1:-1)),r=l.concat(h);let m=l.length,_=m,v=m;do if(_++,_===r.length||r[m].hash!==r[_].hash){if(_-m==2){v<m&&(r[v]=r[m],r[m]=null);const A=r[v],R=r[_-1];A.type=A.isTunnel!==R.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:R.connection.a},v++}m=_}while(m!==r.length);return r.splice(v),r.sort(((A,R)=>A.hash<R.hash?1:-1)),{portals:r}}}jt(qd,"ElevationPortalGraph"),jt(Ry,"ElevationPolygons");class Mc{constructor(e,r,l){this.outPositions=e,this.outNormals=r,this.outIndices=l,this.vertexLookup=new Map}addVertex(e,r,l){let h=e[2];l!=null&&(h*=l);const m=`${e[0]},${e[1]},${e[2]},${r[0]},${r[1]},${r[2]}`,_=this.vertexLookup.get(m);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(m,v);const A=Math.trunc(16384*r[0]),R=Math.trunc(16384*r[1]),P=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(A,R,P),v}addTriangle(e,r,l){this.outIndices.emplaceBack(e,r,l)}addTriangles(e,r,l){if(e.length===0)return;const h=l.length===1,m=tt(),_=tt();for(let v=0;v<e.length;v+=3){const A=r[e[v+0]],R=r[e[v+1]],P=r[e[v+2]],L=h?l[0]:l[e[v+1]],N=h?l[0]:l[e[v+2]];ze(m,A.x,A.y,h?l[0]:l[e[v+0]]);const U=this.addVertex(m,_);ze(m,R.x,R.y,L);const $=this.addVertex(m,_);ze(m,P.x,P.y,N);const X=this.addVertex(m,_);this.outIndices.emplaceBack(U,$,X)}}addQuad(e,r,l,h,m,_){const v=this.addVertex(e,m,_),A=this.addVertex(r,m,_),R=this.addVertex(l,m,_),P=this.addVertex(h,m,_);this.addTriangle(v,A,R),this.addTriangle(R,P,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ta{constructor(e,r,l,h){this.unevaluatedPortals=new qd,this.portalPolygons=new Ry,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new hp,this.vertexNormals=new dm,this.indexArray=new kr,this.tileToMeters=Pe(e),this.bridgeProgramConfigurations=new Tl(r,{zoom:l,lut:h},(m=>m!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Tl(r,{zoom:l,lut:h},(m=>m!=="fill-bridge-guard-rail-color"))}addVertices(e,r){const l=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(r[h]);return l}addTriangles(e,r,l){const h=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)h.push(m+r)}addRenderableRing(e,r,l,h,m,_){const v=[new Ct(m.min.x,m.min.y),new Ct(m.max.x,m.min.y),new Ct(m.max.x,m.max.y),new Ct(m.min.x,m.max.y)];for(let A=0;A<l-1;A++){const R=r+A,P=R+1,L=this.unevalVertices[R],N=this.unevalVertices[P];if(!(L.x>=m.min.x&&L.x<=m.max.x&&L.y>=m.min.y&&L.y<=m.max.y||N.x>=m.min.x&&N.x<=m.max.x&&N.y>=m.min.y&&N.y<=m.max.y||is(L,N,v))||this.isOnBorder(L.x,N.x)||this.isOnBorder(L.y,N.y))continue;const U=Ta.computeEdgeHash(this.unevalVertices[R],this.unevalVertices[P]);let $,X=this.vertexHashLookup.get(Ta.computePosHash(L));X!=null?$=X.next:(X=this.vertexHashLookup.get(Ta.computePosHash(N)),$=X!=null?X.prev:U),this.unevalEdges.push({polygonIdx:e,a:R,b:P,hash:U,portalHash:$,isTunnel:h,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,r,l,h,m){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:m});const _=r[0];this.vertexHashLookup.clear();let v=Ta.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let A=0;A<_.length-1;A++){const R=_[A+0],P=_[A+1],L=lo(P.x-R.x,P.y-R.y),N=Mr(L);if(N===0)continue;let U="unevaluated";const $=h.pointElevation(R),X=h.pointElevation(P);Math.abs($)<.01&&Math.abs(X)<.01?U="entrance":(this.isOnBorder(R.x,P.x)||this.isOnBorder(R.y,P.y))&&(U="border");const Q=Ta.computeEdgeHash(R,P);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:R,vb:P,vab:L,length:N,hash:Q,isTunnel:l,type:U});const te=Ta.computePosHash(R);this.vertexHashLookup.set(te,{prev:v,next:Q}),v=Q}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},h=new Mc(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=r(),_=r(),v=r(),A=(N,U)=>{N.sort(((X,Q)=>X.type===U&&Q.type!==U?-1:X.type!==U&&Q.type===U?1:0));const $=N.findIndex((X=>X.type!==U));return $>=0?$:N.length};let R=0;this.unevalEdges.length>0&&(R=A(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},this.tileToMeters)),l(v);const P=r(),L=r();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(R),U=A(N,"tunnel")+R;this.unevalEdges.push(...N),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},{min:R,max:U})}l(P),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(L),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(_),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(m),this.maskSegments=Br.simpleSegment(0,L.primitiveOffset,0,L.primitiveLength),this.depthSegments=Br.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=Br.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=Br.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.shadowCasterSegments=Br.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,r,l,h,m,_,v,A){this.bridgeProgramConfigurations.updatePaintArrays(e,r,m,l,h,_,v,A),this.tunnelProgramConfigurations.updatePaintArrays(e,r,m,l,h,_,v,A)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,MS.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,vb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,r,l,h,m){const _=(v,A)=>{for(let R=0;R<A.length-1;R++){const P=A[R].featureIndex,L=A[R+1].vertexStart,N=e.feature(P);v.populatePaintArrays(L,N,P,{},l,r,h,void 0,m)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,r,l,h,m){const _=new Map;for(let v=h;v<m;v++){const A=l[v],R=A.a,P=A.b,L=Ta.computePosHash(e[R]),N=Ta.computePosHash(e[P]);let U=_.get(L);U||(U={},_.set(L,U));let $=_.get(N);$||($={},_.set(N,$)),r[R]<=0&&r[P]<=0||(U.to=P,$.from=R)}return _}isTerminalVertex(e,r){const l=Ta.computePosHash(this.unevalVertices[e]),h=r.get(l);return!h||!h.from||!h.to}constructBridgeStructures(e,r,l,h,m,_){e.clearVertexLookup();const v=this.computeVertexConnections(r,l,h,m.min,m.max),A=1/_,R=.5*A,P=(Xt,Nt)=>ze(Xt,r[Nt].x,r[Nt].y,l[Nt]*A),L=tt(),N=tt(),U=tt(),$=tt(),X=tt(),Q=(Xt,Nt)=>{const Tt=v.get(Ta.computePosHash(r[Nt])),Lt=Tt.from,ht=Tt.to;if(!Lt||!ht)return;P(L,Lt),P(N,Nt),P(U,ht),wr($),jn(L,N)||(ti(X,N,L),An($,X)),jn(U,N)||(ti(X,U,N),Fe($,$,An(X,X)));const lt=et($);return lt>0?vt(Xt,$,1/lt):void 0};let te=Number.POSITIVE_INFINITY;this.sortSubarray(h,m.min,m.max,((Xt,Nt)=>Xt.featureInfo.featureIndex-Nt.featureInfo.featureIndex));const ce=tt(),he=tt(),me=tt(),Ie=tt(),Ee=tt(),Ne=tt(),Be=tt(),Ue=tt(),ft=tt(),Qe=[tt(),tt(),tt(),tt()],mt=[tt(),tt(),tt(),tt()],wt=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],Dt=(Xt,Nt)=>Xt>Nt;for(let Xt=m.min;Xt<m.max;Xt++){const Nt=h[Xt];if(!Nt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(wt,r,l,Nt,Dt))continue;const[Tt,Lt]=wt;if(ze(ce,Tt.coord.x,Tt.coord.y,A*Tt.height),ze(he,Lt.coord.x,Lt.coord.y,A*Lt.height),jn(ce,he))continue;ti(me,he,ce),An(me,me);const ht=Q(Ue,Nt.a)||me,lt=Q(ft,Nt.b)||me;ze(Ie,ht[1],-ht[0],0),An(Ie,Ie),ze(Ee,lt[1],-lt[0],0),An(Ee,Ee),gi(Ue,Ie,ht),An(Ne,Ue),gi(Ue,Ee,lt),An(Be,Ue),Fe(Qe[0],ce,vt(Ue,ti(Ue,Ie,Ne),R)),Fe(Qe[1],ce,vt(Ue,Fe(Ue,Ie,Ne),R)),Fe(Qe[2],ce,vt(Ue,Ne,R)),Qe[3]=ce,Fe(mt[0],he,vt(Ue,ti(Ue,Ee,Be),R)),Fe(mt[1],he,vt(Ue,Fe(Ue,Ee,Be),R)),Fe(mt[2],he,vt(Ue,Be,R)),mt[3]=he,te=this.addFeatureSection(Nt.featureInfo.featureIndex,te,this.bridgeFeatureSections,e);const zt=e.addVertex(Qe[0],Ie,_),Zt=e.addVertex(Qe[1],Ie,_),At=e.addVertex(mt[0],Ee,_),gn=e.addVertex(mt[1],Ee,_);e.addTriangle(zt,Zt,At),e.addTriangle(Zt,gn,At);const bn=e.addVertex(Qe[1],Ne,_),hn=e.addVertex(Qe[2],Ne,_),an=e.addVertex(mt[1],Be,_),Qn=e.addVertex(mt[2],Be,_);e.addTriangle(bn,hn,an),e.addTriangle(hn,Qn,an),On(Ie,Ie),On(Ee,Ee);const dn=e.addVertex(Qe[2],Ie,_),kn=e.addVertex(Qe[3],Ie,_),ei=e.addVertex(mt[2],Ee,_),yi=e.addVertex(mt[3],Ee,_);e.addTriangle(dn,kn,ei),e.addTriangle(kn,yi,ei);const $i=this.isTerminalVertex(Nt.a,v),ri=this.isTerminalVertex(Nt.b,v);Tt.height<.01&&$i&&e.addQuad(Qe[3],Qe[2],Qe[1],Qe[0],On(ht,ht),_),Lt.height<.01&&ri&&e.addQuad(mt[0],mt[1],mt[2],mt[3],lt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,r,l,h,m,_){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const A=(te,ce)=>te.featureInfo.featureIndex-ce.featureInfo.featureIndex;this.sortSubarray(h,m.min,m.max,A),this.sortSubarray(h,_.min,_.max,A);const R=te=>An(te,te),P=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],L=(te,ce)=>te<ce,N=tt(),U=tt(),$=tt(),X=tt(),Q=tt();for(let te=m.min;te<m.max;te++){if(!this.prepareEdgePoints(P,r,l,h[te],L))continue;const[ce,he]=P,me=R(ze(Q,-(he.coord.y-ce.coord.y),he.coord.x-ce.coord.x,0));v=this.addFeatureSection(h[te].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(ze(N,ce.coord.x,ce.coord.y,ce.height),ze(U,he.coord.x,he.coord.y,he.height),ze($,he.coord.x,he.coord.y,h[te].isTunnel?-.1:0),ze(X,ce.coord.x,ce.coord.y,h[te].isTunnel?-.1:0),me)}for(let te=_.min;te<_.max;te++){const ce=h[te];ce.isTunnel&&([ce.a,ce.b]=[ce.b,ce.a]);const he=r[ce.a],me=r[ce.b],Ie=R(ze(Q,-(me.y-he.y),me.x-he.x,0));v=this.addFeatureSection(ce.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(ze(N,me.x,me.y,0),ze(U,he.x,he.y,0),ze($,he.x,he.y,l[ce.a]+4),ze(X,me.x,me.y,l[ce.b]+4),Ie),e.addQuad(ze(N,he.x,he.y,0),ze(U,me.x,me.y,0),ze($,me.x,me.y,l[ce.b]+4),ze(X,he.x,he.y,l[ce.a]+4),Ie)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,r,l,h){e.coord.x=r,e.coord.y=l,e.height=h}prepareEdgePoints(e,r,l,h,m){let _=r[h.a].x,v=r[h.a].y,A=r[h.b].x,R=r[h.b].y,P=l[h.a],L=l[h.b];const N=m(P,0),U=m(L,0);if(N&&U)return this.setElevatedPoint(e[0],_,v,P),this.setElevatedPoint(e[1],A,R,L),!0;if(!N&&!U)return!1;if(N){if(!U){const $=L/(L-P);A=Gn(A,_,$),R=Gn(R,v,$),L=Gn(L,P,$)}}else{const $=P/(P-L);_=Gn(_,A,$),v=Gn(v,R,$),P=Gn(P,L,$)}return this.setElevatedPoint(e[0],_,v,P),this.setElevatedPoint(e[1],A,R,L),!0}prepareEdges(e,r){if(r.length===0)return;r.sort(((v,A)=>v.hash===A.hash?A.polygonIdx-v.polygonIdx:A.hash>v.hash?1:-1));let l=0,h=0,m=0,_=r[l].polygonIdx;do h++,(h===r.length||r[l].hash!==r[h].hash)&&((h-l==1||r[h-1].polygonIdx!==_)&&(m<l&&(r[m]=r[l],r[l]=null),r[m].type="none",m++),l=h,l!==r.length&&(_=r[l].polygonIdx));while(l!==r.length);if(r.splice(m),r.length!==0&&e.length!==0){r.sort(((R,P)=>R.portalHash<P.portalHash?1:-1));let v=0,A=0;for(;v!==r.length&&A!==e.length;){const R=r[v],P=e[A];R.portalHash>P.hash?v++:P.hash>R.portalHash?A++:(R.type=P.type,v++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=qt&&r>=qt}addFeatureSection(e,r,l,h){return e!==r&&(r=e,l.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),r}sortSubarray(e,r,l,h){const m=e.slice(r,l);m.sort(h),e.splice(r,m.length,...m)}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(Ta.computePosHash(e))<<32n|BigInt(Ta.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var fv,pv={exports:{}},mv=(fv||(fv=1,(function(o,e){(function(r){function l(Ae,we){return Ae>we?1:Ae<we?-1:0}var h=function(Ae,we){Ae===void 0&&(Ae=l),we===void 0&&(we=!1),this._compare=Ae,this._root=null,this._size=0,this._noDuplicates=!!we},m={size:{configurable:!0}};function _(Ae,we,yt,en,xt){var ln=xt-en;if(ln>0){var Rn=en+Math.floor(ln/2),Cn={key:we[Rn],data:yt[Rn],parent:Ae};return Cn.left=_(Cn,we,yt,en,Rn),Cn.right=_(Cn,we,yt,Rn+1,xt),Cn}return null}function v(Ae,we,yt,en,xt){if(!(yt>=en)){for(var ln=Ae[yt+en>>1],Rn=yt-1,Cn=en+1;;){do Rn++;while(xt(Ae[Rn],ln)<0);do Cn--;while(xt(Ae[Cn],ln)>0);if(Rn>=Cn)break;var oi=Ae[Rn];Ae[Rn]=Ae[Cn],Ae[Cn]=oi,oi=we[Rn],we[Rn]=we[Cn],we[Cn]=oi}v(Ae,we,yt,Cn,xt),v(Ae,we,Cn+1,en,xt)}}h.prototype.rotateLeft=function(Ae){var we=Ae.right;we&&(Ae.right=we.left,we.left&&(we.left.parent=Ae),we.parent=Ae.parent),Ae.parent?Ae===Ae.parent.left?Ae.parent.left=we:Ae.parent.right=we:this._root=we,we&&(we.left=Ae),Ae.parent=we},h.prototype.rotateRight=function(Ae){var we=Ae.left;we&&(Ae.left=we.right,we.right&&(we.right.parent=Ae),we.parent=Ae.parent),Ae.parent?Ae===Ae.parent.left?Ae.parent.left=we:Ae.parent.right=we:this._root=we,we&&(we.right=Ae),Ae.parent=we},h.prototype._splay=function(Ae){for(;Ae.parent;){var we=Ae.parent;we.parent?we.left===Ae&&we.parent.left===we?(this.rotateRight(we.parent),this.rotateRight(we)):we.right===Ae&&we.parent.right===we?(this.rotateLeft(we.parent),this.rotateLeft(we)):we.left===Ae&&we.parent.right===we?(this.rotateRight(we),this.rotateLeft(we)):(this.rotateLeft(we),this.rotateRight(we)):we.left===Ae?this.rotateRight(we):this.rotateLeft(we)}},h.prototype.splay=function(Ae){for(var we,yt,en,xt,ln;Ae.parent;)(yt=(we=Ae.parent).parent)&&yt.parent?((en=yt.parent).left===yt?en.left=Ae:en.right=Ae,Ae.parent=en):(Ae.parent=null,this._root=Ae),xt=Ae.left,ln=Ae.right,Ae===we.left?(yt&&(yt.left===we?(we.right?(yt.left=we.right,yt.left.parent=yt):yt.left=null,we.right=yt,yt.parent=we):(xt?(yt.right=xt,xt.parent=yt):yt.right=null,Ae.left=yt,yt.parent=Ae)),ln?(we.left=ln,ln.parent=we):we.left=null,Ae.right=we,we.parent=Ae):(yt&&(yt.right===we?(we.left?(yt.right=we.left,yt.right.parent=yt):yt.right=null,we.left=yt,yt.parent=we):(ln?(yt.left=ln,ln.parent=yt):yt.left=null,Ae.right=yt,yt.parent=Ae)),xt?(we.right=xt,xt.parent=we):we.right=null,Ae.left=we,we.parent=Ae)},h.prototype.replace=function(Ae,we){Ae.parent?Ae===Ae.parent.left?Ae.parent.left=we:Ae.parent.right=we:this._root=we,we&&(we.parent=Ae.parent)},h.prototype.minNode=function(Ae){if(Ae===void 0&&(Ae=this._root),Ae)for(;Ae.left;)Ae=Ae.left;return Ae},h.prototype.maxNode=function(Ae){if(Ae===void 0&&(Ae=this._root),Ae)for(;Ae.right;)Ae=Ae.right;return Ae},h.prototype.insert=function(Ae,we){var yt=this._root,en=null,xt=this._compare;if(this._noDuplicates)for(;yt;){if(en=yt,xt(yt.key,Ae)===0)return;yt=xt(yt.key,Ae)<0?yt.right:yt.left}else for(;yt;)en=yt,yt=xt(yt.key,Ae)<0?yt.right:yt.left;return yt={key:Ae,data:we,left:null,right:null,parent:en},en?xt(en.key,yt.key)<0?en.right=yt:en.left=yt:this._root=yt,this.splay(yt),this._size++,yt},h.prototype.find=function(Ae){for(var we=this._root,yt=this._compare;we;){var en=yt(we.key,Ae);if(en<0)we=we.right;else{if(!(en>0))return we;we=we.left}}return null},h.prototype.contains=function(Ae){for(var we=this._root,yt=this._compare;we;){var en=yt(Ae,we.key);if(en===0)return!0;we=en<0?we.left:we.right}return!1},h.prototype.remove=function(Ae){var we=this.find(Ae);if(!we)return!1;if(this.splay(we),we.left)if(we.right){var yt=this.minNode(we.right);yt.parent!==we&&(this.replace(yt,yt.right),yt.right=we.right,yt.right.parent=yt),this.replace(we,yt),yt.left=we.left,yt.left.parent=yt}else this.replace(we,we.left);else this.replace(we,we.right);return this._size--,!0},h.prototype.removeNode=function(Ae){if(!Ae)return!1;if(this.splay(Ae),Ae.left)if(Ae.right){var we=this.minNode(Ae.right);we.parent!==Ae&&(this.replace(we,we.right),we.right=Ae.right,we.right.parent=we),this.replace(Ae,we),we.left=Ae.left,we.left.parent=we}else this.replace(Ae,Ae.left);else this.replace(Ae,Ae.right);return this._size--,!0},h.prototype.erase=function(Ae){var we=this.find(Ae);if(we){this.splay(we);var yt=we.left,en=we.right,xt=null;yt&&(yt.parent=null,xt=this.maxNode(yt),this.splay(xt),this._root=xt),en&&(yt?xt.right=en:this._root=en,en.parent=xt),this._size--}},h.prototype.pop=function(){var Ae=this._root,we=null;if(Ae){for(;Ae.left;)Ae=Ae.left;we={key:Ae.key,data:Ae.data},this.remove(Ae.key)}return we},h.prototype.next=function(Ae){var we=Ae;if(we)if(we.right)for(we=we.right;we&&we.left;)we=we.left;else for(we=Ae.parent;we&&we.right===Ae;)Ae=we,we=we.parent;return we},h.prototype.prev=function(Ae){var we=Ae;if(we)if(we.left)for(we=we.left;we&&we.right;)we=we.right;else for(we=Ae.parent;we&&we.left===Ae;)Ae=we,we=we.parent;return we},h.prototype.forEach=function(Ae){for(var we=this._root,yt=[],en=!1,xt=0;!en;)we?(yt.push(we),we=we.left):yt.length>0?(Ae(we=yt.pop(),xt++),we=we.right):en=!0;return this},h.prototype.range=function(Ae,we,yt,en){for(var xt=[],ln=this._compare,Rn=this._root;xt.length!==0||Rn;)if(Rn)xt.push(Rn),Rn=Rn.left;else{if(ln((Rn=xt.pop()).key,we)>0)break;if(ln(Rn.key,Ae)>=0&&yt.call(en,Rn))return this;Rn=Rn.right}return this},h.prototype.keys=function(){for(var Ae=this._root,we=[],yt=[],en=!1;!en;)Ae?(we.push(Ae),Ae=Ae.left):we.length>0?(Ae=we.pop(),yt.push(Ae.key),Ae=Ae.right):en=!0;return yt},h.prototype.values=function(){for(var Ae=this._root,we=[],yt=[],en=!1;!en;)Ae?(we.push(Ae),Ae=Ae.left):we.length>0?(Ae=we.pop(),yt.push(Ae.data),Ae=Ae.right):en=!0;return yt},h.prototype.at=function(Ae){for(var we=this._root,yt=[],en=!1,xt=0;!en;)if(we)yt.push(we),we=we.left;else if(yt.length>0){if(we=yt.pop(),xt===Ae)return we;xt++,we=we.right}else en=!0;return null},h.prototype.load=function(Ae,we,yt){if(Ae===void 0&&(Ae=[]),we===void 0&&(we=[]),yt===void 0&&(yt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var en=Ae.length;return yt&&v(Ae,we,0,en-1,this._compare),this._root=_(null,Ae,we,0,en),this._size=en,this},h.prototype.min=function(){var Ae=this.minNode(this._root);return Ae?Ae.key:null},h.prototype.max=function(){var Ae=this.maxNode(this._root);return Ae?Ae.key:null},h.prototype.isEmpty=function(){return this._root===null},m.size.get=function(){return this._size},h.createTree=function(Ae,we,yt,en,xt){return new h(yt,xt).load(Ae,we,en)},Object.defineProperties(h.prototype,m);var A=0,R=1,P=2,L=3,N=0,U=1,$=2,X=3;function Q(Ae,we,yt){we===null?(Ae.inOut=!1,Ae.otherInOut=!0):(Ae.isSubject===we.isSubject?(Ae.inOut=!we.inOut,Ae.otherInOut=we.otherInOut):(Ae.inOut=!we.otherInOut,Ae.otherInOut=we.isVertical()?!we.inOut:we.inOut),we&&(Ae.prevInResult=!te(we,yt)||we.isVertical()?we.prevInResult:we));var en=te(Ae,yt);Ae.resultTransition=en?(function(xt,ln){var Rn,Cn=!xt.inOut,oi=!xt.otherInOut;switch(ln){case N:Rn=Cn&&oi;break;case U:Rn=Cn||oi;break;case X:Rn=Cn^oi;break;case $:Rn=xt.isSubject?Cn&&!oi:oi&&!Cn}return Rn?1:-1})(Ae,yt):0}function te(Ae,we){switch(Ae.type){case A:switch(we){case N:return!Ae.otherInOut;case U:return Ae.otherInOut;case $:return Ae.isSubject&&Ae.otherInOut||!Ae.isSubject&&!Ae.otherInOut;case X:return!0}break;case P:return we===N||we===U;case L:return we===$;case R:return!1}return!1}var ce=function(Ae,we,yt,en,xt){this.left=we,this.point=Ae,this.otherEvent=yt,this.isSubject=en,this.type=xt||A,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function me(Ae,we){return Ae[0]===we[0]&&Ae[1]===we[1]}ce.prototype.isBelow=function(Ae){var we=this.point,yt=this.otherEvent.point;return this.left?(we[0]-Ae[0])*(yt[1]-Ae[1])-(yt[0]-Ae[0])*(we[1]-Ae[1])>0:(yt[0]-Ae[0])*(we[1]-Ae[1])-(we[0]-Ae[0])*(yt[1]-Ae[1])>0},ce.prototype.isAbove=function(Ae){return!this.isBelow(Ae)},ce.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},ce.prototype.clone=function(){var Ae=new ce(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ae.contourId=this.contourId,Ae.resultTransition=this.resultTransition,Ae.prevInResult=this.prevInResult,Ae.isExteriorRing=this.isExteriorRing,Ae.inOut=this.inOut,Ae.otherInOut=this.otherInOut,Ae},Object.defineProperties(ce.prototype,he);var Ie=11102230246251565e-32,Ee=134217729,Ne=(3+8*Ie)*Ie;function Be(Ae,we,yt,en,xt){var ln,Rn,Cn,oi,qn=we[0],Sn=en[0],Ki=0,_r=0;Sn>qn==Sn>-qn?(ln=qn,qn=we[++Ki]):(ln=Sn,Sn=en[++_r]);var Wn=0;if(Ki<Ae&&_r<yt)for(Sn>qn==Sn>-qn?(Cn=ln-((Rn=qn+ln)-qn),qn=we[++Ki]):(Cn=ln-((Rn=Sn+ln)-Sn),Sn=en[++_r]),ln=Rn,Cn!==0&&(xt[Wn++]=Cn);Ki<Ae&&_r<yt;)Sn>qn==Sn>-qn?(Cn=ln-((Rn=ln+qn)-(oi=Rn-ln))+(qn-oi),qn=we[++Ki]):(Cn=ln-((Rn=ln+Sn)-(oi=Rn-ln))+(Sn-oi),Sn=en[++_r]),ln=Rn,Cn!==0&&(xt[Wn++]=Cn);for(;Ki<Ae;)Cn=ln-((Rn=ln+qn)-(oi=Rn-ln))+(qn-oi),qn=we[++Ki],ln=Rn,Cn!==0&&(xt[Wn++]=Cn);for(;_r<yt;)Cn=ln-((Rn=ln+Sn)-(oi=Rn-ln))+(Sn-oi),Sn=en[++_r],ln=Rn,Cn!==0&&(xt[Wn++]=Cn);return ln===0&&Wn!==0||(xt[Wn++]=ln),Wn}function Ue(Ae){return new Float64Array(Ae)}var ft=33306690738754716e-32,Qe=22204460492503146e-32,mt=11093356479670487e-47,wt=Ue(4),Dt=Ue(8),Xt=Ue(12),Nt=Ue(16),Tt=Ue(4);function Lt(Ae,we,yt){var en=(function(xt,ln,Rn,Cn,oi,qn){var Sn=(ln-qn)*(Rn-oi),Ki=(xt-oi)*(Cn-qn),_r=Sn-Ki;if(Sn===0||Ki===0||Sn>0!=Ki>0)return _r;var Wn=Math.abs(Sn+Ki);return Math.abs(_r)>=ft*Wn?_r:-(function(ki,yr,lr,ms,Wr,Pr,fr){var er,ai,tr,Or,Zn,Gi,Xr,Es,Is,to,Kr,qs,Cl,Zs,Xl,ua,lu,Rl,Kl=ki-Wr,da=lr-Wr,Yl=yr-Pr,cu=ms-Pr;wt[0]=(Xl=(Es=Kl-(Xr=(Gi=Ee*Kl)-(Gi-Kl)))*(to=cu-(Is=(Gi=Ee*cu)-(Gi-cu)))-((Zs=Kl*cu)-Xr*Is-Es*Is-Xr*to))-((Kr=Xl-(lu=(Es=Yl-(Xr=(Gi=Ee*Yl)-(Gi-Yl)))*(to=da-(Is=(Gi=Ee*da)-(Gi-da)))-((ua=Yl*da)-Xr*Is-Es*Is-Xr*to)))+(Zn=Xl-Kr))+(Zn-lu),wt[1]=(Cl=Zs-((qs=Zs+Kr)-(Zn=qs-Zs))+(Kr-Zn))-((Kr=Cl-ua)+(Zn=Cl-Kr))+(Zn-ua),wt[2]=qs-((Rl=qs+Kr)-(Zn=Rl-qs))+(Kr-Zn),wt[3]=Rl;var Vo=(function(Xm,ff){for(var y1=ff[0],Yy=1;Yy<4;Yy++)y1+=ff[Yy];return y1})(0,wt),Ga=Qe*fr;if(Vo>=Ga||-Vo>=Ga||(er=ki-(Kl+(Zn=ki-Kl))+(Zn-Wr),tr=lr-(da+(Zn=lr-da))+(Zn-Wr),ai=yr-(Yl+(Zn=yr-Yl))+(Zn-Pr),Or=ms-(cu+(Zn=ms-cu))+(Zn-Pr),er===0&&ai===0&&tr===0&&Or===0)||(Ga=mt*fr+Ne*Math.abs(Vo),(Vo+=Kl*Or+cu*er-(Yl*tr+da*ai))>=Ga||-Vo>=Ga))return Vo;Tt[0]=(Xl=(Es=er-(Xr=(Gi=Ee*er)-(Gi-er)))*(to=cu-(Is=(Gi=Ee*cu)-(Gi-cu)))-((Zs=er*cu)-Xr*Is-Es*Is-Xr*to))-((Kr=Xl-(lu=(Es=ai-(Xr=(Gi=Ee*ai)-(Gi-ai)))*(to=da-(Is=(Gi=Ee*da)-(Gi-da)))-((ua=ai*da)-Xr*Is-Es*Is-Xr*to)))+(Zn=Xl-Kr))+(Zn-lu),Tt[1]=(Cl=Zs-((qs=Zs+Kr)-(Zn=qs-Zs))+(Kr-Zn))-((Kr=Cl-ua)+(Zn=Cl-Kr))+(Zn-ua),Tt[2]=qs-((Rl=qs+Kr)-(Zn=Rl-qs))+(Kr-Zn),Tt[3]=Rl;var hf=Be(4,wt,4,Tt,Dt);Tt[0]=(Xl=(Es=Kl-(Xr=(Gi=Ee*Kl)-(Gi-Kl)))*(to=Or-(Is=(Gi=Ee*Or)-(Gi-Or)))-((Zs=Kl*Or)-Xr*Is-Es*Is-Xr*to))-((Kr=Xl-(lu=(Es=Yl-(Xr=(Gi=Ee*Yl)-(Gi-Yl)))*(to=tr-(Is=(Gi=Ee*tr)-(Gi-tr)))-((ua=Yl*tr)-Xr*Is-Es*Is-Xr*to)))+(Zn=Xl-Kr))+(Zn-lu),Tt[1]=(Cl=Zs-((qs=Zs+Kr)-(Zn=qs-Zs))+(Kr-Zn))-((Kr=Cl-ua)+(Zn=Cl-Kr))+(Zn-ua),Tt[2]=qs-((Rl=qs+Kr)-(Zn=Rl-qs))+(Kr-Zn),Tt[3]=Rl;var Wm=Be(hf,Dt,4,Tt,Xt);Tt[0]=(Xl=(Es=er-(Xr=(Gi=Ee*er)-(Gi-er)))*(to=Or-(Is=(Gi=Ee*Or)-(Gi-Or)))-((Zs=er*Or)-Xr*Is-Es*Is-Xr*to))-((Kr=Xl-(lu=(Es=ai-(Xr=(Gi=Ee*ai)-(Gi-ai)))*(to=tr-(Is=(Gi=Ee*tr)-(Gi-tr)))-((ua=ai*tr)-Xr*Is-Es*Is-Xr*to)))+(Zn=Xl-Kr))+(Zn-lu),Tt[1]=(Cl=Zs-((qs=Zs+Kr)-(Zn=qs-Zs))+(Kr-Zn))-((Kr=Cl-ua)+(Zn=Cl-Kr))+(Zn-ua),Tt[2]=qs-((Rl=qs+Kr)-(Zn=Rl-qs))+(Kr-Zn),Tt[3]=Rl;var Ky=Be(Wm,Xt,4,Tt,Nt);return Nt[Ky-1]})(xt,ln,Rn,Cn,oi,qn,Wn)})(Ae[0],Ae[1],we[0],we[1],yt[0],yt[1]);return en>0?-1:en<0?1:0}function ht(Ae,we){var yt=Ae.point,en=we.point;return yt[0]>en[0]?1:yt[0]<en[0]?-1:yt[1]!==en[1]?yt[1]>en[1]?1:-1:(function(xt,ln,Rn,Cn){return xt.left!==ln.left?xt.left?1:-1:Lt(Rn,xt.otherEvent.point,ln.otherEvent.point)!==0?xt.isBelow(ln.otherEvent.point)?-1:1:!xt.isSubject&&ln.isSubject?1:-1})(Ae,we,yt)}function lt(Ae,we,yt){var en=new ce(we,!1,Ae,Ae.isSubject),xt=new ce(we,!0,Ae.otherEvent,Ae.isSubject);return me(Ae.point,Ae.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ae),en.contourId=xt.contourId=Ae.contourId,ht(xt,Ae.otherEvent)>0&&(Ae.otherEvent.left=!0,xt.left=!1),Ae.otherEvent.otherEvent=xt,Ae.otherEvent=en,yt.push(xt),yt.push(en),yt}function zt(Ae,we){return Ae[0]*we[1]-Ae[1]*we[0]}function Zt(Ae,we){return Ae[0]*we[0]+Ae[1]*we[1]}function At(Ae,we,yt){var en=(function(oi,qn,Sn,Ki,_r){var Wn=[qn[0]-oi[0],qn[1]-oi[1]],ki=[Ki[0]-Sn[0],Ki[1]-Sn[1]];function yr(Gi,Xr,Es){return[Gi[0]+Xr*Es[0],Gi[1]+Xr*Es[1]]}var lr=[Sn[0]-oi[0],Sn[1]-oi[1]],ms=zt(Wn,ki),Wr=ms*ms,Pr=Zt(Wn,Wn);if(Wr>0){var fr=zt(lr,ki)/ms;if(fr<0||fr>1)return null;var er=zt(lr,Wn)/ms;return er<0||er>1?null:fr===0||fr===1?[yr(oi,fr,Wn)]:er===0||er===1?[yr(Sn,er,ki)]:[yr(oi,fr,Wn)]}if((Wr=(ms=zt(lr,Wn))*ms)>0)return null;var ai=Zt(Wn,lr)/Pr,tr=ai+Zt(Wn,ki)/Pr,Or=Math.min(ai,tr),Zn=Math.max(ai,tr);return Or<=1&&Zn>=0?Or===1?[yr(oi,Or>0?Or:0,Wn)]:Zn===0?[yr(oi,Zn<1?Zn:1,Wn)]:[yr(oi,Or>0?Or:0,Wn),yr(oi,Zn<1?Zn:1,Wn)]:null})(Ae.point,Ae.otherEvent.point,we.point,we.otherEvent.point),xt=en?en.length:0;if(xt===0||xt===1&&(me(Ae.point,we.point)||me(Ae.otherEvent.point,we.otherEvent.point))||xt===2&&Ae.isSubject===we.isSubject)return 0;if(xt===1)return me(Ae.point,en[0])||me(Ae.otherEvent.point,en[0])||lt(Ae,en[0],yt),me(we.point,en[0])||me(we.otherEvent.point,en[0])||lt(we,en[0],yt),1;var ln=[],Rn=!1,Cn=!1;return me(Ae.point,we.point)?Rn=!0:ht(Ae,we)===1?ln.push(we,Ae):ln.push(Ae,we),me(Ae.otherEvent.point,we.otherEvent.point)?Cn=!0:ht(Ae.otherEvent,we.otherEvent)===1?ln.push(we.otherEvent,Ae.otherEvent):ln.push(Ae.otherEvent,we.otherEvent),Rn&&Cn||Rn?(we.type=R,Ae.type=we.inOut===Ae.inOut?P:L,Rn&&!Cn&&lt(ln[1].otherEvent,ln[0].point,yt),2):Cn?(lt(ln[0],ln[1].point,yt),3):ln[0]!==ln[3].otherEvent?(lt(ln[0],ln[1].point,yt),lt(ln[1],ln[2].point,yt),3):(lt(ln[0],ln[1].point,yt),lt(ln[3].otherEvent,ln[2].point,yt),3)}function gn(Ae,we){if(Ae===we)return 0;if(Lt(Ae.point,Ae.otherEvent.point,we.point)!==0||Lt(Ae.point,Ae.otherEvent.point,we.otherEvent.point)!==0)return me(Ae.point,we.point)?Ae.isBelow(we.otherEvent.point)?-1:1:Ae.point[0]===we.point[0]?Ae.point[1]<we.point[1]?-1:1:ht(Ae,we)===1?we.isAbove(Ae.point)?-1:1:Ae.isBelow(we.point)?-1:1;if(Ae.isSubject!==we.isSubject)return Ae.isSubject?-1:1;var yt=Ae.point,en=we.point;return yt[0]===en[0]&&yt[1]===en[1]?(yt=Ae.otherEvent.point)[0]===(en=we.otherEvent.point)[0]&&yt[1]===en[1]?0:Ae.contourId>we.contourId?1:-1:ht(Ae,we)===1?1:-1}var bn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function hn(Ae,we,yt,en){var xt,ln=Ae+1,Rn=we[Ae].point,Cn=we.length;for(ln<Cn&&(xt=we[ln].point);ln<Cn&&xt[0]===Rn[0]&&xt[1]===Rn[1];){if(!yt[ln])return ln;++ln<Cn&&(xt=we[ln].point)}for(ln=Ae-1;yt[ln]&&ln>en;)ln--;return ln}bn.prototype.isExterior=function(){return this.holeOf==null};var an=dn,Qn=dn;function dn(Ae,we){if(!(this instanceof dn))return new dn(Ae,we);if(this.data=Ae||[],this.length=this.data.length,this.compare=we||kn,this.length>0)for(var yt=(this.length>>1)-1;yt>=0;yt--)this._down(yt)}function kn(Ae,we){return Ae<we?-1:Ae>we?1:0}dn.prototype={push:function(Ae){this.data.push(Ae),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ae=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ae}},peek:function(){return this.data[0]},_up:function(Ae){for(var we=this.data,yt=this.compare,en=we[Ae];Ae>0;){var xt=Ae-1>>1,ln=we[xt];if(yt(en,ln)>=0)break;we[Ae]=ln,Ae=xt}we[Ae]=en},_down:function(Ae){for(var we=this.data,yt=this.compare,en=this.length>>1,xt=we[Ae];Ae<en;){var ln=1+(Ae<<1),Rn=ln+1,Cn=we[ln];if(Rn<this.length&&yt(we[Rn],Cn)<0&&(ln=Rn,Cn=we[Rn]),yt(Cn,xt)>=0)break;we[Ae]=Cn,Ae=ln}we[Ae]=xt}},an.default=Qn;var ei=Math.max,yi=Math.min,$i=0;function ri(Ae,we,yt,en,xt,ln){var Rn,Cn,oi,qn,Sn,Ki;for(Rn=0,Cn=Ae.length-1;Rn<Cn;Rn++)if(qn=Ae[Rn+1],Sn=new ce(oi=Ae[Rn],!1,void 0,we),Ki=new ce(qn,!1,Sn,we),Sn.otherEvent=Ki,oi[0]!==qn[0]||oi[1]!==qn[1]){Sn.contourId=Ki.contourId=yt,ln||(Sn.isExteriorRing=!1,Ki.isExteriorRing=!1),ht(Sn,Ki)>0?Ki.left=!0:Sn.left=!0;var _r=oi[0],Wn=oi[1];xt[0]=yi(xt[0],_r),xt[1]=yi(xt[1],Wn),xt[2]=ei(xt[2],_r),xt[3]=ei(xt[3],Wn),en.push(Sn),en.push(Ki)}}var Qi=[];function Ji(Ae,we,yt){typeof Ae[0][0][0]=="number"&&(Ae=[Ae]),typeof we[0][0][0]=="number"&&(we=[we]);var en=(function(Wn,ki,yr){var lr=null;return Wn.length*ki.length==0&&(yr===N?lr=Qi:yr===$?lr=Wn:yr!==U&&yr!==X||(lr=Wn.length===0?ki:Wn)),lr})(Ae,we,yt);if(en)return en===Qi?null:en;var xt=[1/0,1/0,-1/0,-1/0],ln=[1/0,1/0,-1/0,-1/0],Rn=(function(Wn,ki,yr,lr,ms){var Wr,Pr,fr,er,ai,tr,Or=new an(null,ht);for(fr=0,er=Wn.length;fr<er;fr++)for(ai=0,tr=(Wr=Wn[fr]).length;ai<tr;ai++)(Pr=ai===0)&&$i++,ri(Wr[ai],!0,$i,Or,yr,Pr);for(fr=0,er=ki.length;fr<er;fr++)for(ai=0,tr=(Wr=ki[fr]).length;ai<tr;ai++)Pr=ai===0,ms===$&&(Pr=!1),Pr&&$i++,ri(Wr[ai],!1,$i,Or,lr,Pr);return Or})(Ae,we,xt,ln,yt);if(en=(function(Wn,ki,yr,lr,ms){var Wr=null;return(yr[0]>lr[2]||lr[0]>yr[2]||yr[1]>lr[3]||lr[1]>yr[3])&&(ms===N?Wr=Qi:ms===$?Wr=Wn:ms!==U&&ms!==X||(Wr=Wn.concat(ki))),Wr})(Ae,we,xt,ln,yt))return en===Qi?null:en;for(var Cn=(function(Wn){var ki,yr,lr=(function(fr){var er,ai,tr,Or,Zn=[];for(ai=0,tr=fr.length;ai<tr;ai++)((er=fr[ai]).left&&er.inResult||!er.left&&er.otherEvent.inResult)&&Zn.push(er);for(var Gi=!1;!Gi;)for(Gi=!0,ai=0,tr=Zn.length;ai<tr;ai++)ai+1<tr&&ht(Zn[ai],Zn[ai+1])===1&&(Or=Zn[ai],Zn[ai]=Zn[ai+1],Zn[ai+1]=Or,Gi=!1);for(ai=0,tr=Zn.length;ai<tr;ai++)(er=Zn[ai]).otherPos=ai;for(ai=0,tr=Zn.length;ai<tr;ai++)(er=Zn[ai]).left||(Or=er.otherPos,er.otherPos=er.otherEvent.otherPos,er.otherEvent.otherPos=Or);return Zn})(Wn),ms={},Wr=[],Pr=function(){if(!ms[ki]){var fr=Wr.length,er=(function(Zn,Gi,Xr){var Es=new bn;if(Zn.prevInResult!=null){var Is=Zn.prevInResult,to=Is.outputContourId;if(Is.resultTransition>0){var Kr=Gi[to];if(Kr.holeOf!=null){var qs=Kr.holeOf;Gi[qs].holeIds.push(Xr),Es.holeOf=qs,Es.depth=Gi[to].depth}else Gi[to].holeIds.push(Xr),Es.holeOf=to,Es.depth=Gi[to].depth+1}else Es.holeOf=null,Es.depth=Gi[to].depth}else Es.holeOf=null,Es.depth=0;return Es})(lr[ki],Wr,fr),ai=function(Zn){ms[Zn]=!0,Zn<lr.length&&lr[Zn]&&(lr[Zn].outputContourId=fr)},tr=ki,Or=ki;for(er.points.push(lr[ki].point);ai(tr),ai(tr=lr[tr].otherPos),er.points.push(lr[tr].point),!((tr=hn(tr,lr,ms,Or))==Or||tr>=lr.length)&&lr[tr];);Wr.push(er)}};for(ki=0,yr=lr.length;ki<yr;ki++)Pr();return Wr})((function(Wn,ki,yr,lr,ms,Wr){for(var Pr,fr,er,ai=new h(gn),tr=[],Or=Math.min(lr[2],ms[2]);Wn.length!==0;){var Zn=Wn.pop();if(tr.push(Zn),Wr===N&&Zn.point[0]>Or||Wr===$&&Zn.point[0]>lr[2])break;if(Zn.left){fr=Pr=ai.insert(Zn),Pr=Pr!==(er=ai.minNode())?ai.prev(Pr):null,fr=ai.next(fr);var Gi=Pr?Pr.key:null;if(Q(Zn,Gi,Wr),fr&&At(Zn,fr.key,Wn)===2&&(Q(Zn,Gi,Wr),Q(fr.key,Zn,Wr)),Pr&&At(Pr.key,Zn,Wn)===2){var Xr=Pr;Q(Gi,(Xr=Xr!==er?ai.prev(Xr):null)?Xr.key:null,Wr),Q(Zn,Gi,Wr)}}else fr=Pr=ai.find(Zn=Zn.otherEvent),Pr&&fr&&(Pr=Pr!==er?ai.prev(Pr):null,fr=ai.next(fr),ai.remove(Zn),fr&&Pr&&At(Pr.key,fr.key,Wn))}return tr})(Rn,0,0,xt,ln,yt)),oi=[],qn=0;qn<Cn.length;qn++){var Sn=Cn[qn];if(Sn.isExterior()){for(var Ki=[Sn.points],_r=0;_r<Sn.holeIds.length;_r++)Ki.push(Cn[Sn.holeIds[_r]].points);oi.push(Ki)}}return oi}var rs={UNION:U,DIFFERENCE:$,INTERSECTION:N,XOR:X};r.diff=function(Ae,we){return Ji(Ae,we,$)},r.intersection=function(Ae,we){return Ji(Ae,we,N)},r.operations=rs,r.union=function(Ae,we){return Ji(Ae,we,U)},r.xor=function(Ae,we){return Ji(Ae,we,X)},Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,pv.exports)),pv.exports);function lf(o,e,r,l){const h=[],m=l===0?(_,v,A,R,P,L)=>{_.push(new Ct(L,A+(L-v)/(R-v)*(P-A)))}:(_,v,A,R,P,L)=>{_.push(new Ct(v+(L-A)/(P-A)*(R-v),L))};for(const _ of o){const v=[];for(const A of _){if(A.length<=2)continue;const R=[];for(let N=0;N<A.length-1;N++){const U=A[N].x,$=A[N].y,X=A[N+1].x,Q=A[N+1].y,te=l===0?U:$,ce=l===0?X:Q;te<e?ce>e&&m(R,U,$,X,Q,e):te>r?ce<r&&m(R,U,$,X,Q,r):R.push(A[N]),ce<e&&te>=e&&m(R,U,$,X,Q,e),ce>r&&te<=r&&m(R,U,$,X,Q,r)}let P=A[A.length-1];const L=l===0?P.x:P.y;L>=e&&L<=r&&R.push(P),R.length&&(P=R[R.length-1],R[0].x===P.x&&R[0].y===P.y||R.push(R[0]),v.push(R))}v.length&&h.push(v)}return h}function Ic(o,e){const r=zm(o),l=zm([e]),h=mv.intersection(r,l);return h==null?[]:Vu(h)}function Eb(o,e){let l=zm(o,65536);const h=[];for(;e.valid();e.next()){const[m,_]=e.get(),v=m.x*65536,A=m.y*65536,R=_.x*65536,P=_.y*65536,L=R-v,N=P-A,U=Math.hypot(L,N);if(U===0)continue;const $=Math.trunc(N/U*3),X=-Math.trunc(L/U*3);h.push([[[v,A],[R,P],[R+$,P+X],[v+$,A+X],[v,A]]])}return h.length>0&&(l=mv.diff(l,h)),Vu(l,1/65536)}function zm(o,e=1){return[o.map((r=>r.map((l=>[l.x*e,l.y*e]))))]}function Vu(o,e=1){return o.map((r=>r.map(((l,h)=>{const m=l.map((_=>new Ct(_[0]*e,_[1]*e).round()));return h>0&&m.reverse(),m}))))}class gv{constructor(e,r){this.layoutVertexArray=new ba,this.indexArray=new kr,this.lineIndexArray=new rl,this.triangleSegments=new Br,this.lineSegments=new Br,this.programConfigurations=new Tl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Ac)}update(e,r,l,h,m,_,v,A){this.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Sy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,l,h,m,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,l,h,m,_,void 0,v)}}class _v{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new gv(e,!1),this.elevationBufferData=new gv(e,!0),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,h){}populate(e,r,l,h){this.hasPattern=Cy("fill",this.layers,this.pixelRatio,r);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:A,index:R,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,N=rt(v,L);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),N,l))continue;const U=m?m.evaluate(N,{},l,r.availableImages):void 0,$={id:A,properties:v.properties,type:v.type,sourceLayerIndex:P,index:R,geometry:L?N.geometry:_t(v,l,h),patterns:{},sortKey:U};_.push($)}m&&_.sort(((v,A)=>v.sortKey-A.sortKey));for(const v of _){const{geometry:A,index:R,sourceLayerIndex:P}=v;if(this.hasPattern){const L=i_("fill",this.layers,v,this.zoom,this.pixelRatio,r);this.patternFeatures.push(L)}else this.addFeature(v,A,R,l,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[R].feature,A,R,P,this.index)}}update(e,r,l,h,m,_,v){this.bufferData.update(e,r,l,h,m,_,v,this.worldview),this.elevationBufferData.update(e,r,l,h,m,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,r,l,h,m,_,v,this.worldview)}addFeatures(e,r,l,h,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,l,h,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,l,h,m,_=[],v,A){const R=Sp(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,R,h,l,A):this.addGeometry(R,this.bufferData),this.bufferData.populatePaintArrays(e,l,m,_,h,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,m,_,h,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,r,l,h,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(r,l,h,m,this.worldview))}addElevatedRoadFeature(e,r,l,h,m){const _=new Array,v=Pn.getElevationFeature(e,m);if(!v)return void this.addGeometry(r,this.bufferData);{const R=this.clipPolygonsToTile(r,1);R.length>0&&_.push({polygons:R,elevationFeature:v,elevationTileID:l})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:h};for(const R of _)if(R.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ta(R.elevationTileID,this.layers,this.zoom,this.lut));const L=R.elevationFeature.isTunnel();let N=0;e.properties.hasOwnProperty(pn)&&(N=+e.properties[pn]);for(const U of R.polygons)this.elevatedStructures.addPortalCandidates(R.elevationFeature.id,U,L,R.elevationFeature,N)}R.elevationFeature.constantHeight==null&&(R.polygons=this.prepareElevatedPolygons(R.polygons,R.elevationFeature,R.elevationTileID));const P=new Si(l,R.elevationTileID);this.addElevatedGeometry(R.polygons,P,R.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,A)}}addElevatedGeometry(e,r,l,h,m,_){const v={elevation:l,elevationSampler:r,bias:h,index:m,featureInfo:_},[A,R]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:R}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,R))}addGeometry(e,r,l){let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,_=null;l&&(_=l.elevationSampler.constantElevation(l.elevation,l.bias),_!=null&&(h=_,m=_));const v=(A,R,P)=>{if(l!=null)if(R.push(A),_!=null)r.elevatedLayoutVertexArray.emplaceBack(_),P.push(_);else{const L=l.elevationSampler.pointElevation(A,l.elevation,l.bias);r.elevatedLayoutVertexArray.emplaceBack(L),P.push(L),h=Math.min(h,L),m=Math.max(m,L)}};for(const A of e){let R=0;for(const he of A)R+=he.length;const P=r.triangleSegments.prepareSegment(R,r.layoutVertexArray,r.indexArray),L=P.vertexLength,N=[],U=[],$=[],X=[],Q=[],te=r.layoutVertexArray.length;for(const he of A){if(he.length===0)continue;he!==A[0]&&U.push(N.length/2);const me=r.lineSegments.prepareSegment(he.length,r.layoutVertexArray,r.lineIndexArray),Ie=me.vertexLength;l&&Q.push(r.layoutVertexArray.length-te),v(he[0],$,X),r.layoutVertexArray.emplaceBack(he[0].x,he[0].y),r.lineIndexArray.emplaceBack(Ie+he.length-1,Ie),N.push(he[0].x),N.push(he[0].y);for(let Ee=1;Ee<he.length;Ee++)v(he[Ee],$,X),r.layoutVertexArray.emplaceBack(he[Ee].x,he[Ee].y),r.lineIndexArray.emplaceBack(Ie+Ee-1,Ie+Ee),N.push(he[Ee].x),N.push(he[Ee].y);me.vertexLength+=he.length,me.primitiveLength+=he.length}const ce=Mm(N,U);for(let he=0;he<ce.length;he+=3)r.indexArray.emplaceBack(L+ce[he],L+ce[he+1],L+ce[he+2]);if(ce.length>0&&l&&this.elevationMode==="hd-road-base"){const he=l.elevation.isTunnel(),me=l.elevation.safeArea,Ie=this.elevatedStructures.addVertices($,X);this.elevatedStructures.addTriangles(ce,Ie,he);const Ee=Q.length;if(Ee>0){for(let Ne=0;Ne<Ee-1;Ne++)this.elevatedStructures.addRenderableRing(l.index,Q[Ne]+Ie,Q[Ne+1]-Q[Ne],he,me,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,Q[Ee-1]+Ie,$.length-Q[Ee-1],he,me,l.featureInfo)}}P.vertexLength+=R,P.primitiveLength+=ce.length/3}return[h,m]}prepareElevatedPolygons(e,r,l){const h=1/Pe(l),m=[];for(const _ of e){const v=Eb(_,new gr(r,h));m.push(...v)}return m}clipPolygonsToTile(e,r){const l=-r,h=-r,m=qt+r,_=qt+r;let v=0;const A=[],R=[];for(;v<e.length;v++){const N=e[v],U=dd(N);(U.min.x>=l&&U.max.x<=m&&U.min.y>=h&&U.max.y<=_?A:R).push(N)}if(A.length===e.length)return e;const P=[new Ct(l,h),new Ct(m,h),new Ct(m,_),new Ct(l,_),new Ct(l,h)],L=A;for(const N of R)L.push(...Ic(N,P));return L}}let Tp,yv,Ab,Cb;jt(_v,"FillBucket",{omit:["layers","patternFeatures"]}),jt(gv,"FillBufferData"),jt(Ta,"ElevatedStructures");class My{constructor(e,r,l,h){if(this.triangleCount=r.length/3,this.min=new Ct(0,0),this.max=new Ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,_]=[e[0].clone(),e[0].clone()];for(let L=1;L<e.length;++L){const N=e[L];m.x=Math.min(m.x,N.x),m.y=Math.min(m.y,N.y),_.x=Math.max(_.x,N.x),_.y=Math.max(_.y,N.y)}if(h){const L=Math.ceil(Math.max(_.x-m.x,_.y-m.y)/h);l=Math.max(l,L)}if(l===0)return;this.min=m,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const A=Math.max(v.x,v.y)/l;this.cellsX=Math.max(1,Math.ceil(v.x/A)),this.cellsY=Math.max(1,Math.ceil(v.y/A)),this.xScale=1/A,this.yScale=1/A;const R=[];for(let L=0;L<this.triangleCount;L++){const N=e[r[3*L+0]].sub(this.min),U=e[r[3*L+1]].sub(this.min),$=e[r[3*L+2]].sub(this.min),X=Uu(Math.floor(Math.min(N.x,U.x,$.x)),this.xScale,this.cellsX),Q=Uu(Math.floor(Math.max(N.x,U.x,$.x)),this.xScale,this.cellsX),te=Uu(Math.floor(Math.min(N.y,U.y,$.y)),this.yScale,this.cellsY),ce=Uu(Math.floor(Math.max(N.y,U.y,$.y)),this.yScale,this.cellsY),he=new Ct(0,0),me=new Ct(0,0),Ie=new Ct(0,0),Ee=new Ct(0,0);for(let Ne=te;Ne<=ce;++Ne){he.y=me.y=Ne*A,Ie.y=Ee.y=(Ne+1)*A;for(let Be=X;Be<=Q;++Be)he.x=Ie.x=Be*A,me.x=Ee.x=(Be+1)*A,(Qr(N,U,$,he,me,Ee)||Qr(N,U,$,he,Ee,Ie))&&R.push({cellIdx:Ne*this.cellsX+Be,triIdx:L})}}if(R.length===0)return;R.sort(((L,N)=>L.cellIdx-N.cellIdx||L.triIdx-N.triIdx));let P=0;for(;P<R.length;){const L=R[P].cellIdx,N={start:this.payload.length,len:0};for(;P<R.length&&R[P].cellIdx===L;)++N.len,this.payload.push(R[P++].triIdx);this.cells[L]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Uu(e.x-this.min.x,this.xScale,this.cellsX),h=Uu(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+l];if(m){this._lazyInitLookup();for(let _=0;_<m.len;_++){const v=this.payload[m.start+_],A=Math.floor(v/8),R=1<<v%8;if(!(this.lookup[A]&R)&&(this.lookup[A]|=R,r.push(v),r.length===this.triangleCount))return}}}query(e,r,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const h=Uu(e.x-this.min.x,this.xScale,this.cellsX),m=Uu(r.x-this.min.x,this.xScale,this.cellsX),_=Uu(e.y-this.min.y,this.yScale,this.cellsY),v=Uu(r.y-this.min.y,this.yScale,this.cellsY);for(let A=_;A<=v;A++)for(let R=h;R<=m;R++){const P=this.cells[A*this.cellsX+R];if(P)for(let L=0;L<P.len;L++){const N=this.payload[P.start+L],U=Math.floor(N/8),$=1<<N%8;if(!(this.lookup[U]&$)&&(this.lookup[U]|=$,l.push(N),l.length===this.triangleCount))return}}}}function Uu(o,e,r){return Math.max(0,Math.min(r-1,Math.floor(o*e)))}jt(My,"TriangleGridIndex");class Rb{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}updateAppearances(e,r,l,h){}populate(e,r,l,h){const m=[];for(const{feature:_,id:v,index:A,sourceLayerIndex:R}of e){const P=this.layers[0]._featureFilter.needGeometry,L=rt(_,P);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),L,l))continue;const N={id:v,properties:_.properties,type:_.type,sourceLayerIndex:R,index:A,geometry:P?L.geometry:_t(_,l,h),patterns:{}};m.push(N)}for(const _ of m){const{geometry:v,index:A,sourceLayerIndex:R}=_;this.addFeature(_,v,A,l,{},r.availableImages,r.brightness),r.featureIndex.insert(e[A].feature,v,A,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,l,h,m,_,v){}destroy(){}addFeature(e,r,l,h,m,_=[],v){for(const A of Sp(r,2)){const R=[],P=[],L=[],N=new Ct(1/0,1/0),U=new Ct(-1/0,-1/0);for(const Q of A)if(Q.length!==0){Q!==A[0]&&L.push(P.length/2);for(let te=0;te<Q.length;te++)P.push(Q[te].x),P.push(Q[te].y),R.push(Q[te]),N.x=Math.min(N.x,Q[te].x),N.y=Math.min(N.y,Q[te].y),U.x=Math.max(U.x,Q[te].x),U.y=Math.max(U.y,Q[te].y)}const $=Mm(P,L),X=new My(R,$,8,256);this.footprints.push({vertices:R,indices:$,grid:X,min:N,max:U})}}}jt(Rb,"ClipBucket",{omit:["layers"]});const OS=xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zS=xi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Mb=xi([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Lm=xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),r_=xi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Ib=xi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),LS=xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Nm}=OS,Zd=Number.MAX_SAFE_INTEGER,xv=Zd-1;function s_(o,e,r,l){return o.order<e||o.order===Zd||!(o.clipMask&r)||(function(h,m){return m.length!==0&&m.find((_=>_===h))===void 0})(l,o.clipScope)}function km(o,e){return o.x-e.x||o.y-e.y}function Iy(o,e){return km(o.min,e.min)===0&&km(o.max,e.max)===0}function jm(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function o_(o,e){if(o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(o[r].sourceId!==e[r].sourceId||!Iy(o[r],e[r])||o[r].order!==e[r].order||o[r].clipMask!==e[r].clipMask||!Rs(o[r].clipScope,e[r].clipScope))return!1;return!0}function vv(o,e,r){const l=1/qt,h=1/(1<<r.canonical.z),m=(e.x*l+r.canonical.x)*h+r.wrap,_=(e.y*l+r.canonical.y)*h;return{min:new Ct((o.x*l+r.canonical.x)*h+r.wrap,(o.y*l+r.canonical.y)*h),max:new Ct(m,_)}}function NS(o,e,r){const l=1<<r.canonical.z,h=((e.x-r.wrap)*l-r.canonical.x)*qt,m=(e.y*l-r.canonical.y)*qt;return{min:new Ct(((o.x-r.wrap)*l-r.canonical.x)*qt,(o.y*l-r.canonical.y)*qt),max:new Ct(h,m)}}function Dy(o,e,r,l,h,m,_){const v=o.indices,A=o.vertices,R=[];for(let P=l;P<l+h;P+=3){const L=e[r[P+0]+m],N=e[r[P+1]+m],U=e[r[P+2]+m],$=Math.min(L.x,N.x,U.x),X=Math.max(L.x,N.x,U.x),Q=Math.min(L.y,N.y,U.y),te=Math.max(L.y,N.y,U.y);R.length=0,o.grid.query(new Ct($,Q),new Ct(X,te),R);for(let ce=0;ce<R.length;ce++){const he=R[ce];if(Qr(A[v[3*he+0]],A[v[3*he+1]],A[v[3*he+2]],L,N,U,_))return!0}}return!1}function Db(o,e,r,l){if(!o||!r)return!1;let h=o.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(r.vertices.length<o.vertices.length)return Db(r,l,o,e);const m=e.canonical,_=l.canonical,v=Math.pow(2,_.z-m.z);h=o.vertices.map((A=>new Ct((A.x+m.x*qt)*v-_.x*qt,(A.y+m.y*qt)*v-_.y*qt)))}return Dy(r,h,o.indices,0,o.indices.length,0,0)}function Py(o,e,r,l){const h=Math.pow(2,l.z-r.z);return new Ct((o+r.x*qt)*h-l.x*qt,(e+r.y*qt)*h-l.y*qt)}function bv(o,e){const r=[];e.grid.queryPoint(o,r);const l=e.indices,h=e.vertices;for(let m=0;m<r.length;m++){const _=r[m];if(oo([h[l[3*_+0]],h[l[3*_+1]],h[l[3*_+2]]],o))return!0}return!1}const Fm=[new Ct(0,0),new Ct(qt,0),new Ct(qt,qt),new Ct(0,qt)];function a_(o,e){const r=[];let l=[];if(!e||o.length<2)return[o];if(o.length===2)return is(o[0],o[1],Fm)?[o]:[];for(let h=0;h<o.length+2;h++){const m=o[h%o.length],_=o[(h+1)%o.length],v=is(h===0?o[o.length-1]:o[(h-1)%o.length],m,Fm),A=is(m,_,Fm),R=v||A;R&&l.push(m),R&&A||l.length>0&&(l.length>1&&r.push(l),l=[])}return l.length>1&&r.push(l),r}const Bm=Pt.types,kS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],l_=["fill-extrusion-flood-light-ground-radius"],jS=Math.pow(2,13),Pb=Math.pow(2,15)-1,wv=new Ct(0,1),Wd=2147483648,Sv=7,Oy=450;function Vm(o,e,r,l,h,m,_,v){o.emplaceBack((e<<1)+_,(r<<1)+m,(Math.floor(l*jS)<<1)+h,Math.round(v))}function Um(o,e,r){o.emplaceBack(e.x*qt,e.y*qt,r?1:0)}function Ep(o,e,r,l,h,m){o.emplaceBack(e.x,e.y,(r.x<<1)+l,(r.y<<1)+h,m)}function c_(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ob{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class zy{constructor(){this.centroidXY=new Ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ly{constructor(){this.acc=new Ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,l){this.accCount++,this.acc._add(r);let h=!!this.borders;r.x<e.min.x?(e.min.x=r.x,h=!0):r.x>e.max.x&&(e.max.x=r.x,h=!0),r.y<e.min.y?(e.min.y=r.y,h=!0):r.y>e.max.y&&(e.max.y=r.y,h=!0),((r.x===0||r.x===qt)&&r.x===l.x)!=((r.y===0||r.y===qt)&&r.y===l.y)&&this.processBorderOverlap(r,l),h&&this.checkBorderIntersection(r,l)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Gn(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>qt!=e.x>qt&&this.addBorderIntersection(1,Gn(r.y,e.y,(qt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Gn(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>qt!=e.y>qt&&this.addBorderIntersection(3,Gn(r.x,e.x,(qt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];r<l[0]&&(l[0]=r),r>l[1]&&(l[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,r.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,r.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new Ct(0,0):new Ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,r)=>e+ +(r[0]!==Number.MAX_VALUE)),0):0}}function u_(o,e){const r=o.add(e)._unit(),l=se(o.x*r.x+o.y*r.y,-1,1);var h,m,_;return h=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(h)))/4*Pb*((m=o).x*(_=e).y-m.y*_.x<0?-1:1)}const Tv=[o=>o.x<0,o=>o.x>qt,o=>o.y<0,o=>o.y>qt];function zb(o,e,r,l){const h=[4];if(l===0)return h;r._mult(l);const m=o.sub(r),_=e.sub(r),v=[o,e,m,_];for(let A=0;A<4;A++)for(const R of v)if(Tv[A](R)){h.push(A);break}return h}class d_{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new fp,this.indexArray=new kr,this.programConfigurations=new Tl(e.layers,{zoom:e.zoom,lut:e.lut},(r=>l_.includes(r))),this._segments=new Br,this.hiddenByLandmarkVertexArray=new fo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Br}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,l,h=!1){const m=e.length;if(m>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let A;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const R=e[0],P=e[1];A=u_(R.sub(e[m-1])._perp()._unit(),P.sub(R)._perp()._unit())}for(let R=0;R<m;R++){const P=R===m-1?0:R+1,L=e[R],N=e[P],U=e[P===m-1?0:P+1],$=N.sub(L)._perp()._unit(),X=u_($,U.sub(N)._perp()._unit()),Q=A,te=X;if(Ap(L,N,r)||h&&Kd(L,r)&&Kd(N,r)){A=X;continue}const ce=v.vertexLength;Ep(this.vertexArray,L,N,1,1,Q),Ep(this.vertexArray,L,N,1,0,Q),Ep(this.vertexArray,L,N,0,1,te),Ep(this.vertexArray,L,N,0,0,te),v.vertexLength+=4;const he=zb(L,N,$,l);for(const me of he)this._segmentToGroundQuads[_].push({id:ce,region:me}),this._segmentToRegionTriCounts[_][me]+=2,v.primitiveLength+=2;A=X}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let l=0;l<r;l++)this._segmentToGroundQuads[l].sort(((h,m)=>h.region-m.region));for(let l=0;l<r;l++){const h=this._segmentToGroundQuads[l],m=e[l],_=this._segmentToRegionTriCounts[l];_.reduce(((A,R)=>A+R),0);let v=0;for(let A=0;A<=4;A++){const R=_[A];if(R!==0){let P=this.regionSegments[A];P||(P=this.regionSegments[A]=new Br);const L={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:R};P.get().push(L)}v+=R}for(let A=0;A<h.length;A++){const R=h[A].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,l,h,m,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,l,h,m,_,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,zS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Mb.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,l,h,m,_,v,A){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,l,h,m,_,v,A)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Wd))}updateHiddenByLandmarkRange(e,r,l){if(!this.hasData())return;const h=r+e;if(r!==0){for(let m=e;m<h;++m)this.hiddenByLandmarkVertexArray.emplace(m,l?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ib.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class ou{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((r=>r.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new kr,this.footprintVertices=new ba,this.footprintSegments=[],this.layoutVertexArray=new zd,this.centroidVertexArray=new vm,this.wallVertexArray=new jg,this.indexArray=new kr,this.programConfigurations=new Tl(e.layers,{zoom:e.zoom,lut:e.lut},(r=>kS.includes(r))),this.segments=new Br,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.groundEffect=new d_(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,h){}populate(e,r,l,h){this.features=[],this.hasPattern=Cy("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Pe(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:_,index:v,sourceLayerIndex:A}of e){const R=this.layers[0]._featureFilter.needGeometry,P=rt(m,R);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),P,l))continue;const L={id:_,sourceLayerIndex:A,index:v,geometry:R?P.geometry:_t(m,l,h),properties:m.properties,type:m.type,patterns:{}},N=this.layoutVertexArray.length,U=Bm[L.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:i_("fill-extrusion",this.layers,L,this.zoom,this.pixelRatio,r)});else if(this.wallMode)for(const $ of L.geometry)for(const X of a_($,U))this.addFeature(m.id,L,[X],v,l,{},r.availableImages,h,r.brightness);else this.addFeature(m.id,L,L.geometry,v,l,{},r.availableImages,h,r.brightness);r.featureIndex.insert(m,L.geometry,v,A,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,l,h,m,_){for(const{featureId:v,feature:A}of this.features){const R=Bm[A.type]==="Polygon",{geometry:P}=A;if(this.wallMode)for(const L of P)for(const N of a_(L,R))this.addFeature(v,A,[N],A.index,r,l,h,m,_);else this.addFeature(v,A,P,A.index,r,l,h,m,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,l,h,m,_,v){this.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v,this.worldview),this.groundEffect.update(e,r,m,l,h,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,r_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,LS.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Lm.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,h,m,_,v,A,R){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,L=[new Ct(0,0),new Ct(qt,qt)],N=A.projection,U=N.name==="globe",$=this.wallMode||Bm[r.type]==="Polygon",X=new Ly;X.centroidDataIndex=this.centroidData.length;const Q=new zy;Q.buildingId=e,r.properties&&r.properties.hasOwnProperty("building_id")&&(Q.buildingId=r.properties.building_id);const te=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},m)<=0,ce=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},m);let he;if(Q.height=ce,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Yh),this.wallMode){if(U)return void Tn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;he=(function(Qe){const mt=Qe[0].x===Qe[Qe.length-1].x&&Qe[0].y===Qe[Qe.length-1].y;(function(hn){let an=0;const Qn=hn.length;for(let dn=0;dn<Qn;dn++)an+=(hn[(dn+1)%Qn].x-hn[dn].x)*(hn[(dn+1)%Qn].y+hn[dn].y);return an>=0})(Qe)||(Qe=Qe.reverse());const Dt={geometry:[],joinNormals:[],indices:[]},Xt=[],Nt=[],Tt=[];let Lt=Qe.length;for(;Lt>=2&&Qe[Lt-1].equals(Qe[Lt-2]);)Lt--;if(Lt<(mt?3:2))return Dt;let ht,lt,zt,Zt,At,gn=0;for(;gn<Lt-1&&Qe[gn].equals(Qe[gn+1]);)gn++;mt&&(ht=Qe[Lt-2],At=Qe[gn].sub(ht)._unit()._perp());for(let hn=gn;hn<Lt;hn++){if(zt=hn===Lt-1?mt?Qe[gn+1]:void 0:Qe[hn+1],zt&&Qe[hn].equals(zt))continue;At&&(Zt=At),ht&&(lt=ht),ht=Qe[hn],At=zt?zt.sub(ht)._unit()._perp():Zt,Zt=Zt||At;let an=Zt.add(At);an.x===0&&an.y===0||an._unit();const Qn=an.x*At.x+an.y*At.y,dn=Qn!==0?1/Qn:1/0,kn=Zt.x*At.y-Zt.y*At.x>0;let ei="miter";const yi=2;ei==="miter"&&dn>yi&&(ei="bevel"),ei==="bevel"&&(dn>100&&(ei="flipbevel"),dn<yi&&(ei="miter"));const $i=(ri,Qi,Ji,rs)=>{const Ae=new Ct(ri.x,ri.y),we=new Ct(ri.x,ri.y);Ae.x+=Qi.x*rs,Ae.y+=Qi.y*rs,we.x-=Qi.x*Math.max(Ji,1),we.y-=Qi.y*Math.max(Ji,1),Tt.push(Qi),Xt.push(Ae),Nt.push(we)};if(ei==="miter")an._mult(dn),$i(ht,an,0,0);else if(ei==="flipbevel")an=At.mult(-1),$i(ht,an,0,0),$i(ht,an.mult(-1),0,0);else{const ri=-Math.sqrt(dn*dn-1),Qi=kn?ri:0,Ji=kn?0:ri;lt&&$i(ht,Zt,Qi,Ji),zt&&$i(ht,At,Qi,Ji)}}Dt.geometry=[...Xt,...Nt.reverse(),Xt[0]],Dt.joinNormals=[...Tt,...Tt.reverse(),Tt[Tt.length-1]];const bn=Dt.geometry.length-1;for(let hn=0;hn<bn/2;hn++)if(hn+1<bn/2){let an=hn,Qn=hn+1,dn=bn-1-hn,kn=bn-2-hn;an=an===0?bn-1:an-1,Qn=Qn===0?bn-1:Qn-1,dn=dn===0?bn-1:dn-1,kn=kn===0?bn-1:kn-1,Dt.indices.push(dn),Dt.indices.push(Qn),Dt.indices.push(an),Dt.indices.push(dn),Dt.indices.push(kn),Dt.indices.push(Qn)}return Dt})(l[0]),l=[he.geometry]}const me=(Qe,mt)=>Qe<(mt.length-1)/2||Qe===mt.length-1,Ie=this.wallMode?[l]:Sp(l,500);for(let Qe=Ie.length-1;Qe>=0;Qe--){const mt=Ie[Qe];(mt.length===0||(Ee=mt[0]).every((wt=>wt.x<=0))||Ee.every((wt=>wt.x>=qt))||Ee.every((wt=>wt.y<=0))||Ee.every((wt=>wt.y>=qt)))&&Ie.splice(Qe,1)}var Ee;let Ne;if(U)Ne=Nb(Ie,L,m);else{Ne=[];for(const Qe of Ie)Ne.push({polygon:Qe,bounds:L})}const Be=$?this.edgeRadius:0,Ue=Be>0&&this.zoom<17,ft=(Qe,mt)=>{if(Qe.length===0)return!1;const wt=Qe[Qe.length-1];return mt.x===wt.x&&mt.y===wt.y};for(const{polygon:Qe,bounds:mt}of Ne){let wt=0,Dt=0;for(const Lt of Qe)$&&!Lt[0].equals(Lt[Lt.length-1])&&Lt.push(Lt[0]),Dt+=$?Lt.length-1:Lt.length;const Xt=this.segments.prepareSegment(($?5:4)*Dt,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const Nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Tt=new Ob;if(Tt.vertexOffset=this.footprintVertices.length,Tt.indexOffset=3*this.footprintIndices.length,Tt.ringIndices=[],$){const Lt=[],ht=[];wt=Xt.vertexLength;for(let zt=0;zt<Qe.length;zt++){const Zt=Qe[zt];Zt.length&&zt!==0&&ht.push(Lt.length/2);const At=[];let gn,bn;gn=Zt[1].sub(Zt[0])._perp()._unit(),Tt.ringIndices.push(Zt.length-1);for(let hn=1;hn<Zt.length;hn++){const an=Zt[hn],Qn=Zt[hn===Zt.length-1?1:hn+1],dn=an.clone();if(Be){bn=Qn.sub(an)._perp()._unit();const kn=gn.add(bn)._unit(),ei=Be*Math.min(4,1/(gn.x*kn.x+gn.y*kn.y));dn.x+=ei*kn.x,dn.y+=ei*kn.y,dn.x=Math.round(dn.x),dn.y=Math.round(dn.y),gn=bn}if(!te||Be!==0&&!Ue||ft(At,dn)||At.push(dn),Vm(this.layoutVertexArray,dn.x,dn.y,0,0,1,1,0),this.wallMode){const kn=me(hn,Zt);Um(this.wallVertexArray,he.joinNormals[hn],!kn)}Xt.vertexLength++,this.footprintVertices.emplaceBack(an.x,an.y),Lt.push(an.x,an.y),U&&c_(this.layoutVertexExtArray,N.projectTilePoint(dn.x,dn.y,m),N.upVector(m,dn.x,dn.y))}te&&(Be===0||Ue)&&(At.length!==0&&ft(At,At[0])&&At.pop(),this.groundEffect.addData(At,mt,P))}const lt=this.wallMode?he.indices:Mm(Lt,ht);for(let zt=0;zt<lt.length;zt+=3)this.footprintIndices.emplaceBack(Tt.vertexOffset+lt[zt+0],Tt.vertexOffset+lt[zt+1],Tt.vertexOffset+lt[zt+2]),this.indexArray.emplaceBack(wt+lt[zt],wt+lt[zt+2],wt+lt[zt+1]),Xt.primitiveLength++;Tt.indexCount+=lt.length,Tt.vertexCount+=this.footprintVertices.length-Tt.vertexOffset}for(let Lt=0;Lt<Qe.length;Lt++){const ht=Qe[Lt];X.startRing(Q,ht[0]);let lt=ht.length>4&&Lb(ht[ht.length-2],ht[0],ht[1]),zt=Be?cf(ht[ht.length-2],ht[0],ht[1],Be):0;const Zt=[];let At,gn,bn;gn=ht[1].sub(ht[0])._perp()._unit();let hn=!0;for(let an=1,Qn=0;an<ht.length;an++){let dn=ht[an-1],kn=ht[an];const ei=ht[an===ht.length-1?1:an+1];if(X.appendEdge(Q,kn,dn),Ap(kn,dn,mt)){Be&&(gn=ei.sub(kn)._perp()._unit(),hn=!hn);continue}const yi=kn.sub(dn)._perp(),$i=yi.x/(Math.abs(yi.x)+Math.abs(yi.y)),ri=yi.y>0?1:0,Qi=dn.dist(kn);if(Qn+Qi>32768&&(Qn=0),Be){bn=ei.sub(kn)._perp()._unit();let we=$m(dn,kn,ei,Xd(gn,bn),Be);isNaN(we)&&(we=0);const yt=kn.sub(dn)._unit();dn=dn.add(yt.mult(zt))._round(),kn=kn.add(yt.mult(-we))._round(),zt=we,gn=bn,te&&this.zoom>=17&&(ft(Zt,dn)||Zt.push(dn),ft(Zt,kn)||Zt.push(kn))}const Ji=Xt.vertexLength,rs=ht.length>4&&Lb(dn,kn,ei);let Ae=Ev(Qn,lt,hn);if(Vm(this.layoutVertexArray,dn.x,dn.y,$i,ri,0,0,Ae),Vm(this.layoutVertexArray,dn.x,dn.y,$i,ri,0,1,Ae),this.wallMode){const we=me(an-1,ht),yt=he.joinNormals[an-1];Um(this.wallVertexArray,yt,we),Um(this.wallVertexArray,yt,we)}if(Qn+=Qi,Ae=Ev(Qn,rs,!hn),lt=rs,Vm(this.layoutVertexArray,kn.x,kn.y,$i,ri,0,0,Ae),Vm(this.layoutVertexArray,kn.x,kn.y,$i,ri,0,1,Ae),this.wallMode){const we=me(an,ht),yt=he.joinNormals[an];Um(this.wallVertexArray,yt,we),Um(this.wallVertexArray,yt,we)}if(Xt.vertexLength+=4,this.indexArray.emplaceBack(Ji+0,Ji+1,Ji+2),this.indexArray.emplaceBack(Ji+1,Ji+3,Ji+2),Xt.primitiveLength+=2,Be){const we=wt+(an===1?ht.length-2:an-2),yt=an===1?wt:we+1;if(this.indexArray.emplaceBack(Ji+1,we,Ji+3),this.indexArray.emplaceBack(we,yt,Ji+3),Xt.primitiveLength+=2,At===void 0&&(At=Ji),!Ap(ei,ht[an],mt)){const en=an===ht.length-1?At:Xt.vertexLength;this.indexArray.emplaceBack(Ji+2,Ji+3,en),this.indexArray.emplaceBack(Ji+3,en+1,en),this.indexArray.emplaceBack(Ji+3,yt,en+1),Xt.primitiveLength+=3}hn=!hn}if(U){const we=this.layoutVertexExtArray,yt=N.projectTilePoint(dn.x,dn.y,m),en=N.projectTilePoint(kn.x,kn.y,m),xt=N.upVector(m,dn.x,dn.y),ln=N.upVector(m,kn.x,kn.y);c_(we,yt,xt),c_(we,yt,xt),c_(we,en,ln),c_(we,en,ln)}}$&&(wt+=ht.length-1),te&&Be&&this.zoom>=17&&(Zt.length!==0&&ft(Zt,Zt[0])&&Zt.pop(),this.groundEffect.addData(Zt,mt,P,Be>0))}this.footprintSegments.push(Tt),Nt.triangleCount=this.indexArray.length-Nt.triangleArrayOffset,this.polygonSegments.push(Nt),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=X.borders?wv:this.encodeCentroid(X,Q),this.centroidData.push(Q),X.borders){this.featuresOnBorder.push(X);const Qe=this.featuresOnBorder.length-1;for(let mt=0;mt<X.borders.length;mt++)X.borders[mt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[mt].push(Qe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,v,m,R,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(r,h,_,v,m,R,this.worldview),this.maxHeight=Math.max(this.maxHeight,ce)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((r,l)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[l].borders[e][0]))}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const A=this.centroidData[v],R=+(A.min.y+A.max.y>qt),P=2*R+(+(A.min.x+A.max.x>qt)^R);for(let L=0;L<A.polygonSegLen;L++){const N=A.polygonSegIdx+L;e.push({centroidIdx:v,subtile:P,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const r=new kr;e.sort(((v,A)=>v.triangleSegmentIdx===A.triangleSegmentIdx?v.subtile-A.subtile:v.triangleSegmentIdx-A.triangleSegmentIdx));let l=0,h=0,m=0;for(const v of e){if(v.triangleSegmentIdx!==l)break;m++}const _=e.length;for(;h!==e.length;){l=e[h].triangleSegmentIdx;let v=0,A=h,R=h;for(let P=A;P<m&&e[P].subtile===v;P++)R++;for(;A!==m;){const P=e[A];v=P.subtile;const L=this.centroidData[P.centroidIdx].min.clone(),N=this.centroidData[P.centroidIdx].max.clone(),U={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=A;$<R;$++){const X=e[$],Q=this.polygonSegments[X.polygonSegmentIdx],te=this.centroidData[X.centroidIdx].min,ce=this.centroidData[X.centroidIdx].max,he=this.indexArray.uint16;for(let me=Q.triangleArrayOffset;me<Q.triangleArrayOffset+Q.triangleCount;me++)r.emplaceBack(he[3*me],he[3*me+1],he[3*me+2]);U.primitiveLength+=Q.triangleCount,L.x=Math.min(L.x,te.x),L.y=Math.min(L.y,te.y),N.x=Math.max(N.x,ce.x),N.y=Math.max(N.y,ce.y)}U.primitiveLength>0&&this.triangleSubSegments.push({segment:U,min:L,max:N}),A=R;for(let $=A;$<m&&e[$].subtile===e[A].subtile;$++)R++}h=m;for(let P=h;P<_&&e[P].triangleSegmentIdx===e[h].triangleSegmentIdx;P++)m++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,l){const h=new Br;if(this.wallMode){for(const X of this.triangleSubSegments)h.segments.push(X.segment);return h}let m=0,_=0;const v=1<<e.canonical.z;if(r){const X=r.getMinMaxForTile(e);X&&(m=X.min,_=X.max)}_+=this.maxHeight;const A=e.toUnwrapped();let R;const P=[A.canonical.x/v+A.wrap,A.canonical.y/v],L=[(A.canonical.x+1)/v+A.wrap,(A.canonical.y+1)/v],N=(X,Q,te)=>[X[0]*(1-te[0])+Q[0]*te[0],X[1]*(1-te[1])+Q[1]*te[1]],U=[],$=[];for(const X of this.triangleSubSegments){U[0]=X.min.x/qt,U[1]=X.min.y/qt,$[0]=X.max.x/qt,$[1]=X.max.y/qt;const Q=N(P,L,U),te=N(P,L,$);if(new di([Q[0],Q[1],m],[te[0],te[1],_]).intersectsPrecise(l)===0){R&&(h.segments.push(R),R=void 0);continue}const ce=X.segment;R&&R.vertexOffset!==ce.vertexOffset&&(h.segments.push(R),R=void 0),R?(R.vertexLength+=ce.vertexLength,R.primitiveLength+=ce.primitiveLength):R={vertexOffset:ce.vertexOffset,primitiveLength:ce.primitiveLength,vertexLength:ce.vertexLength,primitiveOffset:ce.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&h.segments.push(R),h}encodeCentroid(e,r){const l=e.centroid(),h=r.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),_=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Ct(se(l.x,1,qt-1)<<3|m,se(l.y,1,qt-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Ct(0,0);const r=e.borders,l=Number.MAX_VALUE;if(r[0][0]!==l||r[1][0]!==l){const h=r[0][0]!==l?0:1;return new Ct(6|(r[0][0]!==l?0:65528),(r[h][0]+r[h][1])/2<<3|6)}{const h=r[2][0]!==l?2:3;return new Ct((r[h][0]+r[h][1])/2<<3|6,6|(r[2][0]!==l?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=2147483647,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,h=e.flags&Wd?wv:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==h.y||m!==h.x){for(let _=r;_<l;++_)this.centroidVertexArray.emplace(_,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const h=r.getReplacementRegionsForTile(e.toUnwrapped());if(o_(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const m=[];for(const _ of this.activeReplacements){if(_.order<l)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingId){const A=_.footprint.buildingId;for(const R of this.centroidData)R.buildingId===A&&(R.flags|=Wd)}else for(const A of this.centroidData)if(!(A.flags&Wd||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y))for(let R=0;R<A.footprintSegLen;R++){const P=this.footprintSegments[A.footprintSegIdx+R];if(m.length=0,kb(this.footprintVertices,P.vertexOffset,P.vertexCount,_.footprintTileId.canonical,e.canonical,m),Dy(_.footprint,m,this.footprintIndices.uint16,P.indexOffset,P.indexCount,-P.vertexOffset,-v)){A.flags|=Wd;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,l){let h=!1;for(let m=0;m<l.footprintSegLen;m++){const _=this.footprintSegments[l.footprintSegIdx+m];let v=0;for(const A of _.ringIndices){for(let R=v,P=A+v-1;R<A+v;P=R++){const L=this.footprintVertices.int16[2*(R+_.vertexOffset)+0],N=this.footprintVertices.int16[2*(R+_.vertexOffset)+1],U=this.footprintVertices.int16[2*(P+_.vertexOffset)+1];N>r!=U>r&&e<(this.footprintVertices.int16[2*(P+_.vertexOffset)+0]-L)*(r-N)/(U-N)+L&&(h=!h)}v=A}}return h}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,h=!0;const m=4*(e+qt)*qt+(r+qt);if(this.partLookup.hasOwnProperty(m)){const _=this.partLookup[m];return _?{height:_.height,hidden:!!(_.flags&Wd)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||r>_.max.y||_.min.y>r||_.height<=l||this.footprintContainsPoint(e,r,_)&&(l=_.height,this.partLookup[m]=_,h=!!(_.flags&Wd));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.partLookup[m]=void 0}}function Xd(o,e){const r=o.add(e)._unit();return o.x*r.x+o.y*r.y}function cf(o,e,r,l){const h=e.sub(o)._perp()._unit(),m=r.sub(e)._perp()._unit();return $m(o,e,r,Xd(h,m),l)}function $m(o,e,r,l,h){const m=Math.sqrt(1-l*l);return Math.min(o.dist(e)/3,e.dist(r)/3,h*m/l)}function Ap(o,e,r){return o.x<r[0].x&&e.x<r[0].x||o.x>r[1].x&&e.x>r[1].x||o.y<r[0].y&&e.y<r[0].y||o.y>r[1].y&&e.y>r[1].y}function Kd(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function Lb(o,e,r){if(o.x<0||o.x>=qt||e.x<0||e.x>=qt||r.x<0||r.x>=qt)return!1;const l=r.sub(e),h=l.perp(),m=o.sub(e);return(l.x*m.x+l.y*m.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function Ev(o,e,r){const l=e?2|o:-3&o;return r?1|l:-2&l}function Gm(){const o=Math.PI/32,e=Math.tan(o),r=k;return r*Math.sqrt(1+2*e*e)-r}function Nb(o,e,r){const l=1<<r.z,h=ye(r.x/l),m=ye((r.x+1)/l),_=fe(r.y/l),v=fe((r.y+1)/l);return(function(A,R,P,L,N=0,U){const $=[];if(!A.length||!P||!L)return $;const X=(Ee,Ne)=>{for(const Be of Ee)$.push({polygon:Be,bounds:Ne})},Q=Math.ceil(Math.log2(P)),te=Math.ceil(Math.log2(L)),ce=Q-te,he=[];for(let Ee=0;Ee<Math.abs(ce);Ee++)he.push(ce>0?0:1);for(let Ee=0;Ee<Math.min(Q,te);Ee++)he.push(0),he.push(1);let me=A;if(me=lf(me,R[0].y-N,R[1].y+N,1),me=lf(me,R[0].x-N,R[1].x+N,0),!me.length)return $;const Ie=[];for(he.length?Ie.push({polygons:me,bounds:R,depth:0}):X(me,R);Ie.length;){const Ee=Ie.pop(),Ne=Ee.depth,Be=he[Ne],Ue=Ee.bounds[0],ft=Ee.bounds[1],Qe=Be===0?Ue.x:Ue.y,mt=Be===0?ft.x:ft.y,wt=U?U(Be,Qe,mt):.5*(Qe+mt),Dt=lf(Ee.polygons,Qe-N,wt+N,Be),Xt=lf(Ee.polygons,wt-N,mt+N,Be);if(Dt.length){const Nt=[Ue,new Ct(Be===0?wt:ft.x,Be===1?wt:ft.y)];he.length>Ne+1?Ie.push({polygons:Dt,bounds:Nt,depth:Ne+1}):X(Dt,Nt)}if(Xt.length){const Nt=[new Ct(Be===0?wt:Ue.x,Be===1?wt:Ue.y),ft];he.length>Ne+1?Ie.push({polygons:Xt,bounds:Nt,depth:Ne+1}):X(Xt,Nt)}}return $})(o,e,Math.ceil((m-h)/11.25),Math.ceil((_-v)/11.25),1,((A,R,P)=>{if(A===0)return .5*(R+P);{const L=fe((r.y+R/qt)/l);return(re(.5*(fe((r.y+P/qt)/l)+L))*l-r.y)*qt}}))}function kb(o,e,r,l,h,m){const _=Math.pow(2,l.z-h.z);for(let v=0;v<r;v++){let A=o.int16[2*(v+e)+0],R=o.int16[2*(v+e)+1];A=(A+h.x*qt)*_-l.x*qt,R=(R+h.y*qt)*_-l.y*qt,m.push(new Ct(A,R))}}let h_,Av;jt(ou,"FillExtrusionBucket",{omit:["layers","features"]}),jt(zy,"PartData"),jt(Ob,"FootprintSegment"),jt(Ly,"BorderCentroidData"),jt(d_,"GroundEffect");class Cp extends Ct{constructor(e,r,l){super(e,r),this.z=l}}class f_ extends Cp{constructor(e,r,l,h){super(e,r,l),this.w=h}}function p_(o,e,r,l){const h=r==="x"?"y":"x",m=(l-o[r])/(e[r]-o[r]);o[h]=Math.round(o[h]+(e[h]-o[h])*m),o[r]=l,o.hasOwnProperty("z")&&(o.z=Gn(o.z,e.z,m)),o.hasOwnProperty("w")&&(o.w=Gn(o.w,e.w,m))}function Cv(o,e,r,l){const h=r,m=l;for(const _ of["x","y"]){let v=o,A=e;v[_]>=A[_]&&(v=e,A=o),v[_]<h&&A[_]>h&&p_(v,A,_,h),v[_]<m&&A[_]>m&&p_(A,v,_,m)}}function Yd(o,e,r,l,h,m){const _=[];for(let v=0;v<o.length;v++){const A=o[v];let R;const P=_.length;let L=0;for(let N=0;N<A.length-1;N++){let U=A[N],$=A[N+1],X=0;const Q=L;let te,ce;m&&(X=Math.hypot($.x-U.x,$.y-U.y),L+=X,te=U,ce=$),U.x<e&&$.x<e||(U.x<e?U=new Ct(e,U.y+(e-U.x)/($.x-U.x)*($.y-U.y))._round():$.x<e&&($=new Ct(e,U.y+(e-U.x)/($.x-U.x)*($.y-U.y))._round()),U.y<r&&$.y<r||(U.y<r?U=new Ct(U.x+(r-U.y)/($.y-U.y)*($.x-U.x),r)._round():$.y<r&&($=new Ct(U.x+(r-U.y)/($.y-U.y)*($.x-U.x),r)._round()),U.x>=l&&$.x>=l||(U.x>=l?U=new Ct(l,U.y+(l-U.x)/($.x-U.x)*($.y-U.y))._round():$.x>=l&&($=new Ct(l,U.y+(l-U.x)/($.x-U.x)*($.y-U.y))._round()),U.y>=h&&$.y>=h||(U.y>=h?U=new Ct(U.x+(h-U.y)/($.y-U.y)*($.x-U.x),h)._round():$.y>=h&&($=new Ct(U.x+(h-U.y)/($.y-U.y)*($.x-U.x),h)._round()),R&&U.equals(R[R.length-1])||(R=[U],_.push(R),m&&m.push({progress:{min:Q+Ny(te,ce,U)*X,max:1},parentIndex:v,prevPoint:te,nextPoint:ce})),R.push($),m&&(m[m.length-1].progress.max=Q+Ny(te,ce,$)*X,m[m.length-1].nextPoint=ce)))))}if(m&&L>0)for(let N=P;N<_.length;N++)m[N].progress.min/=L,m[N].progress.max/=L}return _}function jb(o,e,r,l,h){if(o.length<2)return void l.push(o);const m=[];for(;e.valid();){const[R,P]=e.get();for(let L=0;L<o.length-1;L++){const N=o[L],U=o[L+1],$=Ba(N,U,R,P);if($){const[X]=$,Q=new Ct(Gn(N.x,U.x,X),Gn(N.y,U.y,X));m.push({t:L+X,distance:0,point:Q})}}e.next()}if(m.length===0)return void l.push(o);m.sort(((R,P)=>R.t-P.t));let _=0,v=0,A=[];for(l.push(A);_!==o.length;){if(v===m.length){for(;_!==o.length;)A.length!==0&&A[A.length-1].equals(o[_])||A.push(o[_]),_++;break}m[v].t<=_?(A.length!==0&&A[A.length-1].equals(m[v].point)||A.push(m[v].point),Math.trunc(m[v].t),v++):(A.length!==0&&A[A.length-1].equals(o[_])||A.push(o[_]),_++)}}function Ny(o,e,r){return o.x!==e.x?(r.x-o.x)/(e.x-o.x):o.y!==e.y?(r.y-o.y)/(e.y-o.y):0}function uf(o,e){return o.x*e.x+o.y*e.y}function Rv(o,e){if(o.length===1){let r=0;const l=e[r++];let h;for(;!h||l.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const m=e[r],_=o[0],v=h.sub(l),A=m.sub(l),R=_.sub(l),P=uf(v,v),L=uf(v,A),N=uf(A,A),U=uf(R,v),$=uf(R,A),X=P*N-L*L,Q=(N*U-L*$)/X,te=(P*$-L*U)/X,ce=l.z*(1-Q-te)+h.z*Q+m.z*te;if(isFinite(ce))return ce}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}function Fb(o,e,r){let l=1/0;Yr(r,e)&&(l=Rv(r,e[0]));for(let h=0;h<e.length;h++){const m=e[h],_=o[h];for(let v=0;v<m.length-1;v++){const A=m[v],R=[A,m[v+1],_[v+1],_[v],A];Dr(r,R)&&(l=Math.min(l,Rv(r,R)))}}return l!==1/0&&l}function m_(o,e,r,l,h,m,_,v,A,R,P){return o.projection.name==="globe"?(function(L,N,U,$,X,Q,te,ce,he,me,Ie){const Ee=[],Ne=[],Be=L.projection.upVectorScale(Ie,L.center.lat,L.worldSize).metersToTile,Ue=[0,0,0,1],ft=[0,0,0,1],Qe=(wt,Dt,Xt,Nt)=>{wt[0]=Dt,wt[1]=Xt,wt[2]=Nt,wt[3]=1},mt=Gm();U>0&&(U+=mt),$+=mt;for(const wt of N){const Dt=[],Xt=[];for(const Nt of wt){const Tt=Nt.x+X.x,Lt=Nt.y+X.y,ht=L.projection.projectTilePoint(Tt,Lt,Ie),lt=L.projection.upVector(Ie,Nt.x,Nt.y);let zt=U,Zt=$;if(te){const At=u(Tt,Lt,U,$,te,ce,he,me);zt+=At.base,Zt+=At.top}U!==0?Qe(Ue,ht.x+lt[0]*Be*zt,ht.y+lt[1]*Be*zt,ht.z+lt[2]*Be*zt):Qe(Ue,ht.x,ht.y,ht.z),Qe(ft,ht.x+lt[0]*Be*Zt,ht.y+lt[1]*Be*Zt,ht.z+lt[2]*Be*Zt),Ri(Ue,Ue,Q),Ri(ft,ft,Q),Dt.push(new Cp(Ue[0],Ue[1],Ue[2])),Xt.push(new Cp(ft[0],ft[1],ft[2]))}Ee.push(Dt),Ne.push(Xt)}return[Ee,Ne]})(o,e,r,l,h,m,_,v,A,R,P):_?(function(L,N,U,$,X,Q,te,ce,he){const me=[],Ie=[],Ee=[0,0,0,1];for(const Ne of L){const Be=[],Ue=[];for(const ft of Ne){const Qe=ft.x+$.x,mt=ft.y+$.y,wt=u(Qe,mt,N,U,Q,te,ce,he);Ee[0]=Qe,Ee[1]=mt,Ee[2]=wt.base,Ee[3]=1,yn(Ee,Ee,X),Ee[3]=Math.max(Ee[3],1e-5);const Dt=new Cp(Ee[0]/Ee[3],Ee[1]/Ee[3],Ee[2]/Ee[3]);Ee[0]=Qe,Ee[1]=mt,Ee[2]=wt.top,Ee[3]=1,yn(Ee,Ee,X),Ee[3]=Math.max(Ee[3],1e-5);const Xt=new Cp(Ee[0]/Ee[3],Ee[1]/Ee[3],Ee[2]/Ee[3]);Be.push(Dt),Ue.push(Xt)}me.push(Be),Ie.push(Ue)}return[me,Ie]})(e,r,l,h,m,_,v,A,R):(function(L,N,U,$,X){const Q=[],te=[],ce=X[8]*N,he=X[9]*N,me=X[10]*N,Ie=X[11]*N,Ee=X[8]*U,Ne=X[9]*U,Be=X[10]*U,Ue=X[11]*U;for(const ft of L){const Qe=[],mt=[];for(const wt of ft){const Dt=wt.x+$.x,Xt=wt.y+$.y,Nt=X[0]*Dt+X[4]*Xt+X[12],Tt=X[1]*Dt+X[5]*Xt+X[13],Lt=X[2]*Dt+X[6]*Xt+X[14],ht=X[3]*Dt+X[7]*Xt+X[15],lt=Nt+ce,zt=Tt+he,Zt=Lt+me,At=Math.max(ht+Ie,1e-5),gn=Nt+Ee,bn=Tt+Ne,hn=Lt+Be,an=Math.max(ht+Ue,1e-5);Qe.push(new Cp(lt/At,zt/At,Zt/At)),mt.push(new Cp(gn/an,bn/an,hn/an))}Q.push(Qe),te.push(mt)}return[Q,te]})(e,r,l,h,m)}function u(o,e,r,l,h,m,_,v){const A=_*h.getElevationAt(o,e,!0,!0),R=m[0]!==0,P=R?m[1]===0?_*(m[0]/Sv-Oy):_*(function(L,N,U){const $=Math.floor(N[0]/8),X=Math.floor(N[1]/8),Q=10*(N[0]-8*$),te=10*(N[1]-8*X),ce=L.getElevationAt($,X,!0,!0),he=L.getMeterToDEM(U),me=Math.floor(.5*(Q*he-1)),Ie=Math.floor(.5*(te*he-1)),Ee=L.tileCoordToPixel($,X),Ne=2*me+1,Be=2*Ie+1,Ue=(function(Xt,Nt,Tt,Lt,ht){return[Xt.getElevationAtPixel(Nt,Tt,!0),Xt.getElevationAtPixel(Nt+ht,Tt,!0),Xt.getElevationAtPixel(Nt,Tt+ht,!0),Xt.getElevationAtPixel(Nt+Lt,Tt+ht,!0)]})(L,Ee.x-me,Ee.y-Ie,Ne,Be),ft=Math.abs(Ue[0]-Ue[1]),Qe=Math.abs(Ue[2]-Ue[3]),mt=Math.abs(Ue[0]-Ue[2])+Math.abs(Ue[1]-Ue[3]),wt=Math.min(.25,.5*he*(ft+Qe)/Ne),Dt=Math.min(.25,.5*he*mt/Be);return ce+Math.max(wt*Q,Dt*te)})(h,m,v):A;return{base:A+(r===0?-1:r),top:R?Math.max(P+l,A+r+2):A+l}}class g{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class S{constructor(){this.tasks={},this.taskQueue=[],nt(["process"],this),this.invoker=new g(this.process),this.nextId=0}add(e,r){const l=this.nextId++,h=(function({type:m,isSymbolTile:_,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||_?m!=="parseTile"||_?m==="parseTile"&&_?300-v:m==="maybePrepare"&&_?400-v:500:200-v:100-v})(r);if(h===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:r,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((l=>!!this.tasks[l])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<r&&(r=m.priority,e=h)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class I{constructor(e,r,l){this.target=e,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},nt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new S}send(e,r,l,h,m=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[v]=l);const A=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!l,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:$l(r,A)},A),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||Lr(self)){const h=this.callbacks[l],m=this.scheduler.add((()=>this.processTask(l,r)),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[l]=m)}else this.processTask(l,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(r.error?l(tl(r.error)):l(null,tl(r.data)))}else{const l=new Set,h=r.hasCallback?(_,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?$l(_):null,data:$l(v,l)},l)}:()=>{},m=tl(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,m,h);else if(this.parent.getWorkerSource){const _=r.type.split("."),{source:v,scope:A}=m;this.parent.getWorkerSource(r.sourceMapId,_[0],v,A)[_[1]](m,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var B={workerUrl:"",workerClass:null,workerParams:void 0};const q="mapboxgl_preloaded_worker_pool";class de{constructor(){this.active={}}acquire(e,r=de.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(B.workerClass!=null?new B.workerClass:new self.Worker(B.workerUrl,B.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[q]}numActive(){return Object.keys(this.active).length}}de.workerCount=2;class Oe{constructor(e,r,l="Worker",h=de.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=at();const m=this.workerPool.acquire(this.id,h);for(let _=0;_<m.length;_++){const v=new Oe.Actor(m[_],r,this.id);v.name=`${l} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,r,l){ke(this.actors,((h,m)=>{h.send(e,r,m)}),l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let ot,Gt;function mn(){return ot||(ot=new de),ot}Oe.Actor=I;class xn{constructor(e){this.module=e}createIntArray(e){const r=new Int32Array(e),l=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heap32.set(r,l/r.BYTES_PER_ELEMENT),l}createFloatArray(e){const r=new Float32Array(e),l=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heapF32.set(r,l/r.BYTES_PER_ELEMENT),l}createStringBuffer(e){const r=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[r+l]=e.charCodeAt(l);return this.module.heapU8[r+e.length]=0,r}readStringBuffer(e){let r="";for(;this.module.heapU8[e]!==0;)r+=String.fromCharCode(this.module.heapU8[e]),++e;return r}setStyle(e){const r=e.entranceColorRgb,l=e.facadeGlazingColorRgb,h=e.roofColorRgb,m=e.wallColorRgb,_=e.normalScale;this.module.setStyle(r[0],r[1],r[2],l[0],l[1],l[2],h[0],h[1],h[2],m[0],m[1],m[2],_[0],_[1],_[2],e.tileToMeters)}setAOOptions(e,r){this.module.setAOOptions(e?1:0,r)}setMetricOptions(e,r){this.module.setMetricOptions(e?1:0,r)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,r){this.module.setFacadeOptions(e,r?1:0)}setFauxFacadeOptions(e,r,l){this.module.setFauxFacadeOptions(e?1:0,r?1:0,l)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,r){for(const v of e){const A=this.createStringBuffer(v.roofType),R=[0],P=[];for(const U of v.coordinates)if(Array.isArray(U)){for(const $ of U)P.push($.x),P.push($.y);R.push(P.length)}const L=this.createIntArray(R),N=this.createFloatArray(P);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,A,v.roofType.length,N,L,R.length-1),this.module.free(A),this.module.free(L),this.module.free(N)}for(const v of r){let A;A=v.entrances?JSON.parse(v.entrances):[];const R=this.createFloatArray(A),P=[];for(const N of v.coordinates)P.push(N.x),P.push(N.y);const L=this.createFloatArray(P);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,R,A.length,L,P.length),this.module.free(R),this.module.free(L)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const l=this.module.getMeshCount(),h=new Array(l);for(let v=0;v<l;v++){const A=this.module.getPositionsPtr(v),R=this.module.getPositionsLength(v),P=new Float32Array(this.module.heapF32.buffer,A,R),L=this.module.getNormalsPtr(v),N=this.module.getNormalsLength(v),U=new Float32Array(this.module.heapF32.buffer,L,N),$=this.module.getColorsPtr(v),X=this.module.getColorsLength(v),Q=new Uint8Array(this.module.heapU8.buffer,$,X),te=this.module.getAOPtr(v),ce=this.module.getAOLength(v),he=new Float32Array(this.module.heapF32.buffer,te,ce),me=this.module.getUVPtr(v),Ie=this.module.getUVLength(v),Ee=new Float32Array(this.module.heapF32.buffer,me,Ie),Ne=this.module.getFauxFacadePtr(v),Be=this.module.getFauxFacadeLength(v),Ue=new Uint8Array(this.module.heapU8.buffer,Ne,Be),ft=this.module.getIndicesPtr(v),Qe=this.module.getIndicesLength(v),mt=new Int32Array(this.module.heap32.buffer,ft,Qe),wt=this.module.getBuildingPart(v),Dt=this.readStringBuffer(wt);h[v]={positions:P,normals:U,colors:Q,ao:he,uv:Ee,isFauxFacade:Ue,indices:mt,buildingPart:Dt}}const m=this.module.getRingCount(),_=[];for(let v=0;v<m;v++){const A=this.module.getRingPtr(v),R=this.module.getRingLength(v),P=new Float32Array(this.module.heapF32.buffer,A,R);_.push(P)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Wt,tn,ni,Di,Ts,Mt=null,pt=null,Ht=null,_n=null;function Pi(){return Lr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:tn||Ir.DRACO_URL}function os(){if(Lr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Di)return Di;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Di=WebAssembly.validate(o)?Ir.MESHOPT_SIMD_URL:Ir.MESHOPT_URL,Di}function Ti(){return _n}const hr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qr={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Zr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Qd(o,e,r){const l=r.json.bufferViews.length,h=r.buffers.length;e.bufferView=l,r.json.bufferViews[l]={buffer:h,byteLength:o.byteLength},r.buffers[h]=o}const Mv="KHR_draco_mesh_compression";function KF(o,e){const r=o.extensions&&o.extensions[Mv];if(!r)return;const l=new ni.Decoder,h=NC(e,r.bufferView),m=new ni.Mesh;if(!l.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[o.indices],v=hr[_.componentType],A=_.count*v.BYTES_PER_ELEMENT,R=ni._malloc(A);v===Uint16Array?l.GetTrianglesUInt16Array(m,A,R):l.GetTrianglesUInt32Array(m,A,R),Qd(ni.memory.buffer.slice(R,R+A),_,e),ni._free(R);for(const P of Object.keys(r.attributes)){const L=l.GetAttributeByUniqueId(m,r.attributes[P]),N=e.json.accessors[o.attributes[P]],U=qr[N.componentType],$=N.count*Zr[N.type]*hr[N.componentType].BYTES_PER_ELEMENT,X=ni._malloc($);l.GetAttributeDataArrayForAllPoints(m,L,ni[U],$,X),Qd(ni.memory.buffer.slice(X,X+$),N,e),ni._free(X)}l.destroy(),m.destroy(),delete o.extensions[Mv]}const Bb="EXT_meshopt_compression";function YF(o,e){if(!o.extensions||!o.extensions[Bb])return;const r=o.extensions[Bb],l=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),h=new Uint8Array(r.count*r.byteStride);Ts.decodeGltfBuffer(h,r.count,r.byteStride,l,r.mode,r.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=h.buffer,delete o.extensions[Bb]}const OC=1179937895,zC=new TextDecoder("utf8");function LC(o,e){return new URL(o,e).href}function QF(o,e,r,l){return fetch(LC(o.uri,l)).then((h=>h.arrayBuffer())).then((h=>{e.buffers[r]=h}))}function NC(o,e){const r=o.json.bufferViews[e];return new Uint8Array(o.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function JF(o,e,r,l){if(o.uri){const h=LC(o.uri,l);return fetch(h).then((m=>m.blob())).then((m=>createImageBitmap(m))).then((m=>{e.images[r]=m}))}if(o.bufferView!==void 0){const h=NC(e,o.bufferView),m=new Blob([h],{type:o.mimeType});return createImageBitmap(m).then((_=>{e.images[r]=_}))}}function kC(o,e=0,r){const l={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===OC){const P=new Uint32Array(o,e);let L=2;const N=(P[L++]>>2)-3,U=P[L++]>>2;if(L++,l.json=JSON.parse(zC.decode(P.subarray(L,L+U))),L+=U,L<N){const $=P[L++];L++;const X=e+(L<<2);l.buffers[0]=o.slice(X,X+$)}}else l.json=JSON.parse(zC.decode(new Uint8Array(o,e)));const{buffers:h,images:m,meshes:_,extensionsUsed:v,bufferViews:A}=l.json;let R=Promise.resolve();if(h){const P=[];for(let L=0;L<h.length;L++){const N=h[L];N.uri?P.push(QF(N,l,L,r)):l.buffers[L]||(l.buffers[L]=null)}R=Promise.all(P)}return R.then((()=>{const P=[],L=v&&v.includes(Mv),N=v&&v.includes(Bb);if(L&&P.push((function(){if(!ni)return Wt??(Wt=(function(U){let $,X=null;function Q(){$=new Uint8Array(X.buffer)}function te(){throw new Error("Unexpected Draco error.")}const ce={a:{a:te,d:function(he,me,Ie){return $.copyWithin(he,me,me+Ie)},c:function(he){const me=$.length,Ie=Math.max(he>>>0,Math.ceil(1.2*me)),Ee=Math.ceil((Ie-me)/65536);try{return X.grow(Ee),Q(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(U,ce):U.then((he=>he.arrayBuffer())).then((he=>WebAssembly.instantiate(he,ce)))).then((he=>{const{Rb:me,Qb:Ie,P:Ee,T:Ne,X:Be,Ja:Ue,La:ft,Qa:Qe,Va:mt,Wa:wt,eb:Dt,jb:Xt,f:Nt,e:Tt,yb:Lt,zb:ht,Ab:lt,Bb:zt,Db:Zt,Gb:At}=he.instance.exports;X=Tt;const gn=(()=>{let bn=0,hn=0,an=0,Qn=0;return dn=>{an&&(me(Qn),me(bn),hn+=an,an=bn=0),bn||(hn+=128,bn=Ie(hn));const kn=dn.length+7&-8;let ei=bn;kn>=hn&&(an=kn,ei=Qn=Ie(kn));for(let yi=0;yi<dn.length;yi++)$[ei+yi]=dn[yi];return ei}})();return Q(),Nt(),{memory:Tt,_free:me,_malloc:Ie,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Ne(this.ptr)}},Decoder:class{constructor(){this.ptr=Ue()}destroy(){Xt(this.ptr)}DecodeArrayToMesh(bn,hn,an){const Qn=gn(bn),dn=ft(this.ptr,Qn,hn,an.ptr);return!!Be(dn)}GetAttributeByUniqueId(bn,hn){return{ptr:Qe(this.ptr,bn.ptr,hn)}}GetTrianglesUInt16Array(bn,hn,an){mt(this.ptr,bn.ptr,hn,an)}GetTrianglesUInt32Array(bn,hn,an){wt(this.ptr,bn.ptr,hn,an)}GetAttributeDataArrayForAllPoints(bn,hn,an,Qn,dn){Dt(this.ptr,bn.ptr,hn.ptr,an,Qn,dn)}},DT_INT8:Lt(),DT_UINT8:ht(),DT_INT16:lt(),DT_UINT16:zt(),DT_UINT32:Zt(),DT_FLOAT32:At()}}))})(fetch(Pi())),Wt.then((U=>{ni=U,Wt=void 0})))})()),N&&P.push((function(){if(Ts)return;const U=(function($){let X;const Q=WebAssembly.instantiateStreaming($,{}).then((he=>{X=he.instance,X.exports.__wasm_call_ctors()})),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ce={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(he,me,Ie,Ee,Ne,Be){(function(Ue,ft,Qe,mt,wt,Dt,Xt){const Nt=Ue.exports.sbrk,Tt=mt+3&-4,Lt=Nt(Tt*wt),ht=Nt(Dt.length),lt=new Uint8Array(Ue.exports.memory.buffer);lt.set(Dt,ht);const zt=ft(Lt,mt,wt,ht,Dt.length);if(zt===0&&Xt&&Xt(Lt,Tt,wt),Qe.set(lt.subarray(Lt,Lt+mt*wt)),Nt(Lt-Nt(0)),zt!==0)throw new Error(`Malformed buffer data: ${zt}`)})(X,X.exports[ce[Ne]],he,me,Ie,Ee,X.exports[te[Be]])}}})(fetch(os()));return U.ready.then((()=>{Ts=U}))})()),m)for(let U=0;U<m.length;U++)P.push(JF(m[U],l,U,r));return(P.length?Promise.all(P):Promise.resolve()).then((()=>{if(L&&_)for(const{primitives:U}of _)for(const $ of U)KF($,l);if(N&&_&&A)for(const U of A)YF(U,l);return l}))}))}function jC(o){return fetch(o).then((e=>e.arrayBuffer())).then((e=>kC(e,0,o)))}function FS(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function BS(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class VS{constructor(e,r,l,h){this.context=e,this.format=l,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:h&&h.premultiply})}update(e,r){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:_}=m,{x:v,y:A}=r&&r.position?r.position:{x:0,y:0},R=v+l,P=A+h;!this.size||this.size[0]===R&&this.size[1]===P||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!r||r.premultiply!==!1));const L=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&R>0&&P>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(R,P)))+1:1;_.texStorage2D(_.TEXTURE_2D,N,this.format,R,P),this.size=[R,P]}this.size&&(L?_.texSubImage2D(_.TEXTURE_2D,0,v,A,FS(this.format),BS(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,A,l,h,FS(this.format),BS(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,r,l=!1){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,l,h,m){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),r!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),this.wrapS=l),h!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrapT=h),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Iv{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrapS=r)}}const eB=xi([{name:"a_pos_3f",components:3,type:"Float32"}]),tB=xi([{name:"a_color_3f",components:3,type:"Float32"}]),nB=xi([{name:"a_color_4f",components:4,type:"Float32"}]),iB=xi([{name:"a_uv_2f",components:2,type:"Float32"}]),rB=xi([{name:"a_normal_3f",components:3,type:"Float32"}]),sB=xi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),oB=xi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function FC(o,e){const r=Vb(o.projection,o.zoom,o.width,o.height),l=(function(m,_,v,A,R){const P=new G(v.lng-180*Hm,v.lat),L=new G(v.lng+180*Hm,v.lat),N=m.project(P.lng,P.lat),U=m.project(L.lng,L.lat),$=-Math.atan2(U.y-N.y,U.x-N.x),X=Xe.fromLngLat(v);X.y=se(X.y,-1+Hm,1-Hm);const Q=X.toLngLat(),te=m.project(Q.lng,Q.lat),ce=Xe.fromLngLat(Q);ce.x+=Hm;const he=ce.toLngLat(),me=m.project(he.lng,he.lat),Ie=VC(me.x-te.x,me.y-te.y,$),Ee=Xe.fromLngLat(Q);Ee.y+=Hm;const Ne=Ee.toLngLat(),Be=m.project(Ne.lng,Ne.lat),Ue=VC(Be.x-te.x,Be.y-te.y,$),ft=Math.abs(Ie.x)/Math.abs(Ue.y),Qe=le([]);Le(Qe,Qe,-$*(1-(R?0:A)));const mt=le([]);return Re(mt,mt,[1,1-(1-ft)*A,1]),mt[4]=-Ue.x/Ue.y*A,Le(mt,mt,$),pe(mt,Qe,mt),mt})(o.projection,0,o.center,r,e),h=BC(o);return Re(l,l,[h,h,1]),l}function BC(o){const e=o.projection,r=Vb(o.projection,o.zoom,o.width,o.height),l=US(e,o.center),h=US(e,G.convert(e.center));return Math.pow(2,l*r+(1-r)*h)}function Vb(o,e,r,l,h=1/0){const m=o.range;if(!m)return 0;const _=Math.min(h,Math.max(r,l)),v=Math.log2(_/1024);return ve(m[0]+v,m[1]+v,e)}const Hm=1/4e4;function US(o,e){const r=se(e.lat,-be,be),l=new G(e.lng-180*Hm,r),h=new G(e.lng+180*Hm,r),m=o.project(l.lng,r),_=o.project(h.lng,r),v=Xe.fromLngLat(l),A=Xe.fromLngLat(h),R=_.x-m.x,P=_.y-m.y,L=A.x-v.x,N=A.y-v.y,U=Math.sqrt((L*L+N*N)/(R*R+P*P));return Math.log2(U)}function VC(o,e,r){const l=Math.cos(r),h=Math.sin(r);return{x:o*l-e*h,y:o*h+e*l}}function UC(o,e,r){le(o),Le(o,o,fi(e[2])),xe(o,o,fi(e[0])),Ze(o,o,fi(e[1])),Re(o,o,r),pe(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ub(o,e,r,l,h,m,_,v){const A=[r[0]-e[0],r[1]-e[1],0],R=[l[0]-e[0],l[1]-e[1],0];if(on(A)<1e-12||on(R)<1e-12)return ci(o);const P=gi([],A,R);An(P,P),kt(R,l,e),A[2]=(m-h)*v,R[2]=(_-h)*v;const L=A;return gi(L,A,R),An(L,L),ta(o,P,L)}function $b(o,e,r=!1){const l=wa(e.zoom),h=(function(m,_,v){const A=_.worldSize,R=[m[12],m[13],m[14]],P=fe(R[1]/A),L=ye(R[0]/A),N=le([]),U=ue(1,P)*A,$=ue(1,0)*A*Te(P,_.zoom),X=1/Am(A);let Q=$*X;if(v){const me=Vb(_.projection,_.zoom,_.width,_.height,1024);Q=X*_.projection.pixelSpaceConversion(_.center.lat,A,me)}const te=D(P,L);Fe(te,te,vt([],An([],te),U*Q*R[2]));const ce=(function(me){const Ie=[me[0],me[1],me[2]];let Ee=[0,1,0];const Ne=gi([],Ee,Ie);return gi(Ee,Ie,Ne),Yt(Ee)===0&&(Ee=[0,1,0],gi(Ne,Ie,Ee)),An(Ne,Ne),An(Ee,Ee),An(Ie,Ie),[Ne[0],Ne[1],Ne[2],0,Ee[0],Ee[1],Ee[2],0,Ie[0],Ie[1],Ie[2],0,me[0],me[1],me[2],1]})(te);Re(N,N,[Q,Q,Q*U]),_e(N,N,[-R[0],-R[1],-R[2]]);const he=pe([],_.globeMatrix,ce);return pe(he,he,N),pe(he,he,m),he})(o,e,r);if(l>0){const m=(function(_,v){const A=v.worldSize,R=ue(1,0)*A*Te(v.center.lat,v.zoom)/Am(A),P=ue(1,v.center.lat)*A,L=le([]);Ze(L,L,fi(v.center.lng)),xe(L,L,fi(v.center.lat)),_e(L,L,[0,0,Hr]),Re(L,L,[R,R,R*P]);const N=v.point;return _e(L,L,[-N.x,-N.y,0]),pe(L,L,_),pe(L,v.globeMatrix,L)})(o,e);return(function(_,v,A){const R=($,X,Q)=>{const te=on($),ce=on(X),he=Ur($,X,Q);return vt(he,he,1/on(he)*Gn(te,ce,Q))},P=R([_[0],_[1],_[2]],[v[0],v[1],v[2]],A),L=R([_[4],_[5],_[6]],[v[4],v[5],v[6]],A),N=R([_[8],_[9],_[10]],[v[8],v[9],v[10]],A),U=Ur([_[12],_[13],_[14]],[v[12],v[13],v[14]],A);return[P[0],P[1],P[2],0,L[0],L[1],L[2],0,N[0],N[1],N[2],0,U[0],U[1],U[2],1]})(h,m,l)}return h}function $S(o,e,r,l){const h=di.projectAabbCorners(l,r);let m=Number.MAX_VALUE;for(let v=0;v<h.length;++v){const A=h[v];A[0]=(.5*A[0]+.5)*e.width,A[1]=(.5-.5*A[1])*e.height,A[2]<m&&(m=A[2])}const _=(function(v){const A=[];let R=0;for(let U=1;U<v.length;U++)(v[U][0]<v[R][0]||v[U][0]===v[R][0]&&v[U][1]<v[R][1])&&(R=U);let P,L=R;const N=new Uint8Array(v.length);do{if(N[L])break;A.push(new Ct(v[L][0],v[L][1])),N[L]=1,P=(L+1)%v.length;for(let U=0;U<v.length;U++){if(v[U][0]===v[P][0]&&v[U][1]===v[P][1]||v[U][0]===v[L][0]&&v[U][1]===v[L][1])continue;const $=[v[U][0]-v[L][0],v[U][1]-v[L][1]],X=[v[P][0]-v[L][0],v[P][1]-v[L][1]],Q=$[0]*X[1]-$[1]*X[0];(Q>0||Q===0&&$[0]*X[0]+$[1]*X[1]>=0&&$[0]*$[0]+$[1]*$[1]>X[0]*X[0]+X[1]*X[1])&&(P=U)}L=P}while(L!==R);return A.length>0&&A.push(A[0]),A})(h);if(Dr(o,_))return m}const g_=64,ky={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Gb(o,e,r,l,h,m,_,v,A,R=!1){const P=r.zoom,L=r.project(l),N=Te(l.lat,P),U=1/N;le(o),_e(o,o,[L.x+_[0]*U,L.y+_[1]*U,_[2]]);let $=1,X=1;const Q=r.worldSize;if(R){if(r.projection.name==="mercator"){let me=0;r.elevation&&(me=r.elevation.getAtPointOrZero(new Xe(L.x/Q,L.y/Q),0));const Ie=yn([],[L.x,L.y,me,1],r.projMatrix)[3]/r.cameraToCenterDistance;$=Ie,X=Ie*Te(r.center.lat,P)}else if(r.projection.name==="globe"){const me=$b(o,r),Ie=[0,0,0,1];yn(Ie,Ie,pe([],r.projMatrix,me));const Ee=Ie[3]/r.cameraToCenterDistance,Ne=wa(P),Be=r.projection.pixelsPerMeter(l.lat,Q)*Te(l.lat,P),Ue=r.projection.pixelsPerMeter(r.center.lat,Q)*Te(r.center.lat,P);$=Ee/Gn(Be,De(r.center.lat),Ne),X=Ee*N/Be,$*=Ue,X*=Ue}}else $=U;Re(o,o,[$,$,X]);const te=[...o],ce=e.orientation,he=[];if(UC(he,[ce[0]+(h?h[0]:0),ce[1]+(h?h[1]:0),ce[2]+(h?h[2]:0)],m),pe(o,te,he),v&&r.elevation){let me=0;const Ie=[];if(A&&r.elevation){me=(function(Ne,Be,Ue,ft,Qe){const mt=Be.elevation;if(!mt)return 0;const wt=di.projectAabbCorners(Ue,ft),Dt=ue(1,Qe.lat)*Be.worldSize,Xt=(function(hn,an){const Qn=[0,0,1],dn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const kn of dn){const ei=hn[kn.corners[0]],yi=hn[kn.corners[1]],$i=hn[kn.corners[2]],ri=[yi[0]-ei[0],yi[1]-ei[1],an*(yi[2]-ei[2])],Qi=gi(ri,ri,[$i[0]-ei[0],$i[1]-ei[1],an*($i[2]-ei[2])]);An(Qi,Qi),kn.dotProductWithUp=In(Qi,Qn)}return dn.sort(((kn,ei)=>kn.dotProductWithUp-ei.dotProductWithUp)),dn[0].corners})(wt,Dt),Nt=wt[Xt[0]],Tt=wt[Xt[1]],Lt=wt[Xt[2]],ht=wt[Xt[3]],lt=mt.getAtPointOrZero(new Xe(Nt[0]/Be.worldSize,Nt[1]/Be.worldSize),0),zt=mt.getAtPointOrZero(new Xe(Tt[0]/Be.worldSize,Tt[1]/Be.worldSize),0),Zt=mt.getAtPointOrZero(new Xe(Lt[0]/Be.worldSize,Lt[1]/Be.worldSize),0),At=mt.getAtPointOrZero(new Xe(ht[0]/Be.worldSize,ht[1]/Be.worldSize),0),gn=(lt+At)/2,bn=(zt+Zt)/2;return gn>bn?zt<Zt?Ub(Ne,Tt,ht,Nt,zt,At,lt,Dt):Ub(Ne,Lt,Nt,ht,Zt,lt,At,Dt):lt<At?Ub(Ne,Nt,Tt,Lt,lt,zt,Zt,Dt):Ub(Ne,ht,Lt,Tt,At,Zt,zt,Dt),Math.max(gn,bn)})(Ie,r,e.aabb,o,l);const Ee=pe([],Ut([],Ie),he);pe(o,te,Ee)}else me=r.elevation.getAtPointOrZero(new Xe(L.x/Q,L.y/Q),0);me!==0&&(o[14]+=me)}}class $C{constructor(e,r,l,h,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=r,this.position=l!=null?new G(l[0],l[1]):new G(0,0),this.orientation=h??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,r){pe(e.globalMatrix,r,e.localMatrix);const l=this.nodeOverrides.get(e.name);if(l!==void 0){const _=[];m=l.orientation,le(h=_),Ze(h,h,fi(m[1])),Le(h,h,fi(m[2])),xe(h,h,fi(m[0])),pe(e.globalMatrix,e.globalMatrix,_)}var h,m;if(e.meshes)for(const _ of e.meshes){const v=di.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=le([]);this.aabb=new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.nodes)this._applyTransformations(r,e)}computeModelMatrix(e,r,l,h,m,_,v=!1){Gb(this.matrix,this,e.transform,this.position,r,l,h,m,_,v)}upload(e){if(!this.uploaded){for(const r of this.nodes)GS(r,e);for(const r of this.nodes)Hb(r);this.uploaded=!0}}destroy(){for(const e of this.nodes)HS(e)}}function Dv(o,e,r=!1){o.uploaded||(o.gfxTexture=new VS(e,o.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function aB(o,e,r){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,eB.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,rB.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,iB.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?tB:nB).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,oB.members,!0)),o.segments=Br.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const l=o.material;l.pbrMetallicRoughness.baseColorTexture&&Dv(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&Dv(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&Dv(l.normalTexture,e),l.occlusionTexture&&Dv(l.occlusionTexture,e,r),l.emissionTexture&&Dv(l.emissionTexture,e)}function GS(o,e,r){if(o.meshes)for(const l of o.meshes)aB(l,e,r);if(o.children)for(const l of o.children)GS(l,e,r)}function Hb(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)Hb(e)}function HS(o){if(o.meshes)for(const r of o.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const r of o.children)HS(r)}function __(o,e){const r=o.json.bufferViews[e.bufferView],l=hr[e.componentType];return new l(o.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Zr[e.type]*l.BYTES_PER_ELEMENT?r.byteStride/l.BYTES_PER_ELEMENT:Zr[e.type]))}function qS(o,e,r,l){const h=hr[e.componentType],m=(function(P){switch(P){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),_=o.json.bufferViews[e.bufferView],v=_.byteStride?_.byteStride/h.BYTES_PER_ELEMENT:Zr[e.type],A=r.float32,R=A.length/r.capacity;for(let P=0,L=0;P<e.count*v;P+=v,L+=R)for(let N=0;N<R;N++)A[L+N]=l[P+N]*m;r._trim()}function lB(o,e,r){const l=o.indices,h=o.attributes,m={};m.indexArray=new kr;const _=e.json.accessors[l],v=_.count/3;m.indexArray.reserve(v);const A=__(e,_);for(let N=0;N<v;N++)m.indexArray.emplaceBack(A[3*N],A[3*N+1],A[3*N+2]);m.indexArray._trim(),m.vertexArray=new il;const R=e.json.accessors[h.POSITION];m.vertexArray.reserve(R.count);const P=__(e,R);for(let N=0;N<R.count;N++)m.vertexArray.emplaceBack(P[3*N],P[3*N+1],P[3*N+2]);if(m.vertexArray._trim(),m.aabb=new di(R.min,R.max),m.centroid=(function(N,U){const $=[0,0,0],X=N.length;if(X>0){for(let Q=0;Q<X;Q++){const te=3*N[Q];$[0]+=U[te],$[1]+=U[te+1],$[2]+=U[te+2]}$[0]/=X,$[1]/=X,$[2]/=X}return $})(A,P),h.COLOR_0!==void 0){const N=e.json.accessors[h.COLOR_0],U=Zr[N.type],$=__(e,N);m.colorArray=U===3?new il:new nu,m.colorArray.resize(N.count),qS(e,N,m.colorArray,$)}if(h.NORMAL!==void 0){m.normalArray=new il;const N=e.json.accessors[h.NORMAL];m.normalArray.resize(N.count);const U=__(e,N);qS(e,N,m.normalArray,U)}if(h.TEXCOORD_0!==void 0&&r.length>0){m.texcoordArray=new Cc;const N=e.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(N.count);const U=__(e,N);qS(e,N,m.texcoordArray,U)}if(h._FEATURE_ID_RGBA4444!==void 0){const N=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=__(e,N))}h._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(__(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const L=o.material;return m.material=(function(N,U){const{emissiveFactor:$=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:Q=.5,normalTexture:te,occlusionTexture:ce,emissiveTexture:he,doubleSided:me,name:Ie}=N,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:Ne=1,roughnessFactor:Be=1,baseColorTexture:Ue,metallicRoughnessTexture:ft}=N.pbrMetallicRoughness||{},Qe=ce?U[ce.index]:void 0;if(ce&&ce.extensions&&ce.extensions.KHR_texture_transform&&Qe){const mt=ce.extensions.KHR_texture_transform;Qe.offsetScale=[mt.offset[0],mt.offset[1],mt.scale[0],mt.scale[1]]}return{name:Ie,pbrMetallicRoughness:{baseColorFactor:new nr(...Ee),metallicFactor:Ne,roughnessFactor:Be,baseColorTexture:Ue?U[Ue.index]:void 0,metallicRoughnessTexture:ft?U[ft.index]:void 0},doubleSided:me,emissiveFactor:new nr(...$),alphaMode:X,alphaCutoff:Q,normalTexture:te?U[te.index]:void 0,occlusionTexture:Qe,emissionTexture:he?U[he.index]:void 0,defined:N.defined===void 0}})(L!==void 0?e.json.materials[L]:{defined:!1},r),m}function GC(o,e,r){const{matrix:l,rotation:h,translation:m,scale:_,mesh:v,extras:A,children:R,name:P}=o,L={};if(L.name=P,L.localMatrix=l||(function(N,U,$,X){var Q=U[0],te=U[1],ce=U[2],he=U[3],me=Q+Q,Ie=te+te,Ee=ce+ce,Ne=Q*me,Be=Q*Ie,Ue=Q*Ee,ft=te*Ie,Qe=te*Ee,mt=ce*Ee,wt=he*me,Dt=he*Ie,Xt=he*Ee,Nt=X[0],Tt=X[1],Lt=X[2];return N[0]=(1-(ft+mt))*Nt,N[1]=(Be+Xt)*Nt,N[2]=(Ue-Dt)*Nt,N[3]=0,N[4]=(Be-Xt)*Tt,N[5]=(1-(Ne+mt))*Tt,N[6]=(Qe+wt)*Tt,N[7]=0,N[8]=(Ue+Dt)*Lt,N[9]=(Qe-wt)*Lt,N[10]=(1-(Ne+ft))*Lt,N[11]=0,N[12]=$[0],N[13]=$[1],N[14]=$[2],N[15]=1,N})([],h||[0,0,0,1],m||[0,0,0],_||[1,1,1]),L.globalMatrix=ee(L.localMatrix),v!==void 0){L.meshes=r[v];const N=L.anchor=[0,0];for(const U of L.meshes){const{min:$,max:X}=U.aabb;N[0]+=$[0]+X[0],N[1]+=$[1]+X[1]}N[0]=Math.floor(N[0]/L.meshes.length/2),N[1]=Math.floor(N[1]/L.meshes.length/2)}if(A&&(A.id&&(L.id=A.id),A.lights&&(L.lights=(function(N){if(!N.length)return[];const U=(function(ce){const he=atob(ce),me=new Uint8Array(he.length);for(let Ie=0;Ie<he.length;Ie++)me[Ie]=he.codePointAt(Ie);return me})(N),$=[],X=U.length/24,Q=new Uint16Array(U.buffer),te=new Float32Array(U.buffer);for(let ce=0;ce<X;ce++){const he=Q[2*ce*6]/30,me=Q[2*ce*6+1]/30,Ie=Q[2*ce*6+10]/100,Ee=te[6*ce+1],Ne=te[6*ce+2],Be=te[6*ce+3],Ue=te[6*ce+4],ft=Be-Ee,Qe=Ue-Ne,mt=Math.hypot(ft,Qe);$.push({pos:[Ee+.5*ft,Ne+.5*Qe,me],normal:[Qe/mt,-ft/mt,0],width:mt,height:he,depth:Ie,points:[Ee,Ne,Be,Ue]})}return $})(A.lights)),A.MAPBOX_geometry_bloom&&(L.isGeometryBloom=A.MAPBOX_geometry_bloom)),R){const N=[];for(const U of R)N.push(GC(e.json.nodes[U],e,r));L.children=N}return L}function cB(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new My(o.vertices,o.indices,8,256),[r,l]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:r,max:l}}function uB(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const l=[];for(const _ of r){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],A=_[1];typeof v=="number"&&typeof A=="number"&&l.push(new Ct(v,A))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let h=0;for(let _=0;_<l.length;_++){const v=l[_],A=l[(_+1)%l.length],R=l[(_+2)%l.length];h+=(v.x-A.x)*(R.y-A.y)-(R.x-A.x)*(v.y-A.y)}h>0&&l.reverse();const m=Mm(l.flatMap((_=>[_.x,_.y])),[]);return m.length===0?null:{vertices:l,indices:m}}function dB(o,e){const r=[],l=[];let h=0;const m=[];for(const _ of o){h=r.length;const v=_.vertexArray.float32,A=_.indexArray.uint16;for(let R=0;R<_.vertexArray.length;R++)m[0]=v[3*R+0],m[1]=v[3*R+1],m[2]=v[3*R+2],Ri(m,m,e),r.push(new Ct(m[0],m[1]));for(let R=0;R<3*_.indexArray.length;R++)l.push(A[R]+h)}if(l.length%3!=0)return null;for(let _=0;_<l.length;_+=3){const v=r[l[_+0]],A=r[l[_+1]],R=r[l[_+2]];(v.x-A.x)*(R.y-A.y)-(R.x-A.x)*(v.y-A.y)>0&&([l[_+1],l[_+2]]=[l[_+2],l[_+1]])}return{vertices:r,indices:l}}function ZS(o){const e=(function(A,R){const P=[],L=WebGL2RenderingContext;if(A.json.textures)for(const N of A.json.textures){const U={magFilter:L.LINEAR,minFilter:L.NEAREST,wrapS:L.REPEAT,wrapT:L.REPEAT};N.sampler!==void 0&&Object.assign(U,A.json.samplers[N.sampler]),P.push({image:R[N.source],sampler:U,uploaded:!1})}return P})(o,o.images),r=(function(A,R){const P=[];for(const L of A.json.meshes){const N=[];for(const U of L.primitives)N.push(lB(U,A,R));P.push(N)}return P})(o,e),{scenes:l,scene:h,nodes:m}=o.json,_=l?l[h||0].nodes:[...m.keys()],v=[];for(const A of _)v.push(GC(m[A],o,r));return(function(A,R,P){const L={},N=new Set;for(let U=0;U<A.length;U++){const $=P[R[U]];if(!$.extras)continue;const X=$.extras["mapbox:footprint:version"],Q=$.extras["mapbox:footprint:id"];(X||Q)&&N.add(U),X==="1.0.0"&&Q&&(L[Q]=U)}for(let U=0;U<A.length;U++){if(N.has(U))continue;const $=A[U],X=P[R[U]];if(!X.extras)continue;let Q=null;$.id in L&&(Q=dB(A[L[$.id]].meshes,$.localMatrix)),Q||(Q=uB(X)),Q&&($.footprint=cB(Q))}if(N.size>0){const U=Array.from(N.values()).sort((($,X)=>$-X));for(let $=U.length-1;$>=0;$--)A.splice(U[$],1)}})(v,_,o.json.nodes),v}function hB(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,r=o.aabb.min[0]-1,l=o.aabb.min[1]-1,h=g_/(o.aabb.max[0]-r+2),m=g_/(o.aabb.max[1]-l+2);for(let _=0;_<e.length;_+=3){const v=e[_+2],A=(e[_+0]-r)*h|0,R=(e[_+1]-l)*m|0;v>o.heightmap[R*g_+A]&&(o.heightmap[R*g_+A]=v)}}function HC(o,e,r,l,h){r.reserve(r.length+4*o.length),l.reserve(l.length+10*o.length),h.reserve(h.length+10*o.length);let m=l.length;for(const _ of o){const v=Math.min(10,Math.max(4,1.3*_.height))*e,A=[-_.normal[1],_.normal[0],0],R=Math.min(.29,.1*_.width/_.depth),P=_.width-2*_.depth*e*(R+.01),L=Kt([],_.pos,A,P/2),N=Kt([],_.pos,A,-P/2),U=[L[0],L[1],L[2]+_.height],$=[N[0],N[1],N[2]+_.height],X=Kt([],_.normal,A,R);vt(X,X,v);const Q=Kt([],_.normal,A,-R);vt(Q,Q,v),Fe(X,L,X),Fe(Q,N,Q),L[2]+=.1,N[2]+=.1,l.emplaceBack(X[0],X[1],X[2]),l.emplaceBack(Q[0],Q[1],Q[2]),l.emplaceBack(L[0],L[1],L[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(U[0],U[1],U[2]),l.emplaceBack($[0],$[1],$[2]),l.emplaceBack(L[0],L[1],L[2]),l.emplaceBack(N[0],N[1],N[2]),l.emplaceBack(X[0],X[1],X[2]),l.emplaceBack(Q[0],Q[1],Q[2]);const te=P/v/2;h.emplaceBack(-te-R,-1,te,.8),h.emplaceBack(te+R,-1,te,.8),h.emplaceBack(-te,0,te,1.3),h.emplaceBack(te,0,te,1.3),h.emplaceBack(te+R,-.8,te,.7),h.emplaceBack(te+R,-.8,te,.7),h.emplaceBack(0,0,te,1.3),h.emplaceBack(0,0,te,1.3),h.emplaceBack(te+R,-1.2,te,.8),h.emplaceBack(te+R,-1.2,te,.8),r.emplaceBack(6+m,4+m,8+m),r.emplaceBack(7+m,9+m,5+m),r.emplaceBack(0+m,1+m,2+m),r.emplaceBack(1+m,3+m,2+m),m+=10}}function fB(o,e){const r={};r.indexArray=new kr,r.vertexArray=new il,r.colorArray=new nu,HC(o,e,r.indexArray,r.vertexArray,r.colorArray);const l={defined:!0};l.emissiveFactor=nr.black;const h={};return h.baseColorFactor=nr.white,l.pbrMetallicRoughness=h,r.material=l,r.aabb=new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const qC=xi([{name:"a_pos_3f",components:3,type:"Float32"}]),pB=xi([{name:"a_normal_3",components:3,type:"Int16"}]),mB=xi([{name:"a_centroid_3",components:3,type:"Int16"}]),ZC=xi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),gB=xi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),_B=xi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),yB=xi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),xB=xi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),vB=xi([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),WC=Pt.types,qb=32767;function bB(o,e){const r=qt+e;for(const l of o)for(const h of l)if(h.x<-e||h.x>r||h.y<-e||h.y>r)return!1;return!0}class XC{constructor(){this.layoutVertexArray=new il,this.layoutAttenuationArray=new nu,this.layoutColorArray=new rl,this.indexArray=new kr,this.indexArrayForConflation=new kr,this.segmentsBucket=new Br}}class WS{constructor(){this.layoutVertexArray=new il,this.layoutNormalArray=new eu,this.layoutCentroidArray=new eu,this.layoutColorArray=new rl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new gp,this.layoutAOArray=new Ac,this.indexArray=new kr,this.indexArrayForConflation=new kr,this.segmentsBucket=new Br,this.entranceBloom=new XC}}class KC{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new WS,this.buildingWithFacade=new WS,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new rl,this.buildingWithFacade.layoutFacadeDataArray=new Gl,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new rl,this.programConfigurations=new Tl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.projection=e.projection,this.groundEffect=new d_(e),this.groundEffect.groundRadiusArray=new Ac,this.hasAppearances=null}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}updateAppearances(e,r,l,h){}prepare(){return(function(){if(_n!=null||Ht!=null)return null;if(pt!=null)return pt;const e=fetch(Ir.BUILDING_GEN_URL);return pt=(function(r){let l,h,m,_;function v(){l=new Uint8Array(_.buffer),h=new Int32Array(_.buffer),m=new Float32Array(_.buffer)}function A(){throw new Error("Unexpected BuildingGen error.")}const R=()=>{},P={a:{a:A,f:function(L){const N=l.length,U=Math.max(L>>>0,Math.ceil(1.2*N)),$=Math.ceil((U-N)/65536);try{return _.grow($),v(),!0}catch{return!1}},g:A,b:R,c:R,d:R,e:R}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,P):r.then((L=>L.arrayBuffer())).then((L=>WebAssembly.instantiate(L,P)))).then((L=>{const N=L.instance.exports;return(0,N.g)(),_=N.f,v(),new xn({setStyle:N.h,setAOOptions:N.i,setMetricOptions:N.j,setStructuralOptions:N.k,setFacadeOptions:N.l,setFauxFacadeOptions:N.m,setFacadeClassifierOptions:N.n,addFeature:N.o,addFacade:N.p,generateMesh:N.q,getLastError:N.r,getOuterRingLength:N.s,getMeshCount:N.t,getPositionsPtr:N.u,getPositionsLength:N.v,getNormalsPtr:N.w,getNormalsLength:N.x,getColorsPtr:N.y,getColorsLength:N.z,getAOPtr:N.A,getAOLength:N.B,getUVPtr:N.C,getUVLength:N.D,getFauxFacadePtr:N.E,getFauxFacadeLength:N.F,getIndicesPtr:N.G,getIndicesLength:N.H,getBuildingPart:N.I,getRingCount:N.J,getRingPtr:N.K,getRingLength:N.L,free:N.M,malloc:N.N,heapU8:l,heap32:h,heapF32:m})}))})(e).then((r=>(pt=null,_n=r,_n))).catch((r=>{Tn("Could not load building-gen"),pt=null,Ht=r})),pt})()}populate(e,r,l,h){const m=Ti();if(!m)return;const _=Pe(l);this.tileToMeter=_,this.brightness=r.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const v=new Map,A=new Map;for(const{feature:R}of e){if(WC[R.type]!=="LineString"){v.set(R.id,R.properties.source_id);continue}const P=this.layers[0]._featureFilter.needGeometry,L=rt(R,P);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),L,l))continue;const N=P?L.geometry:_t(R,l,h),U=[];for(const te of N)for(const ce of te)U.push({x:ce.x,y:ce.y});const $={coordinates:U,crossPerc:R.properties.cross_perc,distanceToRoad:R.properties.distance_to_road,entrances:R.properties.entrances,sourceId:0},X=R.properties.source_id;let Q=A.get(X);Q||(Q=[],A.set(X,Q)),Q.push($)}this.maxHeight=0;for(const{feature:R,id:P,index:L,sourceLayerIndex:N}of e){if(WC[R.type]==="LineString")continue;const U=this.layers[0]._featureFilter.needGeometry,$=rt(R,U);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),$,l))continue;const X=U?$.geometry:_t(R,l,h),Q=Sp(X,500);if(!bB(X,163))continue;const te=this.layers[0],ce=te.layout.get("building-roof-shape").evaluate(R,{},l);if(ce==="flat")continue;const he=te.layout.get("building-base").evaluate(R,{},l),me=te.layout.get("building-height").evaluate(R,{},l),Ie=te.layout.get("building-flood-light-ground-radius").evaluate(R,{},l),Ee=te.paint.get("building-ambient-occlusion-intensity"),Ne=Ie/this.tileToMeter;let Be=te.layout.get("building-flood-light-wall-radius").evaluate(R,{},l);Be=se(Be,0,2048);const Ue=Be/2048*qb,ft=v.get(P);let Qe;Qe=A.has(ft)?A.get(ft):[];const mt=Qe.length!==0&&te.layout.get("building-facade").evaluate(R,{},l);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(mt,!1,1);let wt=0,Dt=0,Xt=0,Nt=0,Tt=0,Lt=0;if(mt){let xt=Math.round(te.layout.get("building-facade-floors").evaluate(R,{},l));if(he===0){xt=Math.max(1,xt-(Qe.length>0?1:0));let Rn=4;if(me>100){const Cn=[10,13,15];Rn=Cn[R.id?R.id%Cn.length:0],m.setFacadeOptions(Rn,!0)}Tt=1.6803*Rn/_}else Tt=he/_;Lt=me/_,Tt=Math.min(Tt,Lt),Xt=te.layout.get("building-facade-unit-width").evaluate(R,{},l)/_,Nt=(Lt-Tt)/xt,m.setFauxFacadeOptions(!0,!0,Xt);const ln=te.layout.get("building-facade-window").evaluate(R,{},l);wt=ln[0],Dt=ln[1]}const ht=[],lt=new Ct(1/0,1/0),zt=new Ct(-1/0,-1/0),Zt=new Ct(0,0);let At=0;for(const xt of Q)if(xt.length>0){const ln=[];for(const Rn of xt){const Cn=[];for(let oi=Rn.length-1;oi>=0;oi--){const qn=Rn[oi];Cn.push({x:qn.x,y:qn.y}),lt.x=Math.min(lt.x,qn.x),lt.y=Math.min(lt.y,qn.y),zt.x=Math.max(zt.x,qn.x),zt.y=Math.max(zt.y,qn.y),Zt.x+=qn.x,Zt.y+=qn.y,At++}ln.push(Cn)}ht.push({id:R.id?R.id:0,height:me,minHeight:he,sourceId:0,roofType:ce,coordinates:ln})}Zt.x/=At||1,Zt.y/=At||1;const gn=m.generateMesh(ht,Qe);if(typeof gn=="string"){Tn(`Unable to generate building ${R.id}: ${gn}`);continue}if(gn.meshes.length===0||gn.modifiedPolygonRings.length===0)continue;let bn=0;for(const xt of gn.meshes)bn+=xt.positions.length/3;const hn=mt?this.buildingWithFacade:this.buildingWithoutFacade,an=hn.segmentsBucket.prepareSegment(bn,hn.layoutVertexArray,hn.indexArray),Qn=[];let dn=null,kn=0,ei=-1;const yi=hn.layoutVertexArray.length,$i=hn.indexArray.length;let ri=0;for(const xt of gn.meshes){const ln=hn.layoutVertexArray.length;if(xt.buildingPart==="entrance"){const Sn=new Array;for(let ki=0;ki<xt.positions.length;ki+=12){const yr=xt.positions[ki+0],lr=xt.positions[ki+1],ms=xt.positions[ki+3],Wr=xt.positions[ki+4],Pr=xt.positions[ki+2],fr=xt.positions[ki+8]-Pr,er=1,ai=ms-yr,tr=Wr-lr,Or=Math.hypot(ai,tr);Sn.push({pos:[yr+.5*ai,lr+.5*tr,Pr],normal:[tr/Or,-ai/Or,0],width:Or,height:fr,depth:er,points:[yr,lr,ms,Wr]})}const Ki=hn.entranceBloom.segmentsBucket.prepareSegment(10*Sn.length,hn.entranceBloom.layoutVertexArray,hn.entranceBloom.indexArray),_r=hn.entranceBloom.layoutVertexArray.length;kn=hn.entranceBloom.indexArray.length,HC(Sn,.5/this.tileToMeter,hn.entranceBloom.indexArray,hn.entranceBloom.layoutVertexArray,hn.entranceBloom.layoutAttenuationArray);const Wn=hn.entranceBloom.layoutVertexArray.length-_r;ei=hn.entranceBloom.indexArray.length-kn;for(let ki=0;ki<Wn;ki++)hn.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Ki.vertexLength+=Wn,Ki.primitiveLength+=ei,dn={part:xt.buildingPart,vertexOffset:_r,vertexLength:Wn}}for(let Sn=0;Sn<xt.positions.length;Sn+=3)ri=Math.max(ri,xt.positions[Sn+2]),hn.layoutVertexArray.emplaceBack(xt.positions[Sn],xt.positions[Sn+1],xt.positions[Sn+2]);const Rn=Math.floor(Zt.x),Cn=Math.floor(Zt.y),oi=Math.floor(ri);for(let Sn=0;Sn<xt.positions.length;Sn+=3)hn.layoutCentroidArray.emplaceBack(Rn,Cn,oi),hn.layoutFloodLightDataArray.emplaceBack(xt.buildingPart==="wall"?Ue:0);for(let Sn=0;Sn<xt.normals.length;Sn+=3)hn.layoutNormalArray.emplaceBack(xt.normals[Sn+0]*qb,xt.normals[Sn+1]*qb,xt.normals[Sn+2]*qb);for(let Sn=0;Sn<xt.ao.length;Sn++)hn.layoutAOArray.emplaceBack(xt.ao[Sn]);for(let Sn=0;Sn<xt.colors.length;Sn+=3){const Ki=1+(xt.ao[Sn/3]-1)*Ee;hn.layoutColorArray.emplaceBack(xt.colors[Sn]*Ki<<8|xt.colors[Sn+1]*Ki,xt.colors[Sn+2]*Ki<<8)}if(mt){for(let Sn=0;Sn<xt.positions.length;Sn+=3)hn.layoutFacadePaintArray.emplaceBack(65535,255);for(let Sn=0;Sn<xt.isFauxFacade.length;Sn++)if(xt.isFauxFacade[Sn]){const Ki=1|Math.min(65535,Math.floor(xt.uv[2*Sn]*gn.outerRingLength)),_r=Math.floor(255*wt)<<8|Math.floor(255*Dt),Wn=Math.floor(65535*Math.min(1,Xt/qt)),ki=Math.floor(65535*Math.min(1,Nt/qt));hn.layoutFacadeDataArray.emplaceBack(Ki,_r,Wn,ki);const yr=Math.floor(65535*Math.min(1,Tt/qt)),lr=Math.floor(65535*Math.min(1,Lt/qt));hn.layoutFacadeVerticalRangeArray.emplaceBack(yr,lr)}else hn.layoutFacadeDataArray.emplaceBack(0,0,0,0),hn.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const qn=an.vertexLength;for(let Sn=0;Sn<xt.indices.length;Sn+=3)hn.indexArray.emplaceBack(qn+xt.indices[Sn],qn+xt.indices[Sn+1],qn+xt.indices[Sn+2]);an.vertexLength+=xt.positions.length/3,an.primitiveLength+=xt.indices.length/3,(xt.buildingPart==="roof"||xt.buildingPart==="wall"||xt.buildingPart==="facade_glazing"||xt.buildingPart==="entrance")&&Qn.push({part:xt.buildingPart,vertexOffset:ln,vertexLength:xt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,ri),this.buildingFeatures.push({promoteId:P,feature:$,hasFauxFacade:mt,segment:an,parts:Qn,buildingBloom:dn});const Qi=hn.indexArray.length-$i,Ji=[],rs=[],Ae=new Ct(1/0,1/0),we=new Ct(-1/0,-1/0),yt=this.groundEffect.vertexArray.length;for(const xt of gn.modifiedPolygonRings){const ln=[],Rn=new Ct(1/0,1/0),Cn=new Ct(-1/0,-1/0);for(let oi=0;oi<xt.length;oi+=2){const qn=xt.length-oi-2;Rn.x=Math.min(Rn.x,xt[qn]),Rn.y=Math.min(Rn.y,xt[qn+1]),Cn.x=Math.max(Cn.x,xt[qn]),Cn.y=Math.max(Cn.y,xt[qn+1]);const Sn=new Ct(xt[qn],xt[qn+1]);ln.push(Sn),Ji.push(Sn.x,Sn.y),rs.push(Sn.clone())}Ae.x=Math.min(Ae.x,Rn.x),Ae.y=Math.min(Ae.y,Rn.y),we.x=Math.max(we.x,Cn.x),we.y=Math.max(we.y,Cn.y),this.groundEffect.addData(ln,[Rn,Cn],Ne)}const en=this.groundEffect.vertexArray.length-yt;for(let xt=0;xt<en;xt++)this.groundEffect.groundRadiusArray.emplaceBack(Ie);(lt.x<0||zt.x>qt||lt.y<0||zt.y>qt)&&this.featuresOnBorder.push({featureId:R.id,footprintIndex:this.footprints.length});{const xt=Mm(Ji,null,2),ln=new My(rs,xt,8,256);let Rn=R.id;R.properties&&R.properties.hasOwnProperty("building_id")&&(Rn=R.properties.building_id);const Cn={vertices:rs,indices:xt,grid:ln,min:Ae,max:we,buildingId:Rn,hiddenFlags:0,indicesOffset:$i,indicesLength:Qi,bloomIndicesOffset:kn,bloomIndicesLength:ei,groundEffectVertexOffset:yt,groundEffectVertexLength:en,hasFauxFacade:mt,segment:an,height:ri};R.id!==void 0&&this.featureFootprintLookup.set(R.id,this.footprints.length),this.footprints.push(Cn)}this.programConfigurations.populatePaintArrays(hn.layoutVertexArray.length,R,L,{},r.availableImages,l,r.brightness),this.groundEffect.addPaintPropertiesData(R,L,{},r.availableImages,l,r.brightness),r.featureIndex.insert(R,X,L,N,this.index,yi)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,r,l,h,m,_,v){this.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v),this.groundEffect.update(e,r,m,l,h,_,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const r=l=>{l.layoutVertexBuffer=e.createVertexBuffer(l.layoutVertexArray,qC.members),l.layoutNormalBuffer=e.createVertexBuffer(l.layoutNormalArray,pB.members),l.layoutCentroidBuffer=e.createVertexBuffer(l.layoutCentroidArray,mB.members),l.layoutFloodLightDataBuffer=e.createVertexBuffer(l.layoutFloodLightDataArray,vB.members),l.layoutFacadeDataArray&&l.layoutFacadeDataArray.length&&(l.layoutFacadeDataBuffer=e.createVertexBuffer(l.layoutFacadeDataArray,_B.members)),l.layoutFacadeVerticalRangeArray&&l.layoutFacadeVerticalRangeArray.length&&(l.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(l.layoutFacadeVerticalRangeArray,yB.members)),l.entranceBloom.layoutVertexArray.length&&(l.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(l.entranceBloom.layoutVertexArray,qC.members),l.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(l.entranceBloom.layoutAttenuationArray,xB.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=r=>{r.layoutVertexBuffer&&(r.layoutVertexBuffer.destroy(),r.layoutNormalBuffer.destroy(),r.layoutColorBuffer.destroy(),r.segmentsBucket.destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.entranceBloom.layoutVertexBuffer&&(r.entranceBloom.layoutVertexBuffer.destroy(),r.entranceBloom.layoutColorBuffer.destroy(),r.entranceBloom.layoutAttenuationBuffer.destroy(),r.entranceBloom.indexBuffer.destroy(),r.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,r,l=!0){let h=!1;const m=l?r:0,_=0|(l?-1:~r);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const A=this.footprints[v],R=A.hiddenFlags&_|m;A.hiddenFlags!==R&&(A.hiddenFlags=R,h=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const r=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};r(this.buildingWithoutFacade),r(this.buildingWithFacade);for(const h of this.footprints){const m=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let A=h.indicesOffset;A<_;A++)m.indexArrayForConflation.uint16[3*A+0]=0,m.indexArrayForConflation.uint16[3*A+1]=0,m.indexArrayForConflation.uint16[3*A+2]=0;const v=h.bloomIndicesOffset+h.bloomIndicesLength;for(let A=h.bloomIndicesOffset;A<v;A++)m.entranceBloom.indexArrayForConflation.uint16[3*A+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*A+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*A+2]=0}}const l=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=e.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=e.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const r=l=>{l.layoutColorBuffer?l.layoutColorBuffer.updateData(l.layoutColorArray):l.layoutColorBuffer=e.createVertexBuffer(l.layoutColorArray,ZC.members,!0),l.layoutFacadePaintArray&&(l.layoutFacadePaintBuffer?l.layoutFacadePaintBuffer.updateData(l.layoutFacadePaintArray):l.layoutFacadePaintBuffer=e.createVertexBuffer(l.layoutFacadePaintArray,gB.members,!0)),l.entranceBloom.layoutColorBuffer?l.entranceBloom.layoutColorBuffer.updateData(l.entranceBloom.layoutColorArray):l.entranceBloom.layoutColorBuffer=e.createVertexBuffer(l.entranceBloom.layoutColorArray,ZC.members,!0)};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,r){const l=e.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const m=r[h.promoteId],_=h.feature;_.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="wall";const R=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),P=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="window";const L=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),N=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="door";const U=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),$=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical),X=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const te of h.parts){let ce,he=v;te.part==="roof"?(he=v,ce=A):te.part==="wall"?(he=R,ce=P):te.part==="facade_glazing"?(he=L,ce=N):te.part==="entrance"&&(he=U,ce=$),ce=se(ce,0,1);for(let me=0;me<te.vertexLength;me++){const Ie=te.vertexOffset+me,Ee=1+(X.layoutAOArray.float32[Ie]-1)*l;X.layoutColorArray.emplace(Ie,he.r*Ee*255<<8|he.g*Ee*255,he.b*Ee*255<<8|255*ce),h.hasFauxFacade&&X.layoutFacadePaintArray.emplace(Ie,255*L.r<<8|255*L.g,255*L.b<<8|255*N)}}const Q=h.buildingBloom;if(Q)for(let te=0;te<Q.vertexLength;te++)X.entranceBloom.layoutColorArray.emplace(Q.vertexOffset+te,255*U.r<<8|255*U.g,255*U.b<<8|51*$)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const h=r.getReplacementRegionsForTile(e.toUnwrapped());if(o_(this.activeReplacements,h))return;this.activeReplacements=h;for(const _ of this.footprints)_.hiddenFlags&=-2;const m=[];for(const _ of this.activeReplacements){if(_.order<=xv)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const A of this.footprints)A.min.x>_.max.x||A.max.x<_.min.x||A.min.y>_.max.y||A.max.y<_.min.y||(m.length=0,wB(A.vertices,0,A.vertices.length,_.footprintTileId.canonical,e.canonical,m),Dy(_.footprint,m,A.indices,0,A.indices.length,0,-v)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const r=this.featureFootprintLookup.get(e.id);return this.footprints[r]}return null}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,h=!0;const m=4*(e+qt)*qt+(r+qt);if(this.footprintLookup.hasOwnProperty(m)){const v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new Ct(e,r);for(const v of this.footprints)e>v.max.x||v.min.x>e||r>v.max.y||v.min.y>r||v.height<=l||bv(_,v)&&(l=v.height,this.footprintLookup[m]=v,h=v.hiddenFlags!==0);if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.footprintLookup[m]=void 0}}function wB(o,e,r,l,h,m){const _=Math.pow(2,l.z-h.z);for(let v=0;v<r;v++){let A=o[v+e].x,R=o[v+e].y;A=(A+h.x*qt)*_-l.x*qt,R=(R+h.y*qt)*_-l.y*qt,m.push(new Ct(A,R))}}let YC,QC;jt(KC,"BuildingBucket",{omit:["layers"]}),jt(WS,"BuildingGeometry"),jt(XC,"BuildingBloomGeometry");const SB=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),TB=xi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:EB}=SB,AB=xi([{name:"a_packed",components:3,type:"Float32"}]),{members:CB}=AB,RB=xi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:MB}=RB;class JC{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new su({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const l=this.getKey(e,r);return this.positions[l]}trim(){const e=this.width,r=this.height=qe(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,l){const h=[];let m=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,v=!0;h.push({left:m,right:_,isDash:v,zeroLength:e[0]===0});let A=e[0];for(let R=1;R<e.length;R++){v=!v;const P=e[R];m=A*l,A+=P,_=A*l,h.push({left:m,right:_,isDash:v,zeroLength:P===0})}return h}addRoundDash(e,r,l){const h=r/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let v=0,A=e[v];for(let R=0;R<this.width;R++){R/A.right>1&&(A=e[++v]);const P=Math.abs(R-A.left),L=Math.abs(R-A.right),N=Math.min(P,L);let U;const $=m/l*(h+1);if(A.isDash){const X=h-Math.abs($);U=Math.sqrt(N*N+X*X)}else U=h-Math.sqrt(N*N+$*$);this.image.data[_+R]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,r){for(let A=e.length-1;A>=0;--A){const R=e[A],P=e[A+1];R.zeroLength?e.splice(A,1):P&&P.isDash===R.isDash&&(P.left=R.left,e.splice(A,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,v=e[_];for(let A=0;A<this.width;A++){A/v.right>1&&(v=e[++_]);const R=Math.abs(A-v.left),P=Math.abs(A-v.right),L=Math.min(R,P);this.image.data[m+A]=Math.max(0,Math.min(255,(v.isDash?L:-L)+r+128))}}addDash(e,r){const l=this.getKey(e,r);if(this.positions[l])return this.positions[l];const h=r==="round",m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Tn("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let P=0;P<e.length;P++)e[P]<0&&(Tn("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),v+=e[P];if(v!==0){const P=this.width/v,L=this.getDashRanges(e,this.width,P);h?this.addRoundDash(L,P,m):this.addRegularDash(L,r==="square"?.5*P:0)}const A=this.nextRow+m;this.nextRow+=_;const R={tl:[A,m],br:[v,0]};return this.positions[l]=R,R}}jt(JC,"LineAtlas");const IB=Pt.types,DB=Math.cos(Math.PI/180*37.5),PB=Math.cos(Math.PI/180*5);class XS{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new hm,this.layoutVertexArray2=new il,this.patternVertexArray=new il,this.indexArray=new kr,this.programConfigurations=new Tl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Br,this.maxLineLength=0,this.zOffsetVertexArray=new il,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:qt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,h){}populate(e,r,l,h){this.hasPattern=Cy("line",this.layers,this.pixelRatio,r);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Pe(l);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const N=this.layers[0].layout.get("line-z-offset"),U=N.isConstant()&&!N.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&U?"none":"offset",this.elevationType==="offset"&&_==="none"&&Tn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const A=[];for(const{feature:N,id:U,index:$,sourceLayerIndex:X}of e){const Q=this.layers[0]._featureFilter.needGeometry,te=rt(N,Q);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),te,l))continue;const ce=m?m.evaluate(te,{},l):void 0,he={id:U,properties:N.properties,type:N.type,sourceLayerIndex:X,index:$,geometry:Q?te.geometry:_t(N,l,h),patterns:{},sortKey:ce};A.push(he)}m&&A.sort(((N,U)=>N.sortKey-U.sortKey));const{lineAtlas:R,featureIndex:P}=r,L=this.addConstantDashes(R);for(const N of A){const{geometry:U,index:$,sourceLayerIndex:X}=N;if(L&&this.addFeatureDashes(N,R),this.hasPattern){const Q=i_("line",this.layers,N,this.zoom,this.pixelRatio,r);this.patternFeatures.push(Q)}else this.addFeature(N,U,$,l,R.positions,r.availableImages,r.brightness,r.elevationFeatures);P.insert(e[$].feature,U,$,X,this.index)}}addConstantDashes(e){let r=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(h.kind!=="constant"||m.kind!=="constant")r=!0;else{const _=m.value,v=h.value;if(!v)continue;e.addDash(v,_)}}return r}addFeatureDashes(e,r){const l=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(m.kind==="constant"&&_.kind==="constant")continue;let v,A;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:l},e);A=_.kind==="constant"?_.value:_.evaluate({zoom:l},e),r.addDash(v,A),e.patterns[h.id]=[r.getKey(v,A)]}}update(e,r,l,h,m,_,v,A){this.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v,A)}addFeatures(e,r,l,h,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,l,h,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,CB)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,MB)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,TB.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EB),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,r){let l,h;if(r&&r>0?(l=`mapbox_clip_start_${r}`,h=`mapbox_clip_end_${r}`):(l="mapbox_clip_start",h="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(l)&&e.properties.hasOwnProperty(h))return{start:+e.properties[l],end:+e.properties[h]}}addFeature(e,r,l,h,m,_,v,A){const R=this.layers[0].layout,P=R.get("line-join").evaluate(e,{}),L=R.get("line-cap").evaluate(e,{}),N=R.get("line-miter-limit"),U=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const $=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=R.get("line-z-offset").value;const X=this.layers[0].paint.get("line-width").value;if(X.kind!=="constant"&&X.isLineProgressConstant===!1&&(this.variableWidthValue=X),this.elevationType==="road"){const Q=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,r,h,A,P,L,N,U)){const[te,ce]=this.clipRuntimeLinesToTile(r,1);for(let he=0;he<te.length;he++){const me=te[he],Ie=ce[he],Ee={progress:{min:Ie.progress.min,max:Ie.progress.max},nextDir:this.computeSegNextDir(Ie,me),prevDir:this.computeSegPrevDir(Ie,me)};this.addLine(me,e,h,P,L,N,U,Ee,$&&Ie.parentIndex>0?Ie.parentIndex:null)}this.fillNonElevatedRoadSegment(Q)}}else for(let Q=0;Q<r.length;Q++)this.addLine(r[Q],e,h,P,L,N,U,void 0,$&&Q>0?Q:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,_,h,v,void 0,this.worldview)}computeSegNextDir(e,r){return e.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(e,r){return r[1].sub(e.prevPoint).unit()}clipLinesToTile(e,r){return Yd(e,-r,-r,qt+r,qt+r)}clipRuntimeLinesToTile(e,r){const l=[];return[Yd(e,-r,-r,qt+r,qt+r,l),l]}addElevatedRoadFeature(e,r,l,h,m,_,v,A){const R=[],P=Pn.getElevationFeature(e,h);if(P){const L=this.clipLinesToTile(r,1),N=this.prepareElevatedLines(L,P,l);for(const U of N)R.push({geometry:U,elevation:P,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(R.length===0)return!1;for(const L of R){const N=this.layoutVertexArray.length;this.addLine(L.geometry,e,l,m,_,v,A);const U=new Si(l,L.elevationTileID);if(L.elevation)for(let $=N;$<this.layoutVertexArray.length;$++){const X=new Ct(this.layoutVertexArray.int16[6*$]>>1,this.layoutVertexArray.int16[6*$+1]>>1),Q=U.pointElevation(X,L.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(N)}return!0}prepareElevatedLines(e,r,l){if(r.constantHeight!=null)return e;const h=[],m=1/Pe(l);for(const _ of e)jb(_,new gr(r,m),0,h);return h}fillNonElevatedRoadSegment(e){for(let r=e;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,r,l,h,m,_,v,A,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=R?this.lineFeatureClips(r,R):this.lineClips;const P=h==="none";this.patternJoinNone=this.hasPattern&&P,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const L=A&&A.progress.min>0,N=A&&A.progress.max<1;if(this.lineClips){let Ue={min:this.lineClips.start,max:this.lineClips.end},ft=1;if(A){const wt=this.lineClips.end-this.lineClips.start;Ue=(function(Dt,Xt,Nt){return{min:Oi(Dt.min,Xt,Nt),max:Oi(Dt.max,Xt,Nt)}})(A.progress,{min:0,max:1},Ue),wt>0&&(ft=(Ue.max-Ue.min)/wt)}const Qe=+r.properties.mapbox_clip_feature_len,mt=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Qe)||Number.isNaN(mt)){for(let Dt=0;Dt<e.length-1;Dt++)this.totalDistance+=e[Dt].dist(e[Dt+1]);const wt=this.totalDistance/(Ue.max-Ue.min);this.totalFeatureLength=Number.isFinite(wt)?wt:0,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Qe,this.distance=mt*ft,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const U=IB[r.type]==="Polygon";let $=e.length;for(;$>=2&&e[$-1].equals(e[$-2]);)$--;let X=0;for(;X<$-1&&e[X].equals(e[X+1]);)X++;if($<(U?3:2))return;h==="bevel"&&(_=1.05);const Q=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let te,ce,he,me,Ie,Ee,Ne,Be;A&&A.prevDir&&(Ee=A.prevDir.perp()),A&&A.nextDir&&(Ne=A.nextDir.perp()),this.e1=this.e2=-1,U&&(te=e[$-2],Ie=e[X].sub(te)._unit()._perp());for(let Ue=X;Ue<$;Ue++){if(he=Ue===$-1?U?e[X+1]:void 0:e[Ue+1],he&&e[Ue].equals(he))continue;Ie&&(me=Ie),te&&(ce=te),te=e[Ue],Be=this.evaluateLineProgressFeatures(ce?ce.dist(te):0),Ie=he?he.sub(te)._unit()._perp():me,me=me||Ie;const ft=ce&&he;let Qe=ft?h:U||P?"butt":m;const mt=me.x*Ie.x+me.y*Ie.y;if(P){const lt=function(zt){if(zt.patternJoinNone){const Zt=zt.segmentPoints.length/2,At=zt.lineSoFar-zt.segmentStart;for(let gn=0;gn<Zt;++gn){const bn=zt.segmentPoints[2*gn+1],hn=Math.round(zt.segmentPoints[2*gn])+.5+.25*bn;zt.patternVertexArray.emplaceBack(hn,At,zt.segmentStart),zt.patternVertexArray.emplaceBack(hn,At,zt.segmentStart)}zt.segmentPoints.length=0}zt.e1=zt.e2=-1};if(ft&&mt<PB){this.updateDistance(ce,te),this.addCurrentVertex(te,me,1,1,Q,Be),lt(this),this.addCurrentVertex(te,Ie,-1,-1,Q,Be);continue}if(ce){if(!he){this.updateDistance(ce,te),this.addCurrentVertex(te,me,1,1,Q,Be),lt(this);continue}Qe="miter"}}let wt=me.add(Ie);wt.x===0&&wt.y===0||wt._unit();const Dt=wt.x*Ie.x+wt.y*Ie.y,Xt=Dt!==0?1/Dt:1/0,Nt=2*Math.sqrt(2-2*Dt),Tt=Dt<DB&&ce&&he,Lt=me.x*Ie.y-me.y*Ie.x>0,ht=this.overscaling<=16?15*qt/(512*this.overscaling):0;if(ft&&Qe==="round"){if(Xt<v)Qe="miter";else if(Xt<=2){const lt=KS(te,-10,qt+10);Qe=this.elevationType==="offset"&&(lt||this.hasCrossSlope)?"miter":"fakeround"}}if(Qe==="miter"&&Xt>_&&(Qe="bevel"),Qe==="bevel"&&(Xt>2&&(Qe="flipbevel"),Xt<_&&(Qe="miter")),ce&&!(Qe==="miter"&&Tt)&&this.updateDistance(ce,te),Qe==="miter")if(Tt){const lt=te.dist(ce);if(lt>2*ht){const Zt=te.sub(te.sub(ce)._mult(ht/lt)._round());this.updateDistance(ce,Zt),this.addCurrentVertex(Zt,me,0,0,Q,Be),ce=Zt}this.updateDistance(ce,te),wt._mult(Xt),this.addCurrentVertex(te,wt,0,0,Q,Be);const zt=te.dist(he);if(zt>2*ht){const Zt=te.add(he.sub(te)._mult(ht/zt)._round());this.updateDistance(te,Zt),this.addCurrentVertex(Zt,Ie,0,0,Q,Be),te=Zt}}else wt._mult(Xt),this.addCurrentVertex(te,wt,0,0,Q,Be);else if(Qe==="flipbevel"){if(Xt>100)wt=Ie.mult(-1);else{const lt=Xt*me.add(Ie).mag()/me.sub(Ie).mag();wt._perp()._mult(lt*(Lt?-1:1))}this.addCurrentVertex(te,wt,0,0,Q,Be),this.addCurrentVertex(te,wt.mult(-1),0,0,Q,Be)}else if(Qe==="bevel"||Qe==="fakeround"){Be!=null&&ce&&this.addCurrentVertex(te,Ne||me,-1,-1,Q,Be);const lt=te.dist(ce)<=2*ht&&Qe!=="bevel",zt=wt.mult(Lt?1:-1);zt._mult(Xt);const Zt=Ie.mult(Lt?-1:1),At=me.mult(Lt?-1:1),gn=this.evaluateLineProgressFeatures(this.distance);if(Be==null&&(this.addHalfVertex(te,zt.x,zt.y,!1,!Lt,0,Q,gn),lt||this.addHalfVertex(te,zt.x+2*At.x,zt.y+2*At.y,!1,Lt,0,Q,gn)),Qe==="fakeround"){const bn=Math.round(180*Nt/Math.PI/20);this.addHalfVertex(te,At.x,At.y,!1,Lt,0,Q,gn);for(let hn=0;hn<bn;hn++){let an=hn/bn;if(an!==.5){const dn=an-.5;an+=an*dn*(an-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*dn*dn+(.848013+mt*(.215638*mt-1.06021)))}const Qn=Zt.sub(At)._mult(an)._add(At)._unit();this.addHalfVertex(te,Qn.x,Qn.y,!1,Lt,0,Q,gn)}this.addHalfVertex(te,Zt.x,Zt.y,!1,Lt,0,Q,gn)}lt||Be!=null||this.addHalfVertex(te,zt.x+2*Zt.x,zt.y+2*Zt.y,!1,Lt,0,Q,gn),Be!=null&&he&&this.addCurrentVertex(te,Ee||Ie,1,1,Q,Be)}else if(Qe==="butt")this.addCurrentVertex(te,wt,0,0,Q,Be);else if(Qe==="square"){if(!ce){const lt=L?0:-1;this.addCurrentVertex(te,wt,lt,lt,Q,Be)}if(this.addCurrentVertex(te,wt,0,0,Q,Be),ce){const lt=N?0:1;this.addCurrentVertex(te,wt,lt,lt,Q,Be)}}else if(Qe==="round"){if(ce){const lt=!ft&&Ne?Ne:me;this.addCurrentVertex(te,lt,0,0,Q,Be),!ft&&N||this.addCurrentVertex(te,lt,1,1,Q,Be,!0)}if(he){const lt=!ft&&Ee?Ee:Ie;!ft&&L||this.addCurrentVertex(te,lt,-1,-1,Q,Be,!0),this.addCurrentVertex(te,lt,0,0,Q,Be)}}}}addVerticesTo(e,r,l,h,m,_,v,A,R,P){const L=(r.w-e.w)/this.tessellationStep|0;let N=0;const U=this.scaledDistance;if(L>1){this.lineSoFar=e.w;const X=(r.x-e.x)/L,Q=(r.y-e.y)/L,te=(r.z-e.z)/L,ce=(r.w-e.w)/L;for(let he=1;he<L;++he){e.x+=X,e.y+=Q,e.z+=te,this.lineSoFar+=ce,N+=ce;const me=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(e,l,h,P,!1,v,R,me),this.addHalfVertex(e,m,_,P,!0,-A,R,me)}}this.lineSoFar=r.w,this.scaledDistance=U;const $=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,l,h,P,!1,v,R,$),this.addHalfVertex(r,m,_,P,!0,-A,R,$)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Tn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(e,r,l,h,m,_,v=!1){const A=r.x+r.y*l,R=r.y-r.x*l,P=r.y*h-r.x,L=-r.y-r.x*h;if(_!=null){const N=this.elevationType==="offset",U=-10,$=qt+10,X=_.zOffset,Q=new f_(e.x,e.y,X,this.lineSoFar),te=!!N&&KS(e,U,$),ce=this.lineSoFar,he=this.distance;if(this.currentVertex)if(te){const me=this.currentVertexIsOutside,Ie=this.currentVertex,Ee=new f_(e.x,e.y,X,this.lineSoFar);if(Cv(Ie,Ee,U,$),!KS(Ee,U,$)){if(me){this.e1=this.e2=-1,this.distance-=Ie.dist(Q),this.lineSoFar=Ie.w;const Ne=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,A,R,v,!1,l,m,Ne),this.addHalfVertex(Ie,P,L,v,!0,-h,m,Ne),this.prevDistance=this.distance}this.distance=this.prevDistance+Ie.dist(Ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ie,Ee,A,R,P,L,l,h,m,v),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const me=this.currentVertex;if(this.currentVertexIsOutside){Cv(me,Q,U,$),this.e1=this.e2=-1,this.distance-=me.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=me.w;const Ie=this.evaluateLineProgressFeatures(me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(me,A,R,v,!1,l,m,Ie),this.addHalfVertex(me,P,L,v,!0,-h,m,Ie),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(me,Q,A,R,P,L,l,h,m,v)}else te||(this.addHalfVertex(e,A,R,v,!1,l,m,_),this.addHalfVertex(e,P,L,v,!0,-h,m,_));this.currentVertex=Q,this.currentVertexIsOutside=te,this.lineSoFar=ce}else this.addHalfVertex(e,A,R,v,!1,l,m,_),this.addHalfVertex(e,P,L,v,!0,-h,m,_)}addHalfVertex({x:e,y:r},l,h,m,_,v,A,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const L=Gn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,L)}const P=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),A.primitiveLength++),_?this.e2=P:this.e1=P,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function KS(o,e,r){return o.x<e||o.x>r||o.y<e||o.y>r}let eR,tR;function nR(o,e,r){return e*(qt/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}jt(XS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const iR=(o,e,r)=>(1-r)*o+r*e;function rR(o,e){return 1/nR(o,1,e.tileZoom)}function sR(o,e,r,l){return o.translatePosMatrix(l||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const oR=o=>{const e=[];aR(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=o.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=o.layout.get("line-join").constantOr("miter")==="none",h=!!o.paint.get("line-pattern").constantOr(1);return l&&h&&e.push("LINE_JOIN_NONE"),e};function aR(o){const e=o.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let YS;const lR=()=>YS||(YS={layout:eR||(eR=new ss({"line-cap":new un(Ye.layout_line["line-cap"]),"line-join":new un(Ye.layout_line["line-join"]),"line-miter-limit":new Vt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Vt(Ye.layout_line["line-round-limit"]),"line-sort-key":new un(Ye.layout_line["line-sort-key"]),"line-z-offset":new un(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new Vt(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new Vt(Ye.layout_line["line-cross-slope"]),visibility:new Vt(Ye.layout_line.visibility),"line-width-unit":new Vt(Ye.layout_line["line-width-unit"])})),paint:tR||(tR=new ss({"line-opacity":new un(Ye.paint_line["line-opacity"]),"line-color":new un(Ye.paint_line["line-color"]),"line-translate":new Vt(Ye.paint_line["line-translate"]),"line-translate-anchor":new Vt(Ye.paint_line["line-translate-anchor"]),"line-width":new un(Ye.paint_line["line-width"]),"line-gap-width":new un(Ye.paint_line["line-gap-width"]),"line-offset":new un(Ye.paint_line["line-offset"]),"line-blur":new un(Ye.paint_line["line-blur"]),"line-dasharray":new un(Ye.paint_line["line-dasharray"]),"line-pattern":new un(Ye.paint_line["line-pattern"]),"line-pattern-cross-fade":new Vt(Ye.paint_line["line-pattern-cross-fade"]),"line-gradient":new Rd(Ye.paint_line["line-gradient"]),"line-trim-offset":new Vt(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new Vt(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new Vt(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new Vt(Ye.paint_line["line-emissive-strength"]),"line-border-width":new un(Ye.paint_line["line-border-width"]),"line-border-color":new un(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new Vt(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},YS);class OB extends un{possiblyEvaluate(e,r){return r=new ir(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,h){return r=Object.assign({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,h)}}let Pv;function cR(o,e){return e>0?e+2*o:o}const zB=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),LB=xi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),NB=xi([{name:"a_projected_pos",components:4,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kB=xi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),jB=xi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),FB=xi([{name:"a_texb",components:2,type:"Uint16"}]),BB=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),VB=xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uR=xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),UB=xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bo=24;function $B(o,e,r){return o.sections.forEach((l=>{l.text=(function(h,m,_){const v=m.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),la.applyArabicShaping&&(h=la.applyArabicShaping(h)),h})(l.text,e,r)})),o}const Ov={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function GB(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function HB(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}const QS=4294967296,dR=1/QS,hR=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Zb=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,r=this.length){for(;this.pos<r;){const l=this.readVarint(),h=l>>3,m=this.pos;this.type=7&l,o(h,e,this),this.pos===m&&this.skip(l)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*QS;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*QS;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let r,l;return l=e[this.pos++],r=127&l,l<128?r:(l=e[this.pos++],r|=(127&l)<<7,l<128?r:(l=e[this.pos++],r|=(127&l)<<14,l<128?r:(l=e[this.pos++],r|=(127&l)<<21,l<128?r:(l=e[this.pos],r|=(15&l)<<28,(function(h,m,_){const v=_.buf;let A,R;if(R=v[_.pos++],A=(112&R)>>4,R<128||(R=v[_.pos++],A|=(127&R)<<3,R<128)||(R=v[_.pos++],A|=(127&R)<<10,R<128)||(R=v[_.pos++],A|=(127&R)<<17,R<128)||(R=v[_.pos++],A|=(127&R)<<24,R<128)||(R=v[_.pos++],A|=(1&R)<<31,R<128))return jy(h,A,m);throw new Error("Expected varint not more than 10 bytes")})(r,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&hR?hR.decode(this.buf.subarray(e,o)):(function(r,l,h){let m="",_=l;for(;_<h;){const v=r[_];let A,R,P,L=null,N=v>239?4:v>223?3:v>191?2:1;if(_+N>h)break;N===1?v<128&&(L=v):N===2?(A=r[_+1],(192&A)==128&&(L=(31&v)<<6|63&A,L<=127&&(L=null))):N===3?(A=r[_+1],R=r[_+2],(192&A)==128&&(192&R)==128&&(L=(15&v)<<12|(63&A)<<6|63&R,(L<=2047||L>=55296&&L<=57343)&&(L=null))):N===4&&(A=r[_+1],R=r[_+2],P=r[_+3],(192&A)==128&&(192&R)==128&&(192&P)==128&&(L=(15&v)<<18|(63&A)<<12|(63&R)<<6|63&P,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,N=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),_+=N}return m})(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const r=this.readPackedEnd();for(;this.pos<r;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*dR),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*dR),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(e,r){let l,h;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(l=~(-e%4294967296),h=~(-e/4294967296),4294967295^l?l=l+1|0:(l=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(m,_,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(l,0,r),(function(m,_){const v=(7&m)<<4;_.buf[_.pos++]|=v|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))})(h,r)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=(function(l,h,m){for(let _,v,A=0;A<h.length;A++){if(_=h.charCodeAt(A),_>55295&&_<57344){if(!v){_>56319||A+1===h.length?(l[m++]=239,l[m++]=191,l[m++]=189):v=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[m++]=239,l[m++]=191,l[m++]=189,v=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m})(this.buf,o,this.pos);const r=this.pos-e;r>=128&&fR(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let r=0;r<e;r++)this.buf[this.pos++]=o[r]}writeRawMessage(o,e){this.pos++;const r=this.pos;o(e,this);const l=this.pos-r;l>=128&&fR(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l}writeMessage(o,e,r){this.writeTag(o,2),this.writeRawMessage(e,r)}writePackedVarint(o,e){e.length&&this.writeMessage(o,qB,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,ZB,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,KB,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,WB,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,XB,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,YB,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,QB,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,JB,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,e4,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function jy(o,e,r){return r?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function fR(o,e,r){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(let h=r.pos-1;h>=o;h--)r.buf[h+l]=r.buf[h]}function qB(o,e){for(let r=0;r<o.length;r++)e.writeVarint(o[r])}function ZB(o,e){for(let r=0;r<o.length;r++)e.writeSVarint(o[r])}function WB(o,e){for(let r=0;r<o.length;r++)e.writeFloat(o[r])}function XB(o,e){for(let r=0;r<o.length;r++)e.writeDouble(o[r])}function KB(o,e){for(let r=0;r<o.length;r++)e.writeBoolean(o[r])}function YB(o,e){for(let r=0;r<o.length;r++)e.writeFixed32(o[r])}function QB(o,e){for(let r=0;r<o.length;r++)e.writeSFixed32(o[r])}function JB(o,e){for(let r=0;r<o.length;r++)e.writeFixed64(o[r])}function e4(o,e){for(let r=0;r<o.length;r++)e.writeSFixed64(o[r])}const JS=3;function t4(o,e,r){e.glyphs=[],o===1&&r.readMessage(n4,e)}function n4(o,e,r){if(o===3){const{id:l,bitmap:h,width:m,height:_,left:v,top:A,advance:R}=r.readMessage(i4,{});e.glyphs.push({id:l,bitmap:new su({width:m+2*JS,height:_+2*JS},h),metrics:{width:m,height:_,left:v,top:A,advance:R}})}else o===4?e.ascender=r.readSVarint():o===5&&(e.descender=r.readSVarint())}function i4(o,e,r){o===1?e.id=r.readVarint():o===2?e.bitmap=r.readBytes():o===3?e.width=r.readVarint():o===4?e.height=r.readVarint():o===5?e.left=r.readSVarint():o===6?e.top=r.readSVarint():o===7&&(e.advance=r.readVarint())}const pR=JS,Wl={horizontal:1,vertical:2,horizontalOnly:3};class zv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const l=new zv;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new zv;return r.image=e,r}}class Fy{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,l){const h=new Fy;for(let m=0;m<e.sections.length;m++){const _=e.sections[m];_.image?h.addImageSection(_,l):h.addTextSection(_,r)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(r,l){let h="";for(let m=0;m<r.length;m++){const _=r.charCodeAt(m+1)||null,v=r.charCodeAt(m-1)||null;h+=!l&&(_&&Ls(_)&&!Ov[r[m+1]]||v&&Ls(v)&&!Ov[r[m-1]])||!Ov[r[m]]?r[m]:Ov[r[m]]}return h})(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Wb[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Wb[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new Fy;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(zv.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e,r){const l=e.image?e.image.getPrimary():null;if(!l)return void Tn("Can't add FormattedSection with an empty image.");l.scaleSelf(r);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(zv.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Tn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function eT(o,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X=1){const Q=Fy.fromFeature(o,h,X);L===Wl.vertical&&Q.verticalizePunctuation(N);let te=[];const ce=(function(Ne,Be,Ue,ft,Qe,mt){if(!Ne)return[];const wt=[],Dt=(function(Lt,ht,lt,zt,Zt,At){let gn=0;for(let bn=0;bn<Lt.length();bn++){const hn=Lt.getSection(bn);gn+=mR(Lt.getCodePoint(bn),hn,zt,Zt,ht,At)}return gn/Math.max(1,Math.ceil(gn/lt))})(Ne,Be,Ue,ft,Qe,mt),Xt=Ne.text.indexOf("")>=0;let Nt=0;for(let Lt=0;Lt<Ne.length();Lt++){const ht=Ne.getSection(Lt),lt=Ne.getCodePoint(Lt);if(Wb[lt]||(Nt+=mR(lt,ht,ft,Qe,Be,mt)),Lt<Ne.length()-1){const zt=!((Tt=lt)<11904||!(Ln["Bopomofo Extended"](Tt)||Ln.Bopomofo(Tt)||Ln["CJK Compatibility Forms"](Tt)||Ln["CJK Compatibility Ideographs"](Tt)||Ln["CJK Compatibility"](Tt)||Ln["CJK Radicals Supplement"](Tt)||Ln["CJK Strokes"](Tt)||Ln["CJK Symbols and Punctuation"](Tt)||Ln["CJK Unified Ideographs Extension A"](Tt)||Ln["CJK Unified Ideographs"](Tt)||Ln["Enclosed CJK Letters and Months"](Tt)||Ln["Halfwidth and Fullwidth Forms"](Tt)||Ln.Hiragana(Tt)||Ln["Ideographic Description Characters"](Tt)||Ln["Kangxi Radicals"](Tt)||Ln["Katakana Phonetic Extensions"](Tt)||Ln.Katakana(Tt)||Ln["Vertical Forms"](Tt)||Ln["Yi Radicals"](Tt)||Ln["Yi Syllables"](Tt)));(r4[lt]||zt||ht.image)&&wt.push(_R(Lt+1,Nt,Dt,wt,s4(lt,Ne.getCodePoint(Lt+1),zt&&Xt),!1))}}var Tt;return yR(_R(Ne.length(),Nt,Dt,wt,0,!0))})(Q,R,m,e,l,U),{processBidirectionalText:he,processStyledBidirectionalText:me}=la;if(he&&Q.sections.length===1){const Ne=he(Q.toString(),ce);for(const Be of Ne){const Ue=new Fy;Ue.text=Be,Ue.sections=Q.sections;for(let ft=0;ft<Be.length;ft++)Ue.sectionIndex.push(0);te.push(Ue)}}else if(me){const Ne=me(Q.text,Q.sectionIndex,ce);for(const Be of Ne){const Ue=new Fy;Ue.text=Be[0],Ue.sectionIndex=Be[1],Ue.sections=Q.sections,te.push(Ue)}}else te=(function(Ne,Be){const Ue=[],ft=Ne.text;let Qe=0;for(const mt of Be)Ue.push(Ne.substring(Qe,mt)),Qe=mt;return Qe<ft.length&&Ue.push(Ne.substring(Qe,ft.length)),Ue})(Q,ce);const Ie=[],Ee={positionedLines:Ie,text:Q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ne,Be,Ue,ft,Qe,mt,wt,Dt,Xt,Nt,Tt,Lt){let ht=0,lt=0,zt=0;const Zt=Dt==="right"?1:Dt==="left"?0:.5;let At=!1;for(const dn of Qe){const kn=dn.getSections();for(const ei of kn){if(ei.image)continue;const yi=Be[ei.fontStack];if(yi&&(At=yi.ascender!==void 0&&yi.descender!==void 0,!At))break}if(!At)break}let gn=0;for(const dn of Qe){dn.trim();const kn=dn.getMaxScale(),ei=(kn-1)*Bo,yi={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[gn]=yi;const $i=yi.positionedGlyphs;let ri=0;if(!dn.length()){lt+=mt,++gn;continue}let Qi=0,Ji=0;for(let Ae=0;Ae<dn.length();Ae++){const we=dn.getSection(Ae),yt=dn.getSectionIndex(Ae),en=dn.getCodePoint(Ae);let xt=we.scale,ln=null,Rn=null,Cn=null,oi=Bo,qn=0,Sn=Xt;Sn===Wl.vertical&&((bn=en)===12312||bn===12313||bn===12316||bn===12540||bn===12448)&&(Sn=Wl.horizontal);const Ki=!(Sn===Wl.horizontal||!Tt&&!rm(en)||Tt&&(Wb[en]||op(en)));if(we.image){const _r=ft.get(we.image.toString());if(!_r)continue;Cn=we.image,Ne.iconsInText=Ne.iconsInText||!0,Rn=_r.paddedRect;const Wn=_r.displaySize;xt=xt*Bo/Lt,ln={width:Wn[0],height:Wn[1],left:0,top:-pR,advance:Ki?Wn[1]:Wn[0],localGlyph:!1},qn=At?-ln.height*xt:kn*Bo-17-Wn[1]*xt,oi=ln.advance;const ki=(Ki?Wn[0]:Wn[1])*xt-Bo*kn;ki>0&&ki>ri&&(ri=ki)}else{const _r=Ue[we.fontStack];if(!_r)continue;_r[en]&&(Rn=_r[en]);const Wn=Be[we.fontStack];if(!Wn)continue;const ki=Wn.glyphs[en];if(!ki)continue;if(ln=ki.metrics,oi=en!==8203?Bo:0,At){const yr=Wn.ascender!==void 0?Math.abs(Wn.ascender):0,lr=Wn.descender!==void 0?Math.abs(Wn.descender):0,ms=(yr+lr)*xt;Qi<ms&&(Qi=ms,Ji=(yr-lr)/2*xt),qn=-yr*xt}else qn=(kn-xt)*Bo-17}Ki?(Ne.verticalizable=!0,$i.push({glyph:en,image:Cn,x:ht,y:lt+qn,vertical:Ki,scale:xt,localGlyph:ln.localGlyph,fontStack:we.fontStack,sectionIndex:yt,metrics:ln,rect:Rn}),ht+=oi*xt+Nt):($i.push({glyph:en,image:Cn,x:ht,y:lt+qn,vertical:Ki,scale:xt,localGlyph:ln.localGlyph,fontStack:we.fontStack,sectionIndex:yt,metrics:ln,rect:Rn}),ht+=ln.advance*xt+Nt)}$i.length!==0&&(zt=Math.max(ht-Nt,zt),At?xR($i,Zt,ri,Ji,mt*kn/2):xR($i,Zt,ri,0,mt/2)),ht=0;const rs=mt*kn+ri;yi.lineOffset=Math.max(ri,ei),lt+=rs,++gn}var bn;const hn=lt,{horizontalAlign:an,verticalAlign:Qn}=tT(wt);(function(dn,kn,ei,yi,$i,ri){const Qi=(kn-ei)*$i,Ji=-ri*yi;for(const rs of dn)for(const Ae of rs.positionedGlyphs)Ae.x+=Qi,Ae.y+=Ji})(Ne.positionedLines,Zt,an,Qn,zt,hn),Ne.top+=-Qn*hn,Ne.bottom=Ne.top+hn,Ne.left+=-an*zt,Ne.right=Ne.left+zt,Ne.hasBaseline=At})(Ee,e,r,l,te,_,v,A,L,R,N,$),!(function(Ne){for(const Be of Ne)if(Be.positionedGlyphs.length!==0)return!1;return!0})(Ie))return Ee}const Wb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},r4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mR(o,e,r,l,h,m){if(e.image){const _=l.get(e.image.toString());return _?_.displaySize[0]*e.scale*Bo/m+h:0}{const _=r[e.fontStack],v=_&&_.glyphs[o];return v?v.metrics.advance*e.scale+h:0}}function gR(o,e,r,l){const h=Math.pow(o-e,2);return l?o<e?h/2:2*h:h+Math.abs(r)*r}function s4(o,e,r){let l=0;return o===10&&(l-=1e4),r&&(l+=150),o!==40&&o!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function _R(o,e,r,l,h,m){let _=null,v=gR(e,r,h,m);for(const A of l){const R=gR(e-A.x,r,h,m)+A.badness;R<=v&&(_=A,v=R)}return{index:o,x:e,priorBreak:_,badness:v}}function yR(o){return o?yR(o.priorBreak).concat(o.index):[]}function tT(o){let e=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function xR(o,e,r,l,h){if(!(e||r||l||h))return;const m=o.length-1,_=o[m],v=(_.x+_.metrics.advance*_.scale)*e;for(let A=0;A<=m;A++)o[A].x-=v,o[A].y+=r+l+h}function vR(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function Xb(o,e,r,l){const{horizontalAlign:h,verticalAlign:m}=tT(l),_=r[0]-o.displaySize[0]*h,v=r[1]-o.displaySize[1]*m;return{imagePrimary:o,imageSecondary:e,top:v,bottom:v+o.displaySize[1],left:_,right:_+o.displaySize[0]}}function nT(o,e,r,l,h,m){const _=o.imagePrimary;let v;if(_.content){const Q=_.content,te=_.pixelRatio||1;v=[Q[0]/te,Q[1]/te,_.displaySize[0]-Q[2]/te,_.displaySize[1]-Q[3]/te]}const A=e.left*m,R=e.right*m;let P,L,N,U;r==="width"||r==="both"?(U=h[0]+A-l[3],L=h[0]+R+l[1]):(U=h[0]+(A+R-_.displaySize[0])/2,L=U+_.displaySize[0]);const $=e.top*m,X=e.bottom*m;return r==="height"||r==="both"?(P=h[1]+$-l[0],N=h[1]+X+l[2]):(P=h[1]+($+X-_.displaySize[1])/2,N=P+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:P,right:L,bottom:N,left:U,collisionPadding:v}}function bR(o){return!o.imagePrimary.stretchX}function wR(o){return!o.imagePrimary.stretchY}function SR(o){return{width:o.right-o.left,height:o.bottom-o.top}}const Jd=128;function By(o,e,r){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ir(o+1,{worldview:r}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:m}=l;let _=0;for(;_<h.length&&h[_]<=o;)_++;_=Math.max(0,_-1);let v=_;for(;v<h.length&&h[v]<o+1;)v++;v=Math.min(h.length-1,v);const A=h[_],R=h[v];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:R,interpolationType:m}:{kind:"camera",minZoom:A,maxZoom:R,minSize:l.evaluate(new ir(A,{worldview:r})),maxSize:l.evaluate(new ir(R,{worldview:r})),interpolationType:m}}}function iT(o,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:h}){return o.kind==="source"?l/Jd:o.kind==="composite"?Gn(l/Jd,h/Jd,r):e}function Vy(o,e,r=1){let l=0,h=0;if(o.kind==="constant")h=o.layoutSize*r;else if(o.kind!=="source"){const{interpolationType:m,minZoom:_,maxZoom:v}=o,A=m?se(ts.interpolationFactor(m,e,_,v),0,1):0;o.kind==="camera"?h=Gn(o.minSize,o.maxSize,A)*r:l=A*r}return{uSizeT:l,uSize:h}}class Rp extends Ct{constructor(e,r,l,h,m){super(e,r),this.angle=h,this.z=l,m!==void 0&&(this.segment=m)}clone(){return new Rp(this.x,this.y,this.z,this.angle,this.segment)}}function TR(o,e,r,l,h){if(e.segment===void 0)return!0;let m=e,_=e.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=o[_].dist(m),m=o[_]}v+=o[_].dist(o[_+1]),_++;const A=[];let R=0;for(;v<r/2;){const P=o[_],L=o[_+1];if(!L)return!1;let N=o[_-1].angleTo(P)-P.angleTo(L);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:v,angleDelta:N}),R+=N;v-A[0].distance>l;)R-=A.shift().angleDelta;if(R>h)return!1;_++,v+=P.dist(L)}return!0}function ER(o){let e=0;for(let r=0;r<o.length-1;r++)e+=o[r].dist(o[r+1]);return e}function AR(o,e,r){return o?.6*e*r:0}function CR(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function o4(o,e,r,l,h,m){const _=AR(r,h,m),v=CR(r,l)*m;let A=0;const R=ER(o)/2;for(let P=0;P<o.length-1;P++){const L=o[P],N=o[P+1],U=L.dist(N);if(A+U>R){const $=(R-A)/U,X=Gn(L.x,N.x,$),Q=Gn(L.y,N.y,$),te=new Rp(X,Q,0,N.angleTo(L),P);return!_||TR(o,te,v,_,e)?te:void 0}A+=U}}function a4(o,e,r,l,h,m,_,v,A){const R=AR(l,m,_),P=CR(l,h),L=P*_,N=o[0].x===0||o[0].x===A||o[0].y===0||o[0].y===A;return e-L<e/4&&(e=L+e/4),RR(o,N?e/2*v%e:(P/2+2*m)*_*v%e,e,R,r,L,N,!1,A)}function RR(o,e,r,l,h,m,_,v,A){const R=m/2,P=ER(o);let L=0,N=e-r,U=[];for(let $=0;$<o.length-1;$++){const X=o[$],Q=o[$+1],te=X.dist(Q),ce=Q.angleTo(X);for(;N+r<L+te;){N+=r;const he=(N-L)/te,me=Gn(X.x,Q.x,he),Ie=Gn(X.y,Q.y,he);if(me>=0&&me<A&&Ie>=0&&Ie<A&&N-R>=0&&N+R<=P){const Ee=new Rp(me,Ie,0,ce,$);l&&!TR(o,Ee,m,l,h)||U.push(Ee)}}L+=te}return v||U.length||_||(U=RR(o,L/2,r,l,h,m,_,!0,A)),U}function MR(o){let e=0,r=0;for(const _ of o)e+=_.w*_.h,r=Math.max(r,_.w);o.sort(((_,v)=>v.h-_.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,m=0;for(const _ of o)for(let v=l.length-1;v>=0;v--){const A=l[v];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===A.w&&_.h===A.h){const R=l.pop();R&&v<l.length&&(l[v]=R)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(l.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}jt(Rp,"Anchor");const y_=1;class Lv{static getImagePositionScale(e,r,l){if(r&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:l,y:l}}constructor(e,r,l,h){this.paddedRect=e;const{pixelRatio:m,version:_,stretchX:v,stretchY:A,content:R,sdf:P,usvg:L}=r;this.pixelRatio=m,this.stretchX=v,this.stretchY=A,this.content=R,this.version=_,this.padding=l,this.sdf=P,this.usvg=L,this.scale=Lv.getImagePositionScale(h,L,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function rT(o,e,r){const l=oc.parse(o),h=(function(m,_,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*_,h:(m.data?m.data.height:m.height*v[1])+2*_}})(e,r,[l.options.transform.a,l.options.transform.d]);return{bin:h,imagePosition:new Lv(h,e,r,l),imageVariant:l}}class IR{constructor(e,r,l){const h=new Map,m=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,h,y_,_),this.addImages(r,m,2,_);const{w:v,h:A}=MR(_),R=new go({width:v||1,height:A||1});for(const[P,L]of e.entries()){const N=h.get(P).paddedRect;go.copy(L.data,R,{x:0,y:0},{x:N.x+y_,y:N.y+y_},L.data,null,L.sdf)}for(const[P,L]of r.entries()){const N=m.get(P),U=N.paddedRect;let $=N.padding;const X=U.x+$,Q=U.y+$,te=L.data.width,ce=L.data.height;$=$>1?$-1:$,go.copy(L.data,R,{x:0,y:0},{x:X,y:Q},L.data,l),go.copy(L.data,R,{x:0,y:ce-$},{x:X,y:Q-$},{width:te,height:$},l),go.copy(L.data,R,{x:0,y:0},{x:X,y:Q+ce},{width:te,height:$},l),go.copy(L.data,R,{x:te-$,y:0},{x:X-$,y:Q},{width:$,height:ce},l),go.copy(L.data,R,{x:0,y:0},{x:X+te,y:Q},{width:$,height:ce},l),go.copy(L.data,R,{x:te-$,y:ce-$},{x:X-$,y:Q-$},{width:$,height:$},l),go.copy(L.data,R,{x:0,y:ce-$},{x:X+te,y:Q-$},{width:$,height:$},l),go.copy(L.data,R,{x:0,y:0},{x:X+te,y:Q+ce},{width:$,height:$},l),go.copy(L.data,R,{x:te-$,y:0},{x:X-$,y:Q+ce},{width:$,height:$},l)}this.lut=l,this.image=R,this.iconPositions=h,this.patternPositions=m}addImages(e,r,l,h){for(const[m,_]of e.entries()){const{bin:v,imagePosition:A,imageVariant:R}=rT(m,_,l);r.set(m,A),h.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(R.id)}}patchUpdatedImages(e,r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>e.hasImage(h,l))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const h of e.getUpdatedImages(l)){for(const m of this.iconPositions.keys()){const _=oc.parse(m);if(Vs.isEqual(_.id,h)){const v=e.getImage(h,l);this.patchUpdatedImage(this.iconPositions.get(m),v,r,null)}}for(const m of this.patternPositions.keys()){const _=oc.parse(m);if(Vs.isEqual(_.id,h)){const v=e.getImage(h,l);this.patchUpdatedImage(this.patternPositions.get(m),v,r,this.lut)}}}}patchUpdatedImage(e,r,l,h=null){if(!e||!r||e.version===r.version)return;e.version=r.version;const[m,_]=e.tl,v=e.sdf;if(this.lut||v){const A={width:r.data.width,height:r.data.height},R=new go(A);go.copy(r.data,R,{x:0,y:0},{x:0,y:0},A,h,v),l.update(R,{position:{x:m,y:_}})}else l.update(r.data,{position:{x:m,y:_}})}}jt(Lv,"ImagePosition"),jt(IR,"ImageAtlas");const Nv=1e20;function DR(o,e,r,l,h,m,_,v,A){for(let R=e;R<e+l;R++)PR(o,r*m+R,m,h,_,v,A);for(let R=r;R<r+h;R++)PR(o,R*m+e,1,l,_,v,A)}function PR(o,e,r,l,h,m,_){m[0]=0,_[0]=-Nv,_[1]=Nv,h[0]=o[e];for(let v=1,A=0,R=0;v<l;v++){h[v]=o[e+v*r];const P=v*v;do{const L=m[A];R=(h[v]-h[L]+P-L*L)/(v-L)/2}while(R<=_[A]&&--A>-1);A++,m[A]=v,_[A]=R,_[A+1]=Nv}for(let v=0,A=0;v<l;v++){for(;_[A+1]<v;)A++;const R=m[A],P=v-R;o[e+v*r]=h[R]+P*P}}const eh=2,sT={none:0,ideographs:1,all:2};class Uy{constructor(e,r,l){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=l,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const l=[],h=this.url||Ir.GLYPHS_URL;for(const m in e)for(const _ of e[m])l.push({stack:m,id:_});ke(l,(({stack:m,id:_},v)=>{let A=this.entries[m];A||(A=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=A.glyphs[_];if(R!==void 0)return void v(null,{stack:m,id:_,glyph:R});if(R=this._tinySDF(A,m,_),R)return A.glyphs[_]=R,void v(null,{stack:m,id:_,glyph:R});const P=Math.floor(_/256);if(256*P>65535)return Tn("glyphs > 65535 not supported"),void v(null,{stack:m,id:_,glyph:R});if(A.ranges[P])return void v(null,{stack:m,id:_,glyph:R});let L=A.requests[P];L||(L=A.requests[P]=[],Uy.loadGlyphRange(m,P,h,this.requestManager,((N,U)=>{if(U){A.ascender=U.ascender,A.descender=U.descender;for(const $ in U.glyphs)this._doesCharSupportLocalGlyph(+$)||(A.glyphs[+$]=U.glyphs[+$]);A.ranges[P]=!0}for(const $ of L)$(N,U);delete A.requests[P]}))),L.push(((N,U)=>{N?v(N):U&&v(null,{stack:m,id:_,glyph:U.glyphs[_]||null})}))}),((m,_)=>{if(m)r(m);else if(_){const v={};for(const{stack:A,id:R,glyph:P}of _)v[A]===void 0&&(v[A]={}),v[A].glyphs===void 0&&(v[A].glyphs={}),v[A].glyphs[R]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},v[A].ascender=this.entries[A].ascender,v[A].descender=this.entries[A].descender;r(null,v)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==sT.none&&(this.localGlyphMode===sT.all?!!this.localFontFamily:!!this.localFontFamily&&(Ln["CJK Unified Ideographs"](e)||Ln["Hangul Syllables"](e)||Ln.Hiragana(e)||Ln.Katakana(e)||Ln["CJK Symbols and Punctuation"](e)||Ln["CJK Unified Ideographs Extension A"](e)||Ln["CJK Unified Ideographs Extension B"](e)||Ln.Osage(e)))}_tinySDF(e,r,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let X="400";/bold/i.test(r)?X="900":/medium/i.test(r)?X="500":/light/i.test(r)&&(X="200"),m=e.tinySDF=new Uy.TinySDF({fontFamily:h,fontWeight:X,fontSize:24*eh,buffer:3*eh,radius:8*eh}),m.fontWeight=X}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCodePoint(l),{data:v,width:A,height:R,glyphWidth:P,glyphHeight:L,glyphLeft:N,glyphTop:U,glyphAdvance:$}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new su({width:A,height:R},v),metrics:{width:P/eh,height:L/eh,left:N/eh,top:U/eh-27,advance:$/eh,localGlyph:!0}}}}Uy.loadGlyphRange=function(o,e,r,l,h){const m=256*e,_=m+255,v=l.transformRequest(l.normalizeGlyphsURL(r).replace("{fontstack}",o).replace("{range}",`${m}-${_}`),Ll.Glyphs);Ya(v,((A,R)=>{if(A)h(A);else if(R){const P={},L=(function(N){return new Zb(N).readFields(t4,{})})(R);for(const N of L.glyphs)P[N.id]=N;h(null,{glyphs:P,ascender:L.ascender,descender:L.descender})}}))},Uy.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=e,this.cutoff=l,this.radius=r,this.lang=v;const A=this.size=o+4*e,R=this._createCanvas(A),P=this.ctx=R.getContext("2d",{willReadFrequently:!0});P.font=`${_} ${m} ${o}px ${h}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(o),_=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),A=Math.min(this.size-this.buffer,_+Math.ceil(l)),R=v+2*this.buffer,P=A+2*this.buffer,L=Math.max(R*P,0),N=new Uint8ClampedArray(L),U={data:N,width:R,height:P,glyphWidth:v,glyphHeight:A,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(v===0||A===0)return U;const{ctx:$,buffer:X,gridInner:Q,gridOuter:te}=this;this.lang&&($.lang=this.lang),$.clearRect(X,X,v,A),$.fillText(o,X,X+_);const ce=$.getImageData(X,X,v,A);te.fill(Nv,0,L),Q.fill(0,0,L);for(let he=0;he<A;he++)for(let me=0;me<v;me++){const Ie=ce.data[4*(he*v+me)+3]/255;if(Ie===0)continue;const Ee=(he+X)*R+me+X;if(Ie===1)te[Ee]=0,Q[Ee]=Nv;else{const Ne=.5-Ie;te[Ee]=Ne>0?Ne*Ne:0,Q[Ee]=Ne<0?Ne*Ne:0}}DR(te,0,0,R,P,R,this.f,this.v,this.z),DR(Q,X,X,v,A,R,this.f,this.v,this.z);for(let he=0;he<L;he++){const me=Math.sqrt(te[he])-Math.sqrt(Q[he]);N[he]=Math.round(255-255*(me/this.radius+this.cutoff))}return U}};const df=y_;function OR(o,e){return o+e[1]-e[0]}function oT(o,e,r,l,h=1){const m=[],_=o.imagePrimary,v=_.pixelRatio,A=_.paddedRect.w-2*df,R=_.paddedRect.h-2*df,P=(o.right-o.left)*h,L=(o.bottom-o.top)*h,N=_.stretchX||[[0,A]],U=_.stretchY||[[0,R]],$=N.reduce(OR,0),X=U.reduce(OR,0),Q=A-$,te=R-X;let ce=0,he=$,me=0,Ie=X,Ee=0,Ne=Q,Be=0,Ue=te;if(_.content&&l){const Qe=_.content;ce=Kb(N,0,Qe[0]),me=Kb(U,0,Qe[1]),he=Kb(N,Qe[0],Qe[2]),Ie=Kb(U,Qe[1],Qe[3]),Ee=Qe[0]-ce,Be=Qe[1]-me,Ne=Qe[2]-Qe[0]-he,Ue=Qe[3]-Qe[1]-Ie}const ft=(Qe,mt,wt,Dt)=>{const Xt=Yb(Qe.stretch-ce,he,P,o.left*h),Nt=Qb(Qe.fixed-Ee,Ne,Qe.stretch,$),Tt=Yb(mt.stretch-me,Ie,L,o.top*h),Lt=Qb(mt.fixed-Be,Ue,mt.stretch,X),ht=Yb(wt.stretch-ce,he,P,o.left*h),lt=Qb(wt.fixed-Ee,Ne,wt.stretch,$),zt=Yb(Dt.stretch-me,Ie,L,o.top*h),Zt=Qb(Dt.fixed-Be,Ue,Dt.stretch,X),At=new Ct(Xt,Tt),gn=new Ct(ht,Tt),bn=new Ct(ht,zt),hn=new Ct(Xt,zt),an=new Ct(Nt/v,Lt/v),Qn=new Ct(lt/v,Zt/v),dn=e*Math.PI/180;if(dn){const Qi=Math.sin(dn),Ji=Math.cos(dn),rs=[Ji,-Qi,Qi,Ji];At._matMult(rs),gn._matMult(rs),hn._matMult(rs),bn._matMult(rs)}const kn=Qe.stretch+Qe.fixed,ei=wt.stretch+wt.fixed,yi=mt.stretch+mt.fixed,$i=Dt.stretch+Dt.fixed,ri=o.imageSecondary;return{tl:At,tr:gn,bl:hn,br:bn,texPrimary:{x:_.paddedRect.x+df+kn,y:_.paddedRect.y+df+yi,w:ei-kn,h:$i-yi},texSecondary:ri?{x:ri.paddedRect.x+df+kn,y:ri.paddedRect.y+df+yi,w:ei-kn,h:$i-yi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:an,pixelOffsetBR:Qn,minFontScaleX:Ne/v/P,minFontScaleY:Ue/v/L,isSDF:r}};if(l&&(_.stretchX||_.stretchY)){const Qe=zR(N,Q,$),mt=zR(U,te,X);for(let wt=0;wt<Qe.length-1;wt++){const Dt=Qe[wt],Xt=Qe[wt+1];for(let Nt=0;Nt<mt.length-1;Nt++)m.push(ft(Dt,mt[Nt],Xt,mt[Nt+1]))}}else m.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:R+1}));return m}function l4(o,e){const r=o.stretchY||[[0,o.paddedRect.h-2*df]];return e&&(o.stretchX||o.stretchY)?LR(o.stretchX||[[0,o.paddedRect.w-2*df]])*LR(r):1}function Kb(o,e,r){let l=0;for(const h of o)l+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return l}function zR(o,e,r){const l=[{fixed:-df,stretch:0}];for(const[h,m]of o){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return l.push({fixed:e+df,stretch:r}),l}function LR(o){return 2*o.length+1}function Yb(o,e,r,l){return o/e*r+l}function Qb(o,e,r,l){return o-e*r/l}function c4(o,e,r,l){const h=e+o.positionedLines[l].lineOffset;return l===0?r+h/2:r+(h+(e+o.positionedLines[l-1].lineOffset))/2}function u4(o,e=1,r=!1){let l=1/0,h=1/0,m=-1/0,_=-1/0;const v=o[0];for(let U=0;U<v.length;U++){const $=v[U];(!U||$.x<l)&&(l=$.x),(!U||$.y<h)&&(h=$.y),(!U||$.x>m)&&(m=$.x),(!U||$.y>_)&&(_=$.y)}const A=Math.min(m-l,_-h);let R=A/2;const P=new gd([],d4);if(A===0)return new Ct(l,h);for(let U=l;U<m;U+=A)for(let $=h;$<_;$+=A)P.push(new $y(U+R,$+R,R,o));let L=(function(U){let $=0,X=0,Q=0;const te=U[0];for(let ce=0,he=te.length,me=he-1;ce<he;me=ce++){const Ie=te[ce],Ee=te[me],Ne=Ie.x*Ee.y-Ee.x*Ie.y;X+=(Ie.x+Ee.x)*Ne,Q+=(Ie.y+Ee.y)*Ne,$+=3*Ne}return new $y(X/$,Q/$,0,U)})(o),N=P.length;for(;P.length;){const U=P.pop();(U.d>L.d||!L.d)&&(L=U,r&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,N)),U.max-L.d<=e||(R=U.h/2,P.push(new $y(U.p.x-R,U.p.y-R,R,o)),P.push(new $y(U.p.x+R,U.p.y-R,R,o)),P.push(new $y(U.p.x-R,U.p.y+R,R,o)),P.push(new $y(U.p.x+R,U.p.y+R,R,o)),N+=4)}return r&&(console.log(`num probes: ${N}`),console.log(`best distance: ${L.d}`)),L.p}function d4(o,e){return e.max-o.max}class $y{constructor(e,r,l,h){this.p=new Ct(e,r),this.h=l,this.d=(function(m,_){let v=!1,A=1/0;for(let R=0;R<_.length;R++){const P=_[R];for(let L=0,N=P.length,U=N-1;L<N;U=L++){const $=P[L],X=P[U];$.y>m.y!=X.y>m.y&&m.x<(X.x-$.x)*(m.y-$.y)/(X.y-$.y)+$.x&&(v=!v),A=Math.min(A,Va(m,$,X))}}return(v?1:-1)*Math.sqrt(A)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const h4=Object.keys,aT=Number.POSITIVE_INFINITY,f4=Math.sqrt(2);function Jb(o,e,r,l){const h=o.collisionPadding||[0,0,0,0],m={top:o.top-h[1],bottom:o.bottom+h[3],left:o.left-h[0],right:o.right+h[2],scaled:!1};return l!==void 0&&(function(_,v){_.top*=v,_.bottom*=v,_.left*=v,_.right*=v,_.scaled=!0})(m,l),r&&(function(_,v){if(!v)return;const A=fi(v),R=new Ct(_.left,_.top),P=new Ct(_.right,_.top),L=new Ct(_.left,_.bottom),N=new Ct(_.right,_.bottom);R._rotateAround(A,new Ct(0,0)),P._rotateAround(A,new Ct(0,0)),L._rotateAround(A,new Ct(0,0)),N._rotateAround(A,new Ct(0,0)),_.left=Math.min(R.x,P.x,L.x,N.x),_.right=Math.max(R.x,P.x,L.x,N.x),_.top=Math.min(R.y,P.y,L.y,N.y),_.bottom=Math.max(R.y,P.y,L.y,N.y)})(m,r),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function NR(o,[e,r]){let l=0,h=0;if(r===aT){e<0&&(e=0);const m=e/f4;switch(o){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(o){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),o){case"top-right":case"top-left":case"top":h=r-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-r}switch(o){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,h]}function p4(o,e,r,l,h,m,_,v,A,R,P){const L=o.layers[0],N=L.appearances;if(N.length===0)return{iconBBox:null,iconVerticalBBox:null};let U=null,$=null;const X=l.get("icon-rotate").evaluate(h,{},m);e&&(U=Jb(e,U,X,_),r)&&($=Jb(r,$,X+90,_));const[Q,te]=l.get("icon-size-scale-range"),ce=se(1,Q,te);for(const he of N){const me=he.getUnevaluatedProperties(),Ie=me._values["icon-image"].value!==void 0,Ee=me._values["icon-size"].value!==void 0,Ne=me._values["icon-offset"].value!==void 0,Be=me._values["icon-rotate"].value!==void 0;if(Ie||Ee||Ne||Be){const Ue=Ne?L.getAppearanceValueAndResolveTokens(he,"icon-offset",h,m,[]):null,ft=Ue&&Array.isArray(Ue)?Ue:v,Qe=Be?L.getAppearanceValueAndResolveTokens(he,"icon-rotate",h,m,[]):null,mt=typeof Qe=="number"?Qe:X,wt=Ee?L.getAppearanceValueAndResolveTokens(he,"icon-size",h,m,[]):null,Dt=typeof wt=="number"?wt*A.iconScaleFactor:_;let Xt=null,Nt=null,Tt=null;if(Ie){const Lt=L.getAppearanceValueAndResolveTokens(he,"icon-image",h,m,[]);if(Lt){const ht=o.getResolvedImageFromTokens(Lt),lt=me._values["icon-size"],zt=kv(ht,By(o.zoom,lt,o.worldview),lt,m,o.zoom,h,o.pixelRatio,ce,o.worldview);Tt=R.get(zt.iconPrimary.toString())}}else e&&(Tt=e.imagePrimary);Tt&&(Xt=Xb(Tt,null,ft,P),o.allowVerticalPlacement&&(Nt=Xb(Tt,null,ft,P))),Xt&&(U=Jb(Xt,U,mt,Dt)),Nt&&($=Jb(Nt,$,mt+90,Dt))}}return{iconBBox:U,iconVerticalBBox:$}}function e1(o,e,r,l,h,m,_,v,A){if(!e||!e.usvg)return;const R=SR(l),P=SR(h),L=m!=="both"&&m!=="width"||!bR(l)?1:P.width/R.width,N=m!=="both"&&m!=="height"||!wR(l)?1:P.height/R.height;r.scaleSelf(L,N);const U=r.toString();_.set(U,r),v.set(U,e);const{imagePosition:$}=rT(U,e,y_);A.set(U,$)}function kR(o,e,r,l,h,m,_,v,A){if(!o)return;const R=(function(P,L,N,U,$,X){if(P.kind==="camera")return P.maxSize;if(P.kind==="composite"){const Q=L.possiblyEvaluate(new ir(P.maxZoom,{worldview:X}),N).evaluate($,{},N),te=L.possiblyEvaluate(new ir(P.minZoom,{worldview:X}),N).evaluate($,{},N);return Math.max(Q,te)}return L.possiblyEvaluate(new ir(U,{worldview:X})).evaluate($,{},N)})(e,r,l,h,m,A);return o.scaleSelf(R*v*_)}function kv(o,e,r,l,h,m,_,v,A){return{iconPrimary:kR(o.getPrimary(),e,r,l,h,m,_,v,A),iconSecondary:kR(o.getSecondary(),e,r,l,h,m,_,v,A)}}function m4(o,e,r){if(!e)return;const l=r.get(o.toString()),h=r.get(e.toString());l&&h&&(l.paddedRect.w===h.paddedRect.w&&l.paddedRect.h===h.paddedRect.h||Tn(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),l.usvg!==h.usvg&&Tn(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function jR(o,e,r,l){if(!o)return;const h=e.get(r.toString());if(o.imagePrimary=h,l){const m=e.get(l.toString());o.imageSecondary=m}}function g4(o,e){for(const r in o.horizontal)FR(o.horizontal[r],e);FR(o.vertical,e)}function FR(o,e){if(o){for(const r of o.positionedLines)for(const l of r.positionedGlyphs)if(l.image!==null){const h=l.image.toString();l.rect=e.get(h).paddedRect}}}function lT(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _4(o,e,r,l,h,m,_,v,A){const R=cT(m.horizontal)||m.vertical,P=r.get("icon-text-fit-padding").evaluate(l,{},h);let L,N=e;return e&&A!=="none"&&(o.allowVerticalPlacement&&m.vertical&&(L=nT(e,m.vertical,A,P,v,_)),R&&(N=nT(e,R,A,P,v,_))),{defaultShapedIcon:N,verticallyShapedIcon:L}}function y4(o,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce,he,me,Ie){let Ee=_.textMaxSize.evaluate(e,{},N);Ee===void 0?Ee=v*_.textScaleFactor:Ee*=_.textScaleFactor;const Ne=o.layers[0].layout,Be=Bo,Ue=v*_.textScaleFactor/Be,ft=cT(r.horizontal)||r.vertical;if(Q!=="none"&&o.appearanceFeatureData&&e.index<o.appearanceFeatureData.length){const At=o.appearanceFeatureData[e.index];At&&(At.textShaping=ft,At.iconTextFitPadding=Ne.get("icon-text-fit-padding").evaluate(e,{},N),At.fontScale=Ue)}const Qe=U.name==="globe",mt=o.tilePixelRatio*Ee/Be,wt=(ht=o.overscaling,o.zoom>18&&ht>2&&(ht>>=1),Math.max(qt/(512*ht),1)*Ne.get("symbol-spacing")),Dt=Ne.get("text-padding")*o.tilePixelRatio,Xt=Ne.get("icon-padding")*o.tilePixelRatio,Nt=fi(Ne.get("text-max-angle")),Tt=Ne.get("icon-rotation-alignment")==="map"&&he!=="point",Lt=wt/2;var ht;o.hasAnyIconTextFit===!1&&Q!=="none"&&(o.hasAnyIconTextFit=!0);const lt=e.properties?+e.properties[rn]:null,zt=lt&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(lt):65535,Zt=(At,gn,bn)=>{if(gn.x<0||gn.x>=qt||gn.y<0||gn.y>=qt)return;let hn=null;if(Qe){const{x:an,y:Qn,z:dn}=U.projectTilePoint(gn.x,gn.y,bn);hn={anchor:new Rp(an,Qn,dn,0,void 0),up:U.upVector(bn,gn.x,gn.y)}}(function(an,Qn,dn,kn,ei,yi,$i,ri,Qi,Ji,rs,Ae,we,yt,en,xt,ln,Rn,Cn,oi,qn,Sn,Ki,_r,Wn,ki,yr,lr,ms,Wr,Pr){const fr=an.addToLineVertexArray(Qn,kn);let er,ai,tr,Or,Zn,Gi,Xr,Es=0,Is=0,to=0,Kr=0,qs=-1,Cl=-1;const Zs={};let Xl=rd("");const ua=dn?dn.anchor:Qn,lu=lr!=="none";let Rl=0,Kl=0;if(Qi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Vo=Qi.layout.get("text-offset").evaluate(qn,{},Wn);Rl=Vo[0]*Bo,Kl=Vo[1]*Bo}else Rl=Qi.layout.get("text-radial-offset").evaluate(qn,{},Wn)*Bo,Kl=aT;if(an.allowVerticalPlacement&&ei.vertical){const Vo=ei.vertical;if(en)Gi=uT(Vo),ri&&(Xr=uT(ri));else{const Ga=Qi.layout.get("text-rotate").evaluate(qn,{},Wn)+90;tr=t1(Ji,ua,Qn,rs,Ae,we,Vo,yt,Ga,xt),ri&&(Or=t1(Ji,ua,Qn,rs,Ae,we,ri,Rn,Ga,null,Pr))}}if(yi){const Vo=an.iconSizeData,Ga=Qi.layout.get("icon-rotate").evaluate(qn,{},Wn),hf=oT(yi,Ga,Ki,lu,Sn.iconScaleFactor),Wm=ri?oT(ri,Ga,Ki,lu,Sn.iconScaleFactor):void 0;ai=t1(Ji,ua,Qn,rs,Ae,we,yi,Rn,Ga,null,Wr);const Ky=(function(ff,y1,Yy,D5,rI,sI,P5,O5){const oI=ff.layers[0],aI=oI.appearances;let Qy=y1.length;if(Yy&&(Qy=Math.max(Qy,Yy.length)),aI.length===0)return Qy;const[z5,L5]=D5.get("icon-size-scale-range"),N5=se(1,z5,L5);for(const lI of aI){const cI=lI.getUnevaluatedProperties();if(cI._values["icon-image"].value!==void 0){const uI=oI.getAppearanceValueAndResolveTokens(lI,"icon-image",rI,sI,[]);if(uI){const dI=ff.getResolvedImageFromTokens(uI);if(dI){const hI=cI._values["icon-size"],k5=kv(dI,By(ff.zoom,hI,ff.worldview),hI,sI,ff.zoom,rI,ff.pixelRatio,N5,ff.worldview),j5=P5.get(k5.iconPrimary.toString());Qy=Math.max(Qy,l4(j5,O5))}}}}return Qy})(an,hf,Wm,Qi.layout,qn,Wn,an.iconAtlasPositions,lu);Es=4*Ky;let Xm=null;Vo.kind==="source"?(Xm=[Jd*Qi.layout.get("icon-size").evaluate(qn,{},Wn)*Sn.iconScaleFactor],Xm[0]>Mp&&Tn(`${an.layerIds[0]}: Value for "icon-size" is >= ${jv}. Reduce your "icon-size".`)):Vo.kind==="composite"&&(Xm=[Jd*Sn.compositeIconSizes[0].evaluate(qn,{},Wn)*Sn.iconScaleFactor,Jd*Sn.compositeIconSizes[1].evaluate(qn,{},Wn)*Sn.iconScaleFactor],(Xm[0]>Mp||Xm[1]>Mp)&&Tn(`${an.layerIds[0]}: Value for "icon-size" is >= ${jv}. Reduce your "icon-size".`)),an.addSymbols(an.icon,hf,Xm,oi,Cn,qn,void 0,dn,Qn,fr.lineStartIndex,fr.lineLength,-1,_r,Wn,ki,yr,an.symbolInstances.length,Ky),qs=an.icon.placedSymbolArray.length-1,Wm&&(Is=4*Ky,an.addSymbols(an.icon,Wm,Xm,oi,Cn,qn,Wl.vertical,dn,Qn,fr.lineStartIndex,fr.lineLength,-1,_r,Wn,ki,yr,an.symbolInstances.length,Ky),Cl=an.icon.placedSymbolArray.length-1)}for(const Vo in ei.horizontal){const Ga=Vo,hf=ei.horizontal[Ga];er||(Xl=rd(hf.text),en?Zn=uT(hf):er=t1(Ji,ua,Qn,rs,Ae,we,hf,yt,Qi.layout.get("text-rotate").evaluate(qn,{},Wn),xt));const Wm=hf.positionedLines.length===1;if(to+=BR(an,dn,Qn,hf,$i,Qi,en,qn,xt,fr,ei.vertical?Wl.horizontal:Wl.horizontalOnly,Wm?h4(ei.horizontal):[Ga],Zs,qs,Sn,_r,Wn,an.symbolInstances.length,ki),Wm)break}ei.vertical&&(Kr+=BR(an,dn,Qn,ei.vertical,$i,Qi,en,qn,xt,fr,Wl.vertical,["vertical"],Zs,Cl,Sn,_r,Wn,an.symbolInstances.length,ki));let da=-1;const Yl=(Vo,Ga)=>Vo?Math.max(Vo,Ga):Ga;da=Yl(Zn,da),da=Yl(Gi,da),da=Yl(Xr,da);const cu=da>-1?1:0;an.glyphOffsetArray.length>=65535&&Tn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qn.sortKey!==void 0&&an.addToSortKeyRanges(an.symbolInstances.length,qn.sortKey),an.symbolInstances.emplaceBack(Qn.x,Qn.y,ua.x,ua.y,ua.z,Zs.right>=0?Zs.right:-1,Zs.center>=0?Zs.center:-1,Zs.left>=0?Zs.left:-1,Zs.vertical>=0?Zs.vertical:-1,qs,Cl,Xl,er!==void 0?er:an.collisionBoxArray.length,er!==void 0?er+1:an.collisionBoxArray.length,tr!==void 0?tr:an.collisionBoxArray.length,tr!==void 0?tr+1:an.collisionBoxArray.length,ai!==void 0?ai:an.collisionBoxArray.length,ai!==void 0?ai+1:an.collisionBoxArray.length,Or||an.collisionBoxArray.length,Or?Or+1:an.collisionBoxArray.length,rs,to,Kr,Es,Is,cu,0,Rl,Kl,da,0,lu?1:0,ms)})(o,gn,hn,At,r,l,m,h,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Dt,ce,R,0,Xt,Tt,te,e,_,P,L,N,$,X,Q,zt,me,Ie)};if(he==="line")for(const At of Yd(e.geometry,0,0,qt,qt)){const gn=a4(At,wt,Nt,r.vertical||ft,l,Be,mt,o.overscaling,qt);for(const bn of gn)ft&&x4(o,ft.text,Lt,bn)||Zt(At,bn,N)}else if(he==="line-center"){for(const At of e.geometry)if(At.length>1){const gn=o4(At,Nt,r.vertical||ft,l,Be,mt);gn&&Zt(At,gn,N)}}else if(e.type==="Polygon")for(const At of Sp(e.geometry,0)){const gn=u4(At,16);Zt(At[0],new Rp(gn.x,gn.y,0,0,void 0),N)}else if(e.type==="LineString")for(const At of e.geometry)Zt(At,new Rp(At[0].x,At[0].y,0,0,void 0),N);else if(e.type==="Point")for(const At of e.geometry)for(const gn of At)Zt([gn],new Rp(gn.x,gn.y,0,0,void 0),N)}const jv=255,Mp=jv*Jd;function BR(o,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce){const he=(function(Ee,Ne,Be,Ue,ft,Qe,mt,wt){const Dt=[];if(Ne.positionedLines.length===0)return Dt;const Xt=Ue.layout.get("text-rotate").evaluate(Qe,{})*Math.PI/180,Nt=(function(zt){const Zt=zt[0],At=zt[1],gn=Zt*At;return gn>0?[Zt,-At]:gn<0?[-Zt,At]:Zt===0?[At,Zt]:[At,-Zt]})(Be);let Tt=Math.abs(Ne.top-Ne.bottom);for(const zt of Ne.positionedLines)Tt-=zt.lineOffset;const Lt=Ne.positionedLines.length,ht=Tt/Lt;let lt=Ne.top-Be[1];for(let zt=0;zt<Lt;++zt){const Zt=Ne.positionedLines[zt];lt=c4(Ne,ht,lt,zt);for(const At of Zt.positionedGlyphs){if(!At.rect)continue;const gn=At.rect||{};let bn=pR+1,hn=!0,an=1,Qn=0;if(At.image){const Cn=mt.get(At.image.toString());if(!Cn)continue;if(Cn.sdf){Tn("SDF images are not supported in formatted text and will be ignored.");continue}hn=!1,an=Cn.pixelRatio,bn=y_/an}const dn=(ft||wt)&&At.vertical,kn=At.metrics.advance*At.scale/2,ei=At.metrics,yi=At.rect;if(yi===null)continue;wt&&Ne.verticalizable&&(Qn=At.image?kn-At.metrics.width*At.scale/2:0);const $i=ft?[At.x+kn,At.y]:[0,0];let ri=[0,0],Qi=[0,0],Ji=!1;ft||(dn?(Qi=[At.x+kn+Nt[0],At.y+Nt[1]-Qn],Ji=!0):ri=[At.x+kn+Be[0],At.y+Be[1]-Qn]);const rs=yi.w*At.scale/(an*(At.localGlyph?eh:1)),Ae=yi.h*At.scale/(an*(At.localGlyph?eh:1));let we,yt,en,xt;if(dn){const Cn=At.y-lt,oi=new Ct(-kn,kn-Cn),qn=-Math.PI/2,Sn=new Ct(...Qi);we=new Ct(-kn+ri[0],ri[1]),we._rotateAround(qn,oi)._add(Sn),we.x+=-Cn+kn,we.y-=(ei.left-bn)*At.scale;const Ki=At.image?ei.advance*At.scale:Bo*At.scale,_r=String.fromCodePoint(At.glyph);GB(_r)?we.x+=(1-bn)*At.scale:HB(_r)?we.x+=Ki-ei.height*At.scale+(-bn-1)*At.scale:we.x+=At.image||ei.width+2*bn===yi.w&&ei.height+2*bn===yi.h?(Ki-Ae)/2:(Ki-(ei.height+2*bn)*At.scale)/2,yt=new Ct(we.x,we.y-rs),en=new Ct(we.x+Ae,we.y),xt=new Ct(we.x+Ae,we.y-rs)}else{const Cn=(ei.left-bn)*At.scale-kn+ri[0],oi=(-ei.top-bn)*At.scale+ri[1],qn=Cn+rs,Sn=oi+Ae;we=new Ct(Cn,oi),yt=new Ct(qn,oi),en=new Ct(Cn,Sn),xt=new Ct(qn,Sn)}if(Xt){let Cn;Cn=ft?new Ct(0,0):Ji?new Ct(Nt[0],Nt[1]):new Ct(Be[0],Be[1]),we._rotateAround(Xt,Cn),yt._rotateAround(Xt,Cn),en._rotateAround(Xt,Cn),xt._rotateAround(Xt,Cn)}const ln=new Ct(0,0),Rn=new Ct(0,0);Dt.push({tl:we,tr:yt,bl:en,br:xt,texPrimary:gn,texSecondary:void 0,writingMode:Ne.writingMode,glyphOffset:$i,sectionIndex:At.sectionIndex,isSDF:hn,pixelOffsetTL:ln,pixelOffsetBR:Rn,minFontScaleX:0,minFontScaleY:0})}}return Dt})(0,l,A,m,_,v,h,o.allowVerticalPlacement),me=o.textSizeData;let Ie=null;me.kind==="source"?(Ie=[Jd*m.layout.get("text-size").evaluate(v,{},Q)*$.textScaleFactor],Ie[0]>Mp&&Tn(`${o.layerIds[0]}: Value for "text-size" is >= ${jv}. Reduce your "text-size".`)):me.kind==="composite"&&(Ie=[Jd*$.compositeTextSizes[0].evaluate(v,{},Q)*$.textScaleFactor,Jd*$.compositeTextSizes[1].evaluate(v,{},Q)*$.textScaleFactor],(Ie[0]>Mp||Ie[1]>Mp)&&Tn(`${o.layerIds[0]}: Value for "text-size" is >= ${jv}. Reduce your "text-size".`)),o.addSymbols(o.text,he,Ie,A,_,v,P,e,r,R.lineStartIndex,R.lineLength,U,X,Q,ce,!1,te,he.length);for(const Ee of L)N[Ee]=o.text.placedSymbolArray.length-1;return 4*he.length}function cT(o){for(const e in o)return o[e];return null}function t1(o,e,r,l,h,m,_,v,A,R,P){let L,N,U,$;if(L=P?P.top:_.top,N=P?P.bottom:_.bottom,U=P?P.left:_.left,$=P?P.right:_.right,vR(_)&&_.collisionPadding){const X=_.collisionPadding;U-=X[0],L-=X[1],$+=X[2],N+=X[3]}if(A){const X=new Ct(U,L),Q=new Ct($,L),te=new Ct(U,N),ce=new Ct($,N),he=fi(A);let me=new Ct(0,0);R&&(me=new Ct(R[0],R[1])),X._rotateAround(he,me),Q._rotateAround(he,me),te._rotateAround(he,me),ce._rotateAround(he,me),U=Math.min(X.x,Q.x,te.x,ce.x),$=Math.max(X.x,Q.x,te.x,ce.x),L=Math.min(X.y,Q.y,te.y,ce.y),N=Math.max(X.y,Q.y,te.y,ce.y)}return o.emplaceBack(e.x,e.y,e.z,r.x,r.y,U,L,$,N,v,l,h,m),o.length-1}function uT(o){vR(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function x4(o,e,r,l){const h=o.compareText;if(e in h){const m=h[e];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<r)return!0}else h[e]=[];return h[e].push(l),!1}function VR(o,e){const r=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,h=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),m=Math.sin(r)*h/Math.sin(Math.max(Math.PI/2-o._pitch-r,.01));let _=Math.sin(o._pitch)*m+h;const v=h*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let A=Math.max(o.zoom-17,0);o.isOrthographic&&(A/=10),_*=1+A}return Math.min(1.01*_,v)}function Fv(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const r=Math.pow(2,-o.z),l=o.x*r,h=(o.x+1)*r,m=o.y*r,_=(o.y+1)*r,v=ye(l),A=ye(h),R=fe(m),P=fe(_),L=e.project(v,R),N=e.project(A,R),U=e.project(A,P),$=e.project(v,P);let X=Math.min(L.x,N.x,U.x,$.x),Q=Math.min(L.y,N.y,U.y,$.y),te=Math.max(L.x,N.x,U.x,$.x),ce=Math.max(L.y,N.y,U.y,$.y);const he=r/16;function me(Ee,Ne,Be,Ue,ft,Qe){const mt=(Be+ft)/2,wt=(Ue+Qe)/2,Dt=e.project(ye(mt),fe(wt)),Xt=Math.max(0,X-Dt.x,Q-Dt.y,Dt.x-te,Dt.y-ce);X=Math.min(X,Dt.x),te=Math.max(te,Dt.x),Q=Math.min(Q,Dt.y),ce=Math.max(ce,Dt.y),Xt>he&&(me(Ee,Dt,Be,Ue,mt,wt),me(Dt,Ne,mt,wt,ft,Qe))}me(L,N,l,m,h,m),me(N,U,h,m,h,_),me(U,$,h,_,l,_),me($,L,l,_,l,m),X-=he,Q-=he,te+=he,ce+=he;const Ie=1/Math.max(te-X,ce-Q);return{scale:Ie,x:X*Ie,y:Q*Ie,x2:te*Ie,y2:ce*Ie,projection:e}}function UR(o,{x:e,y:r},l=0){return new Ct(((e-l)*o.scale-o.x)*qt,(r*o.scale-o.y)*qt)}const v4=le(new Float32Array(16));class qm{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new G(0,0)}projectTilePoint(e,r,l){return{x:e,y:r,z:0}}locationPoint(e,r,l,h=!0){return e._coordinatePoint(e.locationCoordinate(r,l),h)}pixelsPerMeter(e,r){return ue(1,e)*r}pixelSpaceConversion(e,r,l){return 1}farthestPixelDistance(e){return VR(e,e.pixelsPerMeter)}pointCoordinate(e,r,l,h){const m=e.horizonLineFromTop(!1),_=new Ct(r,Math.max(m,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,h))}pointCoordinate3D(e,r,l){const h=new Ct(r,l);if(e.elevation)return e.elevation.pointCoordinate(h);{const m=this.pointCoordinate(e,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const l=e.horizonLineFromTop();return r.y<l}createInversionMatrix(e,r){return v4}createTileMatrix(e,r,l){let h,m,_;const v=l.canonical,A=le(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=Fv(v,this);h=1,m=R.x+l.wrap*R.scale,_=R.y,Re(A,A,[h/R.scale,h/R.scale,e.pixelsPerMeter/r])}else h=r/e.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*l.wrap)*h,_=v.y*h;return _e(A,A,[m,_,0]),Re(A,A,[h/qt,h/qt,1]),A}upVector(e,r,l){return[0,0,1]}upVectorScale(e,r,l){return{metersToTile:1}}}class b4 extends qm{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,l]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(fi(r));this.n=(h+Math.sin(fi(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:l,c:h,r0:m}=this,_=fi(e-this.center[0]),v=fi(r),A=Math.sqrt(h-2*l*Math.sin(v))/l;return{x:A*Math.sin(_*l),y:A*Math.cos(_*l)-m,z:0}}unproject(e,r){const{n:l,c:h,r0:m}=this,_=m+r;let v=Math.atan2(e,Math.abs(_))*Math.sign(_);_*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(_));const A=fi(this.center[0])*l;v=je(v,-Math.PI-A,Math.PI-A);const R=se(Ds(v/l)+this.center[0],-180,180),P=Math.asin(se((h-(e*e+_*_)*l*l)/(2*l),-1,1)),L=se(Ds(P),-be,be);return new G(R,L)}}const Bv=1.340264,Vv=-.081106,Uv=893e-6,$v=.003796,n1=Math.sqrt(3)/2;class w4 extends qm{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(n1*Math.sin(r)),h=l*l,m=h*h*h;return{x:.5*(e*Math.cos(l)/(n1*(Bv+3*Vv*h+m*(7*Uv+9*$v*h)))/Math.PI+.5),y:1-.5*(l*(Bv+Vv*h+m*(Uv+$v*h))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,h=l*l,m=h*h*h;for(let P,L,N,U=0;U<12&&(L=l*(Bv+Vv*h+m*(Uv+$v*h))-r,N=Bv+3*Vv*h+m*(7*Uv+9*$v*h),P=L/N,l=se(l-P,-Math.PI/3,Math.PI/3),h=l*l,m=h*h*h,!(Math.abs(P)<1e-12));++U);const _=n1*e*(Bv+3*Vv*h+m*(7*Uv+9*$v*h))/Math.cos(l),v=Math.asin(Math.sin(l)/n1),A=se(180*_/Math.PI,-180,180),R=se(180*v/Math.PI,-be,be);return new G(A,R)}}class S4 extends qm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const l=360*(e-.5),h=se(360*(.5-r),-be,be);return new G(l,h)}}const Gy=Math.PI/2;function i1(o){return Math.tan((Gy+o)/2)}class T4 extends qm{constructor(e){super(e),this.center=e.center||[0,30];const[r,l]=this.parallels=e.parallels||[30,30];let h=fi(r),m=fi(l);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const _=Math.cos(h),v=i1(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(i1(m)/v),this.f=_*Math.pow(i1(h),this.n)/this.n}project(e,r){r=fi(r),this.southernCenter&&(r=-r),e=fi(e-this.center[0]);const l=1e-6,{n:h,f:m}=this;m>0?r<-Gy+l&&(r=-Gy+l):r>Gy-l&&(r=Gy-l);const _=m/Math.pow(i1(r),h);let v=_*Math.sin(h*e),A=m-_*Math.cos(h*e);return v=.5*(v/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:v,y:this.southernCenter?A:1-A,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:l,f:h}=this,m=h-r,_=Math.sign(m),v=Math.sign(l)*Math.sqrt(e*e+m*m);let A=Math.atan2(e,Math.abs(m))*_;m*l<0&&(A-=Math.PI*Math.sign(e)*_);const R=se(Ds(A/l)+this.center[0],-180,180),P=se(Ds(2*Math.atan(Math.pow(h/v,1/l))-Gy),-be,be);return new G(R,this.southernCenter?-P:P)}}class $R extends qm{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:ae(e),y:re(r),z:0}}unproject(e,r){const l=ye(e),h=fe(r);return new G(l,h)}}const GR=fi(be);class E4 extends qm{project(e,r){const l=(r=fi(r))*r,h=l*l;return{x:.5*((e=fi(e))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,h=25,m=0,_=l*l;do{_=l*l;const R=_*_;m=(l*(1.007226+_*(.015085+R*(.028874*_-.044475-.005916*R)))-r)/(1.007226+_*(.045255+R*(.259866*_-.311325-.005916*11*R))),l=se(l-m,-GR,GR)}while(Math.abs(m)>1e-6&&--h>0);_=l*l;const v=se(Ds(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),A=Ds(l);return new G(v,A)}}const HR=fi(be);class A4 extends qm{project(e,r){r=fi(r),e=fi(e);const l=Math.cos(r),h=2/Math.PI,m=Math.acos(l*Math.cos(e/2)),_=Math.sin(m)/m,v=.5*(e*h+2*l*Math.sin(e/2)/_)||0,A=.5*(r+Math.sin(r)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(e,r){let l=e=(2*e-.5)*Math.PI,h=r=(2*(1-r)-1)*Math.PI,m=25;const _=1e-6;let v=0,A=0;do{const R=Math.cos(h),P=Math.sin(h),L=2*P*R,N=P*P,U=R*R,$=Math.cos(l/2),X=Math.sin(l/2),Q=2*$*X,te=X*X,ce=1-U*$*$,he=ce?1/ce:0,me=ce?Math.acos(R*$)*Math.sqrt(1/ce):0,Ie=.5*(2*me*R*X+2*l/Math.PI)-e,Ee=.5*(me*P+h)-r,Ne=.5*he*(U*te+me*R*$*N)+1/Math.PI,Be=he*(Q*L/4-me*P*X),Ue=.125*he*(L*X-me*P*U*Q),ft=.5*he*(N*$+me*te*R)+.5,Qe=Be*Ue-ft*Ne;v=(Ee*Be-Ie*ft)/Qe,A=(Ie*Ue-Ee*Ne)/Qe,l=se(l-v,-Math.PI,Math.PI),h=se(h-A,-HR,HR)}while((Math.abs(v)>_||Math.abs(A)>_)&&--m>0);return new G(Ds(l),Ds(h))}}class qR extends qm{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:l,cosPhi:h}=this;return{x:fi(e)*h*l+.5,y:-Math.sin(fi(r))/h*l+.5,z:0}}unproject(e,r){const{scale:l,cosPhi:h}=this,m=-(r-.5)/l,_=se(Ds((e-.5)/l)/h,-180,180),v=Math.asin(se(m*h,-1,1)),A=se(Ds(v),-be,be);return new G(_,A)}}class C4 extends $R{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,l){const h=Xg(e,r,l);return Ri(h,h,$d(ru(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,r,l){const h=D(r.lat,r.lng),m=An([],h),_=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Kt(h,h,m,ue(1,0)*qt*_);const v=le(new Float64Array(16));return pe(v,e.pixelMatrix,e.globeMatrix),Ri(h,h,v),new Ct(h[0],h[1])}pixelsPerMeter(e,r){return ue(1,0)*r}pixelSpaceConversion(e,r,l){const h=ue(1,e)*r,m=Gn(ue(1,45)*r,h,l);return this.pixelsPerMeter(e,r)/m}createTileMatrix(e,r,l){const h=Yg(ru(l.canonical));return pe(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,r){const{center:l}=e,h=$d(ru(r));return Ze(h,h,fi(l.lng)),xe(h,h,fi(l.lat)),Re(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,r,l,h){return ev(e,r,l,!0)||new Xe(0,0)}pointCoordinate3D(e,r,l){const h=this.pointCoordinate(e,r,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,r){return!ev(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=(function(h,m){const _=h.cameraToCenterDistance,v=h._centerAltitude*m,A=h._camera,R=h._camera.forward(),P=Fe([],vt([],R,-_),[0,0,v]),L=h.worldSize/(2*Math.PI),N=[0,0,-L],U=h.width/h.height,$=Math.tan(h.fovAboveCenter),X=vt([],A.up(),$),Q=vt([],A.right(),$*U),te=An([],Fe([],Fe([],R,X),Q)),ce=[];let he;if(new Xn(P,te).closestPointOnSphere(N,L,ce)){const me=Fe([],ce,N),Ie=ti([],me,P);he=Math.cos(h.fovAboveCenter)*on(Ie)}else{const me=ti([],P,N),Ie=ti([],N,P);An(Ie,Ie);const Ee=on(me)-L;he=Math.sqrt(Ee*(Ee+2*L));const Ne=Math.acos(he/(L+Ee))-Math.acos(In(R,Ie));he*=Math.cos(Ne)}return 1.01*he})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=wa(e.zoom);if(l>0){const h=VR(e,ue(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Gn(r,h+m*(1-Math.cos(_)),Math.pow(l,10))}return r}upVector(e,r,l){return Xg(r,l,e,1)}upVectorScale(e){return{metersToTile:Zg(xy(ru(e)))}}}function ZR(o){const e=o.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new $R(o);case"equirectangular":return new S4(o);case"naturalEarth":return new E4(o);case"equalEarth":return new w4(o);case"winkelTripel":return new A4(o);case"albers":return r?new qR(o):new b4(o);case"lambertConformalConic":return r?new qR(o):new T4(o);case"globe":return new C4(o)}throw new Error(`Invalid projection name: ${o.name}`)}const R4=Pt.types,M4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gv(o,e,r,l,h,m,_,v,A,R,P,L,N){const U=v?Math.min(Mp,Math.round(v[0])):0,$=v?Math.min(Mp,Math.round(v[1])):0;o.emplaceBack(e,r,Math.round(32*l),Math.round(32*h),m,_,(U<<1)+(A?1:0),0+($<<1),16*R,16*P,256*L,256*N)}function Hv(o,e,r){o.emplaceBack(e,r)}function qv(o,e,r,l,h,m,_){o.emplaceBack(e,r,l,h,m,_)}const r1=(o,e,r,l)=>{for(let h=0;h<e;h++)o.emplaceBack(r[0],r[1],r[2],l[0],l[1],l[2])};function Hy(o,e,r,l,h){o.emplaceBack(e,r,l,h),o.emplaceBack(e,r,l,h),o.emplaceBack(e,r,l,h),o.emplaceBack(e,r,l,h)}function I4(o){for(const e of o.sections)if(ly(e.text))return!0;return!1}class dT{constructor(e){this.layoutVertexArray=new Ld,this.indexArray=new kr,this.programConfigurations=e,this.segments=new Br,this.dynamicLayoutVertexArray=new nu,this.opacityVertexArray=new kd,this.placedSymbolArray=new Qh,this.iconTransitioningVertexArray=new rl,this.globeExtVertexArray=new Nd,this.zOffsetVertexArray=new Ac,this.orientationVertexArray=new fm,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,r){const l=[],h=this.layoutVertexArray.uint16;for(let m=0;m<r;++m){const _=12*(e+m);l.push(...h.slice(_,_+12))}return l}updateIconVertexData(e,r,l,h,m,_,v,A,R,P,L,N,U){const $=this.layoutVertexArray.uint16,X=12*e;$[X]=r,$[X+1]=l,$[X+2]=h,$[X+3]=m,$[X+4]=_,$[X+5]=v,$[X+6]=A,$[X+7]=R,$[X+8]=P,$[X+9]=L,$[X+10]=N,$[X+11]=U}upload(e,r,l,h,m,_){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zB.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,NB.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,M4,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,FB.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,LB.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,kB.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,jB.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}jt(dT,"SymbolBuffers");class hT{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new Br,this.collisionVertexArray=new Lu,this.collisionVertexArrayExt=new nu}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,BB.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,VB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt(hT,"CollisionBuffers");class s1{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=le([]),this.placementViewportMatrix=le([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=By(this.zoom,r["text-size"],this.worldview),this.iconSizeData=By(this.zoom,r["icon-size"],this.worldview);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.lut=e.lut,this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map((_=>Wl[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const r=this.layers[0].getAppearances();return!(!r||r.length===0)&&r.some((l=>l.getProperty(e)!=null))}createArrays(){this.text=new dT(new Tl(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new dT(new Tl(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new Jh,this.lineVertexArray=new Ng,this.symbolInstances=new Lg}calculateGlyphDependencies(e,r,l,h,m){for(const _ of e){const v=_.codePointAt(0);if(v===void 0)break;if(r[v]=!0,h&&m&&v<=65535){const A=Ov[_];A&&(r[A.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,r,l,h,m,_){let v=1;const A=e.getUnevaluatedProperties()._values["icon-size"],R=By(this.zoom,A,this.worldview),P=Vy(R,r);if(R.kind!=="constant"&&R.kind!=="camera"||(v=P.uSize),R.kind==="composite"){const{minZoom:L,maxZoom:N}=R,U=A.possiblyEvaluate(new ir(L,{worldview:this.worldview}),h),$=A.possiblyEvaluate(new ir(N,{worldview:this.worldview}),h),X=U.evaluate(l,{},h,m);v=X+($.evaluate(l,{},h,m)-X)*P.uSizeT}return R.kind==="source"&&(v=A.possiblyEvaluate(new ir(this.zoom,{worldview:this.worldview}),h).evaluate(l,{},h,m)),v*_}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!o_(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?uo.build(e):e}populate(e,r,l,h){const m=this.layers[0],_=m.layout,v=this.projection.name==="globe",A=_.get("text-font"),R=_.get("text-field"),P=_.get("icon-image"),[L,N]=_.get("icon-size-scale-range"),U=se(r.scaleFactor||1,L,N),$=(R.value.kind!=="constant"||R.value.value instanceof Ks&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),X=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Q=this.hasAnyAppearanceProperty("icon-image"),te=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!$&&!X&&!Q)return;const ce=r.iconDependencies,he=r.glyphDependencies,me=r.availableImages,Ie=new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),Ee=Ne=>{const Be=Ne.id.toString();ce.has(Be)?ce.get(Be).push(Ne):ce.set(Be,[Ne])};for(const Ne of e){const{feature:Be,id:Ue,index:ft,sourceLayerIndex:Qe}=Ne,mt=m._featureFilter.needGeometry,wt=rt(Be,mt);if(!m._featureFilter.filter(Ie,wt,l))continue;if(mt||(wt.geometry=_t(Be,l,h)),v&&Be.type!==1&&l.z<=5){const zt=wt.geometry,Zt=.98078528056,At=(gn,bn)=>In(Xg(gn.x,gn.y,l,1),Xg(bn.x,bn.y,l,1))<Zt;for(let gn=0;gn<zt.length;gn++)zt[gn]=gt(zt[gn],At)}let Dt,Xt;if($){const zt=m.getValueAndResolveTokens("text-field",wt,l,me),Zt=Ks.factory(zt);I4(Zt)&&(this.hasRTLText=!0),(!this.hasRTLText||Cd()==="unavailable"||this.hasRTLText&&la.isParsed())&&(Dt=$B(Zt,m,wt))}if(X){const zt=m.getValueAndResolveTokens("icon-image",wt,l,me);Xt=this.getResolvedImageFromTokens(zt)}const Nt=this.layers[0];let Tt=!1;if(!Xt&&Q){const zt=Nt.getAppearances();for(const Zt of zt)if(Zt.getProperty("icon-image")){const At=Nt.getAppearanceValueAndResolveTokens(Zt,"icon-image",wt,l,me);if(At){Xt=this.getResolvedImageFromTokens(At),Tt=!0;break}}}if(!Dt&&!Xt)continue;const Lt=this.sortFeaturesByKey?te.evaluate(wt,{},l):void 0,ht={id:Ue,text:Dt,icon:Xt,index:ft,sourceLayerIndex:Qe,geometry:wt.geometry,properties:Be.properties,type:R4[Be.type],sortKey:Lt};if(this.features.push(ht),this.appearanceFeatureData.push({id:Ue,properties:Be.properties,usesAppearanceIconAsPlaceholder:Tt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Xt){const zt=Nt._unevaluatedLayout._values,{iconPrimary:Zt,iconSecondary:At}=kv(Xt,this.iconSizeData,zt["icon-size"],l,this.zoom,ht,this.pixelRatio,U,this.worldview);Ee(Zt),At&&(this.hasAnySecondaryIcon=!0,Ee(At))}const lt=Nt.getAppearances();if(lt.length!==0&&lt.forEach((zt=>{if(!zt.getProperty("icon-image"))return;const Zt=this.getCombinedIconPrimary(zt,Nt,wt,l,me,ht,U);Zt&&Ee(Zt)})),Dt){const zt=A.evaluate(wt,{},l).join(","),Zt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wl.vertical)>=0;for(const At of Dt.sections)if(At.image){const gn=At.image.getPrimary().scaleSelf(this.pixelRatio),bn=gn.id.toString(),hn=ce.get(bn)||[];hn.push(gn),ce.set(bn,hn)}else{const gn=Hh(Dt.toString()),bn=At.fontStack||zt,hn=he[bn]=he[bn]||{};this.calculateGlyphDependencies(At.text,hn,Zt,this.allowVerticalPlacement,gn)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ne){const Be={},Ue={},ft=[];let Qe=0;function mt(Nt){ft.push(Ne[Nt]),Qe++}function wt(Nt,Tt,Lt){const ht=Ue[Nt];return delete Ue[Nt],Ue[Tt]=ht,ft[ht].geometry[0].pop(),ft[ht].geometry[0]=ft[ht].geometry[0].concat(Lt[0]),ht}function Dt(Nt,Tt,Lt){const ht=Be[Tt];return delete Be[Tt],Be[Nt]=ht,ft[ht].geometry[0].shift(),ft[ht].geometry[0]=Lt[0].concat(ft[ht].geometry[0]),ht}function Xt(Nt,Tt,Lt){const ht=Lt?Tt[0][Tt[0].length-1]:Tt[0][0];return`${Nt}:${ht.x}:${ht.y}`}for(let Nt=0;Nt<Ne.length;Nt++){const Tt=Ne[Nt],Lt=Tt.geometry,ht=Tt.text?Tt.text.toString():null;if(!ht){mt(Nt);continue}const lt=Xt(ht,Lt),zt=Xt(ht,Lt,!0);if(lt in Ue&&zt in Be&&Ue[lt]!==Be[zt]){const Zt=Dt(lt,zt,Lt),At=wt(lt,zt,ft[Zt].geometry);delete Be[lt],delete Ue[zt],Ue[Xt(ht,ft[At].geometry,!0)]=At,ft[Zt].geometry=null}else lt in Ue?wt(lt,zt,Lt):zt in Be?Dt(lt,zt,Lt):(mt(Nt),Be[lt]=Qe-1,Ue[zt]=Qe-1)}return ft.filter((Nt=>Nt.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ne of r.elevationFeatures)this.elevationFeatureIdToIndex.set(Ne.id,this.elevationFeatures.length),this.elevationFeatures.push(Ne)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ne,Be)=>Ne.sortKey-Be.sortKey))}getCombinedIconPrimary(e,r,l,h,m,_,v){let A,R;const P=e.getUnevaluatedProperties();if(P._values["icon-image"].value!==void 0){const L=r.getAppearanceValueAndResolveTokens(e,"icon-image",l,h,m);A=this.getResolvedImageFromTokens(L)}else{const L=r.getValueAndResolveTokens("icon-image",l,h,m);A=this.getResolvedImageFromTokens(L)}if(A){const L=P._values["icon-size"]||r._unevaluatedLayout._values["icon-size"];R=kv(A,By(this.zoom,L,this.worldview),L,h,this.zoom,_,this.pixelRatio,v,this.worldview).iconPrimary}return R}updateAppearanceBasedIconTextures(e,r,l,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const m=this.layers[0];let _=!1,v=0;const A=m.layout,[R,P]=A.get("icon-size-scale-range"),L=se(1,R,P);for(let N=0;N<this.symbolInstances.length;N++){const U=this.symbolInstances.get(N),$=this.appearanceFeatureData[U.featureIndex];if($&&U.placedIconSymbolIndex>=0){const X=$.id,Q=r&&X!==void 0?r[String(X)]:void 0,te={type:"Point",id:$.id,properties:$.properties,geometry:[]},ce=this.layers[0].appearances&&this.layers[0].appearances.find((he=>he.isActive({globals:h,feature:te,canonical:e,featureState:Q})));if($.activeAppearance===ce)continue;if(ce){$.activeAppearance=ce;const he={sortKey:void 0,text:void 0,icon:null,index:U.featureIndex,sourceLayerIndex:U.featureIndex,geometry:[],properties:$.properties,type:"Point",id:$.id};if(!ce.hasCachedIconPrimary()){const Ne=this.getCombinedIconPrimary(ce,m,te,e,l,he,L);ce.setCachedIconPrimary(Ne)}const me=ce.getCachedIconPrimary();if(!me)continue;const Ie=me.toString(),Ee=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ie);if(Ee){const Ne=m.getAppearanceValueAndResolveTokens(ce,"icon-offset",te,e,l),Be=Ne&&Array.isArray(Ne)?Ne:[0,0];let Ue=Xb(Ee,void 0,Be,m.layout.get("icon-anchor").evaluate(te,{},e));const ft=m.getAppearanceValueAndResolveTokens(ce,"icon-rotate",te,e,l),Qe=typeof ft=="number"?ft:0,mt=Ee.sdf,wt=m.layout.get("icon-text-fit").constantOr("none");wt!=="none"&&$.textShaping&&$.iconTextFitPadding&&$.fontScale&&(Ue=nT(Ue,$.textShaping,wt,$.iconTextFitPadding,Be,$.fontScale));const Dt=this.calculateEffectiveAppearanceIconSize(ce,h.zoom,te,e,l,L),Xt=0,Nt=1+(Math.min(Mp,Math.round(Dt*Jd))<<1),Tt=oT(Ue,Qe,mt,wt!=="none",L);$.isUsingAppearanceVertexData||($.isUsingAppearanceVertexData=!0,$.layoutBasedVertexData=this.icon.getIconVertexData(v,U.numIconVertices));for(let ht=0;ht<Tt.length;++ht){const lt=Tt[ht],zt=$.layoutBasedVertexData[0]||U.tileAnchorX,Zt=$.layoutBasedVertexData[1]||U.tileAnchorY,At=16*lt.pixelOffsetTL.x,gn=16*lt.pixelOffsetTL.y,bn=16*lt.pixelOffsetBR.x,hn=16*lt.pixelOffsetBR.y,an=16*lt.minFontScaleX,Qn=16*lt.minFontScaleY;this.icon.updateIconVertexData(v,zt,Zt,Math.round(32*lt.tl.x),Math.round(32*lt.tl.y),lt.texPrimary.x,lt.texPrimary.y,Xt,Nt,At,gn,an,Qn),this.icon.updateIconVertexData(v+1,zt,Zt,Math.round(32*lt.tr.x),Math.round(32*lt.tr.y),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y,Xt,Nt,bn,gn,an,Qn),this.icon.updateIconVertexData(v+2,zt,Zt,Math.round(32*lt.bl.x),Math.round(32*lt.bl.y),lt.texPrimary.x,lt.texPrimary.y+lt.texPrimary.h,Xt,Nt,At,hn,an,Qn),this.icon.updateIconVertexData(v+3,zt,Zt,Math.round(32*lt.br.x),Math.round(32*lt.br.y),lt.texPrimary.x+lt.texPrimary.w,lt.texPrimary.y+lt.texPrimary.h,Xt,Nt,bn,hn,an,Qn),v+=4}const Lt=U.numIconVertices-4*Tt.length;for(let ht=0;ht<Lt;++ht)this.icon.updateIconVertexData(v+ht,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else v+=U.numIconVertices}else if($.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),v+=U.numIconVertices,$.activeAppearance=null;else if($.isUsingAppearanceVertexData){const me=$.layoutBasedVertexData.length/12;for(let Ie=0;Ie<me;++Ie){const Ee=Ie*12;this.icon.updateIconVertexData(v+Ie,$.layoutBasedVertexData[Ee+0],$.layoutBasedVertexData[Ee+1],$.layoutBasedVertexData[Ee+2],$.layoutBasedVertexData[Ee+3],$.layoutBasedVertexData[Ee+4],$.layoutBasedVertexData[Ee+5],$.layoutBasedVertexData[Ee+6],$.layoutBasedVertexData[Ee+7],$.layoutBasedVertexData[Ee+8],$.layoutBasedVertexData[Ee+9],$.layoutBasedVertexData[Ee+10],$.layoutBasedVertexData[Ee+11])}v+=me,$.isUsingAppearanceVertexData=!1,$.activeAppearance=null,_=!0}else v+=U.numIconVertices,$.activeAppearance=null}}return _}update(e,r,l,h,m,_,v){this.text.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,r,m,l,h,_,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const l=Pe(e),h=1/l;let m=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const A=this.symbolInstances.get(v),R=Ke(1,0,0),P=Ke(0,1,0),{numHorizontalGlyphVertices:L,numVerticalGlyphVertices:N,numIconVertices:U,numVerticalIconVertices:$}=A,X=L>0||N>0,Q=U>0,te=this.elevationFeatures[A.elevationFeatureIndex];if(te){const ce=new Ct(A.tileAnchorX,A.tileAnchorY),he=.075+te.pointElevation(ce);A.zOffset!==he&&(r=!0,A.zOffset=he),he!==0&&(this.hasAnyZOffset=!0);const me=te.computeSlopeNormal(ce,h),Ie=ta(Dn(),Ke(0,0,1),me);cs(R,R,Ie),cs(P,P,Ie),R[2]*=l,P[2]*=l,R[0]===1&&R[1]===0&&R[2]===0&&P[0]===0&&P[1]===1&&P[2]===0||(m=m||X,_=_||Q)}if(X&&(r1(this.text.orientationVertexArray,L,R,P),r1(this.text.orientationVertexArray,N,R,P)),Q){const{placedIconSymbolIndex:ce,verticalPlacedIconSymbolIndex:he}=A;ce>=0&&r1(this.icon.orientationVertexArray,U,R,P),he>=0&&r1(this.icon.orientationVertexArray,$,R,P)}}m||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,_,v)=>{l+=_,l>m.length&&m.resize(l);for(let A=-_;A<0;A++)m.emplace(A+l,v)},r=(m,_,v)=>{h+=_,h>m.length&&m.resize(h);for(let A=-_;A<0;A++)m.emplace(A+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:A,numIconVertices:R}=_,P=_.zOffset,L=R>0;if((v>0||A>0)&&(e(this.text.zOffsetVertexArray,v,P),e(this.text.zOffsetVertexArray,A,P)),L){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:U}=_;N>=0&&r(this.icon.zOffsetVertexArray,R,P),U>=0&&r(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,P)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,r,l,h,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,r,l,h){return!!(e&&r&&l)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,r,l,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ZR(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:m}of r)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,h,m,_,v,A,R,P,L,N,U,$,X,Q,te,ce){const he=e.indexArray,me=e.layoutVertexArray,Ie=e.globeExtVertexArray,Ee=e.segments.prepareSegment(4*ce,me,he,this.canOverlap?_.sortKey:void 0),Ne=this.glyphOffsetArray.length,Be=Ee.vertexLength,Ue=this.allowVerticalPlacement&&v===Wl.vertical?Math.PI/2:0,ft=_.text&&_.text.sections;for(let wt=0;wt<r.length;wt++){const{tl:Dt,tr:Xt,bl:Nt,br:Tt,texPrimary:Lt,texSecondary:ht,pixelOffsetTL:lt,pixelOffsetBR:zt,minFontScaleX:Zt,minFontScaleY:At,glyphOffset:gn,isSDF:bn,sectionIndex:hn}=r[wt],an=Ee.vertexLength,Qn=gn[1];if(Gv(me,R.x,R.y,Dt.x,Qn+Dt.y,Lt.x,Lt.y,l,bn,lt.x,lt.y,Zt,At),Gv(me,R.x,R.y,Xt.x,Qn+Xt.y,Lt.x+Lt.w,Lt.y,l,bn,zt.x,lt.y,Zt,At),Gv(me,R.x,R.y,Nt.x,Qn+Nt.y,Lt.x,Lt.y+Lt.h,l,bn,lt.x,zt.y,Zt,At),Gv(me,R.x,R.y,Tt.x,Qn+Tt.y,Lt.x+Lt.w,Lt.y+Lt.h,l,bn,zt.x,zt.y,Zt,At),A){const{x:dn,y:kn,z:ei}=A.anchor,[yi,$i,ri]=A.up;qv(Ie,dn,kn,ei,yi,$i,ri),qv(Ie,dn,kn,ei,yi,$i,ri),qv(Ie,dn,kn,ei,yi,$i,ri),qv(Ie,dn,kn,ei,yi,$i,ri),Hy(e.dynamicLayoutVertexArray,dn,kn,ei,Ue)}else Hy(e.dynamicLayoutVertexArray,R.x,R.y,R.z,Ue);if(Q){const dn=ht||Lt;Hv(e.iconTransitioningVertexArray,dn.x,dn.y),Hv(e.iconTransitioningVertexArray,dn.x+dn.w,dn.y),Hv(e.iconTransitioningVertexArray,dn.x,dn.y+dn.h),Hv(e.iconTransitioningVertexArray,dn.x+dn.w,dn.y+dn.h)}he.emplaceBack(an,an+1,an+2),he.emplaceBack(an+1,an+2,an+3),Ee.vertexLength+=4,Ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gn[0]),wt!==r.length-1&&hn===r[wt+1].sectionIndex||e.programConfigurations.populatePaintArrays(me.length,_,_.index,{},U,$,X,ft&&ft[hn],this.worldview)}const Qe=ce-r.length;Qe!==0&&this._addNullVertices(Qe,me,l,A,Ie,e,Q,Ee,he);const mt=A?A.anchor:R;e.placedSymbolArray.emplaceBack(mt.x,mt.y,mt.z,R.x,R.y,Ne,this.glyphOffsetArray.length-Ne,Be,P,L,R.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,0,0,N,0),e.symbolInstanceIndices.push(te)}_addNullVertices(e,r,l,h,m,_,v,A,R){for(let P=0;P<e;P++){for(let N=0;N<4;N++)Gv(r,0,0,0,0,0,0,l,!1,0,0,0,0),h&&qv(m,0,0,0,0,0,0),Hy(_.dynamicLayoutVertexArray,0,0,0,0),v&&Hv(_.iconTransitioningVertexArray,0,0);const L=A.vertexLength;R.emplaceBack(L,L+1,L+2),R.emplaceBack(L+1,L+2,L+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,r,l,h,m,_,v){e.emplaceBack(r,l,h,m,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,l,h,m,_,v){const A=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),R=A.vertexLength,P=v.tileAnchorX,L=v.tileAnchorY;for(let U=0;U<4;U++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,r,e.padding,v.zOffset),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,L,new Ct(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,L,new Ct(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,L,new Ct(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,L,new Ct(e.x1,e.y2)),A.vertexLength+=4;const N=l.indexArray;N.emplaceBack(R,R+1),N.emplaceBack(R+1,R+2),N.emplaceBack(R+2,R+3),N.emplaceBack(R+3,R),A.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,l,h,m,_){for(let v=h;v<m;v++){const A=l.get(v),R=this.getSymbolInstanceTextSize(e,_,r,v);this._addCollisionDebugVertices(A,R,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,r,l,h,m,_){for(let v=h;v<m;v++){const A=l.get(v),R=this.getSymbolInstanceIconSize(e,r,_.placedIconSymbolIndex);this._addCollisionDebugVertices(A,R,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hT(mp,uR.members,rl),this.iconCollisionBox=new hT(mp,uR.members,rl);const h=Vy(this.iconSizeData,e),m=Vy(this.textSizeData,e,l);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(m,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,r,l,h){const m=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:h),_=iT(this.textSizeData,e,m)/Bo;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,r,l){const h=this.icon.placedSymbolArray.get(l),m=iT(this.iconSizeData,e,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,r,l,h){e.emplaceBack(r,-l,-l,h),e.emplaceBack(r,l,-l,h),e.emplaceBack(r,l,l,h),e.emplaceBack(r,-l,l,h)}_updateTextDebugCollisionBoxes(e,r,l,h,m,_,v){for(let A=h;A<m;A++){const R=l.get(A),P=this.getSymbolInstanceTextSize(e,_,r,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,R.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,r,l,h,m,_,v){for(let A=h;A<m;A++){const R=l.get(A),P=this.getSymbolInstanceIconSize(e,r,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,R.padding,_.zOffset)}}updateCollisionDebugBuffers(e,r,l,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=Vy(this.iconSizeData,e,h),_=Vy(this.textSizeData,e,l);for(let v=0;v<this.symbolInstances.length;v++){const A=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,e,r,A.textBoxStartIndex,A.textBoxEndIndex,A,l),this._updateTextDebugCollisionBoxes(_,e,r,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,l),this._updateIconDebugCollisionBoxes(m,e,r,A.iconBoxStartIndex,A.iconBoxEndIndex,A,h),this._updateIconDebugCollisionBoxes(m,e,r,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,l,h,m,_,v,A,R){const P={};if(r<l){const{x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me,featureIndex:Ie}=e.get(r);P.textBox={x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me},P.textFeatureIndex=Ie}if(h<m){const{x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me,featureIndex:Ie}=e.get(h);P.verticalTextBox={x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me},P.verticalTextFeatureIndex=Ie}if(_<v){const{x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me,featureIndex:Ie}=e.get(_);P.iconBox={x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me},P.iconFeatureIndex=Ie}if(A<R){const{x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me,featureIndex:Ie}=e.get(A);P.verticalIconBox={x1:L,y1:N,x2:U,y2:$,padding:X,projectedAnchorX:Q,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:me},P.verticalIconFeatureIndex=Ie}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),h=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),h=[],m=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const A=this.symbolInstances.get(v);h.push(0|Math.round(r*A.tileAnchorX+l*A.tileAnchorY)),m.push(A.featureIndex)}return _.sort(((v,A)=>h[v]-h[A]||m[A]-m[v])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:R}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const r=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let l;return this.elevationFeatures&&r<this.elevationFeatures.length&&(l=this.elevationFeatures[r]),l}}function WR(o,e){return e.replace(/{([^{}]+)}/g,((r,l)=>l in o?String(o[l]):""))}let XR,KR,fT;jt(s1,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),s1.addDynamicAttributes=Hy;class YR{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Eh,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt(YR,"FormatSectionOverride",{omit:["defaultValue"]});const pT=()=>fT||(fT={layout:XR||(XR=new ss({"symbol-placement":new Vt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new un(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Vt(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Vt(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Vt(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Vt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new un(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new Vt(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new un(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new un(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new un(Ye.layout_symbol["icon-image"]),"icon-image-use-theme":new Vt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new un(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Vt(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new un(Ye.layout_symbol["icon-offset"]),"icon-anchor":new un(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new un(Ye.layout_symbol["text-field"]),"text-font":new un(Ye.layout_symbol["text-font"]),"text-size":new un(Ye.layout_symbol["text-size"]),"text-size-scale-range":new Vt(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new un(Ye.layout_symbol["text-max-width"]),"text-line-height":new un(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new un(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new un(Ye.layout_symbol["text-justify"]),"text-radial-offset":new un(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new un(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Vt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new un(Ye.layout_symbol["text-rotate"]),"text-padding":new Vt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Vt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new un(Ye.layout_symbol["text-transform"]),"text-offset":new un(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Vt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(Ye.layout_symbol["text-optional"]),visibility:new Vt(Ye.layout_symbol.visibility)})),paint:KR||(KR=new ss({"icon-opacity":new un(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new un(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new un(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new un(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new un(Ye.paint_symbol["icon-color"]),"icon-halo-color":new un(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new un(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new un(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Vt(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new un(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new un(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new un(Ye.paint_symbol["text-color"],{runtimeType:Oa,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new un(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new un(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new un(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Vt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Vt(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Vt(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Vt(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Vt(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new un(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},fT);class o1 extends Ao{constructor(e,r,l,h){super(e,pT(),r,l,h,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=le([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,r){super.recalculate(e,r),this.appearances&&this.appearances.forEach((h=>{h.recalculate(e,r,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const m of l)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,l,h){return this._saturation===e&&this._contrast===r&&this._brightnessMin===l&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(m,_,v,A){m=mr(m),_=Sr(_);const R=oe(),P=m/3,L=1-2*P,N=[L,P,P,0,P,L,P,0,P,P,L,0,0,0,0,1],U=.5-.5*_,$=A-v;return pe(R,[$,0,0,0,0,$,0,0,0,0,$,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,U,U,U,1]),pe(R,R,N),R})(e,r,l,h),this._saturation=e,this._contrast=r,this._brightnessMin=l,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,l,h){const m=this.layout.get(e).evaluate(r,{},l,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||$h(_.value)||!m?m:WR(r.properties,m)}getAppearanceValueAndResolveTokens(e,r,l,h,m){const _=e.getProperty(r);if(!_)return;const v=_.evaluate(l,{},h,m),A=e.getUnevaluatedProperties()._values[r];return A.isDataDriven()||$h(A.value)||!v||typeof v!="string"?v:WR(l.properties,v)}createBucket(e){return new s1(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of pT().paint.overridableProperties){if(!o1.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new YR(r),h=new rp(l,r.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new Ko("source",h):new Eo("composite",h,r.value.zoomStops,r.value.interpolationType),this.paint._values[e]=new nl(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&o1.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),h=pT().paint.properties[r];let m=!1;const _=v=>{for(const A of v)if(h.overrides&&h.overrides.hasOverride(A))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Ks)_(l.value.value.sections);else if(l.value.kind==="source"){const v=R=>{m||(R instanceof ac&&Ys(R.value)===od?_(R.value.sections):R instanceof lc?_(R.sections):R.eachChild(v))},A=l.value;A._styleExpression&&v(A._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,l){return{config:new ql(this,{zoom:r,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let QR,JR,eM,tM;var mT=xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function a1(o,e,r,l,h,m,_,v){const A=[o,e,1,r,l,1,h,m,1],R=[_,v,1],P=Y([],A),[L,N,U]=Rr(R,R,P);return ie(A,A,[L,0,0,0,N,0,0,0,U])}function nM(o,e,r,l,h,m,_,v){const A=(function(R,P,L,N,U,$,X,Q){const te=a1(0,0,1,0,1,1,0,1),ce=a1(R,P,L,N,U,$,X,Q);return ie(ce,ce,Y([],te))})(o,e,r,l,h,m,_,v);return[A[2]/A[8]/qt,A[5]/A[8]/qt]}function l1(o){return[o[0],Math.min(Math.max(o[1],-be),be)]}class iM extends Bc{constructor(e,r,l,h){super(),this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Zo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=wh(this.map._requestManager.transformRequest(this.url,Ll.Image),((l,h)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new _u(l)):h&&(this.image=h instanceof HTMLImageElement?To.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Iv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Zo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Iv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],l=e[0][1];for(const m of e)m[1]>l&&(l=m[1]),m[1]<r&&(r=m[1]);const h=(l+r)/2;if(h>be?this.onNorthPole=!0:h<-be&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(Xe.fromLngLat);this.tileID=(function(_){let v=1/0,A=1/0,R=-1/0,P=-1/0;for(const X of _)v=Math.min(v,X.x),A=Math.min(A,X.y),R=Math.max(R,X.x),P=Math.max(P,X.y);const L=Math.max(R-v,P-A),N=Math.max(0,Math.floor(-Math.log2(L))),U=Math.pow(2,N);let $=Math.floor((v+R)/2*U);return $>1&&($-=1),new al(N,$,Math.floor((A+P)/2*U))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Zo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Iv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const te in this.tiles){const ce=this.tiles[te];ce.state!=="loaded"&&(ce.state="loaded",ce.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Fv(new al(0,0,0),this.map.transform.projection),l=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(te){const ce=te[1].x-te[0].x,he=te[1].y-te[0].y,me=te[2].x-te[1].x,Ie=te[2].y-te[1].y,Ee=te[3].x-te[2].x,Ne=te[3].y-te[2].y,Be=te[0].x-te[3].x,Ue=te[0].y-te[3].y,ft=ce*Ie-me*he,Qe=me*Ne-Ee*Ie,mt=Ee*Ue-Be*Ne,wt=Be*he-ce*Ue;return ft>0&&Qe>0&&mt>0&&wt>0||ft<0&&Qe<0&&mt<0&&wt<0})(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Fv(this.tileID,this.map.transform.projection),[m,_,v,A]=this.coordinates.map((te=>{const ce=h.projection.project(te[0],te[1]);return UR(h,ce)._round()}));this.perspectiveTransform=nM(m.x,m.y,_.x,_.y,v.x,v.y,A.x,A.y);const R=this._boundsArray=new zd;R.emplaceBack(m.x,m.y,0,0),R.emplaceBack(_.x,_.y,qt,0),R.emplaceBack(A.x,A.y,0,qt),R.emplaceBack(v.x,v.y,qt,qt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(R,mT.members),this.boundsSegments=Br.simpleSegment(0,0,4,2);const P=[],L=[l1((N=this.coordinates)[0]),l1(N[1]),l1(N[2]),l1(N[3])];var N;const[U,$,X,Q]=(function(te){let ce=te[0][0],he=ce,me=te[0][1],Ie=me;for(let Ee=1;Ee<te.length;Ee++)te[Ee][0]<ce?ce=te[Ee][0]:te[Ee][0]>he&&(he=te[Ee][0]),te[Ee][1]<me?me=te[Ee][1]:te[Ee][1]>Ie&&(Ie=te[Ee][1]);return[ce,me,he-ce,Ie-me]})(L);{const te=new zd,[ce,he,me,Ie]=(function(Tt){let Lt=Tt[0].x,ht=Lt,lt=Tt[0].y,zt=lt;for(let Zt=1;Zt<Tt.length;Zt++)Tt[Zt].x<Lt?Lt=Tt[Zt].x:Tt[Zt].x>ht&&(ht=Tt[Zt].x),Tt[Zt].y<lt?lt=Tt[Zt].y:Tt[Zt].y>zt&&(zt=Tt[Zt].y);return[Lt,lt,ht-Lt,zt-lt]})(l),Ee=Tt=>[(Tt.x-ce)/me,(Tt.y-he)/Ie],[Ne,Be,Ue,ft]=l.map(Ee),Qe=(function(Tt,Lt,ht,lt,zt,Zt,At,gn){const bn=a1(0,0,1,0,1,1,0,1);return ie(bn,bn,Y([],a1(Tt,Lt,ht,lt,zt,Zt,At,gn)))})(Ne[0],Ne[1],Be[0],Be[1],Ue[0],Ue[1],ft[0],ft[1]);this.elevatedGlobePerspectiveTransform=nM(Ne[0],Ne[1],Be[0],Be[1],Ue[0],Ue[1],ft[0],ft[1]);const mt=(Tt,Lt)=>{P.push(Tt.lng);const ht=Math.round((Tt.lng-U)/X*qt),lt=Math.round((Tt.lat-$)/Q*qt),zt=Ee(Lt),Zt=Rr([],[zt[0],zt[1],1],Qe),At=Math.round(Zt[0]/Zt[2]*qt),gn=Math.round(Zt[1]/Zt[2]*qt);te.emplaceBack(ht,lt,At,gn)},wt=l[3].x-l[0].x,Dt=l[3].y-l[0].y,Xt=l[2].x-l[1].x,Nt=l[2].y-l[1].y;for(let Tt=0;Tt<65;Tt++){const Lt=Tt/64,ht=[l[0].x+Lt*wt,l[0].y+Lt*Dt],lt=[l[1].x+Lt*Xt,l[1].y+Lt*Nt],zt=lt[0]-ht[0],Zt=lt[1]-ht[1];for(let At=0;At<65;At++){const gn=At/64,bn={x:ht[0]+zt*gn,y:ht[1]+Zt*gn};mt(r.projection.unproject(bn.x,bn.y),bn)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(te,mT.members)}{this.maxLongitudeTriangleSize=0;let te=[],ce=new kr;const he=(me,Ie,Ee)=>{ce.emplaceBack(me,Ie,Ee);const Ne=P[me],Be=P[Ie],Ue=P[Ee],ft=Math.min(Math.min(Ne,Be),Ue),Qe=Math.max(Math.max(Ne,Be),Ue)-ft;Qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Qe),te.push(ft+Qe/2)};for(let me=0;me<64;me++)for(let Ie=0;Ie<64;Ie++){const Ee=65*me+Ie,Ne=Ee+1,Be=Ee+65,Ue=Be+1;he(Ee,Be,Ne),he(Ne,Be,Ue)}[te,ce]=(function(me,Ie){const Ee=Array.from({length:me.length},((Ue,ft)=>ft));Ee.sort(((Ue,ft)=>me[Ue]-me[ft]));const Ne=[],Be=new kr;for(let Ue=0;Ue<Ee.length;Ue++){const ft=Ee[Ue];Ne.push(me[ft]);const Qe=3*ft,mt=Qe+1;Be.emplaceBack(Ie.uint16[Qe],Ie.uint16[mt],Ie.uint16[mt+1])}return[Ne,Be]})(te,ce),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ce)}this.elevatedGlobeSegments=Br.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/qt,0,Q/qt,0,0,$,U,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,l=r.gl;!this._dirty||this.texture instanceof Iv||(this.texture?this.texture.update(this.image):(this.texture=new VS(r,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let h=(m=e+180)+360*Math.round((l[0]-m)/360);var m;const _=new Br,v=(L,N)=>{_.segments.push({vertexOffset:0,primitiveOffset:L,vertexLength:r.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-h)<=A){const L=Ei(l,0,l.length,h+A);return L===l.length||v(L,ar(l,L+1,l.length,h+360-A)-L),_}h<l[0]&&(h+=360);const R=ar(l,0,l.length,h-A);if(R===l.length)return v(0,l.length),_;v(0,R-0);const P=Ei(l,R+1,l.length,h+A);return P!==l.length&&v(P,l.length-P),_}}const D4=(Math.pow(256,2)-1)/16907520;class rM extends Ao{constructor(e,r,l,h){super(e,{layout:eM||(eM=new ss({visibility:new Vt(Ye.layout_raster.visibility)})),paint:tM||(tM=new ss({"raster-opacity":new Vt(Ye.paint_raster["raster-opacity"]),"raster-color":new Rd(Ye.paint_raster["raster-color"]),"raster-color-mix":new Vt(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new Vt(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Vt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Vt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Vt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Vt(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Vt(Ye.paint_raster["raster-array-band"]),"raster-elevation":new Vt(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},r,l,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof iM&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[l,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(h)||l===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=wp({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,h])}}let sM,oM,aM,lM,cM;class uM extends Ao{constructor(e,r,l,h){super(e,{layout:sM||(sM=new ss({visibility:new Vt(Ye["layout_raster-particle"].visibility)})),paint:oM||(oM=new ss({"raster-particle-array-band":new Vt(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Vt(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Rd(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Vt(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Vt(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Vt(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Vt(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Vt(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},r,l,h),this._updateColorRamp(),this.lastInvalidatedAt=To.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=wp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=To.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class P4 extends Ao{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function gT(o,e,r){const l=[0,0,1],h=ci([]);return or(h,h,r?-fi(o)+Math.PI:fi(o)),Yi(h,h,-fi(e)),cs(l,l,h),An(l,l)}const dM={None:0,Model:1,Symbol:2,FillExtrusion:4};class c1{constructor(e,r,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function _T(o,e){const r=o.indexOf("://")===-1;try{return new URL(o,r&&e?"http://example.com":void 0),!0}catch{return!1}}class hM{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class fM{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new _m,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const r=16*e,l=this.instancedDataArray.float32;let h=Math.floor(l[r+2]);const m=1.05*(l[r+2]-h);return h/=100,[l[r]%1*1.05,l[r+1]%1*1.05,m,h]}tileCoordinatesForInstance(e){const r=16*e,l=this.instancedDataArray.float32;let h=l[r+0];return h=h>qt?h-qt:h,new Ct(Math.trunc(h),Math.trunc(l[r+1]))}translationForInstance(e){const r=16*e,l=this.instancedDataArray.float32;return[l[r+4],l[r+5],l[r+6]]}rotationScaleForInstance(e){const r=16*e,l=this.instancedDataArray.float32;return[l[r+7],l[r+8],l[r+9],l[r+10],l[r+11],l[r+12],l[r+13],l[r+14],l[r+15]]}transformForInstance(e){const r=16*e,l=this.instancedDataArray.float32;return[l[r+7],l[r+8],l[r+9],l[r+4],l[r+10],l[r+11],l[r+12],l[r+5],l[r+13],l[r+14],l[r+15],l[r+6],0,0,0,1]}}class yT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((r=>r.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,r){}updateAppearances(e,r,l,h){}populate(e,r,l,h){this.tileToMeter=Pe(l);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:v,index:A,sourceLayerIndex:R}of e){const P=v??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),L=rt(_,m);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview,activeFloors:r.activeFloors}),L,l))continue;const N={id:P,sourceLayerIndex:R,index:A,geometry:m?L.geometry:_t(_,l,h),properties:_.properties,type:_.type,patterns:{}},U=this.addFeature(N,N.geometry,L);U&&r.featureIndex.insert(_,N.geometry,A,R,this.index,this.instancesPerModel[U].instancedDataArray.length,qt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,r=this.layers[0].scope;let l=0;for(const h of this.modelUris){const m=e.getModel(h,r);if(!m)continue;const _=this.instancesPerModel[h];if(_){const v=.5*zn(m.aabb.max,m.aabb.min)*_.maxScale+_.maxXYTranslationDistance,A=Math.min(qt,Math.max(v/this.tileToMeter,qt/32));l=Math.max(A,l)}}return l}update(e,r,l,h){for(const m in this.instancesPerModel){const _=this.instancesPerModel[m];for(const v in e)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],e[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];for(const h of l.features){const m=this.layers[0],_=h.feature,v=this.canonical,A=m.paint.get("model-rotation").evaluate(_,{},v),R=m.paint.get("model-scale").evaluate(_,{},v),P=m.paint.get("model-translation").evaluate(_,{},v);jn(h.rotation,A)&&jn(h.scale,R)&&jn(h.translation,P)||(this.evaluate(h,h.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,r,l,h){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const m=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(o_(this.activeReplacements,m))return!1;this.activeReplacements=m;let _=!1;for(const v in this.instancesPerModel){const A=this.instancesPerModel[v],R=A.instancedDataArray;for(const P of A.features){const L=P.instancedDataOffset,N=P.instancedDataCount;for(let U=0;U<N;U++){const $=16*(U+L);let X=R.float32[$+0];const Q=X>qt;X=Q?X-qt:X;const te=Math.floor(X),ce=Math.floor(R.float32[$+1]);let he=!1;for(const me of this.activeReplacements)if(!s_(me,l,dM.Model,h)&&!(me.min.x>te||te>me.max.x||me.min.y>ce||ce>me.max.y)&&(he=bv(Py(te,ce,e.canonical,me.footprintTileId.canonical),me.footprint),he))break;R.float32[$]=he?X+qt:X,_=_||he!==Q}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,sB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)e.removeModel(r,"",!0)}addFeature(e,r,l){const h=this.layers[0],m=h.layout.get("model-id").evaluate(l,{},this.canonical);if(!m)return Tn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;(_T(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new fM);const _=this.instancesPerModel[m],v=_.instancedDataArray,A=new hM(l,v.length);for(const R of r)for(const P of R){if(P.x<0||P.x>=qt||P.y<0||P.y>=qt)continue;if(this.lookupDim!==0){const N=(this.lookupDim-1)/qt,U=this.lookupDim*(P.y*N|0)+P.x*N|0;if(this.lookup){if(this.lookup[U]!==0)continue;this.lookup[U]=1}}this.instanceCount++;const L=v.length;v.resize(L+1),_.instancesEvaluatedElevation.push(0),v.float32[16*L]=P.x,v.float32[16*L+1]=P.y}return A.instancedDataCount=_.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(A),this.evaluate(A,{},_,!1)),m}getModelUris(){return this.modelUris}evaluate(e,r,l,h){const m=this.layers[0],_=e.feature,v=this.canonical,A=e.rotation=m.paint.get("model-rotation").evaluate(_,r,v),R=e.scale=m.paint.get("model-scale").evaluate(_,r,v),P=e.translation=m.paint.get("model-translation").evaluate(_,r,v),L=Object.assign({},m.paint.get("model-color").evaluate(_,r,v));L.a=m.paint.get("model-color-mix-intensity").evaluate(_,r,v);const N=[];this.maxVerticalOffset<P[2]&&(this.maxVerticalOffset=P[2]);const U=P[0]*P[0]+P[1]*P[1],$=U>0?Math.sqrt(U):0;l.maxScale=Math.max(Math.max(l.maxScale,R[0]),Math.max(R[1],R[2])),l.maxXYTranslationDistance=Math.max(l.maxXYTranslationDistance,$),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),UC(N,A,R);const X=Math.round(100*L.a)+L.b/1.05;for(let Q=0;Q<e.instancedDataCount;++Q){const te=e.instancedDataOffset+Q,ce=16*te,he=l.instancedDataArray.float32;let me=0;h&&(me=he[ce+6]-l.instancesEvaluatedElevation[te]);const Ie=0|he[ce+1];he[ce]=(0|he[ce])+L.r/1.05,he[ce+1]=Ie+L.g/1.05,he[ce+2]=X,he[ce+3]=1/(v.z>10?this.tileToMeter:Pe(v,Ie)),he[ce+4]=P[0],he[ce+5]=P[1],he[ce+6]=P[2]+me,he[ce+7]=N[0],he[ce+8]=N[1],he[ce+9]=N[2],he[ce+10]=N[4],he[ce+11]=N[5],he[ce+12]=N[6],he[ce+13]=N[8],he[ce+14]=N[9],he[ce+15]=N[10],l.instancesEvaluatedElevation[te]=P[2]}}}let pM,mM;jt(yT,"ModelBucket",{omit:["layers"]}),jt(fM,"PerModelAttributes"),jt(hM,"ModelFeature");class qy{constructor(e,r,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=l}static create(e,r,l){const h=l||e.findDEMTileFor(r);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,v=1<<r.canonical.z-_.canonical.z;return new qy(h,m.dim/qt/v,[(r.canonical.x/v-_.canonical.x)*m.dim,(r.canonical.y/v-_.canonical.y)*m.dim])}tileCoordToPixel(e,r){const l=r*this._scale+this._offset[1];return new Ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(l))}getElevationAt(e,r,l,h){const m=e*this._scale+this._offset[0],_=r*this._scale+this._offset[1],v=Math.floor(m),A=Math.floor(_),R=this._dem;return h=!!h,l?Gn(Gn(R.get(v,A,h),R.get(v,A+1,h),_-A),Gn(R.get(v+1,A,h),R.get(v+1,A+1,h),_-A),m-v):R.get(v,A,h)}getElevationAtPixel(e,r,l){return this._dem.get(e,r,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ue(1,e)*this._dem.stride}}const xT=new Float32Array(262144),x_=new Uint8Array(262144);function gM(o){let e=0;if(o.meshes)for(const r of o.meshes)e=Math.max(e,r.aabb.max[2]);if(o.children)for(const r of o.children)e=Math.max(e,gM(r));return e}function _M(o,e,r){if(o.meshes)for(const l of o.meshes){if(l.aabb.min[0]===1/0)continue;const h=di.applyTransform(l.aabb,o.globalMatrix);r.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(o.children)for(const l of o.children)_M(l,e,r)}const yM=["","wall","door","roof","window","lamp","logo"];class xM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:gM(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=di.applyTransformFast(l.aabb,this.node.globalMatrix),r.encapsulate(l.transformedAabb)),e++;this.aabb=r}return this.aabb}}class u1{constructor(e,r,l,h,m,_,v,A){this.id=l,this.layers=e,this.layerIds=this.layers.map((R=>R.fqid)),this.stateDependentLayerIds=this.layers.filter((R=>R.isStateDependent())).map((R=>R.id)),this.modelTraits|=ky.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=ky.HasMapboxMeshFeatures),m&&(this.modelTraits|=ky.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const R of r)this.nodesInfo.push(new xM(R)),_M(R,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,r){for(const l of this.getNodesInfo()){const h=l.node;h.footprint&&r.push({footprint:h.footprint,id:e})}}updateAppearances(e,r,l,h){}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const l=r?this.stateDependentLayers:this.layers;if(!Rs(e,this.states))for(const h of l)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const l of r){const h=l.node;this.uploaded?this.updatePbrBuffer(h):GS(h,e,!0)}for(const l of r)Hb(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),r=!0);return r}needsReEvaluation(e,r,l){const h=e.transform.projectionOptions,m=e.style.getBrightness(),_=this.brightness!==m;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Zv(l.paint.get("model-color").value,_)||Zv(l.paint.get("model-color-mix-intensity").value,_)||Zv(l.paint.get("model-roughness").value,_)||Zv(l.paint.get("model-emissive-strength").value,_)||Zv(l.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=h,this.brightness=m;const v=this.getNodesInfo();for(const A of v)A.state=null;return!0}return!1}evaluateTransform(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),h=this.id.canonical;for(const m of l){const _=m.feature;m.evaluatedTranslation=r.paint.get("model-translation").evaluate(_,{},h),m.evaluatedScale=r.paint.get("model-scale").evaluate(_,{},h)}}evaluate(e,r){const l=this.getNodesInfo();for(const h of l){if(!h.node.meshes)continue;const m=h.feature,_=r&&r[m.id];if(Rs(_,h.state))continue;h.state=structuredClone(_);const v=h.node.meshes&&h.node.meshes[0].featureData,A=h.evaluatedColor[2],R=h.evaluatedRMEA[2],P=this.id.canonical;if(h.hasTranslucentParts=!1,v){for(let L=0;L<yM.length;L++){const N=yM[L];N.length&&(m.properties.part=N);const U=e.paint.get("model-color").evaluate(m,_,P).toPremultipliedRenderColor(null),$=e.paint.get("model-color-mix-intensity").evaluate(m,_,P);h.evaluatedColor[L]=[U.r,U.g,U.b,$],h.evaluatedRMEA[L][0]=e.paint.get("model-roughness").evaluate(m,_,P),h.evaluatedRMEA[L][2]=e.paint.get("model-emissive-strength").evaluate(m,_,P),h.evaluatedRMEA[L][3]=U.a,h.emissionHeightBasedParams[L]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,_,P),!h.hasTranslucentParts&&U.a<1&&(h.hasTranslucentParts=!0)}delete m.properties.part,z4(h,A!==h.evaluatedColor[2]||R!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,_,P);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,_,P),h.evaluatedScale=e.paint.get("model-scale").evaluate(m,_,P),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,l,h){const m=e.findDEMTileFor(l);if(m&&(m.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const _=qy.create(e,l,m);if(!_)return;this.modelTraits&ky.HasMapboxMeshFeatures&&this.updateDEM(e,_,l,h);for(const v of this.getNodesInfo()){const A=v.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const R=A.footprint.vertices;let P=_.getElevationAt(R[0].x,R[0].y,!0,!0);for(let L=1;L<R.length;L++)P=Math.min(P,_.getElevationAt(R[L].x,R[L].y,!0,!0));A.elevation=P}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,l,h){let m=r._dem._modifiedForSources[h];if(m===void 0&&(r._dem._modifiedForSources[h]=[],m=r._dem._modifiedForSources[h]),m.includes(l.canonical))return;const _=r._dem.dim;m.push(l.canonical);let v=!1;for(const A of this.getNodesInfo()){const R=A.node;if(!R.footprint||!R.footprint.grid)continue;const P=R.footprint.grid,L=r.tileCoordToPixel(P.min.x,P.min.y),N=r.tileCoordToPixel(P.max.x,P.max.y),U=Math.min(Math.min(_-N.y,L.x),Math.min(L.y,_-N.x));if(U<0)continue;const $=se(U,2,5);let X=Math.max(0,L.x-$),Q=Math.max(0,L.y-$),te=Math.min(N.x+$,_-1),ce=Math.min(N.y+$,_-1);for(let Ee=Q;Ee<=ce;++Ee)for(let Ne=X;Ne<=te;++Ne)x_[Ee*_+Ne]=255;let he=0,me=0;for(let Ee=0;Ee<P.cellsY;++Ee)for(let Ne=0;Ne<P.cellsX;++Ne){if(!P.cells[Ee*P.cellsX+Ne])continue;const Be=r.tileCoordToPixel(P.min.x+Ne/P.xScale,P.min.y+Ee/P.yScale),Ue=r.tileCoordToPixel(P.min.x+(Ne+1)/P.xScale,P.min.y+(Ee+1)/P.yScale);for(let ft=Be.y;ft<=Math.min(Ue.y+1,_-1);++ft)for(let Qe=Be.x;Qe<=Math.min(Ue.x+1,_-1);++Qe)x_[ft*_+Qe]===255&&(x_[ft*_+Qe]=0,he+=r.getElevationAtPixel(Qe,ft),me++)}const Ie=he/me;X=Math.max(1,L.x-$),Q=Math.max(1,L.y-$),te=Math.min(N.x+$,_-2),ce=Math.min(N.y+$,_-2),v=!0;for(let Ee=Q;Ee<=ce;++Ee)for(let Ne=X;Ne<=te;++Ne)x_[Ee*_+Ne]===0&&(xT[Ee*_+Ne]=r._dem.set(Ne,Ee,Ie));for(let Ee=1;Ee<$;++Ee){X=Math.max(1,L.x-Ee),Q=Math.max(1,L.y-Ee),te=Math.min(N.x+Ee,_-2),ce=Math.min(N.y+Ee,_-2);for(let Ne=Q;Ne<=ce;++Ne)for(let Be=X;Be<=te;++Be){const Ue=Ne*_+Be;if(x_[Ue]===255){let ft=0,Qe=0,mt=-1,wt=-1;for(let Dt=-1;Dt<=1;++Dt)for(let Xt=-1;Xt<=1;++Xt){const Nt=(Ne+Dt)*_+Be+Xt;if(x_[Nt]>=Ee)continue;const Tt=xT[Nt],Lt=Math.abs(Tt);Lt>Qe&&(ft=Tt,Qe=Lt,mt=Xt,wt=Dt)}if(Qe>.1){const Dt=1-(Ee+.5*Math.abs(mt*wt))/$;let Xt=r._dem.get(Be,Ne)+ft*Dt;const Nt=r._dem.get(Be+mt,Ne+wt),Tt=r._dem.get(Be-mt,Ne-wt,!0);(Xt-Nt)*(Xt-Tt)>0&&(Xt=(Nt+Tt)/2),xT[Ue]=r._dem.set(Be,Ne,Xt),x_[Ue]=Ee}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=To.now())}setFilter(e){this.filter=e?lp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new ir(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)Hb(r.node),HS(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const m=h.node.footprint;h.hiddenByReplacement=!!m&&!l.find((_=>_.footprint===m))}}getHeightAtTileCoord(e,r){const l=[],h=[0,0,0],m=le([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],A=v.transformedAabb;if(e<A.min[0]||r<A.min[1]||e>A.max[0]||r>A.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};ge(m,_.node.globalMatrix),h[0]=e,h[1]=r,Ri(h,h,m);const R=(h[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*g_|0,P=Math.min(63,(h[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*g_|0)*g_+Math.min(63,R),L=v.heightmap[P];if(!(L<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:L,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Ct(e,r),new Ct(e,r),l),l.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Zv(o,e){return o instanceof Ko&&!o.isLightConstant&&e}function O4(o,e,r,l,h,m,_,v){let A=(61440&e|(61440&e)>>4)>>8,R=(3840&e|(3840&e)>>4)>>4,P=240&e|(240&e)>>4;r[3]>0&&(A=Gn(A,255*r[0],r[3]),R=Gn(R,255*r[1],r[3]),P=Gn(P,255*r[2],r[3]));const L=A<<8|R,N=P<<8|Math.floor(255*l[3]),U=(function(Ee){const Ne=se(Ee,0,2);return Math.min(Math.round(.5*Ne*255),255)})(l[2])<<8|15*l[0]<<4|15*l[1],$=se(h[0],0,1),X=se(h[1],0,1),Q=se(h[2],0,1),te=se(h[3],0,1);let ce,he,me,Ie;if($!==X&&_!==m&&X!==$){const Ee=_-m;he=1/(Ee*(X-$)),me=-(m+Ee*$)/(Ee*(X-$));const Ne=se(h[4],-1,1);Ie=Math.pow(10,Ne),ce=255*Q<<8|255*te}else ce=65535,he=0,me=1,Ie=1;if(o.emplaceBack(L,N,U,ce,he,me,Ie),v){const Ee=v.length;v.clear();for(let Ne=0;Ne<Ee;Ne++)v.emplaceBack(L,N,U,ce,he,me,Ie)}}function z4(o,e,r){const l=o.node;let h=0;const m=r&ky.HasMeshoptCompression;for(const _ of l.meshes){if(l.lights&&l.lightMeshIndex===h||!_.featureData)continue;_.featureArray=new ju,_.featureArray.reserve(_.featureData.length);let v=e;for(const A of _.featureData){const R=m?65535&A:A>>16&65535,P=m?A>>16&65535:65535&A,L=(15&P)<8?15&P:0,N=o.evaluatedRMEA[L],U=o.evaluatedColor[L],$=o.emissionHeightBasedParams[L];let X;if(v&&L===2&&l.lights&&(X=new ju,X.resize(10*l.lights.length)),O4(_.featureArray,R,U,N,$,_.aabb.min[2],_.aabb.max[2],X),X&&v){v=!1;const Q=l.meshes[l.lightMeshIndex];Q.featureArray=X,Q.featureArray._trim()}}_.featureArray._trim(),h++}}jt(u1,"Tiled3dModelBucket",{omit:["layers"]}),jt(xM,"Tiled3dModelFeature");const L4=["id","tile","layer","source","sourceLayer","state"];class v_{constructor(e,r,l,h,m){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=l,this._y=h,this.properties=e?e.properties:{},this.id=m}clone(){const e=new v_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of L4)this[r]!==void 0&&(e[r]=this[r]);return e}}class b_ extends Bc{constructor(e,r,l,h){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=r,this._modelsInfo=new Map}load(){const e=[];for(const r in this._options.models){const l=this._options.models[r],h=this._modelsInfo.get(r);if(h){const m=h.model;m.position=l.position!=null?new G(l.position[0],l.position[1]):new G(0,0),m.orientation=l.orientation!=null?l.orientation:[0,0,0],h.modelSpec=l,b_.applyModelSpecification(m,l),m.computeBoundsAndApplyParent(),this.models.push(m)}else{const m=jC(this.map._requestManager.transformRequest(l.uri,Ll.Model).url).then((_=>{if(!_)return;const v=ZS(_),A=new $C(r,l.uri,l.position,l.orientation,v);b_.applyModelSpecification(A,l),A.computeBoundsAndApplyParent(),this.models.push(A),this._modelsInfo.set(r,{modelSpec:l,model:A})})).catch((_=>{this.fire(new _u(new Error(`Could not load model ${r} from ${l.uri}: ${_.message}`)))}));e.push(m)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new Zo("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((r=>{this._loaded=!0,this.fire(new _u(new Error(`Could not load models: ${r.message}`)))}))}static applyModelSpecification(e,r){r.nodeOverrides&&b_.convertNodeOverrides(e,r.nodeOverrides),r.materialOverrides&&b_.convertMaterialOverrides(e,r.materialOverrides),r.nodeOverrideNames&&(e.nodeOverrideNames=[...r.nodeOverrideNames]),r.materialOverrideNames&&(e.materialOverrideNames=[...r.materialOverrideNames]),r.featureProperties&&(e.featureProperties=r.featureProperties)}static convertNodeOverrides(e,r){if(Array.isArray(r)&&r.every((l=>typeof l=="string"))){e.nodeOverrideNames=[];for(const l of r)e.nodeOverrideNames.push(l)}else Object.entries(r).forEach((([l,h])=>{const m={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){const _=h.orientation;_&&(m.orientation=_)}e.nodeOverrides.set(l,m)}))}static convertMaterialOverrides(e,r){if(Array.isArray(r)&&r.every((l=>typeof l=="string"))){e.materialOverrideNames=[];for(const l of r)e.materialOverrideNames.push(l)}else Object.entries(r).forEach((([l,h])=>{const m={color:new nr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=h["model-color"];_!==void 0&&(m.color.r=_[0],m.color.g=_[1],m.color.b=_[2]);const v=h["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);const A=h["model-emissive-strength"];A!==void 0&&(m.emissionStrength=A);const R=h["model-opacity"];R!==void 0&&(m.opacity=R),e.materialOverrides.set(l,m)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,r){}serialize(){return this._options}setProperty(e,r){return!1}reload(){const e=Od(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const r=new Map;for(const l in e){const h=e[l];if(this._modelsInfo.has(l)){const m=this._modelsInfo.get(l);m&&m.modelSpec.uri===h.uri&&r.set(l,m)}}this._modelsInfo=r,this._options.models=e,this._loaded=!1,this.load()}}function vT(o,e,r,l){const h=1<<o.z;e.lat=fe((l/qt+o.y)/h),e.lng=ye((r/qt+o.x)/h)}function N4(o,e,r,l){const h=o.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let m=Number.MAX_VALUE;const _=h.node,v=r.tile,A=l.calculatePosMatrix(v.tileID.toUnwrapped(),l.worldSize),R=h.evaluatedScale;let P=0;l.elevation&&_.elevation&&(P=_.elevation*l.elevation.exaggeration()),_e(A,A,[(_.anchor?_.anchor[0]:0)*(R[0]-1),(_.anchor?_.anchor[1]:0)*(R[1]-1),P]),Re(A,A,R);const L=r.queryGeometry,N=L.isPointQuery()?L.screenBounds:L.screenGeometry,U=function(X){const Q=pe([],A,X.globalMatrix);pe(Q,l.expandedFarZProjMatrix,Q);for(let te=0;te<X.meshes.length;++te){const ce=X.meshes[te];if(te===X.lightMeshIndex)continue;const he=$S(N,l,Q,ce.aabb);he!=null&&(m=Math.min(he,m))}if(X.children)for(const te of X.children)U(te)};if(U(_),m===Number.MAX_VALUE)return;const $=new G(0,0);return vT(v.tileID.canonical,$,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:m,position:$,feature:h.feature}}const k4={circle:class extends Ao{constructor(o,e,r,l){super(o,{layout:El||(El=new ss({"circle-sort-key":new un(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Vt(Ye.layout_circle["circle-elevation-reference"]),visibility:new Vt(Ye.layout_circle.visibility)})),paint:Bu||(Bu=new ss({"circle-radius":new un(Ye.paint_circle["circle-radius"]),"circle-color":new un(Ye.paint_circle["circle-color"]),"circle-blur":new un(Ye.paint_circle["circle-blur"]),"circle-opacity":new un(Ye.paint_circle["circle-opacity"]),"circle-translate":new Vt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new un(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new un(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new un(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Vt(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}createBucket(o){return new Tr(o)}queryRadius(o){const e=o;return eo("circle-radius",this,e)+eo("circle-stroke-width",this,e)+Jr(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,r,l,h,m,_,v){const A=Ud(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return by(o,l,m,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,r){const l=mb(this);return{config:new ql(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ao{createBucket(o){return new wy(o)}constructor(o,e,r,l){super(o,{layout:_b||(_b=new ss({visibility:new Vt(Ye.layout_heatmap.visibility)})),paint:yb||(yb=new ss({"heatmap-radius":new un(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new un(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rd(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return eo("heatmap-radius",this,o)}queryIntersectsFeature(o,e,r,l,h,m,_,v){const A=this.paint.get("heatmap-radius").evaluate(e,r);return by(o,l,m,_,v,!0,!0,new Ct(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,r){return o==="heatmap"?{config:new ql(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Ao{constructor(o,e,r,l){super(o,{layout:Rm||(Rm=new ss({visibility:new Vt(Ye.layout_hillshade.visibility)})),paint:xb||(xb=new ss({"hillshade-illumination-direction":new Vt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Vt(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}},fill:class extends Ao{constructor(o,e,r,l){super(o,{layout:Tp||(Tp=new ss({"fill-sort-key":new un(Ye.layout_fill["fill-sort-key"]),visibility:new Vt(Ye.layout_fill.visibility),"fill-elevation-reference":new Vt(Ye.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new un(Ye.layout_fill["fill-construct-bridge-guard-rail"])})),paint:yv||(yv=new ss({"fill-antialias":new Vt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new un(Ye.paint_fill["fill-opacity"]),"fill-color":new un(Ye.paint_fill["fill-color"]),"fill-outline-color":new un(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Vt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new un(Ye.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Vt(Ye.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Vt(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new un(Ye.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new un(Ye.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new un(Ye.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(o,e,r){return{config:new ql(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new _v(o)}queryRadius(){return Jr(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,r,l,h,m){return!o.queryGeometry.isAboveHorizon&&Yr(Ua(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ao{constructor(o,e,r,l){super(o,{layout:h_||(h_=new ss({visibility:new Vt(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Vt(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Av||(Av=new ss({"fill-extrusion-opacity":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new un(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new un(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new un(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new un(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new un(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new un(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new un(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new un(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new ou(o)}queryRadius(){return Jr(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,r,l,h,m,_,v,A){const R=Ud(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,r),L=this.paint.get("fill-extrusion-base").evaluate(e,r),N=[0,0],U=v&&m.elevation,$=m.elevation?m.elevation.exaggeration():1,X=o.tile.getBucket(this);if(U&&X instanceof ou){const me=X.centroidVertexArray,Ie=A+1;Ie<me.length&&(N[0]=me.geta_centroid_pos0(Ie),N[1]=me.geta_centroid_pos1(Ie))}if(N[0]===0&&N[1]===1)return!1;m.projection.name==="globe"&&(l=Nb([l],[new Ct(0,0),new Ct(qt,qt)],o.tileID.canonical).map((me=>me.polygon)).flat());const Q=U?v:null,[te,ce]=m_(m,l,L,P,R,_,Q,N,$,m.center.lat,o.tileID.canonical),he=o.queryGeometry;return Fb(te,ce,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends Ao{constructor(o,e,r,l){super(o,{layout:YC||(YC=new ss({visibility:new Vt(Ye.layout_building.visibility),"building-facade":new un(Ye.layout_building["building-facade"]),"building-facade-floors":new un(Ye.layout_building["building-facade-floors"]),"building-facade-unit-width":new un(Ye.layout_building["building-facade-unit-width"]),"building-facade-window":new un(Ye.layout_building["building-facade-window"]),"building-roof-shape":new un(Ye.layout_building["building-roof-shape"]),"building-height":new un(Ye.layout_building["building-height"]),"building-base":new un(Ye.layout_building["building-base"]),"building-flood-light-wall-radius":new un(Ye.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new un(Ye.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new un(Ye.layout_building["building-flip-roof-orientation"])})),paint:QC||(QC=new ss({"building-opacity":new Vt(Ye.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Vt(Ye.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Vt(Ye.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Vt(Ye.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Vt(Ye.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Vt(Ye.paint_building["building-vertical-scale"]),"building-cast-shadows":new Vt(Ye.paint_building["building-cast-shadows"]),"building-color":new un(Ye.paint_building["building-color"]),"building-emissive-strength":new un(Ye.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Vt(Ye.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Vt(Ye.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Vt(Ye.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Vt(Ye.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Vt(Ye.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new KC(o)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}queryRadius(o){return 0}queryIntersectsFeature(o,e,r,l,h,m,_,v,A){let R=this.layout.get("building-height").evaluate(e,r);const P=this.layout.get("building-base").evaluate(e,r),L=o.tile.getBucket(this).getFootprint(e);if(L){if(L.hiddenFlags!==0)return!1;R=L.height}const[N,U]=m_(m,l,P,R,new Ct(0,0),_,null,[0,0],1,m.center.lat,o.tileID.canonical),$=o.queryGeometry;return Fb(N,U,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends Ao{constructor(o,e,r,l){const h=lR();super(o,h,e,r,l),h.layout&&(this.layout=new Pu(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(Pv)return Pv;const r=lR();return Pv=new OB(r.paint.properties["line-width"].specification),Pv.useIntegerZoom=!0,Pv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new XS(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,r){const l=oR(this);return{config:new ql(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}queryRadius(o){const e=o,r=cR(eo("line-width",this,e),eo("line-gap-width",this,e)),l=eo("line-offset",this,e);return r/2+Math.abs(l)+Jr(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,r,l,h,m){if(o.queryGeometry.isAboveHorizon)return!1;const _=Ua(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*cR(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),A=this.paint.get("line-offset").evaluate(e,r);return A&&(l=(function(R,P){const L=[],N=new Ct(0,0);for(let U=0;U<R.length;U++){const $=R[U],X=[];for(let Q=0;Q<$.length;Q++){const te=$[Q],ce=$[Q+1],he=Q===0?N:te.sub($[Q-1])._unit()._perp(),me=Q===$.length-1?N:ce.sub(te)._unit()._perp(),Ie=he._add(me)._unit();Ie._mult(1/(Ie.x*me.x+Ie.y*me.y)),X.push(Ie._mult(P)._add(te))}L.push(X)}return L})(l,A*o.pixelToTileUnitsFactor)),(function(R,P,L){for(let N=0;N<P.length;N++){const U=P[N];if(R.length>=3){for(let $=0;$<U.length;$++)if(oo(R,U[$]))return!0}if(ca(R,U,L))return!0}return!1})(_,l,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:o1,background:class extends Ao{constructor(o,e,r,l){super(o,{layout:QR||(QR=new ss({visibility:new Vt(Ye.layout_background.visibility)})),paint:JR||(JR=new ss({"background-pitch-alignment":new Vt(Ye.paint_background["background-pitch-alignment"]),"background-color":new Vt(Ye.paint_background["background-color"]),"background-pattern":new Vt(Ye.paint_background["background-pattern"]),"background-opacity":new Vt(Ye.paint_background["background-opacity"]),"background-emissive-strength":new Vt(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:rM,"raster-particle":uM,sky:class extends Ao{constructor(o,e,r,l){super(o,{layout:aM||(aM=new ss({visibility:new Vt(Ye.layout_sky.visibility)})),paint:lM||(lM=new ss({"sky-type":new Vt(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Vt(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Vt(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Vt(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Vt(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Rd(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Vt(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Vt(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Vt(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,m=o.style.light,_=m.properties.get("position");return h&&m.properties.get("anchor")==="viewport"&&Tn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?gT(_.azimuthal,90-_.polar,e):gT(l[0],90-l[1],e)}const r=this.paint.get("sky-gradient-center");return gT(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Ao{constructor(o,e,r,l){super(o,{paint:cM||(cM=new ss({}))},e,null)}},model:class extends Ao{constructor(o,e,r,l){super(o,{layout:pM||(pM=new ss({visibility:new Vt(Ye.layout_model.visibility),"model-id":new un(Ye.layout_model["model-id"])})),paint:mM||(mM=new ss({"model-opacity":new un(Ye.paint_model["model-opacity"]),"model-rotation":new un(Ye.paint_model["model-rotation"]),"model-scale":new un(Ye.paint_model["model-scale"]),"model-translation":new un(Ye.paint_model["model-translation"]),"model-color":new un(Ye.paint_model["model-color"]),"model-color-mix-intensity":new un(Ye.paint_model["model-color-mix-intensity"]),"model-type":new Vt(Ye.paint_model["model-type"]),"model-cast-shadows":new Vt(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Vt(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Vt(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new un(Ye.paint_model["model-emissive-strength"]),"model-roughness":new un(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new un(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Vt(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Vt(Ye.paint_model["model-front-cutoff"]),"model-elevation-reference":new Vt(Ye.paint_model["model-elevation-reference"]),"model-color-use-theme":new un({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this.layer=o,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new yT(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof u1?qt-1:0}queryRenderedFeatures(o,e,r){const l=e.getSource();if(!(l&&l instanceof b_))return{};const h=l,m={};m[this.id]=[];const _=m[this.id];let v=0;for(const A of h.models){const R=e.getFeatureState(this.sourceLayer,A.id),P={type:"Unknown",id:A.id,properties:A.featureProperties},L=this.paint.get("model-rotation").evaluate(P,R),N=this.paint.get("model-scale").evaluate(P,R),U=this.paint.get("model-translation").evaluate(P,R),$=this.paint.get("model-elevation-reference");let X=[];Gb(X,A,r,A.position,L,N,U,$==="ground",$==="ground",!1),r.projection.name==="globe"&&(X=$b(X,r));const Q=pe([],r.projMatrix,X),te=$S(o.isPointQuery()?o.screenBounds:o.screenGeometry,r,Q,A.aabb);if(te!=null){const ce=new v_(void 0,0,0,0,A.id);ce.layer=this.layer,ce.properties=structuredClone(A.featureProperties),ce.properties.layer=this.id,ce.properties.uri=A.uri,ce.properties.orientation=A.orientation,ce.sourceLayer=this.sourceLayer,ce.geometry={type:"Point",coordinates:[A.position.lng,A.position.lat]},ce.state=R,ce.source=this.source,_.push({featureIndex:v,feature:ce,intersectionZ:te})}++v}return m}queryIntersectsFeature(o,e,r,l,h,m){if(!this.modelManager)return!1;const _=this.modelManager,v=o.tile.getBucket(this);if(!(v&&v instanceof yT))return!1;for(const A in v.instancesPerModel){const R=v.instancesPerModel[A],P=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(P)){const L=R.features[R.idToFeaturesIndex[P]],N=_.getModel(A,this.scope);if(!N)return!1;let U=[];const $=new G(0,0),X=v.canonical;let Q=Number.MAX_VALUE;for(let te=0;te<L.instancedDataCount;++te){const ce=16*(L.instancedDataOffset+te),he=R.instancedDataArray.float32,me=[he[ce+4],he[ce+5],he[ce+6]];vT(X,$,Math.floor(he[ce]),Math.floor(he[ce+1])),Gb(U,N,m,$,L.rotation,L.scale,me,!1,!1,!1),m.projection.name==="globe"&&(U=$b(U,m));const Ie=pe([],m.projMatrix,U),Ee=o.queryGeometry,Ne=$S(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,m,Ie,N.aabb);Ne!=null&&(Q=Math.min(Ne,Q))}return Q!==Number.MAX_VALUE&&Q}}return!1}_handleOverridablePaintPropertyUpdate(o,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Eo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ao{constructor(o,e,r,l){super(o,{layout:Ab||(Ab=new ss({"clip-layer-types":new Vt(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new Vt(Ye.layout_clip["clip-layer-scope"])})),paint:Cb||(Cb=new ss({}))},e,r,l)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new Rb(o)}is3D(o){return!0}}},bT=new nr(0,0,0),wT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},ST={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},d1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},j4={PAINT_ORDER_FILL_AND_STROKE:1},Wv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},vM={MASK_TYPE_LUMINANCE:1};function F4(o,e,r){o===1&&e.icons.push((function(l,h){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:_}=m;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&bM(_,"x"),_.stretch_y&&_.stretch_y.length&&bM(_,"y"),m})(l.readFields(B4,{name:void 0},h))})(r,r.readVarint()+r.pos))}function bM(o,e){const r=[],l=o[`stretch_${e}`];let h=null;for(let m=0;m<l.length;m++)h===null?h=r.length===0?l[0]:r[r.length-1][1]+l[m]:(r.push([h,h+l[m]]),h=null);o[`stretch_${e}_areas`]=r}function B4(o,e,r){o===1?e.name=r.readString():o===2?e.metadata=(function(l,h){return l.readFields(V4,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(r,r.readVarint()+r.pos):o===3&&(e.usvg_tree=(function(l,h){return l.readFields(G4,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(r,r.readVarint()+r.pos),e.data="usvg_tree")}function V4(o,e,r){o===1?e.stretch_x=r.readPackedVarint():o===2?e.stretch_y=r.readPackedVarint():o===3?e.content_area=wM(r,r.readVarint()+r.pos):o===4?e.variables.push((function(l,h){return l.readFields($4,{name:void 0},h)})(r,r.readVarint()+r.pos)):o===5&&(e.text_placeholder=wM(r,r.readVarint()+r.pos))}function wM(o,e){return o.readFields(U4,{},e)}function U4(o,e,r){o===1?e.left=r.readVarint():o===2?e.width=r.readVarint():o===3?e.top=r.readVarint():o===4&&(e.height=r.readVarint())}function $4(o,e,r){o===1?e.name=r.readString():o===2&&(e.rgb_color=p1(r.readVarint()),e.value="rgb_color")}function G4(o,e,r){o===1?e.width=e.height=r.readVarint():o===2?e.height=r.readVarint():o===3?e.children.push(h1(r,r.readVarint()+r.pos)):o===4?e.linear_gradients.push((function(l,h){return l.readFields(Y4,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(r,r.readVarint()+r.pos)):o===5?e.radial_gradients.push((function(l,h){return l.readFields(J4,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(r,r.readVarint()+r.pos)):o===7?e.clip_paths.push((function(l,h){return l.readFields(e5,{children:[]},h)})(r,r.readVarint()+r.pos)):o===8&&e.masks.push((function(l,h){const m=l.readFields(t5,{left:0,width:20,mask_type:vM.MASK_TYPE_LUMINANCE,children:[]},h);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(r,r.readVarint()+r.pos))}function h1(o,e){return o.readFields(H4,{},e)}function H4(o,e,r){o===1?(e.group=(function(l,h){return l.readFields(q4,{opacity:255,children:[]},h)})(r,r.readVarint()+r.pos),e.node="group"):o===2&&(e.path=(function(l,h){return l.readFields(W4,{paint_order:1,commands:[],step:1,diffs:[],rule:wT.PATH_RULE_NON_ZERO},h)})(r,r.readVarint()+r.pos),e.node="path")}function q4(o,e,r){o===1?e.transform=f1(r,r.readVarint()+r.pos):o===2?e.opacity=r.readVarint():o===5?e.clip_path_idx=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(h1(r,r.readVarint()+r.pos))}function f1(o,e){return o.readFields(Z4,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function Z4(o,e,r){o===1?e.sx=r.readFloat():o===2?e.ky=r.readFloat():o===3?e.kx=r.readFloat():o===4?e.sy=r.readFloat():o===5?e.tx=r.readFloat():o===6&&(e.ty=r.readFloat())}function W4(o,e,r){o===1?e.fill=(function(l,h){return l.readFields(X4,{rgb_color:bT,paint:"rgb_color",opacity:255},h)})(r,r.readVarint()+r.pos):o===2?e.stroke=(function(l,h){return l.readFields(K4,{rgb_color:bT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(r,r.readVarint()+r.pos):o===3?e.paint_order=r.readVarint():o===5?r.readPackedVarint(e.commands):o===6?e.step=r.readFloat():o===7?r.readPackedSVarint(e.diffs):o===8&&(e.rule=r.readVarint())}function X4(o,e,r){o===1?(e.rgb_color=p1(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=r.readVarint())}function p1(o){return new nr((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function K4(o,e,r){o===1?(e.rgb_color=p1(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5?r.readPackedFloat(e.dasharray):o===6?e.dashoffset=r.readFloat():o===7?e.miterlimit=r.readFloat():o===8?e.opacity=r.readVarint():o===9?e.width=r.readFloat():o===10?e.linecap=r.readVarint():o===11&&(e.linejoin=r.readVarint())}function Y4(o,e,r){o===1?e.transform=f1(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(SM(r,r.readVarint()+r.pos)):o===4?e.x1=r.readFloat():o===5?e.y1=r.readFloat():o===6?e.x2=r.readFloat():o===7&&(e.y2=r.readFloat())}function SM(o,e){return o.readFields(Q4,{offset:0,opacity:255,rgb_color:bT},e)}function Q4(o,e,r){o===1?e.offset=r.readFloat():o===2?e.opacity=r.readVarint():o===3&&(e.rgb_color=p1(r.readVarint()))}function J4(o,e,r){o===1?e.transform=f1(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(SM(r,r.readVarint()+r.pos)):o===4?e.cx=r.readFloat():o===5?e.cy=r.readFloat():o===6?e.r=r.readFloat():o===7?e.fx=r.readFloat():o===8?e.fy=r.readFloat():o===9&&(e.fr=r.readFloat())}function e5(o,e,r){o===1?e.transform=f1(r,r.readVarint()+r.pos):o===2?e.clip_path_idx=r.readVarint():o===3&&e.children.push(h1(r,r.readVarint()+r.pos))}function t5(o,e,r){o===1?e.left=e.top=r.readFloat():o===2?e.width=e.height=r.readFloat():o===3?e.top=r.readFloat():o===4?e.height=r.readFloat():o===5?e.mask_type=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(h1(r,r.readVarint()+r.pos))}class n5{static calculate(e={},r=[]){const l=new Map,h=new Map;if(Object.keys(e).length===0)return l;r.forEach((m=>{h.set(m.name,m.rgb_color||new nr(0,0,0))}));for(const[m,_]of Object.entries(e))h.has(m)?l.set(h.get(m).toString(),_):console.warn(`Ignoring unknown image variable "${m}"`);return l}}function Zy(o,e=255,r){const l=e/255,h=o.toString(),m=r.has(h)?r.get(h).clone():o.clone();return m.a*=l,m.toString()}function Xv(o,e){if(!na()){const r=document.createElement("canvas");return r.width=o,r.height=e,r}return new OffscreenCanvas(o,e)}function i5(o,e){const r=n5.calculate(e.params,o.metadata?o.metadata.variables:[]),l=o.usvg_tree,h=l.width,m=l.height,_=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(h*_.a)),A=Math.max(1,Math.round(m*_.d)),R=new DOMMatrix([v/h,0,0,A/m,0,0]),P=Xv(v,A).getContext("2d");return TT(P,R,l,l,r),P.getImageData(0,0,v,A)}function TT(o,e,r,l,h){for(const m of l.children)TM(o,e,r,m,h)}function TM(o,e,r,l,h){l.group?(o.save(),(function(m,_,v,A,R){const P=A.mask_idx!=null?v.masks[A.mask_idx]:null,L=A.clip_path_idx!=null?v.clip_paths[A.clip_path_idx]:null;if(A.transform&&(_=Wy(A.transform).preMultiplySelf(_)),!(function($,X,Q){return $.opacity!==255||X||Q})(A,L!=null,P!=null))return void TT(m,_,v,A,R);const N=Xv(m.canvas.width,m.canvas.height),U=N.getContext("2d");TT(U,_,v,A,R),L&&DM(U,_,v,L),P&&PM(U,_,v,P,R),m.globalAlpha=A.opacity/255,m.drawImage(N,0,0)})(o,e,r,l.group,h),o.restore()):l.path&&(o.save(),(function(m,_,v,A,R){m.setTransform(_),A.paint_order===j4.PAINT_ORDER_FILL_AND_STROKE?(EM(m,v,A,R),CM(m,v,A,R)):(CM(m,v,A,R),EM(m,v,A,R))})(o,e,r,l.path,h),o.restore())}function EM(o,e,r,l){const h=r.fill;if(!h)return;const m=h.opacity/255;switch(o.save(),o.beginPath(),OM(r,o),h.paint){case"rgb_color":o.fillStyle=Zy(h.rgb_color,h.opacity,l);break;case"linear_gradient_idx":{const _=e.linear_gradients[h.linear_gradient_idx];_.transform&&o.setTransform(Wy(_.transform).preMultiplySelf(o.getTransform())),o.fillStyle=RM(o,_,m,l);break}case"radial_gradient_idx":{const _=e.radial_gradients[h.radial_gradient_idx];_.transform&&o.setTransform(Wy(_.transform).preMultiplySelf(o.getTransform())),o.fillStyle=MM(o,_,m,l)}}o.fill(AM(r)),o.restore()}function AM(o){return o.rule===wT.PATH_RULE_NON_ZERO?"nonzero":o.rule===wT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function CM(o,e,r,l){const h=r.stroke;if(!h)return;const m=zM(r);o.lineWidth=h.width,o.miterLimit=h.miterlimit,o.setLineDash(h.dasharray),o.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":o.strokeStyle=Zy(h.rgb_color,h.opacity,l);break;case"linear_gradient_idx":o.strokeStyle=RM(o,e.linear_gradients[h.linear_gradient_idx],_,l,!0);break;case"radial_gradient_idx":o.strokeStyle=MM(o,e.radial_gradients[h.radial_gradient_idx],_,l,!0)}switch(h.linejoin){case d1.LINE_JOIN_MITER_CLIP:case d1.LINE_JOIN_MITER:o.lineJoin="miter";break;case d1.LINE_JOIN_ROUND:o.lineJoin="round";break;case d1.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(h.linecap){case ST.LINE_CAP_BUTT:o.lineCap="butt";break;case ST.LINE_CAP_ROUND:o.lineCap="round";break;case ST.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(m)}function RM(o,e,r,l,h=!1){if(e.stops.length===1){const N=e.stops[0];return Zy(N.rgb_color,N.opacity*r,l)}const{x1:m,y1:_,x2:v,y2:A}=e;let R=new DOMPoint(m,_),P=new DOMPoint(v,A);if(h){const N=Wy(e.transform);R=N.transformPoint(R),P=N.transformPoint(P)}const L=o.createLinearGradient(R.x,R.y,P.x,P.y);for(const N of e.stops)L.addColorStop(N.offset,Zy(N.rgb_color,N.opacity*r,l));return L}function MM(o,e,r,l,h=!1){if(e.stops.length===1){const te=e.stops[0];return Zy(te.rgb_color,te.opacity*r,l)}const m=Wy(e.transform),{fx:_,fy:v,fr:A,cx:R,cy:P,r:L}=e;let N=new DOMPoint(_,v),U=new DOMPoint(R,P),$=A,X=L;if(h){N=m.transformPoint(N),U=m.transformPoint(U);const te=(m.a+m.d)/2;$=A*te,X=e.r*te}const Q=o.createRadialGradient(N.x,N.y,$,U.x,U.y,X);for(const te of e.stops)Q.addColorStop(te.offset,Zy(te.rgb_color,te.opacity*r,l));return Q}function IM(o,e,r,l){const h=l.transform?Wy(l.transform).preMultiplySelf(e):e,m=Xv(o.canvas.width,o.canvas.height),_=m.getContext("2d");for(const A of l.children)if(A.group)IM(_,h,r,A.group);else if(A.path){const R=A.path,P=new Path2D;P.addPath(zM(R),h),_.fill(P,AM(R))}const v=l.clip_path_idx!=null?r.clip_paths[l.clip_path_idx]:null;v&&DM(_,h,r,v),o.globalCompositeOperation="source-over",o.drawImage(m,0,0)}function DM(o,e,r,l){const h=Xv(o.canvas.width,o.canvas.height);IM(h.getContext("2d"),e,r,l),o.globalCompositeOperation="destination-in",o.drawImage(h,0,0)}function PM(o,e,r,l,h){if(l.children.length===0)return;const m=l.mask_idx!=null?r.masks[l.mask_idx]:null;m&&PM(o,e,r,m,h);const _=o.canvas.width,v=o.canvas.height,A=Xv(_,v),R=A.getContext("2d"),P=l.width,L=l.height,N=l.left,U=l.top,$=new Path2D,X=new Path2D;X.rect(N,U,P,L),$.addPath(X,e),R.clip($);for(const ce of l.children)TM(R,e,r,ce,h);const Q=R.getImageData(0,0,_,v),te=Q.data;if(l.mask_type===vM.MASK_TYPE_LUMINANCE)for(let ce=0;ce<te.length;ce+=4)te[ce+3]=te[ce+3]/255*(.2126*te[ce]+.7152*te[ce+1]+.0722*te[ce+2]);R.putImageData(Q,0,0),o.globalCompositeOperation="destination-in",o.drawImage(A,0,0)}function Wy(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function OM(o,e){const r=o.step;let l=o.diffs[0]*r,h=o.diffs[1]*r;e.moveTo(l,h);for(let m=0,_=2;m<o.commands.length;m++)switch(o.commands[m]){case Wv.PATH_COMMAND_MOVE:l+=o.diffs[_++]*r,h+=o.diffs[_++]*r,e.moveTo(l,h);break;case Wv.PATH_COMMAND_LINE:l+=o.diffs[_++]*r,h+=o.diffs[_++]*r,e.lineTo(l,h);break;case Wv.PATH_COMMAND_QUAD:{const v=l+o.diffs[_++]*r,A=h+o.diffs[_++]*r;l=v+o.diffs[_++]*r,h=A+o.diffs[_++]*r,e.quadraticCurveTo(v,A,l,h);break}case Wv.PATH_COMMAND_CUBIC:{const v=l+o.diffs[_++]*r,A=h+o.diffs[_++]*r,R=v+o.diffs[_++]*r,P=A+o.diffs[_++]*r;l=R+o.diffs[_++]*r,h=P+o.diffs[_++]*r,e.bezierCurveTo(v,A,R,P,l,h);break}case Wv.PATH_COMMAND_CLOSE:e.closePath()}return e}function zM(o){return OM(o,new Path2D)}class m1{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}jt(m1,"LRUCache");class ET{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new go(e,e.data)}getFromCache(e,r,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new m1(150)),this.cacheMap.get(l).get(Od(e.toString(),r))}setInCache(e,r,l,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new m1(150));const m=this.cacheDependenciesMap.get(h),_=Od(e.id.toString(),l);m.get(_)||m.set(_,new Set);const v=this.cacheMap.get(h),A=e.toString();m.get(_).add(A),v.put(Od(e.toString(),l),r)}removeImagesFromCacheByIds(e,r,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const h=this.cacheMap.get(l),m=this.cacheDependenciesMap.get(l);for(const _ of e){const v=Od(_.toString(),r);if(m.has(v)){for(const A of m.get(v))h.delete(A);m.delete(v)}}}rasterize(e,r,l,h,m=i5){const _=this.getFromCache(e,l,h);if(_)return _.clone();const v=m(r.icon,e.options),A=ET._getImage(v);return this.setInCache(e,A,l,h),A.clone()}}class LM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const l=this.toIdx(e,r);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function NM(o,e,r,l){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(r[_]<o[_]||r[_]>e[_])return null}else{const v=1/l[_];let A=(o[_]-r[_])*v,R=(e[_]-r[_])*v;if(A>R){const P=A;A=R,R=P}if(A>h&&(h=A),R<m&&(m=R),h>m)return null}return h}function kM(o,e,r,l,h,m,_,v,A,R,P){const L=l-o,N=h-e,U=m-r,$=_-o,X=v-e,Q=A-r,te=P[1]*Q-P[2]*X,ce=P[2]*$-P[0]*Q,he=P[0]*X-P[1]*$,me=L*te+N*ce+U*he;if(Math.abs(me)<1e-15)return null;const Ie=1/me,Ee=R[0]-o,Ne=R[1]-e,Be=R[2]-r,Ue=(Ee*te+Ne*ce+Be*he)*Ie;if(Ue<0||Ue>1)return null;const ft=Ne*U-Be*N,Qe=Be*L-Ee*U,mt=Ee*N-Ne*L,wt=(P[0]*ft+P[1]*Qe+P[2]*mt)*Ie;return wt<0||Ue+wt>1?null:($*ft+X*Qe+Q*mt)*Ie}function jM(o,e,r){return(o-e)/(r-e)}function FM(o,e,r,l,h,m,_,v,A){const R=1<<r,P=m-l,L=_-h,N=(o+1)/R*P+l,U=(e+0)/R*L+h,$=(e+1)/R*L+h;v[0]=(o+0)/R*P+l,v[1]=U,A[0]=N,A[1]=$}class BM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=(function(m){const _=Math.ceil(Math.log2(m.dim/8)),v=[];let A=Math.ceil(Math.pow(2,_));const R=1/A,P=(U,$,X,Q,te)=>{const ce=Q?1:0,he=(U+1)*X-ce,me=$*X,Ie=($+1)*X-ce;te[0]=U*X,te[1]=me,te[2]=he,te[3]=Ie};let L=new LM(A);const N=[];for(let U=0;U<A*A;U++){P(U%A,Math.floor(U/A),R,!1,N);const $=Zm(N[0],N[1],m),X=Zm(N[2],N[1],m),Q=Zm(N[2],N[3],m),te=Zm(N[0],N[3],m);L.minimums.push(Math.min($,X,Q,te)),L.maximums.push(Math.max($,X,Q,te)),L.leaves.push(1)}for(v.push(L),A/=2;A>=1;A/=2){const U=v[v.length-1];L=new LM(A);for(let $=0;$<A*A;$++){P($%A,Math.floor($/A),2,!0,N);const X=U.getElevation(N[0],N[1]),Q=U.getElevation(N[2],N[1]),te=U.getElevation(N[2],N[3]),ce=U.getElevation(N[0],N[3]),he=U.isLeaf(N[0],N[1]),me=U.isLeaf(N[2],N[1]),Ie=U.isLeaf(N[2],N[3]),Ee=U.isLeaf(N[0],N[3]),Ne=Math.min(X.min,Q.min,te.min,ce.min),Be=Math.max(X.max,Q.max,te.max,ce.max),Ue=he&&me&&Ie&&Ee;L.maximums.push(Be),L.minimums.push(Ne),L.leaves.push(Be-Ne<=5&&Ue?1:0)}v.push(L)}return v})(this.dem),l=r.length-1,h=r[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(r,0,0,l,0)}raycastRoot(e,r,l,h,m,_,v=1){return NM([e,r,-100],[l,h,this.maximums[0]*v],m,_)}raycast(e,r,l,h,m,_,v=1){if(!this.nodeCount)return null;const A=this.raycastRoot(e,r,l,h,m,_,v);if(A==null)return null;const R=[],P=[],L=[],N=[],U=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:$,t:X,nodex:Q,nodey:te,depth:ce}=U.pop();if(this.leaves[$]){FM(Q,te,ce,e,r,l,h,L,N);const me=1<<ce,Ie=(Q+0)/me,Ee=(Q+1)/me,Ne=(te+0)/me,Be=(te+1)/me,Ue=Zm(Ie,Ne,this.dem)*v,ft=Zm(Ee,Ne,this.dem)*v,Qe=Zm(Ee,Be,this.dem)*v,mt=Zm(Ie,Be,this.dem)*v,wt=kM(L[0],L[1],Ue,N[0],L[1],ft,N[0],N[1],Qe,m,_),Dt=kM(N[0],N[1],Qe,L[0],N[1],mt,L[0],L[1],Ue,m,_),Xt=Math.min(wt!==null?wt:Number.MAX_VALUE,Dt!==null?Dt:Number.MAX_VALUE);if(Xt!==Number.MAX_VALUE)return Xt;{const Nt=Kt([],m,_,X);if(VM(Ue,ft,mt,Qe,jM(Nt[0],L[0],N[0]),jM(Nt[1],L[1],N[1]))>=Nt[2])return X}continue}let he=0;for(let me=0;me<this._siblingOffset.length;me++){FM((Q<<1)+this._siblingOffset[me][0],(te<<1)+this._siblingOffset[me][1],ce+1,e,r,l,h,L,N),L[2]=-100,N[2]=this.maximums[this.childOffsets[$]+me]*v;const Ie=NM(L,N,m,_);if(Ie!=null){const Ee=Ie;R[me]=Ee;let Ne=!1;for(let Be=0;Be<he&&!Ne;Be++)Ee>=R[P[Be]]&&(P.splice(Be,0,me),Ne=!0);Ne||(P[he]=me),he++}}for(let me=0;me<he;me++){const Ie=P[me];U.push({idx:this.childOffsets[$]+Ie,t:R[Ie],nodex:(Q<<1)+this._siblingOffset[Ie][0],nodey:(te<<1)+this._siblingOffset[Ie][1],depth:ce+1})}}return null}_addNode(e,r,l){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,l,h,m){if(e[h].isLeaf(r,l)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,v=e[_];let A=0,R=0;for(let P=0;P<this._siblingOffset.length;P++){const L=2*r+this._siblingOffset[P][0],N=2*l+this._siblingOffset[P][1],U=v.getElevation(L,N),$=v.isLeaf(L,N),X=this._addNode(U.min,U.max,$);$&&(A|=1<<P),R||(R=X)}for(let P=0;P<this._siblingOffset.length;P++)A&1<<P||this._construct(e,2*r+this._siblingOffset[P][0],2*l+this._siblingOffset[P][1],_,R+P)}}function VM(o,e,r,l,h,m){return Gn(Gn(o,r,m),Gn(e,l,m),h)}function Zm(o,e,r){const l=r.dim,h=se(o*l-.5,0,l-1),m=se(e*l-.5,0,l-1),_=Math.floor(h),v=Math.floor(m),A=Math.min(_+1,l-1),R=Math.min(v+1,l-1);return VM(r.get(_,v),r.get(A,v),r.get(_,R),r.get(A,R),h-_,m-v)}const r5={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function s5(o,e,r){return(256*o*256+256*e+r)/10-1e4}function o5(o,e,r){return 256*o+e+r/256-32768}class g1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,l,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Tn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,_=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let A=0;A<m;A++)_[this._idx(-1,A)]=_[this._idx(0,A)],_[this._idx(m,A)]=_[this._idx(m-1,A)],_[this._idx(A,-1)]=_[this._idx(A,0)],_[this._idx(A,m)]=_[this._idx(A,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)]}const v=l==="terrarium"?o5:s5;for(let A=0;A<_.length;++A){const R=4*A;this.floatView[A]=v(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=To.now()}_buildQuadTree(){this._tree=new BM(this)}get(e,r,l=!1){l&&(e=se(e,-1,this.dim),r=se(r,-1,this.dim));const h=this._idx(e,r);return this.floatView[h]}set(e,r,l){const h=this._idx(e,r),m=this.floatView[h];return this.floatView[h]=l,l-m}static getUnpackVector(e){return r5[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const l=[0,0,0,0],h=g1.getUnpackVector(r);let m=Math.floor((e+h[3])/h[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new av({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,m=r*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(r){case-1:h=m-1;break;case 1:m=h+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const A=-r*this.dim,R=-l*this.dim;for(let P=_;P<v;P++)for(let L=h;L<m;L++){const N=4*this._idx(L,P),U=4*this._idx(L+A,P+R);this.pixels[N+0]=e.pixels[U+0],this.pixels[N+1]=e.pixels[U+1],this.pixels[N+2]=e.pixels[U+2],this.pixels[N+3]=e.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function a5(o,e,r){o===1?e.headerLength=r.readFixed32():o===2?e.x=r.readVarint():o===3?e.y=r.readVarint():o===4?e.z=r.readVarint():o===5&&e.layers.push((function(l,h){return l.readFields(h5,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(r,r.readVarint()+r.pos))}function l5(o,e,r){o===1?(e.delta_filter=(function(l,h){return l.readFields(c5,{blockSize:0},h)})(r,r.readVarint()+r.pos),e.filter="delta_filter"):o===2?(r.readVarint(),e.filter="zigzag_filter"):o===3?(r.readVarint(),e.filter="bitshuffle_filter"):o===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function c5(o,e,r){o===1&&(e.blockSize=r.readVarint())}function u5(o,e,r){o===1?(r.readVarint(),e.codec="gzip_data"):o===2?(r.readVarint(),e.codec="jpeg_image"):o===3?(r.readVarint(),e.codec="webp_image"):o===4&&(r.readVarint(),e.codec="png_image")}function d5(o,e,r){let l=0,h=0;o===1?e.firstByte=r.readFixed64():o===2?e.lastByte=r.readFixed64():o===3?e.filters.push((function(m,_){return m.readFields(l5,{},_)})(r,r.readVarint()+r.pos)):o===4?e.codec=(function(m,_){return m.readFields(u5,{},_)})(r,r.readVarint()+r.pos):o===5?h=r.readFloat():o===6?l=r.readFloat():o===7?e.bands.push(r.readString()):o===8?e.offset=r.readDouble():o===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=l)}function h5(o,e,r){o===1?e.version=r.readVarint():o===2?e.name=r.readString():o===3?e.units=r.readString():o===4?e.tileSize=r.readVarint():o===5?e.buffer=r.readVarint():o===6?e.pixelFormat=r.readVarint():o===7&&e.dataIndex.push((function(l,h){return l.readFields(d5,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(r,r.readVarint()+r.pos))}function f5(o,e,r){if(o===2)(function(l,h,m){l.readFields(p5,m,h)})(r,r.readVarint()+r.pos,e);else if(o===3)throw new Error("Not implemented")}function p5(o,e,r){if(o===1){let l=0;const h=r.readVarint()+r.pos;for(;r.pos<h;)e[l++]=r.readVarint()}}function m5(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let l=2;l>=1;l--){const h=l===1?1:0,m=l===2?1:0;for(let _=0;_<e[0];_++){const v=e[1]*_;for(let A=h;A<e[1];A++){const R=e[2]*(A+v);for(let P=m;P<e[2];P++){const L=e[3]*(P+R);for(let N=0;N<e[3];N++){const U=L+N;o[U]+=o[U-r]}}}}r*=e[l]}return o}function g5(o){for(let e=0,r=o.length;e<r;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function _5(o,e){switch(e){case"uint32":return o;case"uint16":for(let r=0;r<o.length;r+=2){const l=o[r],h=o[r+1];o[r]=(240&l)>>4|(61440&l)>>8|(240&h)<<4|61440&h,o[r+1]=15&l|(3840&l)>>4|(15&h)<<8|(3840&h)<<4}return o;case"uint8":for(let r=0;r<o.length;r+=4){const l=o[r],h=o[r+1],m=o[r+2],_=o[r+3];o[r+0]=(192&l)>>6|(192&h)>>4|(192&m)>>2|192&_,o[r+1]=(48&l)>>4|(48&h)>>2|48&m|(48&_)<<2,o[r+2]=(12&l)>>2|12&h|(12&m)<<2|(12&_)<<4,o[r+3]=3&l|(3&h)<<2|(3&m)<<4|(3&_)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}jt(g1,"DEMData"),jt(BM,"DemMinMaxQuadTree",{omit:["dem"]});var au=Uint8Array,Kv=Uint16Array,y5=Int32Array,UM=new au([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$M=new au([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),x5=new au([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),GM=function(o,e){for(var r=new Kv(31),l=0;l<31;++l)r[l]=e+=1<<o[l-1];var h=new y5(r[30]);for(l=1;l<30;++l)for(var m=r[l];m<r[l+1];++m)h[m]=m-r[l]<<5|l;return{b:r,r:h}},HM=GM(UM,2),qM=HM.b,v5=HM.r;qM[28]=258,v5[258]=28;for(var b5=GM($M,0).b,ZM=new Kv(32768),ao=0;ao<32768;++ao){var Xy=(43690&ao)>>1|(21845&ao)<<1;ZM[ao]=((65280&(Xy=(61680&(Xy=(52428&Xy)>>2|(13107&Xy)<<2))>>4|(3855&Xy)<<4))>>8|(255&Xy)<<8)>>1}var Yv=function(o,e,r){for(var l=o.length,h=0,m=new Kv(e);h<l;++h)o[h]&&++m[o[h]-1];var _,v=new Kv(e);for(h=1;h<e;++h)v[h]=v[h-1]+m[h-1]<<1;_=new Kv(1<<e);var A=15-e;for(h=0;h<l;++h)if(o[h])for(var R=h<<4|o[h],P=e-o[h],L=v[o[h]-1]++<<P,N=L|(1<<P)-1;L<=N;++L)_[ZM[L]>>A]=R;return _},Qv=new au(288);for(ao=0;ao<144;++ao)Qv[ao]=8;for(ao=144;ao<256;++ao)Qv[ao]=9;for(ao=256;ao<280;++ao)Qv[ao]=7;for(ao=280;ao<288;++ao)Qv[ao]=8;var WM=new au(32);for(ao=0;ao<32;++ao)WM[ao]=5;var w5=Yv(Qv,9),S5=Yv(WM,5),AT=function(o){for(var e=o[0],r=1;r<o.length;++r)o[r]>e&&(e=o[r]);return e},th=function(o,e,r){var l=e/8|0;return(o[l]|o[l+1]<<8)>>(7&e)&r},CT=function(o,e){var r=e/8|0;return(o[r]|o[r+1]<<8|o[r+2]<<16)>>(7&e)},T5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],nh=function(o,e,r){var l=new Error(e||T5[o]);if(l.code=o,Error.captureStackTrace&&Error.captureStackTrace(l,nh),!r)throw l;return l},E5=new au(0),A5=typeof TextDecoder<"u"&&new TextDecoder;try{A5.decode(E5,{stream:!0})}catch{}const C5={gzip_data:"gzip"};class $u extends Error{constructor(e){super(e),this.name="MRTError"}}const R5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},XM={uint32:1,uint16:2,uint8:4},M5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let RT;class _1{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new $u(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),l=new DataView(e);if(r[0]!==13)throw new $u("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),l=this.getHeaderLength(e);if(r.length<l)throw new $u(`Expected header with length >= ${l} but got buffer of length ${r.length}`);const h=new RT(r.subarray(0,l)).readFields(a5,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new $u(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const m of h.layers)this.layers[m.name]=new KM(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],l=this.getLayer(e.layerName);for(let h of e.blockIndices){const m=l.dataIndex[h],_=m.firstByte-e.firstByte,v=m.lastByte-e.firstByte;if(l._blocksInProgress.has(h))continue;const A={layerName:l.name,firstByte:_,lastByte:v,pixelFormat:l.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(l.bandShape),buffer:l.buffer,codec:m.codec.codec,filters:m.filters.map((R=>R.filter))};l._blocksInProgress.add(h),r.push(A)}return new YM(r,(()=>{r.forEach((h=>l._blocksInProgress.delete(h.blockIndex)))}),((h,m)=>{if(r.forEach((_=>l._blocksInProgress.delete(_.blockIndex))),h)throw h;m.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class KM{constructor({version:e,name:r,units:l,tileSize:h,pixelFormat:m,buffer:_,dataIndex:v},A){if(this.version=e,this.version!==1)throw new $u(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=l,this.tileSize=h,this.buffer=_,this.pixelFormat=R5[m],this.dataIndex=v,this.bandShape=[h+2*_,h+2*_,XM[this.pixelFormat]],this._decodedBlocks=new m1(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return XM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[l,h]of this.dataIndex.entries()){for(const[m,_]of h.bands.entries())if(_===e)return{bandIndex:r+m,blockIndex:l,blockBandIndex:m};r+=h.bands.length}break;case"number":for(const[l,h]of this.dataIndex.entries()){if(e>=r&&e<r+h.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-r};r+=h.bands.length}break;default:throw new $u(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,l=-1/0;const h=[],m=new Set;for(const _ of e){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new $u(`Invalid band: ${JSON.stringify(_)}`);const A=this.dataIndex[v];h.includes(v)||h.push(v),m.add(v),r=Math.min(r,A.firstByte),l=Math.max(l,A.lastByte)}if(m.size>this.cacheSize)throw new $u(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:l,blockIndices:h}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:l}=this.getBlockForBand(e);if(r<0)throw new $u(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(r.toString());if(!h)throw new $u(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[r],_=this.bandShape.reduce(((R,P)=>R*P),1),v=l*_,A=h.subarray(v,v+_);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}_1.setPbf=function(o){RT=o};class YM{constructor(e,r,l){this.tasks=e,this._onCancel=r,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}_1.performDecoding=function(o,e){const r=new Uint8Array(o);return Promise.all(e.tasks.map((l=>{const{layerName:h,firstByte:m,lastByte:_,pixelFormat:v,blockShape:A,blockIndex:R,filters:P,codec:L}=l,N=r.subarray(m,_+1),U=new Uint32Array(A[0]*A[1]*A[2]);let $;if(L!=="gzip_data")throw new $u(`Unhandled codec: ${L}`);return $=(function(X,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve(((me=(function(Ne){Ne[0]==31&&Ne[1]==139&&Ne[2]==8||nh(6,"invalid gzip data");var Be=Ne[3],Ue=10;4&Be&&(Ue+=2+(Ne[10]|Ne[11]<<8));for(var ft=(Be>>3&1)+(Be>>4&1);ft>0;ft-=!Ne[Ue++]);return Ue+(2&Be)})(he=X))+8>he.length&&nh(6,"invalid gzip data"),(function(Ne,Be,Ue,ft){var Qe=Ne.length;if(!Qe||Be.f&&!Be.l)return Ue||new au(0);var mt=!Ue,wt=mt||Be.i!=2,Dt=Be.i;mt&&(Ue=new au(3*Qe));var Xt,Nt,Tt=function(ms){var Wr=Ue.length;if(ms>Wr){var Pr=new au(Math.max(2*Wr,ms));Pr.set(Ue),Ue=Pr}},Lt=Be.f||0,ht=Be.p||0,lt=Be.b||0,zt=Be.l,Zt=Be.d,At=Be.m,gn=Be.n,bn=8*Qe;do{if(!zt){Lt=th(Ne,ht,1);var hn=th(Ne,ht+1,3);if(ht+=3,!hn){var an=Ne[(Ae=4+((ht+7)/8|0))-4]|Ne[Ae-3]<<8,Qn=Ae+an;if(Qn>Qe){Dt&&nh(0);break}wt&&Tt(lt+an),Ue.set(Ne.subarray(Ae,Qn),lt),Be.b=lt+=an,Be.p=ht=8*Qn,Be.f=Lt;continue}if(hn==1)zt=w5,Zt=S5,At=9,gn=5;else if(hn==2){var dn=th(Ne,ht,31)+257,kn=th(Ne,ht+10,15)+4,ei=dn+th(Ne,ht+5,31)+1;ht+=14;for(var yi=new au(ei),$i=new au(19),ri=0;ri<kn;++ri)$i[x5[ri]]=th(Ne,ht+3*ri,7);ht+=3*kn;var Qi=AT($i),Ji=(1<<Qi)-1,rs=Yv($i,Qi);for(ri=0;ri<ei;){var Ae,we=rs[th(Ne,ht,Ji)];if(ht+=15&we,(Ae=we>>4)<16)yi[ri++]=Ae;else{var yt=0,en=0;for(Ae==16?(en=3+th(Ne,ht,3),ht+=2,yt=yi[ri-1]):Ae==17?(en=3+th(Ne,ht,7),ht+=3):Ae==18&&(en=11+th(Ne,ht,127),ht+=7);en--;)yi[ri++]=yt}}var xt=yi.subarray(0,dn),ln=yi.subarray(dn);At=AT(xt),gn=AT(ln),zt=Yv(xt,At),Zt=Yv(ln,gn)}else nh(1);if(ht>bn){Dt&&nh(0);break}}wt&&Tt(lt+131072);for(var Rn=(1<<At)-1,Cn=(1<<gn)-1,oi=ht;;oi=ht){var qn=(yt=zt[CT(Ne,ht)&Rn])>>4;if((ht+=15&yt)>bn){Dt&&nh(0);break}if(yt||nh(2),qn<256)Ue[lt++]=qn;else{if(qn==256){oi=ht,zt=null;break}var Sn=qn-254;qn>264&&(Sn=th(Ne,ht,(1<<(Wn=UM[ri=qn-257]))-1)+qM[ri],ht+=Wn);var Ki=Zt[CT(Ne,ht)&Cn],_r=Ki>>4;if(Ki||nh(3),ht+=15&Ki,ln=b5[_r],_r>3){var Wn=$M[_r];ln+=CT(Ne,ht)&(1<<Wn)-1,ht+=Wn}if(ht>bn){Dt&&nh(0);break}wt&&Tt(lt+131072);var ki=lt+Sn;if(lt<ln){var yr=0-ln,lr=Math.min(ln,ki);for(yr+lt<0&&nh(3);lt<lr;++lt)Ue[lt]=(void 0)[yr+lt]}for(;lt<ki;++lt)Ue[lt]=Ue[lt-ln]}}Be.l=zt,Be.p=oi,Be.b=lt,Be.f=Lt,zt&&(Lt=1,Be.m=At,Be.d=Zt,Be.n=gn)}while(!Lt);return lt!=Ue.length&&mt?(Xt=Ue,((Nt=lt)==null||Nt>Xt.length)&&(Nt=Xt.length),new au(Xt.subarray(0,Nt))):Ue.subarray(0,lt)})(he.subarray(me,-8),{i:2},new au(((te=he)[(ce=te.length)-4]|te[ce-3]<<8|te[ce-2]<<16|te[ce-1]<<24)>>>0))));var te,ce,he,me;const Ie=C5[Q];if(!Ie)throw new Error(`Unhandled codec: ${Q}`);const Ee=new globalThis.DecompressionStream(Ie);return new Response(new Blob([X]).stream().pipeThrough(Ee)).arrayBuffer().then((Ne=>new Uint8Array(Ne)))})(N,L).then((X=>((function(Q,te){Q.readFields(f5,te)})(new RT(X),U),new M5[v](U.buffer)))),$.then((X=>{for(let Q=P.length-1;Q>=0;Q--)switch(P[Q]){case"delta_filter":m5(X,A);break;case"zigzag_filter":g5(X);break;case"bitshuffle_filter":_5(X,v);break;default:throw new $u(`Unhandled filter "${P[Q]}"`)}return{layerName:h,blockIndex:R,data:X}})).catch((X=>{throw X}))})))},jt(YM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),jt(_1,"MapboxRasterTile"),jt(KM,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class QM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class JM{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Sc(qt,16,0),this.featureIndexArray=new yp,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,l,h,m,_=0,v=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,m,_);const R=this.grid;for(let P=0;P<r.length;P++){const L=r[P],N=[1/0,1/0,-1/0,-1/0];for(let U=0;U<L.length;U++){const $=L[U];N[0]=Math.min(N[0],$.x),N[1]=Math.min(N[1],$.y),N[2]=Math.max(N[2],$.x),N[3]=Math.max(N[3],$.y)}v!==0&&(N[0]-=v,N[1]-=v,N[2]+=v,N[3]+=v),N[0]<qt&&N[1]<qt&&N[2]>=0&&N[3]>=0&&R.insert(A,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jt(new Zb(this.rawTileData)).layers,this.sourceLayerCoder=new QM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:l,transform:h,tileTransform:m,pixelPosMatrix:_,availableImages:v,worldview:A}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const R=r.queryRadius?r.queryRadius:0,P=l.bufferedTilespaceBounds,L=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,((X,Q,te,ce)=>Er(l.bufferedTilespaceGeometry,X-R,Q-R,te+R,ce+R)));L.sort(I5);let N=null;h.elevation&&L.length>0&&(N=qy.create(h.elevation,this.tileID));const U={};let $;for(let X=0;X<L.length;X++){const Q=L[X];if(Q===$)continue;$=Q;const te=this.featureIndexArray.get(Q);let ce=null;this.is3DTile?this.loadMatchingModelFeature(U,te,e,l,h,A):this.loadMatchingFeature(U,te,e,v,A,((he,me,Ie,Ee=0)=>(ce||(ce=_t(he,this.tileID.canonical,m)),me.queryIntersectsFeature(l,he,Ie,ce,this.z,h,_,N,Ee))))}return U}loadMatchingFeature(e,r,l,h,m,_){const{featureIndex:v,bucketIndex:A,sourceLayerIndex:R,layoutVertexArrayOffset:P}=r,L=this.bucketLayerIDs[A],N=l.layers,U=Object.keys(N);if(U.length&&!$n(U,L))return;const $=l.sourceCache,X=this.sourceLayerCoder.decode(R),Q=this.vtLayers[X].feature(v),te=this.getId(Q,X);for(let ce=0;ce<L.length;ce++){const he=L[ce];if(!N[he])continue;const{styleLayer:me,targets:Ie}=N[he];let Ee={};te!==void 0&&(Ee=$.getFeatureState(me.sourceLayer,te));const Ne=!_||_(Q,me,Ee,P);if(!Ne)continue;const Be=new v_(Q,this.z,this.x,this.y,te);Be.tile=this.tileID.canonical,Be.state=Ee;let Ue=this.serializedLayersCache.get(he);Ue||(Ue=me.serialize(),Ue.id=he,this.serializedLayersCache.set(he,Ue)),Be.source=Ue.source,Be.sourceLayer=Ue["source-layer"],Be.layer=Object.assign({},Ue),Be.layer.paint=eI(Ue.paint,me.paint,Q,Ee,h),Be.layer.layout=eI(Ue.layout,me.layout,Q,Ee,h);let ft=!1;for(const Qe of Ie){this.updateFeatureProperties(Be,Qe);const{filter:mt}=Qe;if(mt){if(Q.properties=Be.properties,mt.needGeometry){const wt=rt(Q,!0);if(!mt.filter(new ir(this.tileID.overscaledZ,{worldview:m}),wt,this.tileID.canonical))continue}else if(!mt.filter(new ir(this.tileID.overscaledZ,{worldview:m}),Q))continue}ft=!0,Qe.targetId&&this.addFeatureVariant(Be,Qe)}ft&&this.appendToResult(e,he,v,Be,Ne)}}loadMatchingModelFeature(e,r,l,h,m,_){const{featureIndex:v,bucketIndex:A}=r,R=this.bucketLayerIDs[A],P=l.layers,L=Object.keys(P);if(!L.length||$n(L,R))for(let N=0;N<R.length;N++){const U=R[N],{styleLayer:$,targets:X}=P[U];if($.type!=="model")continue;const Q=h.tile,te=Q.getBucket($);if(!(te&&te instanceof u1))continue;const ce=N4(te,v,h,m);if(!ce)continue;const{z:he,x:me,y:Ie}=Q.tileID.canonical,{feature:Ee,intersectionZ:Ne,position:Be}=ce;let Ue={};Ee.id!==void 0&&(Ue=l.sourceCache.getFeatureState($.sourceLayer,Ee.id));const ft=new v_({},he,me,Ie,Ee.id);ft.tile=this.tileID.canonical,ft.state=Ue,ft.properties=Ee.properties,ft.geometry={type:"Point",coordinates:[Be.lng,Be.lat]};let Qe=this.serializedLayersCache.get(U);Qe||(Qe=$.serialize(),Qe.id=U,this.serializedLayersCache.set(U,Qe)),ft.source=Qe.source,ft.sourceLayer=Qe["source-layer"],ft.layer=Object.assign({},Qe);let mt=!1;for(const wt of X){this.updateFeatureProperties(ft,wt);const{filter:Dt}=wt;if(Dt){if(Ee.properties=ft.properties,Dt.needGeometry){if(!Dt.filter(new ir(this.tileID.overscaledZ,{worldview:_}),Ee,this.tileID.canonical))continue}else if(!Dt.filter(new ir(this.tileID.overscaledZ,{worldview:_}),Ee))continue}mt=!0,wt.targetId&&this.addFeatureVariant(ft,wt)}mt&&this.appendToResult(e,U,v,ft,Ne)}}updateFeatureProperties(e,r,l){if(r.properties){const h={};for(const m in r.properties){const _=r.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);_!=null&&(h[m]=_)}e.properties=h}}addFeatureVariant(e,r,l){const h={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(h)}appendToResult(e,r,l,h,m){let _=e[r];_===void 0&&(_=e[r]=[]),_.push({featureIndex:l,feature:h,intersectionZ:m})}lookupSymbolFeatures(e,r,l,h,m,_){const v={};this.loadVTLayers();for(const A of e)this.loadMatchingFeature(v,{bucketIndex:r,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},h,m,_);return v}loadFeature(e){const{featureIndex:r,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),m=this.vtFeatures[h];if(m[r])return m[r];const _=this.vtLayers[h].feature(r);return m[r]=_,_}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const m=bl(h);if(m.result!=="success"){const _=m.value.map((v=>`${v.key}: ${v.message}`)).join(", ");return void Tn(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=m.value}l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[h];typeof l=="boolean"&&(l=Number(l))}return l}}function eI(o,e,r,l,h){return Bt(o,((m,_)=>{const v=e instanceof Pu?e.get(_):null;return v&&v.evaluate?v.evaluate(r,l,void 0,h):v}))}function I5(o,e){return e-o}jt(JM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const tI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class MT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=tI[15&l];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new MT(v,_,m,e)}constructor(e,r=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=tI.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+A,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+A),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+A,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return IT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:v}=this,A=[0,m.length-1,0],R=[];for(;A.length;){const P=A.pop()||0,L=A.pop()||0,N=A.pop()||0;if(L-N<=v){for(let Q=N;Q<=L;Q++){const te=_[2*Q],ce=_[2*Q+1];te>=e&&te<=l&&ce>=r&&ce<=h&&R.push(m[Q])}continue}const U=N+L>>1,$=_[2*U],X=_[2*U+1];$>=e&&$<=l&&X>=r&&X<=h&&R.push(m[U]),(P===0?e<=$:r<=X)&&(A.push(N),A.push(U-1),A.push(1-P)),(P===0?l>=$:h>=X)&&(A.push(U+1),A.push(L),A.push(1-P))}return R}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:_}=this,v=[0,h.length-1,0],A=[],R=l*l;for(;v.length;){const P=v.pop()||0,L=v.pop()||0,N=v.pop()||0;if(L-N<=_){for(let Q=N;Q<=L;Q++)iI(m[2*Q],m[2*Q+1],e,r)<=R&&A.push(h[Q]);continue}const U=N+L>>1,$=m[2*U],X=m[2*U+1];iI($,X,e,r)<=R&&A.push(h[U]),(P===0?e-l<=$:r-l<=X)&&(v.push(N),v.push(U-1),v.push(1-P)),(P===0?e+l>=$:r+l>=X)&&(v.push(U+1),v.push(L),v.push(1-P))}return A}}function IT(o,e,r,l,h,m){if(h-l<=r)return;const _=l+h>>1;nI(o,e,_,l,h,m),IT(o,e,r,l,_-1,1-m),IT(o,e,r,_+1,h,1-m)}function nI(o,e,r,l,h,m){for(;h>l;){if(h-l>600){const R=h-l+1,P=r-l+1,L=Math.log(R),N=.5*Math.exp(2*L/3),U=.5*Math.sqrt(L*N*(R-N)/R)*(P-R/2<0?-1:1);nI(o,e,r,Math.max(l,Math.floor(r-P*N/R+U)),Math.min(h,Math.floor(r+(R-P)*N/R+U)),m)}const _=e[2*r+m];let v=l,A=h;for(Jv(o,e,l,r),e[2*h+m]>_&&Jv(o,e,l,h);v<A;){for(Jv(o,e,v,A),v++,A--;e[2*v+m]<_;)v++;for(;e[2*A+m]>_;)A--}e[2*l+m]===_?Jv(o,e,l,A):(A++,Jv(o,e,A,h)),A<=r&&(l=A+1),r<=A&&(h=A-1)}}function Jv(o,e,r,l){DT(o,r,l),DT(e,2*r,2*l),DT(e,2*r+1,2*l+1)}function DT(o,e,r){const l=o[e];o[e]=o[r],o[r]=l}function iI(o,e,r,l){const h=o-r,m=e-l;return h*h+m*m}s.$=jf,s.A=oc,s.B=Od,s.C=2,s.D=Oe,s.E=Bc,s.F=Lv,s.G=MR,s.H=Mh,s.I=Vs,s.J=lm,s.K=cd,s.L=Ih,s.M=Ru,s.N=Vh,s.O=vc,s.P=Ct,s.Q=$h,s.R=Ll,s.S=Md,s.T=VS,s.U=bl,s.V=c1,s.W=wc,s.X=hs,s.Y=vd,s.Z=ro,s._=Wo,s.a=function(o){return Ir.API_CDN_URL_REGEX.test(o)},s.a$=zd,s.a0=Hn,s.a1=xg,s.a2=Ou,s.a3=class extends c1{},s.a4=Uh,s.a5=xc,s.a6=Ye,s.a7=function(o){const e=o.value;return e?Hn(e)?_T(e,!0)?[]:[new c1(o.key,e,`invalid url "${e}"`)]:[new c1(o.key,e,`string expected, "${cd(e)}" found`)]:[]},s.a8=om,s.a9=ss,s.aA=se,s.aB=pe,s.aC=yn,s.aD=Hr,s.aE=oo,s.aF=ae,s.aG=dt,s.aH=function(o,e){const r={};for(let l=0;l<e.length;l++){const h=e[l];h in o&&(r[h]=o[h])}return r},s.aI=V,s.aJ=re,s.aK=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,r,l){const h=this.entries[o]=this.entries[o]||{callbacks:[]};if(h.result){const[m,_]=h.result;return this.scheduler?this.scheduler.add((()=>{l(m,_)}),e):l(m,_),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=r(((m,_)=>{h.result=[m,_];for(const v of h.callbacks)this.scheduler?this.scheduler.add((()=>{v(m,_)}),e):v(m,_);setTimeout((()=>delete this.entries[o]),3e3)}))),()=>{h.result||(h.callbacks=h.callbacks.filter((m=>m!==l)),h.callbacks.length||(h.cancel(),delete this.entries[o]))}}},s.aL=function(o,e,r){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},(h=>{const m=Ya(o.request,((_,v,A)=>{_?h(_):v&&h(null,{vectorTile:r?void 0:new Jt(new Zb(v)),rawData:v,responseHeaders:new Map(A.entries())})}));return()=>{m.cancel(),h()}}),e)},s.aM=function(o){return o?{cacheControl:o.get("Cache-Control"),expires:o.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=function(o){hl++,hl>ia&&(o.getActor().send("enforceCacheSizeLimit",Mf),hl=0)},s.aO=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log2(o)))},s.aP=Gs,s.aQ=rM,s.aR=uM,s.aS=G,s.aT=iM,s.aU=function(o,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<o.length;l++){const h=document.createElement("source");Fi(o[l])||(r.crossOrigin="Anonymous"),h.src=o[l],r.appendChild(h)}return{cancel:()=>{}}},s.aV=Iv,s.aW=b_,s.aX=nt,s.aY=Fv,s.aZ=ye,s.a_=fe,s.aa=Vt,s.ab=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return Hi(o.expression.evaluate(e))}interpolate(o,e,r){return{x:Gn(o.x,e.x,r),y:Gn(o.y,e.y,r),z:Gn(o.z,e.z,r),azimuthal:Gn(o.azimuthal,e.azimuthal,r),polar:Gn(o.polar,e.polar,r)}}},s.ac=ir,s.ad=Eo,s.ae=Xe,s.af=Ri,s.ag=on,s.ah=ve,s.ai=Pu,s.aj=wa,s.ak=Gn,s.al=qt,s.am=Of,s.an=fi,s.ao=nr,s.ap=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return(function([r,l]){const h=Hi([1,r,l]);return{x:h.x,y:h.y,z:h.z}})(o.expression.evaluate(e))}interpolate(o,e,r){return{x:Gn(o.x,e.x,r),y:Gn(o.y,e.y,r),z:Gn(o.z,e.z,r)}}},s.aq=function(o,e,r=0,l=!0){const h=new Ct(r,r),m=o.sub(h),_=e.add(h),v=[m,new Ct(_.x,m.y),_,new Ct(m.x,_.y)];return l&&v.push(m.clone()),v},s.ar=function(o,e){const r=[];for(let l=0;l<o.length;l++){const h=je(l-1,-1,o.length-1),m=je(l+1,-1,o.length-1),_=o[l],v=o[m],A=o[h].sub(_).unit(),R=v.sub(_).unit(),P=R.angleWithSep(A.x,A.y),L=A.add(R).unit().mult(-1*e/Math.sin(P/2));r.push(_.add(L))}return r},s.as=UR,s.at=Er,s.au=function(o,e,r=0){return Ke(((e.x-r)*o.scale-o.x)*qt,(e.y*o.scale-o.y)*qt,Ce(e.z,e.y))},s.av=ti,s.aw=An,s.ax=Xn,s.ay=nR,s.az=function(o){let e=1/0,r=1/0,l=-1/0,h=-1/0;for(const m of o)e=Math.min(e,m.x),r=Math.min(r,m.y),l=Math.max(l,m.x),h=Math.max(h,m.y);return{min:new Ct(e,r),max:new Ct(l,h)}},s.b=function(o){return Ir.API_FONTS_REGEX.test(o)},s.b$=bv,s.b0=kr,s.b1=at,s.b2=zg,s.b3=s1,s.b4=function(){la.isLoading()||la.isLoaded()||Cd()!=="deferred"||Wh()},s.b5=lp,s.b6=rt,s.b7=v_,s.b8=Ps,s.b9=XS,s.bA=Le,s.bB=oe,s.bC=function(o,e){const{x:r,y:l}=o.point,h=Gd(r,l,o.worldSize/o._pixelsPerMercatorPixel,0,0);return pe(h,h,Yg(ru(e)))},s.bD=j,s.bE=wr,s.bF=zn,s.bG=Kt,s.bH=gi,s.bI=In,s.bJ=Vy,s.bK=Wl,s.bL=iT,s.bM=function(o,e,r,l,h){const m=5*e+2;o.float32[m+0]=r,o.float32[m+1]=l,o.float32[m+2]=h},s.bN=Hy,s.bO=lo,s.bP=Ia,s.bQ=Za,s.bR=Ho,s.bS=je,s.bT=function(o,e,r,l){var h=new z(4);return h[0]=o,h[1]=e,h[2]=r,h[3]=l,h},s.bU=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const r=e.getSource().maxzoom,l=1<<r,h=Math.floor(o.x),m=Math.floor((o.x-h)*l),_=Math.floor(o.y*l),v=this.findDEMTileFor(new Gs(r,h,r,m,_));return!(!v||!v.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||o.y<0||o.y>1)return e;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(o.x),v=o.x-_,A=new Gs(h,_,h,Math.floor(v*m),Math.floor(o.y*m)),R=this.findDEMTileFor(A);if(!R||!R.dem)return e;const P=R.dem,L=1<<R.tileID.canonical.z,N=(v*L-R.tileID.canonical.x)*P.dim,U=(o.y*L-R.tileID.canonical.y)*P.dim,$=Math.floor(N),X=Math.floor(U);return(r?this.exaggeration():1)*Gn(Gn(P.get($,X),P.get($,X+1),U-X),Gn(P.get($+1,X),P.get($+1,X+1),U-X),N-$)}static getAtTileOffset(o,e,r,l){const h=1<<o.canonical.z;return l?l.pointElevation(e):r?r.getAtPointOrZero(new Xe(o.wrap+(o.canonical.x+e.x/qt)/h,(o.canonical.y+e.y/qt)/h)):0}static getAtTileOffsetFunc(o,e,r,l){return(h,m,_)=>{const v=this.getAtTileOffset(o,h,m,_),A=l.upVector(o.canonical,h.x,h.y);return vt(A,A,v*l.upVectorScale(o.canonical,e,r).metersToTile),A}}getForTilePoints(o,e,r,l){if(this.isUsingMockSource())return!1;const h=qy.create(this,o,l);return!!h&&(e.forEach((m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],r)})),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const r=e.dem.tree,l=e.tileID,h=1<<o.canonical.z-l.canonical.z;let m=o.canonical.x/h-l.canonical.x,_=o.canonical.y/h-l.canonical.y,v=0;for(let A=0;A<o.canonical.z-l.canonical.z&&!r.leaves[v];A++){m*=2,_*=2;const R=2*Math.floor(_)+Math.floor(m);v=r.childOffsets[v]+R,m%=1,_%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,r=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const h of o){const m=this.getMinMaxForTile(h.tileID);m&&(r=Math.min(r,m.min),l=Math.max(l,m.max),e=!0)}return e?{min:r,max:l}:null}},s.bV=Yd,s.bW=Dr,s.bX=Bo,s.bY=s_,s.bZ=dM,s.b_=Py,s.ba=_v,s.bb=_t,s.bc=ba,s.bd=gp,s.be=Jx,s.bf=Br,s.bg=Mm,s.bh=mT,s.bi=function(o,e){const r=wa(e.zoom);if(r===0)return ru(o);const l=Wg(o),h=tv(l),m=ae(l.getWest())*e.worldSize,_=ae(l.getEast())*e.worldSize,v=re(l.getNorth())*e.worldSize,A=re(l.getSouth())*e.worldSize,R=[m,v,0],P=[_,v,0],L=[m,A,0],N=[_,A,0],U=ge([],e.globeMatrix);return Ri(R,R,U),Ri(P,P,U),Ri(L,L,U),Ri(N,N,U),h[0]=Ur(h[0],L,r),h[1]=Ur(h[1],N,r),h[2]=Ur(h[2],P,r),h[3]=Ur(h[3],R,r),di.fromPoints(h)},s.bj=$d,s.bk=ge,s.bl=Xg,s.bm=Ur,s.bn=eu,s.bo=cb,s.bp=$e,s.bq=_e,s.br=_1,s.bs=Zb,s.bt=Ya,s.bu=function(o,e){const r=[];for(const l in o)l in e||r.push(l);return r},s.bv=ke,s.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bx=Rs,s.by=ee,s.bz=le,s.c=So,s.c$=function(o){return o*o*o*o*o},s.c0=tT,s.c1=NR,s.c2=lT,s.c3=MT,s.c4=vt,s.c5=et,s.c6=ci,s.c7=function(o,e,r){r*=.5;var l=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(r),A=Math.cos(r);return o[0]=l*A+h*v,o[1]=h*A-l*v,o[2]=m*A+_*v,o[3]=_*A-m*v,o},s.c8=Yi,s.c9=ds,s.cA=qi,s.cB=BC,s.cC=al,s.cD=db,s.cE=function(o,e,r,l,h,m,_,v,A){if(A.name==="globe")return db(o,e,new al(r,l,h),!1);const R=Fv({z:r,x:l,y:h},A);return new di([(m+R.x/R.scale)*e,e*(R.y/R.scale),_],[(m+R.x2/R.scale)*e,e*(R.y2/R.scale),v])},s.cF=function(o,e,r){return o[0]=Math.min(e[0],r[0]),o[1]=Math.min(e[1],r[1]),o[2]=Math.min(e[2],r[2]),o[3]=Math.min(e[3],r[3]),o},s.cG=function(o,e,r){return o[0]=Math.max(e[0],r[0]),o[1]=Math.max(e[1],r[1]),o[2]=Math.max(e[2],r[2]),o[3]=Math.max(e[3],r[3]),o},s.cH=function(o){const e=Math.round((o+45+360)%360/90)%4;return zl[e]},s.cI=be,s.cJ=nn,s.cK=n,s.cL=function(o){const e=le(new Float64Array(16));pe(e,o.pixelMatrix,o.globeMatrix);const r=[0,b,0],l=[0,T,0];return Ri(r,r,e),Ri(l,l,e),[r[0]>0&&r[0]<=o.width&&r[1]>0&&r[1]<=o.height&&!nv(o,new G(o.center.lat,90)),l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!nv(o,new G(o.center.lat,-90))]},s.cM=function(o,e){const{scale:r}=o.tileTransform,l=r*qt/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(h,m,_){var v=m[1],A=m[2],R=m[3],P=_[0],L=_[1];return h[0]=m[0]*P,h[1]=v*P,h[2]=A*L,h[3]=R*L,h})(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},s.cN=Vb,s.cO=$t,s.cP=FC,s.cQ=function(o){const e=FC(o,!0);return j([],[e[0],e[1],e[4],e[5]])},s.cR=Re,s.cS=Ui,s.cT=xe,s.cU=function(o){const{x:e,y:r}=o.point,{lng:l,lat:h}=o._center;return Gd(e,r,o.worldSize,l,h)},s.cV=fn,s.cW=Ds,s.cX=$a,s.cY=is,s.cZ=f,s.c_=function(o,e,r){let l=0;for(let h=0;h<2;++h)o[h]>0&&(l+=(o[h]-0)*(o[h]-0)),e[h]<0&&(l+=(0-e[h])*(0-e[h]));return l},s.ca=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},s.cb=Ut,s.cc=function(o,e,r,l,h){var m=1/Math.tan(e/2);if(o[0]=m/r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,h!=null&&h!==1/0){var _=1/(l-h);o[10]=(h+l)*_,o[14]=2*h*l*_}else o[10]=-1,o[14]=-2*l;return o},s.cd=function(o,e,r,l,h,m,_){var v=1/(e-r),A=1/(l-h),R=1/(m-_);return o[0]=-2*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*R,o[11]=0,o[12]=(e+r)*v,o[13]=(h+l)*A,o[14]=(_+m)*R,o[15]=1,o},s.ce=ue,s.cf=function(o,e,r){o[4*e+0]=r[0],o[4*e+1]=r[1],o[4*e+2]=r[2],o[4*e+3]=r[3]},s.cg=Sm,s.ch=Fu,s.ci=Ss,s.cj=Fo,s.ck=_s,s.cl=ZR,s.cm=function(){var o=new z(4);return z!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},s.cn=function(o,e,r){var l=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(r),A=Math.cos(r);return o[0]=l*A+m*v,o[1]=h*A+_*v,o[2]=l*-v+m*A,o[3]=h*-v+_*A,o},s.co=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},s.cp=jn,s.cq=function(o){var e=o[0],r=o[1],l=o[2],h=o[3];return Math.sqrt(e*e+r*r+l*l+h*h)},s.cr=Ol,s.cs=cs,s.ct=Rc,s.cu=3,s.cv=2,s.cw=7,s.cx=6,s.cy=ji,s.cz=tt,s.d=function(o){return Ir.API_TILEJSON_REGEX.test(o)},s.d$=mb,s.d0=J,s.d1=45,s.d2=tf,s.d3=function(o,e,r){const l=Math.sqrt(o*o+e*e+r*r),h=l>0?Math.acos(r/l)*qo:0;let m=o!==0||e!==0?Math.atan2(-e,-o)*qo+90:0;return m<0&&(m+=360),[l,m,h]},s.d4=Ke,s.d5=Hi,s.d6=Pe,s.d7=Fe,s.d8=di,s.d9=kt,s.dA=nf,s.dB=class extends Fa{constructor(o){super(o),this.current=Qx}set(o,e,r){if(this.fetchUniformLocation(o,e)){for(let l=0;l<9;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dC=_a,s.dD=function(o,e,r){const l=wa(r.zoom),h=o.style.map._antialias,m=o.terrain&&o.terrain.exaggeration()>0;return l===0&&!h&&!m},s.dE=function(o){const e=o.pixelsPerMeter,r=e/ue(1,o.center.lat),l=le(new Float64Array(16));return _e(l,l,[o.point.x,o.point.y,0]),Re(l,l,[r,r,e]),Float32Array.from(l)},s.dF=Wg,s.dG=function(o){const e=be-5;o=se(o,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(fi(o))),3);return Math.round(r*(x.length-1))},s.dH=function(o,e,r,l){const h=e.getNorth(),m=e.getSouth(),_=e.getWest(),v=e.getEast(),A=1<<o.z,R=v-_,P=h-m,L=R/p,N=-P/x[r],U=[0,L,0,N,0,0,h,_,0];if(o.z>0){const $=180/l;ie(U,U,[$/R+1,0,0,0,$/P+1,0,-.5*$/L,.5*$/N,1])}return U[2]=A,U[5]=o.x,U[8]=o.y,U},s.dI=ru,s.dJ=function(o,e,r){const l=le(new Float64Array(16)),h=(e/(1<<o)-.5)*Math.PI*2;return Ze(l,r.globeMatrix,h),Float32Array.from(l)},s.dK=av,s.dL=Zg,s.dM=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},s.dN=H,s.dO=function(o,e){var r=Math.sin(e),l=Math.cos(e);return o[0]=l,o[1]=r,o[2]=0,o[3]=-r,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},s.dP=Rr,s.dQ=vy,s.dR=Sr,s.dS=mr,s.dT=256,s.dU=function(o,e){const r=[0,0,0];return Ri(r,r,$d(ru(e.canonical))),Ri(r,r,o),r},s.dV=o=>({u_matrix:new _s(o),u_texsize:new Fo(o),u_pixels_to_tile_units:new Tm(o),u_device_pixel_ratio:new Ss(o),u_width_scale:new Ss(o),u_floor_width_scale:new Ss(o),u_image:new Sm(o),u_units_to_pixels:new Fo(o),u_tile_units_to_pixels:new Ss(o),u_alpha_discard_threshold:new Ss(o),u_trim_offset:new Fo(o),u_trim_fade_range:new Fo(o),u_trim_color:new tf(o),u_emissive_strength:new Ss(o),u_zbias_factor:new Ss(o),u_tile_to_meter:new Ss(o),u_ground_shadow_factor:new Fu(o),u_pattern_transition:new Ss(o)}),s.dW=o=>({u_matrix:new _s(o),u_pixels_to_tile_units:new Tm(o),u_device_pixel_ratio:new Ss(o),u_width_scale:new Ss(o),u_floor_width_scale:new Ss(o),u_units_to_pixels:new Fo(o),u_dash_image:new Sm(o),u_gradient_image:new Sm(o),u_image_height:new Ss(o),u_texsize:new Fo(o),u_tile_units_to_pixels:new Ss(o),u_alpha_discard_threshold:new Ss(o),u_trim_offset:new Fo(o),u_trim_fade_range:new Fo(o),u_trim_color:new tf(o),u_emissive_strength:new Ss(o),u_zbias_factor:new Ss(o),u_tile_to_meter:new Ss(o),u_ground_shadow_factor:new Fu(o)}),s.dX=o=>({u_camera_to_center_distance:new Ss(o),u_extrude_scale:new Tm(o),u_device_pixel_ratio:new Ss(o),u_matrix:new _s(o),u_inv_rot_matrix:new _s(o),u_merc_center:new Fo(o),u_tile_id:new Fu(o),u_zoom_transition:new Ss(o),u_up_dir:new Fu(o),u_emissive_strength:new Ss(o)}),s.dY=zu,s.dZ=UB,s.d_=class{constructor(o,e,r,l){this.context=o,this.format=l,this.size=r,this.texture=o.gl.createTexture();const[h,m,_]=this.size,{gl:v}=o;v.bindTexture(v.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,h,m,_,0,FS(this.format),BS(this.format),e.data)}bind(o,e){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_3D,this.texture),o!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,o),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},s.da=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},s.db=jC,s.dc=ZS,s.dd=$C,s.de=_T,s.df=function(o,e){return o.readFields(F4,{icons:[]},e)},s.dg=mn,s.dh=Uy,s.di=sT,s.dj=If,s.dk=aa,s.dl=yh,s.dm=rd,s.dn=vn,s.dp=function(o){const e=o.indexOf(Pd);return e>=0?o.slice(0,e):o},s.dq=function(o){return o.indexOf(Pd)>=0},s.dr=function(o){const e=o.lastIndexOf(Pd);return e>=0?o.slice(e+1):""},s.ds=function(o){const e=[],r=o.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dt=function(o,e,r,l){return o.type==="custom"?new P4(o,e):new k4[o.type](o,e,r,l)},s.du=It,s.dv=function(o){const e=o.indexOf(Pd);return e>=0?o.slice(e+1):""},s.dw=class extends v_{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},s.dx=Zh,s.dy=Fc,s.dz=function(o){return o({pluginStatus:ko,pluginURL:Tc}),Zh.on("pluginStateChange",o),o},s.e=Ir,s.e$=function([o,e,r]){const l=Math.hypot(o,e,r),h=Math.atan2(o,r),m=.5*Math.PI-Math.acos(-e/l);return new G(Ds(h),Ds(m))},s.e0=(o,e,r,l,h,m)=>{const _=o.transform,v=_.projection.name==="globe";let A;if(m.paint.get("circle-pitch-alignment")==="map")if(v){const P=vy(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;A=Float32Array.from([P,0,0,P])}else A=_.calculatePixelsToTileUnitsMatrix(r);else A=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(_.projection),u_matrix:o.translatePosMatrix(e.projMatrix,r,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:To.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:pb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){R.u_inv_rot_matrix=l,R.u_merc_center=h,R.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],R.u_zoom_transition=wa(_.zoom);const P=h[0]*qt,L=h[1]*qt;R.u_up_dir=_.projection.upVector(new al(0,0,0),P,L)}return R},s.e1=oR,s.e2=uo,s.e3=(o,e,r,l,h,m,_,v,A,R)=>{const P=o.transform,L=P.pitch<15?iR(.07,.7,se((14-P.zoom)/5,0,1)):.07,N=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:sR(o,e,r,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:m,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:rR(e,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:Pe(e.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:R}},s.e4=(o,e,r,l,h,m,_,v,A,R)=>{const P=o.transform,L=P.calculatePixelsToTileUnitsMatrix(e),N=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",U=P.pitch<15?iR(.07,.7,se((14-P.zoom)/5,0,1)):.07;return{u_matrix:sR(o,e,r,l),u_pixels_to_tile_units:L,u_device_pixel_ratio:m,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:aR(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:rR(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:U,u_tile_to_meter:Pe(e.tileID.canonical,0),u_ground_shadow_factor:R}},s.e5=qe,s.e6=wp,s.e7=Ce,s.e8=Al,s.e9=ou,s.eA=vT,s.eB=Gb,s.eC=$b,s.eD=[1,1,1],s.eE=qy,s.eF=Ot,s.eG=function(o,e,r,l){var h=e[0],m=e[1],_=e[2],v=e[3];return o[0]=h+l*(r[0]-h),o[1]=m+l*(r[1]-m),o[2]=_+l*(r[2]-_),o[3]=v+l*(r[3]-v),o},s.eH=ky,s.eI=rl,s.eJ=Cc,s.eK=function(o,e,r,l,h,m,_,v,A,R,P,L,N,U,$,X){var Q=new z(16);return Q[0]=o,Q[1]=e,Q[2]=r,Q[3]=l,Q[4]=h,Q[5]=m,Q[6]=_,Q[7]=v,Q[8]=A,Q[9]=R,Q[10]=P,Q[11]=L,Q[12]=N,Q[13]=U,Q[14]=$,Q[15]=X,Q},s.eL=k,s.eM=mm,s.eN=ku,s.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ct(1/0,1/0),max:new Ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const r=vv(new Ct(0,0),new Ct(qt,qt),o),l=[];if(e&&!jm(r,this._globalClipBounds))return l;for(const h of this._activeRegions){if(h.hiddenByOverlap||!jm(r,h))continue;const m=NS(h.min,h.max,o);l.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return l}setSources(o){this._setSources(o.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const l of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(l).buckets[e.layer];h&&h.updateFootprints(l.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const r=o.getOrder(),l=o.getClipMask(),h=o.getClipScope();for(const m of e){if(!m.footprint)continue;const _=vv(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:r,clipMask:l,clipScope:h})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,r)=>e.priority-r.priority||km(e.min,r.min)||km(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||(function(l,h){const m=(_,v)=>_+v;return l.length-h.length||l.reduce(m,"").localeCompare(h.reduce(m,""))})(e.clipScope,r.clipScope)));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const r=this._activeRegions[e],l=this._prevRegions[e];o=r.priority!==l.priority||!Iy(r,l)||r.order!==l.order||r.clipMask!==l.clipMask||!Rs(r.clipScope,l.clipScope),this._activeRegions[e].hiddenByOverlap=l.hiddenByOverlap,++e}}if(o){++this._updateTime;for(const r of this._activeRegions)r.order!==Zd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const l=this._activeRegions;if(r>=l.length)return r;const h=l[r].priority;for(;r<l.length&&l[r].priority===h;)++r;return r};if(this._sourceIds.length>1){let r=0,l=e(r);for(;r!==l;){let h=r;const m=r;for(;h!==l;){const _=this._activeRegions[h];_.hiddenByOverlap=!1;for(let v=0;v<m;v++){const A=this._activeRegions[v];if(!A.hiddenByOverlap&&_.order===Zd&&jm(_,A)&&(_.hiddenByOverlap=Db(_.footprint,_.tileId,A.footprint,A.tileId),_.hiddenByOverlap))break}++h}r=l,l=e(r)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},s.eP=Zd,s.eQ=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const r=new ba,l=new kr,h=[],m=o+1+2,_=e[0]+1,v=e[0]+1+(1+e.length),A=(R,P,L)=>{let N=R===m-1?R-2:R===0?R:R-1;return N+=L?24575:0,[N,P]};for(let R=0;R<m;++R)r.emplaceBack(...A(R,0,!0));for(let R=0;R<_;++R)for(let P=0;P<m;++P)r.emplaceBack(...A(P,R,(P===0||P===m-1)&&!0));for(let R=0;R<e.length;++R){const P=e[R];for(let L=0;L<m;++L)r.emplaceBack(...A(L,P,!0))}for(let R=0;R<e.length;++R){const P=l.length,L=e[R]+1+2,N=new kr;for(let X=0;X<L-1;X++){const Q=X===L-2,te=Q?m*(v-e.length+R-X):m;for(let ce=0;ce<m-1;ce++){const he=X*m+ce;X===0||Q||ce===0||ce===m-2?(N.emplaceBack(he+1,he,he+te),N.emplaceBack(he+te,he+te+1,he+1)):(l.emplaceBack(he+1,he,he+te),l.emplaceBack(he+te,he+te+1,he+1))}}const U=Br.simpleSegment(0,P,r.length,l.length-P);for(let X=0;X<N.uint16.length;X+=3)l.emplaceBack(N.uint16[X],N.uint16[X+1],N.uint16[X+2]);const $=Br.simpleSegment(0,P,r.length,l.length-P);h.push({withoutSkirts:U,withSkirts:$})}return{vertices:r,indices:l,segments:h}}_createGrid(o){const e=this._fillGridMeshWithLods(p,x);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,Jx.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new kr;for(let _=0;_<=p;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const r=new Nu,l=new Nu,h=new Nu,m=new Nu;this._poleSegments=[];for(let _=0,v=0;_<f;_++){const A=360/(1<<_);r.emplaceBack(0,-Hr,0,.5,0),l.emplaceBack(0,-Hr,0,.5,1),h.emplaceBack(0,-Hr,0,.5,.5),m.emplaceBack(0,-Hr,0,.5,.5);for(let R=0;R<=p;R++){let P=R/p,L=0;const N=Gn(0,A,P),[U,$,X]=M(hb,fb,N,Hr);r.emplaceBack(U,$,X,P,L),l.emplaceBack(U,$,X,P,1-L);const Q=fi(N);P=.5+.5*Math.sin(Q),L=.5+.5*Math.cos(Q),h.emplaceBack(U,$,X,P,L),m.emplaceBack(U,$,X,P,1-L)}this._poleSegments.push(Br.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(r,bp,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,bp,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(h,bp,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(m,bp,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},s.eR=xv,s.eS=We,s.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eU=ne,s.eV=Se,s.eW=function(o,e,r){return o[0]=e[0]/r[0],o[1]=e[1]/r[1],o[2]=e[2]/r[2],o},s.eX=rr,s.eY=D,s.eZ=Yt,s.e_=ze,s.ea=Gm,s.eb=Wd,s.ec=Oy,s.ed=Sv,s.ee=Te,s.ef=function(o,e){if(o===e){var r=e[1],l=e[2],h=e[3],m=e[6],_=e[7],v=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=r,o[6]=e[9],o[7]=e[13],o[8]=l,o[9]=m,o[11]=e[14],o[12]=h,o[13]=_,o[14]=v}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},s.eg=D4,s.eh=xi,s.ei=Js,s.ej=256,s.ek=Yg,s.el=il,s.em=Ze,s.en=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},s.eo=Nu,s.ep=pm,s.eq=Rg,s.er=function(o,e,r,l,h){return se((o-e)/(r-e)*(h-l)+l,l,h)},s.es=or,s.et=function(o,e){var r=e[0],l=e[1],h=e[2],m=e[3],_=e[4],v=e[5],A=e[6],R=e[7],P=e[8],L=P*_-v*R,N=-P*m+v*A,U=R*m-_*A,$=r*L+l*N+h*U;return $?(o[0]=L*($=1/$),o[1]=(-P*l+h*R)*$,o[2]=(v*l-h*_)*$,o[3]=N*$,o[4]=(P*r-h*A)*$,o[5]=(-v*r+h*m)*$,o[6]=U*$,o[7]=(-R*r+l*A)*$,o[8]=(_*r-l*m)*$,o):null},s.eu=2,s.ev=On,s.ew=Dn,s.ex=Et,s.ey=function(o,e){var r=new z(3);Et(r,e);var l=1/r[0],h=1/r[1],m=1/r[2],_=e[0]*l,v=e[1]*h,A=e[2]*m,R=e[4]*l,P=e[5]*h,L=e[6]*m,N=e[8]*l,U=e[9]*h,$=e[10]*m,X=_+P+$,Q=0;return X>0?(Q=2*Math.sqrt(X+1),o[3]=.25*Q,o[0]=(L-U)/Q,o[1]=(N-A)/Q,o[2]=(v-R)/Q):_>P&&_>$?(Q=2*Math.sqrt(1+_-P-$),o[3]=(L-U)/Q,o[0]=.25*Q,o[1]=(v+R)/Q,o[2]=(N+A)/Q):P>$?(Q=2*Math.sqrt(1+P-_-$),o[3]=(N-A)/Q,o[0]=(v+R)/Q,o[1]=.25*Q,o[2]=(L+U)/Q):(Q=2*Math.sqrt(1+$-_-P),o[3]=(v-R)/Q,o[0]=(N+A)/Q,o[1]=(L+U)/Q,o[2]=.25*Q),o},s.ez=function(o,e){var r=2*Math.acos(e[3]),l=Math.sin(r/2);return l>O?(o[0]=e[0]/l,o[1]=e[1]/l,o[2]=e[2]/l):(o[0]=1,o[1]=0,o[2]=0),r},s.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,((e,r)=>String.fromCharCode(+("0x"+r)))))},s.f0=Kn,s.f1=US,s.f2=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!(function(r){if(gs==null){const l=r.navigator?r.navigator.userAgent:null;gs=!!r.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return gs})(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f3=function(o,e){Mf=o,ia=e},s.f4=nv,s.f5=Cm,s.f6=function(o){const e=[0,0,0],r=le(new Float64Array(16));return pe(r,o.pixelMatrix,o.globeMatrix),Ri(e,e,r),new Ct(e[0],e[1])},s.f7=function(){const o=ot;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(q),ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f8=function(){mn().acquire(q)},s.f9=Cd,s.fA=Pt,s.fB=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==OC){const r=new Uint32Array(o,0,7),[,,l,h,m,_]=r;e=r.byteLength+h+m+_+m,(l!==o.byteLength||e>=o.byteLength)&&Tn("Invalid b3dm header information.")}return kC(o,e)},s.fC=function(o,e){const r=ZS(o);for(const l of r){for(const h of l.meshes)hB(h);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(fB(l.lights,e)))}return r},s.fD=u1,s.fE=Lr,s.fF=I,s.fG=la,s.fH=ja,s.fI=function(o){rc(),zo?.then((e=>{e.keys().then((r=>{for(let l=0;l<r.length-o;l++)e.delete(r[l]).catch((h=>Tn(h.message)))})).catch((r=>Tn(r.message)))})).catch((e=>Tn(e.message)))},s.fa=function(o,e,r=!1){if(ko===ja.deferred||ko===ja.loading||ko===ja.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Tc=To.resolveURL(o),ko=ja.deferred,ap=e,$s(),r||Wh()},s.fb=function(o){Di=To.resolveURL(o),Mt||(Mt=new Oe(mn(),new Bc)),Mt.broadcast("setMeshoptUrl",Di)},s.fc=os,s.fd=function(o){tn=To.resolveURL(o),Mt||(Mt=new Oe(mn(),new Bc)),Mt.broadcast("setDracoUrl",tn)},s.fe=Pi,s.ff=B,s.fg=function(o){const e=jc();if(!e)return;const r=e.delete(ic);o&&r.then((()=>o())).catch(o)},s.fh=de,s.fi=jt,s.fj=su,s.fk=eh,s.fl=QM,s.fm=JM,s.fn=JC,s.fo=rn,s.fp="hd_road_elevation",s.fq=Pn,s.fr=Bt,s.fs=qd,s.ft=rT,s.fu=y_,s.fv=function(o,e,r,l,h,m,_,v=1,A,R,P){o.createArrays(),o.tilePixelRatio=qt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const L=o.layers[0].layout,N=o.layers[0]._unevaluatedLayout._values,U={};U.scaleFactor=v,U.textSizeScaleRange=L.get("text-size-scale-range"),U.iconSizeScaleRange=L.get("icon-size-scale-range");const[$,X]=U.textSizeScaleRange,[Q,te]=U.iconSizeScaleRange;U.textScaleFactor=se(U.scaleFactor,$,X),U.iconScaleFactor=se(U.scaleFactor,Q,te);const ce=N["text-size"],he=N["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ft}=o.textSizeData;U.compositeTextSizes=[ce.possiblyEvaluate(new ir(Ue,{worldview:P}),m),ce.possiblyEvaluate(new ir(ft,{worldview:P}),m)]}if(o.iconSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ft}=o.iconSizeData;U.compositeIconSizes=[he.possiblyEvaluate(new ir(Ue,{worldview:P}),m),he.possiblyEvaluate(new ir(ft,{worldview:P}),m)]}U.layoutTextSize=ce.possiblyEvaluate(new ir(_+1,{worldview:P}),m),U.layoutIconSize=he.possiblyEvaluate(new ir(_+1,{worldview:P}),m),U.textMaxSize=ce.possiblyEvaluate(new ir(18,{worldview:P}),m);const me=L.get("symbol-placement"),Ie=L.get("text-rotation-alignment")==="map"&&me!=="point",Ee=L.get("text-size");let Ne=!1;const Be=[];for(const Ue of o.features){const ft=L.get("text-font").evaluate(Ue,{},m).join(","),Qe=Ee.evaluate(Ue,{},m)*U.textScaleFactor,mt=U.layoutTextSize.evaluate(Ue,{},m)*U.textScaleFactor,wt=U.layoutIconSize.evaluate(Ue,{},m)*U.iconScaleFactor,Dt={horizontal:{},vertical:void 0},Xt=Ue.text;let Nt,Tt=[0,0];if(Xt){const yi=Xt.toString(),$i=L.get("text-letter-spacing").evaluate(Ue,{},m)*Bo,ri=L.get("text-line-height").evaluate(Ue,{},m)*Bo,Qi=qh(yi)?$i:0,Ji=L.get("text-anchor").evaluate(Ue,{},m),rs=L.get("text-variable-anchor");if(!rs){const xt=L.get("text-radial-offset").evaluate(Ue,{},m);if(xt)Tt=NR(Ji,[xt*Bo,aT]);else{const ln=L.get("text-offset").evaluate(Ue,{},m);Tt=[ln[0]*Bo,ln[1]*Bo]}}let Ae=Ie?"center":L.get("text-justify").evaluate(Ue,{},m);const we=me==="point",yt=we?L.get("text-max-width").evaluate(Ue,{},m)*Bo:1/0,en=xt=>{o.allowVerticalPlacement&&Hh(yi)&&(Dt.vertical=eT(Xt,e,r,h,ft,yt,ri,Ji,xt,Qi,Tt,Wl.vertical,!0,mt,Qe,A))};if(!Ie&&rs){const xt=Ae==="auto"?rs.map((Rn=>lT(Rn))):[Ae];let ln=!1;for(let Rn=0;Rn<xt.length;Rn++){const Cn=xt[Rn];if(!Dt.horizontal[Cn])if(ln)Dt.horizontal[Cn]=Dt.horizontal[0];else{const oi=eT(Xt,e,r,h,ft,yt,ri,"center",Cn,Qi,Tt,Wl.horizontal,!1,mt,Qe,A);oi&&(Dt.horizontal[Cn]=oi,ln=oi.positionedLines.length===1)}}en("left")}else{if(Ae==="auto"&&(Ae=lT(Ji)),we||L.get("text-writing-mode").indexOf("horizontal")>=0||!Hh(yi)){const xt=eT(Xt,e,r,h,ft,yt,ri,Ji,Ae,Qi,Tt,Wl.horizontal,!1,mt,Qe,A);xt&&(Dt.horizontal[Ae]=xt)}en(we?"left":Ae)}}let Lt,ht,lt,zt,Zt,At,gn=!1;const bn=L.get("icon-text-fit").evaluate(Ue,{},m);if(Ue.icon&&Ue.icon.hasPrimary()){const yi=kv(Ue.icon,o.iconSizeData,N["icon-size"],m,o.zoom,Ue,A,U.iconScaleFactor,P);Lt=yi.iconPrimary,lt=yi.iconSecondary;const $i=Lt.toString();if(ht=l.get($i),ht&&(Zt=L.get("icon-offset").evaluate(Ue,{},m),At=L.get("icon-anchor").evaluate(Ue,{},m),Nt=Xb(h.get($i),lt?h.get(lt.toString()):void 0,Zt,At),gn=ht.sdf,o.sdfIcons===void 0?o.sdfIcons=ht.sdf:o.sdfIcons!==ht.sdf&&Tn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ht.pixelRatio!==o.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),lt){const ri=lt.toString();zt=l.get(ri)}}Ne=Ne||!(!Ue.icon||!Ue.icon.hasSecondary());const hn=cT(Dt.horizontal)||Dt.vertical;o.iconsInText||(o.iconsInText=!!hn&&hn.iconsInText);const an=mt*U.textScaleFactor/Bo,{defaultShapedIcon:Qn,verticallyShapedIcon:dn}=_4(o,Nt,L,Ue,m,Dt,an,Zt,bn);bn!=="none"&&Nt&&(bR(Nt)||wR(Nt))&&(e1(0,ht,Lt,Nt,Qn,bn,R,l,h),e1(0,zt,lt,Nt,Qn,bn,R,l,h),dn&&(e1(0,ht,Lt,Nt,dn,bn,R,l,h),e1(0,zt,lt,Nt,dn,bn,R,l,h))),Nt=Qn;const{iconBBox:kn,iconVerticalBBox:ei}=p4(o,Nt,dn,L,Ue,m,wt,Zt,U,h,At);Be.push({feature:Ue,shapedTextOrientations:Dt,shapedText:hn,shapedIcon:Nt,iconPrimary:Lt,iconSecondary:lt,iconOffset:Zt,iconAnchor:At,verticallyShapedIcon:dn,layoutTextSize:mt,layoutIconSize:wt,textOffset:Tt,isSDFIcon:gn,iconTextFit:bn,iconCollisionBounds:kn,iconVerticalCollisionBounds:ei})}return{featureData:Be,sizes:U,hasAnySecondaryIcon:Ne,textAlongLine:Ie,symbolPlacement:me}},s.fw=IR,s.fx=function(o,e,r,l,h,m,_,v,A,R){o.iconAtlasPositions=R.iconPositions;const{featureData:P,hasAnySecondaryIcon:L,sizes:N,textAlongLine:U,symbolPlacement:$}=e;for(const X of P){const{shapedIcon:Q,verticallyShapedIcon:te,feature:ce,shapedTextOrientations:he,shapedText:me,layoutTextSize:Ie,textOffset:Ee,isSDFIcon:Ne,iconPrimary:Be,iconSecondary:Ue,iconTextFit:ft,iconOffset:Qe,iconCollisionBounds:mt,iconVerticalCollisionBounds:wt}=X;jR(Q,R.iconPositions,Be,Ue),jR(te,R.iconPositions,Be,Ue),g4(he,R.iconPositions),m4(Be,Ue,R.iconPositions),(me||Q)&&y4(o,ce,he,Q,te,A,N,Ie,0,Ee,Ne,l,h,_,v,L,ft,Qe,U,$,mt,wt)}r&&o.generateCollisionDebugBuffers(m,o.collisionBoxArray,N.textScaleFactor)},s.fy=Jt,s.fz=g1,s.g=function(o,e){return Fc(Object.assign(o,{method:"GET"}),e)},s.h=function(o){return o.indexOf("mapbox:")===0},s.i=function(o){return Ir.API_STYLE_REGEX.test(o)&&!So(o)},s.j=Fs,s.k=xh,s.l=function(o){return decodeURIComponent(atob(o).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},s.m=function(o,e){return Fc(Object.assign(o,{type:"json"}),e)},s.n=wh,s.o=To,s.p=function(o,e){return Fc(Object.assign(o,{method:"POST"}),e)},s.q=go,s.r=na,s.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return Gt||(Gt=new de),Gt},s.u=function(){return(function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},s.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},s.w=Tn,s.x=ET,s.y=_u,s.z=Zo})),w(["./shared"],(function(s){function O(We){const ne=We?We.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function z(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let se="[";for(const ve of We)se+=`${z(ve)},`;return`${se}]`}let ne="{";for(const se of Object.keys(We).sort())ne+=`${se}:${z(We[se])},`;return`${ne}}`}function j(We){let ne="";for(const se of s.bw)ne+=`/${z(We[se])}`;return ne}class H{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,se){this._layerConfigs={},this._layers={},this.update(ne,[],se)}update(ne,se,ve){this._options=ve;for(const ke of ne)this._layerConfigs[ke.id]=ke,(this._layers[ke.id]=s.dt(ke,this.scope,null,this._options)).compileFilter(ve),this.keyCache[ke.id]&&delete this.keyCache[ke.id];for(const ke of se)delete this.keyCache[ke],delete this._layerConfigs[ke],delete this._layers[ke];this.familiesBySource={};const je=(function(ke,He){const at={};for(let nt=0;nt<ke.length;nt++){const Bt=ke[nt];let It=He&&He[Bt.id];It||(Bt.type==="symbol"?It=Bt.id:(It=j(Bt),Bt.type==="line"&&Bt.paint&&(function $n(Bn){return typeof Bn=="string"&&Bn==="line-progress"||(Array.isArray(Bn)?Bn.some($n):!(!Bn||typeof Bn!="object")&&Object.values(Bn).some($n))})(Bt.paint["line-width"])&&(It+=`/${z(Bt.paint["line-width"])}`))),He&&(He[Bt.id]=It);let vn=at[It];vn||(vn=at[It]=[]),vn.push(Bt)}const qe=[];for(const nt in at)qe.push(at[nt]);return qe})(Object.values(this._layerConfigs),this.keyCache);for(const ke of je){const He=ke.map((vn=>this._layers[vn.id])),at=He[0];if(at.visibility==="none")continue;const qe=at.source||"";let nt=this.familiesBySource[qe];nt||(nt=this.familiesBySource[qe]={});const Bt=at.sourceLayer||"_geojsonTileLayer";let It=nt[Bt];It||(It=nt[Bt]=[]),It.push(He)}}}const Y=1*s.fk;class ie{constructor(ne){const se={},ve=[];for(const at in ne){const qe=ne[at],nt=se[at]={};for(const Bt in qe.glyphs){const It=qe.glyphs[+Bt];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const vn=It.metrics.localGlyph?Y:1,$n={x:0,y:0,w:It.bitmap.width+2*vn,h:It.bitmap.height+2*vn};ve.push($n),nt[Bt]=$n}}const{w:je,h:ke}=s.G(ve),He=new s.fj({width:je||1,height:ke||1});for(const at in ne){const qe=ne[at];for(const nt in qe.glyphs){const Bt=qe.glyphs[+nt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const It=se[at][nt],vn=Bt.metrics.localGlyph?Y:1;s.fj.copy(Bt.bitmap,He,{x:0,y:0},{x:It.x+vn,y:It.y+vn},Bt.bitmap)}}this.image=He,this.positions=se}}function oe(We,ne,se){We[ne]?se&&(We[ne].center=se):We[ne]={floorIds:new Set,center:se||[0,0],floors:{}}}function ee(We,ne,se,ve){for(const je of ne)oe(We,je),We[je].floors[se]=ve,We[je].floorIds.add(se)}function le(We){return{id:We.properties.id.toString(),center:We.properties.center.toString().split(";").map(Number)}}function ge(We){return{id:We.properties.id.toString(),isDefault:!!We.properties.is_default&&We.properties.is_default,connections:We.properties.connected_floor_ids?new Set(We.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:We.properties.conflicted_floor_ids?new Set(We.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:We.properties.building_ids?new Set(We.properties.building_ids.toString().split(";")):new Set,name:We.properties.name.toString(),zIndex:We.properties.z_index}}function pe(We,ne){return ne.every((se=>We.properties&&We.properties[se]!=null))}function _e(We){return pe(We,["type","id","name"])&&We.properties.type==="building"}function Re(We){return pe(We,["type","id","name","z_index"])&&We.properties.type==="floor"}s.fi(ie,"GlyphAtlas");class xe{constructor(ne){this.tileID=new s.aP(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=s.aY(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,se,ve,je,ke,He){this.status="parsing",this.data=ne,this.collisionBoxArray=new s.b2;const at=new s.fl(Object.keys(ne.layers).sort()),qe=new s.fm(this.tileID,this.promoteId);qe.bucketLayerIDs=[];const nt={},Bt=new s.fn(256,256),It={featureIndex:qe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Bt,availableImages:ve,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Tn=this.indoor.indoorState.activeFloorsVisible,pi=(function(_i,Hi,Lr){const Ps=(function(ar,Ei){if(!ar)return s.w("No source layers defined in indoor specification"),Ei;if(ar.size===0)return Ei;const Sr=ar.difference(Ei);for(const mr of Sr)s.w(`Missing source layer required in indoor specification: ${mr}`);return Ei.intersection(Ei)})(Hi.sourceLayers,new Set(Object.keys(_i.layers))),gs=Hi.indoorState,ds=(function(ar,Ei,Sr,mr){const Oi=new Set,Ir=new Set,Fs=new Set,So=new Map,Wa={},nc=Xs=>{const Bs=So.get(Xs)||new Set;for(const Oo of Oi)if((So.get(Oo)||new Set).has(Xs)||Bs.has(Oo))return!0;return!1};for(const Xs of Ei){const Bs=ar.layers[Xs];if(Bs)for(let Oo=0;Oo<Bs.length;Oo++){const ul=Bs.feature(Oo);if(_e(ul)){const{id:na,center:To}=le(ul);oe(Wa,na,To),Oi.add(na)}else if(Re(ul)){const{id:na,isDefault:To,connections:Rf,conflicts:yh,buildings:ic,name:Mf,zIndex:ia}=ge(ul);ee(Wa,ic,na,{name:Mf,zIndex:ia}),So.set(na,yh),(na===mr||Rf.has(mr))&&Oi.add(na),Ir.add(na),To&&Fs.add(na)}}else s.w(`indoor source layer not found: ${Xs}`)}if(Sr)for(const Xs of Sr)Ir.has(Xs)&&(nc(Xs)||Oi.add(Xs));for(const Xs of Fs)Oi.has(Xs)||nc(Xs)||Oi.add(Xs);return{buildings:Wa,activeFloors:Oi}})(_i,Ps,gs.lastActiveFloors,gs.selectedFloorId);return Lr.send("setIndoorData",ds),ds})(ne,this.indoor,ke);It.activeFloors=Tn?pi.activeFloors:void 0}const vn=[],$n=se.familiesBySource[this.source];for(const Tn in $n){const pi=ne.layers[Tn];if(!pi)continue;let _i=!1,Hi=!1,Lr=!1;for(const ar of $n[Tn])ar[0].type==="symbol"?_i=!0:Hi=!0,ar[0].is3D()&&ar[0].type!=="model"&&(Lr=!0);if(this.extraShadowCaster&&!Lr||this.isSymbolTile===!0&&!_i||this.isSymbolTile===!1&&!Hi)continue;pi.version===1&&s.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ps=at.encode(Tn),gs=[];let ds=!1;for(let ar=0,Ei=0;ar<pi.length;ar++){const Sr=pi.feature(ar),mr=qe.getId(Sr,Tn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Tn)){const Oi=Sr.properties?Sr.properties.worldview:null;if(this.worldview&&typeof Oi=="string")if(Oi==="all")Sr.properties.$localized=!0;else{if(!Oi.split(",").includes(this.worldview))continue;Sr.properties.$localized=!0,Sr.properties.worldview=this.worldview}}!ds&&Sr.properties&&Sr.properties.hasOwnProperty(s.fo)&&(ds=!0),gs.push({feature:Sr,id:mr,index:Ei,sourceLayerIndex:Ps}),Ei++}ds&&!It.elevationFeatures&&ne.layers.hasOwnProperty(s.fp)&&(It.elevationFeatures=s.fq.parseFrom(ne.layers[s.fp],this.canonical));for(const ar of $n[Tn]){const Ei=ar[0];if(this.extraShadowCaster&&(!Ei.is3D()||Ei.type==="model")||this.isSymbolTile!==void 0&&Ei.type==="symbol"!==this.isSymbolTile||Ei.minzoom&&this.zoom<Math.floor(Ei.minzoom)||Ei.maxzoom&&this.zoom>=Ei.maxzoom||Ei.visibility==="none")continue;Ze(ar,this.zoom,It.brightness,ve,this.worldview);const Sr=nt[Ei.id]=Ei.createBucket({index:qe.bucketLayerIDs.length,layers:ar,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ps,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:je,worldview:this.worldview});qe.bucketLayerIDs.push(ar.map((Oi=>s.B(Oi.id,Oi.scope))));let mr=Sr.prepare?Sr.prepare():null;mr!=null?(mr=mr.then((()=>Sr.populate(gs,It,this.tileID.canonical,this.tileTransform))),vn.push(mr)):Sr.populate(gs,It,this.tileID.canonical,this.tileTransform)}}const Bn=()=>{let Tn,pi,_i,Hi,Lr,Ps;Bt.trim();const gs={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ds=()=>{if(Tn)return this.status="done",He(Tn);if(this.extraShadowCaster)this.status="done",He(null,{buckets:Object.values(nt).filter((Ei=>!Ei.isEmpty())),featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:It.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(pi&&_i&&Hi){const Ei=new ie(pi),Sr=new Map;for(const[Ir,Fs]of _i.entries()){const{imagePosition:So}=s.ft(Ir,Fs,s.fu);Sr.set(Ir,So)}const mr={};for(const Ir in nt){const Fs=nt[Ir];Fs instanceof s.b3&&(Ze(Fs.layers,this.zoom,It.brightness,ve,this.worldview),mr[Ir]=s.fv(Fs,pi,Ei.positions,_i,Sr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Lr,this.worldview))}const Oi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ke,_i,Lr,(()=>{Oi.iconsPending=!1,ar(mr,Ei,Oi)})),this.rasterizeIfNeeded(ke,Hi,Ps,(()=>{Oi.patternsPending=!1,ar(mr,Ei,Oi)}))}},ar=(Ei,Sr,mr,Oi)=>{if(mr.iconsPending||mr.patternsPending)return;const Ir=new s.fw(_i,Hi,this.lut);for(const Fs in nt){const So=nt[Fs];if(Fs in Ei)s.fx(So,Ei[Fs],this.showCollisionBoxes,ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,_i,Ir);else if(So.hasPattern&&(So instanceof s.b9||So instanceof s.ba||So instanceof s.e9)){Ze(So.layers,this.zoom,It.brightness,ve,this.worldview);const Wa=Object.fromEntries(Ir.patternPositions);So.addFeatures(It,this.tileID.canonical,Wa,ve,this.tileTransform,this.brightness)}}this.status="done",He(null,{buckets:Object.values(nt).filter((Fs=>!Fs.isEmpty())),featureIndex:qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Sr.image,lineAtlas:Bt,imageAtlas:Ir,brightness:It.brightness})};if(!this.extraShadowCaster){const Ei=s.fr(It.glyphDependencies,(Oi=>Object.keys(Oi).map(Number)));Object.keys(Ei).length?ke.send("getGlyphs",{uid:this.uid,stacks:Ei},((Oi,Ir)=>{Tn||(Tn=Oi,pi=Ir,ds())}),void 0,!1,gs):pi={};const Sr=Array.from(It.iconDependencies.keys()).map((Oi=>s.I.parse(Oi)));Sr.length?ke.send("getImages",{images:Sr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Oi,Ir)=>{Tn||(Tn=Oi,_i=new Map,Lr=this.updateImageMapAndGetImageTaskQueue(_i,Ir,It.iconDependencies),ds())}),void 0,!1,gs):(_i=new Map,Lr=new Map);const mr=Array.from(It.patternDependencies.keys()).map((Oi=>s.I.parse(Oi)));mr.length?ke.send("getImages",{images:mr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Oi,Ir)=>{Tn||(Tn=Oi,Hi=new Map,Ps=this.updateImageMapAndGetImageTaskQueue(Hi,Ir,It.patternDependencies),ds())}),void 0,!1,gs):(Hi=new Map,Ps=new Map)}if(It.elevationFeatures&&It.elevationFeatures.length>0){const Ei=[];for(const mr of Object.values(nt))if(mr instanceof s.ba){const Oi=mr.getUnevaluatedPortalGraph();Oi&&Ei.push(Oi)}const Sr=s.fs.evaluate(Ei);for(const mr of Object.values(nt))if(mr instanceof s.ba){const Oi=ne.layers[at.decode(mr.sourceLayerIndex)];mr.setEvaluatedPortalGraph(Sr,Oi,this.tileID.canonical,It.availableImages,It.brightness)}}ds()};vn.length>0?Promise.allSettled(vn).then(Bn).catch(He):Bn()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=s.aY(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,se,ve,je){Array.from(se.values()).some((ke=>ke.usvg))?this.rasterize(ne,se,ve,je):je()}updateImageMapAndGetImageTaskQueue(ne,se,ve){const je=new Map;for(const ke of se.keys()){const He=ve.get(ke)||[];for(const at of He){const qe=at.toString(),nt=se.get(at.id.toString());nt.usvg?je.has(qe)||(je.set(qe,at),ne.set(qe,Object.assign({},nt))):ne.set(qe,nt)}}return je}rasterize(ne,se,ve,je){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ve},((ke,He)=>{if(!ke)for(const[at,qe]of He.entries()){const nt=Object.assign(se.get(at),{data:qe});se.set(at,nt)}je()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ze(We,ne,se,ve,je){const ke=new s.ac(ne,{brightness:se,worldview:je});for(const He of We)He.recalculate(ke,ve)}class Le extends s.E{constructor(ne,se,ve,je,ke,He,at){super(),this.actor=ne,this.layerIndex=se,this.availableImages=ve,this.availableModels=je,this.loadVectorData=He||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ne.scheduler),this.isSpriteLoaded=ke,this.scheduler=ne.scheduler,this.brightness=at}loadTile(ne,se){const ve=ne.uid,je=ne&&ne.request,ke=je&&je.collectResourceTiming,He=this.loading[ve]=new xe(ne);He.abort=this.loadVectorData(ne,((at,qe)=>{const nt=!this.loading[ve];if(delete this.loading[ve],He.cancelRasterize(),nt||at||!qe)return He.status="done",nt||(this.loaded[ve]=He),se(at);const Bt=qe.rawData,It={},vn=s.aM(qe.responseHeaders);vn&&vn.expires&&(It.expires=vn.expires),vn&&vn.cacheControl&&(It.cacheControl=vn.cacheControl),He.vectorTile=qe.vectorTile||new s.fy(new s.bs(Bt));const $n=()=>{He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Bn,Tn)=>{if(Bn||!Tn)return se(Bn);const pi={};if(ke){const _i=O(je);_i.length>0&&(pi.resourceTiming=JSON.parse(JSON.stringify(_i)))}se(null,Object.assign({rawTileData:Bt.slice(0),responseHeaders:qe.responseHeaders},Tn,It,pi))}))};this.isSpriteLoaded?$n():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add($n,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):$n()})),this.loaded=this.loaded||{},this.loaded[ve]=He}))}reloadTile(ne,se){const ve=this.loaded,je=ne.uid;if(ve&&ve[je]){const ke=ve[je];ke.updateParameters(ne);const He=(at,qe)=>{const nt=ke.reloadCallback;nt&&(delete ke.reloadCallback,ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,nt)),se(at,qe)};ke.status==="parsing"?ke.reloadCallback=He:ke.status==="done"&&(ke.vectorTile?ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He):He())}else se(null,void 0)}abortTile(ne,se){const ve=ne.uid,je=this.loading[ve];je&&(je.abort&&je.abort(),delete this.loading[ve]),se()}removeTile(ne,se){const ve=this.loaded,je=ne.uid;ve&&ve[je]&&delete ve[je],se()}}class $e{loadTile(ne,se){const{uid:ve,encoding:je,rawImageData:ke,padding:He}=ne,at=ImageBitmap&&ke instanceof ImageBitmap?this.getImageData(ke,He):ke;se(null,new s.fz(ve,at,je,He<1))}reloadTile(ne,se){se(null,null)}abortTile(ne,se){se()}removeTile(ne,se){se()}getImageData(ne,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ve=this.offscreenCanvasContext.getImageData(-se,-se,ne.width+2*se,ne.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}s.br.setPbf(s.bs);class st{constructor(ne){this._mrt=new s.br(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,se){const ve=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ve.parseHeader(ne),this._isHeaderLoaded=!0;const je=[];for(const ke in ve.layers){const He=ve.getLayer(ke),at=He.getDataRange(He.getBandList()),qe=ve.createDecodingTask(at),nt=ne.slice(at.firstByte,at.lastByte+1),Bt=s.br.performDecoding(nt,qe).then((It=>qe.complete(null,It))).catch((It=>qe.complete(It,null)));je.push(Bt)}Promise.allSettled(je).then((()=>se(null,ve))).catch((ke=>se(ke)))}catch(je){se(je)}}}class Et{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,se){const ve=ne.uid,je=ne.request,ke=this.loading[ve]=new st(ne),{cancel:He}=s.bt(je,((at,qe,nt)=>{const Bt=!this.loading[ve];if(delete this.loading[ve],Bt||at||!qe)return ke.status="done",Bt||(this.loaded[ve]=ke),se(at);ke.parse(qe,((It,vn)=>{if(It||!vn)return se(It);se(null,vn,nt)})),this.loaded[ve]=ke}));ke.abort=He}reloadTile(ne,se){se(null,void 0)}abortTile(ne,se){const ve=ne.uid,je=this.loading[ve];je&&(je.abort&&je.abort(),delete this.loading[ve]),se()}removeTile(ne,se){const ve=ne.uid;this.loaded[ve]&&delete this.loaded[ve],se()}decodeRasterArray(ne,se){s.br.performDecoding(ne.buffer,ne.task).then((ve=>se(null,ve))).catch((ve=>se(ve)))}}const Ut=s.fA.prototype.toGeoJSON;class $t{constructor(ne){this._feature=ne,this.extent=s.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const se of this._feature.geometry)ne.push([new s.P(se[0],se[1])]);return ne}{const ne=[];for(const se of this._feature.geometry){const ve=[];for(const je of se)ve.push(new s.P(je[0],je[1]));ne.push(ve)}return ne}}toGeoJSON(ne,se,ve){return Ut.call(this,ne,se,ve)}}class tt{constructor(ne,se){this.name=ne,this.extent=s.al,this.length=se.length,this._jsonFeatures=se}feature(ne){return new $t(this._jsonFeatures[ne])}}class ut{constructor(ne){this.layers={},this.extent=s.al;for(const se of Object.keys(ne))this.layers[se]=new tt(se,ne[se])}}const on=64/4096,Ke=128;class ze{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],se){for(const ve of ne){const je=ve.id;if(je==null)continue;let ke=this.features.get(je);ke&&this.updateCache(ke,se),ve.geometry?(ke=kt(ve),this.updateCache(ke,se),this.features.set(je,ke)):this.features.delete(je),this.updateCache(ke,se)}}updateCache(ne,se){for(const{canonical:ve,uid:je}of Object.values(se)){const{z:ke,x:He,y:at}=ve;Fe(ne,Math.pow(2,ke),He,at)&&delete se[je]}}getTile(ne,se,ve){const je=Math.pow(2,ne),ke=[];for(const He of this.features.values())Fe(He,je,se,ve)&&ke.push(vt(He,je,se,ve));return{features:ke}}getFeatures(){return[...this.features.values()]}}function Fe({minX:We,minY:ne,maxX:se,maxY:ve},je,ke,He){return We<(ke+1+on)/je&&ne<(He+1+on)/je&&se>(ke-on)/je&&ve>(He-on)/je}function kt(We){const{id:ne,geometry:se,properties:ve}=We;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:je,coordinates:ke}=se,He={id:ne,type:1,geometry:[],tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},at=He.geometry;if(je==="Point")fn(ke,at,He);else if(je==="MultiPoint")for(const qe of ke)fn(qe,at,He);else if(je==="LineString")He.type=2,Me(ke,at,He);else if(je==="MultiLineString")He.type=2,ct(ke,at,He);else if(je==="Polygon")He.type=3,ct(ke,at,He,!0);else{if(je!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");He.type=3;for(const qe of ke)ct(qe,at,He,!0)}return He}function fn([We,ne],se,ve){const je=s.aF(We);let ke=s.aJ(ne);ke=ke<0?0:ke>1?1:ke,se.push(je,ke),ve.minX=Math.min(ve.minX,je),ve.minY=Math.min(ve.minY,ke),ve.maxX=Math.max(ve.maxX,je),ve.maxY=Math.max(ve.maxY,ke)}function Me(We,ne,se,ve=!1,je=!1){const ke=[];for(const He of We)fn(He,ke,se);ne.push(ke),ve&&(function(He,at){let qe=0;for(let nt=0,Bt=He.length,It=Bt-2;nt<Bt;It=nt,nt+=2)qe+=(He[nt]-He[It])*(He[nt+1]+He[It+1]);if(qe>0===at)for(let nt=0,Bt=He.length;nt<Bt/2;nt+=2){const It=He[nt],vn=He[nt+1];He[nt]=He[Bt-2-nt],He[nt+1]=He[Bt-1-nt],He[Bt-2-nt]=It,He[Bt-1-nt]=vn}})(ke,je)}function ct(We,ne,se,ve=!1){for(let je=0;je<We.length;je++)Me(We[je],ne,se,ve,je===0)}function vt(We,ne,se,ve){const{id:je,type:ke,geometry:He,tags:at}=We,qe=[];if(ke===1)(function(nt,Bt,It,vn,$n){for(let Bn=0;Bn<nt.length;Bn+=2){const Tn=Math.round(s.al*(nt[Bn+0]*Bt-It)),pi=Math.round(s.al*(nt[Bn+1]*Bt-vn));$n.push([Tn,pi])}})(He,ne,se,ve,qe);else for(const nt of He)Kt(nt,ne,se,ve,qe);return{id:je,type:ke,geometry:qe,tags:at}}function Kt(We,ne,se,ve,je){const ke=-Ke,He=s.al+Ke;let at;for(let qe=0;qe<We.length-2;qe+=2){let nt=Math.round(s.al*(We[qe+0]*ne-se)),Bt=Math.round(s.al*(We[qe+1]*ne-ve)),It=Math.round(s.al*(We[qe+2]*ne-se)),vn=Math.round(s.al*(We[qe+3]*ne-ve));const $n=It-nt,Bn=vn-Bt;nt<ke&&It<ke||(nt<ke?(Bt+=Math.round(Bn*((ke-nt)/$n)),nt=ke):It<ke&&(vn=Bt+Math.round(Bn*((ke-nt)/$n)),It=ke),Bt<ke&&vn<ke||(Bt<ke?(nt+=Math.round($n*((ke-Bt)/Bn)),Bt=ke):vn<ke&&(It=nt+Math.round($n*((ke-Bt)/Bn)),vn=ke),nt>=He&&It>=He||(nt>=He?(Bt+=Math.round(Bn*((He-nt)/$n)),nt=He):It>=He&&(vn=Bt+Math.round(Bn*((He-nt)/$n)),It=He),Bt>=He&&vn>=He||(Bt>=He?(nt+=Math.round($n*((He-Bt)/Bn)),Bt=He):vn>=He&&(It=nt+Math.round($n*((He-Bt)/Bn)),vn=He),at&&nt===at[at.length-1][0]&&Bt===at[at.length-1][1]||(at=[[nt,Bt]],je.push(at)),at.push([It,vn])))))}}function zn({name:We,features:ne},se){se.writeStringField(1,We),se.writeVarintField(5,s.al);const ve=new Map,je=new Map,ke={keys:ve,values:je,feature:null};for(const He of ne)ke.feature=He,se.writeMessage(2,Nn,ke);for(const He of ve.keys())se.writeStringField(3,He);for(const He of je.keys())se.writeMessage(4,gi,He)}function Nn(We,ne){const se=We.feature;se.id!==void 0&&Number.isSafeInteger(+se.id)&&ne.writeVarintField(1,+se.id),se.tags&&ne.writeMessage(2,Yt,We),ne.writeVarintField(3,se.type),ne.writeMessage(4,In,se)}function Yt({keys:We,values:ne,feature:se},ve){for(const je of Object.keys(se.tags)){let ke=se.tags[je];if(ke===null)continue;let He=We.get(je);He===void 0&&(He=We.size,We.set(je,He)),ve.writeVarint(He);const at=typeof ke;at!=="string"&&at!=="boolean"&&at!=="number"&&(ke=JSON.stringify(ke));let qe=ne.get(ke);qe===void 0&&(qe=ne.size,ne.set(ke,qe)),ve.writeVarint(qe)}}function On(We,ne){return(ne<<3)+(7&We)}function An(We){return We<<1^We>>31}function In(We,ne){const{geometry:se,type:ve}=We;let je=0,ke=0;if(ve===1){ne.writeVarint(On(1,se.length));for(const He of se){const at=He[0]-je,qe=He[1]-ke;ne.writeVarint(An(at)),ne.writeVarint(An(qe)),je+=at,ke+=qe}}else for(const He of se){ne.writeVarint(On(1,1));const at=He.length-(ve===3?1:0);for(let qe=0;qe<at;qe++){qe===1&&ne.writeVarint(On(2,at-1));const nt=He[qe][0]-je,Bt=He[qe][1]-ke;ne.writeVarint(An(nt)),ne.writeVarint(An(Bt)),je+=nt,ke+=Bt}ve===3&&ne.writeVarint(On(7,1))}}function gi(We,ne){const se=typeof We;se==="string"?ne.writeStringField(1,We):se==="boolean"?ne.writeBooleanField(7,We):se==="number"&&(We%1!=0?ne.writeDoubleField(3,We):We<0?ne.writeSVarintField(6,We):ne.writeVarintField(5,We))}const ji={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},Ri=Math.fround||(Rr=new Float32Array(1),We=>(Rr[0]=+We,Rr[0]));var Rr;const cs=3,wr=5,jn=6;class ti{constructor(ne){this.options=Object.assign(Object.create(ji),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:se,minZoom:ve,maxZoom:je}=this.options;se&&console.time("total time");const ke=`prepare ${ne.length} points`;se&&console.time(ke),this.points=ne;const He=[];for(let qe=0;qe<ne.length;qe++){const nt=ne[qe];if(!nt.geometry)continue;const[Bt,It]=nt.geometry.coordinates,vn=Ri(Ot(Bt)),$n=Ri(nn(It));He.push(vn,$n,1/0,qe,-1,1),this.options.reduce&&He.push(0)}let at=this.trees[je+1]=this._createTree(He);se&&console.timeEnd(ke);for(let qe=je;qe>=ve;qe--){const nt=+Date.now();at=this.trees[qe]=this._createTree(this._cluster(at,qe)),se&&console.log("z%d: %d clusters in %dms",qe,at.numItems,+Date.now()-nt)}return se&&console.timeEnd("total time"),this}getClusters(ne,se){let ve=((ne[0]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,ne[1]));let ke=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ve=-180,ke=180;else if(ve>ke){const It=this.getClusters([ve,je,180,He],se),vn=this.getClusters([-180,je,ke,He],se);return It.concat(vn)}const at=this.trees[this._limitZoom(se)],qe=at.range(Ot(ve),nn(He),Ot(ke),nn(je)),nt=at.data,Bt=[];for(const It of qe){const vn=this.stride*It;Bt.push(nt[vn+wr]>1?rr(nt,vn,this.clusterProps):this.points[nt[vn+cs]])}return Bt}getChildren(ne){const se=this._getOriginId(ne),ve=this._getOriginZoom(ne),je="No cluster with the specified id.",ke=this.trees[ve];if(!ke)throw new Error(je);const He=ke.data;if(se*this.stride>=He.length)throw new Error(je);const at=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),qe=ke.within(He[se*this.stride],He[se*this.stride+1],at),nt=[];for(const Bt of qe){const It=Bt*this.stride;He[It+4]===ne&&nt.push(He[It+wr]>1?rr(He,It,this.clusterProps):this.points[He[It+cs]])}if(nt.length===0)throw new Error(je);return nt}getLeaves(ne,se,ve){const je=[];return this._appendLeaves(je,ne,se=se||10,ve=ve||0,0),je}getTile(ne,se,ve){const je=this.trees[this._limitZoom(ne)],ke=Math.pow(2,ne),{extent:He,radius:at}=this.options,qe=at/He,nt=(ve-qe)/ke,Bt=(ve+1+qe)/ke,It={features:[]};return this._addTileFeatures(je.range((se-qe)/ke,nt,(se+1+qe)/ke,Bt),je.data,se,ve,ke,It),se===0&&this._addTileFeatures(je.range(1-qe/ke,nt,1,Bt),je.data,ke,ve,ke,It),se===ke-1&&this._addTileFeatures(je.range(0,nt,qe/ke,Bt),je.data,-1,ve,ke,It),It.features.length?It:null}getClusterExpansionZoom(ne){let se=this._getOriginZoom(ne)-1;for(;se<=this.options.maxZoom;){const ve=this.getChildren(ne);if(se++,ve.length!==1)break;ne=ve[0].properties.cluster_id}return se}_appendLeaves(ne,se,ve,je,ke){const He=this.getChildren(se);for(const at of He){const qe=at.properties;if(qe&&qe.cluster?ke+qe.point_count<=je?ke+=qe.point_count:ke=this._appendLeaves(ne,qe.cluster_id,ve,je,ke):ke<je?ke++:ne.push(at),ne.length===ve)break}return ke}_createTree(ne){const se=new s.c3(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<ne.length;ve+=this.stride)se.add(ne[ve],ne[ve+1]);return se.finish(),se.data=ne,se}_addTileFeatures(ne,se,ve,je,ke,He){for(const at of ne){const qe=at*this.stride,nt=se[qe+wr]>1;let Bt,It,vn;if(nt)Bt=et(se,qe,this.clusterProps),It=se[qe],vn=se[qe+1];else{const Tn=this.points[se[qe+cs]];Bt=Tn.properties;const[pi,_i]=Tn.geometry.coordinates;It=Ot(pi),vn=nn(_i)}const $n={type:1,geometry:[[Math.round(this.options.extent*(It*ke-ve)),Math.round(this.options.extent*(vn*ke-je))]],tags:Bt};let Bn;Bn=nt||this.options.generateId?se[qe+cs]:this.points[se[qe+cs]].id,Bn!==void 0&&($n.id=Bn),He.features.push($n)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,se){const{radius:ve,extent:je,reduce:ke,minPoints:He}=this.options,at=ve/(je*Math.pow(2,se)),qe=ne.data,nt=[],Bt=this.stride;for(let It=0;It<qe.length;It+=Bt){if(qe[It+2]<=se)continue;qe[It+2]=se;const vn=qe[It],$n=qe[It+1],Bn=ne.within(qe[It],qe[It+1],at),Tn=qe[It+wr];let pi=Tn;for(const _i of Bn){const Hi=_i*Bt;qe[Hi+2]>se&&(pi+=qe[Hi+wr])}if(pi>Tn&&pi>=He){let _i,Hi=vn*Tn,Lr=$n*Tn,Ps=-1;const gs=(It/Bt<<5)+(se+1)+this.points.length;for(const ds of Bn){const ar=ds*Bt;if(qe[ar+2]<=se)continue;qe[ar+2]=se;const Ei=qe[ar+wr];Hi+=qe[ar]*Ei,Lr+=qe[ar+1]*Ei,qe[ar+4]=gs,ke&&(_i||(_i=this._map(qe,It,!0),Ps=this.clusterProps.length,this.clusterProps.push(_i)),ke(_i,this._map(qe,ar)))}qe[It+4]=gs,nt.push(Hi/pi,Lr/pi,1/0,gs,-1,pi),ke&&nt.push(Ps)}else{for(let _i=0;_i<Bt;_i++)nt.push(qe[It+_i]);if(pi>1)for(const _i of Bn){const Hi=_i*Bt;if(!(qe[Hi+2]<=se)){qe[Hi+2]=se;for(let Lr=0;Lr<Bt;Lr++)nt.push(qe[Hi+Lr])}}}}return nt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,se,ve){if(ne[se+wr]>1){const He=this.clusterProps[ne[se+jn]];return ve?Object.assign({},He):He}const je=this.points[ne[se+cs]].properties,ke=this.options.map(je);return ve&&ke===je?Object.assign({},ke):ke}}function rr(We,ne,se){return{type:"Feature",id:We[ne+cs],properties:et(We,ne,se),geometry:{type:"Point",coordinates:[(ve=We[ne],360*(ve-.5)),Kn(We[ne+1])]}};var ve}function et(We,ne,se){const ve=We[ne+wr],je=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,ke=We[ne+jn],He=ke===-1?{}:Object.assign({},se[ke]);return Object.assign(He,{cluster:!0,cluster_id:We[ne+cs],point_count:ve,point_count_abbreviated:je})}function Ot(We){return We/360+.5}function nn(We){const ne=Math.sin(We*Math.PI/180),se=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return se<0?0:se>1?1:se}function Kn(We){const ne=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function yn(We,ne,se,ve){let je=ve;const ke=ne+(se-ne>>1);let He,at=se-ne;const qe=We[ne],nt=We[ne+1],Bt=We[se],It=We[se+1];for(let vn=ne+3;vn<se;vn+=3){const $n=Dn(We[vn],We[vn+1],qe,nt,Bt,It);if($n>je)He=vn,je=$n;else if($n===je){const Bn=Math.abs(vn-ke);Bn<at&&(He=vn,at=Bn)}}je>ve&&(He-ne>3&&yn(We,ne,He,ve),We[He+2]=je,se-He>3&&yn(We,He,se,ve))}function Dn(We,ne,se,ve,je,ke){let He=je-se,at=ke-ve;if(He!==0||at!==0){const qe=((We-se)*He+(ne-ve)*at)/(He*He+at*at);qe>1?(se=je,ve=ke):qe>0&&(se+=He*qe,ve+=at*qe)}return He=We-se,at=ne-ve,He*He+at*at}function ci(We,ne,se,ve){const je={id:We??null,type:ne,geometry:se,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Yi(je,se);else if(ne==="Polygon")Yi(je,se[0]);else if(ne==="MultiLineString")for(const ke of se)Yi(je,ke);else if(ne==="MultiPolygon")for(const ke of se)Yi(je,ke[0]);return je}function Yi(We,ne){for(let se=0;se<ne.length;se+=3)We.minX=Math.min(We.minX,ne[se]),We.minY=Math.min(We.minY,ne[se+1]),We.maxX=Math.max(We.maxX,ne[se]),We.maxY=Math.max(We.maxY,ne[se+1])}function or(We,ne,se,ve){if(!ne.geometry)return;const je=ne.geometry.coordinates;if(je&&je.length===0)return;const ke=ne.geometry.type,He=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let at=[],qe=ne.id;if(se.promoteId?qe=ne.properties[se.promoteId]:se.generateId&&(qe=ve||0),ke==="Point")Gr(je,at);else if(ke==="MultiPoint")for(const nt of je)Gr(nt,at);else if(ke==="LineString")ea(je,at,He,!1);else if(ke==="MultiLineString"){if(se.lineMetrics){for(const nt of je)at=[],ea(nt,at,He,!1),We.push(ci(qe,"LineString",at,ne.properties));return}vs(je,at,He,!1)}else if(ke==="Polygon")vs(je,at,He,!0);else{if(ke!=="MultiPolygon"){if(ke==="GeometryCollection"){for(const nt of ne.geometry.geometries)or(We,{id:qe,geometry:nt,properties:ne.properties},se,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of je){const Bt=[];vs(nt,Bt,He,!0),at.push(Bt)}}We.push(ci(qe,ke,at,ne.properties))}function Gr(We,ne){ne.push(Ol(We[0]),ta(We[1]),0)}function ea(We,ne,se,ve){let je,ke,He=0;for(let qe=0;qe<We.length;qe++){const nt=Ol(We[qe][0]),Bt=ta(We[qe][1]);ne.push(nt,Bt,0),qe>0&&(He+=ve?(je*Bt-nt*ke)/2:Math.sqrt(Math.pow(nt-je,2)+Math.pow(Bt-ke,2))),je=nt,ke=Bt}const at=ne.length-3;ne[2]=1,yn(ne,0,at,se),ne[at+2]=1,ne.size=Math.abs(He),ne.start=0,ne.end=ne.size}function vs(We,ne,se,ve){for(let je=0;je<We.length;je++){const ke=[];ea(We[je],ke,se,ve),ne.push(ke)}}function Ol(We){return We/360+.5}function ta(We){const ne=Math.sin(We*Math.PI/180),se=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return se<0?0:se>1?1:se}function dr(We,ne,se,ve,je,ke,He,at){if(ve/=ne,ke>=(se/=ne)&&He<ve)return We;if(He<se||ke>=ve)return null;const qe=[];for(const nt of We){const Bt=nt.geometry;let It=nt.type;const vn=je===0?nt.minX:nt.minY,$n=je===0?nt.maxX:nt.maxY;if(vn>=se&&$n<ve){qe.push(nt);continue}if($n<se||vn>=ve)continue;let Bn=[];if(It==="Point"||It==="MultiPoint")lo(Bt,Bn,se,ve,je);else if(It==="LineString")Os(Bt,Bn,se,ve,je,!1,at.lineMetrics);else if(It==="MultiLineString")Go(Bt,Bn,se,ve,je,!1);else if(It==="Polygon")Go(Bt,Bn,se,ve,je,!0);else if(It==="MultiPolygon")for(const Tn of Bt){const pi=[];Go(Tn,pi,se,ve,je,!0),pi.length&&Bn.push(pi)}if(Bn.length){if(at.lineMetrics&&It==="LineString"){for(const Tn of Bn)qe.push(ci(nt.id,It,Tn,nt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(Bn.length===1?(It="LineString",Bn=Bn[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=Bn.length===3?"Point":"MultiPoint"),qe.push(ci(nt.id,It,Bn,nt.tags))}}return qe.length?qe:null}function lo(We,ne,se,ve,je){for(let ke=0;ke<We.length;ke+=3){const He=We[ke+je];He>=se&&He<=ve&&Ia(ne,We[ke],We[ke+1],We[ke+2])}}function Os(We,ne,se,ve,je,ke,He){let at=Za(We);const qe=je===0?Mr:js;let nt,Bt,It=We.start;for(let pi=0;pi<We.length-3;pi+=3){const _i=We[pi],Hi=We[pi+1],Lr=We[pi+2],Ps=We[pi+3],gs=We[pi+4],ds=je===0?_i:Hi,ar=je===0?Ps:gs;let Ei=!1;He&&(nt=Math.sqrt(Math.pow(_i-Ps,2)+Math.pow(Hi-gs,2))),ds<se?ar>se&&(Bt=qe(at,_i,Hi,Ps,gs,se),He&&(at.start=It+nt*Bt)):ds>ve?ar<ve&&(Bt=qe(at,_i,Hi,Ps,gs,ve),He&&(at.start=It+nt*Bt)):Ia(at,_i,Hi,Lr),ar<se&&ds>=se&&(Bt=qe(at,_i,Hi,Ps,gs,se),Ei=!0),ar>ve&&ds<=ve&&(Bt=qe(at,_i,Hi,Ps,gs,ve),Ei=!0),!ke&&Ei&&(He&&(at.end=It+nt*Bt),ne.push(at),at=Za(We)),He&&(It+=nt)}let vn=We.length-3;const $n=We[vn],Bn=We[vn+1],Tn=je===0?$n:Bn;Tn>=se&&Tn<=ve&&Ia(at,$n,Bn,We[vn+2]),vn=at.length-3,ke&&vn>=3&&(at[vn]!==at[0]||at[vn+1]!==at[1])&&Ia(at,at[0],at[1],at[2]),at.length&&ne.push(at)}function Za(We){const ne=[];return ne.size=We.size,ne.start=We.start,ne.end=We.end,ne}function Go(We,ne,se,ve,je,ke){for(const He of We)Os(He,ne,se,ve,je,ke,!1)}function Ia(We,ne,se,ve){We.push(ne,se,ve)}function Mr(We,ne,se,ve,je,ke){const He=(ke-ne)/(ve-ne);return Ia(We,ke,se+(je-se)*He,1),He}function js(We,ne,se,ve,je,ke){const He=(ke-se)/(je-se);return Ia(We,ne+(ve-ne)*He,ke,1),He}function Cs(We,ne){const se=[];for(let ve=0;ve<We.length;ve++){const je=We[ve],ke=je.type;let He;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")He=bs(je.geometry,ne);else if(ke==="MultiLineString"||ke==="Polygon"){He=[];for(const at of je.geometry)He.push(bs(at,ne))}else if(ke==="MultiPolygon"){He=[];for(const at of je.geometry){const qe=[];for(const nt of at)qe.push(bs(nt,ne));He.push(qe)}}se.push(ci(je.id,ke,He,je.tags))}return se}function bs(We,ne){const se=[];se.size=We.size,We.start!==void 0&&(se.start=We.start,se.end=We.end);for(let ve=0;ve<We.length;ve+=3)se.push(We[ve]+ne,We[ve+1],We[ve+2]);return se}function us(We,ne){if(We.transformed)return We;const se=1<<We.z,ve=We.x,je=We.y;for(const ke of We.features){const He=ke.geometry,at=ke.type;if(ke.geometry=[],at===1)for(let qe=0;qe<He.length;qe+=2)ke.geometry.push(Ho(He[qe],He[qe+1],ne,se,ve,je));else for(let qe=0;qe<He.length;qe++){const nt=[];for(let Bt=0;Bt<He[qe].length;Bt+=2)nt.push(Ho(He[qe][Bt],He[qe][Bt+1],ne,se,ve,je));ke.geometry.push(nt)}}return We.transformed=!0,We}function Ho(We,ne,se,ve,je,ke){return[Math.round(se*(We*ve-je)),Math.round(se*(ne*ve-ke))]}function Do(We,ne,se,ve,je){const ke=ne===je.maxZoom?0:je.tolerance/((1<<ne)*je.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:se,y:ve,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const at of We)Po(He,at,ke,je);return He}function Po(We,ne,se,ve){const je=ne.geometry,ke=ne.type,He=[];if(We.minX=Math.min(We.minX,ne.minX),We.minY=Math.min(We.minY,ne.minY),We.maxX=Math.max(We.maxX,ne.maxX),We.maxY=Math.max(We.maxY,ne.maxY),ke==="Point"||ke==="MultiPoint")for(let at=0;at<je.length;at+=3)He.push(je[at],je[at+1]),We.numPoints++,We.numSimplified++;else if(ke==="LineString")wo(He,je,We,se,!1,!1);else if(ke==="MultiLineString"||ke==="Polygon")for(let at=0;at<je.length;at++)wo(He,je[at],We,se,ke==="Polygon",at===0);else if(ke==="MultiPolygon")for(let at=0;at<je.length;at++){const qe=je[at];for(let nt=0;nt<qe.length;nt++)wo(He,qe[nt],We,se,!0,nt===0)}if(He.length){let at=ne.tags||null;if(ke==="LineString"&&ve.lineMetrics){at={};for(const nt in ne.tags)at[nt]=ne.tags[nt];at.mapbox_clip_start=je.start/je.size,at.mapbox_clip_end=je.end/je.size}const qe={geometry:He,type:ke==="Polygon"||ke==="MultiPolygon"?3:ke==="LineString"||ke==="MultiLineString"?2:1,tags:at};ne.id!==null&&(qe.id=ne.id),We.features.push(qe)}}function wo(We,ne,se,ve,je,ke){const He=ve*ve;if(ve>0&&ne.size<(je?He:ve))return void(se.numPoints+=ne.length/3);const at=[];for(let qe=0;qe<ne.length;qe+=3)(ve===0||ne[qe+2]>He)&&(se.numSimplified++,at.push(ne[qe],ne[qe+1])),se.numPoints++;je&&(function(qe,nt){let Bt=0;for(let It=0,vn=qe.length,$n=vn-2;It<vn;$n=It,It+=2)Bt+=(qe[It]-qe[$n])*(qe[It+1]+qe[$n+1]);if(Bt>0===nt)for(let It=0,vn=qe.length;It<vn/2;It+=2){const $n=qe[It],Bn=qe[It+1];qe[It]=qe[vn-2-It],qe[It+1]=qe[vn-1-It],qe[vn-2-It]=$n,qe[vn-1-It]=Bn}})(at,ke),We.push(at)}const Ct={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Rs{constructor(ne,se){const ve=(se=this.options=(function(ke,He){for(const at in He)ke[at]=He[at];return ke})(Object.create(Ct),se)).debug;if(ve&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let je=(function(ke,He){const at=[];if(ke.type==="FeatureCollection")for(let qe=0;qe<ke.features.length;qe++)or(at,ke.features[qe],He,qe);else or(at,ke.type==="Feature"?ke:{geometry:ke},He);return at})(ne,se);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=(function(ke,He){const at=He.buffer/He.extent;let qe=ke;const nt=dr(ke,1,-1-at,at,0,-1,2,He),Bt=dr(ke,1,1-at,2+at,0,-1,2,He);return(nt||Bt)&&(qe=dr(ke,1,-at,1+at,0,-1,2,He)||[],nt&&(qe=Cs(nt,1).concat(qe)),Bt&&(qe=qe.concat(Cs(Bt,-1)))),qe})(je,se),je.length&&this.splitTile(je,0,0,0),ve&&(je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,se,ve,je,ke,He,at){const qe=[ne,se,ve,je],nt=this.options,Bt=nt.debug;for(;qe.length;){je=qe.pop(),ve=qe.pop(),se=qe.pop(),ne=qe.pop();const It=1<<se,vn=ga(se,ve,je);let $n=this.tiles[vn];if(!$n&&(Bt>1&&console.time("creation"),$n=this.tiles[vn]=Do(ne,se,ve,je,nt),this.tileCoords.push({z:se,x:ve,y:je}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,ve,je,$n.numFeatures,$n.numPoints,$n.numSimplified),console.timeEnd("creation"));const Ei=`z${se}`;this.stats[Ei]=(this.stats[Ei]||0)+1,this.total++}if($n.source=ne,ke==null){if(se===nt.indexMaxZoom||$n.numPoints<=nt.indexMaxPoints)continue}else{if(se===nt.maxZoom||se===ke)continue;if(ke!=null){const Ei=ke-se;if(ve!==He>>Ei||je!==at>>Ei)continue}}if($n.source=null,ne.length===0)continue;Bt>1&&console.time("clipping");const Bn=.5*nt.buffer/nt.extent,Tn=.5-Bn,pi=.5+Bn,_i=1+Bn;let Hi=null,Lr=null,Ps=null,gs=null,ds=dr(ne,It,ve-Bn,ve+pi,0,$n.minX,$n.maxX,nt),ar=dr(ne,It,ve+Tn,ve+_i,0,$n.minX,$n.maxX,nt);ne=null,ds&&(Hi=dr(ds,It,je-Bn,je+pi,1,$n.minY,$n.maxY,nt),Lr=dr(ds,It,je+Tn,je+_i,1,$n.minY,$n.maxY,nt),ds=null),ar&&(Ps=dr(ar,It,je-Bn,je+pi,1,$n.minY,$n.maxY,nt),gs=dr(ar,It,je+Tn,je+_i,1,$n.minY,$n.maxY,nt),ar=null),Bt>1&&console.timeEnd("clipping"),qe.push(Hi||[],se+1,2*ve,2*je),qe.push(Lr||[],se+1,2*ve,2*je+1),qe.push(Ps||[],se+1,2*ve+1,2*je),qe.push(gs||[],se+1,2*ve+1,2*je+1)}}getTile(ne,se,ve){ne=+ne,se=+se,ve=+ve;const je=this.options,{extent:ke,debug:He}=je;if(ne<0||ne>24)return null;const at=1<<ne,qe=ga(ne,se=se+at&at-1,ve);if(this.tiles[qe])return us(this.tiles[qe],ke);He>1&&console.log("drilling down to z%d-%d-%d",ne,se,ve);let nt,Bt=ne,It=se,vn=ve;for(;!nt&&Bt>0;)Bt--,It>>=1,vn>>=1,nt=this.tiles[ga(Bt,It,vn)];return nt&&nt.source?(He>1&&(console.log("found parent tile z%d-%d-%d",Bt,It,vn),console.time("drilling down")),this.splitTile(nt.source,Bt,It,vn,ne,se,ve),He>1&&console.timeEnd("drilling down"),this.tiles[qe]?us(this.tiles[qe],ke):null):null}}function ga(We,ne,se){return 32*((1<<We)*se+ne)+We}function qo(We,ne){const se=We.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ve=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!ve)return void ne(null,null);const je=nt=>nt.tags&&"3d_elevation_id"in nt.tags&&"source"in nt.tags&&nt.tags.source==="elevation",ke=ve.features.filter((nt=>je(nt)));let He={_geojsonTileLayer:ve.features};ke.length>0&&(He={_geojsonTileLayer:ve.features.filter((nt=>!je(nt))),hd_road_elevation:ke});const at=new ut(He),qe=(function(nt){const Bt=new s.bs;for(const It of Object.keys(nt))Bt.writeMessage(3,zn,{name:It,features:nt[It]});return Bt.finish()})(He).buffer;ne(null,{vectorTile:at,rawData:qe})}class fi extends Le{constructor(ne,se,ve,je,ke,He,at){super(ne,se,ve,je,ke,qo,at),He&&(this.loadGeoJSON=He),this._dynamicIndex=new ze}loadData(ne,se){const ve=ne&&ne.request,je=ve&&ve.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,((ke,He)=>{if(ke||!He)return se(ke);if(typeof He!="object")return se(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const qe=s.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map((nt=>`${nt.key}: ${nt.message}`)).join(", "));He.features=He.features.filter((nt=>qe.value.evaluate({zoom:0},nt)))}ne.dynamic?(He.type==="Feature"&&(He={type:"FeatureCollection",features:[He]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(He.features,this.loaded),ne.cluster&&(He.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new ti((function({superclusterOptions:qe,clusterProperties:nt}){if(!nt||!qe)return qe;const Bt={},It={},vn={accumulated:null,zoom:0},$n={properties:null},Bn=Object.keys(nt);for(const Tn of Bn){const[pi,_i]=nt[Tn],Hi=s.U(_i),Lr=s.U(typeof pi=="string"?[pi,["accumulated"],["get",Tn]]:pi);Bt[Tn]=Hi.value,It[Tn]=Lr.value}return qe.map=Tn=>{$n.properties=Tn;const pi={};for(const _i of Bn)pi[_i]=Bt[_i].evaluate(vn,$n);return pi},qe.reduce=(Tn,pi)=>{$n.properties=pi;for(const _i of Bn)vn.accumulated=Tn[_i],Tn[_i]=It[_i].evaluate(vn,$n)},qe})(ne)).load(He.features):ne.dynamic?this._dynamicIndex:(function(qe,nt){return new Rs(qe,nt)})(He,ne.geojsonVtOptions)}catch(qe){return se(qe)}const at={};if(je){const qe=O(ve);qe&&(at.resourceTiming={},at.resourceTiming[ne.source]=JSON.parse(JSON.stringify(qe)))}se(null,at)}}))}reloadTile(ne,se){const ve=this.loaded;return ve&&ve[ne.uid]?ne.partial?se(null,void 0):super.reloadTile(ne,se):this.loadTile(ne,se)}loadGeoJSON(ne,se){if(ne.request)s.m(ne.request,se);else{if(typeof ne.data!="string")return se(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return se(null,JSON.parse(ne.data))}catch{return se(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(ne,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ve){se(ve)}}getClusterChildren(ne,se){try{se(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ve){se(ve)}}getClusterLeaves(ne,se){try{se(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ve){se(ve)}}}class Ds{constructor(ne,se,ve){this.tileID=new s.aP(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=se,this.worldview=ve}parse(ne,se,ve,je){this.status="parsing";const ke=new s.aP(ve.tileID.overscaledZ,ve.tileID.wrap,ve.tileID.canonical.z,ve.tileID.canonical.x,ve.tileID.canonical.y),He=[],at=se.familiesBySource[ve.source],qe=new s.fm(ke,ve.promoteId);qe.bucketLayerIDs=[],qe.is3DTile=!0,s.fB(ne).then((nt=>{if(!nt)return je(new Error("Could not parse tile"));const Bt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("MAPBOX_mesh_features")||nt.json.asset.extras&&nt.json.asset.extras.MAPBOX_mesh_features,It=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("EXT_meshopt_compression"),vn=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const $n in at)for(const Bn of at[$n]){const Tn=Bn[0];qe.bucketLayerIDs.push(Bn.map((Hi=>s.B(Hi.id,Hi.scope)))),Tn.recalculate(vn,[]);const pi=s.fC(nt,1/s.d6(ve.tileID.canonical)),_i=new s.fD(Bn,pi,ke,Bt,It,this.brightness,qe,this.worldview);Bt||(_i.needsUpload=!0),He.push(_i),_i.evaluate(Tn)}this.status="done",je(null,{buckets:He,featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((nt=>je(new Error(nt.message))))}}class zl{constructor(ne,se,ve,je,ke,He,at,qe){this.actor=ne,this.layerIndex=se,this.availableImages=ve,this.availableModels=je,this.brightness=at,this.loading={},this.loaded={},this.worldview=qe}loadTile(ne,se){const ve=ne.uid,je=this.loading[ve]=new Ds(ne,this.brightness,this.worldview);s.bt(ne.request,((ke,He)=>{const at=!this.loading[ve];return delete this.loading[ve],at||ke?(je.status="done",at||(this.loaded[ve]=je),se(ke)):He&&He.byteLength!==0?void je.parse(He,this.layerIndex,ne,((qe,nt)=>{je.status="done",this.loaded=this.loaded||{},this.loaded[ve]=je,qe||!nt?se(qe):se(null,nt)})):(je.status="done",this.loaded[ve]=je,se())}))}reloadTile(ne,se){const ve=this.loaded,je=ne.uid;if(ve&&ve[je]){const ke=ve[je];ke.projection=ne.projection,ke.brightness=ne.brightness;const He=(at,qe)=>{ke.reloadCallback&&(delete ke.reloadCallback,this.loadTile(ne,se)),se(at,qe)};ke.status==="parsing"?ke.reloadCallback=He:ke.status==="done"&&this.loadTile(ne,se)}}abortTile(ne,se){const ve=ne.uid;this.loading[ve]&&delete this.loading[ve],se()}removeTile(ne,se){const ve=this.loaded,je=ne.uid;ve&&ve[je]&&delete ve[je],se()}}class _a{constructor(ne){this.self=ne,this.actor=new s.fF(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cl({name:"mercator"}),this.workerSourceTypes={vector:Le,geojson:fi,"raster-dem":$e,"raster-array":Et,"batched-model":zl},this.workerSources={},this.self.registerWorkerSource=(se,ve)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=ve},this.self.registerRTLTextPlugin=se=>{if(s.fG.isParsed())throw new Error("RTL text plugin already registered.");s.fG.setState({pluginStatus:s.fH.parsed,pluginURL:s.fG.getPluginURL()}),s.fG.applyArabicShaping=se.applyArabicShaping,s.fG.processBidirectionalText=se.processBidirectionalText,s.fG.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const ve of this.rtlPluginParsingListeners)ve(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,se,ve){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ve()}checkIfReady(ne,se,ve){ve()}setReferrer(ne,se){this.referrer=se}spriteLoaded(ne,se){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ve,isLoaded:je}=se;if(this.isSpriteLoaded[ne][ve]=je,this.workerSources[ne]&&this.workerSources[ne][ve])for(const ke in this.workerSources[ne][ve]){const He=this.workerSources[ne][ve][ke];for(const at in He){const qe=He[at];qe instanceof Le&&(qe.isSpriteLoaded=je,qe.fire(new s.z("isSpriteLoaded")))}}}setImages(ne,se,ve){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:je,images:ke}=se;if(this.availableImages[ne][je]=ke,this.workerSources[ne]&&this.workerSources[ne][je]){for(const He in this.workerSources[ne][je]){const at=this.workerSources[ne][je][He];for(const qe in at)at[qe].availableImages=ke}ve()}else ve()}setModels(ne,{scope:se,models:ve},je){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][se]=ve,this.workerSources[ne]&&this.workerSources[ne][se]){for(const ke in this.workerSources[ne][se]){const He=this.workerSources[ne][se][ke];for(const at in He)He[at].availableModels=ve}je()}else je()}setProjection(ne,se){this.projections[ne]=s.cl(se)}setBrightness(ne,se,ve){this.brightness=se,ve()}setWorldview(ne,se,ve){this.worldview=se,ve()}setLayers(ne,se,ve){this.getLayerIndex(ne,se.scope).replace(se.layers,se.options),ve()}updateLayers(ne,se,ve){this.getLayerIndex(ne,se.scope).update(se.layers,se.removedIds,se.options),ve()}loadTile(ne,se,ve){se.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,se.type,se.source,se.scope).loadTile(se,ve)}decodeRasterArray(ne,se,ve){this.getWorkerSource(ne,se.type,se.source,se.scope).decodeRasterArray(se,ve)}reloadTile(ne,se,ve){se.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,se.type,se.source,se.scope).reloadTile(se,ve)}abortTile(ne,se,ve){this.getWorkerSource(ne,se.type,se.source,se.scope).abortTile(se,ve)}removeTile(ne,se,ve){this.getWorkerSource(ne,se.type,se.source,se.scope).removeTile(se,ve)}removeSource(ne,se,ve){if(!(this.workerSources[ne]&&this.workerSources[ne][se.scope]&&this.workerSources[ne][se.scope][se.type]&&this.workerSources[ne][se.scope][se.type][se.source]))return;const je=this.workerSources[ne][se.scope][se.type][se.source];delete this.workerSources[ne][se.scope][se.type][se.source],je.removeSource!==void 0?je.removeSource(se,ve):ve()}loadWorkerSource(ne,se,ve){try{this.self.importScripts(se.url),ve()}catch(je){ve(je.toString())}}syncRTLPluginState(ne,se,ve){if(s.fG.isParsed())ve(null,!0);else if(s.fG.isParsing())this.rtlPluginParsingListeners.push(ve);else try{s.fG.setState(se);const je=s.fG.getPluginURL();!s.fG.isLoaded()||s.fG.isParsed()||s.fG.isParsing()||je==null||(s.fG.setState({pluginStatus:s.fH.parsing,pluginURL:s.fG.getPluginURL()}),this.self.importScripts(je),s.fG.isParsed()?ve(null,!0):this.rtlPluginParsingListeners.push(ve))}catch(je){ve(je.toString())}}setDracoUrl(ne,se){this.dracoUrl=se}getAvailableImages(ne,se){this.availableImages[ne]||(this.availableImages[ne]={});let ve=this.availableImages[ne][se];return ve||(ve=[]),ve}getAvailableModels(ne,se){this.availableModels[ne]||(this.availableModels[ne]={});let ve=this.availableModels[ne][se];return ve||(ve={}),ve}getLayerIndex(ne,se){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ve=this.layerIndexes[ne][se];return ve||(ve=this.layerIndexes[ne][se]=new H,ve.scope=se),ve}getWorkerSource(ne,se,ve,je){const ke=this.workerSources;return ke[ne]||(ke[ne]={}),ke[ne][je]||(ke[ne][je]={}),ke[ne][je][se]||(ke[ne][je][se]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),ke[ne][je][se][ve]||(ke[ne][je][se][ve]=new this.workerSourceTypes[se]({send:(He,at,qe,nt,Bt,It)=>this.actor.send(He,at,qe,ne,Bt,It),scheduler:this.actor.scheduler},this.getLayerIndex(ne,je),this.getAvailableImages(ne,je),this.getAvailableModels(ne,je),this.isSpriteLoaded[ne][je],void 0,this.brightness,this.worldview)),ke[ne][je][se][ve]}rasterizeImagesWorker(ne,se,ve){const je=new Map;for(const[ke,{image:He,imageVariant:at}]of se.tasks.entries()){const qe=this.imageRasterizer.rasterize(at,He,se.scope,ne);je.set(ke,qe)}ve(void 0,je)}removeRasterizedImages(ne,se,ve){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,ne),ve()}enforceCacheSizeLimit(ne,se){s.fI(se)}getWorkerPerformanceMetrics(ne,se,ve){ve(void 0,void 0)}}return s.fE(self)&&(self.worker=new _a(self)),_a})),w(["./shared"],(function(s){var O="3.16.0";const z={create:"create",load:"load",fullLoad:"fullLoad"},j={mark(f){performance.mark(f)},measure(f,n,a){performance.measure(f,n,a)}};function H(f){const n=f.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var Y,ie={},oe=(function(){if(Y)return ie;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,M=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(M);try{T=new Worker(D),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(D),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var M=T.getImageData(0,0,1,1);return M&&M.width===b.width})()?(a[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(a[x]=(function(b){var T,M=(function(D){var k=document.createElement("canvas"),F=Object.create(f.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=D,k.getContext("webgl2",F)})(b);if(!M)return!1;try{T=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!T||M.isContextLost())&&(M.shaderSource(T,"void main() {}"),M.compileShader(T),M.getShaderParameter(T,M.COMPILE_STATUS)===!0)})(x)),a[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}Y=1,ie.supported=f,ie.notSupportedReason=n;var a={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ie})();function ee(f,n,a){const p=document.createElement(f);return n!=null&&(p.className=n),a&&a.appendChild(p),p}function le(f,n,a){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(n))p.setAttributeNS(null,x,String(n[x]));return a&&a.appendChild(p),p}const ge=typeof document<"u"?document.documentElement&&document.documentElement.style:null,pe=ge&&ge.userSelect!==void 0?"userSelect":"WebkitUserSelect";let _e;function Re(){ge&&pe&&(_e=ge[pe],ge[pe]="none")}function xe(){ge&&pe&&(ge[pe]=_e)}function Ze(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Ze,!0)}function Le(){window.addEventListener("click",Ze,!0),window.setTimeout((()=>{window.removeEventListener("click",Ze,!0)}),0)}function $e(f,n){const a=f.getBoundingClientRect();return Ut(f,a,n)}function st(f,n){const a=f.getBoundingClientRect(),p=[];for(let x=0;x<n.length;x++)p.push(Ut(f,a,n[x]));return p}function Et(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function Ut(f,n,a){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new s.P((a.clientX-n.left)*p,(a.clientY-n.top)*p)}const $t="01",tt="NO_ACCESS_TOKEN";class ut{constructor(n,a,p){this._transformRequestFn=n,this._customAccessToken=a,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=(function(){let a="";for(let p=0;p<10;p++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$t,a].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,a){return this._transformRequestFn&&this._transformRequestFn(n,a)||{url:n}}normalizeStyleURL(n,a){if(!s.h(n))return n;const p=Ke(n);return p.params.push(`sdk=js-${O}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeGlyphsURL(n,a){if(!s.h(n))return n;const p=Ke(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeModelURL(n,a){if(!s.h(n))return n;const p=Ke(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeSourceURL(n,a,p,x){if(!s.h(n))return n;const b=Ke(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(n,a){const p=Ke(n);return s.h(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||a)):ze(p)}normalizeSpriteURL(n,a,p,x){const b=Ke(n);return s.h(n)?(b.path=`/styles/v1${b.path}/sprite${a}${p}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${a}${p}`,ze(b))}normalizeTileURL(n,a,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.h(n))return n;const x=Ke(n);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||p&&x.authority!=="raster"&&p===512?"@2x":""}${s.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||(function(T){for(const M of T){const D=M.match(/^access_token=(.*)$/);if(D)return D[1]}return null})(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(n,a){const p=Ke(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return a&&(b=b.filter((T=>!T.match(/^access_token=/)))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(n,a){const p=!!a&&s.h(a),x=[];for(const b of n.tiles||[])s.j(b)?x.push(this.canonicalizeTileURL(b,p)):x.push(b);return x}_makeAPIURL(n,a){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Ke(s.e.API_URL);if(n.protocol=x.protocol,n.authority=x.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(x.path!=="/"&&(n.path=`${x.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return ze(n);if(a=a||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter((b=>b.indexOf("access_token")===-1)),n.params.push(`access_token=${a||""}`),ze(n)}}const on=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ke(f){const n=f.match(on);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ze(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const Fe="mapbox.eventData";function kt(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.l(n[1]))}catch{return null}}class fn{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const a=kt(s.e.ACCESS_TOKEN);let p="";return p=a&&a.u?s.f(a.u):s.e.ACCESS_TOKEN||"",n?`${Fe}.${n}:${p}`:`${Fe}:${p}`}fetchEventData(){const n=s.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp");if(n)try{const b=localStorage.getItem(a);b&&(this.eventData=JSON.parse(b));const T=localStorage.getItem(p);T&&(this.anonId=T);const M=localStorage.getItem(x);M&&(this.anonIdTimestamp=Number(M));const D=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<D)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=s.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp"),b=this.anonId,T=this.anonIdTimestamp;if(n&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData)),T&&localStorage.setItem(x,T.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,p,x){if(!s.e.EVENTS_URL)return;const b=Ke(s.e.EVENTS_URL);b.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(n).toISOString()},M=a?Object.assign(T,a):T,D={url:ze(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=s.p(D,(k=>{this.pendingRequest=null,p(k),this.saveEventData(),this.processRequests(x)}))}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}const Me=new class extends fn{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some((a=>s.h(a)||s.j(a)))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=kt(s.e.ACCESS_TOKEN),a=n?n.u:s.e.ACCESS_TOKEN;let p=a!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(x),M=(x-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||b.getDate()!==T.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:$t,"enabled.telemetry":!1,userId:this.anonId},(b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=a)}),f):this.processRequests()}},ct=Me.postTurnstileEvent.bind(Me),vt=new class extends fn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,a,p){this.skuToken=n,this.errorCb=p,s.e.EVENTS_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},a):this.errorCb(new Error(tt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:$t,skuToken:this.skuToken,userId:this.anonId},(p=>{p?this.errorCb(p):n&&(this.success[n]=!0)}),f))}remove(){this.errorCb=null}},Kt=vt.postMapLoadEvent.bind(vt),zn=new class extends fn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=s.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:a,style:p,importedStyles:x}=n;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),T={mapInstanceId:b,eventId:this.getEventId(b),style:p};x.length&&(T.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:a}=this.queue.shift();this.postEvent(n,a,(()=>{}),f)}},Nn=zn.postStyleLoadEvent.bind(zn),Yt=new class extends fn{constructor(f){super("metrics"),f&&(this.data=f)}postMetricsEvent(f){if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const n=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:a}=this.queue.shift();this.postEvent(n,a,(()=>{}),f)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),On=Yt.postMetricsEvent.bind(Yt),An=new class extends fn{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:a}=this.queue.shift(),p=(function(x){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),M=(function(W){const K={};if(W){for(const J in W)if(J!=="other")for(const ae of W[J]){const re=`${J}ResolveRangeMin`,ue=`${J}ResolveRangeMax`,ye=`${J}RequestCount`,fe=`${J}RequestCachedCount`;K[re]=Math.min(K[re]||1/0,ae.startTime),K[ue]=Math.max(K[ue]||-1/0,ae.responseEnd);const Ce=be=>{K[be]===void 0&&(K[be]=0),++K[be]};ae.transferSize!==void 0&&ae.transferSize===0&&Ce(fe),Ce(ye)}}return K})((function(W,K){const J={};if(W)for(const ae of W){const re=K(ae);J[re]===void 0&&(J[re]=[]),J[re].push(ae)}return J})(b,H)),D=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=k?k.effectiveType:void 0,G={counters:[],metadata:[],attributes:[]},V=(W,K,J)=>{J!=null&&W.push({name:K,value:J.toString()})};for(const W in M)V(G.counters,W,M[W]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(V(G.counters,"interactionRangeMin",x.interactionRange[0]),V(G.counters,"interactionRangeMax",x.interactionRange[1])),T)for(const W of Object.values(z)){const K=T.find((J=>J.name===W));K&&V(G.counters,W,K.startTime)}return V(G.counters,"visibilityHidden",x.visibilityHidden),V(G.attributes,"style",(function(W){if(W)for(const K of W){const J=K.name.split("?")[0];if(s.i(J)){const ae=J.split("/").slice(-2);if(ae.length===2)return`mapbox://styles/${ae[0]}/${ae[1]}`}}})(b)),V(G.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),V(G.attributes,"fogEnabled",x.fogEnabled?"true":"false"),V(G.attributes,"projection",x.projection),V(G.attributes,"zoom",x.zoom),V(G.metadata,"devicePixelRatio",D),V(G.metadata,"connectionEffectiveType",F),V(G.metadata,"navigatorUserAgent",navigator.userAgent),V(G.metadata,"screenWidth",window.screen.width),V(G.metadata,"screenHeight",window.screen.height),V(G.metadata,"windowWidth",window.innerWidth),V(G.metadata,"windowHeight",window.innerHeight),V(G.metadata,"mapWidth",x.width/D),V(G.metadata,"mapHeight",x.height/D),V(G.metadata,"webglRenderer",x.renderer),V(G.metadata,"webglVendor",x.vendor),V(G.metadata,"sdkVersion",O),V(G.metadata,"sdkIdentifier","mapbox-gl-js"),G})(a);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(n,p,(()=>{}),f)}},In=An.postPerformanceEvent.bind(An),gi=new class extends fn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,a,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=Ke(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${n||""}`),x.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const b={url:ze(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,(T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(p)}))}getSessionAPI(f,n,a,p){this.skuToken=n,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},a):this.errorCb(new Error(tt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,(p=>{p?this.errorCb(p):n&&(this.success[n]=!0)}),f)}remove(){this.errorCb=null}},ji=gi.getSessionAPI.bind(gi),Ri=new Set;function Rr(f,n){n?Ri.add(f):Ri.delete(f)}class cs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function wr(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class jn extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const a=this.atlasTexture.get(n);a&&(a.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(n.id,n)}removeImageProvider(n,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(n)}getPendingImageProviders(){const n=[];for(const a of this.imageProviders.values())for(const p of a.values())p.hasPendingRequests()&&n.push(p);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,a){if(this.loaded.get(a)!==n&&(this.loaded.set(a,n),n)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,a,x);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images.get(a).get(n.toString())}addImage(n,a,p){this._validate(n,p)&&this.images.get(a).set(n.toString(),p)}_validate(n,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,a){if(!n)return!0;let p=0;for(const x of n){if(x[0]<p||x[1]<x[0]||a<x[1])return!1;p=x[1]}return!0}_validateContent(n,a){return n?n.length!==4||!a.usvg&&(n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,a,p){const x=this.images.get(a).get(n.toString());p.version=x.version+1,this.images.get(a).set(n.toString(),p),this.updatedImages.get(a).add(n),this.removeFromImageRasterizerCache(n,a)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,a){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([n],a))}removeImage(n,a){const p=this.images.get(a),x=p.get(n.toString());p.delete(n.toString()),this.patterns.get(a).delete(n.toString()),this.removeFromImageRasterizerCache(n,a),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map((a=>s.I.from(a)))}getImages(n,a,p){const x=[],b=[],T=this.imageProviders.get(a);for(const F of n){if(!F.iconsetId){x.push(F);continue}const G=T.get(F.iconsetId);G&&(this.getImage(F,a)?b.push(F):G.addPendingRequest(F))}if(x.length===0)return void this._notify(b,a,p);let M=!0;const D=!!this.loaded.get(a),k=this.images.get(a);if(!D)for(const F of x)k.has(F.toString())||(M=!1);D||M?this._notify(x,a,p):this.requestors.push({ids:x,scope:a,callback:p})}rasterizeImages(n,a){const p=new Map,{tasks:x,scope:b}=n;for(const[T,M]of x.entries()){const D=this.getImage(M.id,b);D&&p.set(T,{image:D,imageVariant:M})}this._rasterizeImages(b,p,a)}_rasterizeImages(n,a,p){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:n},p);else{const x=new Map;for(const[b,{image:T,imageVariant:M}]of a.entries())x.set(b,this.imageRasterizer.rasterize(M,T,n,0));p(void 0,x)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,a,p){const x=this.images.get(a),b=new Map;for(const T of n){if(!x.get(T.toString())){if(T.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:T.name}))}const M=x.get(T.toString());if(!M){s.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const D={data:M.usvg?null:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,usvg:M.usvg,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)};M.usvg&&Object.assign(D,{width:M.icon.usvg_tree.width,height:M.icon.usvg_tree.height}),b.set(s.I.toString(T),D)}p(null,b)}getPixelSize(n){const{width:a,height:p}=this.atlasImage.get(n);return{width:a,height:p}}getPattern(n,a,p){const x=n.toString(),b=this.patterns.get(a),T=b.get(x),M=this.getImage(n,a);if(!M)return null;if(T){if(T.position.version===M.version)return T.position;T.position.version=M.version}else{if(M.usvg&&!M.data){const D=this.getPatternInFlightId(x,a);if(this.patternsInFlight.has(D))return null;this.patternsInFlight.add(D);const k=new s.A(n).scaleSelf(s.o.devicePixelRatio),F=new Map([[k.toString(),{image:M,imageVariant:k}]]);return this._rasterizeImages(a,F,((G,V)=>this.storePatternImage(k,a,M,p,V))),null}this.storePattern(n,a,M)}return this._updatePatternAtlas(a,p),b.get(x).position}getPatternInFlightId(n,a){return s.B(n,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,a,p,x,b){const T=n.toString(),M=b?b.get(T):void 0;M&&(p.data=M,this.storePattern(n.id,a,p),this._updatePatternAtlas(a,x),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),a)))}storePattern(n,a,p){const x={w:p.data.width+2*s.C,h:p.data.height+2*s.C,x:0,y:0},b=new s.F(x,p,s.C);this.patterns.get(a).set(n.toString(),{bin:x,position:b})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,a){const p=n.gl;let x=this.atlasTexture.get(a);x?this.dirty&&(x.update(this.atlasImage.get(a)),this.dirty=!1):(x=new s.T(n,this.atlasImage.get(a),p.RGBA8),this.atlasTexture.set(a,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,a){const p=this.patterns.get(n),x=Array.from(p.values()).map((({bin:k})=>k)),{w:b,h:T}=s.G(x),M=this.atlasImage.get(n);M.resize({width:b||1,height:T||1});const D=this.images.get(n);for(const[k,{bin:F,position:G}]of p.entries()){let V=G.padding;const W=F.x+V,K=F.y+V,J=D.get(k).data,ae=J.width,re=J.height;V=V>1?V-1:V,s.q.copy(J,M,{x:0,y:0},{x:W,y:K},{width:ae,height:re},a),s.q.copy(J,M,{x:0,y:re-V},{x:W,y:K-V},{width:ae,height:V},a),s.q.copy(J,M,{x:0,y:0},{x:W,y:K+re},{width:ae,height:V},a),s.q.copy(J,M,{x:ae-V,y:0},{x:W-V,y:K},{width:V,height:re},a),s.q.copy(J,M,{x:0,y:0},{x:W+ae,y:K},{width:V,height:re},a),s.q.copy(J,M,{x:ae-V,y:re-V},{x:W-V,y:K-V},{width:V,height:V},a),s.q.copy(J,M,{x:0,y:re-V},{x:W+ae,y:K-V},{width:V,height:V},a),s.q.copy(J,M,{x:0,y:0},{x:W+ae,y:K+re},{width:V,height:V},a),s.q.copy(J,M,{x:ae-V,y:0},{x:W-V,y:K+re},{width:V,height:V},a)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,a){const p=this.images.get(a);for(const x of n){if(this.callbackDispatchedThisFrame.get(a).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(x.toString());const b=p.get(x.toString());wr(b)&&this.updateImage(x,a,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function ti(f){const n=f.value,a=f.valueSpec,p=f.style,x=f.styleSpec,b=f.key,T=f.arrayElementValidator||Mr;if(!Array.isArray(n))return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(a.length&&n.length!==a.length)return[new s.V(b,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new s.V(b,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let M={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};x.$version<7&&(M.function=a.function),s.H(a.value)&&(M=a.value);let D=[];for(let k=0;k<n.length;k++)D=D.concat(T({array:n,arrayIndex:k,value:n[k],valueSpec:M,style:p,styleSpec:x,key:`${b}[${k}]`},!0));return D}function rr(f){const n=f.key,a=f.value,p=f.valueSpec;if(!s.L(a))return[new s.V(n,a,`number expected, ${s.K(a)} found`)];if(a!=a)return[new s.V(n,a,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[f.arrayIndex]),a<x)return[new s.V(n,a,`${a} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[f.arrayIndex]),a>x)return[new s.V(n,a,`${a} is greater than the maximum value ${x}`)]}return[]}function et(f){const n=f.key,a=f.value;if(!s.H(a))return[new s.V(n,a,`object expected, ${s.K(a)} found`)];const p=f.valueSpec,x=s.J(a.type);let b,T,M,D={};const k=x!=="categorical"&&a.property===void 0,F=!k,G=(function(J){const ae=J.stops;return Array.isArray(ae)&&Array.isArray(ae[0])&&s.H(ae[0][0])})(a),V=js({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(J){if(x==="identity")return[new s.V(J.key,J.value,'identity function may not have a "stops" property')];let ae=[];const re=J.value;return ae=ae.concat(ti({key:J.key,value:re,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:W})),Array.isArray(re)&&re.length===0&&ae.push(new s.V(J.key,re,"array must have at least one stop")),ae},default:function(J){return Mr({key:J.key,value:J.value,valueSpec:p,style:J.style,styleSpec:J.styleSpec})}}});return x==="identity"&&k&&V.push(new s.V(f.key,f.value,'missing required property "property"')),x==="identity"||a.stops||V.push(new s.V(f.key,f.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!s.M(p)&&V.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(F&&!s.N(p)?V.push(new s.V(f.key,f.value,"property functions not supported")):k&&!s.O(p)&&V.push(new s.V(f.key,f.value,"zoom functions not supported"))),x!=="categorical"&&!G||a.property!==void 0||V.push(new s.V(f.key,f.value,'"property" property is required')),V;function W(J){let ae=[];const re=J.value,ue=J.key;if(!Array.isArray(re))return[new s.V(ue,re,`array expected, ${s.K(re)} found`)];if(re.length!==2)return[new s.V(ue,re,`array length 2 expected, length ${re.length} found`)];if(G){if(!s.H(re[0]))return[new s.V(ue,re,`object expected, ${s.K(re[0])} found`)];const ye=re[0];if(ye.zoom===void 0)return[new s.V(ue,re,"object stop key must have zoom")];if(ye.value===void 0)return[new s.V(ue,re,"object stop key must have value")];const fe=s.J(ye.zoom);if(typeof fe!="number")return[new s.V(ue,ye.zoom,"stop zoom values must be numbers")];if(M&&M>fe)return[new s.V(ue,ye.zoom,"stop zoom values must appear in ascending order")];fe!==M&&(M=fe,T=void 0,D={}),ae=ae.concat(js({key:`${ue}[0]`,value:re[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:rr,value:K}}))}else ae=ae.concat(K({key:`${ue}[0]`,value:re[0],style:J.style,styleSpec:J.styleSpec},re));return s.Q(s.S(re[1]))?ae.concat([new s.V(`${ue}[1]`,re[1],"expressions are not allowed in function stops.")]):ae.concat(Mr({key:`${ue}[1]`,value:re[1],valueSpec:p,style:J.style,styleSpec:J.styleSpec}))}function K(J,ae){const re=s.K(J.value),ue=s.J(J.value),ye=J.value!==null?J.value:ae;if(b){if(re!==b)return[new s.V(J.key,ye,`${re} stop domain type must match previous stop domain type ${b}`)]}else b=re;if(re!=="number"&&re!=="string"&&re!=="boolean"&&typeof ue!="number"&&typeof ue!="string"&&typeof ue!="boolean")return[new s.V(J.key,ye,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&x!=="categorical"){let fe=`number expected, ${re} found`;return s.N(p)&&x===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(J.key,ye,fe)]}return x!=="categorical"||re!=="number"||typeof ue=="number"&&isFinite(ue)&&Math.floor(ue)===ue?x!=="categorical"&&re==="number"&&typeof ue=="number"&&typeof T=="number"&&T!==void 0&&ue<T?[new s.V(J.key,ye,"stop domain values must appear in ascending order")]:(T=ue,x==="categorical"&&ue in D?[new s.V(J.key,ye,"stop domain values must be unique")]:(D[ue]=!0,[])):[new s.V(J.key,ye,`integer expected, found ${String(ue)}`)]}}function Ot(f){const n=(f.expressionContext==="property"?s.W:s.U)(s.S(f.value),f.valueSpec);if(n.result==="error")return n.value.map((p=>new s.V(`${f.key}${p.key}`,f.value,p.message)));const a=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!a.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.Z(a))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return nn(a,f);if(f.expressionContext==="appearance")return Kn(a,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.X(a,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Y(a))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nn(f,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)a.delete(x);if(a.size===0)return[];const p=[];return f instanceof s._&&a.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild((x=>{p.push(...nn(x,n))})),p)}function Kn(f,n){const a=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)a.add(x);if(a.size===0)return[];const p=[];return f instanceof s._&&!a.has(f.name)?[new s.V(n.key,n.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild((x=>{p.push(...Kn(x,n))})),p)}function yn(f){const n=f.key,a=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(s.J(a))===-1&&x.push(new s.V(n,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(s.J(a))===-1&&x.push(new s.V(n,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),x}function Dn(f){return s.a2(s.S(f.value))?Ot(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):ci(f)}function ci(f){const n=f.value,a=f.key;if(!Array.isArray(n))return[new s.V(a,n,`array expected, ${s.K(n)} found`)];if(n.length<1)return[new s.V(a,n,"filter array must have at least 1 element")];const p=f.styleSpec;let x=yn({key:`${a}[0]`,value:n[0],valueSpec:p.filter_operator});switch(s.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.J(n[1])==="$type"&&x.push(new s.V(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&x.push(new s.V(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(s.a0(n[1])||x.push(new s.V(`${a}[1]`,n[1],`string expected, ${s.K(n[1])} found`)));for(let b=2;b<n.length;b++)s.J(n[1])==="$type"?x=x.concat(yn({key:`${a}[${b}]`,value:n[b],valueSpec:p.geometry_type})):s.a0(n[b])||s.L(n[b])||s.$(n[b])||x.push(new s.V(`${a}[${b}]`,n[b],`string, number, or boolean expected, ${s.K(n[b])} found.`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)x=x.concat(ci({key:`${a}[${b}]`,value:n[b],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":n.length!==2?x.push(new s.V(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):s.a0(n[1])||x.push(new s.V(`${a}[1]`,n[1],`string expected, ${s.K(n[1])} found`))}return x}function Yi(f,n){const a=f.key,p=f.style,x=f.layer,b=f.styleSpec,T=f.value,M=f.objectKey,D=b[`${n}_${f.layerType}`];if(!D)return[];const k=M.match(/^(.*)-use-theme$/);if(k&&D[k[1]])return s.Q(s.S(T))?[].concat(Mr({key:a,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:M})):Mr({key:a,value:T,valueSpec:{type:"string"},style:p,styleSpec:b});const F=M.match(/^(.*)-transition$/);if(n==="paint"&&F&&D[F[1]]&&D[F[1]].transition)return Mr({key:a,value:T,valueSpec:b.transition,style:p,styleSpec:b});const G=f.valueSpec||D[M];if(!G)return[new s.a3(a,T,`unknown property "${M}"`)];let V;if(s.a0(T)&&s.N(G)&&!G.tokens&&(V=/^{([^}]+)}$/.exec(T))){const K=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new s.V(a,T,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${K}.`)]}const W=[];if(f.layerType==="symbol")M!=="text-field"||!p||p.glyphs||p.imports||W.push(new s.V(a,T,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&s.a4(s.S(T))&&s.J(T.type)==="identity"&&W.push(new s.V(a,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.N(G)&&(s.a5(G)||s.O(G))){const K=s.W(s.S(T),G).value,J="expression"in K&&K.expression||"_styleExpression"in K&&K._styleExpression&&K._styleExpression.expression;J&&!s.X(J,["measure-light"])&&(M==="model-emissive-strength"&&s.Y(J)&&s.Z(J)||W.push(new s.V(a,T,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(Mr({key:f.key,value:T,valueSpec:G,style:p,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:M}))}function or(f){return Yi(f,"paint")}function Gr(f){return Yi(f,"layout")}function ea(f){let n=[];const a=f.value,p=f.key,x=f.style,b=f.styleSpec;if(!s.H(a))return[new s.V(p,a,"object expected")];a.type||a.ref||n.push(new s.V(p,a,'either "type" or "ref" is required'));let T=s.J(a.type);const M=s.J(a.ref);if(a.id){const D=s.J(a.id);for(let k=0;k<f.arrayIndex;k++){const F=x.layers[k];s.J(F.id)===D&&n.push(new s.V(p,a.id,`duplicate layer id "${D}", previously used at line ${F.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach((k=>{k in a&&n.push(new s.V(p,a[k],`"${k}" is prohibited for ref layers`))})),x.layers.forEach((k=>{s.J(k.id)===M&&(D=k)})),D?D.ref?n.push(new s.V(p,a.ref,"ref cannot reference another ref layer")):T=s.J(D.type):typeof M=="string"&&n.push(new s.V(p,a.ref,`ref layer "${M}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source)if(s.a0(a.source)){const D=x.sources&&x.sources[a.source],k=D&&s.J(D.type);D?k==="vector"&&T==="raster"?n.push(new s.V(p,a.source,`layer "${a.id}" requires a raster source`)):k==="raster"&&T!=="raster"?n.push(new s.V(p,a.source,`layer "${a.id}" requires a vector source`)):k!=="vector"||a["source-layer"]?k==="raster-dem"&&T!=="hillshade"?n.push(new s.V(p,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&k==="geojson"&&!D.lineMetrics?n.push(new s.V(p,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&k!=="raster-array"&&n.push(new s.V(p,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new s.V(p,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(p,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new s.V(p,a.source,`source "${a.source}" not found`))}else n.push(new s.V(`${p}.source`,a.source,'"source" must be a string'));else n.push(new s.V(p,a,'missing required property "source"'));return n=n.concat(js({key:p,value:a,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Mr({key:`${p}.type`,value:a.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:a,objectKey:"type"}),filter:D=>Dn(Object.assign({layerType:T},D)),layout:D=>js({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":k=>Gr(Object.assign({layerType:T},k))}}),paint:D=>js({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":k=>or(Object.assign({layerType:T,layer:a},k))}}),appearances(D){const k=ti({key:D.key,value:D.value,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:V=>(function(W){const{key:K,layer:J,layerType:ae}=W,re=s.J(W.value),ue=s.J(re.name),ye=s.J(re.condition),fe=js({key:K,value:re,valueSpec:W.styleSpec.appearance,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{condition:Ce=>(function(be){const De=[];return De.push(...Ot({key:be.key,value:be.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),De})(Object.assign({layer:J,layerType:ae},Ce)),properties:Ce=>(function(be){const De=[],{styleSpec:Te,layer:Se,layerType:Pe}=be,Xe=Te[`paint_${Pe}`],Ge=Te[`layout_${Pe}`],dt=be.object[be.objectKey];for(const it in dt){const gt=it in Xe?"paint":it in Ge?"layout":void 0;if(!gt){De.push(new s.V(be.key,it,`unknown property "${it}" for layer type "${Pe}"`));continue}const Ft=Object.assign({},be,{key:`${be.key}.${it}`,object:dt,objectKey:it,layer:Se,layerType:Pe,value:dt[it],valueSpec:gt==="paint"?Xe[it]:Ge[it]});De.push(...Yi(Ft,gt))}return De})(Object.assign({layer:J,layerType:ae},Ce))}});return ue!=="hidden"&&ye===void 0&&fe.push(new s.V(W.key,"name",'Appearance with name different than "hidden" must have a condition')),fe})(Object.assign({layerType:T,layer:a},V))}),F=Array.isArray(D.value)?D.value:[],G=new Set;return F.forEach(((V,W)=>{const K=s.J(V.name);if(K)if(G.has(K)){const J=s.J(a.id);k.push(new s.V(D.key,K,`Duplicated appearance name "${K}" for layer "${J}"`))}else G.add(K)})),k}}})),n}function vs({key:f,value:n}){return s.a0(n)?[]:[new s.V(f,n,`string expected, ${s.K(n)} found`)]}const Ol={promoteId:function f({key:n,value:a}){if(s.a0(a))return vs({key:n,value:a});if(Array.isArray(a)){const x=[],b=s.S(a),T=s.U(b);return T.result==="error"&&T.value.forEach((M=>{x.push(new s.V(`${n}${M.key}`,null,`${M.message}`))})),s.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),x}if(!s.H(a))return[new s.V(n,a,`string, expression or object expected, "${s.K(a)}" found`)];const p=[];for(const x in a)p.push(...f({key:`${n}.${x}`,value:a[x]}));return p}};function ta(f){const n=f.value,a=f.key,p=f.styleSpec,x=f.style;if(!s.H(n))return[new s.V(a,n,`object expected, ${s.K(n)} found`)];if(!("type"in n))return[new s.V(a,n,'"type" is required')];const b=s.J(n.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in n||"tiles"in n||T.push(new s.a3(a,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(js({key:a,value:n,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Ol})),T;case"geojson":if(T=js({key:a,value:n,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Ol}),"cluster"in n&&"clusterProperties"in n){if(!s.H(n.clusterProperties))return[new s.V(`${a}.clusterProperties`,n,`object expected, ${s.K(n)} found`)];for(const M in n.clusterProperties){const D=n.clusterProperties[M];if(!Array.isArray(D))return[new s.V(`${a}.clusterProperties.${M}`,D,"array expected")];const[k,F]=D,G=typeof k=="string"?[k,["accumulated"],["get",M]]:k;T.push(...Ot({key:`${a}.${M}.map`,value:F,expressionContext:"cluster-map"})),T.push(...Ot({key:`${a}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}}return T;case"video":return js({key:a,value:n,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return js({key:a,value:n,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new s.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yn({key:`${a}.type`,value:n.type,valueSpec:{values:dr(p)}})}}function dr(f){return f.source.reduce(((n,a)=>{const p=f[a];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values||{}))),n}),[])}function lo(f){const n=f.value,a=f.styleSpec,p=a.light,x=f.style;if(n===void 0)return[];if(!s.H(n))return[new s.V("light",n,`object expected, ${s.K(n)} found`)];let b=[];for(const T in n){const M=T.match(/^(.*)-transition$/),D=T.match(/^(.*)-use-theme$/);b=b.concat(D&&p[D[1]]?Mr({key:T,value:n[T],valueSpec:{type:"string"},style:x,styleSpec:a}):M&&p[M[1]]&&p[M[1]].transition?Mr({key:T,value:n[T],valueSpec:a.transition,style:x,styleSpec:a}):p[T]?Mr({key:T,value:n[T],valueSpec:p[T],style:x,styleSpec:a}):[new s.V(T,n[T],`unknown property "${T}"`)])}return b}function Os(f){const n=f.value;if(!n)return[];const a=f.key;if(!s.H(n))return[new s.V(a,n,`object expected, ${s.K(n)} found`)];let p=[];const x=f.styleSpec,b=x["light-3d"],T=f.style,M=f.style.lights;for(const F of["type","id"])if(!(F in n))return p=p.concat([new s.V(a,n,`missing property "${F}"`)]),p;if(!s.a0(n.type))return p=p.concat([new s.V(`${a}.type`,n.type,"string expected")]),p;if(M)for(let F=0;F<f.arrayIndex;F++){const G=s.J(n.type),V=M[F];s.J(V.type)===G&&p.push(new s.V(a,n.id,`duplicate light type "${n.type}", previously defined at line ${V.id.__line__}`))}const D=`properties_light_${n.type}`;if(!(D in x))return p=p.concat([new s.V(`${a}.type`,n,`Invalid light type ${n.type}`)]),p;const k=x[D];for(const F in n)if(F==="properties"){const G=n[F];if(!s.H(G))return p=p.concat([new s.V("properties",G,`object expected, ${s.K(G)} found`)]),p;for(const V in G){const W=V.match(/^(.*)-transition$/),K=V.match(/^(.*)-use-theme$/);p=p.concat(K&&k[K[1]]?Mr({key:F,value:G[V],valueSpec:{type:"string"},style:T,styleSpec:x}):W&&k[W[1]]&&k[W[1]].transition?Mr({key:F,value:n[F],valueSpec:x.transition,style:T,styleSpec:x}):k[V]?Mr({key:V,value:G[V],valueSpec:k[V],style:T,styleSpec:x}):[new s.a3(f.key,G[V],`unknown property "${V}"`)])}}else p=p.concat(b[F]?Mr({key:F,value:n[F],valueSpec:b[F],style:T,styleSpec:x}):[new s.a3(F,n[F],`unknown property "${F}"`)]);return p}function Za(f){const n=f.value,a=f.key,p=f.style,x=f.styleSpec,b=x.terrain;if(n==null)return[];if(!s.H(n))return[new s.V("terrain",n,`object expected, ${s.K(n)} found`)];let T=[];for(const M in n){const D=M.match(/^(.*)-transition$/),k=M.match(/^(.*)-use-theme$/);T=T.concat(k&&b[k[1]]?Mr({key:M,value:n[M],valueSpec:{type:"string"},style:p,styleSpec:x}):D&&b[D[1]]&&b[D[1]].transition?Mr({key:M,value:n[M],valueSpec:x.transition,style:p,styleSpec:x}):b[M]?Mr({key:M,value:n[M],valueSpec:b[M],style:p,styleSpec:x}):[new s.a3(M,n[M],`unknown property "${M}"`)])}if(n.source)if(s.a0(n.source)){const M=p.sources&&p.sources[n.source],D=M&&s.J(M.type);M?D!=="raster-dem"&&T.push(new s.V(`${a}.source`,n.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):T.push(new s.V(`${a}.source`,n.source,`source "${n.source}" not found`))}else T.push(new s.V(`${a}.source`,n.source,"source must be a string"));else T.push(new s.V(a,n,'terrain is missing required property "source"'));return T}function Go(f){const n=f.value,a=f.style,p=f.styleSpec,x=p.fog;if(n===void 0)return[];if(!s.H(n))return[new s.V("fog",n,`object expected, ${s.K(n)} found`)];let b=[];for(const T in n){const M=T.match(/^(.*)-transition$/),D=T.match(/^(.*)-use-theme$/);b=b.concat(D&&x[D[1]]?Mr({key:T,value:n[T],valueSpec:{type:"string"},style:a,styleSpec:p}):M&&x[M[1]]&&x[M[1]].transition?Mr({key:T,value:n[T],valueSpec:p.transition,style:a,styleSpec:p}):x[T]?Mr({key:T,value:n[T],valueSpec:x[T],style:a,styleSpec:p}):[new s.a3(T,n[T],`unknown property "${T}"`)])}return b}const Ia={"*":()=>[],array:ti,boolean:function(f){const n=f.value,a=f.key;return s.$(n)?[]:[new s.V(a,n,`boolean expected, ${s.K(n)} found`)]},number:rr,color:function({key:f,value:n}){return s.a0(n)?s.a1.parseCSSColor(n)===null?[new s.V(f,n,`color expected, "${n}" found`)]:[]:[new s.V(f,n,`color expected, ${s.K(n)} found`)]},enum:yn,filter:Dn,function:et,layer:ea,object:js,source:ta,model:s.a7,light:lo,"light-3d":Os,terrain:Za,fog:Go,string:vs,formatted:function(f){return vs(f).length===0?[]:Ot(f)},resolvedImage:function(f){return vs(f).length===0?[]:Ot(f)},projection:function(f){const n=f.value,a=f.styleSpec,p=a.projection,x=f.style;if(s.H(n)){let b=[];for(const T in n)b=b.concat(Mr({key:T,value:n[T],valueSpec:p[T],style:x,styleSpec:a}));return b}return s.a0(n)?[]:[new s.V("projection",n,`object or string expected, ${s.K(n)} found`)]},import:function(f){const n=f.key,{value:a,styleSpec:p}=f;if(!s.H(a))return[new s.V(n,a,"import must be an object")];const{data:x,...b}=a;Object.defineProperty(b,"__line__",{value:a.__line__,enumerable:!1});let T=js(Object.assign({},f,{value:b,valueSpec:p.import}));return s.J(b.id)===""&&T.push(new s.V(`${f.key}.id`,b,"import id can't be an empty string")),x&&(T=T.concat(bs(x,p,{key:`${f.key}.data`}))),T},iconset:function(f){const n=f.value,a=f.key,p=f.styleSpec,x=f.style;if(!s.H(n))return[new s.V(a,n,"object expected")];if(!n.type)return[new s.V(a,n,'"type" is required')];const b=s.J(n.type);let T=[];if(T=T.concat(js({key:a,value:n,valueSpec:p[`iconset_${b}`],style:x,styleSpec:p})),(function(M,D){return!(M!=="source"||!D.source)})(b,n)){const M=x.sources&&x.sources[n.source],D=M&&s.J(M.type);M?D!=="raster-array"&&T.push(new s.V(a,n.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):T.push(new s.V(a,n.source,`source "${n.source}" not found`))}return T}};function Mr(f,n=!1){const a=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression){if(s.a4(s.J(a)))return et(f);if(s.Q(s.S(a)))return Ot(f)}if(p.type&&Ia[p.type]){const b=Ia[p.type](f);return n===!0&&b.length>0&&Array.isArray(f.value)?Ot(f):b}return js(Object.assign({},f,{valueSpec:p.type?x[p.type]:p}))}function js(f){const n=f.key,a=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},b=f.style,T=f.styleSpec;if(!s.H(a))return[new s.V(n,a,`object expected, ${s.K(a)} found`)];let M=[];for(const D in a){const k=D.split(".")[0];let F;x[k]?F=x[k]:p[k]?F=Mr:x["*"]?F=x["*"]:p["*"]&&(F=Mr),F?M=M.concat(F({key:(n&&`${n}.`)+D,value:a[D],valueSpec:p[k]||p["*"],style:b,styleSpec:T,object:a,objectKey:D},a)):M.push(new s.a3(n,a[D],`unknown property "${D}"`))}for(const D in p){if(x[D])continue;const k=p[D];k.required&&k.default===void 0&&a[D]===void 0&&M.push(new s.V(n,a,`missing required property "${D}"`))}return M}function Cs({key:f,value:n}){const a=vs({key:f,value:n});if(a.length)return a;const p=n;return p.indexOf("{fontstack}")===-1&&a.push(new s.V(f,n,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&a.push(new s.V(f,n,'"glyphs" url must include a "{range}" token')),a}function bs(f,n=s.a6,a={}){return js({key:a.key||"",value:f,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:f,objectElementValidators:{glyphs:Cs}})}function us(f,n=s.a6){return We(bs(f,n))}const Ho=f=>We(ta(f)),Do=f=>We(lo(f)),Po=f=>We(Os(f)),wo=f=>We(Za(f)),Ct=f=>We(Go(f)),Rs=f=>We((function(n){const a=n.value,p=n.style,x=n.styleSpec,b=x.snow;if(a===void 0)return[];if(!s.H(a))return[new s.V("snow",a,`object expected, ${s.K(a)} found`)];let T=[];for(const M in a){const D=M.match(/^(.*)-transition$/);T=T.concat(D&&b[D[1]]&&b[D[1]].transition?Mr({key:M,value:a[M],valueSpec:x.transition,style:p,styleSpec:x}):b[M]?Mr({key:M,value:a[M],valueSpec:b[M],style:p,styleSpec:x}):[new s.a3(M,a[M],`unknown property "${M}"`)])}return T})(f)),ga=f=>We((function(n){const a=n.value,p=n.style,x=n.styleSpec,b=x.rain;if(a===void 0)return[];if(!s.H(a))return[new s.V("rain",a,`object expected, ${s.K(a)} found`)];let T=[];for(const M in a){const D=M.match(/^(.*)-transition$/);T=T.concat(D&&b[D[1]]&&b[D[1]].transition?Mr({key:M,value:a[M],valueSpec:x.transition,style:p,styleSpec:x}):b[M]?Mr({key:M,value:a[M],valueSpec:b[M],style:p,styleSpec:x}):[new s.a3(M,a[M],`unknown property "${M}"`)])}return T})(f)),qo=f=>We(ea(f)),fi=f=>We(Dn(f)),Ds=f=>We(or(f)),zl=f=>We(Gr(f)),_a=f=>We(s.a7(f));function We(f){return f.slice().sort(((n,a)=>n.line&&a.line?n.line-a.line:0))}function ne(f,n){let a=!1;if(n&&n.length)for(const p of n)p instanceof s.a3?s.w(p.message):(f.fire(new s.y(new Error(p.message))),a=!0);return a}const se=s.a6.light;let ve;class je extends s.E{constructor(n,a="flat"){super(),this._transitionable=new s.a8(ve||(ve=new s.a9({anchor:new s.aa(se.anchor),position:new s.ab(se.position),color:new s.aa(se.color),intensity:new s.aa(se.intensity)}))),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,p={}){this._validate(Do,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,p){return(!p||p.validate!==!1)&&ne(this,n.call(us,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const ke=s.a6.terrain;let He=class extends s.E{constructor(f,n,a,p,x){super(),this.scope=a,this._transitionable=new s.a8(new s.a9({source:new s.aa(ke.source),exaggeration:new s.aa(ke.exaggeration)}),a,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=x}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let a=-1,p=-1,x=1;for(const b of n.zoomStops)x=n.evaluate(new s.ac(b,{worldview:this.worldview})),x>.01?(a=b,p=-1):p=b;return x<.01&&a>0&&p>a?[a,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.ad}};const at=45,qe=65,nt=.05;function Bt(f,n,a,p){const x=s.ah(at,qe,a),[b,T]=It(f,p);let M=1-Math.min(1,Math.exp((n-b)/(T-b)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*x*f.alpha}function It(f,n){const a=.5/Math.tan(.5*n);return[f.range[0]+a,f.range[1]+a]}function vn(f,n,a,p,x){const b=s.af([],[n,a,p],x.mercatorFogMatrix);return Bt(f,s.ag(b),x.pitch,x._fov)}function $n(f,n,a,p,x,b,T){const M=[[a,p,0],[x,p,0],[x,b,0],[a,b,0]];let D=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const F of M){const G=s.af([],F,n),V=s.ag(G);D=Math.min(D,V),k=Math.max(k,V)}return[Bt(f,D,T.pitch,T._fov),Bt(f,k,T.pitch,T._fov)]}const Bn=s.a6.fog;class Tn extends s.E{constructor(n,a,p,x){super();const b=new s.a9({range:new s.aa(Bn.range),color:new s.aa(Bn.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Bn["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Bn["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Bn["horizon-blend"]),"star-intensity":new s.aa(Bn["star-intensity"]),"vertical-range":new s.aa(Bn["vertical-range"])});this._transitionable=new s.a8(b,p,new Map(x)),this.set(n,x),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new s.ai(b),this.scope=p}get state(){const n=this._transform,a=n.projection.name==="globe",p=s.aj(n.zoom),x=this.properties.get("range"),b=[.5,3];return{range:a?[s.ak(b[0],x[0],p),s.ak(b[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,p={}){if(this._validate(Ct,n,p))return;const x=Object.assign({},n);for(const b of Object.keys(Bn))x[b]===void 0&&(x[b]=Bn[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(at,qe,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?(function(p,x,b){const T=s.ae.fromLngLat(x),M=b.elevation?b.elevation.getAtPointOrZero(T):0;return vn(p,T.x,T.y,M,b)})(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return $n(this.state,a,0,0,s.al,s.al,this._transform)}getOpacityForBounds(n,a,p,x,b){return this._transform.projection.supportsFog?$n(this.state,n,a,p,x,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?It(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const p of a){const x=n.points[p];let b;if(x[2]>=0)b=x;else{const T=n.points[p-4];b=s.am(T,x,T[2]/(T[2]-x[2]))}if(vn(this.state,b[0],b[1],0,this._transform)>=nt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,p){return(!p||p.validate!==!1)&&ne(this,n.call(us,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let pi,_i,Hi,Lr,Ps=class extends s.E{constructor(f,n,a,p){super();const x=pi||(pi=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(x,a,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=a}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),p=s.an(a[0]),x=-Math.max(s.an(a[1]),.01),b=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(f,n,a={}){if(this._validate(Rs,f,a))return;const p=Object.assign({},f),x=s.a6.snow;for(const b of Object.keys(x))p[b]===void 0&&(p[b]=x[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,a){return(!a||a.validate!==!1)&&ne(this,f.call(us,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},gs=class extends s.E{constructor(f,n,a,p){super();const x=_i||(_i=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(x,a,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(x),this.scope=a}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),a=this.properties.get("direction"),p=s.an(a[0]),x=-Math.max(s.an(a[1]),.01),b=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,n,a={}){if(this._validate(ga,f,a))return;const p=Object.assign({},f),x=s.a6.rain;for(const b of Object.keys(x))p[b]===void 0&&(p[b]=x[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,a){return(!a||a.validate!==!1)&&ne(this,f.call(us,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class ds extends s.E{constructor(n,a,p,x){super(),this.scope=p,this._options=n,this.properties=new s.ai(a),this._transitionable=new s.a8(a,p,new Map(x)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ar{constructor(n,a,p){this.screenBounds=n,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,a){let p,x;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);p=[b],x=a.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),T=s.P.convert(n[1]),M=b.add(T)._div(2);p=[b,T],x=s.aq(b,T).every((D=>a.isPointAboveHorizon(D)))&&a.isPointAboveHorizon(M)}return new ar(p,x,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(x[3]=this.cameraPoint)),s.ar(x,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.aq(a,p,n),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>p.y))+((b.x>a.x)+(b.x>p.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(n,a,p,x=0){const b=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/a._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let M=n.tileID.wrap+(T.unwrapped?x:0);const D=T.polygon.map((ae=>s.as(n.tileTransform,ae,M)));if(!s.at(D,0,0,s.al,s.al))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const k=this.screenGeometryMercator.polygon.map((ae=>s.au(n.tileTransform,ae,M))),F=k.map((ae=>new s.P(ae[0],ae[1]))),G=a.getFreeCameraOptions().position||new s.ae(0,0,0),V=s.au(n.tileTransform,G,M),W=k.map((ae=>{const re=s.av(ae,ae,V);return s.aw(re,re),new s.ax(V,re)})),K=s.ay(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:W,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(J=s.az(D),J.min.x=s.aA(J.min.x,0,s.al),J.min.y=s.aA(J.min.y,0,s.al),J.max.x=s.aA(J.max.x,0,s.al),J.max.y=s.aA(J.max.y,0,s.al),J),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:K};var J}_bufferedScreenMercator(n,a){const p=mr(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(n,a){const p=mr(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(n,a){const p=(function(b,T){const M=s.aB([],T.pixelMatrix,T.globeMatrix),D=[0,-s.aD,0,1],k=[0,s.aD,0,1],F=[0,0,0,1];s.aC(D,D,M),s.aC(k,k,M),s.aC(F,F,M);const G=new s.P(D[0]/D[3],D[1]/D[3]),V=new s.P(k[0]/k[3],k[1]/k[3]),W=s.aE(b,G)&&D[3]<F[3],K=s.aE(b,V)&&k[3]<F[3];if(!W&&!K)return null;const J=(function(De,Te,Se){for(let Pe=1;Pe<De.length;Pe++){const Xe=Sr(Te.pointCoordinate3D(De[Pe-1]).x),Ge=Sr(Te.pointCoordinate3D(De[Pe]).x);if(Se<0){if(Xe<Ge)return{idx:Pe,t:-Xe/(Ge-1-Xe)}}else if(Ge<Xe)return{idx:Pe,t:(1-Xe)/(Ge+1-Xe)}}return null})(b,T,W?-1:1);if(!J)return null;const{idx:ae,t:re}=J;let ue=ae>1?Ei(b.slice(0,ae),T):[],ye=ae<b.length?Ei(b.slice(ae),T):[];ue=ue.map((De=>new s.P(Sr(De.x),De.y))),ye=ye.map((De=>new s.P(Sr(De.x),De.y)));const fe=[...ue];fe.length===0&&fe.push(ye[ye.length-1]);const Ce=s.ak(fe[fe.length-1].y,(ye.length===0?ue[0]:ye[0]).y,re);let be;return be=W?[new s.P(0,Ce),new s.P(0,0),new s.P(1,0),new s.P(1,Ce)]:[new s.P(1,Ce),new s.P(1,1),new s.P(0,1),new s.P(0,Ce)],fe.push(...be),ye.length===0?fe.push(ue[0]):fe.push(...ye),{polygon:fe.map((De=>new s.ae(De.x,De.y))),unwrapped:!1}})(n,a);if(p)return p;const x=(function(b,T){let M=!1,D=-1/0,k=0;for(let G=0;G<b.length-1;G++)b[G].x>D&&(D=b[G].x,k=G);for(let G=0;G<b.length-1;G++){const V=(k+G)%(b.length-1),W=b[V],K=b[V+1];Math.abs(W.x-K.x)>.5&&(W.x<K.x?(W.x+=1,V===0&&(b[b.length-1].x+=1)):(K.x+=1,V+1===b.length-1&&(b[0].x+=1)),M=!0)}const F=s.aF(T.center.lng);return M&&F<Math.abs(F-1)&&b.forEach((G=>{G.x-=1})),{polygon:b,unwrapped:M}})(Ei(n,a).map((b=>new s.P(Sr(b.x),b.y))),a);return{polygon:x.polygon.map((b=>new s.ae(b.x,b.y))),unwrapped:x.unwrapped}}}function Ei(f,n){return s.aG(f,(a=>{const p=n.pointCoordinate3D(a);a.x=p.x,a.y=p.y}),1/256)}function Sr(f){return f<0?1+f%1:f%1}function mr(f){return 100*f|0}function Oi(f,n,a,p,x){const b=function(M,D){if(M)return x(M);if(D){if(f.url&&D.tiles&&f.tiles&&delete f.tiles,D.variants){if(!Array.isArray(D.variants))return x(new Error("variants must be an array"));for(const F of D.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return x(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){D=Object.assign(D,F);break}}}const k=s.aH(Object.assign({},D,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=n.canonicalizeTileset(k,f.url),x(null,k)}},T=(function(M,D,k){if(!M)return null;if(!D&&!k)return M;k=k||M.worldview_default;const F=Object.values(M.language||{});if(F.length===0)return null;const G=Object.values(M.worldview||{});if(G.length===0)return null;const V=F.every((K=>K===D)),W=G.every((K=>K===k));return V&&W?M:D in(M.language_options||{})||k in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null})(f.data,a,p);return T?s.o.frame((()=>b(null,T))):f.url?s.m(n.transformRequest(n.normalizeSourceURL(f.url,null,a,p),s.R.Source),b):s.o.frame((()=>{const{data:M,...D}=f;b(null,D)}))}function Ir(f,n){const a=Math.pow(2,n.z),p=Math.floor(s.aF(f.getWest())*a),x=Math.floor(s.aJ(f.getNorth())*a),b=Math.ceil(s.aF(f.getEast())*a),T=Math.ceil(s.aJ(f.getSouth())*a);return n.x>=p&&n.x<b&&n.y>=x&&n.y<T}class Fs{constructor(n,a,p){this.bounds=n?s.aI.convert(this.validateBounds(n)):null,this.minzoom=a||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const a of n)this.extraBounds.push(s.aI.convert(this.validateBounds(a)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Ir(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(Ir(a,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const a=new Fs(n.bounds,n.minzoom,n.maxzoom);return a.addExtraBounds(n.extra_bounds),a}}class So extends s.E{constructor(n,a,p,x){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.aK}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Oi(this._options,this.map._requestManager,a,p,((x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(x));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=Fs.fromTileJSON(b),ct(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(x)}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,a){const p=n.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(x,s.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,M=T?{image:T.image.clone()}:null,D={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&s.h(p)&&(D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",D,k.bind(this));else if(n.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",D,k.bind(this),void 0,!0);else{const F=s.aL.call({deduped:this._deduped},D,((G,V)=>{if(G||!V)k.call(this,G);else{const W=s.aM(V.responseHeaders);D.data={cacheControl:W.cacheControl,expires:W.expires,rawData:V.rawData.slice(0)},n.actor&&n.actor.send("loadTile",D,k.bind(this),void 0,!0)}}),!0);n.request={cancel:F}}function k(F,G){return delete n.request,n.aborted?a(null):F&&F.status!==404?a(F):(G&&G.resourceTiming&&(n.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&n.setExpiryData(G),n.loadVectorData(G,this.map.painter),s.aN(this.dispatcher),a(null,G),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wa extends s.E{constructor(n,a,p,x){super(),this.id=n,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,s.aH(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=Oi(this._options,this.map._requestManager,null,a,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map((b=>b.id))),this.tileBounds=Fs.fromTileJSON(x),ct(x.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const p=s.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.n(this.map._requestManager.transformRequest(x,s.R.Tile),((b,T,M)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(b)return n.state="errored",a(b);if(!T)return a(null);const D=s.aM(M);this.map._refreshExpiredTiles&&n.setExpiryData(D),n.setTexture(T,this.map.painter),n.state="loaded",s.aN(this.dispatcher),a(null)}))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a&&a()}unloadTile(n,a){n.texture&&n.texture instanceof s.T?(n.destroy(!0),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function nc([f,n],a,p,{scaled:x=!0}={}){const{tileSize:b,buffer:T}=p,{x:M,y:D,z:k}=a;if(!isFinite(M)||!isFinite(D)||!isFinite(k))throw new Error("Invalid MRT header");const F=2**k,G=F*s.aF(f),V=F*s.aJ(n);return(function([W,K],J,{scaled:ae=!0}={}){if(!J)throw new Error("bandView is undefined");const{data:re,tileSize:ue,buffer:ye,offset:fe,scale:Ce,dimension:be}=J;if(W<-ye||W>ue+ye||K<-ye||K>ue+ye)throw new Error(`Point (${W}, ${K}) out of bounds for tileSize=${ue}, buffer=${ye}`);const De=(K+ye)*(ue+2*ye)+(W+ye);if(new Uint32Array(re.buffer)[De]===4294967295)return null;let Te=[];Te=ae?[]:new J.data.constructor(be);for(let Se=0;Se<be;Se++)Te[Se]=Math.round(1e12*(re[be*De+Se]*Ce+fe))/1e12;return Te})([Math.min(Math.max(-T,Math.floor((G-M)*b)),b-1+T),Math.min(Math.max(-T,Math.floor((V-D)*b)),b-1+T)],p,{scaled:x})}class Xs extends Wa{constructor(n,a,p,x){super(n,a,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);a&&a.enabled&&p&&a._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile),b={request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=x,n.actor||(n.actor=this.dispatcher.getActor());const T=(M,D,k)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(M)return M.name==="AbortError"?void 0:(n.state="errored",a(M));if(this.map._refreshExpiredTiles&&D){const F=s.aM(k);n.setExpiryData(F)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!D)return a(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=D}a(null)};n.request=this.partial?n.fetchHeader(void 0,T.bind(this)):n.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,a){const p=n.texturePerLayer;if(n.flushAllQueues(),p.size){n.destroy(!0);for(const x of p.values())this.map.painter.saveTileTexture(x)}else n.destroy()}prepareTile(n,a,p,x){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(a,p,x,((b,T)=>{if(b)return n.state="errored",this.fire(new s.y(b)),void this.triggerRepaint(n);T&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(p,T,this.map.painter),n.state="loaded",this.triggerRepaint(n))})))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find((({id:b})=>b===n)),p=a&&a.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(n,a,p){if(!n)return;const x=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;a instanceof s.aQ?b=a.paint.get("raster-array-band"):a instanceof s.aR&&(b=a.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(x);if(T==null)return;if(!n.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(n,x,a.id,T);if(n.updateNeeded(a.id,T)&&!p)return;const M=n.textureDescriptorPerLayer.get(a.id);return Object.assign({},M,{texture:n.texturePerLayer.get(a.id)})}getImages(n,a){const p=new Map;for(const x of n)for(const b of a){const[T,M]=b.split("/"),D=x.getLayer(T);if(!D||!D.hasBand(M)||!D.hasDataForBand(M))continue;const{bytes:k,tileSize:F,buffer:G}=D.getBandView(M),V=F+2*G,W={data:new s.q({width:V,height:V},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,W)}return p}queryRasterArrayValueByBandId(n,a,p){const x=a._mrt;return new Promise((b=>{const T={},M=new Set;for(const[D,k]of Object.entries(x.layers)){if(p.layerName&&D!==p.layerName)continue;const F={};T[D]=F;for(const{bands:G}of k.dataIndex)for(const V of G)p.bands&&!p.bands.includes(V)||(M.add(s.B(D,V)),a.fetchBand(D,null,V,(W=>{s.o.frame((()=>{F[V]=W?null:nc([n.lng,n.lat],x,k.getBandView(V)),M.delete(s.B(D,V)),M.size===0&&b(T)}))}),!1))}M.size===0&&b(T)}))}_loadTileForQuery(n,a){if(this._loadTileLoaded[n.uid])return void a(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(a);this._loadTilePending[n.uid]=[a];const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile);n.actor.send("loadTile",{request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((b,T,M)=>{if(b)return this._loadTilePending[n.uid].forEach((D=>D(b,null))),void delete this._loadTilePending[n.uid];if(!T)return this._loadTilePending[n.uid].forEach((D=>D(null,null))),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&T){const D=s.aM(M);n.setExpiryData(D)}n._mrt=T,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach((D=>D(null,T))),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(n,a,p){return new Promise(((x,b)=>{this._loadTileForQuery(a,((T,M)=>{T?b(T):x(M?this.queryRasterArrayValueByBandId(n,a,p):null)}))}))}queryRasterArrayValue(n,a){const p=s.aS.convert(n),x=this.findLoadedParent(p);return x&&x._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,a):this.queryRasterArrayValueByAllBands(p,x,a):Promise.resolve(null)}findLoadedParent(n){const a=s.ae.fromLngLat(n,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,b=Math.floor(a.x),T=Math.floor((a.x-b)*x),M=Math.floor(a.y*x),D=this.map.style.getSourceCache(this.id),k=new s.aP(p,b,p,T,M);return D.findLoadedParent(k,this.minzoom)}}const Bs={vector:So,raster:Wa,"raster-dem":class extends Wa{constructor(f,n,a,p){super(f,n,a,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const a=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,b){x&&(f.state="errored",n(x)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=s.n(this.map._requestManager.transformRequest(a,s.R.Tile),(function(x,b,T){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(x)f.state="errored",n(x);else if(b){const M=s.aM(T);this.map._refreshExpiredTiles&&f.setExpiryData(M);const D=ImageBitmap&&b instanceof ImageBitmap&&s.r(),k=1-(b.width-s.aO(b.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const F=D?b:s.o.getImageData(b,k),G={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:k};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",G,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,a=Math.pow(2,n.z),p=(n.x-1+a)%a,x=n.x===0?f.wrap-1:f.wrap,b=(n.x+1+a)%a,T=n.x+1===a?f.wrap+1:f.wrap,M={};return M[new s.aP(f.overscaledZ,x,n.z,p,n.y).key]={backfilled:!1},M[new s.aP(f.overscaledZ,T,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(M[new s.aP(f.overscaledZ,x,n.z,p,n.y-1).key]={backfilled:!1},M[new s.aP(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new s.aP(f.overscaledZ,T,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<a&&(M[new s.aP(f.overscaledZ,x,n.z,p,n.y+1).key]={backfilled:!1},M[new s.aP(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new s.aP(f.overscaledZ,T,n.z,b,n.y+1).key]={backfilled:!1}),M}},"raster-array":Xs,geojson:class extends s.E{constructor(f,n,a,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:s.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const a of this._data.features)n.set(a.id,a);for(const a of f.features)n.set(a.id,a);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:a},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:f},this.workerOptions);n.scope=this.scope;const a=this._data;typeof a=="string"?(n.request=this.map._requestManager.transformRequest(s.o.resolveURL(a),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,((p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,n){const a=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(a,T,((M,D)=>b&&!D?(f.state="loaded",n(null)):(delete f.request,f.destroy(),f.aborted?n(null):M?n(M):(f.loadVectorData(D,this.map.painter,a==="reloadTile"),n(null)))),void 0,a==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aT{constructor(f,n,a,p){super(f,n,a,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aU(this.urls,((n,a)=>{this._loaded=!0,n?this.fire(new s.y(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aT,model:s.aW,"batched-model":class extends s.E{constructor(f,n,a,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(f)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Oi(this._options,this.map._requestManager,n,a,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Fs(x.bounds,this.minzoom,this.maxzoom)),ct(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)}))}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const a=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(a,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const b=Object.values(f.buckets);for(const T of b)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(b,T){return f.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aT{constructor(f,n,a,p){super(f,n,a,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((b=>typeof b!="number"))))||this.fire(new s.y(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,n,a,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fs(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:a,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:a,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:a,y:p,z:x}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:a,y:p,z:x},{signal:b.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",n(null)):T===void 0?(f.state="errored",n(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):(function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement})(T)?(this.loadTileData(f,T),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((T=>{T.name!=="AbortError"&&(f.state="errored",n(T))})),f.request.cancel=()=>b.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof s.T?(f.destroy(!0),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:a,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:a,y:p,z:x})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z})))}_clearTiles(){const f=s.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},Oo=function(f,n,a,p){const x=new Bs[n.type](f,n,a,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return s.aX(["load","abort","unload","serialize","prepare"],x),x};function ul(f,n,a=""){return`${a}:${n.id||""}:${n.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:b}=p;return`featureset:${x}${b?`:import:${b}`:""}`}})(f.target)}`}function na(f,n,a,p=""){if(f.uniqueFeatureID){const x=ul(f,n,p);if(a.has(x))return!0;a.add(x)}return!1}function To(f,n,a,p,x=!1){const b=n.sourceCache.transform,T=n.sourceCache.tilesIn(f,n.has3DLayers,x);T.sort(ic);const M=[];for(const D of T){const k=D.tile.queryRenderedFeatures(n,D,a,p,b,x);Object.keys(k).length&&M.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:k})}for(const D in n.layers){const k=n.layers[D];if(k.styleLayer){const F=k.styleLayer.queryRenderedFeatures(f,n.sourceCache,p);Object.keys(F).length&&M.push({wrappedTileID:0,queryResults:F})}}return M.length===0?{}:(function(D){const k={},F={};for(const G of D){const V=G.queryResults,W=G.wrappedTileID,K=F[W]=F[W]||{};for(const J in V){const ae=V[J],re=K[J]=K[J]||{},ue=k[J]=k[J]||[];for(const ye of ae)re[ye.featureIndex]||(re[ye.featureIndex]=!0,ue.push(ye))}}return k})(M)}function Rf(f,n,a,p,x,b){const T={},M=p.queryRenderedSymbols(f),D=[];for(const k of Object.keys(M).map(Number))D.push(x[k]);D.sort(ic);for(const k of D){const F=k.featureIndex.lookupSymbolFeatures(M[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,n,a,b);for(const G in F){const V=T[G]=T[G]||[],W=F[G];W.sort(((K,J)=>{const ae=k.featureSortOrder;if(ae){const re=ae.indexOf(K.featureIndex);return ae.indexOf(J.featureIndex)-re}return J.featureIndex-K.featureIndex}));for(const K of W)V.push(K)}}return T}function yh(f,n){const a=f.getRenderableIds().map((b=>f.getTileByID(b))),p=[],x={};for(let b=0;b<a.length;b++){const T=a[b],M=T.tileID.canonical.key;x[M]||(x[M]=!0,T.querySourceFeatures(p,n))}return p}function ic(f,n){const a=f.tileID,p=n.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function Mf(f,n){const a={};if(!n)return a;for(const p of f){const x=p.layerIds.map((b=>n.getLayer(b))).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map((b=>x.filter((T=>T.id===b))[0])));for(const b of x)a[b.fqid]=p}}return a}const ia=32,dl=33,zo=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,a=0,p=0,x=0,b=0,T=0,M=0;for(1&n?x=b=T=ia:a=p=M=ia;(n>>=1)>1;){const k=a+x>>1,F=p+b>>1;1&n?(x=a,b=p,a=T,p=M):(a=x,p=b,x=T,b=M),T=k,M=F}const D=4*f;zo[D+0]=a,zo[D+1]=p,zo[D+2]=x,zo[D+3]=b}const Xa=new Uint16Array(2178),jc=new Uint8Array(1089),rc=new Uint16Array(1089);function hl(f){return f===0?-.03125:f===32?.03125:0}const xh={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class fl{constructor(n,a,p,x,b,T){this.tileID=n,this.uid=s.b1(),this.uses=0,this.tileSize=a,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(n){const a=n+this.timeAdded;a<s.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Mf(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b3){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.b3&&b.hasRTLText){this.hasRTLText=!0,s.b4();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],T=a.style.getOwnLayer(x);if(!T)continue;const M=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,M)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b2}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,a,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Mf(n.buckets,a.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,a){for(const b in this.buckets){const T=this.buckets[b];if(T.uploadPending()){let M={},D=[],k={zoom:0,pitch:0,brightness:0,worldview:""};if(a){if(a.style){D=a.style.listImages();const F=T.layers[0],G=F.sourceLayer||"_geojsonTileLayer",V=a.style.getLayerSourceCache(F);V&&(M=V._state.getState(G,void 0))}k={zoom:a.transform.zoom||0,pitch:a.transform.pitch||0,brightness:a.style.getBrightness()||0,worldview:a.worldview||""}}T.upload(n,this.tileID.canonical,M,D,k)}}const p=n.gl,x=this.imageAtlas;x&&!x.uploaded&&(this.imageAtlasTexture=new s.T(n,x.image,p.RGBA8,{useMipmap:!!x.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=a.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(a)),(this._lastUpdatedBrightness||x||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const a in this.buckets){const p=this.buckets[a];p.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,p.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,a,p,x,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=this.evaluateQueryRenderedFeaturePadding(),D=(function(k,F){const G=s.bp([],[.5*k.width,.5*-k.height,1]);return s.bq(G,G,[1,-1,0]),s.aB(G,G,k.calculateProjMatrix(F.toUnwrapped())),Float32Array.from(G)})(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:a,pixelPosMatrix:D,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:M})}querySourceFeatures(n,a){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),b=a?a.sourceLayer:"",T=x._geojsonTileLayer||x[b];if(!T)return;const M=s.b5(a&&a.filter),{z:D,x:k,y:F}=this.tileID.canonical,G={z:D,x:k,y:F};for(let V=0;V<T.length;V++){const W=T.feature(V);if(M.needGeometry){const ae=s.b6(W,!0);if(!M.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ae,this.tileID.canonical))continue}else if(!M.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),W))continue;const K=p.getId(W,b),J=new s.b7(W,D,k,F,K);J.tile=G,n.push(J)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const p=s.b8(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(a)if(this.expirationTime<a)x=!0;else{const b=this.expirationTime-a;b?this.expirationTime=p+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const a in this.buckets)if(n.style.hasLayer(a)&&this.buckets[a].layers.some((p=>p.appearances&&p.appearances.length>0)))return!0;return!1}updateBuckets(n,a){if(!this.latestFeatureIndex||!n.style)return;const p=this.latestFeatureIndex.loadVTLayers(),x=n.style.listImages(),b=n.style.getBrightness();for(const T in this.buckets){if(!n.style.hasLayer(T))continue;const M=this.buckets[T],D=M.layers[0],k=D.sourceLayer||"_geojsonTileLayer",F=p[k],G=n.style.getLayerSourceCache(D);let V={};G&&(V=G._state.getState(k,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},K=Object.keys(V).length>0&&!a;if(M.hasAppearances=M.layers.some((ae=>ae.appearances&&ae.appearances.length>0)),(K&&M.stateDependentLayers.length!==0||a)&&M.update(V,F,x,W,K?M.stateDependentLayers:M.layers,a,b),K&&M.stateDependentLayers.length!==0||a||M.hasAppearances){const ae={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};M.updateAppearances(this.tileID.canonical,V,x,ae)}(M instanceof s.b9||M instanceof s.ba)&&n._terrain&&n._terrain.enabled&&G&&M.uploadPending()&&n._terrain._clearRenderCacheForTile(G.id,this.tileID);const J=n&&n.style&&n.style.getOwnLayer(T);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.o.now()+n}setTexture(n,a){const p=a.context,x=p.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(p,n,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(n,a){const p={};for(const x of a)p[x]=!0;this.dependencies[n]=p}hasDependency(n,a){for(const p of n){const x=this.dependencies[p];if(x){for(const b of a)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const p=s.bb(xh,this.tileID.canonical,this.tileTransform)[0],x=new s.bc,b=new s.bd;for(let T=0;T<p.length;T++){const{x:M,y:D}=p[T];x.emplaceBack(M,D),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(x,s.be.members),this._tileDebugSegments=s.bf.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const p=s.bb(xh,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const T=(function(M,D){const k=s.aY(M,D),F=Math.pow(2,M.z);for(let ae=0;ae<dl;ae++)for(let re=0;re<dl;re++){const ue=s.aZ((M.x+(re+hl(re))/ia)/F),ye=s.a_((M.y+(ae+hl(ae))/ia)/F),fe=D.project(ue,ye),Ce=ae*dl+re;Xa[2*Ce+0]=Math.round((fe.x*k.scale-k.x)*s.al),Xa[2*Ce+1]=Math.round((fe.y*k.scale-k.y)*s.al)}jc.fill(0),rc.fill(0);for(let ae=2045;ae>=0;ae--){const re=4*ae,ue=zo[re+0],ye=zo[re+1],fe=zo[re+2],Ce=zo[re+3],be=ue+fe>>1,De=ye+Ce>>1,Te=be+De-ye,Se=De+ue-be,Pe=ye*dl+ue,Xe=Ce*dl+fe,Ge=De*dl+be,dt=Math.hypot((Xa[2*Pe+0]+Xa[2*Xe+0])/2-Xa[2*Ge+0],(Xa[2*Pe+1]+Xa[2*Xe+1])/2-Xa[2*Ge+1])>=16;jc[Ge]=jc[Ge]||(dt?1:0),ae<1022&&(jc[Ge]=jc[Ge]||jc[(ye+Se>>1)*dl+(ue+Te>>1)]||jc[(Ce+Se>>1)*dl+(fe+Te>>1)])}const G=new s.a$,V=new s.b0;let W=0;function K(ae,re){const ue=re*dl+ae;return rc[ue]===0&&(G.emplaceBack(Xa[2*ue+0],Xa[2*ue+1],ae*s.al/ia,re*s.al/ia),rc[ue]=++W),rc[ue]-1}function J(ae,re,ue,ye,fe,Ce){const be=ae+ue>>1,De=re+ye>>1;if(Math.abs(ae-fe)+Math.abs(re-Ce)>1&&jc[De*dl+be])J(fe,Ce,ae,re,be,De),J(ue,ye,fe,Ce,be,De);else{const Te=K(ae,re),Se=K(ue,ye),Pe=K(fe,Ce);V.emplaceBack(Te,Se,Pe)}}return J(0,0,ia,ia,ia,0),J(ia,ia,0,0,0,ia),{vertices:G,indices:V}})(this.tileID.canonical,a);x=T.vertices,b=T.indices}else{x=new s.a$,b=new s.b0;for(const{x:M,y:D}of p)x.emplaceBack(M,D,0,0);const T=s.bg(x.int16.subarray(0,4*x.length),void 0,4);for(let M=0;M<T.length;M+=3)b.emplaceBack(T[M],T[M+1],T[M+2])}this._tileBoundsBuffer=n.createVertexBuffer(x,s.bh.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.bf.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(n,a){const p=a.projection;if(!p||p.name!=="globe"||a.freezeTileCoverage)return;const x=this.tileID.canonical,b=s.bi(x,a),T=s.bj(b),M=s.aj(a.zoom);let D;M>0&&(D=s.bk(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,x,a,T,D,M),this._makeGlobeTileDebugTextBuffer(n,x,a,T,D,M)}_globePoint(n,a,p,x,b,T,M){let D=s.bl(n,a,p);if(T){const k=1<<p.z,F=s.aF(x.center.lng),G=s.aJ(x.center.lat),V=(p.x+.5)/k-F;let W=0;V>.5?W=-1:V<-.5&&(W=1);let K=(n/s.al+p.x)/k+W,J=(a/s.al+p.y)/k;K=(K-F)*x._pixelsPerMercatorPixel+F,J=(J-G)*x._pixelsPerMercatorPixel+G;const ae=[K*x.worldSize,J*x.worldSize,0];s.af(ae,ae,T),D=s.bm(D,ae,M)}return s.af(D,D,b)}_makeGlobeTileDebugBorderBuffer(n,a,p,x,b,T){const M=new s.bc,D=new s.bd,k=new s.bn,F=(V,W,K,J,ae)=>{const re=(K-V)/(ae-1),ue=(J-W)/(ae-1),ye=M.length;for(let fe=0;fe<ae;fe++){const Ce=V+fe*re,be=W+fe*ue;M.emplaceBack(Ce,be);const De=this._globePoint(Ce,be,a,p,x,b,T);k.emplaceBack(De[0],De[1],De[2]),D.emplaceBack(ye+fe)}},G=s.al;F(0,0,G,0,16),F(G,0,G,G,16),F(G,G,0,G,16),F(0,G,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(D),this._tileDebugBuffer=n.createVertexBuffer(M,s.be.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(k,s.bo.members),this._tileDebugSegments=s.bf.simpleSegment(0,0,M.length,D.length)}_makeGlobeTileDebugTextBuffer(n,a,p,x,b,T){const M=s.al/4,D=new s.bc,k=new s.b0,F=new s.bn,G=25;k.reserve(32),D.reserve(G),F.reserve(G);const V=(W,K)=>G*W+K;for(let W=0;W<G;W++){const K=W*M;for(let J=0;J<G;J++){const ae=J*M;D.emplaceBack(ae,K);const re=this._globePoint(ae,K,a,p,x,b,T);F.emplaceBack(re[0],re[1],re[2])}}for(let W=0;W<4;W++)for(let K=0;K<4;K++){const J=V(W,K),ae=V(W,K+1),re=V(W+1,K),ue=V(W+1,K+1);k.emplaceBack(J,ae,re),k.emplaceBack(re,ae,ue)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(k),this._tileDebugTextBuffer=n.createVertexBuffer(D,s.be.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(F,s.bo.members),this._tileDebugTextSegments=s.bf.simpleSegment(0,0,G,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.br.setPbf(s.bs);class Ka extends fl{constructor(n,a,p,x,b){super(n,a,p,x,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,a,p){const x=p.context,b=x.gl;let T=this.texturePerLayer.get(n)||p.getTileTexture(a.width);T&&T instanceof s.T?T.update(a,{premultiply:!1}):T=new s.T(x,a,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,T)}flushQueues(n){const a=this._workQueuePerLayer.get(n)||[],p=this._fetchQueuePerLayer.get(n)||[];for(;a.length;)a.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(n)||[];for(;a.length;)a.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(n)||[];for(;a.length;)a.pop()()}}fetchHeader(n=16384,a){const p=this._mrt=new s.br(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bt(x,((b,T,M)=>{if(b)a(b);else try{const D=p.getHeaderLength(T);if(D>n)return void(this.request=this.fetchHeader(D,a));p.parseHeader(T),this._isHeaderLoaded=!0;let k=0;for(const F of Object.values(p.layers))k=Math.max(k,F.dataIndex[F.dataIndex.length-1].lastByte);T.byteLength>=k&&(this.entireBuffer=T),a(null,this.entireBuffer||T,M)}catch(D){a(D)}})),this.request}fetchBandForRender(n,a,p,x){this.fetchBand(n,a,p,(b=>{if(b)return void x(b);this.updateTextureDescriptor(n,a,p);const T=this.textureDescriptorPerLayer.get(a);x(null,T?T.img:null)}))}fetchBand(n,a,p,x,b=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void x(new Error("Tile header is not ready"));const M=this.actor;if(!M)return void x(new Error("Can't fetch tile band without an actor"));let D;const k=s.B(String(p),s.B(this.tileID.key,n));let F=this._taskQueue.get(k);F?F.add(x):(F=new Set,F.add(x),this._taskQueue.set(k,F));const G=(J,ae)=>{D.complete(J,ae),J?x(J):(F.values().forEach((re=>re(null,ae))),this._taskQueue.delete(k))},V=(J,ae)=>{if(J)return x(J);const re=M.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ae,task:D},G,void 0,!0);if(a!==null){const ue=this._workQueuePerLayer.get(a)||[];ue.push((()=>{re&&re.cancel(),D.cancel()})),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,ue)}};let W;try{W=T.getLayer(n)}catch(J){if(this.state==="reloading")return;throw J}if(!W)return void x(new Error(`Unknown sourceLayer "${n}"`));if(W.hasDataForBand(p))return F.values().forEach((J=>J(null,null))),void this._taskQueue.delete(k);const K=W.getDataRange([p]);if(D=T.createDecodingTask(K),!D||D.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)V(null,this.entireBuffer.slice(K.firstByte,K.lastByte+1));else{const J=Object.assign({},this.requestParams,{headers:{Range:`bytes=${K.firstByte}-${K.lastByte}`}}),ae=s.bt(J,V);if(a!==null){const re=this._fetchQueuePerLayer.get(a)||[];re.push((()=>{ae.cancel(),D.cancel()})),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,re)}}}updateNeeded(n,a){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,a,p){if(!this._mrt)return;const x=this._mrt.getLayer(n);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:b,tileSize:T,buffer:M,offset:D,scale:k}=x.getBandView(p),F=T+2*M,G=new s.q({width:F,height:F},b),V=this.texturePerLayer.get(a);V&&V instanceof s.T&&V.update(G,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:n,band:p,img:G,buffer:M,offset:D,tileSize:T,format:x.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const a of this.texturePerLayer.values())a&&a instanceof s.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class mu{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,p){const x=n.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:a,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout((()=>{this.remove(n,b)}),p)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const p=n.wrapped().key,x=a===void 0?0:this.data[p].indexOf(a),b=this.data[p][x];return this.data[p].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const p in this.data)for(const x of this.data[p])n(x.value)||a.push(x);for(const p of a)this.remove(p.value.tileID,p)}}class gg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,p){const x=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][x]=this.stateChanges[n][x]||{},Object.assign(this.stateChanges[n][x],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==x&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][x]===null){this.deletedStates[n][x]={};for(const b in this.state[n][x])p[b]||(this.deletedStates[n][x][b]=null)}else for(const b in p)this.deletedStates[n]&&this.deletedStates[n][x]&&this.deletedStates[n][x][b]===null&&delete this.deletedStates[n][x][b]}removeFeatureState(n,a,p){if(this.deletedStates[n]===null)return;const x=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&a!==void 0)this.deletedStates[n][x]!==null&&(this.deletedStates[n][x]=this.deletedStates[n][x]||{},this.deletedStates[n][x][p]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][x])for(p in this.deletedStates[n][x]={},this.stateChanges[n][x])this.deletedStates[n][x][p]=null;else this.deletedStates[n][x]=null;else this.deletedStates[n]=null}getState(n,a){const p=this.state[n]||{},x=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(a!==void 0){const M=String(a),D=Object.assign({},p[M],x[M]);if(b){const k=b[a];if(k===null)return{};for(const F in k)delete D[F]}return D}const T=Object.assign({},p,x);if(b)for(const M in b)delete T[M];return T}initializeTileState(n,a){n.refreshFeatureState(a)}coalesceChanges(n,a){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const T in this.stateChanges[x])this.state[x][T]||(this.state[x][T]={}),Object.assign(this.state[x][T],this.stateChanges[x][T]),b[T]=this.state[x][T];p[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const T in this.state[x])b[T]={},this.state[x][T]={};else for(const T in this.deletedStates[x]){if(this.deletedStates[x][T]===null)this.state[x][T]={};else if(this.state[x][T])for(const M of Object.keys(this.deletedStates[x][T]))delete this.state[x][T][M];b[T]=this.state[x][T]}p[x]=p[x]||{},Object.assign(p[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in n)n[x].refreshFeatureState(a)}}class Da extends s.E{constructor(n,a,p){super(),this.id=n,this._onlySymbols=p,a.on("data",(x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),a.on("error",(()=>{this._sourceErrored=!0})),this._source=a,this._tiles={},this._cache=new mu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new gg,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const p=this._tiles[a];p.upload(n,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((n=>n.tileID)).sort(jp).map((n=>n.key))}getRenderableIds(n,a){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,n,a)&&p.push(this._tiles[x]);return n?p.sort(((x,b)=>{const T=x.tileID,M=b.tileID,D=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),k=new s.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-M.overscaledZ||k.y-D.y||k.x-D.x})).map((x=>x.tileID.key)):p.map((x=>x.tileID)).sort(jp).map((x=>x.key))}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=a),this._loadTile(p,this._tileLoaded.bind(this,p,n,a)))}_tileLoaded(n,a,p,x,b){if(x){if(n.state="errored",x.status!==404)this._source.fire(new s.y(x,{tile:n}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const M=this.map.painter.terrain;this.update(this.transform,M.getScaledDemTileSize(),!0),M.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=s.o.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let T=new Map;b&&b.responseHeaders&&(T=b.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(n){const a=this.getRenderableIds();for(let x=0;x<a.length;x++){const b=a[x];if(n.neighboringTiles&&n.neighboringTiles[b]){const T=this.getTileByID(b);p(n,T),p(T,n)}}function p(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-x.tileID.canonical.x;const M=b.tileID.canonical.y-x.tileID.canonical.y,D=Math.pow(2,x.tileID.canonical.z),k=b.tileID.key;T===0&&M===0||Math.abs(M)>1||(Math.abs(T)>1&&(Math.abs(T+D)===1?T+=D:Math.abs(T-D)===1&&(T-=D)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,T,M),x.neighboringTiles&&x.neighboringTiles[k]&&(x.neighboringTiles[k].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,p,x){for(const b in this._tiles){let T=this._tiles[b];if(x[b]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>p)continue;let M=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const k=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[k.key],T&&T.hasData()&&(M=k)}let D=M;for(;D.overscaledZ>a;)if(D=D.scaledTo(D.overscaledZ-1),n[D.key]){x[M.key]=M;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=a?p:null}for(let p=n.overscaledZ-1;p>=a;p--){const x=n.scaledTo(p),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const p=Math.ceil(n.width/a)+1,x=Math.ceil(n.height/a)+1,b=Math.floor(p*x*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(M)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const p={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),p[b.tileID.key]=b}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(n,a,p,x,b){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let M,D=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const V=k.attenuationRange()[0],W=Math.floor(V)-Math.log2(k.getDemUpscale());D>W&&(D=W)}if(this.used||this.usedForTerrain){if(this._source.tileID)M=n.getVisibleUnwrappedCoordinates(this._source.tileID).map((V=>new s.aP(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)));else if(this.tileCoverLift!==0){const V=n.clone();V.tileCoverLift=this.tileCoverLift,M=V.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&n.projection.name==="globe"&&(M.push(new s.aP(1,0,1,0,0)),M.push(new s.aP(1,0,1,1,0)),M.push(new s.aP(1,0,1,0,1)),M.push(new s.aP(1,0,1,1,1)))}else if(M=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);M=M.filter((W=>V(W)))}}else M=[];if(M.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ll(this._source.type)){const V=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),W=Math.min(V,this._source.maxzoom);if(T){const K=n.extendTileCover(M,W);for(const J of K)M.push(J)}else if(b){const K=n.extendTileCoverToNearPlane(M,this.transform.getFrustum(W),W);for(const J of K)M.push(J)}else if(this.castsShadows&&x){const K=n.extendTileCover(M,W,x);for(const J of K)this._shadowCasterTiles[J.key]=!0,M.push(J)}}const F=this._updateRetainedTiles(M);if(Ll(this._source.type)&&M.length!==0){const V={},W={},K=Object.keys(F);for(const ae of K){const re=F[ae],ue=this._tiles[ae];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=s.o.now())continue;const ye=this.findLoadedParent(re,Math.max(re.overscaledZ-Da.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),V[ye.tileID.key]=ye.tileID),W[ae]=re}const J=M[M.length-1].overscaledZ;for(const ae in this._tiles){const re=this._tiles[ae];if(F[ae]||!re.hasData())continue;let ue=re.tileID;for(;ue.overscaledZ>J;){ue=ue.scaledTo(ue.overscaledZ-1);const ye=this._tiles[ue.key];if(ye&&ye.hasData()&&W[ue.key]){F[ae]=re.tileID;break}}}for(const ae in V)F[ae]||(this._coveredTiles[ae]=!0,F[ae]=V[ae])}for(const V in F)this._tiles[V].clearFadeHold();const G=s.bu(this._tiles,F);for(const V of G){const W=this._tiles[V];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const p={},x=n.reduce(((k,F)=>Math.min(k,F.overscaledZ)),1/0),b=n[0].overscaledZ,T=Math.max(b-Da.maxOverzooming,this._source.minzoom),M=Math.max(b+Da.maxUnderzooming,this._source.minzoom),D={};for(const k of n){const F=this._addTile(k);a[k.key]=k,F.hasData()||x<this._source.maxzoom&&(D[k.key]=k)}this._retainLoadedChildren(D,x,M,a);for(const k of n){let F=this._tiles[k.key];if(F.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const V=k.children(this._source.maxzoom)[0],W=this.getTile(V);if(W&&W.hasData()){a[V.key]=V;continue}}else{const V=k.children(this._source.maxzoom);if(a[V[0].key]&&a[V[1].key]&&a[V[2].key]&&a[V[3].key])continue}let G=F.wasRequested();for(let V=k.overscaledZ-1;V>=T;--V){const W=k.scaledTo(V);if(p[W.key]||(p[W.key]=!0,F=this.getTile(W),!F&&G&&(F=this._addTile(W)),F&&(a[W.key]=W,G=F.wasRequested(),F.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let p,x=this._tiles[n].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}a.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;x=b}for(const b of a)this._loadedParentTiles[b]=p}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const p=!!a;if(!p){const x=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new Ka(n,b,this.transform.tileZoom,x,this._isRaster):new fl(n,b,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a.uses++,this._tiles[n.key]=a,p||this._source.fire(new s.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=a.getExpiryTimeout();p&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),p))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,p){const x=[],b=this.transform;if(!b)return x;const T=b.projection.name==="globe",M=s.aF(b.center.lng);for(const D in this._tiles){const k=this._tiles[D];if(p&&k.clearQueryDebugViz(),k.holdingForFade())continue;let F;if(T){const G=k.tileID.canonical;if(G.z===0){const V=[Math.abs(s.aA(M,...ya(G,-1))-M),Math.abs(s.aA(M,...ya(G,1))-M)];F=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(s.aA(M,...ya(G,-1))-M),Math.abs(s.aA(M,...ya(G,0))-M),Math.abs(s.aA(M,...ya(G,1))-M)];F=[V.indexOf(Math.min(...V))-1]}}else F=[0];for(const G of F){const V=n.containsTile(k,b,a,G);V&&x.push(V)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const p=this.getRenderableIds(n,a).map((b=>this._tiles[b].tileID)),x=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(n){const a=n.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const T of a){const M=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*M+T.wrap-p[0])*x[0]+((T.canonical.y+.5)*M-p[1])*x[1]-p[2]*x[2]}return a.sort(((T,M)=>b[T.key]-b[M.key])),a}hasTransition(){if(this._source.hasTransition())return!0;if(Ll(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(n,a,p){this._state.updateState(n=n||"_geojsonTileLayer",a,p)}removeFeatureState(n,a,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,p)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,p){const x=this._tiles[n];x&&x.setDependencies(a,p)}reloadTilesForDependencies(n,a){for(const p in this._tiles)this._tiles[p].hasDependency(n,a)&&this._reloadTile(+p,"reloading");this._cache.filter((p=>!p.hasDependency(n,a)))}_preloadTiles(n,a){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(n,a))};return void this._source.on("data",D)}const p=new Map,x=Array.isArray(n)?n:[n],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const D of x){const k=D.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of k)p.set(F.key,F);this.usedForTerrain&&D.updateElevation(!1)}const M=Array.from(p.values());s.bv(M,((D,k)=>{const F=new fl(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,(G=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),k(G,F)}))}),a)}}function jp(f,n){const a=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-a||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function Ll(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function ya(f,n){const a=1<<f.z;return[f.x/a+n,(f.x+1)/a+n]}Da.maxOverzooming=10,Da.maxUnderzooming=3;class If{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:n,visibilityChanged:a});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const p=a.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(n)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&a.visible,a.visible=x}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,T=this.style.getLayerSourceCache(b);let M=1;b.type==="fill-extrusion"?M=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(M=x.visible?b.paint.get("building-vertical-scale"):0);let D=T?T.getTile(a):null;if(!D&&T)for(const k in T._tiles){const F=T._tiles[k];if(a.canonical.isChildOf(F.tileID.canonical)){D=F;break}}this.currentBuildingBuckets.push({bucket:D?D.getBucket(b):null,tileID:D?D.tileID:a,verticalScale:M})}n.hasAnyZOffset=!1;let p=!1;for(let x=0;x<n.symbolInstances.length;x++){const b=n.symbolInstances.get(x),T=b.zOffset,M=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=M!==Number.NEGATIVE_INFINITY?M:T,p||T===b.zOffset||(p=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,p,x){let b=a,T=p;if(n.canonical.z!==x.canonical.z){const M=x.canonical,D=1/(1<<n.canonical.z-M.z);b=(a+n.canonical.x*s.al)*D-M.x*s.al|0,T=(p+n.canonical.y*s.al)*D-M.y*s.al|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(n,a,p){let x,b;for(let T=0;T<this.layers.length;++T){const M=this.layers[T].layer;if(M.type!=="fill-extrusion"&&M.type!=="building")continue;const{bucket:D,tileID:k,verticalScale:F}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:G,tileY:V}=this._mapCoordToOverlappingTile(n,a,p,k),W=D.getHeightAtTileCoord(G,V);W&&W.height!==void 0&&(W.hidden?x=W.height:b=Math.max(W.height*F,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const M=this.layers[T];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:D,tileID:k}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:F,tileY:G}=this._mapCoordToOverlappingTile(n,a,p,k),V=D.getHeightAtTileCoord(F,G);if(V&&!V.hidden)return V.height===void 0&&x!==void 0?Math.min(V.maxHeight,x)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Fc(f,n){const a={};for(const p in f)p!=="ref"&&(a[p]=f[p]);return s.bw.forEach((p=>{p in n&&(a[p]=n[p])})),a}function Ya(f){f=f.slice();const n=Object.create(null);for(let a=0;a<f.length;a++)n[f[a].id]=f[a];for(let a=0;a<f.length;a++)"ref"in f[a]&&(f[a]=Fc(f[a],n[f[a].ref]));return f}const Fi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function vh(f,n,a){a.push({command:Fi.addSource,args:[f,n[f]]})}function bh(f,n,a){n.push({command:Fi.removeSource,args:[f]}),a[f]=!0}function gu(f,n,a,p){bh(f,a,p),vh(f,n,a)}function wh(f,n,a){let p;for(p in f[a])if(f[a].hasOwnProperty(p)&&p!=="data"&&!s.bx(f[a][p],n[a][p]))return!1;for(p in n[a])if(n[a].hasOwnProperty(p)&&p!=="data"&&!s.bx(f[a][p],n[a][p]))return!1;return!0}function Sh(f,n,a,p,x,b){let T;for(T in n=n||{},f=f||{})f.hasOwnProperty(T)&&(s.bx(f[T],n[T])||a.push({command:b,args:[p,T,n[T],x]}));for(T in n)n.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(s.bx(f[T],n[T])||a.push({command:b,args:[p,T,n[T],x]}))}function Lo(f){return f.id}function Nl(f,n){return f[n.id]=n,f}function sc(f,n,a){const p=n.createTileMatrix(f,f.worldSize,a.toUnwrapped());return s.aB(new Float32Array(16),f.projMatrix,p)}function Th(f,n,a){if(n.projection.name===a.projection.name)return f.projMatrix;const p=a.clone();return p.setProjection(n.projection),sc(p,n.getProjection(),f)}function Fp(f,n,a){return n.name===a.projection.name?f.projMatrix:sc(a,n,f)}class _g{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aA(n,0,1);let a=1,p=this._distances[a];const x=n*this.paddedLength+this.padding;for(;p<x&&a<this._distances.length;)p=this._distances[++a];const b=a-1,T=this._distances[b],M=p-T,D=M>0?(x-T)/M:0;return this.points[b].mult(1-D).add(this.points[a].mult(D))}}class rd{constructor(n,a,p){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(a/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,p,x,b){this._forEachCell(a,p,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(n,a,p,x){this._forEachCell(a-x,p-x,a+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(p),this.circles.push(x)}_insertBoxCell(n,a,p,x,b,T){this.boxCells[b].push(T)}_insertCircleCell(n,a,p,x,b,T){this.circleCells[b].push(T)}_query(n,a,p,x,b,T){if(p<0||n>this.width||x<0||a>this.height)return!b&&[];const M=[];if(n<=0&&a<=0&&this.width<=p&&this.height<=x){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)M.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const k=this.circles[3*D],F=this.circles[3*D+1],G=this.circles[3*D+2];M.push({key:this.circleKeys[D],x1:k-G,y1:F-G,x2:k+G,y2:F+G})}return T?M.filter(T):M}return this._forEachCell(n,a,p,x,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?M.length>0:M}_queryCircle(n,a,p,x,b){const T=n-p,M=n+p,D=a-p,k=a+p;if(M<0||T>this.width||k<0||D>this.height)return!x&&[];const F=[];return this._forEachCell(T,D,M,k,this._queryCellCircle,F,{hitTest:x,circle:{x:n,y:a,radius:p},seenUids:{box:{},circle:{}}},b),x?F.length>0:F}query(n,a,p,x,b){return this._query(n,a,p,x,!1,b)}hitTest(n,a,p,x,b){return this._query(n,a,p,x,!0,b)}hitTestCircle(n,a,p,x){return this._queryCircle(n,a,p,!0,x)}_queryCell(n,a,p,x,b,T,M,D){const k=M.seenUids,F=this.boxCells[b];if(F!==null){const V=this.bboxes;for(const W of F)if(!k.box[W]){k.box[W]=!0;const K=4*W;if(n<=V[K+2]&&a<=V[K+3]&&p>=V[K+0]&&x>=V[K+1]&&(!D||D(this.boxKeys[W]))){if(M.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[W],x1:V[K],y1:V[K+1],x2:V[K+2],y2:V[K+3]})}}}const G=this.circleCells[b];if(G!==null){const V=this.circles;for(const W of G)if(!k.circle[W]){k.circle[W]=!0;const K=3*W;if(this._circleAndRectCollide(V[K],V[K+1],V[K+2],n,a,p,x)&&(!D||D(this.circleKeys[W]))){if(M.hitTest)return T.push(!0),!0;{const J=V[K],ae=V[K+1],re=V[K+2];T.push({key:this.circleKeys[W],x1:J-re,y1:ae-re,x2:J+re,y2:ae+re})}}}}}_queryCellCircle(n,a,p,x,b,T,M,D){const k=M.circle,F=M.seenUids,G=this.boxCells[b];if(G!==null){const W=this.bboxes;for(const K of G)if(!F.box[K]){F.box[K]=!0;const J=4*K;if(this._circleAndRectCollide(k.x,k.y,k.radius,W[J+0],W[J+1],W[J+2],W[J+3])&&(!D||D(this.boxKeys[K])))return T.push(!0),!0}}const V=this.circleCells[b];if(V!==null){const W=this.circles;for(const K of V)if(!F.circle[K]){F.circle[K]=!0;const J=3*K;if(this._circlesCollide(W[J],W[J+1],W[J+2],k.x,k.y,k.radius)&&(!D||D(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(n,a,p,x,b,T,M,D){const k=this._convertToXCellCoord(n),F=this._convertToYCellCoord(a),G=this._convertToXCellCoord(p),V=this._convertToYCellCoord(x);for(let W=k;W<=G;W++)for(let K=F;K<=V;K++)if(b.call(this,n,a,p,x,this.xCellCount*K+W,T,M,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,p,x,b,T){const M=x-n,D=b-a,k=p+T;return k*k>M*M+D*D}_circleAndRectCollide(n,a,p,x,b,T,M){const D=(T-x)/2,k=Math.abs(n-(x+D));if(k>D+p)return!1;const F=(M-b)/2,G=Math.abs(a-(b+F));if(G>F+p)return!1;if(k<=D||G<=F)return!0;const V=k-D,W=G-F;return V*V+W*W<=p*p}}const Zo={unknown:0,flipRequired:1,flipNotRequired:2},_u=Math.tan(85*Math.PI/180);function sd(f,n,a,p,x,b,T){const M=s.bB();if(a)if(b.name==="globe"){const D=s.bC(x,n);s.aB(M,M,D)}else{const D=s.bD([],T);M[0]=D[0],M[1]=D[1],M[4]=D[2],M[5]=D[3],p||s.bA(M,M,x.angle)}else s.aB(M,x.labelPlaneMatrix,f);return M}function Df(f,n,a,p,x,b,T){const M=sd(f,n,a,p,x,b,T);return b.name==="globe"&&a||(M[2]=M[6]=M[10]=M[14]=0),M}function Bc(f,n,a,p,x,b,T){if(a){if(b.name==="globe"){const M=sd(f,n,a,p,x,b,T);return s.bk(M,M),s.aB(M,f,M),M}{const M=s.by(f),D=s.bz([]);return D[0]=T[0],D[1]=T[1],D[4]=T[2],D[5]=T[3],s.aB(M,M,D),p||s.bA(M,M,-x.angle),M}}return x.glCoordMatrix}function Vs(f,n,a,p){const x=[f,n,a,1];a?s.aC(x,x,p):pl(x,x,p);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function Pf(f,n){return Math.min(.5+f/n*.5,1.5)}function yg(f,n){const a=f[0]/f[3],p=f[1]/f[3];return a>=-n[0]&&a<=n[0]&&p>=-n[1]&&p<=n[1]}function xg(f,n,a,p,x,b,T,M,D,k,F=1){const G=a.transform,V=p?f.textSizeData:f.iconSizeData,W=s.bJ(V,a.transform.zoom,F),K=G.projection.name==="globe",J=[256/a.width*2+1,256/a.height*2+1],ae=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ae.clear();let re=null;K&&(re=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const ue=f.lineVertexArray,ye=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,fe=a.transform.width/a.transform.height;let Ce,be=!1;for(let De=0;De<ye.length;De++){const Te=ye.get(De),{numGlyphs:Se,writingMode:Pe}=Te;if(Pe!==s.bK.vertical||be||Ce===s.bK.horizontal||(be=!0),Ce=Pe,(Te.hidden||Pe===s.bK.vertical)&&!be){Vc(Se,ae);continue}be=!1;const Xe=new s.P(Te.tileAnchorX,Te.tileAnchorY),Ge=f.elevationType==="road",dt=!!G.elevation||Ge;let{x:it,y:gt,z:Ft}=G.projection.projectTilePoint(Xe.x,Xe.y,k.canonical),Je=null;if(dt){const pn=Ge?f.getElevationFeatureForText(De):null;Je={getElevation:D,elevation:G.elevation,elevationFeature:pn};const[Fn,ui,Jn]=D(Xe,G.elevation,pn);it+=Fn,gt+=ui,Ft+=Jn}const Ve=[it,gt,Ft,1];if(s.aC(Ve,Ve,n),!yg(Ve,J)){Vc(Se,ae);continue}const _t=Ve[3],rt=Pf(a.transform.getCameraToCenterDistance(G.projection),_t),Pt=s.bL(V,W,Te),Rt=T?Pt/rt:Pt*rt,Qt=Vs(it,gt,Ft,x);if(Qt[3]<=0){Vc(Se,ae);continue}let bt={};const St=s.an(f.layers[0].layout.get("text-max-angle")),Jt=Math.cos(St),cn=T?null:Je,rn=ey(Te,Rt,!1,M,n,x,b,f.glyphOffsetArray,ue,ae,re,Qt,Xe,bt,fe,cn,G.projection,k,T,Jt);be=rn.useVertical,cn&&rn.needsFlipping&&(bt={}),(rn.notEnoughRoom||be||rn.needsFlipping&&ey(Te,Rt,!0,M,n,x,b,f.glyphOffsetArray,ue,ae,re,Qt,Xe,bt,fe,cn,G.projection,k,T,Jt).notEnoughRoom)&&Vc(Se,ae)}p?(f.text.dynamicLayoutVertexBuffer.updateData(ae),re&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(re)):(f.icon.dynamicLayoutVertexBuffer.updateData(ae),re&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(re))}function nr(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae){const{lineStartIndex:re,glyphStartIndex:ue,segment:ye}=M,fe=ue+M.numGlyphs,Ce=re+M.lineLength,be=n.getoffsetX(ue),De=n.getoffsetX(fe-1),Te=Of(f*be,a,p,x,b,T,ye,re,Ce,D,k,F,G,V,!0,W,K,J,ae);if(!Te)return null;const Se=Of(f*De,a,p,x,b,T,ye,re,Ce,D,k,F,G,V,!0,W,K,J,ae);return Se?{first:Te,last:Se}:null}function vg(f,n,a,p){return f===s.bK.horizontal&&Math.abs(p)>Math.abs(a)?{useVertical:!0}:f===s.bK.vertical?p>0?{needsFlipping:!0}:null:n!==Zo.unknown&&(function(x,b){return x===0||Math.abs(b/x)>_u})(a,p)?n===Zo.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function ey(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re,ue,ye){const fe=n/24,Ce=f.lineOffsetX*fe,be=f.lineOffsetY*fe,{lineStartIndex:De,glyphStartIndex:Te,numGlyphs:Se,segment:Pe,writingMode:Xe,flipState:Ge}=f,dt=De+f.lineLength,it=gt=>{if(F){const[_t,rt,Pt]=gt.up,Rt=k.length;s.bM(F,Rt+0,_t,rt,Pt),s.bM(F,Rt+1,_t,rt,Pt),s.bM(F,Rt+2,_t,rt,Pt),s.bM(F,Rt+3,_t,rt,Pt)}const[Ft,Je,Ve]=gt.point;s.bN(k,Ft,Je,Ve,gt.angle)};if(Se>1){const gt=nr(fe,M,Ce,be,a,G,V,f,D,b,W,J,!1,ae,re,ue,ye);if(!gt)return{notEnoughRoom:!0};if(p&&!a){let[Ft,Je,Ve]=gt.first.point,[_t,rt,Pt]=gt.last.point;[Ft,Je]=Vs(Ft,Je,Ve,T),[_t,rt]=Vs(_t,rt,Pt,T);const Rt=vg(Xe,Ge,(_t-Ft)*K,rt-Je);if(f.flipState=Rt&&Rt.needsFlipping?Zo.flipRequired:Zo.flipNotRequired,Rt)return Rt}it(gt.first);for(let Ft=Te+1;Ft<Te+Se-1;Ft++){const Je=Of(fe*M.getoffsetX(Ft),Ce,be,a,G,V,Pe,De,dt,D,b,W,J,!1,!1,ae,re,ue,ye);if(!Je)return k.length-=4*(Ft-Te),{notEnoughRoom:!0};it(Je)}it(gt.last)}else{if(p&&!a){const Ft=Vs(V.x,V.y,0,x),Je=De+Pe+1,Ve=new s.P(D.getx(Je),D.gety(Je)),_t=Vs(Ve.x,Ve.y,0,x),rt=_t[3]>0?_t:Gn(V,Ve,Ft,1,x,void 0,ae,re.canonical),Pt=vg(Xe,Ge,(rt[0]-Ft[0])*K,rt[1]-Ft[1]);if(f.flipState=Pt&&Pt.needsFlipping?Zo.flipRequired:Zo.flipNotRequired,Pt)return Pt}const gt=Of(fe*M.getoffsetX(Te),Ce,be,a,G,V,Pe,De,dt,D,b,W,J,!1,!1,ae,re,ue,ye);if(!gt)return{notEnoughRoom:!0};it(gt)}return{}}function bg(f,n,a,p,x){const{x:b,y:T,z:M}=p.projectTilePoint(f.x,f.y,n);if(!x)return Vs(b,T,M,a);const[D,k,F]=x.getElevation(f,x.elevation,x.elevationFeature);return Vs(b+D,T+k,M+F,a)}function Gn(f,n,a,p,x,b,T,M){const D=bg(f.sub(n)._unit()._add(f),M,x,T,b);return s.av(D,a,D),s.aw(D,D),s.bG(D,a,D,p)}function Of(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re,ue){const ye=p?f-n:f+n;let fe=ye>0?1:-1,Ce=0;p&&(fe*=-1,Ce=Math.PI),fe<0&&(Ce+=Math.PI);let be=M+T+(fe>0?0:1)|0,De=x,Te=x,Se=0,Pe=0;const Xe=Math.abs(ye),Ge=[],dt=[];let it=b,gt=it,Ft=s.bE([]);const Je=()=>Gn(gt,it,Te,Xe-Se+1,F,V,J,ae.canonical);for(;Se+Pe<=Xe;){if(be+=fe,be<M||be>=D)return null;if(Te=De,gt=it,Ge.push(Te),W&&dt.push(gt),it=new s.P(k.getx(be),k.gety(be)),De=G[be],!De){const cn=bg(it,ae.canonical,F,J,V);De=cn[3]>0?G[be]=cn:Je()}Se+=Pe;const St=s.av([],De,Te),Jt=s.bF(Te,De);if(a&&Jt>0&&Pe>0&&s.bI(Ft,St)/(Pe*Jt)<ue)return null;Pe=Jt,Ft=St}K&&V&&(G[be]&&(De=Je(),Pe=s.bF(Te,De),Ft=s.av([],De,Te)),G[be]=De);const Ve=(Xe-Se)/Pe,_t=it.sub(gt)._mult(Ve)._add(gt),rt=s.bG([],Te,Ft,Ve);let Pt=[0,0,1],Rt=Ft[0],Qt=Ft[1];if(re&&(Pt=J.upVector(ae.canonical,_t.x,_t.y),Pt[0]!==0||Pt[1]!==0||Pt[2]!==1)){const St=[Pt[2],0,-Pt[0]],Jt=s.bH([],Pt,St);s.aw(St,St),s.aw(Jt,Jt),Rt=s.bI(Ft,St),Qt=s.bI(Ft,Jt)}if(a){const St=s.bH([],Pt,Ft);s.aw(St,St),s.bG(rt,rt,St,a*fe)}const bt=Ce+Math.atan2(Qt,Rt);return Ge.push(rt),W&&dt.push(_t),{point:rt,angle:bt,path:Ge,tilePath:dt,up:Pt}}function Vc(f,n){const a=n.length,p=a+4*f;n.resize(p),n.float32.fill(-1/0,4*a,4*p)}function pl(f,n,a){const p=n[0],x=n[1];return f[0]=a[0]*p+a[4]*x+a[12],f[1]=a[1]*p+a[5]*x+a[13],f[3]=a[3]*p+a[7]*x+a[15],f}const Pa=100;class Eh{constructor(n,a,p=new rd(n.width+200,n.height+200,25),x=new rd(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Pa,this.screenBottomBoundary=n.height+Pa,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,p,x,b,T,M,D,k,F,G){let V=p.projectedAnchorX,W=p.projectedAnchorY,K=p.projectedAnchorZ;const J=p.tileAnchorX,ae=p.tileAnchorY,re=p.elevation,ue=p.tileID,ye=n.getProjection();if(re&&ue){const[dt,it,gt]=ye.upVector(ue.canonical,p.tileAnchorX,p.tileAnchorY),Ft=ye.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=dt*re*Ft,W+=it*re*Ft,K+=gt*re*Ft}const fe=n.projection.name==="globe",Ce=n.projection.name==="globe"?s.aj(this.transform.zoom):0;if(ue&&fe&&Ce<1&&!T){const dt=1<<ue.canonical.z,it=s.bO(J,ae);s.bP(it,it,1/s.al),s.bQ(it,it,s.bO(ue.canonical.x,ue.canonical.y)),s.bP(it,it,1/dt),s.bR(it,it,s.bO(x[0],x[1])),it[0]=s.bS(it[0],-.5,.5),s.bP(it,it,s.al);const gt=s.bT(it[0],it[1],s.al/(2*Math.PI),1);s.aC(gt,gt,b),V=s.ak(V,gt[0],Ce),W=s.ak(W,gt[1],Ce),K=s.ak(K,gt[2],Ce)}const be=this.projectAndGetPerspectiveRatio(F,V,W,K,p.tileID,ye.name==="globe"||!!re||this.transform.pitch>0,ye),De=k*be.perspectiveRatio,Te=(p.x1*a+M.x-p.padding)*De+be.point.x,Se=(p.y1*a+M.y-p.padding)*De+be.point.y,Pe=(p.x2*a+M.x+p.padding)*De+be.point.x,Xe=(p.y2*a+M.y+p.padding)*De+be.point.y,Ge=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(Te,Se,Pe,Xe)||!D&&this.grid.hitTest(Te,Se,Pe,Xe,G)||Ge?{box:[],offscreen:!1,occluded:be.occluded}:{box:[Te,Se,Pe,Xe],offscreen:this.isOffscreen(Te,Se,Pe,Xe),occluded:!1}}placeCollisionCircles(n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae){const re=[],ue=this.transform.elevation,ye=n.getProjection(),fe=n.elevationType==="road",Ce=!!ue||fe,be=s.bU.getAtTileOffsetFunc(ae,this.transform.center.lat,this.transform.worldSize,ye),De=new s.P(p.tileAnchorX,p.tileAnchorY),Te=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:Se,y:Pe,z:Xe}=ye.projectTilePoint(Te.x,Te.y,ae.canonical),Ge=null;if(Ce){const Jt=fe?n.getElevationFeatureForText(x):null;Ge={getElevation:be,elevation:ue,elevationFeature:Jt};const[cn,rn,pn]=be(De,ue,Jt);Se+=cn,Pe+=rn,Xe+=pn}const dt=ye.name==="globe",it=this.projectAndGetPerspectiveRatio(D,Se,Pe,Xe,ae,dt||!!ue||this.transform.pitch>0,ye),{perspectiveRatio:gt}=it,Ft=(V?M/gt:M*gt)/s.bX,Je=Vs(Se,Pe,Xe,k),Ve=p.lineOffsetX*Ft,_t=p.lineOffsetY*Ft,rt=s.an(n.layers[0].layout.get("text-max-angle")),Pt=Math.cos(rt),Rt=it.signedDistanceFromCamera>0?nr(Ft,T,Ve,_t,fe&&p.flipState===1,Je,Te,p,b,k,{},Ce&&!V?Ge:null,V&&Ce,ye,ae,V,Pt):null;let Qt=!1,bt=!1,St=!0;if(Rt&&!it.occluded){const Jt=.5*K*gt+J,cn=new s.P(-100,-100),rn=new s.P(this.screenRightBoundary,this.screenBottomBoundary),pn=new _g,{first:Fn,last:ui}=Rt,Jn=Fn.path.length;let Vi=[];for(let Xn=Jn-1;Xn>=1;Xn--)Vi.push(Fn.path[Xn]);for(let Xn=1;Xn<ui.path.length;Xn++)Vi.push(ui.path[Xn]);const Vn=2.5*Jt;F&&(Vi=Vi.map((([Xn,Ui,Ai],zi)=>(Ce&&!dt&&(Ai=be(zi<Jn-1?Fn.tilePath[Jn-1-zi]:ui.tilePath[zi-Jn+2],ue,Ge.elevationFeature)[2]),Vs(Xn,Ui,Ai,F)))),Vi.some((Xn=>Xn[3]<=0))&&(Vi=[]));let Mi=[];if(Vi.length>0){let Xn=1/0,Ui=-1/0,Ai=1/0,zi=-1/0;for(const Li of Vi)Xn=Math.min(Xn,Li[0]),Ai=Math.min(Ai,Li[1]),Ui=Math.max(Ui,Li[0]),zi=Math.max(zi,Li[1]);Ui>=cn.x&&Xn<=rn.x&&zi>=cn.y&&Ai<=rn.y&&(Mi=[Vi.map((Li=>new s.P(Li[0],Li[1])))],(Xn<cn.x||Ui>rn.x||Ai<cn.y||zi>rn.y)&&(Mi=s.bV(Mi,cn.x,cn.y,rn.x,rn.y)))}for(const Xn of Mi){pn.reset(Xn,.25*Jt);let Ui=0;Ui=pn.length<=.5*Jt?1:Math.ceil(pn.paddedLength/Vn)+1;for(let Ai=0;Ai<Ui;Ai++){const zi=Ai/Math.max(Ui-1,1),Li=pn.lerp(zi),ii=Li.x+Pa,qi=Li.y+Pa;re.push(ii,qi,Jt,0);const di=ii-Jt,gr=qi-Jt,Ii=ii+Jt,Pn=qi+Jt;if(St=St&&this.isOffscreen(di,gr,Ii,Pn),bt=bt||this.isInsideGrid(di,gr,Ii,Pn),!a&&this.grid.hitTestCircle(ii,qi,Jt,W)&&(Qt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Qt,occluded:!1}}}}return{circles:!G&&Qt||!bt?[]:re,offscreen:St,collisionDetected:Qt,occluded:it.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,x=1/0,b=-1/0,T=-1/0;for(const F of n){const G=new s.P(F.x+Pa,F.y+Pa);p=Math.min(p,G.x),x=Math.min(x,G.y),b=Math.max(b,G.x),T=Math.max(T,G.y),a.push(G)}const M=this.grid.query(p,x,b,T).concat(this.ignoredGrid.query(p,x,b,T)),D={},k={};for(const F of M){const G=F.key;if(D[G.bucketInstanceId]===void 0&&(D[G.bucketInstanceId]={}),D[G.bucketInstanceId][G.featureIndex])continue;const V=[new s.P(F.x1,F.y1),new s.P(F.x2,F.y1),new s.P(F.x2,F.y2),new s.P(F.x1,F.y2)];s.bW(a,V)&&(D[G.bucketInstanceId][G.featureIndex]=!0,k[G.bucketInstanceId]===void 0&&(k[G.bucketInstanceId]=[]),k[G.bucketInstanceId].push(G.featureIndex))}return k}insertCollisionBox(n,a,p,x,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,p,x,b){const T=a?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:x,collisionGroupID:b};for(let D=0;D<n.length;D+=4)T.insertCircle(M,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,a,p,x,b,T,M){const D=[a,p,x,1];let k=!1;x||this.transform.pitch>0?(s.aC(D,D,n),this.fogState&&b&&M.name!=="globe"&&(k=(function(V,W,K,J,ae,re){const ue=re.calculateFogTileMatrix(ae),ye=[W,K,J];return s.af(ye,ye,ue),Bt(V,s.ag(ye),re.pitch,re._fov)})(this.fogState,a,p,x,b.toUnwrapped(),this.transform)>.9)):pl(D,D,n);const F=D[3];return{point:new s.P((D[0]/F+1)/2*this.transform.width+Pa,(-D[1]/F+1)/2*this.transform.height+Pa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&D[2]>F||k}}isOffscreen(n,a,p,x){return p<Pa||n>=this.screenRightBoundary||x<Pa||a>this.screenBottomBoundary}isInsideGrid(n,a,p,x){return p>=0&&n<this.gridRightBoundary&&x>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.bz([]);return s.bq(n,n,[-100,-100,0]),n}}class Mn{constructor(n,a,p,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Bi{constructor(n,a,p,x,b,T=!1){this.text=new Mn(n?n.text:null,a,p,b),this.icon=new Mn(n?n.icon:null,a,x,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xi{constructor(n,a,p,x=!1){this.text=n,this.icon=a,this.skipFade=p,this.clipped=x}}class Oa{constructor(){this.invProjMatrix=s.bB(),this.viewportMatrix=s.bB(),this.circles=[]}}class Ah{constructor(n,a,p,x,b){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=b}}class sr{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[n]}}function zf(f,n,a,p,x){const{horizontalAlign:b,verticalAlign:T}=s.c0(f),M=-(b-.5)*n,D=-(T-.5)*a,k=s.c1(f,p);return new s.P(M+k[0]*x,D+k[1]*x)}function od(f,n,a,p,x){const b=new s.P(f,n);return a&&b._rotate(p?x:-x),b}class Lf{constructor(n,a,p,x,b,T){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Eh(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new sr(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,p,x,b=1){const T=p.getBucket(a),M=p.latestFeatureIndex;if(!T||!M||a.fqid!==T.layerIds[0])return;const D=T.layers[0].layout,k=T.layers[0].paint,F=p.collisionBoxArray,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/s.al,W=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const K=(J=p.tileID,ae=T.getProjection(),re=this.transform,ae.name===this.projection?re.calculateProjMatrix(J.toUnwrapped()):sc(re,ae,J));var J,ae,re;const ue=D.get("text-pitch-alignment")==="map",ye=D.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const fe=a.dynamicFilter(),Ce=a.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(p),De=Df(K,p.tileID.canonical,ue,ye,this.transform,T.getProjection(),be);let Te=null;const Se=T.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(ue){const Ve=Bc(K,p.tileID.canonical,ue,ye,this.transform,T.getProjection(),be);Te=s.aB([],this.transform.labelPlaneMatrix,Ve)}let Pe=null;fe&&p.latestFeatureIndex&&(Pe={unwrappedTileID:W,dynamicFilter:fe,dynamicFilterNeedsFeature:Ce}),this.retainedQueryData[T.bucketInstanceId]=new Ah(T.bucketInstanceId,M,T.sourceLayerIndex,T.index,p.tileID);const[Xe,Ge]=T.layers[0].layout.get("text-size-scale-range"),dt=s.aA(b,Xe,Ge),[it,gt]=D.get("icon-size-scale-range"),Ft=s.aA(b,it,gt),Je={bucket:T,layout:D,paint:k,posMatrix:K,invMatrix:Se,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:De,labelToScreenMatrix:Te,clippingData:Pe,scale:G,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:s.bJ(T.textSizeData,this.transform.zoom,dt),partiallyEvaluatedIconSize:s.bJ(T.iconSizeData,this.transform.zoom,Ft),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Ve of T.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:rt,symbolInstanceEnd:Pt}=Ve;n.push({sortKey:_t,symbolInstanceStart:rt,symbolInstanceEnd:Pt,parameters:Je})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Je})}attemptAnchorPlacement(n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re,ue,ye,fe,Ce){const{textOffset0:be,textOffset1:De,crossTileID:Te}=J,Se=[be,De],Pe=zf(n,T,M,Se,D),Xe=this.collisionIndex.placeCollisionBox(re,D,a,p,x,b,od(Pe.x,Pe.y,k,F,this.transform.angle),K,G,V,W.predicate);if(ye){const Ge=re.getSymbolInstanceIconSize(Ce,this.transform.zoom,J.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,Ge,ye,p,x,b,od(Pe.x,Pe.y,k,F,this.transform.angle),K,G,V,W.predicate).box.length===0)return}if(Xe.box.length>0){let Ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Ge=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:Se,width:T,height:M,anchor:n,textScale:D,prevAnchor:Ge},this.markUsedJustification(re,n,J,ue),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ue,J),this.placedOrientations[Te]=ue),{shift:Pe,placedGlyphBoxes:Xe}}}placeLayerBucketPart(n,a,p,x,b=1){const{bucket:T,layout:M,paint:D,posMatrix:k,textLabelPlaneMatrix:F,labelToScreenMatrix:G,clippingData:V,textPixelRatio:W,mercatorCenter:K,invMatrix:J,holdingForFade:ae,collisionBoxArray:re,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:ye,collisionGroup:fe,latestFeatureIndex:Ce}=n.parameters,be=M.get("text-optional"),De=M.get("icon-optional"),Te=M.get("text-allow-overlap"),Se=M.get("icon-allow-overlap"),Pe=M.get("text-rotation-alignment")==="map",Xe=M.get("icon-rotation-alignment")==="map",Ge=M.get("text-pitch-alignment")==="map",dt=D.get("symbol-z-offset"),it=M.get("symbol-elevation-reference")==="sea",gt=M.get("symbol-placement"),[Ft,Je]=M.get("text-size-scale-range"),[Ve,_t]=M.get("icon-size-scale-range"),rt=s.aA(b,Ft,Je),Pt=s.aA(b,Ve,_t),Rt=M.get("text-variable-anchor"),Qt=Pe&&gt!=="point",bt=Xe&&gt!=="point",St=Rt&&T.hasTextData(),Jt=T.hasIconTextFit()&&St&&T.hasIconData();this.transform.setProjection(T.projection);const cn=St||Qt,rn=bt||Jt;let pn=Te&&(Se||!T.hasIconData()||De),Fn=Se&&(Te||!T.hasTextData()||be);const ui=!dt.isConstant();!T.collisionArrays&&re&&T.deserializeCollisionBoxes(re),p&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,re,rt,Pt);const Jn=(Vn,Mi,Xn)=>{const{crossTileID:Ui,numVerticalGlyphVertices:Ai}=Vn;let zi=null;if(V&&V.dynamicFilterNeedsFeature||ui){const Er=this.retainedQueryData[T.bucketInstanceId];zi=Ce.loadFeature({featureIndex:Vn.featureIndex,bucketIndex:Er.bucketIndex,sourceLayerIndex:Er.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},zi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new s.P(Vn.tileAnchorX,Vn.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Ui]=new Xi(!1,!1,!1,!0),void a.add(Ui);const Li=dt.evaluate(zi,{});if(a.has(Ui))return;if(ae)return void(this.placements[Ui]=new Xi(!1,!1,!1));let ii=!1,qi=!1,di=!0,gr=!1,Ii=!1,Pn=null,Si={box:null,offscreen:null,occluded:null},Tr={box:null},Dr=null,Vr=null,Yr=null,ca=0,mo=0,so=0;Xn.textFeatureIndex?ca=Xn.textFeatureIndex:Vn.useRuntimeCollisionCircles&&(ca=Vn.featureIndex),Xn.verticalTextFeatureIndex&&(mo=Xn.verticalTextFeatureIndex);const ps=T.elevationFeatures?T.elevationFeatures[Vn.elevationFeatureIndex]:void 0,Ba=Er=>{Er.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const is=this.transform.elevation;Er.elevation=it?Li:Li+s.bU.getAtTileOffset(Er.tileID,new s.P(Er.tileAnchorX,Er.tileAnchorY),is,ps),Er.elevation+=Vn.zOffset},ns=Xn.textBox;if(ns){Ba(ns);const Er=ur=>{let Qr=s.bK.horizontal;if(T.allowVerticalPlacement&&!ur&&this.prevPlacement){const eo=this.prevPlacement.placedOrientations[Ui];eo&&(this.placedOrientations[Ui]=eo,Qr=eo,this.markUsedOrientation(T,Qr,Vn))}return Qr},is=(ur,Qr)=>{if(T.allowVerticalPlacement&&Ai>0&&Xn.verticalTextBox){for(const eo of T.writingModes)if(eo===s.bK.vertical?(Si=Qr(),Tr=Si):Si=ur(),Si&&Si.box&&Si.box.length)break}else Si=ur()};if(Rt){let ur=Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ui]){const Jr=this.prevPlacement.variableOffsets[Ui];ur.indexOf(Jr.anchor)>0&&(ur=ur.filter((Ua=>Ua!==Jr.anchor)),ur.unshift(Jr.anchor))}const Qr=(Jr,Ua,Ud)=>{const El=T.getSymbolInstanceTextSize(ue,Vn,this.transform.zoom,Mi),Bu=(Jr.x2-Jr.x1)*El+2*Jr.padding,of=(Jr.y2-Jr.y1)*El+2*Jr.padding,al=Vn.hasIconTextFit&&!Se?Ua:null;al&&Ba(al);let Rc={box:[],offscreen:!1,occluded:!1};const Gs=Te?2*ur.length:ur.length;for(let $a=0;$a<Gs;++$a){const Al=this.attemptAnchorPlacement(ur[$a%ur.length],Jr,K,J,cn,Bu,of,El,Pe,Ge,W,k,fe,$a>=ur.length,Vn,Mi,T,Ud,al,ue,ye);if(Al&&(Rc=Al.placedGlyphBoxes,Rc&&Rc.box&&Rc.box.length)){ii=!0,Pn=Al.shift;break}}return Rc};is((()=>Qr(ns,Xn.iconBox,s.bK.horizontal)),(()=>{const Jr=Xn.verticalTextBox;return Jr&&Ba(Jr),T.allowVerticalPlacement&&!(Si&&Si.box&&Si.box.length)&&Ai>0&&Jr?Qr(Jr,Xn.verticalIconBox,s.bK.vertical):{box:null,offscreen:null,occluded:null}})),Si&&(ii=Si.box,di=Si.offscreen,gr=Si.occluded);const eo=Er(!(!Si||!Si.box));if(!ii&&this.prevPlacement){const Jr=this.prevPlacement.variableOffsets[Ui];Jr&&(this.variableOffsets[Ui]=Jr,this.markUsedJustification(T,Jr.anchor,Vn,eo))}}else{const ur=(Qr,eo)=>{const Jr=T.getSymbolInstanceTextSize(ue,Vn,this.transform.zoom,Mi),Ua=this.collisionIndex.placeCollisionBox(T,Jr,Qr,K,J,cn,new s.P(0,0),Te,W,k,fe.predicate);return Ua&&Ua.box&&Ua.box.length&&(this.markUsedOrientation(T,eo,Vn),this.placedOrientations[Ui]=eo),Ua};is((()=>ur(ns,s.bK.horizontal)),(()=>{const Qr=Xn.verticalTextBox;return T.allowVerticalPlacement&&Ai>0&&Qr?(Ba(Qr),ur(Qr,s.bK.vertical)):{box:null,offscreen:null,occluded:null}})),Er(!!(Si&&Si.box&&Si.box.length))}}if(Dr=Si,ii=Dr&&Dr.box&&Dr.box.length>0,di=Dr&&Dr.offscreen,gr=Dr&&Dr.occluded,Vn.useRuntimeCollisionCircles){const Er=Vn.centerJustifiedTextSymbolIndex>=0?Vn.centerJustifiedTextSymbolIndex:Vn.verticalPlacedTextSymbolIndex,is=T.text.placedSymbolArray.get(Er),ur=s.bL(T.textSizeData,ue,is),Qr=M.get("text-padding");Vr=this.collisionIndex.placeCollisionCircles(T,Te,is,Er,T.lineVertexArray,T.glyphOffsetArray,ur,k,F,G,p,Ge,fe.predicate,Vn.collisionCircleDiameter*ur/s.bX,Qr,this.retainedQueryData[T.bucketInstanceId].tileID),ii=Te||Vr.circles.length>0&&!Vr.collisionDetected,di=di&&Vr.offscreen,gr=Vr.occluded}if(Xn.iconFeatureIndex&&(so=Xn.iconFeatureIndex),Xn.iconBox){const Er=is=>{Ba(is);const ur=Vn.hasIconTextFit&&Pn?od(Pn.x,Pn.y,Pe,Ge,this.transform.angle):new s.P(0,0),Qr=T.getSymbolInstanceIconSize(ye,this.transform.zoom,Vn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Qr,is,K,J,rn,ur,Se,W,k,fe.predicate)};Tr&&Tr.box&&Tr.box.length&&Xn.verticalIconBox?(Yr=Er(Xn.verticalIconBox),qi=Yr.box.length>0):(Yr=Er(Xn.iconBox),qi=Yr.box.length>0),di=di&&Yr.offscreen,Ii=Yr.occluded}const Va=be||Vn.numHorizontalGlyphVertices===0&&Ai===0,ol=De||Vn.numIconVertices===0;if(Va||ol?ol?Va||(qi=qi&&ii):ii=qi&&ii:qi=ii=qi&&ii,ii&&Dr&&Dr.box&&this.collisionIndex.insertCollisionBox(Dr.box,M.get("text-ignore-placement"),T.bucketInstanceId,Tr&&Tr.box&&mo?mo:ca,fe.ID),qi&&Yr&&this.collisionIndex.insertCollisionBox(Yr.box,M.get("icon-ignore-placement"),T.bucketInstanceId,so,fe.ID),Vr&&(ii&&this.collisionIndex.insertCollisionCircles(Vr.circles,M.get("text-ignore-placement"),T.bucketInstanceId,ca,fe.ID),p)){const Er=T.bucketInstanceId;let is=this.collisionCircleArrays[Er];is===void 0&&(is=this.collisionCircleArrays[Er]=new Oa);for(let ur=0;ur<Vr.circles.length;ur+=4)is.circles.push(Vr.circles[ur+0]),is.circles.push(Vr.circles[ur+1]),is.circles.push(Vr.circles[ur+2]),is.circles.push(Vr.collisionDetected?1:0)}const oo=T.projection.name!=="globe";pn=pn&&(oo||!gr),Fn=Fn&&(oo||!Ii),this.placements[Ui]=new Xi(ii||pn,qi||Fn,di||T.justReloaded),a.add(Ui)},Vi=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Vi),T.elevationType==="road"&&T.updateRoadElevation(Vi.canonical),T.updateZOffset(),T.sortFeaturesByY){const Vn=T.getSortedSymbolIndexes(this.transform.angle);for(let Mi=Vn.length-1;Mi>=0;--Mi){const Xn=Vn[Mi];Jn(T.symbolInstances.get(Xn),Xn,T.collisionArrays[Xn])}T.hasAnyZOffset&&s.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Vn=T.getSortedIndexesByZOffset();for(let Mi=0;Mi<Vn.length;++Mi){const Xn=Vn[Mi];Jn(T.symbolInstances.get(Xn),Xn,T.collisionArrays[Xn])}}else for(let Vn=n.symbolInstanceStart;Vn<n.symbolInstanceEnd;Vn++)Jn(T.symbolInstances.get(Vn),Vn,T.collisionArrays[Vn]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const Vn=this.collisionCircleArrays[T.bucketInstanceId];s.bk(Vn.invProjMatrix,k),Vn.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,a,p,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:D,crossTileID:k}=p,F=s.c2(a),G=x===s.bK.vertical?D:F==="left"?b:F==="center"?T:F==="right"?M:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=G>=0&&b!==G?0:k),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=G>=0&&T!==G?0:k),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=G>=0&&M!==G?0:k),D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=G>=0&&D!==G?0:k)}markUsedOrientation(n,a,p){const x=a===s.bK.horizontal||a===s.bK.horizontalOnly?a:0,b=a===s.bK.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:k}=p,F=n.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=x),M>=0&&(F.get(M).placedOrientation=x),D>=0&&(F.get(D).placedOrientation=x),k>=0&&(F.get(k).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const x=a?a.symbolFadeChange(n):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},M=a?a.placedOrientations:{};for(const D in this.placements){const k=this.placements[D],F=b[D];F?(this.opacities[D]=new Bi(F,x,k.text,k.icon,null,k.clipped),p=p||k.text!==F.text.placed||k.icon!==F.icon.placed):(this.opacities[D]=new Bi(null,x,k.text,k.icon,k.skipFade,k.clipped),p=p||k.text||k.icon)}for(const D in b){const k=b[D];if(!this.opacities[D]){const F=new Bi(k,x,!1,!1);F.isHidden()||(this.opacities[D]=F,p=p||k.text.placed||k.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in M)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=M[D]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a,p,x){const b=new Set;for(const T of a){const M=T.getBucket(n);M&&T.latestFeatureIndex&&n.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,b,T,T.collisionBoxArray,p,x,T.tileID,n.scope),M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,T.tileID),M.elevationType==="road"&&M.updateRoadElevation(T.tileID.canonical),M.updateZOffset())}}updateBucketOpacities(n,a,p,x,b,T,M,D){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const k=n.layers[0].layout,F=n.layers[0].paint,G=!!n.layers[0].dynamicFilter(),V=new Bi(null,0,!1,!1,!0),W=k.get("text-allow-overlap"),K=k.get("icon-allow-overlap"),J=k.get("text-variable-anchor"),ae=k.get("text-rotation-alignment")==="map",re=k.get("text-pitch-alignment")==="map",ue=F.get("symbol-z-offset"),ye=k.get("symbol-elevation-reference")==="sea",fe=!ue.isConstant(),Ce=new Bi(null,0,W&&(K||!n.hasIconData()||k.get("icon-optional")),K&&(W||!n.hasTextData()||k.get("text-optional")),!0);!n.collisionArrays&&x&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(x);const be=(Te,Se,Pe)=>{for(let Xe=0;Xe<Se/4;Xe++)Te.opacityVertexArray.emplaceBack(Pe)};let De=0;T&&n.updateReplacement(M,T);for(let Te=0;Te<n.symbolInstances.length;Te++){const Se=n.symbolInstances.get(Te),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:Xe,crossTileID:Ge,numIconVertices:dt,tileAnchorX:it,tileAnchorY:gt}=Se;let Ft=null;const Je=this.retainedQueryData[n.bucketInstanceId];fe&&Se&&Je&&(Ft=p.latestFeatureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:Je.bucketIndex,sourceLayerIndex:Je.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ve=ue.evaluate(Ft,{}),_t=a.has(Ge);let rt=this.opacities[Ge];_t?rt=V:rt||(rt=Ce,this.opacities[Ge]=rt),a.add(Ge);const Pt=Pe>0||Xe>0,Rt=dt>0,Qt=this.placedOrientations[Ge],bt=Qt===s.bK.vertical,St=Qt===s.bK.horizontal||Qt===s.bK.horizontalOnly;!Pt&&!Rt||rt.isHidden()||De++;let Jt=!1;if((Pt||Rt)&&T)for(const cn of n.activeReplacements){if(s.bY(cn,b,s.bZ.Symbol,D)||cn.min.x>it||it>cn.max.x||cn.min.y>gt||gt>cn.max.y)continue;const rn=s.b_(it,gt,M.canonical,cn.footprintTileId.canonical);if(Jt=s.b$(rn,cn.footprint),Jt)break}if(Pt){const cn=Jt?Ks:Ch(rt.text);be(n.text,Pe,bt?Ks:cn),be(n.text,Xe,St?Ks:cn);const rn=rt.text.isHidden(),{leftJustifiedTextSymbolIndex:pn,centerJustifiedTextSymbolIndex:Fn,rightJustifiedTextSymbolIndex:ui,verticalPlacedTextSymbolIndex:Jn}=Se,Vi=n.text.placedSymbolArray,Vn=rn||bt?1:0;pn>=0&&(Vi.get(pn).hidden=Vn),Fn>=0&&(Vi.get(Fn).hidden=Vn),ui>=0&&(Vi.get(ui).hidden=Vn),Jn>=0&&(Vi.get(Jn).hidden=rn||St?1:0);const Mi=this.variableOffsets[Ge];Mi&&this.markUsedJustification(n,Mi.anchor,Se,Qt);const Xn=this.placedOrientations[Ge];Xn&&(this.markUsedJustification(n,"left",Se,Xn),this.markUsedOrientation(n,Xn,Se))}if(Rt){const cn=Jt?Ks:Ch(rt.icon),{placedIconSymbolIndex:rn,verticalPlacedIconSymbolIndex:pn}=Se,Fn=n.icon.placedSymbolArray,ui=rt.icon.isHidden()?1:0;rn>=0&&(be(n.icon,dt,bt?Ks:cn),Fn.get(rn).hidden=ui),pn>=0&&(be(n.icon,Se.numVerticalIconVertices,St?Ks:cn),Fn.get(pn).hidden=ui)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const cn=n.collisionArrays[Te];if(cn){let rn=new s.P(0,0),pn=!0;if(cn.textBox||cn.verticalTextBox){if(J){const ui=this.variableOffsets[Ge];ui?(rn=zf(ui.anchor,ui.width,ui.height,ui.textOffset,ui.textScale),ae&&rn._rotate(re?this.transform.angle:-this.transform.angle)):pn=!1}G&&(pn=!rt.clipped),cn.textBox&&co(n.textCollisionBox.collisionVertexArray,rt.text.placed,!pn||bt,Ve,ye,rn.x,rn.y),cn.verticalTextBox&&co(n.textCollisionBox.collisionVertexArray,rt.text.placed,!pn||St,Ve,ye,rn.x,rn.y)}const Fn=pn&&!!(!St&&cn.verticalIconBox);cn.iconBox&&co(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,Fn,Ve,ye,Se.hasIconTextFit?rn.x:0,Se.hasIconTextFit?rn.y:0),cn.verticalIconBox&&co(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,!Fn,Ve,ye,Se.hasIconTextFit?rn.x:0,Se.hasIconTextFit?rn.y:0)}}}if(n.fullyClipped=De===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Te.invProjMatrix,n.placementViewportMatrix=Te.viewportMatrix,n.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function co(f,n,a,p,x,b,T){f.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,x?1:0),f.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,x?1:0),f.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,x?1:0),f.emplaceBack(n?1:0,a?1:0,b||0,T||0,p,x?1:0)}const zs=Math.pow(2,25),Yx=Math.pow(2,24),ad=Math.pow(2,17),ld=Math.pow(2,16),Nf=Math.pow(2,9),kf=Math.pow(2,8),Bp=Math.pow(2,1);function Ch(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,a=Math.floor(127*f.opacity);return a*zs+n*Yx+a*ad+n*ld+a*Nf+n*kf+a*Bp+n}const Ks=0;class oc{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,p,x,b,T){const M=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(M,x,n[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(((D,k)=>D.sortKey-k.sortKey)));this._currentPartIndex<M.length;){const D=M[this._currentPartIndex];if(a.placeLayerBucketPart(D,this._seenCrossTileIDs,p,D.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class uo{constructor(n,a,p,x,b,T,M,D,k){this.placement=new Lf(n,b,T,M,D,k),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,a,p,x,b){const T=s.o.now(),M=()=>{const D=s.o.now()-T;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=a[n[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=k)&&(!D.maxzoom||D.maxzoom>k)){const F=D,G=F.layout.get("symbol-z-elevate"),V=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,W=F.layout.get("symbol-z-order"),K=W==="viewport-y"||W==="auto"&&!(W!=="viewport-y"&&V),J=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ae=K&&J,re=this._inProgressLayer=this._inProgressLayer||new oc(F),ue=s.B(D.source,D.scope);if(re.continuePlacement(G||ae?x[ue]:p[ue],this.placement,this._showCollisionBoxes,D,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Vp=512/s.al/2;class Rh{constructor(n,a,p){this.tileID=n,this.bucketInstanceId=p,this.index=new s.c3(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*s.al,b=n.canonical.y*s.al;for(let T=0;T<a.length;T++){const{key:M,crossTileID:D,tileAnchorX:k,tileAnchorY:F}=a.get(T),G=Math.floor((x+k)*Vp),V=Math.floor((b+F)*Vp);this.index.add(G,V),this.keys.push(M),this.crossTileIDs.push(D)}this.index.finish()}findMatches(n,a,p){const x=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Vp/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*s.al,M=a.canonical.y*s.al;for(let D=0;D<n.length;D++){const k=n.get(D);if(k.crossTileID)continue;const{key:F,tileAnchorX:G,tileAnchorY:V}=k,W=Math.floor((T+G)*b),K=Math.floor((M+V)*b),J=this.index.range(W-x,K-x,W+x,K+x).sort(((ae,re)=>ae-re));for(const ae of J){const re=this.crossTileIDs[ae];if(this.keys[ae]===F&&!p.has(re)){p.add(re),k.crossTileID=re;break}}}}}class Ys{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const p in this.indexes){const x=this.indexes[p],b={};for(const T in x){const M=x[T];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+a),b[M.tileID.key]=M}this.indexes[p]=b}this.lng=n}addBucket(n,a,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>n.overscaledZ)for(const M in T){const D=T[M];D.tileID.isChildOf(n)&&D.findMatches(a.symbolInstances,n,x)}else{const M=T[n.scaledTo(Number(b)).key];M&&M.findMatches(a.symbolInstances,n,x)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=p.generate(),x.add(T.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Rh(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const p of a.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let a=!1;for(const p in this.indexes){const x=this.indexes[p];for(const b in x)n[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[b]),delete x[b],a=!0)}return a}}class ac{constructor(){this.layerIndexes={},this.crossTileIDs=new Ys,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,p,x){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new kl);let T=!1;const M={};x.name!=="globe"&&b.handleWrapJump(p);for(const D of a){const k=D.getBucket(n);k&&n.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,k,this.crossTileIDs)&&(T=!0),M[k.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(T=!0),T}pruneUnusedLayers(n){const a={};n.forEach((p=>{a[p]=!0}));for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const es=771;class si{constructor(n,a,p,x){this.blendFunction=n,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}si.Replace=[1,0,1,0],si.disabled=new si(si.Replace,s.ao.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,s.ao.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,es,1,es],s.ao.transparent,[!0,!0,!0,!0]),si.alphaBlendedNonPremultiplied=new si([770,es,770,es],s.ao.transparent,[!0,!0,!0,!0]),si.multiply=new si([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),si.additive=new si([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class wn{constructor(n,a,p){this.func=n,this.mask=a,this.range=p}}wn.ReadOnly=!1,wn.ReadWrite=!0,wn.disabled=new wn(519,wn.ReadOnly,[0,1]);const lc=7680;class Yn{constructor(n,a,p,x,b,T){this.test=n,this.ref=a,this.mask=p,this.fail=x,this.depthFail=b,this.pass=T}}Yn.disabled=new Yn({func:519,mask:0},0,0,lc,lc,lc);const cd=1029,Mh=2305;class Hn{constructor(n,a,p){this.enable=n,this.mode=a,this.frontFace=p}}function Ih(f,n){const a=s.c9(f,3);s.cb(f,n),s.cf(f,3,a)}function jf(f,n){const a=s.c6([]);return s.c7(a,a,-n),s.c8(a,a,-f),a}function wg(f,n){const a=[f[0],f[1],0],p=[n[0],n[1],0];if(s.ag(a)>=1e-15){const T=s.aw([],a);s.c4(p,T,s.bI(p,T)),n[0]=p[0],n[1]=p[1]}const x=s.bH([],n,f);if(s.c5(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return jf(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}Hn.disabled=new Hn(!1,cd,Mh),Hn.backCCW=new Hn(!0,cd,Mh),Hn.backCW=new Hn(!0,cd,2304),Hn.frontCW=new Hn(!0,1028,2304),Hn.frontCCW=new Hn(!0,1028,Mh);class cc{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.ae?n:new s.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.bS(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a,p){if(this.orientation=null,!this.position)return;const x=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(n)):0),T=s.ae.fromLngLat(n,b),M=[T.x-x.x,T.y-x.y,T.z-x.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=wg(M,a)}setPitchBearing(n,a){this.orientation=jf(s.an(n),s.an(-a))}}class Up{constructor(n,a){this._transform=s.bz([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.ae(n[0],n[1],n[2])}get position(){const n=s.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.cf(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.c6([]),n&&Ih(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=jf(n,a),Ih(this._transform,this._orientation)}forward(){const n=s.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const p=new Float64Array(16);return s.bk(p,this.getWorldToCamera(n,a)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,p){const x=this.position;s.c4(x,x,-n);const b=new Float64Array(16);return s.bp(b,[p,p,p]),s.bq(b,b,x),b[10]*=a,b}getWorldToCamera(n,a){const p=new Float64Array(16),x=new Float64Array(4),b=this.position;return s.ca(x,this._orientation),s.c4(b,b,-n),s.cb(p,x),s.bq(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(n,a,p,x){const b=new Float64Array(16);return s.cc(b,n,a,p,x),b}getCameraToClipOrthographic(n,a,p,x,b,T){const M=new Float64Array(16);return s.cd(M,n,a,p,x,b,T),M}getDistanceToElevation(n,a=!1){const p=n===0?0:s.ce(n,a?s.a_(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Up([...this.position],[...this.orientation])}}const ho={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Wo{constructor(n=0,a=0,p=0,x=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=p,this.right=x}interpolate(n,a,p){return a.top!=null&&n.top!=null&&(this.top=s.ak(n.top,a.top,p)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.ak(n.bottom,a.bottom,p)),a.left!=null&&n.left!=null&&(this.left=s.ak(n.left,a.left,p)),a.right!=null&&n.right!=null&&(this.right=s.ak(n.right,a.right,p)),this}getCenter(n,a){const p=s.aA((this.left+n-this.right)/2,0,n),x=s.aA((this.top+a-this.bottom)/2,0,a);return new s.P(p,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Wo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ud=15;class No{constructor(n,a,p,x,b,T,M){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new s.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Up,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new No(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ud}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.cl(this.projectionOptions);const p=this.getProjection(),x=!s.bx(a,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cl({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bS(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=s.cm(),s.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,b=0;for(let T=0;T<a.length;T++){const M=new s.P(a[T][0]*this.width,p+a[T][1]*(this.height-p)),D=n.pointCoordinate(M);if(!D)continue;const k=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);x+=D[3]*k,b+=k}return b===0?NaN:x/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*a,x=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-p,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const x=s.ag(s.av([],this._camera.position,p));return s.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.co(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.cp(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new cc;return a.position=new s.ae(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.cq(n))return!1;s.cr(n,n);const a=s.cs([],[0,0,-1],n),p=s.cs([],[0,-1,0],n);if(p[2]<0)return!1;const x=wg(a,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=s.aA(n[2],x/p,x/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,p){this._unmodified=!1,this._edgeInsets.interpolate(n,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.ct(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),T=this.pointCoordinate(new s.P(0,this.height)),M=Math.floor(Math.min(p.x,x.x,b.x,T.x)),D=Math.floor(Math.max(p.x,x.x,b.x,T.x)),k=1;for(let F=M-k;F<=D+k;F++)F!==0&&a.push(new s.ct(F,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,a,p){let x=[];const b=p!=null,T=!b;if(T&&this.zoom<a||b&&p[0]===0&&p[1]===0)return x;const M=new Set,D=(F,G,V,W,K)=>{const J=s.cX(G,F,V,W,K);M.has(J)||(x.push(new s.aP(F,G,V,W,K)),M.add(J))};for(let F=0;F<n.length;F++){const G=n[F];if(T&&G.canonical.z!==a)continue;const V=G.canonical,W=G.overscaledZ,K=G.wrap,J=1<<V.z,ae=V.x+1<J,re=V.x>0,ue=V.y+1<J,ye=V.y>0,fe=G.wrap-(re?0:1),Ce=G.wrap+(ae?0:1),be=re?V.x-1:J-1,De=ae?V.x+1:0;if(b)p[0]<0?(D(W,Ce,V.z,De,V.y),p[1]<0&&ue&&(D(W,K,V.z,V.x,V.y+1),D(W,Ce,V.z,De,V.y+1)),p[1]>0&&ye&&(D(W,K,V.z,V.x,V.y-1),D(W,Ce,V.z,De,V.y-1))):p[0]>0?(D(W,fe,V.z,be,V.y),p[1]<0&&ue&&(D(W,K,V.z,V.x,V.y+1),D(W,fe,V.z,be,V.y+1)),p[1]>0&&ye&&(D(W,K,V.z,V.x,V.y-1),D(W,fe,V.z,be,V.y-1))):p[1]<0&&ue?D(W,K,V.z,V.x,V.y+1):ye&&D(W,K,V.z,V.x,V.y-1);else{const Te=G.visibleQuadrants;1&Te&&(D(W,fe,V.z,be,V.y),ye&&(D(W,K,V.z,V.x,V.y-1),D(W,fe,V.z,be,V.y-1))),2&Te&&(D(W,Ce,V.z,De,V.y),ye&&(D(W,K,V.z,V.x,V.y-1),D(W,Ce,V.z,De,V.y-1))),4&Te&&(D(W,fe,V.z,be,V.y),ue&&(D(W,K,V.z,V.x,V.y+1),D(W,fe,V.z,be,V.y+1))),8&Te&&(D(W,Ce,V.z,De,V.y),ue&&(D(W,K,V.z,V.x,V.y+1),D(W,Ce,V.z,De,V.y+1)))}}const k=[];for(const F of x)x.some((G=>F.isChildOf(G)))||k.push(F);if(x=k.filter((F=>!n.some((G=>!!(F.overscaledZ<a&&G.isChildOf(F))||F.equals(G)||F.isChildOf(G))))),T){const F=1<<a,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[F*G.x,F*G.y],W=4,K=W*W;x=x.filter((J=>{const ae=J.canonical.x+.5-V[0],re=J.canonical.y+.5-V[1];return ae*ae+re*re<K}))}return x}extendTileCoverToNearPlane(n,a,p){const x=[],b=new Set;for(const ue of n)b.add(ue.key);const T=(ue,ye,fe,Ce,be)=>{const De=s.cX(ye,ue,fe,Ce,be);b.has(De)||(x.push(new s.aP(ue,ye,fe,Ce,be)),b.add(De))},M=n.reduce(((ue,ye)=>Math.max(ue,ye.overscaledZ)),p),D=1<<p,k=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],F=new s.P(0,0),G=new s.P(0,0),V=(ue,ye)=>{const fe=Math.floor(ue[0]),Ce=Math.floor(ue[1]),be=(ue[0]-fe)*s.al,De=(ue[1]-Ce)*s.al,Te=Math.floor(ye[0]),Se=Math.floor(ye[1]),Pe=(ye[0]-Te)*s.al,Xe=(ye[1]-Se)*s.al;for(let Ge=-1;Ge<=1;Ge++){const dt=fe+Ge;if(!(dt<0||dt>=D)){F.x=be-Ge*s.al,G.x=Pe-(dt-Te)*s.al;for(let it=-1;it<=1;it++){const gt=Ce+it;F.y=De-it*s.al,G.y=Xe-(gt-Se)*s.al,s.cY(F,G,k)&&T(M,0,p,dt,gt)}}}},W=a.points,K=W[s.cu],J=W[s.cv],ae=this._projectToGround(K,W[s.cw]),re=this._projectToGround(J,W[s.cx]);return V(K,ae),V(J,re),x}_projectToGround(n,a){return s.cy(s.cz(),n,a,n[2]/(n[2]-a[2]))}coveringTiles(n){let a=this.coveringZoomLevel(n);const p=a,x=this.elevation&&this.elevation.exaggeration(),b=x&&!n.isTerrainDEM,T=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const M=this.locationCoordinate(this.center),D=this.center.lat,k=1<<a,F=[k*M.x,k*M.y,0],G=this.projection.name==="globe",V=!G,W=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,V),K=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=k*s.ce(1,this.center.lat),ae=this._camera.position[2]/s.ce(1,this.center.lat),re=[k*K.x,k*K.y,ae*(V?1:J)],ue=G||x,ye=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),fe=this.isLODDisabled(!0)?a:0;let Ce;if(this._elevation&&n.isTerrainDEM)Ce=1e4*this._elevation.exaggeration();else if(this._elevation){const Ve=this._elevation.getMinMaxForVisibleTiles();Ce=Ve?Ve.max:this._centerAltitude}else Ce=this._centerAltitude;const be=n.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,De=this.projection.isReprojectedInTileSpace?s.cB(this):1,Te=Ve=>{const rt=new s.ae(Ve.x+25e-6,Ve.y,Ve.z),Pt=new s.ae(Ve.x,Ve.y+25e-6,Ve.z),Rt=Ve.toLngLat(),Qt=rt.toLngLat(),bt=Pt.toLngLat(),St=this.locationCoordinate(Rt),Jt=this.locationCoordinate(Qt),cn=this.locationCoordinate(bt),rn=Math.hypot(Jt.x-St.x,Jt.y-St.y),pn=Math.hypot(cn.x-St.x,cn.y-St.y);return Math.sqrt(rn*pn)*De/25e-6},Se=Ve=>{const _t=Ce,rt=be;return{aabb:s.cE(this,k,0,0,0,Ve,rt,_t,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:_t,wrap:Ve,fullyVisible:!1}},Pe=[];let Xe=[];const Ge=a,dt=n.reparseOverscaled?p:a,it=(ae-this._centerAltitude)*J,gt=Ve=>{if(!this._elevation||!Ve.tileID||!T)return;const _t=this._elevation.getMinMaxForTile(Ve.tileID),rt=Ve.aabb;_t?(rt.min[2]=_t.min,rt.max[2]=_t.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Ve.shouldSplit=Je(Ve),Ve.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},Ft=(Ve,_t)=>{if(.707*_t<Ve)return 1;const rt=_t/Ve;return rt/(1.4144271570014144+(Math.pow(1.1,rt-1.4144271570014144+1)-1)/(1.1-1)-1)},Je=Ve=>{if(Ve.zoom<fe)return!0;if(Ve.zoom===Ge)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;const _t=Ve.aabb.distanceX(re),rt=Ve.aabb.distanceY(re);let Pt=it,Rt=1;if(G){Pt=Ve.aabb.distanceZ(re);const pn=Math.pow(2,Ve.zoom),Fn=s.a_((Ve.y+1)/pn),ui=s.a_(Ve.y/pn),Jn=Math.min(Math.max(D,Fn),ui),Vi=s.d0(Jn)/s.d0(D);if(Rt=Jn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vi/this._mercatorScaleRatio),this.zoom<=s.cZ&&Ve.zoom===Ge-1&&Vi>=.9)return!0}else if(b&&(Pt=Ve.aabb.distanceZ(re)*J),this.projection.isReprojectedInTileSpace&&p<=5){const pn=Math.pow(2,Ve.zoom),Fn=Te(new s.ae((Ve.x+.5)/pn,(Ve.y+.5)/pn));Rt=Fn>.85?1:Fn}if(!T&&!G){const pn=Math.sqrt(_t*_t+rt*rt+Pt*Pt);let Fn=(1<<Ge-Ve.zoom)*ye*Rt;return Fn*=Ft(Math.max(Pt,it),pn),pn<Fn}let Qt=Number.MAX_VALUE,bt=0;const St=Ve.aabb.getCorners(),Jt=[];for(const pn of St){s.av(Jt,pn,re),G||(b?Jt[2]*=J:Jt[2]=it);const Fn=s.bI(Jt,this._camera.forward());Fn<Qt&&(Qt=Fn,bt=Math.abs(Jt[2]))}let cn=(1<<Ge-Ve.zoom)*ye*Rt;if(cn*=Ft(Math.max(bt,it),Qt),Qt<cn)return!0;const rn=Ve.aabb.closestPoint(F);return rn[0]===F[0]&&rn[1]===F[1]};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)Pe.push(Se(-Ve)),Pe.push(Se(Ve));for(Pe.push(Se(0));Pe.length>0;){const Ve=Pe.pop(),_t=Ve.x,rt=Ve.y;let Pt=Ve.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(Ve.y===0||Ve.y===(1<<Ve.zoom)-1);if(!Pt){let Qt=ue?Ve.aabb.intersects(W):Ve.aabb.intersectsFlat(W);if(Qt===0&&Rt()){const bt=new s.cC(Ve.zoom,_t,rt);Qt=s.cD(this,k,bt,!0).intersects(W)}if(Qt===0)continue;Pt=Qt===2}if(Ve.zoom!==Ge&&Je(Ve))for(let Qt=0;Qt<4;Qt++){const bt=(_t<<1)+Qt%2,St=(rt<<1)+(Qt>>1),Jt={aabb:T?Ve.aabb.quadrant(Qt):s.cE(this,k,Ve.zoom+1,bt,St,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:bt,y:St,wrap:Ve.wrap,fullyVisible:Pt,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};b&&!G&&(Jt.tileID=new s.aP(Ve.zoom+1===Ge?dt:Ve.zoom+1,Ve.wrap,Ve.zoom+1,bt,St),gt(Jt)),Pe.push(Jt)}else{const Qt=Ve.zoom===Ge?dt:Ve.zoom;if(n.minzoom&&n.minzoom>Qt)continue;let bt=0;if(!Pt){let rn=ue?Ve.aabb.intersectsPrecise(W):Ve.aabb.intersectsPreciseFlat(W);if(rn===0&&Rt()){const pn=new s.cC(Ve.zoom,_t,rt);rn=s.cD(this,k,pn,!0).intersectsPrecise(W)}if(rn===0)continue;if(n.calculateQuadrantVisibility)if(W.containsPoint(Ve.aabb.center))bt=15;else for(let pn=0;pn<4;pn++)Ve.aabb.quadrant(pn).intersects(W)!==0&&(bt|=1<<pn)}const St=F[0]-(.5+_t+(Ve.wrap<<Ve.zoom))*(1<<a-Ve.zoom),Jt=F[1]-.5-rt,cn=Ve.tileID?Ve.tileID:new s.aP(Qt,Ve.wrap,Ve.zoom,_t,rt);n.calculateQuadrantVisibility&&(cn.visibleQuadrants=bt),Xe.push({tileID:cn,distanceSq:St*St+Jt*Jt})}}if(this.fogCullDistSq){const Ve=this.fogCullDistSq,_t=this.horizonLineFromTop();Xe=Xe.filter((rt=>{const Pt=[0,0,0,1],Rt=[s.al,s.al,0,1],Qt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());s.aC(Pt,Pt,Qt),s.aC(Rt,Rt,Qt);const bt=s.cF([],Pt,Rt),St=s.cG([],Pt,Rt),Jt=s.c_(bt,St);if(Jt===0)return!0;let cn=!1;const rn=this._elevation;if(rn&&Jt>Ve&&_t!==0){const pn=this.calculateProjMatrix(rt.tileID.toUnwrapped());let Fn;n.isTerrainDEM||(Fn=rn.getMinMaxForTile(rt.tileID)),Fn||(Fn={min:be,max:Ce});const ui=s.cH(this.rotation),Jn=[ui[0]*s.al,ui[1]*s.al,Fn.max];s.af(Jn,Jn,pn),cn=(1-Jn[1])*this.height*.5<_t}return Jt<Ve||cn}))}return Xe.sort(((Ve,_t)=>Ve.distanceSq-_t.distanceSq)).map((Ve=>Ve.tileID))}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const a=s.aA(n.lat,-s.cI,s.cI),p=this.projection.project(n.lng,a);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let p,x;const b=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;p=(a.x-b.x)/M,x=(a.y-b.y)/M}else{const M=this.pointCoordinate(a),D=this.pointCoordinate(b);p=M.x-D.x,x=M.y-D.y}const T=this.locationCoordinate(n);this.setLocation(new s.ae(T.x-p,T.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,a){return this.projection.locationPoint(this,n,a)}locationPoint3D(n,a){return this.projection.locationPoint(this,n,a,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,a){return this.coordinateLocation(this.pointCoordinate3D(n,a))}locationCoordinate(n,a){const p=a?s.ce(a,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new s.ae(x.x,x.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const p=a??this._centerAltitude,x=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.aC(x,x,this.pixelMatrixInverse),s.aC(b,b,this.pixelMatrixInverse);const T=b[3];s.cJ(x,x,1/x[3]),s.cJ(b,b,1/T);const M=x[2],D=b[2];return{p0:x,p1:b,t:M===D?0:(p-M)/(D-M)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.aC(a,a,this.pixelMatrixInverse),s.aC(p,p,this.pixelMatrixInverse),s.cJ(a,a,1/a[3]),s.cJ(p,p,1/p[3]),a[2]=s.ce(a[2],this._center.lat)*this.worldSize,p[2]=s.ce(p[2],this._center.lat)*this.worldSize,s.cJ(a,a,1/this.worldSize),s.cJ(p,p,1/this.worldSize),new s.ax([a[0],a[1],a[2]],s.aw([],s.av([],p,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:p,t:x}=n,b=s.ce(a[2],this._center.lat),T=s.ce(p[2],this._center.lat);return new s.ae(s.ak(a[0],p[0],x)/this.worldSize,s.ak(a[1],p[1],x)/this.worldSize,s.ak(b,T,x))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n,a){if(!this.elevation)return this.pointCoordinate(n,a);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new s.ae(p[0],p[1],p[2]);let x=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,a);const T=.02*b,M=n.clone();for(let D=0;D<10&&b-x>T;D++){M.y=s.ak(x,b,.66);const k=this.projection.pointCoordinate3D(this,M.x,M.y);k?(b=M.y,p=k):x=M.y}return p?new s.ae(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cK)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.aC(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(a,n)),T=this.pointLocation3D(new s.P(x,n)),M=this.pointLocation3D(new s.P(x,p)),D=this.pointLocation3D(new s.P(a,p));let k=Math.min(b.lng,T.lng,M.lng,D.lng),F=Math.max(b.lng,T.lng,M.lng,D.lng),G=Math.min(b.lat,T.lat,M.lat,D.lat),V=Math.max(b.lat,T.lat,M.lat,D.lat);const W=Math.pow(2,-this.zoom)/16*270,K=this.projection.name==="globe"?1:4,J=(ae,re,ue,ye,fe)=>{const Ce=(ae+ue)/2,be=(re+ye)/2,De=new s.P(Ce,be),{lng:Te,lat:Se}=this.pointLocation3D(De),Pe=Math.max(0,k-Te,G-Se,Te-F,Se-V);k=Math.min(k,Te),F=Math.max(F,Te),G=Math.min(G,Se),V=Math.max(V,Se),(fe<K||Pe>W)&&(J(ae,re,Ce,be,fe+1),J(Ce,be,ue,ye,fe+1))};if(J(a,n,x,n,1),J(x,n,x,p,1),J(x,p,a,p,1),J(a,p,a,n,1),this.projection.name==="globe"){const[ae,re]=s.cL(this);ae?(V=90,F=180,k=-180):re&&(G=-90,F=180,k=-180)}return new s.aI(new s.aS(k,G),new s.aS(F,V))}_getBoundsRectangular(n,a){const{top:p,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,M=new s.P(x,p),D=new s.P(T,p),k=new s.P(T,b),F=new s.P(x,b);let G=this.pointCoordinate(M,n),V=this.pointCoordinate(D,n);const W=this.pointCoordinate(k,a),K=this.pointCoordinate(F,a),J=(ae,re)=>(re.y-ae.y)/(re.x-ae.x);return G.y>1&&V.y>=0?G=new s.ae((1-K.y)/J(K,G)+K.x,1):G.y<0&&V.y<=1&&(G=new s.ae(-K.y/J(K,G)+K.x,0)),V.y>1&&G.y>=0?V=new s.ae((1-W.y)/J(W,V)+W.x,1):V.y<0&&G.y<=1&&(V=new s.ae(-W.y/J(W,V)+W.x,0)),new s.aI().extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce(((p,x)=>{if(x.dem){const b=x.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.cI,this.maxLat=s.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,p=this._distanceTileDataCache;if(p[a])return p[a];const x=n.canonical,b=1/this.height,T=this.cameraWorldSize,M=T/this.zoomScale(x.z),D=(x.x+Math.pow(2,x.z)*n.wrap)*M,k=x.y*M,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const G=this.angle,V=Math.sin(-G),W=-Math.cos(-G);return p[a]={bearing:[V,W],center:[(F.x-D)*b,(F.y-k)*b],scale:M/s.al*b},p[a]}calculateFogTileMatrix(n){const a=n.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.aB(x,this.worldToFogMatrix,x),p[a]=new Float32Array(x),p[a]}calculateProjMatrix(n,a=!1,p=!1){const x=n.key;let b;if(b=p?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const T=this.calculatePosMatrix(n,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,s.aB(T,M,T),b[x]=new Float32Array(T),b[x]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const x=s.cM(n,this);return p[a]=x,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=s.bp([],[n,n,n]);return s.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),x=this._camera.forward(),b=s.ce(1,this._center.lat);p[2]/=b,x[2]/=b,s.aw(x,x);const T=n.raycast(p,x,n.exaggeration());if(T){const M=s.bG([],p,x,T),D=new s.ae(M[0],M[1],s.ce(M[2],s.a_(M[1]))),k=(D.z+s.ag([D.x-p[0],D.y-p[1],D.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,p=s.ce(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),b=a.getAtPointOrZero(new s.ae(...x)),T=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),D=x[2]-T;if(D<=M)if(D<0||n){const k=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],k.z-x[2]],G=s.ag(F);F[2]-=(M-D)/this._pixelsPerMercatorPixel;const V=s.ag(F);if(V===0)return;s.c4(F,F,G/V*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],k.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const V=this.center;return V.lat=s.aA(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(V.lng=s.aA(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const a=this._unmodified,{x:p,y:x}=this.point;let b=0,T=p,M=x;const D=this.width/2,k=this.height/2,F=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(x-k<F&&(M=F+k),x+k>G&&(M=G-k),G-F<this.height&&(b=Math.max(b,this.height/(G-F)),M=(G+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,K=this.worldSize/2-(V+W)/2;T=(p+K+this.worldSize)%this.worldSize-K,T-D<V&&(T=V+D),T+D>W&&(T=W-D),W-V<this.width&&(b=Math.max(b,this.width/(W-V)),T=(W+V)/2)}T===p&&M===x||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(T,M))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.ce(1,this.center.lat)/s.ce(1,s.d1));const x=s.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,b);let M;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-n.x/this.width,D[9]=2*n.y/this.height,this.isOrthographic){let Se=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pe=Se*this.aspect,Xe=-Pe,Ge=-Se;Pe-=n.x,Xe-=n.x,Se+=n.y,Ge+=n.y,M=this._camera.getCameraToClipOrthographic(Xe,Pe,Ge,Se,this._nearZ,this._farZ),((dt,it,gt,Ft)=>{for(let Je=0;Je<16;Je++)dt[Je]=s.ak(it[Je],gt[Je],Ft)})(M,M,D,s.c$(this.pitch>=ud?1:this.pitch/ud))}else M=D;const k=s.cO([],D,T);let F=s.cO([],M,T);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Pe=s.bz([]);s.bq(Pe,Pe,[Se.x*this.worldSize,Se.y*this.worldSize,0]),s.aB(Pe,Pe,s.cP(this)),s.bq(Pe,Pe,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),s.aB(F,F,Pe),s.aB(k,k,Pe),this.inverseAdjustmentMatrix=s.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cR([],F,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=F,this.invProjMatrix=s.bk(new Float64Array(16),this.projMatrix),a){const Se=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Se[8]=2*-n.x/this.width,Se[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cO([],Se,T)}else this.expandedFarZProjMatrix=this.projMatrix;const G=s.bk([],M);this.frustumCorners=s.cS.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const V=new Float32Array(16);s.bz(V),s.cR(V,V,[1,-1,1]),s.cT(V,V,this._pitch),s.bA(V,V,this.angle);const W=s.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.by(W);const K=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-n.x/this.width,W[9]=2*(n.y+K)/this.height,this.skyboxMatrix=s.aB(V,W,V);const J=this.point,ae=J.x,re=J.y,ue=this.width%2/2,ye=this.height%2/2,fe=Math.cos(this.angle),Ce=Math.sin(this.angle),be=ae-Math.round(ae)+fe*ue+Ce*ye,De=re-Math.round(re)+fe*ye+Ce*ue,Te=new Float64Array(F);if(s.bq(Te,Te,[be>.5?be-1:be,De>.5?De-1:De,0]),this.alignedProjMatrix=Te,F=s.bB(),s.cR(F,F,[this.width/2,-this.height/2,1]),s.bq(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=s.bB(),s.cR(F,F,[1,-1,1]),s.bq(F,F,[-1,-1,0]),s.cR(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},F=s.bk(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cU(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(Se,Se,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,a];s.c4(b,b,x),s.c4(p,p,-1),s.cV(p,p,b);const T=s.bB();s.bq(T,T,p),s.cR(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,x)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*b,x.y/this.worldSize-p[1]*b,n/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((a-p)/x,1)),this._camera.position=s.bG([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),b=s.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),M=Math.max((n[2]-b)/Math.cos(p),T),D=this._zoomFromMercatorZ(M);s.bG(n,n,a,M),this._pitch=s.aA(p,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bS(x,-Math.PI,Math.PI),this._setZoom(s.aA(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,p=s.cK,x=0,b=1/0;for(;p-a>1e-6&&p>a;){const T=a+.5*(p-a),M=this.tileSize*Math.pow(2,T),D=this.getCameraToCenterDistance(this.projection,T,M),k=this.scaleZoom(D/(Math.max(0,n)*this.tileSize)),F=Math.abs(T-k);F<b&&(b=F,x=T),T<k?a=T:p=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const p=Math.min(n.x,a.x),x=Math.max(n.x,a.x),b=Math.min(n.y,a.y),T=Math.max(n.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new s.P(p,b),new s.P(x,T),new s.P(p,T),new s.P(x,b)],D=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const F of M){const G=this.pointRayIntersection(F);if(G.t<0)return!0;const V=this.rayIntersectionCoordinate(G);if(V.x<D||V.y<0||V.x>k||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,a){const p=s.ag(s.av([],this._camera.position,n)),x=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([a,p,x],b){const T=[a,p,x,1];s.aC(T,T,b);const M=T[3]=Math.max(T[3],1e-6);return T[0]/=M,T[1]/=M,T[2]/=M,T})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,p=this.worldSize){const x=s.cN(n,a,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,p,x);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=s.ak(1,T,s.c$(this.pitch>=ud?1:this.pitch/ud))),T}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(n,n,this.globeMatrix),n}getFrustum(n){return s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Qa=(f,n)=>{if(n>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=f.transform,p=Math.max(Math.abs(a._zoom-(f.minCutoffZoom-1)),1),x=a.isLODDisabled(!1)?s.ah(60,45,a.pitch):s.ah(30,15,a.pitch),b=a._farZ-a._nearZ,T=n*a.height,M=((1-(D=x))*a.cameraToCenterDistance+D*(a._farZ+T))*p;var D;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(M-a._nearZ)/b,(M-T-a._nearZ)/b]}}},io={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ty{constructor(n,a){this.aabb=n,this.lastCascade=a}}class ny{add(n,a){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],a.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],a.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],a.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],a.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],a.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],a.max[2])):this.receivers[n.key]=new ty(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,p){const x=s.d8.fromPoints(n.points);let b=0;for(const T in this.receivers){const M=this.receivers[T];if(!M||!x.intersectsAabb(M.aabb))continue;M.aabb.min=x.closestPoint(M.aabb.min),M.aabb.max=x.closestPoint(M.aabb.max);const D=M.aabb.getCorners();for(let k=0;k<p.length;k++){let F=!0;for(const G of D){const V=[G[0]*a,G[1]*a,G[2]];if(s.af(V,V,p[k].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){F=!1;break}}if(M.lastCascade=k,b=Math.max(b,k),F)break}}return b+1}}class Dh{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ny,this._depthMode=new wn(n.context.gl.LEQUAL,wn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),n.tp.registerParameter(io,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(io,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(io,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const x=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce(((K,J)=>{const ae=p.style._mergedLayers[J];return K+(ae.hasShadowPass()&&!ae.isHidden(n.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,T=io.shadowMapResolution,M=io.shadowMapResolution;if(this._cascades.length===0||io.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let K=0;K<io.cascadeCount;++K){const J=p._shadowMapDebug,ae=b.gl,re=b.createFramebuffer(T,M,J,"texture"),ue=new s.T(b,{width:T,height:M,data:null},ae.DEPTH_COMPONENT16);if(re.depthAttachment.set(ue.texture),J){const ye=new s.T(b,{width:T,height:M,data:null},ae.RGBA8);re.colorAttachment.set(ye.texture)}this._cascades.push({framebuffer:re,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cA,scale:0})}}this.shadowDirection=iy(a);let D=0;if(n.elevation){const K=n.elevation,J=[1e4,-1e4];K.visibleDemTiles.filter((ae=>ae.dem)).forEach((ae=>{const re=ae.dem.tree;J[0]=Math.min(J[0],re.minimums[0]),J[1]=Math.max(J[1],re.maximums[0])})),J[0]!==1e4&&(D=(J[1]-J[0])*K.exaggeration())}const k=1.5*n.cameraToCenterDistance,F=3*k,G=new Float64Array(16);for(let K=0;K<this._cascades.length;++K){const J=this._cascades[K];let ae=n.height/50,re=1;io.cascadeCount===1?re=F:K===0?re=k:(ae=k,re=F);const[ue,ye]=$p(n,this.shadowDirection,ae,re,io.shadowMapResolution,D);J.scale=n.scale,J.matrix=ue,J.boundingSphereRadius=ye,s.bk(G,J.matrix),J.frustum=s.cA.fromInvProjectionMatrix(G,1,0,!0),J.far=re}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/io.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=io.shadowMapResolution,this._uniformValues.u_shadowmap_0=ho.ShadowMap0,this._uniformValues.u_shadowmap_1=ho.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=p.transform.elevation;for(const K of this._groundShadowTiles){let J={min:0,max:0};if(W){const ae=W.getMinMaxForTile(K);ae&&(J=ae)}this.addShadowReceiver(K.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,io.shadowMapResolution,io.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:s.ao.white,depth:1});for(const T of n.order){const M=n._mergedLayers[T];if(!M.hasShadowPass()||M.isHidden(p.transform.zoom))continue;const D=n.getLayerSourceCache(M),k=D?a[D.id]:void 0;(M.type==="model"||k&&k.length)&&p.renderLayer(p,D,M,k)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,a=n.style,p=n.context,x=p.gl,b=a.directionalLight,T=a.ambientLight;if(!b||!T)return;const M=[],D=Qa(n,n.longestCutoffRange);D.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const k=Xo(a,b,T),F=new wn(x.LEQUAL,wn.ReadOnly,n.depthRangeFor3D),G=new Yn({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const V of this._groundShadowTiles){const W=V.toUnwrapped(),K=n.isTileAffectedByFog(V),J=n.getOrCreateProgram("groundShadow",{defines:M,overrideFog:K});this.setupShadows(W,J),n.uploadCommonUniforms(p,J,W,null,D);const ae={u_matrix:n.transform.calculateProjMatrix(W),u_ground_shadow_factor:k};J.draw(n,x.TRIANGLES,F,G,si.multiply,Hn.disabled,ae,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?si.unblended:si.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,p=a.calculatePosMatrix(n,a.worldSize);return s.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){const a=s.by(n);return s.aB(a,this._cascades[this.painter.currentShadowCascade].matrix,n),a}setupShadows(n,a,p){if(!this.enabled)return;const x=this.painter.transform,b=this.painter.context,T=b.gl,M=this._uniformValues,D=new Float64Array(16),k=x.calculatePosMatrix(n,x.worldSize);for(let F=0;F<this._cascades.length;F++)s.aB(D,this._cascades[F].matrix,k),M[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(T.TEXTURE0+ho.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const F=s.d6(n.canonical),G=2/x.tileSize*s.al/io.shadowMapResolution,V=G*this._cascades[0].boundingSphereRadius,W=G*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(p==="vector-tile"?1:3)*(function(J,ae,re,ue,ye){const fe=s.aA((J-22)/-22,0,1);return .125*(1-fe)+4*fe})(x.zoom);M.u_shadow_normal_offset=[F,V*K,W*K],M.u_shadow_bias=[1e-4,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,M)}setupShadowsFromMatrix(n,a,p=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,T=this._uniformValues,M=new Float64Array(16);for(let D=0;D<io.cascadeCount;D++)s.aB(M,this._cascades[D].matrix,n),T[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),x.activeTexture.set(b.TEXTURE0+ho.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=p,p){const D=io.normalOffset;T.u_shadow_normal_offset=[1,D,D],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,p,x){if(x[2]>=0)return{};const b=(function(D,k,F){const G=F/(1<<D.canonical.z);return new s.d8([D.canonical.x*G+D.wrap*F,D.canonical.y*G+D.wrap*F,0],[(D.canonical.x+1)*G+D.wrap*F,(D.canonical.y+1)*G+D.wrap*F,k])})(n,a,p).getCorners(),T=a/-x[2];x[0]<0?(s.d7(b[0],b[0],[x[0]*T,0,0]),s.d7(b[3],b[3],[x[0]*T,0,0])):x[0]>0&&(s.d7(b[1],b[1],[x[0]*T,0,0]),s.d7(b[2],b[2],[x[0]*T,0,0])),x[1]<0?(s.d7(b[0],b[0],[0,x[1]*T,0]),s.d7(b[1],b[1],[0,x[1]*T,0])):x[1]>0&&(s.d7(b[2],b[2],[0,x[1]*T,0]),s.d7(b[3],b[3],[0,x[1]*T,0]));const M={};return M.vertices=b,M.planes=[uc(b[1],b[0],b[4]),uc(b[2],b[1],b[5]),uc(b[3],b[2],b[6]),uc(b[0],b[3],b[7])],M}addShadowReceiver(n,a,p){this._receivers.add(n,s.d8.fromTileIdAndHeight(n,a,p))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function uc(f,n,a){const p=s.av([],a,n),x=s.av([],f,n),b=s.bH([],p,x),T=s.ag(b);return T===0?[0,0,1,0]:(s.c4(b,b,1/T),[b[0],b[1],b[2],-s.bI(b,n)])}function iy(f){const n=f.properties.get("direction"),a=s.d3(n.x,n.y,n.z);a[2]=s.aA(a[2],0,75);const p=s.d5([a[0],a[1],a[2]]);return s.d4(p.x,p.y,p.z)}function Xo(f,n,a){const p=n.properties.get("color-use-theme")==="none",x=n.properties.get("color"),b=n.properties.get("intensity"),T=n.properties.get("direction"),M=[T.x,T.y,T.z],D=a.properties.get("color-use-theme")==="none",k=a.properties.get("color"),F=a.properties.get("intensity"),G=Math.max(s.bI([0,0,1],M),0),V=[0,0,0];s.c4(V,k.toPremultipliedRenderColor(D?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),F);const W=[0,0,0];return s.c4(W,x.toPremultipliedRenderColor(p?null:f.getLut(a.scope)).toArray01Linear().slice(0,3),G*b),s.da([V[0]>0?V[0]/(V[0]+W[0]):0,V[1]>0?V[1]/(V[1]+W[1]):0,V[2]>0?V[2]/(V[2]+W[2]):0])}function $p(f,n,a,p,x,b){const T=f.zoom,M=f.scale,D=f.worldSize,k=1/D,F=f.aspect,G=Math.sqrt(1+F*F)*Math.tan(.5*f.fovX),V=G*G,W=p-a,K=p+a;let J,ae;V>W/K?(J=p,ae=p*G):(J=.5*K*(1+V),ae=.5*Math.sqrt(W*W+2*(p*p+a*a)*V+K*K*V*V));const re=f.projection.pixelsPerMeter(f.center.lat,D),ue=f._camera.getCameraToWorldMercator(),ye=[0,0,-J*k];s.af(ye,ye,ue);let fe=ae*k;const Ce=f._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const Pt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?re:1),Rt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,a,p);Rt[8]=2*-f.centerOffset.x/f.width,Rt[9]=2*f.centerOffset.y/f.height;const Qt=new Float64Array(16);s.cO(Qt,Rt,Pt);const bt=new Float64Array(16);s.bk(bt,Qt);const St=s.cA.fromInvProjectionMatrix(bt,D,T,!0);for(const Jt of St.points){const cn=((be=Jt)[0]/=M,be[1]/=M,be[2]=s.ce(be[2],f._center.lat),be);fe=Math.max(fe,s.c5(s.d9([],ye,cn)))}}var be;fe*=x/(x-1);const De=Math.acos(n[2]),Te=Math.atan2(-n[0],-n[1]),Se=new Up;Se.position=ye,Se.setPitchBearing(De,Te);const Pe=Se.getWorldToCamera(D,re),Xe=fe*D,Ge=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Xe),dt=Se.getCameraToClipOrthographic(-Xe,Xe,-Xe,Xe,Ge,(Xe+b*re)/n[2]),it=new Float64Array(16);s.aB(it,dt,Pe);const gt=s.d4(Math.floor(1e6*ye[0])/1e6*D,Math.floor(1e6*ye[1])/1e6*D,0),Ft=.5*x,Je=[0,0,0];s.af(Je,gt,it),s.c4(Je,Je,Ft);const Ve=[Math.floor(Je[0]),Math.floor(Je[1]),Math.floor(Je[2])],_t=[0,0,0];s.av(_t,Je,Ve),s.c4(_t,_t,-1/Ft);const rt=new Float64Array(16);return s.bz(rt),s.bq(rt,rt,_t),s.aB(it,rt,it),[it,Xe]}class yu extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,a){return s.db(this.requestManager.transformRequest(a,s.R.Model).url).then((p=>{if(!p)return;const x=s.dc(p),b=new s.dd(n,a,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b})).catch((p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${n} from ${a}: ${p.message}`)))}))}load(n,a,p={forceReload:!1}){this.models[a]||(this.models[a]={});const x=Object.keys(n),b=[],T=[];for(const M of x){const D=n[M];this.hasURLBeenRequested(D)&&!p.forceReload||(this.modelByURL[D]={modelId:M,scope:a},b.push(this.loadModel(M,D)),T.push(M)),this.models[a][M]||(this.models[a][M]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+T.length,Promise.allSettled(b).then((M=>{for(let D=0;D<M.length;D++){const{status:k}=M[D];if(k==="rejected")continue;const{value:F}=M[D];this.models[a][T[D]]||(this.models[a][T[D]]={model:null,numReferences:1}),this.models[a][T[D]].model=F}this.numModelsLoading[a]-=T.length,this.fire(new s.z("data",{dataType:"style"}))})).catch((M=>{this.fire(new s.y(new Error(`Could not load models: ${M.message}`)))}))}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(n,a):this.getModelByURL(this.modelUris[a][n]))}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]?this.models[a][n].model:void 0}getModelByURL(n){if(!n)return null;const a=this.modelByURL[n];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(n,a){return this.models[a]&&this.models[a][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,a,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(a);if((this.hasModel(n,p,{exactIdMatch:!0})||this.hasModelBeenAdded(n,p))&&this.modelUris[p][n]===x)this.models[p][n].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:b,modelId:T}=this.modelByURL[x];this.models[b][T].numReferences++}else this.modelUris[p][n]=x,this.load({[n]:this.modelUris[p][n]},p)}addModelURLs(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p=this.modelUris[a];for(const x in n)p[x]=this.requestManager.normalizeModelURL(n[x])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p={};for(const x of n)this.hasModel(x,a,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[a][x].numReferences++:this.modelUris[a][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[a][x]:!this.hasURLBeenRequested(x)&&s.de(x,!1)&&(this.modelUris[a][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[a][x]);this.load(p,a)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,a,p=!1,x=!1){if(this.models[a]&&this.models[a][n]&&(this.models[a][n].numReferences--,this.models[a][n].numReferences===0||x)){const b=this.modelUris[a][n];p||delete this.modelUris[a][n],delete this.modelByURL[b];const T=this.models[a][n].model;if(!T)return;delete this.models[a][n],T.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const a of Object.keys(this.models[n])){const p=this.models[n][a].model;delete this.models[n][a],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const p in this.models[a])this.models[a][p].model&&this.models[a][p].model.upload(n.context)}}const dd=s.a6.colorTheme,Uc=new s.a9({data:new s.aa(dd.data)});function hd(f){if(!f.metadata||!f.metadata.content_area)return;const n=s.o.devicePixelRatio,{left:a,top:p,width:x,height:b}=f.metadata.content_area,T=a*n,M=p*n;return[T,M,T+x*n,M+b*n]}function fd(f){if(f)return f.map((([n,a])=>[n*s.o.devicePixelRatio,a*s.o.devicePixelRatio]))}class Sg{constructor(n,a,p){this.id=n,this.scope=a,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return n;const p=this.sourceCache.getSource();if(!(p instanceof Xs))return n;const x=a.map((T=>this.sourceCache.getTile(T))),b=p.getImages(x,Array.from(this.pendingRequests));for(const[T,M]of b)n.set(s.I.from({name:T,iconsetId:this.id}),M),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),n}}const $c=(f,n)=>ne(f,n&&n.filter((a=>a.identifier!=="source.canvas"))),pd=s.aH(Fi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Gp=s.aH(Fi,["setCenter","setZoom","setBearing","setPitch"]),Ff=new Set(["background","sky","slot","custom"]),Hp={version:8,layers:[],sources:{}},Tg={duration:300,delay:0};class ml extends s.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},Tg),this._buildingIndex=new If(this),this.crossTileSymbolIndex=new ac,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=a.styleChanges||new cs,this.dispatcher=a.dispatcher?a.dispatcher:new s.D(s.dg(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new jn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new s.dh(n._requestManager,a.localFontFamily?s.di.all:a.localIdeographFontFamily?s.di.ideographs:s.di.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new yu(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._indoorDependentLayers=a.indoorDependentLayers?a.indoorDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",s.dj());const p=this;this._rtlTextPluginCallback=ml.registerForPluginStateChange((x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},((b,T)=>{if(s.dk(b),T&&T.every((M=>M)))for(const M in p._sourceCaches){const D=p._sourceCaches[M],k=D.getSource().type;k!=="vector"&&k!=="geojson"||D.reload()}}))})),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const M=this._layers[T];M.source===b.id&&this._validateLayer(M)}}))}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.h(n))return n;const a=s.dl(n);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${s.dm(JSON.stringify(n))}`}_diffStyle(n,a,p){this.globalId=this._getGlobalId(n);const x=(b,T)=>{try{T(null,this.setState(b,p))}catch(M){T(M,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),T=this.map._requestManager.transformRequest(b,s.R.Style);s.m(T,((M,D)=>{M?this.fire(new s.y(M)):D&&x(D,a)}))}else typeof n=="object"&&x(n,a)}loadURL(n,a={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof a.validate=="boolean"?a.validate:!s.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const x=this.importsCache.get(n);if(x)return this._load(x,p);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.m(b,((T,M)=>{if(this._request=null,T)this.fire(new s.y(T));else if(M)return this.importsCache.set(n,M),this._load(M,p)}))}loadJSON(n,a={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.o.frame((()=>{this._request=null,this._load(n,a.validate!==!1)}))}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Hp,!1)}_loadImports(n,a,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of n){const T=this._createFragmentStyle(b),M=new Promise((F=>{T.once("style.import.load",F),T.once("error",F)})).then((()=>this.mergeAll()));if(x.push(M),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const D=b.data||this.importsCache.get(b.url);D?(T.loadJSON(D,{validate:a}),this._isInternalStyle(D)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:a}):T.loadEmpty();const k={style:T,id:b.id,config:b.config};if(p){const F=this.fragments.findIndex((({id:G})=>G===p));this.fragments=this.fragments.slice(0,F).concat(k).concat(this.fragments.slice(F))}else this.fragments.push(k)}return Promise.allSettled(x)}getImportGlobalIds(n=this,a=new Set){for(const p of n.fragments)p.style.globalId&&a.add(p.style.globalId),this.getImportGlobalIds(p.style,a);return[...a.values()]}_createFragmentStyle(n){const a=this.scope?s.B(n.id,this.scope):n.id;let p;const x=this._initialConfig&&this._initialConfig[a];(n.config||x)&&(p=Object.assign({},n.config,x));const b=new ml(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,a){if(this._isInternalStyle(n)){const b=Object.assign({},Hp,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(b,a)}if(this.updateConfig(this._config,n.schema),a&&$c(this,us(n)))return;this._loaded=!0,this.stylesheet=s.dn(n);const p=()=>{for(const D in n.sources)this.addSource(D,n.sources[D],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const D in n.iconsets)this.addIconset(D,n.iconsets[D]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const b=Ya(this.stylesheet.layers);if(this._order=b.map((D=>D.id)),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new je(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new je(this.stylesheet.light)),this._layers={};for(const D of b){const k=s.dt(D,this.scope,this._styleColorTheme.lut,this.options);k.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(k.fqid),this._hasAppearances=this._hasAppearances||k.getAppearances().length!==0,k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const F=this.getOwnLayerSourceCache(k),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&k.canCastShadows()&&G&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const M=this.isRootStyle();n.imports?this._loadImports(n.imports,a).then((()=>{this._reloadImports(),this.fire(new s.z(M?"style.load":"style.import.load"))})).catch((D=>{this.fire(new s.y(new Error("Failed to load imports",D))),this.fire(new s.z(M?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new s.z(M?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const b=this._evaluateColorThemeData(x);this._loadColorTheme(b).then((()=>{p()})).catch((T=>{s.w(`Couldn't load color theme from the stylesheet: ${T}`),p()}))}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let n,a,p,x,b,T,M,D,k,F;const G={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((V=>{if(V.stylesheet){if(V.light!=null&&(n=V.light),V.stylesheet.lights)for(const W of V.stylesheet.lights)W.type==="ambient"&&V.ambientLight!=null&&(a=V.ambientLight),W.type==="directional"&&V.directionalLight!=null&&(p=V.directionalLight);x=this._prioritizeTerrain(x,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(b=V.fog),V.stylesheet.snow&&V.snow!=null&&(T=V.snow),V.stylesheet.rain&&V.rain!=null&&(M=V.rain),V.stylesheet.camera!=null&&(F=V.stylesheet.camera),V.stylesheet.projection!=null&&(D=V.stylesheet.projection),V.stylesheet.transition!=null&&(k=V.stylesheet.transition),G[V.scope]=V._styleColorTheme}})),this.light=n,this.ambientLight=a,this.directionalLight=p,this.fog=b,this.snow=T,this.rain=M,this._styleColorThemeForScope=G,x===null?delete this.terrain:this.terrain=x,this.camera=F||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=Object.assign({},Tg,k),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const a=p=>{for(const x of p.fragments)a(x.style);n(p)};a(this)}_prioritizeTerrain(n,a,p){const x=n&&n.drapeRenderMode===0;return p===null?a&&a.drapeRenderMode===0?a:x?n:null:a!=null&&(!n||x||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)})),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle((a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)})),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},p={};this.forEachFragmentStyle((x=>{for(const b in x._sourceCaches){const T=s.B(b,x.scope);n[T]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const T=s.B(b,x.scope);a[T]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const T=s.B(b,x.scope);p[T]=x._symbolSourceCaches[b]}})),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle((n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const a of Object.values(n.stylesheet.indoor)){const p=a,x=s.B(p.sourceId,n.scope);this._mergedIndoor[x]=new Set(p.sourceLayers||[])}}))}mergeLayers(){const n={},a=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((T=>{for(const M of T._order){const D=T._layers[M];if(D.type==="slot"){const k=s.dp(M);if(n[k])continue;n[k]=[]}D.slot&&n[D.slot]?n[D.slot].push(D):a.push(D)}})),this._mergedOrder=[];let x=-1;const b=(T=[])=>{for(const M of T)if(M.type==="slot"){const D=s.dp(M.id);n[D]&&b(n[D]),this._mergedSlots.push(D)}else{const D=s.B(M.id,M.scope);this._mergedOrder.push(D),p[D]=M,M.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),M.type==="circle"&&(this._hasCircleLayers=!0),M.type==="symbol"&&(this._hasSymbolLayers=!0),M.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(a),this._has3DLayers){const T={};for(let M=0;M<this._mergedOrder.length;++M){const D=this._mergedOrder[M];T[D]=M===x?1:M<x?p[D].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((M,D)=>T[M]-T[D]))}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(a,p,x,b){const T=Object.assign({},p);for(const D of Object.keys(dd))T[D]===void 0&&(T[D]=dd[D].default);const M=new s.a8(Uc,a,new Map(x));return M.setTransitionOrValue(T,x),M.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((p,x)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=n;T.startsWith(b)||(T=b+T);const M=s.I.from("mapbox-reserved-lut"),D=new Image;D.src=T,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void p();this._styleColorTheme.lutLoading=!1;const{width:k,height:F,data:G}=s.o.getImageData(D);if(F>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==F*F)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new s.q({width:k,height:F},G),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(M,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:n},p()):x(new Error("Missing LUT image."))}}))}getLut(n){const a=this._styleColorThemeForScope[n];return a?a.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(a,p,x){let b,T,M;const D=s.o.devicePixelRatio>1?"@2x":"";let k=s.m(p.transformRequest(p.normalizeSpriteURL(a,D,".json"),s.R.SpriteJSON),((V,W)=>{k=null,M||(M=V,b=W,G())})),F=s.n(p.transformRequest(p.normalizeSpriteURL(a,D,".png"),s.R.SpriteImage),((V,W)=>{F=null,M||(M=V,T=W,G())}));function G(){if(M)x(M);else if(b&&T){const V=s.o.getImageData(T),W={};for(const K in b){const{width:J,height:ae,x:re,y:ue,sdf:ye,pixelRatio:fe,stretchX:Ce,stretchY:be,content:De}=b[K],Te=new s.q({width:J,height:ae});s.q.copy(V,Te,{x:re,y:ue},{x:0,y:0},{width:J,height:ae},null),W[K]={data:Te,pixelRatio:fe!==void 0?fe:1,sdf:ye!==void 0&&ye,stretchX:Ce,stretchY:be,content:De,usvg:!1,version:0}}x(null,W)}}return{cancel(){k&&(k.cancel(),k=null),F&&(F.cancel(),F=null)}}})(n,this.map._requestManager,((a,p)=>{if(this._spriteRequest=null,a)this.fire(new s.y(a));else if(p){const x=new Map;for(const b in p)x.set(s.I.from(b),p[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))}))}addIconset(n,a){if(a.type==="sprite")return void this._loadSprite(a.url);const p=this.getOwnSourceCache(a.source);if(!p)return void this.fire(new s.y(new Error(`Source "${a.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${a.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const b=new Sg(n,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const a=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(b,T)=>{if(this._spriteRequest=null,b)a?this._loadSprite(n):this.fire(new s.y(b));else if(T){const M=new Map;for(const D in T)M.set(s.I.from(D),T[D]);this.addImages(M)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bt((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),s.R.Iconset),((b,T)=>{if(b)return void x(b);const M={},D=s.df(new s.bs(T));for(const k of D.icons){const F={version:1,pixelRatio:s.o.devicePixelRatio,content:hd(k),stretchX:k.metadata?fd(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?fd(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};M[k.name]=F}x(null,M)})))}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const p=n.sourceLayer;p&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((n,a)=>{const p=this.fragments[a];return p&&p.style&&(n.data=p.style.serialize()),n}))}_serializeSources(){const n={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const a=[];for(const p of n){const x=this._layers[p];x&&x.type!=="custom"&&a.push(x.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new s.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new s.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,a){const p=this.map.painter;if(p)for(let x=n.minzoom||0;x<(n.maxzoom||25.5);x++){const b=n.getProgramIds();if(b)for(const T of b){const M=n.getDefaultProgramParams(T,a.zoom,this._styleColorTheme.lut);M&&(p.style=this,this.fog&&(p._fogVisible=!0,M.overrideFog=!0,p.getOrCreateProgram(T,M)),p._fogVisible=!1,M.overrideFog=!1,p.getOrCreateProgram(T,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,p.getOrCreateProgram(T,M)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const D in M){const{updatedIds:k,removedIds:F}=M[D];(k||F)&&(this._updateWorkerLayers(D,k,F),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const M in this._mergedSourceCaches){const D=this._mergedSourceCaches[M];b[M]=D.used,D.used=!1,D.tileCoverLift=0}for(const M of this._mergedOrder){const D=this._mergedLayers[M];if(D.recalculate(n,this._availableImages),!D.isHidden(n.zoom)){const k=this.getLayerSourceCache(D);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(D,n)})):this.precompilePrograms(D,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const M of T)M.sourceCache.used=!0;for(const M in b){const D=this._mergedSourceCaches[M];b[M]!==D.used&&D.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const a of n){const p=a.resolvePendingRequests(),x=this.getFragmentStyle(a.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const n={};for(const a in this._mergedSourceCaches){const p=this._mergedSourceCaches[a].getSource().scope;n[p]=n[p]||this._changes.getUpdatedImages(p),n[p].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n[p])}for(const a in n)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(n,a,p){const x=this.getFragmentStyle(n);x&&this.dispatcher.broadcast("updateLayers",{layers:a?x._serializeLayers(a):[],scope:n,removedIds:p||[],options:x.options})}setState(n,a){if(this._checkLoaded(),$c(this,us(n)))return!1;(n=s.dn(n)).layers=Ya(n.layers);const p=(function(T,M){if(!T)return[{command:Fi.setStyle,args:[M]}];let D=[];try{if(!s.bx(T.version,M.version))return[{command:Fi.setStyle,args:[M]}];if(s.bx(T.center,M.center)||D.push({command:Fi.setCenter,args:[M.center]}),s.bx(T.zoom,M.zoom)||D.push({command:Fi.setZoom,args:[M.zoom]}),s.bx(T.bearing,M.bearing)||D.push({command:Fi.setBearing,args:[M.bearing]}),s.bx(T.pitch,M.pitch)||D.push({command:Fi.setPitch,args:[M.pitch]}),s.bx(T.sprite,M.sprite)||D.push({command:Fi.setSprite,args:[M.sprite]}),s.bx(T.glyphs,M.glyphs)||D.push({command:Fi.setGlyphs,args:[M.glyphs]}),s.bx(T.imports,M.imports)||(function(W=[],K=[],J){K=K||[];const ae=(W=W||[]).map(Lo),re=K.map(Lo),ue=W.reduce(Nl,{}),ye=K.reduce(Nl,{}),fe=ae.slice();let Ce,be,De,Te;for(Ce=0,be=0;Ce<ae.length;Ce++)De=ae[Ce],ye.hasOwnProperty(De)?be++:(J.push({command:Fi.removeImport,args:[De]}),fe.splice(fe.indexOf(De,be),1));for(Ce=0,be=0;Ce<re.length;Ce++)De=re[re.length-1-Ce],fe[fe.length-1-Ce]!==De&&(ue.hasOwnProperty(De)?(J.push({command:Fi.removeImport,args:[De]}),fe.splice(fe.lastIndexOf(De,fe.length-be),1)):be++,Te=fe[fe.length-Ce],J.push({command:Fi.addImport,args:[ye[De],Te]}),fe.splice(fe.length-Ce,0,De));for(const Se of K){const Pe=ue[Se.id];Pe&&(delete Pe.data,s.bx(Pe,Se)||J.push({command:Fi.updateImport,args:[Se.id,Se]}))}})(T.imports,M.imports,D),s.bx(T.transition,M.transition)||D.push({command:Fi.setTransition,args:[M.transition]}),s.bx(T.light,M.light)||D.push({command:Fi.setLight,args:[M.light]}),s.bx(T.fog,M.fog)||D.push({command:Fi.setFog,args:[M.fog]}),s.bx(T.snow,M.snow)||D.push({command:Fi.setSnow,args:[M.snow]}),s.bx(T.rain,M.rain)||D.push({command:Fi.setRain,args:[M.rain]}),s.bx(T.projection,M.projection)||D.push({command:Fi.setProjection,args:[M.projection]}),s.bx(T.lights,M.lights)||D.push({command:Fi.setLights,args:[M.lights]}),s.bx(T.camera,M.camera)||D.push({command:Fi.setCamera,args:[M.camera]}),s.bx(T.iconsets,M.iconsets)||(function(W,K,J){let ae;for(ae in K=K||{},W=W||{})W.hasOwnProperty(ae)&&(K.hasOwnProperty(ae)||J.push({command:Fi.removeIconset,args:[ae]}));for(ae in K){if(!K.hasOwnProperty(ae))continue;const re=K[ae];W.hasOwnProperty(ae)?s.bx(W[ae],re)||(J.push({command:Fi.removeIconset,args:[ae]}),J.push({command:Fi.addIconset,args:[ae,re]})):J.push({command:Fi.addIconset,args:[ae,re]})}})(T.iconsets,M.iconsets,D),!s.bx(T["color-theme"],M["color-theme"]))return[{command:Fi.setStyle,args:[M]}];const k={},F=[];(function(W,K,J,ae){let re;for(re in K=K||{},W=W||{})W.hasOwnProperty(re)&&(K.hasOwnProperty(re)||bh(re,J,ae));for(re in K){if(!K.hasOwnProperty(re))continue;const ue=K[re];W.hasOwnProperty(re)?s.bx(W[re],ue)||(W[re].type==="geojson"&&ue.type==="geojson"&&wh(W,K,re)?J.push({command:Fi.setGeoJSONSourceData,args:[re,ue.data]}):gu(re,K,J,ae)):vh(re,K,J)}})(T.sources,M.sources,F,k);const G=[];T.layers&&T.layers.forEach((W=>{W.source&&k[W.source]?D.push({command:Fi.removeLayer,args:[W.id]}):G.push(W)}));let V=T.terrain;V&&k[V.source]&&(D.push({command:Fi.setTerrain,args:[void 0]}),V=void 0),D=D.concat(F),s.bx(V,M.terrain)||D.push({command:Fi.setTerrain,args:[M.terrain]}),(function(W,K,J){K=K||[];const ae=(W=W||[]).map(Lo),re=K.map(Lo),ue=W.reduce(Nl,{}),ye=K.reduce(Nl,{}),fe=ae.slice(),Ce=Object.create(null);let be,De,Te,Se,Pe,Xe,Ge;for(be=0,De=0;be<ae.length;be++)Te=ae[be],ye.hasOwnProperty(Te)?De++:(J.push({command:Fi.removeLayer,args:[Te]}),fe.splice(fe.indexOf(Te,De),1));for(be=0,De=0;be<re.length;be++)Te=re[re.length-1-be],fe[fe.length-1-be]!==Te&&(ue.hasOwnProperty(Te)?(J.push({command:Fi.removeLayer,args:[Te]}),fe.splice(fe.lastIndexOf(Te,fe.length-De),1)):De++,Xe=fe[fe.length-be],J.push({command:Fi.addLayer,args:[ye[Te],Xe]}),fe.splice(fe.length-be,0,Te),Ce[Te]=!0);for(be=0;be<re.length;be++)if(Te=re[be],Se=ue[Te],Pe=ye[Te],!Ce[Te]&&!s.bx(Se,Pe))if(s.bx(Se.source,Pe.source)&&s.bx(Se["source-layer"],Pe["source-layer"])&&s.bx(Se.type,Pe.type)){for(Ge in Sh(Se.layout,Pe.layout,J,Te,null,Fi.setLayoutProperty),Sh(Se.paint,Pe.paint,J,Te,null,Fi.setPaintProperty),s.bx(Se.slot,Pe.slot)||J.push({command:Fi.setSlot,args:[Te,Pe.slot]}),s.bx(Se.filter,Pe.filter)||J.push({command:Fi.setFilter,args:[Te,Pe.filter]}),s.bx(Se.minzoom,Pe.minzoom)&&s.bx(Se.maxzoom,Pe.maxzoom)||J.push({command:Fi.setLayerZoomRange,args:[Te,Pe.minzoom,Pe.maxzoom]}),Se)Se.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Sh(Se[Ge],Pe[Ge],J,Te,Ge.slice(6),Fi.setPaintProperty):s.bx(Se[Ge],Pe[Ge])||J.push({command:Fi.setLayerProperty,args:[Te,Ge,Pe[Ge]]}));for(Ge in Pe)Pe.hasOwnProperty(Ge)&&!Se.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Sh(Se[Ge],Pe[Ge],J,Te,Ge.slice(6),Fi.setPaintProperty):s.bx(Se[Ge],Pe[Ge])||J.push({command:Fi.setLayerProperty,args:[Te,Ge,Pe[Ge]]}))}else J.push({command:Fi.removeLayer,args:[Te]}),Xe=fe[fe.lastIndexOf(Te)+1],J.push({command:Fi.addLayer,args:[Pe,Xe]})})(G,M.layers,D)}catch(k){console.warn("Unable to compute style diff:",k),D=[{command:Fi.setStyle,args:[M]}]}return D})(this.serialize(),n).filter((T=>!(T.command in Gp)));if(p.length===0)return!1;const x=p.filter((T=>!(T.command in pd)));if(x.length>0)throw new Error(`Unimplemented: ${x.map((T=>T.command)).join(", ")}.`);const b=[];return p.forEach((T=>{b.push(this[T.command](...T.args))})),a&&Promise.all(b).then(a).catch(a),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[a,p]of n.entries()){if(this.getImage(a))return this.fire(new s.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,p),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(n,a){return this.getImage(n)?this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,a),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(n,a,p=!1){this.imageManager.updateImage(n,this.scope,a),p&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(n,a,p={}){return this._checkLoaded(),this._validate(_a,`models.${n}`,a,null,p)||(this.modelManager.addModel(n,a,this.scope),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Ho,`sources.${n}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const x=Oo(n,a,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id})));const b=T=>{const M=(T?"symbol:":"other:")+x.id,D=s.B(M,this.scope),k=this._sourceCaches[M]=new Da(D,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=k,k.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find((([b,T])=>T.type==="source"&&T.source===n));if(x)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(n);for(const x of p){const b=s.dp(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const p=this.getOwnSourceCache(a);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const p=n[a]._tiles;for(const x in p){const b=p[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const b of n){if(this._validate(Po,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(a)}else this.ambientLight=new ds(b,Hi||(Hi=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(a)}else this.directionalLight=new ds(b,Lr||(Lr=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(a,{worldview:this.map.getWorldview()}),x=new s.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const p=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),x=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=n.properties.get("intensity"),T=n.properties.get("direction"),M=1-s.d3(T.x,T.y,T.z)[2]/90,D=p(x)*b*M,k=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=a.properties.get("intensity"),G=p(k)*F;return Number(((D+G)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.dq(n)){const a=s.dr(n),p=this.fragments.find((({id:b})=>b===a));if(!p)return;const x=s.dp(n);return p.style.getFragmentStyle(x)}{const a=this.fragments.find((({id:p})=>p===n));return a?a.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const a={},p=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in n){const b=this._featuresetSelectors[x]=[];for(const T of n[x].selectors){if(T.featureNamespace){const D=this.getOwnLayer(T.layer);if(!D){s.w(`Layer is undefined for selector: ${T.layer}`);continue}const k=p(D.source,D.sourceLayer);if(k in a&&a[k]!==T.featureNamespace){s.w(`"featureNamespace ${T.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}a[k]=T.featureNamespace}let M;if(T.properties)for(const D in T.properties){const k=s.U(T.properties[D]);k.result==="success"&&(M=M||{},M[D]=k.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:M,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const a=this.getFragmentStyle(n);if(!a||!a.stylesheet.featuresets)return[];const p=[];for(const x in a.stylesheet.featuresets)p.push({featuresetId:x,importId:a.scope?a.scope:void 0});return p}getFeaturesetLayers(n,a){const p=this.getFragmentStyle(a),x=p.stylesheet.featuresets;if(!x||!x[n])return this.fire(new s.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of x[n].selectors){const M=p.getOwnLayer(T.layer);M&&b.push(M)}return b}getConfigProperty(n,a){const p=this.getFragmentStyle(n);if(!p)return null;const x=s.B(a,p.scope),b=p.options.get(x),T=b?b.value||b.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,a){const p=s.B(n,a);return this._mergedIndoor[p]}setIndoorData(n,a){this.map.indoor.setIndoorData(a)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,a,p){const x=this.getFragmentStyle(n);if(!x)return;const b=x.stylesheet.schema;if(!b||!b[a])return;const T=s.U(p);if(T.result!=="success")return void $c(this,T.value);const M=T.value.expression,D=s.B(a,x.scope),k=x.options.get(D);if(!k)return;let F;const{minValue:G,maxValue:V,stepValue:W,type:K,values:J}=b[a],ae=s.U(b[a].default);ae.result==="success"&&(F=ae.value.expression),F?(this.options.set(D,Object.assign({},k,{value:M,default:F,minValue:G,maxValue:V,stepValue:W,type:K,values:J})),this.updateConfigDependencies(a)):this.fire(new s.y(new Error(`No schema defined for the config option "${a}" in the "${n}" fragment.`)))}getConfig(n){const a=this.getFragmentStyle(n);if(!a)return null;const p=a.stylesheet.schema;if(!p)return null;const x={};for(const b in p){const T=s.B(b,a.scope),M=a.options.get(T),D=M?M.value||M.default:null;x[b]=D?D.serialize():null}return x}setConfig(n,a){const p=this.getFragmentStyle(n);p&&(p.updateConfig(a,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const a=this.getFragmentStyle(n);return a?a.stylesheet.schema:null}setSchema(n,a){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=a,p.updateConfig(p._config,a),this.updateConfigDependencies())}updateConfig(n,a){if(this._config=n,n||a)if(a)for(const p in a){let x,b;const T=s.U(a[p].default);if(T.result==="success"&&(x=T.value.expression),n&&n[p]!==void 0){const V=s.U(n[p]);V.result==="success"&&(b=V.value.expression)}const{minValue:M,maxValue:D,stepValue:k,type:F,values:G}=a[p];if(x){const V=s.B(p,this.scope);this.options.set(V,{default:x,value:b,minValue:M,maxValue:D,stepValue:k,type:F,values:G})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,a=(()=>!0)){for(const p of n){const x=this.getLayer(p);x&&a(x)&&(x.possiblyEvaluateVisibility(),this._updateLayer(x),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,(a=>!n||a.expressionDependencies.configDependencies.has(n))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((a=>{const p=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(p){const x=a._evaluateColorThemeData(p);(!a._styleColorTheme.lut&&x!==""||a._styleColorTheme.lut&&x!==a._styleColorTheme.lut.data)&&a.setColorTheme(p)}})),this._changes.setDirty()}addLayer(n,a,p={}){this._checkLoaded();const x=n.id;if(this._layers[x])return void this.fire(new s.y(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(n.type==="custom"){if($c(this,s.ds(n)))return;b=s.dt(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=s.dn(n),n=Object.assign(n,{source:x})),this._validate(qo,`layers.${x}`,n,{arrayIndex:-1},p))return;b=s.dt(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}const T=s.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let M=this._order.length;if(a){const G=this._order.indexOf(a);if(G===-1)return void this.fire(new s.y(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?M=G:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const D=this.getOwnLayerSourceCache(b),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&k&&(D.castsShadows=!0);const F=this._changes.getRemovedLayer(b);if(F&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const G=s.B(b.source,b.scope);F.type!==b.type?this._changes.updateSourceCache(G,"clear"):(this._changes.updateSourceCache(G,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===a)return;const x=this._order.indexOf(n);this._order.splice(x,1);let b=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new s.y(new Error(`Layer with id "${a}" does not exist on this map.`)));p.slot===this._layers[a].slot?b=T:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._indoorDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const x=this.getOwnLayerSourceCache(a);if(x&&x.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){b=!0;break}x.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,p){this._checkLoaded();const x=this._checkLayer(n);x&&(x.minzoom===a&&x.maxzoom===p||(a!=null&&(x.minzoom=a),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,a){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==a&&(p.slot=a,this._updateLayer(p))}setFilter(n,a,p={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!s.bx(x.filter,a))return a==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(fi,`layers.${x.id}.filter`,a,{layerType:x.type},p)||(x.filter=s.dn(a),this._updateLayer(x)))}getFilter(n){const a=this._checkLayer(n);if(a)return s.dn(a.filter)}setLayoutProperty(n,a,p,x={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.bx(b.getLayoutProperty(a),p)){if(p!=null&&(!x||x.validate!==!1)&&$c(b,zl.call(us,{key:`layers.${n}.layout.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(n,a,p,x={}){this._checkLoaded();const b=this._checkLayer(n);b&&(a==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(a)?this.setPaintProperty(n,a,p,x):this.setLayoutProperty(n,a,p,x))}getLayoutProperty(n,a){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(a)}setPaintProperty(n,a,p,x={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.bx(b.getPaintProperty(a),p)||p!=null&&(!x||x.validate!==!1)&&$c(b,Ds.call(us,{key:`layers.${n}.paint.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:s.a6})))return;const T=b.setPaintProperty(a,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,a){const p=this._checkLayer(n);if(p)return p.getPaintProperty(a)}setFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:D,importId:k}=n.target,F=this.getFragmentStyle(k),G=F.getFeaturesetLayers(D);for(const{source:V,sourceLayer:W}of G)F.setFeatureState({id:n.id,source:V,sourceLayer:W},a)}else if("layerId"in n.target){const{layerId:D}=n.target,k=this.getLayer(D);this.setFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer},a)}return}const p=n.source,x=n.sourceLayer,b=this._checkSource(p);if(!b)return;const T=b.type;if(T==="geojson"&&x)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(p);for(const D of M)D.setFeatureState(x,n.id,a)}removeFeatureState(n,a){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:D,importId:k}=n.target,F=this.getFragmentStyle(k),G=F.getFeaturesetLayers(D);for(const{source:V,sourceLayer:W}of G)F.removeFeatureState({id:n.id,source:V,sourceLayer:W},a)}else if("layerId"in n.target){const{layerId:D}=n.target,k=this.getLayer(D);this.removeFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer},a)}return}const p=n.source,x=this._checkSource(p);if(!x)return;const b=x.type,T=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(p);for(const D of M)D.removeFeatureState(T,n.id,a)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:T,importId:M}=n.target,D=this.getFragmentStyle(M),k=D.getFeaturesetLayers(T);for(const{source:F,sourceLayer:G}of k){const V=D.getFeatureState({id:n.id,source:F,sourceLayer:G});if(V&&!b)b=V;else if(!s.bx(b,V))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:T}=n.target,M=this.getLayer(T);b=this.getFeatureState({id:n.id,source:M.source,sourceLayer:M.sourceLayer})}return b}const a=n.source,p=n.sourceLayer,x=this._checkSource(a);if(x){if(x.type!=="vector"||p)return n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(p,n.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(p=>p!==void 0))}_updateFilteredLayers(n){for(const a of Object.values(this._mergedLayers))n(a)&&this._updateLayer(a)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),p=s.B(n.source,n.scope),x=this._changes.getUpdatedSourceCaches();n.source&&!x[p]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=M=>this._mergedLayers[M].is3D(!!this.terrain),p=this.order,x={},b=[];for(let M=p.length-1;M>=0;M--){const D=p[M];if(a(D)){x[D]=M;for(const k of n){const F=k[D];if(F)for(const G of F)b.push(G)}}}b.sort(((M,D)=>D.intersectionZ-M.intersectionZ));const T=[];for(let M=p.length-1;M>=0;M--){const D=p[M];if(a(D))for(let k=b.length-1;k>=0;k--){const F=b[k].feature;if(F.layer&&x[F.layer.id]<M)break;T.push(F),b.pop()}else for(const k of n){const F=k[D];if(F)for(const G of F)T.push(G.feature)}}return T}queryRasterValue(n,a,p){const x=this.getOwnSource(n);return x?x.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(a,p):(this.fire(new s.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,a,p){let x;a&&!Array.isArray(a)&&a.filter&&(this._validate(fi,"queryRenderedFeatures.filter",a.filter,null,a),x=s.b5(a.filter));const b={},T=F=>{if(Ff.has(F.type))return;const G=this.getOwnLayerSourceCache(F),V=b[G.id]=b[G.id]||{sourceCache:G,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[F.fqid]=V.layers[F.fqid]||{styleLayer:F,targets:[]},V.layers[F.fqid].targets.push({filter:x})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const F of a.layers){const G=this._layers[F];if(!G)return this.fire(new s.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(G)}}else for(const F in this._layers)T(this._layers[F]);const M=this._queryRenderedFeatures(n,b,p),D=this._flattenAndSortRenderedFeatures(M),k=[];for(const F of D)s.dv(F.layer.id)===this.scope&&k.push(F);return k}queryRenderedFeatureset(n,a,p){let x;a&&!Array.isArray(a)&&a.filter&&(this._validate(fi,"queryRenderedFeatures.filter",a.filter,null,a),x=s.b5(a.filter));const b="mock",T=[];if(a&&a.target)T.push(Object.assign({},a,{targetId:b,filter:x}));else{const F=this.getFeaturesetDescriptors();for(const G of F)T.push({targetId:b,filter:x,target:G});for(const{style:G}of this.fragments){const V=G.getFeaturesetDescriptors();for(const W of V)T.push({targetId:b,filter:x,target:W})}}const M=this.queryRenderedTargets(n,T,p),D=[],k=new Set;for(const F of M)for(const G of F.variants[b])na(G,F,k)||D.push(new s.dw(F,G));return D}queryRenderedTargets(n,a,p){const x={},b=(M,D,k,F)=>{const G=x[D.id]=x[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(G.layers[M.fqid]=G.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D(!!this.terrain)&&(G.has3DLayers=!0),!F)return k.uniqueFeatureID=!1,void G.layers[M.fqid].targets.push(k);G.layers[M.fqid].targets.push(Object.assign({},k,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const M of a)if("featuresetId"in M.target){const{featuresetId:D,importId:k}=M.target,F=this.getFragmentStyle(k);if(!F||!F._featuresetSelectors)continue;const G=F._featuresetSelectors[D];if(!G){this.fire(new s.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of G){const W=F.getOwnLayer(V.layerId);W&&!Ff.has(W.type)&&b(W,F.getOwnLayerSourceCache(W),M,V)}}else if("layerId"in M.target){const{layerId:D}=M.target,k=this.getLayer(D);if(!k||Ff.has(k.type))continue;b(k,this.getLayerSourceCache(k),M)}const T=this._queryRenderedFeatures(n,x,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(n,a,p){const x=[],b=!!this.map._showQueryGeometry,T=ar.createFromScreenPoints(n,p);for(const M in a){const D=To(T,a[M],this._availableImages,p,b);Object.keys(D).length&&x.push(D)}if(this.placement)for(const M in a){if(!a[M].sourceCache._onlySymbols)continue;const D=Rf(T.screenGeometry,a[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(D).length&&x.push(D)}return x}querySourceFeatures(n,a){const p=a&&a.filter;p&&this._validate(fi,"querySourceFeatures.filter",p,null,a);let x=[];const b=this.getOwnSourceCaches(n);for(const T of b)x=x.concat(yh(T,a));return x}addSourceType(n,a,p){return ml.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(ml.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,p={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const M in n)if(!s.bx(n[M],x[M])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(n,a,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const x=n.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const M="terrain-dem-src";this.addSource(M,p.source),p=s.dn(p),p=Object.assign(p,{source:M})}const b=Object.assign({},p),T={};if(this.terrain&&x){b.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(T.style=M.serialize())}if(this._validate(wo,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&a!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,a),this.fire(new s.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const M of Object.keys(s.a6.terrain))!p.hasOwnProperty(M)&&s.a6.terrain[M].default&&(p[M]=s.a6.terrain[M].default);for(const M in n)if(!s.bx(n[M],T[M])){b.set(n,this.options),this.stylesheet.terrain=n;const D=this._getTransitionParameters({duration:0});b.updateTransitions(D),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Tn(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createSnow(n){const a=this.snow=new Ps(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createRain(n){const a=this.rain=new gs(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const n of this.map._markers)n._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!s.bx(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!s.bx(a.get(),n)){a.set(n,this.options),this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!s.bx(a.get(),n)){a.set(n,this.options),this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(a);this._loadColorTheme(p).then((()=>{this.fire(new s.z("colorthemeset")),n()})).catch((x=>{s.w(`Couldn't set color theme: ${x}`)}))}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,a){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=a,p._reloadColorTheme())}_getTransitionParameters(n){return{now:s.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):a.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const p=this.terrain=new He(n,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,p,x,b={}){if(b&&b.validate===!1)return!1;const T=Object.assign({},this.serialize());return $c(this,n.call(us,Object.assign({key:a,style:T,value:p,styleSpec:s.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const p of a)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const a=this._mergedLayers[n];a._clear&&a._clear()}}reloadSource(n){const a=this.getSourceCaches(n);for(const p of a)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((n=>{n.modelManager.reloadModels(n.scope)}))}updateSources(n){let a;this.directionalLight&&(a=iy(this.directionalLight));const p=new Set;for(const x in this._mergedLayers){const b=this._mergedLayers[x];b.hasElevation()&&!p.has(b.source)&&p.add(b.source)}for(const x in this._mergedSourceCaches){const b=this._mergedSourceCaches[x],T=p.has(b._source.id);b.update(n,void 0,void 0,a,T)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,p,x,b,T,M=!1){let D=!1,k=!1;const F={},G={};for(const V of this._mergedOrder){const W=this._mergedLayers[V];if(W.type!=="symbol")continue;const K=s.B(W.source,W.scope);let J=F[K];if(!J){const re=this.getLayerSourceCache(W);if(!re)continue;const ue=re.getRenderableIds(!0).map((ye=>re.getTileByID(ye)));G[K]=ue.slice(),J=F[K]=ue.sort(((ye,fe)=>fe.tileID.overscaledZ-ye.tileID.overscaledZ||(ye.tileID.isLessThan(fe.tileID)?-1:1)))}const ae=this.crossTileSymbolIndex.addLayer(W,J,a.center.lng,a.projection);D=D||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),a.zoom))&&(this.pauseablePlacement=new uo(a,this._mergedOrder,M,p,x,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,G,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),k=!0),D&&this.pauseablePlacement.placement.setStale()),k||D){this._buildingIndex.onNewFrame(a.zoom);for(let V=0;V<this._mergedOrder.length;V++){const W=this._mergedLayers[this._mergedOrder[V]];if(W.type!=="symbol")continue;const K=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,F[s.B(W.source,W.scope)],V,K?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex((({id:b})=>b===n.id))!==-1)return void this.fire(new s.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return p.push(n),this._loadImports([n],!0);const x=p.findIndex((({id:b})=>b===a));return x===-1&&this.fire(new s.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(n).concat(p.slice(x)),this._loadImports([n],!0,a)}updateImport(n,a){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);return x===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==p[x].url&&this.setImportUrl(n,a.url),s.bx(a.config,p[x].config)||this.setImportConfig(n,a.config,a.data.schema),s.bx(a.data,p[x].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(n);if(x===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const T=p[x],M=this.fragments[x];return p=p.filter((({id:D})=>D!==n)),this.fragments=this.fragments.filter((({id:D})=>D!==n)),this.stylesheet.imports=p.slice(0,b).concat(T).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(M).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);if(x===-1)return this;p[x].url=a;const b=this.fragments[x];return b.style=this._createFragmentStyle(p[x]),b.style.on("style.import.load",(()=>this.mergeAll())),b.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const p=this.getImportIndex(n),x=this.stylesheet.imports||[];return p===-1?this:a?(this.fragments[p].style.setState(a),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(n,x[p].url))}setImportConfig(n,a,p){this._checkLoaded();const x=this.getImportIndex(n),b=this.stylesheet.imports||[];if(x===-1)return this;a?b[x].config=a:delete b[x].config;const T=this.fragments[x];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const M=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=a,T.style.updateConfig(a,M),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(a.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex((p=>p.id===n));return a===-1&&this.fire(new s.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[a];p&&n.push(p.getSource())}return n}getSource(n,a){const p=this.getSourceCache(n,a);return p&&p.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const p=s.B(n,a);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const a=s.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const p=n[a];p==="reload"?this.reloadSource(a):p==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const p of a){const x=this.getLayer(p);x&&x.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,a,p){this.imageManager.getImages(a.images,a.scope,p),this._updateTilesForChangedImages();const x=T=>{if(T){const M=a.images.map((D=>s.I.toString(D)));T.setDependencies(a.tileID.key,a.type,M)}},b=s.B(a.source,a.scope);x(this._mergedOtherSourceCaches[b]),x(this._mergedSymbolSourceCaches[b]),a.images.some((T=>T.iconsetId))&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(n,a,p){this.imageManager.rasterizeImages(a,p)}getGlyphs(n,a,p){this.glyphManager.getGlyphs(a.stacks,p)}getResource(n,a,p){return s.dy(a,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${n}'`))),!1):a.every((p=>p.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,a){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const p=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),x=n.type==="building";if(n.is3D(!!this.terrain)){if(p||x||a&&a.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((n=>{n.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ml.getSourceType=function(f){return Bs[f]},ml.setSourceType=function(f,n){Bs[f]=n},ml.registerForPluginStateChange=s.dz;class md extends s.E{constructor(n){super(),this._style=n,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[a,p]of Object.entries(n.buildings))if(this._buildings[a])for(const x of p.floorIds)this._buildings[a].floors[x]||(this._buildings[a].floors[x]=p.floors[x]);else this._buildings[a]=p;for(const a of n.activeFloors)this._activeFloors.add(a);this._updateIndoorSelector()}getIndoorTileOptions(n,a){const p=this._style.getIndoorSourceLayers(n,a);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(n,a,p){const x=(function(b,T,M,D){let k=null,F=Number.MAX_SAFE_INTEGER;if(D<16)return null;for(const[G,V]of Object.entries(b)){const W=V.center;if(W){const K=T.distanceTo(s.aS.convert(W));K<F&&M.contains(W)&&(F=K,k=G)}}return k})(this._buildings,a,p,n);x!==this._closestBuildingId&&(this._closestBuildingId=x,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,a=this._closestBuildingId,p=a&&n?n[a]:void 0;if(!p)return void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let x=null;for(const T of p.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){x=T;break}const b=Array.from(p.floorIds).map((T=>({id:T,name:p.floors[T].name,zIndex:p.floors[T].zIndex}))).sort(((T,M)=>M.zIndex-T.zIndex));this.fire(new s.z("selector-update",{selectedFloorId:x,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Ph=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,qp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Bf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ra="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,za=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,xa=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,gd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,qt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Vf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const gl=[];La(Ph,gl),La(Bf,gl),La(qp,gl);const _d={"_prelude_fog.vertex.glsl":za,"_prelude_terrain.vertex.glsl":Gc,"_prelude_shadow.vertex.glsl":qt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Hc,"_prelude_shadow.fragment.glsl":Vf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":xa,"_prelude_raster_particle.glsl":gd},xu={};mi("",Gc),mi(Hc,za),mi(Vf,qt),mi(xa,""),mi(gd,"");const dc=mi(qp,Bf),hc=Ph;var sa={background:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:mi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:mi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:mi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:mi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:mi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:mi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:mi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:mi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:mi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:mi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:mi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:mi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ra),skyboxGradient:mi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ra),skyboxCapture:mi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:mi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:mi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:mi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:mi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:mi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function La(f,n){const a=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of a)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const b of x)n.includes(b)||n.push(b)}}function mi(f,n){const a=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,x={},b=[],T=[];if(f=f.replace(a,((D,k)=>(T.push(k),""))),(n=n.replace(a,((D,k)=>(b.push(k),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...gl];La(f,M),La(n,M);for(const D of[...b,...T])_d[D]||console.error(`Undefined include: ${D}`),xu[D]||(xu[D]=[],La(_d[D],xu[D])),M=[...M,...xu[D]];return{fragmentSource:f=f.replace(p,((D,k,F,G,V)=>(x[V]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${F} ${G} ${V};
#else
uniform ${F} ${G} u_${V};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${F} ${G} ${V} = u_${V};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${F} ${G} ${V};
#endif
`:k==="initialize-attribute"?"":void 0))),vertexSource:n=n.replace(p,((D,k,F,G,V)=>{const W=`MATERIAL_ATTRIBUTE_OFFSET_${V}`,K=G==="float"?"vec2":G,J=`GET_ATTRIBUTE_${K}(a_${V}, materialInfo, ${W})`,ae=V.match(/color/)?"color":K;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${F} ${G} a_${V};
#endif
`:x[V]?k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
    #if !defined(${W})
        in ${F} ${K} a_${V};
    #endif
out ${F} ${G} ${V};
#else
uniform ${F} ${G} u_${V};
#endif
`:k==="initialize"?ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${F} ${G} ${V} = u_${V};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${V}) 
    #ifdef ${W}
        ${V} = unpack_mix_${ae}(${J}, u_${V}_t);
    #else
        ${V} = unpack_mix_${ae}(a_${V}, u_${V}_t);
    #endif
#else
    ${F} ${G} ${V} = u_${V};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${F} ${G} a_${V};
    out ${F} ${G} ${V};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
    #if !defined(${W})
        in ${F} ${K} a_${V};
    #endif  
#else
uniform ${F} ${G} u_${V};
#endif
`:k==="define-instanced"?ae==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${F} ${G} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${K} a_${V};
#else
uniform ${F} ${G} u_${V};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${F} ${G} ${V} = a_${V};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    #ifdef ${W}
        ${F} ${G} ${V} = ${J};
    #else
        ${F} ${G} ${V} = a_${V};
    #endif
#else
    ${F} ${G} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    #ifdef ${W}
        ${F} ${G} ${V} = unpack_mix_${ae}(${J}, u_${V}_t);
    #else
        ${F} ${G} ${V} = unpack_mix_${ae}(a_${V}, u_${V}_t);
    #endif
#else
    ${F} ${G} ${V} = u_${V};
#endif
`})),usedDefines:M,vertexIncludes:b,fragmentIncludes:T}}class yd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,p,x,b,T,M,D){this.context=n;let k=this.boundPaintVertexBuffers.length!==x.length;for(let G=0;!k&&G<x.length;G++)this.boundPaintVertexBuffers[G]!==x[G]&&(k=!0);let F=this.boundDynamicVertexBuffers.length!==M.length;for(let G=0;!F&&G<M.length;G++)this.boundDynamicVertexBuffers[G]!==M[G]&&(F=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==p||k||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(a,p,x,b,T,M,D);else{n.bindVertexArrayOES.set(this.vao);for(const G of M)G&&(G.bind(),D&&G.instanceCount&&G.setVertexAttribDivisor(n.gl,a,D));b&&b.dynamicDraw&&b.bind()}}freshBind(n,a,p,x,b,T,M){const D=this.context,k=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,a.enableAttributes(k,n),a.bind(),a.setVertexAttribPointers(k,n,b);for(const F of p)F.enableAttributes(k,n),F.bind(),F.setVertexAttribPointers(k,n,b);for(const F of T)F&&(F.enableAttributes(k,n),F.bind(),F.setVertexAttribPointers(k,n,b),M&&F.instanceCount&&F.setVertexAttribDivisor(k,n,M));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Zp(f,n){const a=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.ae(0,p/a).toLngLat().lat,new s.ae(0,(p+1)/a).toLngLat().lat]}function xd(f,n,a,p,x,b,T){const M=f.context,D=M.gl,k=a.hillshadeFBO;if(!k)return;f.prepareDrawTile();const F=f.isTileAffectedByFog(n),G=f.getOrCreateProgram("hillshade",{overrideFog:F});M.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,k.colorAttachment.get());const V=((ae,re,ue,ye)=>{const fe=ue.paint.get("hillshade-shadow-color"),Ce=ue.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=ue.paint.get("hillshade-highlight-color"),De=ue.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=ue.paint.get("hillshade-accent-color"),Se=ue.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Pe=ue.paint.get("hillshade-emissive-strength");let Xe=s.an(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")Xe-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const dt=ae.style.directionalLight.properties.get("direction"),it=s.d3(dt.x,dt.y,dt.z);Xe=s.an(it[1])}const Ge=!ae.options.moving;return{u_matrix:ye||ae.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:Zp(0,re.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),Xe],u_shadow:fe.toPremultipliedRenderColor(Ce?null:ue.lut),u_highlight:be.toPremultipliedRenderColor(De?null:ue.lut),u_emissive_strength:Pe,u_accent:Te.toPremultipliedRenderColor(Se?null:ue.lut)}})(f,a,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(M,G,n.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:K,tileBoundsSegments:J}=f.getTileBoundsBuffers(a);G.draw(f,D.TRIANGLES,x,b,T,Hn.disabled,V,p.id,W,K,J)}function Oh(f,n,a){if(!n.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(a.stride);const b=a.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(p,b,x.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ry(f,n,a){const p=f.context,x=p.gl;if(!n.dem)return;const b=n.dem;if(p.activeTexture.set(x.TEXTURE1),Oh(f,n,b),!n.demTexture)return;n.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=b.dim;p.activeTexture.set(x.TEXTURE0);let M=n.hillshadeFBO;if(!M){const V=new s.T(p,{width:T,height:T,data:null},x.RGBA8);V.bind(x.LINEAR,x.CLAMP_TO_EDGE),M=n.hillshadeFBO=p.createFramebuffer(T,T,!0,"renderbuffer"),M.colorAttachment.set(V.texture)}p.bindFramebuffer.set(M.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:k,tileBoundsSegments:F}=f.getMercatorTileBoundsBuffers(),G=[];f.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(f,x.TRIANGLES,wn.disabled,Yn.disabled,si.unblended,Hn.disabled,((V,W)=>{const K=W.stride,J=s.bB();return s.cd(J,0,s.al,-s.al,0,0,1),s.bq(J,J,[0,-s.al,0]),{u_matrix:J,u_image:1,u_dimension:[K,K],u_zoom:V.overscaledZ}})(n.tileID,b),a.id,D,k,F),n.needsHillshadePrepare=!1}class Fr{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Eg extends Fr{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Na extends Fr{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class zh extends Fr{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Lh extends Fr{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Wp extends Fr{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Uf extends Fr{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ja extends Fr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class _l extends Fr{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class jl extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class fc extends Fr{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Fl extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Bl extends Fr{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class $f extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class Gf extends Fr{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class qc extends Fr{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class vd extends Fr{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class ro extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class hs extends Fr{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Nr extends Fr{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let pc=class extends Fr{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class el extends Fr{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class vu extends Fr{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Vl extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Hf extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Xp extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Zc extends Fr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ul extends Fr{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Kp extends Fr{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Nh extends Fr{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Yp extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class yl extends Fr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class xl extends Fr{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class bu extends xl{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class mc extends xl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ag extends xl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class qf extends mc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wu=(f,n,a)=>({u_matrix:f,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),bd=(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:a,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:M,u_frustum_br:D,u_frustum_bl:k,u_globe_pos:F,u_globe_radius:G,u_viewport:V,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:K});function gc(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const Us=new class{constructor(){this.operations={}}newMorphing(f,n,a,p,x){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[f]={startTime:p,phase:0,duration:x,from:n,to:a,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const a=this.operations[n];for(a.phase=(f-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},kh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Cg(f,n,a){if(n===0)return 0;const p=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function Zf(f,n){const a=1<<f.z;return!n&&(f.x===0||f.x===a-1)||f.y===0||f.y===a-1}const wd=f=>({u_matrix:f});function Qp(f,n,a,p,x){if(x>0){const b=s.o.now(),T=(b-f.timeAdded)/x,M=n?(b-n.timeAdded)/x:-1,D=a.getSource(),k=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),F=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),G=F&&f.refreshedUponExpiration?1:s.aA(F?T:1-M,0,1);return n?{opacity:1,mix:1-G,isFading:T<1}:{opacity:G,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class ts extends Da{constructor(n){const a=Oo("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class Wf extends Da{constructor(n){const a=Oo("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,p){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const M=new fl(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);M.state="loaded",this._tiles[T.key]=M}return b}),{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach((n=>n.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Wc extends s.aP{constructor(n,a,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class Xc extends s.bU{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,b]=(function(D){const k=new s.bc,F=new s.b0,G=131;k.reserve(17161),F.reserve(33800);const V=s.al/128,W=s.al+V/2,K=W+V;for(let ae=-V;ae<K;ae+=V)for(let re=-V;re<K;re+=V){const ue=re<0||re>W||ae<0||ae>W?24575:0,ye=s.aA(Math.round(re),0,s.al),fe=s.aA(Math.round(ae),0,s.al);k.emplaceBack(ye+ue,fe)}const J=(ae,re)=>{const ue=re*G+ae;F.emplaceBack(ue+1,ue,ue+G),F.emplaceBack(ue+G,ue+G+1,ue+1)};for(let ae=1;ae<129;ae++)for(let re=1;re<129;re++)J(re,ae);return[0,129].forEach((ae=>{for(let re=0;re<130;re++)J(re,ae),J(ae,re)})),[k,F,32768]})(),T=n.context;this.gridBuffer=T.createVertexBuffer(p,s.be.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=s.bf.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=s.bf.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Wf(a.map),this.orthoMatrix=s.bB(),s.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const M=T.gl;this._overlapStencilMode=new Yn({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ts(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(n,a,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const x=n.terrain.properties,b=n.terrain.drapeRenderMode===0,T=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const M=n.terrain&&n.terrain.scope,D=x.get("source"),k=b?this._mockSourceCache:n.getSourceCache(D,M);if(!k)return void s.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=k,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(a):x.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(a,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),a.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const a=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const x=a!=null?p-a:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=n.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let M=b-this._previousZoom;const D=this._previousUpdateTimestamp;let k=b;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(b-k)>.5&&(M=.5*(b-k+M)),M*x<0&&(k+=M)),this._evaluationZoom=k;const F=T.getExaggeration(k),G=F===T.getExaggeration(Math.max(0,k-.1));if(G&&Math.abs(F-this._exaggeration)<.01)return F;let V=Math.min(.1,.00375*(this._updateTimestamp-D));return(G||F<.1||Math.abs(M)<1e-4)&&(V=Math.min(.2,4*V)),s.ak(this._exaggeration,F,V)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((n=>n.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=a.getIds().map((D=>{const k=a.getTileByID(D).tileID;return k.projMatrix=p.calculateProjMatrix(k.toUnwrapped()),k}));(function(D,k){const F=k.transform.pointCoordinate(k.transform.getCameraPoint()),G=new s.P(F.x,F.y);D.sort(((V,W)=>{if(W.overscaledZ-V.overscaledZ)return W.overscaledZ-V.overscaledZ;const K=new s.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),J=new s.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),ae=G.mult(1<<V.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(K)-ae.distSqr(J)}))})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach((D=>{this.proxyToSource[D.key]={}})),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const D in T){const k=T[D];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[D],b),k.usedForTerrain))continue;const F=n[D];k.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[a.id]=x.map((D=>new Wc(D,D.key,this.orthoMatrix))),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const k=this.terrainTileForTile[D.key];if(!k)continue;const F=k.tileID.key;F in M||(this._visibleDemTiles.push(k),M[F]=F)}}_assignTerrainTiles(n){this._initializing||n.forEach((a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)}))}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Oh(this.painter,x,b))}}_prepareDemTileUniforms(n,a,p,x){if(!a||a.demTexture==null)return!1;const b=n.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-b.z),M=x||"";return p[`u_dem_tl${M}`]=[b.x*T%1,b.y*T%1],p[`u_dem_scale${M}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const a=this._visibleDemTiles.reduce(((p,x)=>{if(!x.dem)return p;const b=x.dem.tree.minimums[0];return b>0&&n++,p+b}),0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new s.dK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,x,a.R32F,{premultiply:!1}),b}setupElevationDraw(n,a,p){const x=this.painter.context,b=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let M=null,D=null,k=1;if(p&&p.morphing&&this._useVertexMorphing){const W=p.morphing.srcDemTile,K=p.morphing.dstDemTile;k=p.morphing.phase,W&&K&&(this._prepareDemTileUniforms(n,W,T,"_prev")&&(D=W),this._prepareDemTileUniforms(n,K,T)&&(M=K))}const F=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let G=null;var V;if(this.enabled?D&&M?(G=M.demTexture,x.activeTexture.set(b.TEXTURE4),D.demTexture.bind(F(D),b.CLAMP_TO_EDGE),T.u_dem_lerp=k):(M=this.terrainTileForTile[n.tileID.key],G=this._prepareDemTileUniforms(n,M,T)?M.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),G&&(T.u_dem_size=(V=G).size[0]===1?1:V.size[0]-2,G.bind(F(M),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,a,T),p&&p.useMeterToDem&&M){const W=(1<<M.tileID.canonical.z)*s.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=W}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){const W=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);a.setGlobeUniformValues(x,W)}}globeUniformValues(n,a,p){const x=n.projection;return{u_tile_tl_up:x.upVector(a,0,0),u_tile_tr_up:x.upVector(a,s.al,0),u_tile_br_up:x.upVector(a,s.al,s.al),u_tile_bl_up:x.upVector(a,0,s.al),u_tile_up_scale:p?s.dL(1):x.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,b,T,M,D){if(x.transform.projection.name==="globe")(function(k,F,G,V,W){const K=k.context,J=K.gl;let ae,re;const ue=k.transform,ye=s.dD(k,K,ue),fe=(dt,it)=>{if(re===it)return;const gt=[kh[it],"PROJECTION_GLOBE_VIEW"];ye&&gt.push("CUSTOM_ANTIALIASING");const Ft=k.isTileAffectedByFog(dt);ae=k.getOrCreateProgram("globeRaster",{defines:gt,overrideFog:Ft}),re=it},Ce=k.colorModeForRenderPass(),be=new wn(J.LEQUAL,wn.ReadWrite,k.depthRangeFor3D);Us.update(W);const De=s.dE(ue),Te=[s.aF(ue.center.lng),s.aJ(ue.center.lat)],Se=k.globeSharedBuffers,Pe=[ue.width*s.o.devicePixelRatio,ue.height*s.o.devicePixelRatio],Xe=Float32Array.from(ue.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const dt=k.transform,it=Cg(dt.zoom,F.exaggeration(),F.sourceCache._source.tileSize);re=-1;const gt=J.TRIANGLES;for(const Ft of V){const Je=G.getTile(Ft),Ve=Yn.disabled,_t=F.prevTerrainTileForTile[Ft.key],rt=F.terrainTileForTile[Ft.key];gc(_t,rt)&&Us.newMorphing(Ft.key,_t,rt,W,250),K.activeTexture.set(J.TEXTURE0),Je.texture&&Je.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Pt=Us.getMorphValuesForProxy(Ft.key),Rt=Pt?1:0;Pt&&Object.assign(Ge,{morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:s.dC(Pt.phase)}});const Qt=s.dF(Ft.canonical),bt=s.dG(Qt.getCenter().lat),St=s.dH(Ft.canonical,Qt,bt,dt.worldSize/dt._pixelsPerMercatorPixel),Jt=s.bj(s.dI(Ft.canonical)),cn=bd(dt.expandedFarZProjMatrix,Xe,De,Jt,s.aj(dt.zoom),Te,dt.frustumCorners.TL,dt.frustumCorners.TR,dt.frustumCorners.BR,dt.frustumCorners.BL,dt.globeCenterInViewSpace,dt.globeRadius,Pe,it,dt._farZ,St);if(fe(Ft,Rt),ae&&(F.setupElevationDraw(Je,ae,Ge),k.uploadCommonUniforms(K,ae,Ft.toUnwrapped()),Se)){const[rn,pn,Fn]=Se.getGridBuffers(bt,it!==0);ae.draw(k,gt,be,Ve,Ce,Hn.backCCW,cn,"globe_raster",rn,pn,Fn)}}}if(Se&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ye&&dt.push("CUSTOM_ANTIALIASING"),ae=k.getOrCreateProgram("globeRaster",{defines:dt});for(const it of V){const{x:gt,y:Ft,z:Je}=it.canonical,Ve=Ft===0,_t=Ft===(1<<Je)-1,[rt,Pt,Rt,Qt]=Se.getPoleBuffers(Je,!1);if(Qt&&(Ve||_t)){const bt=G.getTile(it);K.activeTexture.set(J.TEXTURE0),bt.texture&&bt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let St=s.dJ(Je,gt,ue);const Jt=s.bj(s.dI(it.canonical)),cn=(rn,pn)=>rn.draw(k,J.TRIANGLES,be,Yn.disabled,Ce,Hn.disabled,bd(ue.expandedFarZProjMatrix,St,St,Jt,0,Te,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Pe,0,ue._farZ),"globe_pole_raster",pn,Rt,Qt);F.setupElevationDraw(bt,ae,Ge),k.uploadCommonUniforms(K,ae,it.toUnwrapped()),Ve&&k.renderDefaultNorthPole&&cn(ae,rt),_t&&k.renderDefaultSouthPole&&(St=s.cR(s.bB(),St,[1,-1,1]),cn(ae,Pt))}}}})(x,b,T,M,D);else{const k=x.context,F=k.gl;let G,V;const W=x.shadowRenderer,K=Qa(x,x.longestCutoffRange),J=Ce=>{if(V===Ce)return;const be=[];be.push(kh[Ce]),K.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),W&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&be.push("NORMAL_OFFSET")),G=x.getOrCreateProgram("terrainRaster",{defines:be}),V=Ce},ae=x.colorModeForRenderPass(),re=new wn(F.LEQUAL,wn.ReadWrite,x.depthRangeFor3D);Us.update(D);const ue=x.transform,ye=Cg(ue.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let fe=[0,0,0];if(W){const Ce=x.style.directionalLight,be=x.style.ambientLight;Ce&&be&&(fe=Xo(x.style,Ce,be))}{V=-1;const Ce=F.TRIANGLES,[be,De]=[b.gridIndexBuffer,b.gridSegments];for(const Te of M){const Se=T.getTile(Te),Pe=Yn.disabled,Xe=b.prevTerrainTileForTile[Te.key],Ge=b.terrainTileForTile[Te.key];gc(Xe,Ge)&&Us.newMorphing(Te.key,Xe,Ge,D,250),k.activeTexture.set(F.TEXTURE0),Se.texture&&Se.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const dt=Us.getMorphValuesForProxy(Te.key),it=dt?1:0;let gt;dt&&(gt={morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:s.dC(dt.phase)}});const Ft=wu(Te.projMatrix,Zf(Te.canonical,ue.renderWorldCopies)?ye/10:ye,fe);if(J(it),!G)continue;b.setupElevationDraw(Se,G,gt);const Je=Te.toUnwrapped();W&&W.setupShadows(Je,G),x.uploadCommonUniforms(k,G,Je,null,K),G.draw(x,Ce,re,Pe,ae,Hn.backCCW,Ft,"terrain_raster",b.gridBuffer,be,De)}}}})(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),M=a.style.order,D=[];let k=0;for(const F of b){const G=x.getTileByID(F.proxyTileKey),V=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][n]:void 0,W=V!==void 0?x.renderCache[V]:this.pool[k++],K=V!==void 0;if(G.texture=W.tex,K&&!W.dirty){D.push(G.tileID);continue}let J;p.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(p.clear({color:s.ao.transparent,stencil:0}),W.dirty=!1);for(let ae=T.start;ae<=T.end;++ae){const re=a.style._mergedLayers[M[ae]];if(re.isHidden(a.transform.zoom))continue;const ue=a.style.getLayerSourceCache(re),ye=ue?this.proxyToSource[F.key][ue.id]:[F];if(!ye)continue;const fe=ye;p.viewport.set([0,0,W.fb.width,W.fb.height]),J!==(ue?ue.id:null)&&(this._setupStencil(W,ye,re,ue),J=ue?ue.id:null),a.renderLayer(a,ue,re,fe)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const re=a.style._mergedLayers[M[ae]];if(re.isHidden(a.transform.zoom))continue;const ue=a.style.getLayerSourceCache(re),ye=ue?this.proxyToSource[F.key][ue.id]:[F];if(!ye)continue;const fe=ye;p.viewport.set([0,0,W.fb.width,W.fb.height]),J!==(ue?ue.id:null)&&(this._setupStencil(W,ye,re,ue),J=ue?ue.id:null),a.renderLayer(a,ue,re,fe)}this.renderedToTile?(W.dirty=!0,D.push(G.tileID)):K||--k,k===5&&(k=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let p=-1,x=a;for(let b=0;b<a;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?p=Math.max(p,b):x=Math.min(x,b);return x>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter((a=>a.dem)).forEach((a=>{n=Math.min(n,a.dem.tree.minimums[0])})),n===0?n:(n-30)*this._exaggeration}raycast(n,a,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter((b=>b.dem)).map((b=>{const T=b.tileID,M=1<<T.overscaledZ,{x:D,y:k}=T.canonical,F=D/M,G=(D+1)/M,V=k/M,W=(k+1)/M;return{minx:F,miny:V,maxx:G,maxy:W,t:b.dem.tree.raycastRoot(F,V,G,W,n,a,p),tile:b}}));x.sort(((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE)));for(const b of x){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,a,p);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,a=n.gl,p=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const x=new s.T(n,{width:p[0],height:p[1],data:null},a.RGBA8);x.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=n.createFramebuffer(p[0],p[1],!0,null);return b.colorAttachment.set(x.texture),b.depthAttachment=new qf(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some((n=>{const a=this._style._mergedLayers[n],p=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!p&&a.shouldRedrape():!p&&a.hasTransition()}))}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof So){n=!0;break}if(!n)return;const a={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(x);if(b&&!a[b.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof s.ad){a[b.id]=!0;for(const T of this.proxyCoords){const M=this.proxyToSource[T.key][b.id];if(M)for(const D of M)this._clearRenderCacheForTile(b.id,D)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Wa){n=!0;break}if(!n)return;const a={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(x);if(!b||a[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const T=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const D=this.proxyToSource[M.key][b.id];if(D)for(const k of D){const F=Qp(b.getTile(k),b.findLoadedParent(k,0),b,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(b.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,a=n.length;if(a===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,b=0,T=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<a;)T=this._style._mergedLayers[n[b]];for(;b<a;++b){const M=this._style._mergedLayers[n[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?x===void 0&&(x=b):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(p.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:b-1}),p.length!==0){const M=p[p.length-1];this._pendingGroundEffectLayers.every((D=>D>M.end))||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let M=0;M<T.length;++M){const D=Object.values(T[M]);a.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const M=p[T];if(a.getTileByID(M.key),a.proxyCachedFBO[M.key]!==void 0){const D=n[M.key],k=this.proxyToSource[M.key];let F=0;for(const G in k){const V=k[G],W=D[G];if(!W||W.length!==V.length||V.some(((K,J)=>K!==W[J]||x[G]&&x[G].hasOwnProperty(K.key)))){F=-1;break}++F}for(const G in a.proxyCachedFBO[M.key])a.renderCache[a.proxyCachedFBO[M.key][G]].dirty=F<0||F!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort(((T,M)=>M.end-M.start-(T.end-T.start)));for(const T of b)for(const M of p){if(a.proxyCachedFBO[M.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[M.key]={},a.proxyCachedFBO[M.key][T.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let M;if(p.isTileClipped())M=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Yn.disabled}_renderTileClippingMasks(n,a){const p=this.painter,x=this.painter.context,b=x.gl;p._tileClippingMaskIDs={},x.setColorMode(si.disabled),x.setDepthMode(wn.disabled);const T=p.getOrCreateProgram("clippingMask");for(const M of n){const D=p._tileClippingMaskIDs[M.key]=--a;T.draw(p,b.TRIANGLES,wn.disabled,new Yn({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),si.disabled,Hn.disabled,wd(M.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const p=[n.x,n.y,1,1];s.aC(p,p,a.pixelMatrixInverse),s.cJ(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const x=a._camera.position,b=s.ce(1,a.center.lat),T=[x[0],x[1],x[2]/b,0],M=s.d9([],p.slice(0,3),T);s.aw(M,M);const D=this.raycast(T,M,this._exaggeration);return D!==null&&D?(s.bG(T,T,M,D),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(n,a,p){if(n.getSource()instanceof s.aT)return this._setupProxiedCoordsForImageSource(n,a,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let D=0;D<b.length;D++){const k=b[D],F=this._findTileCoveringTileID(k,n);if(F){const G=this._createProxiedId(k,F,p[k.key]&&p[k.key][n.id]);x.push(G),this.proxyToSource[k.key][n.id]=[G]}}let T=!1;const M=new Set;for(let D=0;D<a.length;D++){const k=n.getTile(a[D]);if(!k||!k.hasData())continue;const F=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==k.tileID.canonical.z){const G=this.proxyToSource[F.tileID.key][n.id],V=this._createProxiedId(F.tileID,k,p[F.tileID.key]&&p[F.tileID.key][n.id]);G?G.splice(G.length-1,0,V):this.proxyToSource[F.tileID.key][n.id]=[V];const W=this.proxyToSource[F.tileID.key][n.id];M.has(W)||M.add(W),x.push(V),T=!0}}if(this._sourceTilesOverlap[n.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const D of M)D.sort(((k,F)=>F.overscaledZ-k.overscaledZ))}_setupProxiedCoordsForImageSource(n,a,p){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords,T=n.getSource(),M=T.tileID;if(!M)return;const D=new s.P(M.x,M.y)._div(1<<M.z),k=T.coordinates.map(s.ae.fromLngLat).reduce(((G,V)=>(G.min.x=Math.min(G.min.x,V.x-D.x),G.min.y=Math.min(G.min.y,V.y-D.y),G.max.x=Math.max(G.max.x,V.x-D.x),G.max.y=Math.max(G.max.y,V.y-D.y),G)),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(G,V)=>{const W=G.wrap+G.canonical.x/(1<<G.canonical.z),K=G.canonical.y/(1<<G.canonical.z),J=s.al/(1<<G.canonical.z),ae=V.wrap+V.canonical.x/(1<<V.canonical.z),re=V.canonical.y/(1<<V.canonical.z);return W+J<ae+k.min.x||W>ae+k.max.x||K+J<re+k.min.y||K>re+k.max.y};for(let G=0;G<b.length;G++){const V=b[G];for(let W=0;W<a.length;W++){const K=n.getTile(a[W]);if(!K||!K.hasData()||F(V,K.tileID))continue;const J=this._createProxiedId(V,K,p[V.key]&&p[V.key][n.id]),ae=this.proxyToSource[V.key][n.id];ae?ae.push(J):this.proxyToSource[V.key][n.id]=[J],x.push(J)}}}_createProxiedId(n,a,p){let x=this.orthoMatrix;if(p){const b=p.find((T=>T.key===a.tileID.key));if(b)return b}if(a.tileID.key!==n.key){const b=n.canonical.z-a.tileID.canonical.z;let T,M,D;x=s.bB();const k=a.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(T=s.al>>b,M=T*((a.tileID.canonical.x<<b)-n.canonical.x+k),D=T*((a.tileID.canonical.y<<b)-n.canonical.y)):(T=s.al<<-b,M=s.al*(a.tileID.canonical.x-(n.canonical.x+k<<-b)),D=s.al*(a.tileID.canonical.y-(n.canonical.y<<-b))),s.cd(x,0,T,0,T,0,1),s.bq(x,x,[M,D,0])}return new Wc(a.tileID,n.key,x)}_findTileCoveringTileID(n,a){let p=a.getTile(n);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[a.id],b=x[n.key];if(p=b?a.getTileByID(b):null,p&&p.hasData()||b===null)return p;let T=p?p.tileID:n,M=T.overscaledZ;const D=a.getSource().minzoom,k=[];if(!b){const G=a.getSource().maxzoom;if(n.canonical.z>=G){const V=n.canonical.z-G;a.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,a.transform.tileZoom),T=new s.aP(M,n.wrap,G,n.canonical.x>>V,n.canonical.y>>V)):V!==0&&(M=G,T=new s.aP(M,n.wrap,G,n.canonical.x>>V,n.canonical.y>>V))}T.key!==n.key&&(k.push(T.key),p=a.getTile(T))}const F=G=>{k.forEach((V=>{x[V]=G})),k.length=0};for(M-=1;M>=D&&(!p||!p.hasData());M--){p&&F(p.tileID.key);const G=T.calculateScaledKey(M);if(p=a.getTileByID(G),p&&p.hasData())break;const V=x[G];if(V===null)break;V===void 0?k.push(G):p=a.getTileByID(V)}return F(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[a.key]=!0}}function Xf(f,n,a){const p=(function(M,D,k){const F=s.bI(D,M),G=s.bI(k,[.2126,.7152,.0722]),V=(K,J,ae)=>(1-ae)*K+ae*J,W=V(1-.3*Math.min(G,1),1,Math.min(F+1,1));return V(.92,1,Math.asin(s.aA(D[2],-1,1))/Math.PI+.5)*W})(f,[0,0,1],n),x=[0,0,0];s.c4(x,a.slice(0,3),p);const b=[0,0,0];s.c4(b,n.slice(0,3),f[2]);const T=[0,0,0];return s.d7(T,x,b),s.da(T)}const Su=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Tu=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Kf{static cacheKey(n,a,p,x){let b=`${a}${x?x.cacheKey:""}`;for(const T of p)n.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(n,a,p,x,b,T){const M=n.gl;this.program=M.createProgram(),this.configuration=x,this.name=a,this.fixedDefines=[...T];let D=x?x.defines():[];D=D.concat(T.map((K=>`#define ${K}`)));const k=`#version 300 es
`;let F=k+D.concat("precision mediump float;",hc,dc.fragmentSource).join(`
`);for(const K of p.fragmentIncludes)F+=`
${_d[K]}`;F+=`
${p.fragmentSource}`;let G=k+D.concat("precision highp float;",hc,dc.vertexSource).join(`
`);for(const K of p.vertexIncludes)G+=`
${_d[K]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const V=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(V,F),M.compileShader(V),M.attachShader(this.program,V);const W=M.createShader(M.VERTEX_SHADER);M.isContextLost()?this.failedToCreate=!0:(M.shaderSource(W,G),M.compileShader(W),M.attachShader(this.program,W),this.attributes={},M.linkProgram(this.program),M.deleteShader(W),M.deleteShader(V),this.fixedUniforms=b(n),this.binderUniforms=x?x.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(K=>({u_instanceID:new s.cg(K)}))(n)),(T.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(K=>({u_dem:new s.cg(K),u_dem_prev:new s.cg(K),u_dem_tl:new s.cj(K),u_dem_scale:new s.ci(K),u_dem_tl_prev:new s.cj(K),u_dem_scale_prev:new s.ci(K),u_dem_size:new s.ci(K),u_dem_lerp:new s.ci(K),u_exaggeration:new s.ci(K),u_depth:new s.cg(K),u_depth_size_inv:new s.cj(K),u_depth_range_unpack:new s.cj(K),u_occluder_half_size:new s.ci(K),u_occlusion_depth_offset:new s.ci(K),u_meter_to_dem:new s.ci(K),u_label_plane_matrix_inv:new s.ck(K)}))(n)),T.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new s.ch(K),u_tile_tr_up:new s.ch(K),u_tile_br_up:new s.ch(K),u_tile_bl_up:new s.ch(K),u_tile_up_scale:new s.ci(K)}))(n)),T.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new s.ck(K),u_fog_range:new s.cj(K),u_fog_color:new s.d2(K),u_fog_horizon_blend:new s.ci(K),u_fog_vertical_limit:new s.cj(K),u_fog_temporal_offset:new s.ci(K),u_frustum_tl:new s.ch(K),u_frustum_tr:new s.ch(K),u_frustum_br:new s.ch(K),u_frustum_bl:new s.ch(K),u_globe_pos:new s.ch(K),u_globe_radius:new s.ci(K),u_globe_transition:new s.ci(K),u_is_globe:new s.cg(K),u_viewport:new s.cj(K)}))(n)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(K=>({u_cutoff_params:new s.d2(K)}))(n)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(K=>({u_lighting_ambient_color:new s.ch(K),u_lighting_directional_dir:new s.ch(K),u_lighting_directional_color:new s.ch(K),u_ground_radiance:new s.ch(K)}))(n)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(K=>({u_light_matrix_0:new s.ck(K),u_light_matrix_1:new s.ck(K),u_fade_range:new s.cj(K),u_shadow_normal_offset:new s.ch(K),u_shadow_intensity:new s.ci(K),u_shadow_texel_size:new s.ci(K),u_shadow_map_resolution:new s.ci(K),u_shadow_direction:new s.ch(K),u_shadow_bias:new s.ch(K),u_shadowmap_0:new s.cg(K),u_shadowmap_1:new s.cg(K)}))(n)))}getAttributeLocation(n,a){let p=this.attributes[a];return p===void 0&&(p=this.attributes[a]=n.getAttribLocation(this.program,a)),p}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in a)p[x]&&p[x].set(this.program,x,a[x])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in a)p[x]&&p[x].set(this.program,x,a[x])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in a)p[x].set(this.program,x,a[x])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in a)p[x].set(this.program,x,a[x])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in a)p[x].set(this.program,x,a[x])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const x in a)p[x].set(this.program,x,a[x])}_drawDebugWireframe(n,a,p,x,b,T,M,D,k,F){const G=n.options.wireframe;if(G.terrain===!1&&G.layers2D===!1&&G.layers3D===!1)return;const V=n.context;if(!(!(!G.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!G.layers2D||n._terrain&&n._terrain.renderingToTexture||!Su.includes(this.name))||!(!G.layers3D||!Tu.includes(this.name))))return;const W=V.gl,K=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,V);if(!K)return;const J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");const ae=n.getOrCreateProgram(this.name,{config:this.configuration,defines:J});V.program.set(ae.program);const re=(fe,Ce,be)=>{if(Ce[fe]&&be[fe])for(const De in Ce[fe])be[fe][De]&&be[fe][De].set(be.program,De,Ce[fe][De].current)};k&&k.setUniforms(ae.program,V,ae.binderUniforms,M,{zoom:D}),re("fixedUniforms",this,ae),re("terrainUniforms",this,ae),re("globeUniforms",this,ae),re("fogUniforms",this,ae),re("lightsUniforms",this,ae),re("shadowUniforms",this,ae),K.bind(),V.setColorMode(new si([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],s.ao.transparent,[!0,!0,!0,!1])),V.setDepthMode(new wn(a.func===W.LESS?W.LEQUAL:a.func,wn.ReadOnly,a.range)),V.setStencilMode(Yn.disabled);const ue=3*T.primitiveLength*2,ye=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=F||1;for(let Ce=0;Ce<fe;++Ce)ae.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),W.drawElements(W.LINES,ue,W.UNSIGNED_SHORT,ye)}else F&&F>1?W.drawElementsInstanced(W.LINES,ue,W.UNSIGNED_SHORT,ye,F):W.drawElements(W.LINES,ue,W.UNSIGNED_SHORT,ye);b.bind(),V.program.set(this.program),V.setDepthMode(a),V.setStencilMode(p),V.setColorMode(x)}checkUniforms(n,a,p){if(this.fixedDefines.includes(a)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${x} not set but required by ${a} being defined`)}}draw(n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae){const re=n.context,ue=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(p),re.setStencilMode(x),re.setColorMode(b),re.setCullFace(T);for(const Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,M[Ce]);K&&K.setUniforms(this.program,re,this.binderUniforms,V,{zoom:W});const ye={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[a];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const fe=ae&&ae>0?1:void 0;for(const Ce of G.get()){const be=Ce.vaos||(Ce.vaos={});if((be[D]||(be[D]=new yd)).bind(re,this,k,K?K.getPaintVertexBuffers():[],F,Ce.vertexOffset,J||[],fe),this.forceManualRenderingForInstanceIDShaders){const De=ae||1;for(let Te=0;Te<De;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),F?ue.drawElements(a,Ce.primitiveLength*ye,ue.UNSIGNED_SHORT,Ce.primitiveOffset*ye*2):ue.drawArrays(a,Ce.vertexOffset,Ce.vertexLength)}else ae&&ae>1?ue.drawElementsInstanced(a,Ce.primitiveLength*ye,ue.UNSIGNED_SHORT,Ce.primitiveOffset*ye*2,ae):F?ue.drawElements(a,Ce.primitiveLength*ye,ue.UNSIGNED_SHORT,Ce.primitiveOffset*ye*2):ue.drawArrays(a,Ce.vertexOffset,Ce.vertexLength);a===ue.TRIANGLES&&F&&this._drawDebugWireframe(n,p,x,b,F,Ce,V,W,K,ae)}}}function Yf(f,n,a=0){const p=Math.pow(2,n.tileID.overscaledZ),x=n.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=x*(n.tileID.canonical.x+n.tileID.wrap*p),T=x*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(n,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T],u_pattern_transition:a}}const jh={terrain:0,flat:1},Qf=s.bB(),_c=(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re)=>{const ue=n.style.light,ye=ue.properties.get("position"),fe=[ye.x,ye.y,ye.z],Ce=s.dN();ue.properties.get("anchor")==="viewport"&&(s.dO(Ce,-n.transform.angle),s.dP(fe,fe,Ce));const be=ue.properties.get("color").toPremultipliedRenderColor(null),De=n.transform,Te={u_matrix:f,u_lightpos:fe,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+a,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:jh[k],u_base_type:jh[F],u_ao:x,u_edge_radius:b,u_width_scale:T,u_flood_light_color:K,u_vertical_scale:J,u_flood_light_intensity:ae,u_ground_shadow_factor:re};return De.projection.name==="globe"&&(Te.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],Te.u_zoom_transition=G,Te.u_inv_rot_matrix=W,Te.u_merc_center=V,Te.u_up_dir=De.projection.upVector(new s.cC(0,0,0),V[0]*s.al,V[1]*s.al),Te.u_height_lift=D),Te},Jp=(f,n,a,p,x,b)=>({u_matrix:f,u_edge_radius:n,u_width_scale:a,u_vertical_scale:p,u_height_type:jh[x],u_base_type:jh[b]}),Jf=(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re)=>{const ue=_c(f,n,a,p,x,b,T,M,k,F,G,V,W,K,J,ae,1,[0,0,0]),ye={u_height_factor:-Math.pow(2,M.overscaledZ)/D.tileSize/8};return Object.assign(ue,Yf(n,D,re),ye)},Sd=(f,n,a,p,x,b,T,M,D,k,F)=>({u_matrix:n,u_opacity:a,u_ao_pass:p?1:0,u_meter_to_tile:x,u_ao:b,u_flood_light_intensity:T,u_flood_light_color:M,u_attenuation:D,u_edge_radius:k,u_fb:0,u_fb_size:F,u_dynamic_offset:1}),Td=(f,n,a)=>({u_matrix:f,u_emissive_strength:n,u_ground_shadow_factor:a}),em=(f,n,a,p,x,b=0)=>Object.assign(Td(f,n,x),Yf(a,p,b)),tm=(f,n,a,p)=>({u_matrix:f,u_world:a,u_emissive_strength:n,u_ground_shadow_factor:p}),nm=(f,n,a,p,x,b,T=0)=>Object.assign(em(f,n,a,p,b,T),{u_world:x}),sy=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n}),ep=(f,n,a,p,x)=>({u_matrix:f,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:a,u_height_scale:p,u_reset_depth:x}),Kc=(f,n,a,p,x,b,T,M,D)=>({u_matrix:f,u_normal_matrix:n,u_opacity:a,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:b,u_facade_emissive_chance:T,u_flood_light_color:M,u_flood_light_intensity:D}),Yc=f=>({u_matrix:f}),Rg=f=>({u_matrix:f}),Ed=(f,n,a,p,x,b,T,M)=>{const D=s.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:n,u_camera_to_center_distance:a.getCameraToCenterDistance(M),u_extrude_scale:[a.pixelsToGLUnits[0]/D,a.pixelsToGLUnits[1]/D],u_zoom_transition:p,u_tile_id:T,u_merc_center:x}},Eu=(f,n,a=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:a}),Fh=s.bB(),tp=(f,n,a,p,x,b,T)=>{const M=f.transform,D=M.projection.name==="globe",k=D?s.dQ(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:s.ay(a,1,b),F={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:T,u_inv_rot_matrix:Fh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){F.u_inv_rot_matrix=p,F.u_merc_center=x,F.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],F.u_zoom_transition=s.aj(M.zoom);const G=x[0]*s.al,V=x[1]*s.al;F.u_up_dir=M.projection.upVector(new s.cC(0,0,0),G,V)}return F};function Au(f,[n,a,p,x],[b,T]){if(b===T)return[0,0,0,0];const M=255*(f-1)/(f*(T-b));return[n*M,a*M,p*M,x*M]}function vl(f,n,[a,p]){return a===p?0:.5/f+(n-a)*(f-1)/(f*(p-a))}const Bh=(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re,ue,ye,fe)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:k,u_fade_t:F.mix,u_opacity:F.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:s.dS(G.paint.get("raster-saturation")),u_contrast_factor:s.dR(G.paint.get("raster-contrast")),u_spin_weights:yc(G.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:W,u_zoom_transition:T,u_merc_center:M,u_cutoff_params:D,u_colorization_mix:Au(s.dT,J,re),u_colorization_offset:vl(s.dT,ae,re),u_color_ramp:K,u_texture_offset:[ye/(ue+2*ye),ue/(ue+2*ye)],u_texture_res:[ue+2*ye,ue+2*ye],u_emissive_strength:fe});function yc(f){f*=Math.PI/180;const n=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Cu=.05,va=(f,n,a,p,x,b,T,M,D,k,F,G)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:k,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:T,u_merc_center:M,u_cutoff_params:D}),np=(f,n,a,p,x,b,T,M,D,k)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:a,u_velocity:p,u_color_ramp:b,u_velocity_res:x,u_max_speed:T,u_uv_offset:M,u_data_scale:[255*D[0],255*D[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cu,Cu]}),Vh=(f,n,a,p,x,b,T,M,D,k)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:a,u_velocity_res:p,u_max_speed:x,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*D[0],255*D[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cu,Cu]}),xc=s.bB(),vc=(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re,ue,ye,fe,Ce,be,De)=>{const Te=x.transform,Se={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Te.getCameraToCenterDistance(ue),u_rotate_symbol:+a,u_aspect_ratio:Te.width/Te.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+k,u_elevation_from_sea:D?1:0,u_pitch_with_map:+p,u_texsize:F,u_texsize_icon:G,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xc,u_up_vector:[0,-1,0],u_color_adj_mat:Ce,u_icon_transition:be||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(ue)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:De||1,u_ground_shadow_factor:ye,u_inv_matrix:s.bk(s.bB(),T),u_normal_scale:fe,u_lutTexture:ho.LUT};return ue.name==="globe"&&(Se.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],Se.u_zoom_transition=K,Se.u_inv_rot_matrix=ae,Se.u_merc_center=J,Se.u_camera_forward=Te._camera.forward(),Se.u_ecef_origin=s.dU(Te.globeMatrix,W.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(Te.globeMatrix),Se.u_up_vector=re),Se},Ru=(f,n,a,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:a,u_color:p}),Uh=(f,n,a,p,x,b,T,M,D)=>Object.assign((function(k,F,G,V,W,K){const{width:J,height:ae}=V.imageManager.getPixelSize(F),re=Math.pow(2,K.tileID.overscaledZ),ue=K.tileSize*Math.pow(2,V.transform.tileZoom)/re,ye=ue*(K.tileID.canonical.x+K.tileID.wrap*re),fe=ue*K.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[J,ae],u_pattern_size:G.displaySize,u_pattern_units_to_pixels:W?[V.transform.width,-1*V.transform.height]:[1/s.ay(K,1,V.transform.tileZoom),1/s.ay(K,1,V.transform.tileZoom)],u_pixel_coord_upper:[ye>>16,fe>>16],u_pixel_coord_lower:[65535&ye,65535&fe]}})(0,b,T,p,M,D),{u_matrix:f,u_emissive_strength:n,u_opacity:a}),ip=new Float32Array(s.bz([])),Mu=(f,n,a,p,x,b,T,M,D,k,F,G,V,W=[0,0,0],K,J,ae)=>{const re=x.style.light,ue=re.properties.get("position"),ye=[-ue.x,-ue.y,ue.z],fe=s.dN();re.properties.get("anchor")==="viewport"&&(s.dO(fe,-x.transform.angle),s.dP(ye,ye,fe));const Ce=F.alphaMode==="MASK",be=re.properties.get("color").toNonPremultipliedRenderColor(null),De=V.paint.get("model-ambient-occlusion-intensity"),Te=V.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return Te.a=V.paint.get("model-color-mix-intensity").constantOr(0),ae&&(Te.r=ae[0],Te.g=ae[1],Te.b=ae[2],Te.a=ae[3]),J&&(Te.r=J.color.r,Te.g=J.color.g,Te.b=J.color.b,Te.a=J.colorMix,G=J.emissionStrength,b=J.opacity),{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:a,u_node_matrix:p||ip,u_lightpos:ye,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_camera_pos:W,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ce,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:M.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:D,u_roughnessFactor:k,u_baseColorTexture:ho.BaseColor,u_metallicRoughnessTexture:ho.MetallicRoughness,u_normalTexture:ho.Normal,u_occlusionTexture:ho.Occlusion,u_emissionTexture:ho.Emission,u_lutTexture:ho.LUT,u_color_mix:Te.toArray01(),u_aoIntensity:De,u_emissive_strength:G,u_occlusionTextureTransform:K||[0,0,0,0]}},bc=(f,n=ip,a=ip)=>({u_matrix:f,u_instance:n,u_node_matrix:a}),oy={fillExtrusion:f=>({u_matrix:new s.ck(f),u_lightpos:new s.ch(f),u_lightintensity:new s.ci(f),u_lightcolor:new s.ch(f),u_vertical_gradient:new s.ci(f),u_opacity:new s.ci(f),u_edge_radius:new s.ci(f),u_width_scale:new s.ci(f),u_ao:new s.cj(f),u_height_type:new s.cg(f),u_base_type:new s.cg(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_up_dir:new s.ch(f),u_height_lift:new s.ci(f),u_flood_light_color:new s.ch(f),u_vertical_scale:new s.ci(f),u_flood_light_intensity:new s.ci(f),u_ground_shadow_factor:new s.ch(f)}),fillExtrusionDepth:f=>({u_matrix:new s.ck(f),u_edge_radius:new s.ci(f),u_width_scale:new s.ci(f),u_vertical_scale:new s.ci(f),u_height_type:new s.cg(f),u_base_type:new s.cg(f)}),fillExtrusionPattern:f=>({u_matrix:new s.ck(f),u_lightpos:new s.ch(f),u_lightintensity:new s.ci(f),u_lightcolor:new s.ch(f),u_vertical_gradient:new s.ci(f),u_height_factor:new s.ci(f),u_edge_radius:new s.ci(f),u_width_scale:new s.ci(f),u_ao:new s.cj(f),u_height_type:new s.cg(f),u_base_type:new s.cg(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_up_dir:new s.ch(f),u_height_lift:new s.ci(f),u_image:new s.cg(f),u_texsize:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_tile_units_to_pixels:new s.ci(f),u_opacity:new s.ci(f),u_pattern_transition:new s.ci(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.ck(f),u_opacity:new s.ci(f),u_ao_pass:new s.ci(f),u_meter_to_tile:new s.ci(f),u_ao:new s.cj(f),u_flood_light_intensity:new s.ci(f),u_flood_light_color:new s.ch(f),u_attenuation:new s.ci(f),u_edge_radius:new s.ci(f),u_fb:new s.cg(f),u_fb_size:new s.ci(f),u_dynamic_offset:new s.ci(f)}),fill:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_ground_shadow_factor:new s.ch(f)}),fillPattern:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_image:new s.cg(f),u_texsize:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_tile_units_to_pixels:new s.ci(f),u_ground_shadow_factor:new s.ch(f),u_pattern_transition:new s.ci(f)}),fillOutline:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_world:new s.cj(f),u_ground_shadow_factor:new s.ch(f)}),fillOutlinePattern:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_world:new s.cj(f),u_image:new s.cg(f),u_texsize:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_tile_units_to_pixels:new s.ci(f),u_ground_shadow_factor:new s.ch(f),u_pattern_transition:new s.ci(f)}),building:f=>({u_matrix:new s.ck(f),u_normal_matrix:new s.ck(f),u_opacity:new s.ci(f),u_faux_facade_ao_intensity:new s.ci(f),u_camera_pos:new s.ch(f),u_tile_to_meter:new s.ci(f),u_facade_emissive_chance:new s.ci(f),u_flood_light_color:new s.ch(f),u_flood_light_intensity:new s.ci(f)}),buildingBloom:f=>({u_matrix:new s.ck(f)}),buildingDepth:f=>({u_matrix:new s.ck(f)}),elevatedStructuresDepth:f=>({u_matrix:new s.ck(f),u_depth_bias:new s.ci(f)}),elevatedStructures:f=>({u_matrix:new s.ck(f),u_ground_shadow_factor:new s.ch(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new s.ck(f),u_camera_pos:new s.ch(f),u_depth_bias:new s.ci(f),u_height_scale:new s.ci(f),u_reset_depth:new s.ci(f)}),circle:s.dX,collisionBox:f=>({u_matrix:new s.ck(f),u_inv_rot_matrix:new s.ck(f),u_camera_to_center_distance:new s.ci(f),u_extrude_scale:new s.cj(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_tile_id:new s.ch(f)}),collisionCircle:f=>({u_matrix:new s.ck(f),u_inv_matrix:new s.ck(f),u_camera_to_center_distance:new s.ci(f),u_viewport_size:new s.cj(f)}),debug:f=>({u_color:new s.dA(f),u_matrix:new s.ck(f),u_overlay:new s.cg(f),u_overlay_scale:new s.ci(f)}),clippingMask:f=>({u_matrix:new s.ck(f)}),heatmap:f=>({u_extrude_scale:new s.ci(f),u_intensity:new s.ci(f),u_matrix:new s.ck(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_up_dir:new s.ch(f)}),heatmapTexture:f=>({u_image:new s.cg(f),u_color_ramp:new s.cg(f),u_opacity:new s.ci(f)}),hillshade:f=>({u_matrix:new s.ck(f),u_image:new s.cg(f),u_latrange:new s.cj(f),u_light:new s.cj(f),u_shadow:new s.dA(f),u_highlight:new s.dA(f),u_emissive_strength:new s.ci(f),u_accent:new s.dA(f)}),hillshadePrepare:f=>({u_matrix:new s.ck(f),u_image:new s.cg(f),u_dimension:new s.cj(f),u_zoom:new s.ci(f)}),line:s.dW,linePattern:s.dV,raster:f=>({u_matrix:new s.ck(f),u_normalize_matrix:new s.ck(f),u_globe_matrix:new s.ck(f),u_merc_matrix:new s.ck(f),u_grid_matrix:new s.dB(f),u_tl_parent:new s.cj(f),u_scale_parent:new s.ci(f),u_fade_t:new s.ci(f),u_opacity:new s.ci(f),u_image0:new s.cg(f),u_image1:new s.cg(f),u_brightness_low:new s.ci(f),u_brightness_high:new s.ci(f),u_saturation_factor:new s.ci(f),u_contrast_factor:new s.ci(f),u_spin_weights:new s.ch(f),u_perspective_transform:new s.cj(f),u_raster_elevation:new s.ci(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_cutoff_params:new s.d2(f),u_colorization_mix:new s.d2(f),u_colorization_offset:new s.ci(f),u_color_ramp:new s.cg(f),u_texture_offset:new s.cj(f),u_texture_res:new s.cj(f),u_emissive_strength:new s.ci(f)}),rasterParticle:f=>({u_matrix:new s.ck(f),u_normalize_matrix:new s.ck(f),u_globe_matrix:new s.ck(f),u_merc_matrix:new s.ck(f),u_grid_matrix:new s.dB(f),u_tl_parent:new s.cj(f),u_scale_parent:new s.ci(f),u_fade_t:new s.ci(f),u_opacity:new s.ci(f),u_image0:new s.cg(f),u_image1:new s.cg(f),u_raster_elevation:new s.ci(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_cutoff_params:new s.d2(f)}),rasterParticleTexture:f=>({u_texture:new s.cg(f),u_opacity:new s.ci(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.cg(f),u_particle_texture_side_len:new s.ci(f),u_tile_offset:new s.cj(f),u_velocity:new s.cg(f),u_color_ramp:new s.cg(f),u_velocity_res:new s.cj(f),u_max_speed:new s.ci(f),u_uv_offset:new s.cj(f),u_data_scale:new s.cj(f),u_data_offset:new s.ci(f),u_particle_pos_scale:new s.ci(f),u_particle_pos_offset:new s.cj(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.cg(f),u_particle_texture_side_len:new s.ci(f),u_velocity:new s.cg(f),u_velocity_res:new s.cj(f),u_max_speed:new s.ci(f),u_speed_factor:new s.ci(f),u_reset_rate:new s.ci(f),u_rand_seed:new s.ci(f),u_uv_offset:new s.cj(f),u_data_scale:new s.cj(f),u_data_offset:new s.ci(f),u_particle_pos_scale:new s.ci(f),u_particle_pos_offset:new s.cj(f)}),symbol:f=>({u_is_size_zoom_constant:new s.cg(f),u_is_size_feature_constant:new s.cg(f),u_size_t:new s.ci(f),u_size:new s.ci(f),u_camera_to_center_distance:new s.ci(f),u_rotate_symbol:new s.cg(f),u_aspect_ratio:new s.ci(f),u_fade_change:new s.ci(f),u_matrix:new s.ck(f),u_label_plane_matrix:new s.ck(f),u_coord_matrix:new s.ck(f),u_is_text:new s.cg(f),u_elevation_from_sea:new s.cg(f),u_pitch_with_map:new s.cg(f),u_texsize:new s.cj(f),u_texsize_icon:new s.cj(f),u_texture:new s.cg(f),u_texture_icon:new s.cg(f),u_gamma_scale:new s.ci(f),u_device_pixel_ratio:new s.ci(f),u_tile_id:new s.ch(f),u_zoom_transition:new s.ci(f),u_inv_rot_matrix:new s.ck(f),u_merc_center:new s.cj(f),u_camera_forward:new s.ch(f),u_tile_matrix:new s.ck(f),u_up_vector:new s.ch(f),u_ecef_origin:new s.ch(f),u_is_halo:new s.cg(f),u_icon_transition:new s.ci(f),u_color_adj_mat:new s.ck(f),u_scale_factor:new s.ci(f),u_ground_shadow_factor:new s.ch(f),u_inv_matrix:new s.ck(f),u_normal_scale:new s.ci(f),u_lutTexture:new s.cg(f)}),background:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_opacity:new s.ci(f),u_color:new s.dA(f)}),backgroundPattern:f=>({u_matrix:new s.ck(f),u_emissive_strength:new s.ci(f),u_opacity:new s.ci(f),u_image:new s.cg(f),u_pattern_tl:new s.cj(f),u_pattern_br:new s.cj(f),u_texsize:new s.cj(f),u_pattern_size:new s.cj(f),u_pixel_coord_upper:new s.cj(f),u_pixel_coord_lower:new s.cj(f),u_pattern_units_to_pixels:new s.cj(f)}),terrainRaster:f=>({u_matrix:new s.ck(f),u_image0:new s.cg(f),u_skirt_height:new s.ci(f),u_ground_shadow_factor:new s.ch(f)}),skybox:f=>({u_matrix:new s.ck(f),u_sun_direction:new s.ch(f),u_cubemap:new s.cg(f),u_opacity:new s.ci(f),u_temporal_offset:new s.ci(f)}),skyboxGradient:f=>({u_matrix:new s.ck(f),u_color_ramp:new s.cg(f),u_center_direction:new s.ch(f),u_radius:new s.ci(f),u_opacity:new s.ci(f),u_temporal_offset:new s.ci(f)}),skyboxCapture:f=>({u_matrix_3f:new s.dB(f),u_sun_direction:new s.ch(f),u_sun_intensity:new s.ci(f),u_color_tint_r:new s.d2(f),u_color_tint_m:new s.d2(f),u_luminance:new s.ci(f)}),globeRaster:f=>({u_proj_matrix:new s.ck(f),u_globe_matrix:new s.ck(f),u_normalize_matrix:new s.ck(f),u_merc_matrix:new s.ck(f),u_zoom_transition:new s.ci(f),u_merc_center:new s.cj(f),u_image0:new s.cg(f),u_grid_matrix:new s.dB(f),u_skirt_height:new s.ci(f),u_far_z_cutoff:new s.ci(f),u_frustum_tl:new s.ch(f),u_frustum_tr:new s.ch(f),u_frustum_br:new s.ch(f),u_frustum_bl:new s.ch(f),u_globe_pos:new s.ch(f),u_globe_radius:new s.ci(f),u_viewport:new s.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.ch(f),u_frustum_tr:new s.ch(f),u_frustum_br:new s.ch(f),u_frustum_bl:new s.ch(f),u_horizon:new s.ci(f),u_transition:new s.ci(f),u_fadeout_range:new s.ci(f),u_atmosphere_fog_color:new s.d2(f),u_high_color:new s.d2(f),u_space_color:new s.d2(f),u_temporal_offset:new s.ci(f),u_horizon_angle:new s.ci(f)}),model:f=>({u_matrix:new s.ck(f),u_lighting_matrix:new s.ck(f),u_normal_matrix:new s.ck(f),u_node_matrix:new s.ck(f),u_lightpos:new s.ch(f),u_lightintensity:new s.ci(f),u_lightcolor:new s.ch(f),u_camera_pos:new s.ch(f),u_opacity:new s.ci(f),u_baseColorFactor:new s.d2(f),u_emissiveFactor:new s.d2(f),u_metallicFactor:new s.ci(f),u_roughnessFactor:new s.ci(f),u_baseTextureIsAlpha:new s.cg(f),u_alphaMask:new s.cg(f),u_alphaCutoff:new s.ci(f),u_baseColorTexture:new s.cg(f),u_metallicRoughnessTexture:new s.cg(f),u_normalTexture:new s.cg(f),u_occlusionTexture:new s.cg(f),u_emissionTexture:new s.cg(f),u_lutTexture:new s.cg(f),u_color_mix:new s.d2(f),u_aoIntensity:new s.ci(f),u_emissive_strength:new s.ci(f),u_occlusionTextureTransform:new s.d2(f)}),modelDepth:f=>({u_matrix:new s.ck(f),u_instance:new s.ck(f),u_node_matrix:new s.ck(f)}),groundShadow:f=>({u_matrix:new s.ck(f),u_ground_shadow_factor:new s.ch(f)}),stars:f=>({u_matrix:new s.ck(f),u_up:new s.ch(f),u_right:new s.ch(f),u_intensity_multiplier:new s.ci(f)}),snowParticle:f=>({u_modelview:new s.ck(f),u_projection:new s.ck(f),u_time:new s.ci(f),u_cam_pos:new s.ch(f),u_velocityConeAperture:new s.ci(f),u_velocity:new s.ci(f),u_horizontalOscillationRadius:new s.ci(f),u_horizontalOscillationRate:new s.ci(f),u_boxSize:new s.ci(f),u_billboardSize:new s.ci(f),u_simpleShapeParameters:new s.cj(f),u_screenSize:new s.cj(f),u_thinningCenterPos:new s.cj(f),u_thinningShape:new s.ch(f),u_thinningAffectedRatio:new s.ci(f),u_thinningParticleOffset:new s.ci(f),u_particleColor:new s.d2(f),u_direction:new s.ch(f)}),rainParticle:f=>({u_modelview:new s.ck(f),u_projection:new s.ck(f),u_time:new s.ci(f),u_cam_pos:new s.ch(f),u_texScreen:new s.cg(f),u_velocityConeAperture:new s.ci(f),u_velocity:new s.ci(f),u_boxSize:new s.ci(f),u_rainDropletSize:new s.cj(f),u_distortionStrength:new s.ci(f),u_rainDirection:new s.ch(f),u_color:new s.d2(f),u_screenSize:new s.cj(f),u_thinningCenterPos:new s.cj(f),u_thinningShape:new s.ch(f),u_thinningAffectedRatio:new s.ci(f),u_thinningParticleOffset:new s.ci(f),u_shapeDirectionalPower:new s.ci(f),u_shapeNormalPower:new s.ci(f),u_mode:new s.ci(f)}),vignette:f=>({u_vignetteShape:new s.ch(f),u_vignetteColor:new s.d2(f)}),occlusion:f=>({u_matrix:new s.ck(f),u_anchorPos:new s.ch(f),u_screenSizePx:new s.cj(f),u_occluderSizePx:new s.cj(f),u_color:new s.d2(f)})};class Qc{constructor(n,a,p,x){this.id=Qc.uniqueIdxCounter,Qc.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Qc.uniqueIdxCounter,Qc.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Qc.uniqueIdxCounter=0;const Ad={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class im{constructor(n,a,p,x,b,T){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=n;const M=n.gl;this.buffer=M.createBuffer(),n.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let p=0;p<this.attributes.length;p++){const x=a.getAttributeLocation(n,this.attributes[p].name);x!==-1&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,a,p){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],T=a.getAttributeLocation(n,b.name);T!==-1&&n.vertexAttribPointer(T,b.components,n[Ad[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,a,p){for(let x=0;x<this.attributes.length;x++){const b=a.getAttributeLocation(n,this.attributes[x].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rp{constructor(n,a,p,x,b){this.context=n,this.width=a,this.height=p;const T=this.framebuffer=n.gl.createFramebuffer();x&&(this.colorAttachment=new bu(n,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new mc(n,T):new Ag(n,T))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class $h{constructor(n,a){this.gl=n,this.clearColor=new Eg(this),this.clearDepth=new Na(this),this.clearStencil=new zh(this),this.colorMask=new Lh(this),this.depthMask=new Wp(this),this.stencilMask=new Uf(this),this.stencilFunc=new Ja(this),this.stencilOp=new _l(this),this.stencilTest=new jl(this),this.depthRange=new fc(this),this.depthTest=new Fl(this),this.depthFunc=new Bl(this),this.blend=new $f(this),this.blendFunc=new Gf(this),this.blendColor=new qc(this),this.blendEquation=new vd(this),this.cullFace=new ro(this),this.cullFaceSide=new hs(this),this.frontFace=new Nr(this),this.program=new pc(this),this.activeTexture=new el(this),this.viewport=new vu(this),this.bindFramebuffer=new Vl(this),this.bindRenderbuffer=new Hf(this),this.bindTexture=new Xp(this),this.bindVertexBuffer=new Zc(this),this.bindElementBuffer=new Ul(this),this.bindVertexArrayOES=new Kp(this),this.pixelStoreUnpack=new Nh(this),this.pixelStoreUnpackPremultiplyAlpha=new Yp(this),this.pixelStoreUnpackFlipY=new yl(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,p){return new Qc(this,n,a,p)}createVertexBuffer(n,a,p,x,b){return new im(this,n,a,p,x,b)}createRenderbuffer(n,a,p){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,n,a,p),this.bindRenderbuffer.set(null),b}createFramebuffer(n,a,p,x){return new rp(this,n,a,p,x)}clear({color:n,depth:a,stencil:p,colorMask:x}){const b=this.gl;let T=0;n&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),a!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.bx(n.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bl;function Ko(f,n,a,p,x,b,T){const M=f.context,D=M.gl,k=f.transform,F=[s.aF(k.center.lng),s.aJ(k.center.lat)],G=a.layout.get("symbol-placement"),V=a.layout.get("text-variable-anchor"),W=a.layout.get("icon-rotation-alignment")==="map",K=a.layout.get("text-rotation-alignment")==="map",J=G!=="point",ae=[];let re=0,ue=0;for(let Se=0;Se<p.length;Se++){const Pe=p[Se],Xe=n.getTile(Pe),Ge=Xe.getBucket(a);if(!Ge)continue;const dt=Ge.getProjection().createInversionMatrix(k,Pe.canonical),it=[],gt=Th(Pe,Ge,k),Ft=!T&&W&&J,Je=T&&K&&J,Ve=V&&Ge.hasTextData(),_t=Ge.hasIconTextFit()&&Ve&&Ge.hasIconData(),rt=Ft||Je||T&&Ve||_t,Pt=Ge.projection.name==="globe",Rt=Pt?s.aj(k.zoom):0;Pt&&(it.push("PROJECTION_GLOBE_VIEW"),rt&&it.push("PROJECTED_POS_ON_VIEWPORT"));const Qt=f.getOrCreateProgram("collisionBox",{defines:it});let bt=gt;x[0]===0&&x[1]===0||(bt=f.translatePosMatrix(gt,Xe,x,b));const St=T?Ge.textCollisionBox:Ge.iconCollisionBox,Jt=Ge.collisionCircleArray;if(Jt.length>0){const rn=s.bB(),pn=bt;s.cO(rn,Ge.placementInvProjMatrix,k.glCoordMatrix),s.cO(rn,rn,Ge.placementViewportMatrix),ae.push({circleArray:Jt,circleOffset:ue,transform:pn,invTransform:rn,projection:Ge.getProjection()}),re+=Jt.length/4,ue=re}if(!St)continue;f.terrain&&f.terrain.setupElevationDraw(Xe,Qt);const cn=Pt?[Pe.canonical.x,Pe.canonical.y,1<<Pe.canonical.z]:[0,0,0];Qt.draw(f,D.LINES,wn.disabled,Yn.disabled,f.colorModeForRenderPass(),Hn.disabled,Ed(bt,dt,k,Rt,F,Xe,cn,Ge.getProjection()),a.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,k.zoom,null,[St.collisionVertexBuffer,St.collisionVertexBufferExt])}if(!T||!ae.length)return;const ye=f.getOrCreateProgram("collisionCircle"),fe=new s.dY;fe.resize(4*re),fe._trim();let Ce=0;for(const Se of ae)for(let Pe=0;Pe<Se.circleArray.length/4;Pe++){const Xe=4*Pe,Ge=Se.circleArray[Xe+0],dt=Se.circleArray[Xe+1],it=Se.circleArray[Xe+2],gt=Se.circleArray[Xe+3];fe.emplace(Ce++,Ge,dt,it,gt,0),fe.emplace(Ce++,Ge,dt,it,gt,1),fe.emplace(Ce++,Ge,dt,it,gt,2),fe.emplace(Ce++,Ge,dt,it,gt,3)}(!bl||bl.length<2*re)&&(bl=(function(Se){const Pe=2*Se,Xe=new s.b0;Xe.resize(Pe),Xe._trim();for(let Ge=0;Ge<Pe;Ge++){const dt=6*Ge;Xe.uint16[dt+0]=4*Ge+0,Xe.uint16[dt+1]=4*Ge+1,Xe.uint16[dt+2]=4*Ge+2,Xe.uint16[dt+3]=4*Ge+2,Xe.uint16[dt+4]=4*Ge+3,Xe.uint16[dt+5]=4*Ge+0}return Xe})(re));const be=M.createIndexBuffer(bl,!0),De=M.createVertexBuffer(fe,s.dZ.members,!0);for(const Se of ae){const Pe={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(Te=k).getCameraToCenterDistance(Se.projection),u_viewport_size:[Te.width,Te.height]};ye.draw(f,D.TRIANGLES,wn.disabled,Yn.disabled,f.colorModeForRenderPass(),Hn.disabled,Pe,a.id,De,be,s.bf.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,k.zoom)}var Te;De.destroy(),be.destroy()}const Eo=s.bB();function wc(f){const n=f._camera.getWorldToCamera(f.worldSize,1),a=s.aB([],n,f.globeMatrix);s.bk(a,a);const p=[0,0,0],x=[0,1,0,0];return s.aC(x,x,a),p[0]=x[0],p[1]=x[1],p[2]=x[2],s.aw(p,p),p}function Gh({width:f,height:n,anchor:a,textOffset:p,textScale:x},b){const{horizontalAlign:T,verticalAlign:M}=s.c0(a),D=-(T-.5)*f,k=-(M-.5)*n,F=s.c1(a,p);return new s.P((D/x+F[0])*b,(k/x+F[1])*b)}function sp(f,n,a,p,x,b,T,M,D,k){const F=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,V=f.icon.dynamicLayoutVertexArray,W={},K=f.getProjection(),J=Fp(T,K,x),ae=x.elevation,re=K.upVectorScale(T.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ue=0;ue<F.length;ue++){const ye=F.get(ue),{tileAnchorX:fe,tileAnchorY:Ce,numGlyphs:be}=ye,De=ye.hidden||!ye.crossTileID||f.allowVerticalPlacement&&!ye.placedOrientation?null:p[ye.crossTileID];if(De){let Te=0,Se=0,Pe=0;const Xe=f.elevationType==="road";if(ae||Xe){const rt=Xe?f.getElevationFeatureForText(ue):null,Pt=s.bU.getAtTileOffset(T,new s.P(fe,Ce),ae,rt),[Rt,Qt,bt]=K.upVector(T.canonical,fe,Ce);Te=Pt*Rt*re,Se=Pt*Qt*re,Pe=Pt*bt*re}let[Ge,dt,it,gt]=Vs(ye.projectedAnchorX+Te,ye.projectedAnchorY+Se,ye.projectedAnchorZ+Pe,a?J:b);const Ft=Pf(x.getCameraToCenterDistance(K),gt);let Je=s.bL(f.textSizeData,D,ye)*Ft/s.bX;a&&(Je*=f.tilePixelRatio/M);const Ve=Gh(De,Je);a?({x:Ge,y:dt,z:it}=K.projectTilePoint(fe+Ve.x,Ce+Ve.y,T.canonical),[Ge,dt,it]=Vs(Ge+Te,dt+Se,it+Pe,b)):(n&&Ve._rotate(-x.angle),Ge+=Ve.x,dt+=Ve.y,it=0);const _t=f.allowVerticalPlacement&&ye.placedOrientation===s.bK.vertical?Math.PI/2:0;for(let rt=0;rt<be;rt++)s.bN(G,Ge,dt,it,_t);k&&ye.associatedIconIndex>=0&&(W[ye.associatedIconIndex]={x:Ge,y:dt,z:it,angle:_t})}else Vc(be,G)}if(k){V.clear();const ue=f.icon.placedSymbolArray;for(let ye=0;ye<ue.length;ye++){const fe=ue.get(ye),{numGlyphs:Ce}=fe,be=W[ye];if(fe.hidden||!be)Vc(Ce,V);else{const{x:De,y:Te,z:Se,angle:Pe}=be;for(let Xe=0;Xe<Ce;Xe++)s.bN(V,De,Te,Se,Pe)}}f.icon.dynamicLayoutVertexBuffer.updateData(V)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function wl(f,n,a,p,x,b,T={}){const M=a.paint.get("icon-translate"),D=a.paint.get("text-translate"),k=a.paint.get("icon-translate-anchor"),F=a.paint.get("text-translate-anchor"),G=a.layout.get("icon-rotation-alignment"),V=a.layout.get("text-rotation-alignment"),W=a.layout.get("icon-pitch-alignment"),K=a.layout.get("text-pitch-alignment"),J=a.layout.get("icon-keep-upright"),ae=a.layout.get("text-keep-upright"),re=a.paint.get("icon-color-saturation"),ue=a.paint.get("icon-color-contrast"),ye=a.paint.get("icon-color-brightness-min"),fe=a.paint.get("icon-color-brightness-max"),Ce=a.layout.get("symbol-elevation-reference")==="sea",be=a.layout.get("icon-image-use-theme")==="none",De=f.context,Te=De.gl,Se=f.transform,Pe=G==="map",Xe=V==="map",Ge=W==="map",dt=K==="map",it=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let gt=!1;const Ft=f.depthModeForSublayer(0,wn.ReadOnly),Je=new wn(f.context.gl.LEQUAL,wn.ReadOnly,f.depthRangeFor3D),Ve=[s.aF(Se.center.lng),s.aJ(Se.center.lat)],_t=a.layout.get("text-variable-anchor"),rt=Se.projection.name==="globe",Pt=[],Rt=[0,-1,0];for(const Qt of p){const bt=n.getTile(Qt),St=bt.getBucket(a);if(!St||St.projection.name==="mercator"&&rt||St.fullyClipped)continue;const Jt=St.projection.name==="globe",cn=Jt?s.aj(Se.zoom):0,rn=Fp(Qt,St.getProjection(),Se),pn=Se.calculatePixelsToTileUnitsMatrix(bt),Fn=_t&&St.hasTextData(),ui=St.hasIconTextFit()&&Fn&&St.hasIconData(),Jn=St.getProjection().createInversionMatrix(Se,Qt.canonical),Vi=(1<<bt.tileID.canonical.z)*s.al/f.transform.worldSize,Vn=Ii=>{let Pn=[0,0,0];if(Ii){const Si=f.style.directionalLight,Tr=f.style.ambientLight;Si&&Tr&&(Pn=Xo(f.style,Si,Tr))}return Pn},Mi=Ii=>{Se.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||f.terrain)&&(Ii.push("DEPTH_D24"),Ii.push("DEPTH_OCCLUSION"))},Xn=Ii=>{a.lut&&!be&&(a.lut.texture||(a.lut.texture=new s.d_(f.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],De.gl.RGBA8)),De.activeTexture.set(De.gl.TEXTURE0+ho.LUT),a.lut.texture&&a.lut.texture.bind(De.gl.LINEAR,De.gl.CLAMP_TO_EDGE),Ii.push("APPLY_LUT_ON_GPU"))},Ui=()=>{const Ii=Pe&&a.layout.get("symbol-placement")!=="point",Pn=[];Mi(Pn),Xn(Pn);const Si=Ii||ui,Tr=St.elevationType==="road",Dr=f.shadowRenderer,Vr=Tr&&Ge&&!!Dr&&Dr.enabled,Yr=Vn(Vr),ca=Tr&&Ge&&!f.terrain?Je:Ft,mo=a.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ge&&Pn.push("PITCH_WITH_MAP_TERRAIN"),Jt&&(Pn.push("PROJECTION_GLOBE_VIEW"),Si&&Pn.push("PROJECTED_POS_ON_VIEWPORT")),mo>0&&St.hasAnySecondaryIcon&&Pn.push("ICON_TRANSITION"),!St.icon.zOffsetVertexBuffer||Tr&&f.terrain||Pn.push("Z_OFFSET"),re===0&&ue===0&&ye===0&&fe===1||Pn.push("COLOR_ADJUSTMENT"),St.sdfIcons&&Pn.push("RENDER_SDF"),Vr&&Pn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Tr&&Ge&&!f.terrain&&St.icon.orientationVertexBuffer&&Pn.push("ELEVATED_ROADS");const so=St.icon.programConfigurations.get(a.id),ps=f.getOrCreateProgram("symbol",{config:so,defines:Pn}),Ba=bt.imageAtlasTexture?bt.imageAtlasTexture.size:[0,0],ns=St.iconSizeData,Va=s.bJ(ns,Se.zoom),ol=Ge||!Se.isOrthographic,oo=sd(rn,bt.tileID.canonical,Ge,Pe,Se,St.getProjection(),pn),Er=Bc(rn,bt.tileID.canonical,Ge,Pe,Se,St.getProjection(),pn),is=f.translatePosMatrix(Er,bt,M,k,!0),ur=f.translatePosMatrix(rn,bt,M,k),Qr=Si?Eo:oo,eo=Pe&&!Ge&&!Ii;let Jr=Rt;!rt&&!Se.mercatorFromTransition||Pe||(Jr=wc(Se));const Ua=Jt?Jr:Rt,Ud=a.getColorAdjustmentMatrix(re,ue,ye,fe),El=vc(ns.kind,Va,eo,Ge,f,ur,Qr,is,Ce,!1,Ba,[0,0],0,Qt,cn,Ve,Jn,Ua,St.getProjection(),Yr,Vi,Ud,mo,null),Bu=bt.imageAtlasTexture?bt.imageAtlasTexture:null,of=a.layout.get("icon-size").constantOr(0)!==1||St.iconsNeedLinear,al=St.sdfIcons||f.options.rotating||f.options.zooming||of||ol?Te.LINEAR:Te.NEAREST,Rc=St.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Gs=f.terrain&&Ge&&Ii?s.bk(s.bB(),oo):Eo;if(Ii&&St.icon){const $a=s.bU.getAtTileOffsetFunc(Qt,Se.center.lat,Se.worldSize,St.getProjection()),Al=Df(rn,bt.tileID.canonical,Ge,Pe,Se,St.getProjection(),pn),vp=a.layout.get("icon-size-scale-range"),bp=s.aA(f.scaleFactor,vp[0],vp[1]);xg(St,rn,f,!1,Al,Er,Ge,J,$a,Qt,bp)}return{program:ps,buffers:St.icon,uniformValues:El,atlasTexture:Bu,atlasTextureIcon:null,atlasInterpolation:al,atlasInterpolationIcon:null,isSDF:St.sdfIcons,hasHalo:Rc,depthMode:ca,tile:bt,renderWithShadows:Vr,labelPlaneMatrixInv:Gs}},Ai=()=>{const Ii=Xe&&a.layout.get("symbol-placement")!=="point",Pn=[],Si=Ii||_t||ui,Tr=St.elevationType==="road",Dr=f.shadowRenderer,Vr=Tr&&dt&&!!Dr&&Dr.enabled,Yr=Vn(Vr),ca=Tr&&dt&&!f.terrain?Je:Ft;f.terrainRenderModeElevated()&&dt&&Pn.push("PITCH_WITH_MAP_TERRAIN"),Jt&&(Pn.push("PROJECTION_GLOBE_VIEW"),Si&&Pn.push("PROJECTED_POS_ON_VIEWPORT")),!St.text.zOffsetVertexBuffer||Tr&&f.terrain||Pn.push("Z_OFFSET"),St.iconsInText&&Pn.push("RENDER_TEXT_AND_SYMBOL"),Pn.push("RENDER_SDF"),Vr&&Pn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Tr&&dt&&!f.terrain&&St.text.orientationVertexBuffer&&Pn.push("ELEVATED_ROADS"),Mi(Pn);const mo=St.text.programConfigurations.get(a.id),so=f.getOrCreateProgram("symbol",{config:mo,defines:Pn});let ps,Ba=[0,0],ns=null;const Va=St.textSizeData;St.iconsInText&&(Ba=bt.imageAtlasTexture?bt.imageAtlasTexture.size:[0,0],ns=bt.imageAtlasTexture?bt.imageAtlasTexture:null,ps=dt||!Se.isOrthographic||f.options.rotating||f.options.zooming||Va.kind==="composite"||Va.kind==="camera"?Te.LINEAR:Te.NEAREST);const ol=bt.glyphAtlasTexture?bt.glyphAtlasTexture.size:[0,0],oo=a.layout.get("text-size-scale-range"),Er=s.aA(f.scaleFactor,oo[0],oo[1]),is=s.bJ(Va,Se.zoom,Er),ur=sd(rn,bt.tileID.canonical,dt,Xe,Se,St.getProjection(),pn),Qr=Bc(rn,bt.tileID.canonical,dt,Xe,Se,St.getProjection(),pn),eo=f.translatePosMatrix(Qr,bt,D,F,!0),Jr=f.translatePosMatrix(rn,bt,D,F),Ua=Si?Eo:ur,Ud=Xe&&!dt&&!Ii;let El=Rt;!rt&&!Se.mercatorFromTransition||Xe||(El=wc(Se));const Bu=vc(Va.kind,is,Ud,dt,f,Jr,Ua,eo,Ce,!0,ol,Ba,0,Qt,cn,Ve,Jn,Jt?El:Rt,St.getProjection(),Yr,Vi,null,null,Er),of=bt.glyphAtlasTexture?bt.glyphAtlasTexture:null,al=Te.LINEAR,Rc=a.paint.get("text-halo-width").constantOr(1)!==0,Gs=f.terrain&&dt&&Ii?s.bk(s.bB(),ur):Eo;if(Ii&&St.text){const $a=s.bU.getAtTileOffsetFunc(Qt,Se.center.lat,Se.worldSize,St.getProjection()),Al=Df(rn,bt.tileID.canonical,dt,Xe,Se,St.getProjection(),pn);xg(St,rn,f,!0,Al,Qr,dt,ae,$a,Qt,Er)}return{program:so,buffers:St.text,uniformValues:Bu,atlasTexture:of,atlasTextureIcon:ns,atlasInterpolation:al,atlasInterpolationIcon:ps,isSDF:!0,hasHalo:Rc,depthMode:ca,tile:bt,renderWithShadows:Vr,labelPlaneMatrixInv:Gs}},zi=St.icon.segments.get().length,Li=St.text.segments.get().length,ii=zi&&!T.onlyText?Ui():null,qi=Li&&!T.onlyIcons?Ai():null,di=a.paint.get("icon-opacity").constantOr(1),gr=a.paint.get("text-opacity").constantOr(1);if(it&&St.canOverlap){gt=!0;const Ii=di&&!T.onlyText?St.icon.segments.get():[],Pn=gr&&!T.onlyIcons?St.text.segments.get():[];for(const Si of Ii)Pt.push({segments:new s.bf([Si]),sortKey:Si.sortKey,state:ii});for(const Si of Pn)Pt.push({segments:new s.bf([Si]),sortKey:Si.sortKey,state:qi})}else T.onlyText||Pt.push({segments:di?St.icon.segments:new s.bf([]),sortKey:0,state:ii}),T.onlyIcons||Pt.push({segments:gr?St.text.segments:new s.bf([]),sortKey:0,state:qi})}gt&&Pt.sort(((Qt,bt)=>Qt.sortKey-bt.sortKey));for(const Qt of Pt){const bt=Qt.state;if(bt)if(f.terrain?f.terrain.setupElevationDraw(bt.tile,bt.program,{useDepthForOcclusion:Se.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:bt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Se.depthOcclusionForSymbolsAndCircles,bt.program),De.activeTexture.set(Te.TEXTURE0),bt.atlasTexture&&bt.atlasTexture.bind(bt.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),bt.atlasTextureIcon&&(De.activeTexture.set(Te.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),bt.renderWithShadows&&f.shadowRenderer.setupShadows(bt.tile.tileID.toUnwrapped(),bt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,bt.program),bt.hasHalo){const St=bt.uniformValues;St.u_is_halo=1,oa(bt.buffers,Qt.segments,a,f,bt.program,bt.depthMode,x,b,St,2),St.u_is_halo=0}else{if(bt.isSDF){const St=bt.uniformValues;bt.hasHalo&&(St.u_is_halo=1,oa(bt.buffers,Qt.segments,a,f,bt.program,bt.depthMode,x,b,St,1)),St.u_is_halo=0}oa(bt.buffers,Qt.segments,a,f,bt.program,bt.depthMode,x,b,bt.uniformValues,1)}}}function oa(f,n,a,p,x,b,T,M,D,k){const F=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,b,T,M,Hn.disabled,D,a.id,f.layoutVertexBuffer,f.indexBuffer,n,a.paint,p.transform.zoom,f.programConfigurations.get(a.id),F,k)}function Qs(f,n){const a=1<<f.canonical.z,p=(n.x*a-f.canonical.x-f.wrap*a)*s.al,x=(n.y*a-f.canonical.y)*s.al,b=s.e7(n.z,n.y);return s.d4(p,x,b)}function Sc(f,n,a,p,x){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,T=new wn(f.context.gl.LEQUAL,wn.ReadWrite,f.depthRangeFor3D),M=new wn(f.context.gl.GREATER,wn.ReadWrite,f.depthRangeFor3D),D=(function(W){let K=.01;return W.isOrthographic&&(K=s.ak(1e-4,K,s.c$(W.pitch>=ud?1:W.pitch/ud))),2*K})(f.transform),k=f.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",G=f.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),V=f.getOrCreateProgram(F);for(const W of p){const K=n.getTile(W),J=K.getBucket(a);if(!J)continue;const ae=J.elevatedStructures;if(!ae)continue;const re=J.elevationBufferData.heightRange,ue=Qs(W.toUnwrapped(),k),ye=f.translatePosMatrix(W.projMatrix,K,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let fe,Ce,be,De;if(x==="initialize"){if(!re||re.min>=1||ae.depthSegments.segments[0].primitiveLength===0)continue;fe=ep(ye,ue,D,1,0),Ce=T,be=ae.depthSegments,De=G}else if(x==="reset"){if(!re||re.min>=0||ae.maskSegments.segments[0].primitiveLength===0)continue;fe=ep(ye,ue,0,0,1),Ce=M,be=ae.maskSegments,De=G}else if(x==="geometry"){if(ae.depthSegments.segments[0].primitiveLength===0)continue;fe=ep(ye,ue,D,1,0),Ce=T,be=ae.depthSegments,De=V}De.draw(f,b.TRIANGLES,Ce,Yn.disabled,si.disabled,Hn.disabled,fe,a.id,ae.vertexBuffer,ae.indexBuffer,be,a.paint,f.transform.zoom)}}function ka(f,n,a){const{painter:p,sourceCache:x,layer:b,coords:T,colorMode:M,elevationType:D,terrainEnabled:k,pass:F}=f,G=p.context.gl,V=b.paint.get("fill-pattern"),W=b.paint.get("fill-pattern-cross-fade"),K=V.constantOr(null);let J=D;D!=="road"||n&&!k||(J="none");const ae=J==="road",re=f.painter.shadowRenderer,ue=ae&&!!re&&re.enabled,ye=new wn(p.context.gl.LEQUAL,wn.ReadOnly,p.depthRangeFor3D);let fe=[0,0,0];if(ue){const De=p.style.directionalLight,Te=p.style.ambientLight;De&&Te&&(fe=Xo(p.style,De,Te))}const Ce=V&&V.constantOr(1),be=(De,Te)=>{let Se,Pe,Xe,Ge,dt;Te?(Se=Ce&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Xe=G.LINES):(Se=Ce?"fillPattern":"fill",Xe=G.TRIANGLES);for(const it of T){const gt=x.getTile(it);if(Ce&&!gt.patternsLoaded())continue;const Ft=gt.getBucket(b);if(!Ft)continue;const Je=n?Ft.elevationBufferData:Ft.bufferData;if(Je.isEmpty())continue;p.prepareDrawTile();const Ve=Je.programConfigurations.get(b.id),_t=p.isTileAffectedByFog(it),rt=[],Pt=[];ae&&(rt.push("ELEVATED_ROADS"),Pt.push(Je.elevatedLayoutVertexBuffer)),ue&&rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ce&&(p.context.activeTexture.set(G.TEXTURE0),gt.imageAtlasTexture&&gt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ve.updatePaintBuffers());let Rt=!1;if(K&&gt.imageAtlas){const cn=gt.imageAtlas,rn=s.e2.from(K),pn=rn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Fn=rn.getSecondary(),ui=cn.patternPositions.get(pn),Jn=Fn?cn.patternPositions.get(Fn.scaleSelf(s.o.devicePixelRatio).toString()):null;Rt=!!ui&&!!Jn,ui&&Ve.setConstantPatternPositions(ui,Jn)}W>0&&(Rt||Ve.getPatternTransitionVertexBuffer("fill-pattern"))&&rt.push("FILL_PATTERN_TRANSITION");const Qt=p.getOrCreateProgram(Se,{config:Ve,overrideFog:_t,defines:rt}),bt=p.translatePosMatrix(it.projMatrix,gt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));ue&&re.setupShadows(gt.tileID.toUnwrapped(),Qt,"vector-tile");const St=b.paint.get("fill-emissive-strength");if(Te){Ge=Je.lineIndexBuffer,dt=Je.lineSegments;const cn=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];Pe=Se==="fillOutlinePattern"&&Ce?nm(bt,St,p,gt,cn,fe,W):tm(bt,St,cn,fe)}else Ge=Je.indexBuffer,dt=Je.triangleSegments,Pe=Ce?em(bt,St,p,gt,fe,W):Td(bt,St,fe);p.uploadCommonUniforms(p.context,Qt,it.toUnwrapped());let Jt=De;(D==="road"&&!k||D==="offset")&&(Jt=ye),Qt.draw(p,Xe,Jt,a||p.stencilModeForClipping(it),M,Hn.disabled,Pe,b.id,Je.layoutVertexBuffer,Ge,dt,b.paint,p.transform.zoom,Ve,Pt)}};p.renderPass===F&&be(p.depthModeForSublayer(1,p.renderPass==="opaque"?wn.ReadWrite:wn.ReadOnly),!1),J==="none"&&p.renderPass==="translucent"&&b.paint.get("fill-antialias")&&be(p.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,wn.ReadOnly),!0)}function jt(f,n,a,p,x,b,T,M){a.resetLayerRenderingStats(f);const D=f.context,k=D.gl,F=f.transform,G=a.paint.get("fill-extrusion-pattern"),V=a.paint.get("fill-extrusion-pattern-cross-fade"),W=G.constantOr(null),K=G.constantOr(1),J=a.paint.get("fill-extrusion-opacity"),ae=f.style.enable3dLights(),re=a.paint.get(ae&&!K?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),re],ye=a.layout.get("fill-extrusion-edge-radius"),fe=ye>0&&!a.paint.get("fill-extrusion-rounded-roof"),Ce=fe?0:ye,be=F.projection.name==="globe"?s.ea():0,De=F.projection.name==="globe",Te=De?s.aj(F.zoom):0,Se=[s.aF(F.center.lng),s.aJ(F.center.lat)],Pe=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Xe=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Pe?null:a.lut).toArray01().slice(0,3),Ge=a.paint.get("fill-extrusion-flood-light-intensity"),dt=a.paint.get("fill-extrusion-vertical-scale"),it=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,gt=a.paint.get("fill-extrusion-height-alignment"),Ft=a.paint.get("fill-extrusion-base-alignment"),Je=Qa(f,a.paint.get("fill-extrusion-cutoff-fade-range")),Ve=[];let _t;De&&Ve.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&Ve.push("FAUX_AO"),fe&&Ve.push("ZERO_ROOF_RADIUS"),M&&Ve.push("HAS_CENTROID"),Ge>0&&Ve.push("FLOOD_LIGHT"),Je.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),it&&Ve.push("RENDER_WALL_MODE");const rt=f.renderPass==="shadow",Pt=f.shadowRenderer,Rt=rt&&!!Pt,Qt=rt?Hn.disabled:Hn.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let bt=[0,0,0];if(Pt){const cn=f.style.directionalLight,rn=f.style.ambientLight;cn&&rn&&(bt=Xo(f.style,cn,rn)),rt||(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Pt.useNormalOffset&&Ve.push("NORMAL_OFFSET")),_t=Ve.concat(["SHADOWS_SINGLE_CASCADE"])}const St=Rt?"fillExtrusionDepth":K?"fillExtrusionPattern":"fillExtrusion",Jt=a.getLayerRenderingStats();for(const cn of p){const rn=n.getTile(cn),pn=rn.getBucket(a);if(!pn||pn.projection.name!==F.projection.name)continue;let Fn=!1;Pt&&(Fn=Pt.getMaxCascadeForTile(cn.toUnwrapped())===0);const ui=f.isTileAffectedByFog(cn),Jn=pn.programConfigurations.get(a.id);let Vi=!1;if(W&&rn.imageAtlas){const Li=rn.imageAtlas,ii=s.e2.from(W),qi=ii.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),di=ii.getSecondary(),gr=Li.patternPositions.get(qi),Ii=di?Li.patternPositions.get(di.scaleSelf(s.o.devicePixelRatio).toString()):null;Vi=!!gr&&!!Ii,gr&&Jn.setConstantPatternPositions(gr,Ii)}V>0&&(Vi||Jn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ve.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Vn=f.getOrCreateProgram(St,{config:Jn,defines:Fn?_t:Ve,overrideFog:ui});if(f.terrain&&f.terrain.setupElevationDraw(rn,Vn,{useMeterToDem:!0}),!pn.centroidVertexBuffer){const Li=Vn.getAttributeLocation(k,"a_centroid_pos");Li!==-1&&k.vertexAttrib2f(Li,0,0)}!rt&&Pt&&Pt.setupShadows(rn.tileID.toUnwrapped(),Vn,"vector-tile"),K&&(f.context.activeTexture.set(k.TEXTURE0),rn.imageAtlasTexture&&rn.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Jn.updatePaintBuffers());const Mi=a.paint.get("fill-extrusion-vertical-gradient"),Xn=1/pn.tileToMeter;let Ui;if(rt&&Pt){if(qh(rn.tileID,pn.maxHeight,f))continue;const Li=Pt.calculateShadowPassMatrixFromTile(rn.tileID.toUnwrapped());Ui=Jp(Li,Ce,Xn,dt,gt,Ft)}else{const Li=f.translatePosMatrix(cn.expandedProjMatrix,rn,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ii=F.projection.createInversionMatrix(F,cn.canonical);Ui=K?Jf(Li,f,Mi,J,ue,Ce,Xn,cn,rn,be,gt,Ft,Te,Se,ii,Xe,dt,V):_c(Li,f,Mi,J,ue,Ce,Xn,cn,be,gt,Ft,Te,Se,ii,Xe,dt,Ge,bt)}f.uploadCommonUniforms(D,Vn,cn.toUnwrapped(),null,Je);let Ai=pn.segments;if(F.projection.name==="mercator"&&!rt&&(Ai=pn.getVisibleSegments(rn.tileID,f.terrain,f.transform.getFrustum(0)),!Ai.get().length))continue;if(Jt)if(rt)for(const Li of Ai.get())Jt.numRenderedVerticesInShadowPass+=Li.primitiveLength;else for(const Li of Ai.get())Jt.numRenderedVerticesInTransparentPass+=Li.primitiveLength;const zi=[];(f.terrain||M)&&zi.push(pn.centroidVertexBuffer),De&&zi.push(pn.layoutVertexExtBuffer),it&&zi.push(pn.wallVertexBuffer),Vn.draw(f,D.gl.TRIANGLES,x,b,T,Qt,Ui,a.id,pn.layoutVertexBuffer,pn.indexBuffer,Ai,a.paint,f.transform.zoom,Jn,zi)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class fs{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function ws(f,n,a,p,x,b,T,M,D,k,F,G,V,W,K,J,ae,re,ue,ye){const fe=n.context,Ce=fe.gl,be=n.transform,De=n.transform.zoom,Te=[],Se=f.translate,Pe=f.translateAnchor,Xe=f.edgeRadius,Ge=Qa(n,f.cutoffFadeRange);F==="clear"?(Te.push("CLEAR_SUBPASS"),ye&&(Te.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(Ce.TEXTURE0),ye.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE))):F==="sdf"&&Te.push("SDF_SUBPASS"),re&&Te.push("HAS_CENTROID"),Ge.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const dt=(it,gt,Ft,Je,Ve)=>{let _t=Te;gt.groundRadiusBuffer!=null&&(_t=Te.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const rt=gt.programConfigurations.get(p.id),Pt=n.isTileAffectedByFog(it),Rt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:rt,defines:_t,overrideFog:Pt}),Qt=Sd(n,Je,G,k,Ve,[V,W*Ve],K,J,ae,De>=17?0:Xe*Ve,ye?ye.size[0]:0),bt=[];re&&bt.push(gt.hiddenByLandmarkVertexBuffer),gt.groundRadiusBuffer!=null&&bt.push(gt.groundRadiusBuffer),n.uploadCommonUniforms(fe,Rt,it.toUnwrapped(),null,Ge),Rt.draw(n,fe.gl.TRIANGLES,b,T,M,D,Qt,p.id,gt.vertexBuffer,gt.indexBuffer,Ft,p.paint,De,rt,bt)};for(const it of x){const gt=a.getTile(it),Ft=gt.getBucket(p);if(!Ft||Ft.projection.name!==be.projection.name||!Ft.groundEffect||Ft.groundEffect&&!Ft.groundEffect.hasData())continue;const Je=Ft.groundEffect,Ve=1/Ft.tileToMeter;{const _t=n.translatePosMatrix(it.projMatrix,gt,Se,Pe),rt=Je.getDefaultSegment();dt(it,Je,rt,_t,Ve)}if(ue)for(let _t=0;_t<4;_t++){const rt=s.e8[_t](it),Pt=a.getTile(rt);if(!Pt)continue;const Rt=Pt.getBucket(p);if(!Rt||Rt.projection.name!==be.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const Qt=Rt.groundEffect;let bt,St;_t===0?(bt=[-s.al,0,0],St=1):_t===1?(bt=[s.al,0,0],St=0):_t===2?(bt=[0,-s.al,0],St=3):(bt=[0,s.al,0],St=2);const Jt=Qt.regionSegments[St];if(!Jt)continue;const cn=new Float32Array(16);s.bq(cn,it.projMatrix,bt),dt(it,Qt,Jt,n.translatePosMatrix(cn,gt,Se,Pe),Ve)}}}function $l(f,n,a,p,x,b,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const M=b?b.findDEMTileFor(a):null;if(!(M&&M.dem||T))return;b&&M&&M.dem&&p.selfDEMTileTimestamp!==M.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=M.dem._timestamp);const D=re=>new s.P(Math.ceil((re+s.ec)*s.ed),0),k=re=>{const ue=n.getSource().minzoom,ye=Ce=>{const be=n.getTileByID(Ce);if(be&&be.hasData())return be.getBucket(x)},fe=[0,-1,1];for(const Ce of fe){if(re.overscaledZ+Ce<ue)continue;const be=ye(re.calculateScaledKey(re.overscaledZ+Ce));if(be)return be}},F=[0,0,0],G=(re,ue)=>(F[0]=Math.min(re.min.y,ue.min.y),F[1]=Math.max(re.max.y,ue.max.y),F[2]=s.al-ue.min.x>re.max.x?ue.min.x-s.al:re.max.x,F),V=(re,ue)=>(F[0]=Math.min(re.min.x,ue.min.x),F[1]=Math.max(re.max.x,ue.max.x),F[2]=s.al-ue.min.y>re.max.y?ue.min.y-s.al:re.max.y,F),W=[(re,ue)=>G(re,ue),(re,ue)=>G(ue,re),(re,ue)=>V(re,ue),(re,ue)=>V(ue,re)],K=(re,ue,ye,fe,Ce,be,De)=>{if(!b)return 0;const Te=[[be?ye:re,be?re:ye,0],[be?ye:ue,be?ue:ye,0]],Se=De<0?s.al+De:De,Pe=[be?Se:(re+ue)/2,be?(re+ue)/2:Se,0];return ye===0&&De<0||ye!==0&&De>0?b.getForTilePoints(Ce,[Pe],!0,fe):Te.push(Pe),b.getForTilePoints(a,Te,!0,M),Math.max(Te[0][2],Te[1][2],Pe[2])/b.exaggeration()};for(let re=0;re<4;re++){const ue=p.borderFeatureIndices[re];if(ue.length===0)continue;const ye=s.e8[re](a),fe=k(ye);if(!(fe&&fe instanceof s.e9))continue;const Ce=b?b.findDEMTileFor(ye):null;if(!(Ce&&Ce.dem||T)||(b&&Ce&&Ce.dem&&p.borderDEMTileTimestamp[re]!==Ce.dem._timestamp&&(p.borderDoneWithNeighborZ[re]=-1,p.borderDEMTileTimestamp[re]=Ce.dem._timestamp),p.borderDoneWithNeighborZ[re]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const be=(re<2?1:5)-re,De=fe.borderDoneWithNeighborZ[be]!==p.canonical.z,Te=fe.borderFeatureIndices[be];let Se=0;if(p.canonical.z!==fe.canonical.z){for(const Pe of ue)p.showCentroid(p.featuresOnBorder[Pe]);if(De)for(const Pe of Te)fe.showCentroid(fe.featuresOnBorder[Pe]);p.borderDoneWithNeighborZ[re]=fe.canonical.z,fe.borderDoneWithNeighborZ[be]=p.canonical.z}for(const Pe of ue){const Xe=p.featuresOnBorder[Pe],Ge=p.centroidData[Xe.centroidDataIndex],dt=Xe.borders[re];let it;for(;Se<Te.length;){it=fe.featuresOnBorder[Te[Se]];const gt=it.borders[be];if(gt[1]>dt[0]+3||gt[0]>dt[0]-3)break;fe.showCentroid(it),Se++}if(it&&Se<Te.length){const gt=Se;let Ft=0;for(;!(it.borders[be][0]>dt[1]-3)&&(Ft++,++Se!==Te.length);)it=fe.featuresOnBorder[Te[Se]];it=fe.featuresOnBorder[Te[gt]];let Je=!1;if(Ft>=1){const rt=it.borders[be];Math.abs(dt[0]-rt[0])<3&&Math.abs(dt[1]-rt[1])<3&&(Ft=1,Je=!0,Se=gt+1)}else if(Ft===0){p.showCentroid(Xe);continue}const Ve=fe.centroidData[it.centroidDataIndex];T&&Je&&(((J=Ge).flags|(ae=Ve).flags)&s.eb?(J.flags|=s.eb,ae.flags|=s.eb):(J.flags&=~s.eb,ae.flags&=~s.eb));const _t=Xe.intersectsCount()>1||it.intersectsCount()>1;if(Ft>1)Se=gt,Ge.centroidXY=Ve.centroidXY=new s.P(0,0);else if(Ce&&Ce.dem&&!_t){const rt=W[re](Ge,Ve),Pt=re%2?s.al-1:0,Rt=K(rt[0],Math.min(s.al-1,rt[1]),Pt,Ce,ye,re<2,rt[2]);Ge.centroidXY=Ve.centroidXY=D(Rt)}else _t?Ge.centroidXY=Ve.centroidXY=new s.P(0,0):(Ge.centroidXY=p.encodeBorderCentroid(Xe),Ve.centroidXY=fe.encodeBorderCentroid(it));p.writeCentroidToBuffer(Ge),fe.writeCentroidToBuffer(Ve)}else p.showCentroid(Xe)}p.borderDoneWithNeighborZ[re]=fe.canonical.z,fe.borderDoneWithNeighborZ[be]=p.canonical.z}var J,ae;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const tl=[1,0,0],Ln=[0,1,0],Hh=[0,0,1];function qh(f,n,a){const p=a.transform,x=a.shadowRenderer;if(!x)return!0;const b=f.toUnwrapped(),T=p.tileSize*x._cascades[a.currentShadowCascade].scale;let M=n;if(p.elevation){const J=p.elevation.getMinMaxForTile(f);J&&(M+=J.max)}const D=[...x.shadowDirection];D[2]=-D[2];const k=x.computeSimplifiedTileShadowVolume(b,M,T,D);if(!k)return!1;const F=[tl,Ln,Hh,D,[D[0],0,D[2]],[0,D[1],D[2]]],G=p.projection.name==="globe",V=p.scaleZoom(T),W=s.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,V,!G),K=x.getCurrentCascadeFrustum();return W.intersectsPrecise(k.vertices,k.planes,F)===0||K.intersectsPrecise(k.vertices,k.planes,F)===0}function Jc(f){const{painter:n,source:a,layer:p,coords:x}=f;let b=f.defines;const T=n.context,M=n.renderPass==="shadow",D=n.renderPass==="light-beam",k=n.shadowRenderer,F=s.ee(n.transform.center.lat,n.transform.zoom),G=Qa(n,p.paint.get("building-cutoff-fade-range"));G.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const V of x){const W=a.getTile(V),K=W.getBucket(p);if(!K)continue;k&&k.getMaxCascadeForTile(V.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const J=K.programConfigurations.get(p.id);let ae,re,ue,ye=n.translatePosMatrix(V.expandedProjMatrix,W,[0,0],"map");if(ye=s.cR(s.bB(),ye,[1,1,f.verticalScale]),M&&k){if(qh(W.tileID,K.maxHeight*F,n))continue;let Ce=k.calculateShadowPassMatrixFromTile(W.tileID.toUnwrapped());Ce=s.cR(s.bB(),Ce,[1,1,f.verticalScale]),ue=Rg(Ce),ae=re=n.getOrCreateProgram("buildingDepth",{config:J,defines:b,overrideFog:!1})}else if(D)ae=re=n.getOrCreateProgram("buildingBloom",{config:J,defines:b,overrideFog:!1}),ue=Yc(ye);else{const Ce=n.transform.calculatePosMatrix(V.toUnwrapped(),n.transform.worldSize);s.cR(Ce,Ce,[1,1,f.verticalScale]);const be=s.bB();s.cR(be,Ce,[1,-1,1/F]),s.bk(be,be),s.ef(be,be);const De=n.transform.getFreeCameraOptions().position,Te=1<<V.canonical.z;if(ue=Kc(ye,be,f.opacity,f.facadeAOIntensity,[((De.x-V.wrap)*Te-V.canonical.x)*s.al,(De.y*Te-V.canonical.y)*s.al,De.z*Te*s.al],K.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),re=n.getOrCreateProgram("building",{config:J,defines:b,overrideFog:!1}),f.depthOnly===!0)ae=re;else{const Se=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ae=n.getOrCreateProgram("building",{config:J,defines:Se,overrideFog:!1})}k&&(k.setupShadowsFromMatrix(Ce,re,!0),ae!==re&&k.setupShadowsFromMatrix(Ce,ae,!0))}const fe=(Ce,be)=>{if(D){const De=Ce.entranceBloom;be.draw(n,T.gl.TRIANGLES,f.depthMode,Yn.disabled,f.blendMode,Hn.disabled,ue,p.id,De.layoutVertexBuffer,De.indexBuffer,De.segmentsBucket,p.paint,n.transform.zoom,J,[De.layoutAttenuationBuffer,De.layoutColorBuffer])}else{const De=Ce.segmentsBucket;let Te=[Ce.layoutNormalBuffer,Ce.layoutCentroidBuffer,Ce.layoutColorBuffer,Ce.layoutFloodLightDataBuffer];Ce.layoutFacadePaintBuffer&&(Te=Te.concat([Ce.layoutFacadeDataBuffer,Ce.layoutFacadeVerticalRangeBuffer,Ce.layoutFacadePaintBuffer])),be.draw(n,T.gl.TRIANGLES,f.depthMode,Yn.disabled,f.blendMode,M?Hn.disabled:Hn.backCW,ue,p.id,Ce.layoutVertexBuffer,Ce.indexBuffer,De,p.paint,n.transform.zoom,J,Te)}};n.uploadCommonUniforms(T,re,V.toUnwrapped(),null,G),K.buildingWithoutFacade&&fe(K.buildingWithoutFacade,re),K.buildingWithFacade&&(ae!==re&&n.uploadCommonUniforms(T,ae,V.toUnwrapped(),null,G),fe(K.buildingWithFacade,ae))}}function rm(f,n,a,p,x,b,T,M,D,k,F,G,V){const W=f.context.gl,K=f.depthModeForSublayer(1,wn.ReadOnly,W.LEQUAL,!0),J=.1*(1-(ae=F))+3*ae;var ae;const re=f._showOverdrawInspector,ue=G,ye=new fs;re||ws(ye,f,n,a,p,K,new Yn({func:W.ALWAYS,mask:255},255,255,W.KEEP,W.KEEP,W.REPLACE),new si([W.ONE,W.ONE,W.ONE,W.ONE],s.ao.transparent,[!1,!1,!1,!0],W.MIN),Hn.disabled,x,"sdf",b,T,M,D,k,J,ue,!1);{const fe=re?Yn.disabled:new Yn({func:W.EQUAL,mask:255},255,255,W.KEEP,W.DECR,W.DECR),Ce=re?f.colorModeForRenderPass():new si([W.ONE_MINUS_DST_ALPHA,W.DST_ALPHA,W.ONE,W.ONE],s.ao.transparent,[!0,!0,!0,!0]);ws(ye,f,n,a,p,K,fe,Ce,Hn.disabled,x,"color",b,T,M,D,k,J,ue,!1)}}function Ls(f){return[f[0]*s.eg,f[1]*s.eg,f[2]*s.eg,0]}function op(f,n,a,p,x,b,T,M,D){const k=p.getSource(),F=a.globeSharedBuffers;if(!F)return;let G,V,W;if(n&&(G=p.getTile(n)),k instanceof s.aT?(V=k.texture,W=s.dJ(0,0,a.transform)):G&&n&&(V=G.texture,W=s.dJ(n.canonical.z,n.canonical.x,a.transform)),!V||!W)return;f||(W=s.cR(s.bB(),W,[1,-1,1]));const K=a.context,J=K.gl,ae=x.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,re=a.colorModeForDrapableLayerRenderPass(b),ue=T.defines;ue.push("GLOBE_POLES");const ye=new wn(J.LEQUAL,wn.ReadWrite,a.depthRangeFor3D),fe=Float32Array.from(a.transform.expandedFarZProjMatrix),Ce=Float32Array.from(s.bj(s.dI(new s.cC(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),K.activeTexture.set(J.TEXTURE0),V.bind(ae,J.CLAMP_TO_EDGE),K.activeTexture.set(J.TEXTURE1),V.bind(ae,J.CLAMP_TO_EDGE),"useMipmap"in V&&K.extTextureFilterAnisotropic&&a.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const[be,De,Te,Se]=n?F.getPoleBuffers(n.canonical.z,!1):F.getPoleBuffers(0,!0),Pe=x.paint.get("raster-elevation");let Xe;f?(Xe=be,a.renderDefaultNorthPole=Pe!==0):(Xe=De,a.renderDefaultSouthPole=Pe!==0);const Ge=Ls(T.mix),dt=((gt,Ft,Je,Ve,_t,rt,Pt,Rt,Qt,bt,St,Jt,cn)=>Bh(gt,Ft,Je,new Float32Array(16),new Float32Array(9),[0,0],Ve,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],Rt,2,bt,St,Jt,1,0,cn))(fe,Ce,W,s.aj(a.transform.zoom),0,x,0,Pe,0,Ge,T.offset,T.range,b),it=a.getOrCreateProgram("raster",{defines:ue});a.uploadCommonUniforms(K,it,null),it.draw(a,J.TRIANGLES,ye,D,re,M,dt,x.id,Xe,Te,Se)}function sm(f){const n=f._nearZ,a=f.projection.farthestPixelDistance(f),p=a-n,x=.2*f.height,b=n+x;return[n,a,(b-x-n)/p,(b-n)/p]}function ay(f,n,a,p){if(f)return n instanceof Xs&&f instanceof Ka?n.getTextureDescriptor(f,a,!0):{texture:f.texture,mix:Ls(p.mix),offset:p.offset,buffer:0,tileSize:1}}var ly=s.eh([{name:"a_index",type:"Int16",components:1}]);class ja{constructor(n,a,p,x){const b={width:p[0],height:p[1],data:null},T=n.gl;this.targetColorTexture=new s.T(n,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,T.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(a,x),this.lastInvalidatedAt=0}updateParticleTexture(n,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=a.width*a.height;this.particleTexture0=new s.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.ei;b.reserve(x);for(let T=0;T<x;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,ly.members,!0),this.particleSegment=s.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ap(f,n,a){if(!f)return null;const p=n.getTextureDescriptor(f,a,!0);if(!p)return null;let{texture:x,mix:b,offset:T,tileSize:M,buffer:D,format:k}=p;if(!x||!k)return null;let F=!1;return k==="uint32"&&(F=!0,b[3]=0,b=Au(s.ej,b,[0,a.paint.get("raster-particle-max-speed")]),T=vl(s.ej,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[D/(M+2*D),M/(M+2*D)],tileSize:M,scalarData:F,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function ko(f){const n=f._nearZ,a=f.projection.farthestPixelDistance(f),p=a-n,x=.2*f.height,b=n+x;return[n,a,(b-x-n)/p,(b-n)/p]}const Tc=new s.ao(1,0,0,1),aa=new s.ao(0,1,0,1),$s=new s.ao(0,0,1,1),Zh=new s.ao(1,0,1,1),Cd=new s.ao(0,1,1,1);function Wh(f,n,a,p,x,b){for(let T=0;T<a.length;T++)if(x){const k=new s.ao(p.r*.8,p.g*.8,p.b*.8,1);la(f,n,a[T],p,-1,-1,b),la(f,n,a[T],p,-1,1,b),la(f,n,a[T],p,1,1,b),la(f,n,a[T],p,1,-1,b),la(f,n,a[T],k,0,0,b)}else la(f,n,a[T],p,0,0,b)}function la(f,n,a,p,x,b,T){const M=f.context,D=f.transform,k=M.gl,F=D.projection.name==="globe",G=F?["PROJECTION_GLOBE_VIEW"]:[];let V=s.by(a.projMatrix);if(F&&s.aj(D.zoom)>0){const Ge=s.bi(a.canonical,D),dt=s.ek(Ge);V=s.aB(new Float32Array(16),D.globeMatrix,dt),s.aB(V,D.projMatrix,V)}const W=s.bB();W[12]+=2*x/(s.o.devicePixelRatio*D.width),W[13]+=2*b/(s.o.devicePixelRatio*D.height),s.aB(V,W,V);const K=f.getOrCreateProgram("debug",{defines:G}),J=n.getTileByID(a.key);f.terrain&&f.terrain.setupElevationDraw(J,K);const ae=wn.disabled,re=Yn.disabled,ue=f.colorModeForRenderPass(),ye="$debug";M.activeTexture.set(k.TEXTURE0),f.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),F?J._makeGlobeTileDebugBuffers(f.context,D):J._makeDebugTileBoundsBuffers(f.context,D.projection);const fe=J._tileDebugBuffer||f.debugBuffer,Ce=J._tileDebugIndexBuffer||f.debugIndexBuffer,be=J._tileDebugSegments||f.debugSegments;if(K.draw(f,k.LINE_STRIP,ae,re,ue,Hn.disabled,Eu(V,p.toPremultipliedRenderColor(null)),ye,fe,Ce,be,null,null,null,[J._globeTileDebugBorderBuffer]),T){const Ge=J.latestRawTileData,dt=Math.floor((Ge&&Ge.byteLength||0)/1024);let it=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(it+=` => ${a.overscaledZ}`),it+=` ${J.state}`,it+=` ${dt}kb`,(function(gt,Ft){gt.initDebugOverlayCanvas();const Je=gt.debugOverlayCanvas,Ve=gt.context.gl,_t=gt.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,Je.width,Je.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(Ft,5,5),_t.strokeText(Ft,5,5),gt.debugOverlayTexture.update(Je),gt.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)})(f,it)}const De=n.getTile(a).tileSize,Te=512/Math.min(De,512)*(a.overscaledZ/D.zoom)*.5,Se=J._tileDebugTextBuffer||f.debugBuffer,Pe=J._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Xe=J._tileDebugTextSegments||f.debugSegments;K.draw(f,k.TRIANGLES,ae,re,si.alphaBlended,Hn.disabled,Eu(V,s.ao.transparent.toPremultipliedRenderColor(null),Te),ye,Se,Pe,Xe,null,null,null,[J._globeTileDebugTextBuffer])}function ir(f,n,a,p){Du(f,0,n+a/2,f.transform.width,a,p)}function Iu(f,n,a,p){Du(f,n-a/2,0,a,f.transform.height,p)}function Du(f,n,a,p,x,b){const T=f.context,M=T.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*s.o.devicePixelRatio,a*s.o.devicePixelRatio,p*s.o.devicePixelRatio,x*s.o.devicePixelRatio),T.clear({color:b}),M.disable(M.SCISSOR_TEST)}const om=s.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mg}=om;function Ec(f,n,a,p){f.emplaceBack(n,a,p)}class am{constructor(n){this.vertexArray=new s.el,this.indices=new s.b0,Ec(this.vertexArray,-1,-1,1),Ec(this.vertexArray,1,-1,1),Ec(this.vertexArray,-1,1,1),Ec(this.vertexArray,1,1,1),Ec(this.vertexArray,-1,-1,-1),Ec(this.vertexArray,1,-1,-1),Ec(this.vertexArray,-1,1,-1),Ec(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Mg),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bf.simpleSegment(0,0,36,12)}}function nl(f,n,a,p,x,b){const T=f.context.gl,M=n.paint.get("sky-atmosphere-color"),D=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),F=((G,V,W,K,J)=>({u_matrix_3f:G,u_sun_direction:V,u_sun_intensity:W,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(s.en(s.dN(),p),x,k,M.toPremultipliedRenderColor(null),D.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),a.draw(f,T.TRIANGLES,wn.disabled,Yn.disabled,si.unblended,Hn.frontCW,F,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Pu=s.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Vt{constructor(n){const a=new s.eo;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const p=new s.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,Pu.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const un=s.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Rd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ss{constructor(n){this.colorModeAlphaBlendedWriteRGB=new si([1,es,1,es],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new si([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Rd,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Vt(a);const p=this.params.sizeRange,x=this.params.intensityRange,b=(function(F){const G=s.eq(30),V=[];for(let W=0;W<F;++W){const K=2*Math.PI*G(),J=Math.acos(1-2*G())-.5*Math.PI;V.push(s.d4(Math.cos(J)*Math.cos(K),Math.cos(J)*Math.sin(K),Math.sin(J)))}return V})(this.params.starsCount),T=s.eq(300),M=new s.ep,D=new s.b0;let k=0;for(let F=0;F<b.length;++F){const G=s.c4([],b[F],200),V=Math.max(0,1+.01*p*(1*T()-.5)),W=Math.max(0,1+.01*x*(1*T()-.5));M.emplaceBack(G[0],G[1],G[2],-1,-1,V,W),M.emplaceBack(G[0],G[1],G[2],1,-1,V,W),M.emplaceBack(G[0],G[1],G[2],1,1,V,W),M.emplaceBack(G[0],G[1],G[2],-1,1,V,W),D.emplaceBack(k+0,k+1,k+2),D.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=a.createVertexBuffer(M,un.members),this.starsIdx=a.createIndexBuffer(D),this.starsSegments=s.bf.simpleSegment(0,0,M.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const p=n.context,x=p.gl,b=n.transform,T=new wn(x.LEQUAL,wn.ReadOnly,[0,1]),M=s.aj(b.zoom),D=n.style.getLut(a.scope),k=a.properties.get("color-use-theme")==="none",F=a.properties.get("color").toNonPremultipliedRenderColor(k?null:D),G=a.properties.get("high-color-use-theme")==="none",V=a.properties.get("high-color").toNonPremultipliedRenderColor(G?null:D),W=a.properties.get("space-color-use-theme")==="none",K=a.properties.get("space-color").toNonPremultipliedRenderColor(W?null:D),J=5e-4,ae=s.er(a.properties.get("horizon-blend"),0,1,J,.25),re=s.dD(n,p,b)&&ae===J?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,ue=n.frameCounter/1e3%1,ye=s.ag(b.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(ye,2)-Math.pow(re,2)),Ce=Math.acos(fe/ye),be=De=>{const Te=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];De&&Te.push("ALPHA_PASS");const Se=n.getOrCreateProgram("globeAtmosphere",{defines:Te}),Pe=((Ge,dt,it,gt,Ft,Je,Ve,_t,rt,Pt,Rt,Qt)=>({u_frustum_tl:Ge,u_frustum_tr:dt,u_frustum_br:it,u_frustum_bl:gt,u_horizon:Ft,u_transition:Je,u_fadeout_range:Ve,u_atmosphere_fog_color:_t.toArray01(),u_high_color:rt.toArray01(),u_space_color:Pt.toArray01(),u_temporal_offset:Rt,u_horizon_angle:Qt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,M,ae,F,V,K,ue,Ce);n.uploadCommonUniforms(p,Se);const Xe=this.atmosphereBuffer;Xe&&Se.draw(n,x.TRIANGLES,T,Yn.disabled,De?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Hn.backCW,Pe,De?"atmosphere_glow_alpha":"atmosphere_glow",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)};be(!1),be(!0)}drawStars(n,a){const p=s.aA(a.properties.get("star-intensity"),0,1);if(p===0)return;const x=n.context,b=x.gl,T=n.transform,M=n.getOrCreateProgram("stars"),D=s.c6([]);s.c8(D,D,-T._pitch),s.c7(D,D,-T.angle),s.c8(D,D,s.an(T._center.lat)),s.es(D,D,-s.an(T._center.lng));const k=s.cb(new Float32Array(16),D),F=s.aB([],T.starsProjMatrix,k),G=s.en([],k),V=s.et([],G),W=[0,1,0];s.dP(W,W,V),s.c4(W,W,this.params.sizeMultiplier);const K=[1,0,0];s.dP(K,K,V),s.c4(K,K,this.params.sizeMultiplier);const J=(ae=W,re=K,ue=p,{u_matrix:Float32Array.from(F),u_up:ae,u_right:re,u_intensity_multiplier:ue});var ae,re,ue;n.uploadCommonUniforms(x,M),this.starsVx&&this.starsIdx&&M.draw(n,b.TRIANGLES,wn.disabled,Yn.disabled,this.colorModeAlphaBlendedWriteRGB,Hn.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ye{constructor(){this.visibleTiles=[]}updateBorders(n,a){const p=[],x=[],b=n._getRenderableCoordinates(!1,!0);for(const D of b){const k=n.getTile(D);if(!k.hasData())continue;const F=k.getBucket(a);F&&(F.isEmpty()||(p.push(D.key),x.push({bucket:F,tileID:D.canonical})))}let T=p.length!==this.visibleTiles.length;if(!T){p.sort();for(let D=0;D<p.length;D++)if(p[D]!==this.visibleTiles[D]){T=!0;break}}if(!T)return;const M=new Set;this.visibleTiles=p,x.sort(((D,k)=>D.tileID.z-k.tileID.z||D.tileID.x-k.tileID.x||D.tileID.y-k.tileID.y));for(const D of x){const k=new Array,F=new Array,G=D.bucket;for(const V of G.featuresOnBorder)M.has(V.featureId)?F.push(V.footprintIndex):(M.add(V.featureId),k.push(V.footprintIndex));G.updateFootprintHiddenFlags(k,s.eu,!1),G.updateFootprintHiddenFlags(F,s.eu,!0)}}}function lm(f,n){const a=[...f],p=n.cameraWorldSizeForFog/n.worldSize,x=s.bz([]);return s.cR(x,x,[p,p,1]),s.aB(a,x,a),s.aB(a,n.worldToFogMatrix,a),a}function Md(f,n,a,p,x){const b=a.material,T=p.context,{baseColorTexture:M,metallicRoughnessTexture:D}=b.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:F,emissionTexture:G}=b;function V(K,J,ae){if(K&&(f.push(J),T.activeTexture.set(T.gl.TEXTURE0+ae),K.gfxTexture)){const{minFilter:re,magFilter:ue,wrapS:ye,wrapT:fe}=K.sampler;K.gfxTexture.bindExtraParam(re,ue,ye,fe)}}V(M,"HAS_TEXTURE_u_baseColorTexture",ho.BaseColor),V(D,"HAS_TEXTURE_u_metallicRoughnessTexture",ho.MetallicRoughness),V(k,"HAS_TEXTURE_u_normalTexture",ho.Normal),V(F,"HAS_TEXTURE_u_occlusionTexture",ho.Occlusion),V(G,"HAS_TEXTURE_u_emissionTexture",ho.Emission),x&&(x.texture||(x.texture=new s.d_(p.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+ho.LUT),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(f.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const W=p.shadowRenderer;W&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Ou(f,n,a,p,x,b){const T=a.paint.get("model-opacity").constantOr(1),M=n.context,D=new wn(n.context.gl.LEQUAL,f.isLightMesh?wn.ReadOnly:wn.ReadWrite,n.depthRangeFor3D),k=n.transform,F=f.mesh,G=F.material,V=G.pbrMetallicRoughness,W=n.style.fog;let K;K=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.aB([],p.zScaleMatrix,f.nodeModelMatrix),s.aB(K,p.negCameraPosMatrix,K);const J=s.bk([],K);s.ef(J,J);const ae=a.paint.get("model-color-use-theme").constantOr("default")==="none",re=a.paint.get("model-emissive-strength").constantOr(0),ue=Mu(new Float32Array(f.worldViewProjection),new Float32Array(K),new Float32Array(J),null,n,T,V.baseColorFactor,G.emissiveFactor,V.metallicFactor,V.roughnessFactor,G,re,a,void 0,void 0,f.materialOverride,f.modelColor),ye={defines:[]},fe=[],Ce=n.shadowRenderer;Ce&&(Ce.useNormalOffset=!1),Md(ye.defines,fe,F,n,ae?null:a.lut);let be=null;if(W){const Se=lm(f.nodeModelMatrix,n.transform);if(be=new Float32Array(Se),k.projection.name!=="globe"){const Pe=F.aabb.min,Xe=F.aabb.max,[Ge,dt]=W.getOpacityForBounds(Se,Pe[0],Pe[1],Xe[0],Xe[1]);ye.overrideFog=Ge>=nt||dt>=nt}}const De=Qa(n,a.paint.get("model-cutoff-fade-range"));De.shouldRenderCutoff&&ye.defines.push("RENDER_CUTOFF");const Te=n.getOrCreateProgram("model",ye);n.uploadCommonUniforms(M,Te,null,be,De),n.renderPass!=="shadow"&&Ce&&Ce.setupShadowsFromMatrix(f.nodeModelMatrix,Te),Te.draw(n,M.gl.TRIANGLES,D,x,b,F.material.doubleSided?Hn.disabled:Hn.backCCW,ue,a.id,F.vertexBuffer,F.indexBuffer,F.segments,a.paint,n.transform.zoom,void 0,fe)}function lp(f,n,a){return f.type==="vector"?n.scope:a?"basemap":""}function cp(f,n,a,p,x,b,T,M,D){const k=f.transform,F=!!n.isGeometryBloom&&n.isGeometryBloom;if(F&&f.renderPass==="shadow")return;const G=k.projection.name==="globe"?s.eC(a,k):[...a];s.aB(G,G,n.globalMatrix);const V=s.aB([],p,G);if(n.meshes)for(const W of n.meshes){const K=M.get(W.material.name);if(K&&K.opacity<=0)continue;if(W.material.alphaMode!=="BLEND"){T.push({mesh:W,depth:0,modelIndex:x,worldViewProjection:V,nodeModelMatrix:G,isLightMesh:F,materialOverride:K,modelColor:D});continue}const J=s.af([],W.centroid,V);!k.isOrthographic&&J[2]<=0||b.push({mesh:W,depth:J[2],modelIndex:x,worldViewProjection:V,nodeModelMatrix:G,isLightMesh:F,materialOverride:K,modelColor:D})}if(n.children)for(const W of n.children)cp(f,W,a,p,x,b,T,M,D)}function Id(f,n,a,p){const x=a.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),M=x.calculateShadowPassMatrixFromMatrix(n),D=bc(M);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,Yn.disabled,T,Hn.disabled,D,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,a.transform.zoom,void 0,void 0)}function Dd(f,n,a,p,x,b){for(const T of x){const M=Object.assign({},p);M.part=T;const D={type:"Unknown",id:n,properties:M},k={orientation:f.paint.get("model-rotation").evaluate(D,a)};b.set(T,k)}}function cy(f,n,a,p,x,b){for(const T of x){const M=Object.assign({},p);M.part=T;const D={type:"Unknown",id:n,properties:M},k={color:f.paint.get("model-color").evaluate(D,a),colorMix:f.paint.get("model-color-mix-intensity").evaluate(D,a),opacity:f.paint.get("model-opacity").evaluate(D,a),emissionStrength:f.paint.get("model-emissive-strength").evaluate(D,a)};b.set(T,k)}}function uy(f,n,a,p,x,b){if(a===1)for(const M of x)Ou(M,f,n,b[M.modelIndex],Yn.disabled,f.colorModeForRenderPass());else{for(const M of x)Ou(M,f,n,b[M.modelIndex],Yn.disabled,si.disabled);for(const M of x)Ou(M,f,n,b[M.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}const T=si.additive;for(const M of p)Ou(M,f,n,b[M.modelIndex],Yn.disabled,M.isLightMesh?T:f.colorModeForRenderPass())}function Ig(f,n,a){const p=n.updateZoomBasedPaintProperties(),x=(function(b,T,M){let D,k,F,G=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&G>0){const V=b.terrain,W=V.findDEMTileFor(M);W&&W.dem?D=s.eE.create(V,M,W):G=0}if(G===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),G===T.validForExaggeration&&(G===0||D&&D._demTile&&D._demTile.tileID===T.validForDEMTile.id&&D._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const V in T.instancesPerModel){const W=T.instancesPerModel[V];for(let K=0;K<W.instancedDataArray.length;++K){const J=(D?G*D.getElevationAt(0|W.instancedDataArray.float32[16*K],0|W.instancedDataArray.float32[16*K+1],!0,!0):0)+W.instancesEvaluatedElevation[K];W.instancedDataArray.float32[16*K+6]=J,k=k?Math.min(T.terrainElevationMin,J):J,F=F?Math.max(T.terrainElevationMax,J):J}}return T.terrainElevationMin=k||0,T.terrainElevationMax=F||0,T.validForExaggeration=G,T.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,n,a);(p||x)&&(n.uploaded=!1,n.upload(f.context))}const jo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d8([0,0,0],[s.al,s.al,0])};function cm(f,n){const a=1<<f.canonical.z,p=n.getFreeCameraOptions().position,x=n.elevation,b=f.canonical.x/a,T=(f.canonical.x+1)/a,M=f.canonical.y/a,D=(f.canonical.y+1)/a;let k=n._centerAltitude;if(x){const W=x.getMinMaxForTile(f);W&&W.max>k&&(k=W.max)}const F=s.aA(p.x,b,T)-p.x,G=s.aA(p.y,M,D)-p.y,V=s.ce(k,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(F*F+G*G+V*V))}function Xh(f,n,a,p,x,b,T){const M=f.context,D=f.renderPass==="shadow",k=f.shadowRenderer,F=D&&k?k.getShadowPassDepthMode():new wn(M.gl.LEQUAL,wn.ReadWrite,f.depthRangeFor3D),G=f.isTileAffectedByFog(b),V=f.transform.projection.name==="globe";if(a.meshes)for(const W of a.meshes){const K=V?[]:["MODEL_POSITION_ON_GPU"],J=[];let ae,re,ue;const ye=!V&&p.instancedDataArray.length>20;ye&&K.push("INSTANCED_ARRAYS");const fe=Qa(f,n.paint.get("model-cutoff-fade-range"));if(fe.shouldRenderCutoff&&K.push("RENDER_CUTOFF"),D&&k)ae=f.getOrCreateProgram("modelDepth",{defines:K}),re=bc(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.globalMatrix)),ue=k.getShadowPassColorMode();else{Md(K,J,W,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),ae=f.getOrCreateProgram("model",{defines:K,overrideFog:G});const be=W.material,De=be.pbrMetallicRoughness,Te=n.paint.get("model-opacity").constantOr(1),Se=n.paint.get("model-emissive-strength").constantOr(0);re=Mu(b.expandedProjMatrix,Float32Array.from(a.globalMatrix),new Float32Array(16),null,f,Te,De.baseColorFactor,be.emissiveFactor,De.metallicFactor,De.roughnessFactor,be,Se,n,x),k&&(T.shadowUniformsInitialized?ae.setShadowUniformValues(M,k.getShadowUniformValues()):(k.setupShadows(b.toUnwrapped(),ae,"model-tile"),T.shadowUniformsInitialized=!0)),ue=fe.shouldRenderCutoff||Te<1||be.alphaMode!=="OPAQUE"?si.alphaBlended:si.unblended}f.uploadCommonUniforms(M,ae,b.toUnwrapped(),null,fe);const Ce=W.material.doubleSided?Hn.disabled:Hn.backCCW;if(ye)J.push(p.instancedDataBuffer),ae.draw(f,M.gl.TRIANGLES,F,Yn.disabled,ue,Ce,re,n.id,W.vertexBuffer,W.indexBuffer,W.segments,n.paint,f.transform.zoom,void 0,J,p.instancedDataArray.length);else{const be=D?"u_instance":"u_normal_matrix";for(let De=0;De<p.instancedDataArray.length;++De)re[be]=new Float32Array(p.instancedDataArray.arrayBuffer,64*De,16),ae.draw(f,M.gl.TRIANGLES,F,Yn.disabled,ue,Ce,re,n.id,W.vertexBuffer,W.indexBuffer,W.segments,n.paint,f.transform.zoom,void 0,J)}}if(a.children)for(const W of a.children)Xh(f,n,W,p,x,b,T)}const up=[1,-1,1];function dp(f,n,a,p){if(!a.modelManager)return!0;const x=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,T=n.aabb;let M=!0,D=f.maxHeight;if(D===0){let F=0;for(const G in f.instancesPerModel){const V=x.getModel(G,p);V?F=Math.max(F,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):M=!1}D=f.maxScale*F*1.41+f.maxVerticalOffset,M&&(f.maxHeight=D)}T.max[2]=D,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,s.af(T.min,T.min,n.tileMatrix),s.af(T.max,T.max,n.tileMatrix);const k=T.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=k===2),k===0}function Pd(f,n){const a=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===a||b===x?1:s.aA(((n-a)/(p-a)-x)/(b-x),0,1)}function Od(f,n,a,p){if(n.pitch<20)return 1;const x=n.getWorldToCameraMatrix();s.aB(x,x,f);const b=s.bT(a.min[0],a.min[1],a.min[2],1);let T=s.aC(s.eF(),b,x),M=T,D=T;b[1]=a.max[1],T=s.aC(s.eF(),b,x),M=T[1]<M[1]?T:M,D=T[1]>D[1]?T:D,b[0]=a.max[0],T=s.aC(s.eF(),b,x),M=T[1]<M[1]?T:M,D=T[1]>D[1]?T:D,b[1]=a.min[1],T=s.aC(s.eF(),b,x),M=T[1]<M[1]?T:M,D=T[1]>D[1]?T:D;const k=s.aA(p[0],0,1),F=100*n.pixelsPerMeter*s.aA(p[1],0,1),G=s.aA(p[2],0,1),V=s.eG(s.eF(),M,D,k),W=Math.tan(.5*n.fovX),K=-V[2]*W;if(F===0)return V[1]<-Math.abs(K)?G:1;const J=(-Math.abs(K)-V[1])/F,ae=(ue,ye,fe)=>(1-fe)*ue+fe*ye,re=s.aA(ae(1,G,J),G,1);return ae(1,re,s.aA((n.pitch-20)/20,0,1))}class Dg{}class Pg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,p){{const G=this._storage.get(a.id);if(G)return G.lastUsedFrameIdx=n,G.buf}const x=p.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(b),M=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const D=new s.eI;for(let G=0;G<b/2;G+=3){const V=M[G],W=M[G+1],K=M[G+2];D.emplaceBack(V,W),D.emplaceBack(W,K),D.emplaceBack(K,V)}const k=p.bindVertexArrayOES.current,F=new Dg;return F.buf=new Qc(p,D),F.lastUsedFrameIdx=n,this._storage.set(a.id,F),p.bindVertexArrayOES.set(k),F.buf}update(n){for(const[a,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class dy{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Og=s.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class hy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ao{constructor(n,a){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const fy=s.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Kh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,a){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new s.eJ,M=new s.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(T,fy.members),this.vignetteIdx=n.context.createIndexBuffer(M)}const x=s.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const T={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,wn.disabled,Yn.disabled,si.alphaBlended,Hn.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,x)}var b}}class Ar{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,a){const p=n.getFreeCameraOptions().position,x=p.toAltitude(),b=p.toLngLat(),T=s.an(b.lng),M=s.an(b.lat),D=n.pixelsPerMeter/a,k=T*s.eL,F=s.eL*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const G=-this._offsetYPrev+F,V=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*D,this._accumulatedOffsetY+=G*D,this._accumulatedElevation+=V*D,this._offsetXPrev=k,this._offsetYPrev=F,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function xi(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function um(f){const n=s.eq(1323123451230),a=[];for(let p=0;p<f;++p){const x=2*n()-1,b=2*n()-1,T=2*n()-1;a.push(s.d4(x,b,T))}return a}function ba(f,n,a,p,x){const b=s.aA((x-a)/(p-a),0,1);return(1-b)*f+b*n}class eu{constructor(n){this._movement=new Ar,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Kh,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,a){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,b=s.c6([]);s.c8(b,b,s.an(90)-p._pitch),s.c7(b,b,-p.angle);const T=s.cb(new Float32Array(16),b),M=s.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=s.ef([],M),k=s.aB([],D,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*a,this._prevTime=F,{projectionMatrix:x,modelviewMatrix:k}}}class zd extends eu{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ao(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const p=um(this.particlesCount),x=new s.eM,b=new s.b0;let T=0;const M=s.eq(1323123451230);for(let D=0;D<p.length;++D){const k=p[D],F=[2*M()-1,M(),M(),M()];x.emplaceBack(k[0],k[1],k[2],-1,-1,...F),x.emplaceBack(k[0],k[1],k[2],1,-1,...F),x.emplaceBack(k[0],k[1],k[2],1,1,...F),x.emplaceBack(k[0],k[1],k[2],-1,1,...F),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(x,Og.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(a.revealStart>p)return;const x=ba(0,1,a.revealStart,a.revealStart+a.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];s.aw(T,T);const M=structuredClone(this._vignetteParams);M.strength*=x,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),T=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(n.style.rain.state.vignetteColor));const D=this.updateOnRender(n,b.timeFactor),k=n.context,F=k.gl,G=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(k,{width:n.width,height:n.height,data:null},F.RGBA8)),b.distortionStrength>0&&(k.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const V=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(k,V),k.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const W=[b.color.r,b.color.g,b.color.b,b.color.a],K=(J,ae)=>{const re=xi(this._movement.getPosition(),J),ue=b.dropletSizeX,ye=b.dropletSizeX*b.dropletSizeYScale,fe=n.width/2,Ce=n.height/2,be=ba(0,b.screenThinning.start,0,1,b.screenThinning.intensity),De=ba(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Te=ba(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Se=(Pe={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:J,rainDropletSize:[ue,ye],distortionStrength:b.distortionStrength,rainDirection:T,color:W,screenSize:[G.width,G.height],thinningCenterPos:[fe,Ce],thinningShape:[be,De,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ae?0:1},{u_modelview:Float32Array.from(Pe.modelview),u_projection:Float32Array.from(Pe.projection),u_time:Pe.time,u_cam_pos:Pe.camPos,u_texScreen:0,u_velocityConeAperture:Pe.velocityConeAperture,u_velocity:Pe.velocity,u_boxSize:Pe.boxSize,u_rainDropletSize:Pe.rainDropletSize,u_distortionStrength:Pe.distortionStrength,u_rainDirection:Pe.rainDirection,u_color:Pe.color,u_screenSize:Pe.screenSize,u_thinningCenterPos:Pe.thinningCenterPos,u_thinningShape:Pe.thinningShape,u_thinningAffectedRatio:Pe.thinningAffectedRatio,u_thinningParticleOffset:Pe.thinningParticleOffset,u_shapeDirectionalPower:Pe.shapeDirectionalPower,u_shapeNormalPower:Pe.shapeNormalPower,u_mode:Pe.mode});var Pe;const Xe=Math.round(b.intensity*this.particlesCount),Ge=s.bf.simpleSegment(0,0,4*Xe,2*Xe);V.draw(n,F.TRIANGLES,wn.disabled,Yn.disabled,si.alphaBlended,Hn.disabled,Se,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};b.distortionStrength>0&&K(b.boxSize,!0),K(b.boxSize,!1),this._vignette.draw(n,M)}}const Ac=s.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class hp extends eu{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ao(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const a=n.context;if(!this.particlesVx){const p=um(this.particlesCount),x=new s.eN,b=new s.b0;let T=0;const M=s.eq(1323123451230);for(let D=0;D<p.length;++D){const k=p[D],F=M(),G=M(),V=M(),W=[D/p.length,F,G,V],K=[M(),M()];x.emplaceBack(k[0],k[1],k[2],-1,-1,...W,...K),x.emplaceBack(k[0],k[1],k[2],1,-1,...W,...K),x.emplaceBack(k[0],k[1],k[2],1,1,...W,...K),x.emplaceBack(k[0],k[1],k[2],-1,1,...W,...K),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(x,Ac.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const a=structuredClone(this._params);let p=[-a.direction.x,a.direction.y,-100];s.aw(p,p);const x=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=n.transform.zoom;if(b.revealStart>T)return;const M=ba(0,1,b.revealStart,b.revealStart+b.revealRange,T);x.strength*=M,a.overrideStyleParameters||(a.intensity=n.style.snow.state.density,a.timeFactor=n.style.snow.state.intensity,a.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),a.screenThinning.intensity=n.style.snow.state.centerThinning,a.billboardSize=2.79*n.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(n.style.snow.state.vignetteColor));const D=this.updateOnRender(n,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=n.context,F=k.gl,G=n.transform,V=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(k,V),((W,K,J)=>{const ae=xi(this._movement.getPosition(),W),re=G.width/2,ue=G.height/2,ye=ba(0,J.screenThinning.start,0,1,J.screenThinning.intensity),fe=ba(.001,J.screenThinning.range,0,1,J.screenThinning.intensity),Ce=ba(0,J.screenThinning.particleOffset,0,1,J.screenThinning.intensity),be=(De={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:J.velocityConeAperture,velocity:J.velocity,horizontalOscillationRadius:J.horizontalOscillationRadius,horizontalOscillationRate:J.horizontalOscillationRate,boxSize:W,billboardSize:1*J.billboardSize,simpleShapeParameters:[J.shapeFadeStart,J.shapeFadePower],screenSize:[G.width,G.height],thinningCenterPos:[re,ue],thinningShape:[ye,fe,Math.pow(10,J.screenThinning.fadePower)],thinningAffectedRatio:J.screenThinning.affectedRatio,thinningParticleOffset:Ce,color:[J.color.r,J.color.g,J.color.b,J.color.a],direction:p},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_horizontalOscillationRadius:De.horizontalOscillationRadius,u_horizontalOscillationRate:De.horizontalOscillationRate,u_boxSize:De.boxSize,u_billboardSize:De.billboardSize,u_simpleShapeParameters:De.simpleShapeParameters,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_particleColor:De.color,u_direction:De.direction});var De;const Te=Math.round(J.intensity*this.particlesCount),Se=s.bf.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&V.draw(n,F.TRIANGLES,wn.disabled,Yn.disabled,si.alphaBlended,Hn.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,Se)})(a.boxSize,0,a),this._vignette.draw(n,x)}}const dm={symbol:function(f,n,a,p,x){if(f.renderPass!=="translucent")return;const b=Yn.disabled,T=f.colorModeForRenderPass(),M=a.layout.get("text-variable-anchor"),D=a.layout.get("text-size-scale-range"),k=s.aA(f.scaleFactor,D[0],D[1]);M&&(function(V,W,K,J,ae,re,ue,ye){const fe=W.transform,Ce=ae==="map",be=re==="map";for(const De of V){const Te=J.getTile(De),Se=Te.getBucket(K);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Pe=s.bJ(Se.textSizeData,fe.zoom,ye),Xe=Fp(De,Se.getProjection(),fe),Ge=fe.calculatePixelsToTileUnitsMatrix(Te),dt=sd(Xe,Te.tileID.canonical,be,Ce,fe,Se.getProjection(),Ge),it=Se.hasIconTextFit()&&Se.hasIconData();Pe&&sp(Se,Ce,be,ue,fe,dt,De,Math.pow(2,fe.zoom-Te.tileID.overscaledZ),Pe,it)}})(p,f,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),x,k);const F=a.paint.get("icon-opacity").constantOr(1)!==0,G=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||G)?wl(f,n,a,p,b,T):(F&&wl(f,n,a,p,b,T,{onlyIcons:!0}),G&&wl(f,n,a,p,b,T,{onlyText:!0})),n.map.showCollisionBoxes&&(Ko(f,n,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Ko(f,n,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,a,p){if(f.renderPass!=="translucent")return;const x=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),M=a.layout.get("circle-sort-key").constantOr(1)!==void 0,D=a.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const k=f.context,F=k.gl,G=f.transform,V=!(!f.terrain||!f.terrain.enabled),W=a.layout.get("circle-elevation-reference"),K=f.depthModeForSublayer(0,wn.ReadOnly),J=new wn(f.context.gl.LEQUAL,wn.ReadOnly,f.depthRangeFor3D),ae=W==="none"||V?K:J,re=Yn.disabled,ue=f.colorModeForDrapableLayerRenderPass(D),ye=G.projection.name==="globe",fe=[s.aF(G.center.lng),s.aJ(G.center.lat)],Ce=[];for(let De=0;De<p.length;De++){const Te=p[De],Se=n.getTile(Te),Pe=Se.getBucket(a);if(!Pe||Pe.projection.name!==G.projection.name)continue;const Xe=Pe.programConfigurations.get(a.id),Ge=Pe.layoutVertexBuffer,dt=Pe.globeExtVertexBuffer,it=Pe.indexBuffer,gt=s.d$(a),Ft=[dt],Je=f.isTileAffectedByFog(Te);ye&&gt.push("PROJECTION_GLOBE_VIEW"),gt.push("DEPTH_D24"),f.terrain&&G.depthOcclusionForSymbolsAndCircles&&gt.push("DEPTH_OCCLUSION"),Pe.hasElevation&&!f.terrain&&(gt.push("ELEVATED_ROADS"),Ft.push(Pe.elevatedLayoutVertexBuffer));const Ve=f.getOrCreateProgram("circle",{config:Xe,defines:gt,overrideFog:Je}),_t=G.projection.createInversionMatrix(G,Te.canonical),rt={programConfiguration:Xe,program:Ve,layoutVertexBuffer:Ge,dynamicBuffers:Ft,indexBuffer:it,uniformValues:s.e0(f,Te,Se,_t,fe,a),tile:Se};if(M){const Pt=Pe.segments.get();for(const Rt of Pt)Ce.push({segments:new s.bf([Rt]),sortKey:Rt.sortKey,state:rt})}else Ce.push({segments:Pe.segments,sortKey:0,state:rt})}M&&Ce.sort(((De,Te)=>De.sortKey-Te.sortKey));const be={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const De of Ce){const{programConfiguration:Te,program:Se,layoutVertexBuffer:Pe,dynamicBuffers:Xe,indexBuffer:Ge,uniformValues:dt,tile:it}=De.state,gt=De.segments;f.terrain&&f.terrain.setupElevationDraw(it,Se,be),f.uploadCommonUniforms(k,Se,it.tileID.toUnwrapped()),Se.draw(f,F.TRIANGLES,ae,re,ue,Hn.disabled,dt,a.id,Pe,Ge,gt,a.paint,G.zoom,Te,Xe)}},heatmap:function(f,n,a,p){if(a.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,b=x.gl,T=Yn.disabled,M=new si([b.ONE,b.ONE,b.ONE,b.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(W,K,J,ae){const re=W.gl,ue=K.width*ae,ye=K.height*ae;W.activeTexture.set(re.TEXTURE1),W.viewport.set([0,0,ue,ye]);let fe=J.heatmapFbo;if(!fe||fe&&(fe.width!==ue||fe.height!==ye)){fe&&fe.destroy();const Ce=re.createTexture();re.bindTexture(re.TEXTURE_2D,Ce),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),fe=J.heatmapFbo=W.createFramebuffer(ue,ye,!0,null),(function(be,De,Te,Se,Pe,Xe){const Ge=be.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Pe,Xe,0,Ge.RGBA,be.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Se.colorAttachment.set(Te)})(W,0,Ce,fe,ue,ye)}else re.bindTexture(re.TEXTURE_2D,fe.colorAttachment.get()),W.bindFramebuffer.set(fe.framebuffer)})(x,f,a,f.transform.projection.name==="globe"?.5:.25),x.clear({color:s.ao.transparent});const D=f.transform,k=D.projection.name==="globe",F=k?["PROJECTION_GLOBE_VIEW"]:[],G=k?Hn.frontCCW:Hn.disabled,V=[s.aF(D.center.lng),s.aJ(D.center.lat)];for(let W=0;W<p.length;W++){const K=p[W];if(n.hasRenderableParent(K))continue;const J=n.getTile(K),ae=J.getBucket(a);if(!ae||ae.projection.name!==D.projection.name)continue;const re=f.isTileAffectedByFog(K),ue=ae.programConfigurations.get(a.id),ye=f.getOrCreateProgram("heatmap",{config:ue,defines:F,overrideFog:re}),{zoom:fe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(J,ye),f.uploadCommonUniforms(x,ye,K.toUnwrapped());const Ce=D.projection.createInversionMatrix(D,K.canonical);ye.draw(f,b.TRIANGLES,wn.disabled,T,M,G,tp(f,K,J,Ce,V,fe,a.paint.get("heatmap-intensity")),a.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,a.paint,f.transform.zoom,ue,k?[ae.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(x,b){const T=x.context,M=T.gl,D=b.heatmapFbo;if(!D)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1);let k=b.colorRampTexture;k||(k=b.colorRampTexture=new s.T(T,b.colorRamp,M.RGBA8)),k.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,M.TRIANGLES,wn.disabled,Yn.disabled,x.colorModeForRenderPass(),Hn.disabled,((F,G,V,W)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)})(f,a))},line:function(f,n,a,p){if(f.renderPass!=="translucent")return;const x=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),M=a.paint.get("line-occlusion-opacity"),D=a.layout.get("line-elevation-reference"),k=a.layout.get("line-width-unit")==="meters",F=D==="sea",G=!(!f.terrain||!f.terrain.enabled),V=f.context,W=V.gl;if(a.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const K=a.layout.get("line-cross-slope"),J=K!==void 0,ae=K<1,re=f.colorModeForDrapableLayerRenderPass(T),ue=f.terrain&&f.terrain.renderingToTexture,ye=ue?1:s.o.devicePixelRatio,fe=a.paint.get("line-dasharray"),Ce=fe.constantOr(1),be=a.layout.get("line-cap"),De=fe.constantOr(null),Te=be.constantOr(null),Se=a.paint.get("line-pattern"),Pe=Se.constantOr(1),Xe=a.paint.get("line-pattern-cross-fade"),Ge=Se.constantOr(null),dt=a.paint.get("line-opacity").constantOr(1);let it=!Pe&&dt!==1||f.depthOcclusion&&M>0&&M<1;const gt=a.paint.get("line-gradient"),Ft=Pe?"linePattern":"line",Je=s.e1(a);let Ve;if(ue&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(it=!1),M!==0&&f.depthOcclusion){const Rt=a.paint._values["line-opacity"];Rt&&Rt.value&&Rt.value.kind==="constant"?Ve=Rt.value:s.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Je.push("VARIABLE_LINE_WIDTH");const _t=(Rt,Qt,bt,St,Jt,cn)=>{for(const rn of Rt){const pn=n.getTile(rn);if(Pe&&!pn.patternsLoaded())continue;const Fn=pn.getBucket(a);if(!Fn||Fn.elevationType!=="none"&&!Jt||Fn.elevationType==="none"&&Jt)continue;f.prepareDrawTile();const ui=[...Qt],Jn=f.shadowRenderer,Vi=Fn.elevationType==="road"&&!!Jn&&Jn.enabled;let Vn=[0,0,0];if(Vi){const Pn=f.style.directionalLight,Si=f.style.ambientLight;Pn&&Si&&(Vn=Xo(f.style,Pn,Si)),ui.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mi=Fn.programConfigurations.get(a.id);let Xn=!1;if(Ge&&pn.imageAtlas){const Pn=s.e2.from(Ge),Si=Pn.getPrimary().scaleSelf(ye).toString(),Tr=pn.imageAtlas.patternPositions.get(Si),Dr=Pn.getSecondary(),Vr=Dr?pn.imageAtlas.patternPositions.get(Dr.scaleSelf(ye).toString()):null;Xn=!!Tr&&!!Vr,Tr&&Mi.setConstantPatternPositions(Tr,Vr)}Xe>0&&(Xn||Mi.getPatternTransitionVertexBuffer("line-pattern"))&&ui.push("LINE_PATTERN_TRANSITION");const Ui=f.isTileAffectedByFog(rn),Ai=f.getOrCreateProgram(Ft,{config:Mi,defines:ui,overrideFog:Ui});if(!Pe&&De&&Te&&pn.lineAtlas){const Pn=pn.lineAtlas.getDash(De,Te);Pn&&Mi.setConstantPatternPositions(Pn)}Vi&&Jn.setupShadows(pn.tileID.toUnwrapped(),Ai,"vector-tile");let[zi,Li]=a.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&zi!==Li&&(zi===0&&(zi-=1),Li===1&&(Li+=1));const ii=ue?rn.projMatrix:null,qi=k?1/Fn.tileToMeter/s.ay(pn,1,f.transform.zoom):1,di=k?1/Fn.tileToMeter/s.ay(pn,1,Math.floor(f.transform.zoom)):1,gr=Pe?s.e3(f,pn,a,ii,ye,qi,di,[zi,Li],Vn,Xe):s.e4(f,pn,a,ii,Fn.lineClipsArray.length,ye,qi,di,[zi,Li],Vn);if(gt){const Pn=Fn.gradients[a.id];let Si=Pn.texture;if(a.gradientVersion!==Pn.version){let Tr=256;if(a.stepInterpolant){const Dr=n.getSource().maxzoom,Vr=rn.canonical.z===Dr?Math.ceil(1<<f.transform.maxZoom-rn.canonical.z):1;Tr=s.aA(s.e5(Fn.maxLineLength/s.al*1024*Vr),256,V.maxTextureSize)}Pn.gradient=s.e6({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Tr,image:Pn.gradient||void 0,clips:Fn.lineClipsArray}),Pn.texture?Pn.texture.update(Pn.gradient):Pn.texture=new s.T(V,Pn.gradient,W.RGBA8),Pn.version=a.gradientVersion,Si=Pn.texture}V.activeTexture.set(W.TEXTURE1),Si.bind(a.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Ce&&(V.activeTexture.set(W.TEXTURE0),pn.lineAtlasTexture&&pn.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Mi.updatePaintBuffers()),Pe&&(V.activeTexture.set(W.TEXTURE0),pn.imageAtlasTexture&&pn.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Mi.updatePaintBuffers()),Jt&&!F&&f.terrain.setupElevationDraw(pn,Ai),f.uploadCommonUniforms(V,Ai,rn.toUnwrapped());const Ii=Pn=>{Ve!=null&&(Ve.value=dt*M),Ai.draw(f,W.TRIANGLES,bt,Pn,re,Hn.disabled,gr,a.id,Fn.layoutVertexBuffer,Fn.indexBuffer,Fn.segments,a.paint,f.transform.zoom,Mi,[Fn.layoutVertexBuffer2,Fn.patternVertexBuffer,Fn.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=dt)};if(it&&!Jt){const Pn=f.stencilModeForClipping(rn).ref;Pn===0&&ue&&V.clear({stencil:0});const Si={func:W.EQUAL,mask:255};gr.u_alpha_discard_threshold=.8,Ii(new Yn(Si,Pn,255,W.KEEP,W.KEEP,W.INVERT)),gr.u_alpha_discard_threshold=0,Ii(new Yn(Si,Pn,255,W.KEEP,W.KEEP,W.KEEP))}else gr.u_alpha_discard_threshold=it&&Jt&&cn?.8:0,Ii(Jt?St:f.stencilModeForClipping(rn))}};let rt=f.depthModeForSublayer(0,wn.ReadOnly);const Pt=new wn(f.depthOcclusion?W.GREATER:W.LEQUAL,wn.ReadOnly,f.depthRangeFor3D);if(a.hasNonElevatedBuckets){const Rt=!ue&&f.terrain;M!==0&&Rt?s.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):Rt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):_t(p,Je,rt,Yn.disabled,!1,!0)}if(a.hasElevatedBuckets){D==="hd-road-markup"?G||(rt=Pt,Je.push("ELEVATED_ROADS")):(Je.push("ELEVATED"),rt=Pt,J&&Je.push(ae?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&Je.push("ELEVATION_REFERENCE_SEA"));const Rt=it?f.stencilModeFor3D():Yn.disabled;f.forceTerrainMode=!0,_t(p,Je,rt,Rt,!0,!0),it&&_t(p,Je,rt,Rt,!0,!1),f.forceTerrainMode=!1}it&&(f.resetStencilClippingMasks(),ue&&V.clear({stencil:0})),M===0||f.depthOcclusion||ue||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,a,p){const x=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=a.paint.get("fill-emissive-strength"),M=f.colorModeForDrapableLayerRenderPass(T),D=a.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&x.constantOr(s.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let F="none";a.layout.get("fill-elevation-reference")!=="none"?F="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const G=!(!f.terrain||!f.terrain.enabled),V={painter:f,sourceCache:n,layer:a,coords:p,colorMode:M,elevationType:F,terrainEnabled:G,pass:k};if(f.renderPass!=="shadow")if(F!=="offset"){if(ka(V,!1),F==="road"){const W=!G&&f.renderPass==="translucent";W&&Sc(f,n,a,p,"geometry"),ka(V,!0,Yn.disabled),W&&(function(K){const{painter:J,sourceCache:ae,layer:re,coords:ue,colorMode:ye}=K,fe=J.context.gl,Ce=K.painter.shadowRenderer,be=!!Ce&&Ce.enabled,De=new wn(J.context.gl.LEQUAL,wn.ReadOnly,J.depthRangeFor3D);let Te=[0,0,0];if(be){const Pe=J.style.directionalLight,Xe=J.style.ambientLight;Pe&&Xe&&(Te=Xo(J.style,Pe,Xe))}const Se=Pe=>{for(const Xe of ue){const Ge=ae.getTile(Xe),dt=Ge.getBucket(re);if(!dt)continue;const it=dt.elevatedStructures;if(!it)continue;let gt,Ft;if(Pe?(gt=it.renderableBridgeSegments,Ft=it.bridgeProgramConfigurations.get(re.id)):(gt=it.renderableTunnelSegments,Ft=it.tunnelProgramConfigurations.get(re.id)),!gt||gt.segments[0].primitiveLength===0)continue;Ft.updatePaintBuffers(),J.prepareDrawTile();const Je=J.isTileAffectedByFog(Xe),Ve=[];be&&Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const _t=J.getOrCreateProgram("elevatedStructures",{config:Ft,overrideFog:Je,defines:Ve}),rt=J.translatePosMatrix(Xe.projMatrix,Ge,re.paint.get("fill-translate"),re.paint.get("fill-translate-anchor"));be&&Ce.setupShadows(Ge.tileID.toUnwrapped(),_t,"vector-tile");const Pt=sy(rt,Te);J.uploadCommonUniforms(J.context,_t,Xe.toUnwrapped()),_t.draw(J,fe.TRIANGLES,De,Yn.disabled,ye,Hn.backCCW,Pt,re.id,it.vertexBuffer,it.indexBuffer,gt,re.paint,J.transform.zoom,Ft,[it.vertexBufferNormal])}};Se(!0),Se(!1)})(V)}}else ka(V,!1,f.stencilModeFor3D());else f.shadowRenderer&&F==="road"&&!G&&(function(W){const{painter:K,sourceCache:J,layer:ae,coords:re}=W,ue=K.context.gl,ye=W.painter.shadowRenderer;for(const fe of re){const Ce=J.getTile(fe),be=Ce.getBucket(ae);if(!be)continue;const De=be.elevatedStructures;if(!De||!De.shadowCasterSegments||De.shadowCasterSegments.segments[0].primitiveLength===0)continue;K.prepareDrawTile();const Te=be.bufferData.programConfigurations.get(ae.id),Se=K.isTileAffectedByFog(fe),Pe=K.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:Se}),Xe=ye.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());K.uploadCommonUniforms(K.context,Pe,fe.toUnwrapped());const Ge={u_matrix:Xe,u_depth_bias:0};Pe.draw(K,ue.TRIANGLES,ye.getShadowPassDepthMode(),Yn.disabled,ye.getShadowPassColorMode(),Hn.disabled,Ge,ae.id,De.vertexBuffer,De.indexBuffer,De.shadowCasterSegments,ae.paint,K.transform.zoom,Te)}})(V)},"fill-extrusion":function(f,n,a,p){const x=a.paint.get("fill-extrusion-opacity"),b=f.context,T=b.gl,M=f.terrain,D=M&&M.renderingToTexture;if(x===0)return;const k=f.conflationActive&&f.style.isLayerClipped(a,n.getSource()),F=f.style.order.indexOf(a.fqid);if(k&&(function(G,V,W,K,J){for(const ae of K){const re=V.getTile(ae).getBucket(W);re&&(re.updateReplacement(ae,G.replacementSource,J),re.uploadCentroid(G.context))}})(f,n,a,p,F),M||k)for(const G of p){const V=n.getTile(G).getBucket(a);V&&$l(f.context,n,G,V,a,M,k)}if(f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer;if(M&&x<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const V=G.getShadowPassDepthMode(),W=G.getShadowPassColorMode();jt(f,n,a,p,V,Yn.disabled,W,k)}else if(f.renderPass==="translucent"){const G=!a.paint.get("fill-extrusion-pattern").constantOr(1),V=a.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!D&&V.a!==0){const W=new wn(f.context.gl.LEQUAL,wn.ReadWrite,f.depthRangeFor3D);x===1&&G?jt(f,n,a,p,W,Yn.disabled,si.unblended,k):(jt(f,n,a,p,W,Yn.disabled,si.disabled,k),jt(f,n,a,p,W,f.stencilModeFor3D(),f.colorModeForRenderPass(),k),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&G&&(!M&&f.transform.projection.name!=="globe"||D)){const W=a.paint.get("fill-extrusion-opacity"),K=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=a.paint.get("fill-extrusion-flood-light-intensity"),re=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ue=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(re?null:a.lut).toArray01().slice(0,3),ye=K>0&&J>0,fe=ae>0,Ce=(Te,Se,Pe)=>(1-Pe)*Te+Pe*Se,be=new fs;be.translate=a.paint.get("fill-extrusion-translate"),be.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),be.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),be.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const De=Te=>{const Se=f.depthModeForSublayer(1,wn.ReadOnly,T.LEQUAL,!0),Pe=a.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Xe=Ce(.1,3,Pe),Ge=f._showOverdrawInspector;if(!Ge){const dt=new Yn({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),it=new si([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);ws(be,f,n,a,p,Se,dt,it,Hn.disabled,Te,"sdf",W,K,J,ae,ue,Xe,k,!1)}{const dt=Ge?Yn.disabled:new Yn({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),it=Ge?f.colorModeForRenderPass():new si([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],s.ao.transparent,[!0,!0,!0,!0]);ws(be,f,n,a,p,Se,dt,it,Hn.disabled,Te,"color",W,K,J,ae,ue,Xe,k,!1)}};if(D){const Te=(Se,Pe,Xe)=>{const Ge=f.depthModeForSublayer(1,wn.ReadOnly,T.LEQUAL,!1),dt=a.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),it=Ce(.1,3,dt);{const gt=new si([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0]);ws(be,f,n,a,p,Ge,Yn.disabled,gt,Hn.disabled,Se,"clear",W,K,J,ae,ue,it,k,Pe)}{const gt=new Yn({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Ft=new si([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);ws(be,f,n,a,p,Ge,gt,Ft,Hn.disabled,Se,"sdf",W,K,J,ae,ue,it,k,Pe)}{const gt=Se?T.ZERO:T.ONE_MINUS_DST_ALPHA,Ft=new Yn({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Je=new si([gt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],s.ao.transparent,[!0,!0,!0,!0]);ws(be,f,n,a,p,Ge,Ft,Je,Hn.disabled,Se,"color",W,K,J,ae,ue,it,k,Pe)}{const gt=new si([T.ONE,T.ONE,T.ONE,Se?T.ZERO:T.ONE],s.ao.transparent,[!1,!1,!1,!0],Se?T.FUNC_ADD:T.MAX);ws(be,f,n,a,p,Ge,Yn.disabled,gt,Hn.disabled,Se,"clear",W,K,J,ae,ue,it,k,Pe,Xe)}};if(ye||fe){let Se;if(f.prepareDrawTile(),M){const Pe=M.drapeBufferSize[0],Xe=M.drapeBufferSize[1];Se=M.framebufferCopyTexture,Se&&(!Se||Se.size[0]===Pe&&Se.size[1]===Xe)||(Se&&Se.destroy(),Se=M.framebufferCopyTexture=new s.T(b,new s.q({width:Pe,height:Xe}),T.RGBA8)),Se.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Pe,Xe)}ye&&Te(!0,!1,Se),fe&&Te(!1,!0,Se)}}else ye&&De(!0),fe&&De(!1),(ye||fe)&&f.resetStencilClippingMasks()}}},building:function(f,n,a,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const x=a.paint.get("building-ambient-occlusion-ground-intensity"),b=a.paint.get("building-ambient-occlusion-ground-radius"),T=a.paint.get("building-ambient-occlusion-ground-attenuation"),M=a.paint.get("building-opacity");if(M<=0)return;let D=x>0&&b>0,k=!0;const F=a.paint.get("building-vertical-scale");if(F<=0)return;(!f.shadowRenderer||F<1)&&(k=!1);const G=f.conflationActive&&f.style.isLayerClipped(a,n.getSource()),V=f.style.order.indexOf(a.fqid);if((function(W,K,J,ae,re,ue){for(const ye of ue){const fe=K.getTile(ye).getBucket(J);fe&&(re&&fe.updateReplacement(ye,W.replacementSource,ae),fe.uploadUpdatedIndexBuffer(W.context))}})(f,n,a,V,G,p),(function(W,K,J,ae){for(const re of ae){const ue=K.getTile(re).getBucket(J);ue&&ue.needsEvaluation()&&ue.uploadUpdatedColorBuffer(W.context)}})(f,n,a,p),a.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const W=f.shadowRenderer,K=[],J=W.getShadowPassDepthMode();Jc({painter:f,source:n,layer:a,coords:p,defines:K,blendMode:W.getShadowPassColorMode(),depthMode:J,opacity:M,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let W=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];k&&(W=W.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(W=W.concat("NORMAL_OFFSET"));const K=a.paint.get("building-facade-emissive-chance"),J=a.paint.get("building-ambient-occlusion-intensity"),ae=a.paint.get("building-flood-light-intensity"),re=a.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ue=a.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(re?null:a.lut).toArray01().slice(0,3),ye=a.paint.get("building-flood-light-ground-attenuation"),fe=ae>0,Ce=new wn(f.context.gl.LEQUAL,wn.ReadWrite,f.depthRangeFor3D);M<1&&Jc({painter:f,source:n,layer:a,coords:p,defines:W,blendMode:si.disabled,depthMode:Ce,opacity:M,verticalScale:F,facadeEmissiveChance:K,facadeAOIntensity:J,floodLightIntensity:ae,floodLightColor:ue,depthOnly:!0});const be=f.colorModeForRenderPass();Jc({painter:f,source:n,layer:a,coords:p,defines:W,blendMode:be,depthMode:Ce,opacity:M,verticalScale:F,facadeEmissiveChance:K,facadeAOIntensity:J,floodLightIntensity:ae,floodLightColor:ue}),D&&rm(f,n,a,p,!0,M,x,b,ae,ue,T,G),fe&&rm(f,n,a,p,!1,M,x,b,ae,ue,ye,G)}else if(f.renderPass==="light-beam"){const W=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],K=new wn(f.context.gl.LEQUAL,wn.ReadOnly,f.depthRangeFor3D);Jc({painter:f,source:n,layer:a,coords:p,defines:W,blendMode:si.alphaBlended,depthMode:K,opacity:M,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,n,a,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,b=f.terrain&&f.terrain.renderingToTexture,[T,M]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const D of M){const k=n.getTile(D);if(k.needsHillshadePrepare&&f.renderPass==="offscreen")ry(f,k,a);else if(f.renderPass==="translucent"){const F=f.depthModeForSublayer(0,wn.ReadOnly),G=a.paint.get("hillshade-emissive-strength"),V=f.colorModeForDrapableLayerRenderPass(G),W=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):T[D.overscaledZ];xd(f,D,k,a,F,W,V)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,a,p,x,b){if(f.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",M=a.paint.get("raster-elevation")!==0,D=M&&T;if(f.renderElevatedRasterBackface&&!D)return;const k=f.context,F=k.gl,G=n.getSource(),V=(function(be,De,Te,Se){const Pe=De.paint.get("raster-color"),Xe=be.type==="raster-array",Ge=[],dt=De.paint.get("raster-resampling"),it=De.paint.get("raster-color-mix");let gt=De.paint.get("raster-color-range");const Ft=[it[0],it[1],it[2],0],Je=it[3];let Ve=dt==="nearest"?Se.NEAREST:Se.LINEAR;if(Xe&&(Ge.push("RASTER_ARRAY"),Pe||Ge.push("RASTER_COLOR"),dt==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Ve=Se.NEAREST,!gt&&be.rasterLayers)){const _t=be.rasterLayers.find((({id:rt})=>rt===De.sourceLayer));_t&&_t.fields&&_t.fields.range&&(gt=_t.fields.range)}if(gt=gt||[0,1],Pe){Ge.push("RASTER_COLOR"),Te.activeTexture.set(Se.TEXTURE2),De.updateColorRamp(gt);let _t=De.colorRampTexture;_t||(_t=De.colorRampTexture=new s.T(Te,De.colorRamp,Se.RGBA8)),_t.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}return{mix:Ft,range:gt,offset:Je,defines:Ge,resampling:Ve}})(G,a,k,F);if(G instanceof s.aT&&!p.length&&!T)return;const W=a.paint.get("raster-emissive-strength"),K=f.colorModeForDrapableLayerRenderPass(W),J=f.terrain&&f.terrain.renderingToTexture,ae=!f.options.moving,re=a.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(G instanceof s.aT&&!p.length&&(G.onNorthPole||G.onSouthPole)){const be=M?f.stencilModeFor3D():Yn.disabled;return void op(!!G.onNorthPole,null,f,n,a,W,V,Hn.disabled,be)}if(!p.length)return;const[ue,ye]=G instanceof s.aT||J?[{},p]:f.stencilConfigForOverlap(p),fe=ye[ye.length-1].overscaledZ;D&&V.defines.push("PROJECTION_GLOBE_VIEW"),M&&V.defines.push("RENDER_CUTOFF");const Ce=(be,De,Te)=>{for(const Se of be){const Pe=Se.toUnwrapped(),Xe=n.getTile(Se);if(J&&(!Xe||!Xe.hasData()))continue;k.activeTexture.set(F.TEXTURE0);const Ge=ay(Xe,G,a,V);if(!Ge||!Ge.texture)continue;const{texture:dt,mix:it,offset:gt,tileSize:Ft,buffer:Je}=Ge;let Ve,_t;J?(Ve=wn.disabled,_t=Se.projMatrix):M?(Ve=new wn(F.LEQUAL,wn.ReadWrite,f.depthRangeFor3D),_t=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Pe,ae)):(Ve=f.depthModeForSublayer(Se.overscaledZ-fe,a.paint.get("raster-opacity")===1?wn.ReadWrite:wn.ReadOnly,F.LESS),_t=f.transform.calculateProjMatrix(Pe,ae));const rt=f.terrain&&J?f.terrain.stencilModeForRTTOverlap(Se):ue[Se.overscaledZ],Pt=b?0:a.paint.get("raster-fade-duration");Xe.registerFadeDuration(Pt);const Rt=n.findLoadedParent(Se,0),Qt=Qp(Xe,Rt,n,f.transform,Pt);let bt,St;!Qt.isFading&&Xe.refreshedUponExpiration&&(Xe.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),k.activeTexture.set(F.TEXTURE0),dt.bind(re,F.CLAMP_TO_EDGE),k.activeTexture.set(F.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(re,F.CLAMP_TO_EDGE),bt=Math.pow(2,Rt.tileID.overscaledZ-Xe.tileID.overscaledZ),St=[Xe.tileID.canonical.x*bt%1,Xe.tileID.canonical.y*bt%1]):dt.bind(re,F.CLAMP_TO_EDGE),"useMipmap"in dt&&k.extTextureFilterAnisotropic&&f.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Jt=f.transform;let cn;const rn=M?sm(Jt):[0,0,0,0];let pn,Fn,ui,Jn,Vi,Vn=0;if(D&&G instanceof s.aT&&G.coordinates.length>3)pn=Float32Array.from(s.bj(s.dI(new s.cC(0,0,0)))),Fn=Float32Array.from(Jt.globeMatrix),ui=Float32Array.from(s.dE(Jt)),Jn=[s.aF(Jt.center.lng),s.aJ(Jt.center.lat)],cn=G.elevatedGlobePerspectiveTransform,Vi=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const Ai=s.dF(Se.canonical);Vn=s.dG(Ai.getCenter().lat),pn=Float32Array.from(s.bj(s.dI(Se.canonical))),Fn=Float32Array.from(Jt.globeMatrix),ui=Float32Array.from(s.dE(Jt)),Jn=[s.aF(Jt.center.lng),s.aJ(Jt.center.lat)],cn=[0,0],Vi=Float32Array.from(s.dH(Se.canonical,Ai,Vn,Jt.worldSize/Jt._pixelsPerMercatorPixel))}else cn=G instanceof s.aT?G.perspectiveTransform:[0,0],pn=new Float32Array(16),Fn=new Float32Array(9),ui=new Float32Array(16),Jn=[0,0],Vi=new Float32Array(9);const Mi=Bh(_t,pn,Fn,ui,Vi,St||[0,0],s.aj(f.transform.zoom),Jn,rn,bt||1,Qt,a,cn,M?a.paint.get("raster-elevation"):0,2,it,gt,V.range,Ft,Je,W),Xn=f.isTileAffectedByFog(Se),Ui=f.getOrCreateProgram("raster",{defines:V.defines,overrideFog:Xn});if(f.uploadCommonUniforms(k,Ui,Pe),G instanceof s.aT){const Ai=G.elevatedGlobeVertexBuffer,zi=G.elevatedGlobeIndexBuffer;if(J||!T)G.boundsBuffer&&G.boundsSegments&&Ui.draw(f,F.TRIANGLES,Ve,Yn.disabled,K,Hn.disabled,Mi,a.id,G.boundsBuffer,f.quadTriangleIndexBuffer,G.boundsSegments);else if(Ai&&zi){const Li=Jt.zoom<=s.cZ?G.elevatedGlobeSegments:G.getSegmentsForLongitude(Jt.center.lng);Li&&Ui.draw(f,F.TRIANGLES,Ve,Yn.disabled,K,De,Mi,a.id,Ai,zi,Li)}}else if(D){Ve=new wn(F.LEQUAL,wn.ReadOnly,f.depthRangeFor3D);const Ai=f.globeSharedBuffers;if(Ai){const[zi,Li,ii]=Ai.getGridBuffers(Vn,!1);Ui.draw(f,F.TRIANGLES,Ve,Te||rt,f.colorModeForRenderPass(),De,Mi,a.id,zi,Li,ii)}}else{const{tileBoundsBuffer:Ai,tileBoundsIndexBuffer:zi,tileBoundsSegments:Li}=f.getTileBoundsBuffers(Xe);Ui.draw(f,F.TRIANGLES,Ve,rt,K,Hn.disabled,Mi,a.id,Ai,zi,Li)}}if(!(G instanceof s.aT)&&D)for(const Se of be){const Pe=Se.canonical.y===(1<<Se.canonical.z)-1;Se.canonical.y===0&&op(!0,Se,f,n,a,W,V,De,Te||Yn.disabled),Pe&&op(!1,Se,f,n,a,W,V,De===Hn.frontCW?Hn.backCW:Hn.frontCW,Te||Yn.disabled)}};D?Ce(ye,f.renderElevatedRasterBackface?Hn.backCW:Hn.frontCW,f.stencilModeFor3D()):Ce(ye,Hn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,a,p,x,b){f.renderPass==="offscreen"&&(function(T,M,D,k){if(!k.length)return;const F=T.context,G=F.gl,V=M.getSource();if(!(V instanceof Xs))return;const W=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let K=D.particlePositionRGBAImage;if(!K||K.width!==W){const ye=(function(fe){const Ce=fe*fe,be=new Uint8Array(4*Ce),De=function(Se){return Se|=0,Se=Math.imul(2747636419^Se,2654435769),Se=Math.imul(Se^Se>>>16,2654435769),((Se=Math.imul(Se^Se>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Se=0;Se<Ce;Se++){const Pe=Te*(De(2*Se+0)+Cu),Xe=Te*(De(2*Se+1)+Cu),Ge=255*Pe%1,dt=255*Xe%1,it=Ge,gt=Xe-dt/255,Ft=dt;be[4*Se+0]=255*(Pe-Ge/255),be[4*Se+1]=255*it,be[4*Se+2]=255*gt,be[4*Se+3]=255*Ft}return be})(W);K=D.particlePositionRGBAImage=new s.q({width:W,height:W},ye)}let J=D.particleFramebuffer;J?J.width!==W&&(J.destroy(),J=D.particleFramebuffer=F.createFramebuffer(W,W,!0,null)):J=D.particleFramebuffer=F.createFramebuffer(W,W,!0,null);const ae=[];for(const ye of k){const fe=M.getTile(ye);if(!(fe instanceof Ka))continue;const Ce=ap(fe,V,D);if(!Ce)continue;const be=[fe.tileSize,fe.tileSize];let De=D.tileFramebuffer;De||(De=D.tileFramebuffer=F.createFramebuffer(be[0],be[1],!0,null));let Te=fe.rasterParticleState;Te||(Te=fe.rasterParticleState=new ja(F,ye,be,K));const Se=Te.update(D.lastInvalidatedAt);Te.particleTextureDimension!==W&&Te.updateParticleTexture(ye,K);const Pe=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Pe;const Xe=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=Xe,ae.push([ye,Ce,Te,Se])}if(ae.length===0)return;const re=s.o.now(),ue=D.previousDrawTimestamp?.001*(re-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=re,D.hasColorMap()){F.activeTexture.set(G.TEXTURE0+2);let ye=D.colorRampTexture;ye||(ye=D.colorRampTexture=new s.T(F,D.colorRamp,G.RGBA8)),ye.bind(G.LINEAR,G.CLAMP_TO_EDGE)}F.bindFramebuffer.set(D.tileFramebuffer.framebuffer),(function(ye,fe,Ce){const be=ye.context,De=be.gl,Te=fe.tileFramebuffer;be.activeTexture.set(De.TEXTURE0);const Se={u_texture:0,u_opacity:1.05*(Xe=fe.paint.get("raster-particle-fade-opacity-factor"))/(Xe+.05)},Pe=ye.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Xe;for(const Ge of Ce){const[,,dt,it]=Ge;Te.colorAttachment.set(dt.targetColorTexture.texture),be.viewport.set([0,0,Te.width,Te.height]),be.clear({color:s.ao.transparent}),it&&(dt.backgroundColorTexture.bind(De.NEAREST,De.CLAMP_TO_EDGE),Pe.draw(ye,De.TRIANGLES,wn.disabled,Yn.disabled,si.alphaBlended,Hn.disabled,Se,fe.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments))}})(T,D,ae),(function(ye,fe,Ce,be){const De=ye.context,Te=De.gl,Se=Ce.tileFramebuffer,Pe=ye.transform.projection.name==="globe",Xe=Ce.paint.get("raster-particle-max-speed");for(const Ge of be){const[dt,it,gt]=Ge;De.activeTexture.set(Te.TEXTURE0+0),it.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Se.colorAttachment.set(gt.targetColorTexture.texture);const Ft=ye.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});De.activeTexture.set(Te.TEXTURE0+1);const Je=it.scalarData?[]:[0,1,2,3].map((rt=>s.e8[rt](dt)));Je.push(dt);const Ve=dt.canonical.x,_t=dt.canonical.y;for(const rt of Je){const Pt=fe.getTile(Pe?rt.wrapped():rt);if(!Pt)continue;const Rt=Pt.rasterParticleState;if(!Rt)continue;const Qt=rt.canonical.x+(1<<rt.canonical.z)*(rt.wrap-dt.wrap),bt=rt.canonical.y;Rt.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const St=np(1,Rt.particleTexture0.size[0],[Qt-Ve,bt-_t],0,it.texture.size,2,Xe,it.textureOffset,it.scale,it.offset);Ft.draw(ye,Te.POINTS,wn.disabled,Yn.disabled,si.alphaBlended,Hn.disabled,St,Ce.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}})(T,M,D,ae),F.bindFramebuffer.set(D.particleFramebuffer.framebuffer),(function(ye,fe,Ce,be){const De=ye.context,Te=De.gl,Se=fe.paint.get("raster-particle-max-speed"),Pe=be*fe.paint.get("raster-particle-speed-factor")*.15,Xe=(function(dt){return Math.pow(dt,6)})(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),Ge=fe.particleFramebuffer;De.viewport.set([0,0,Ge.width,Ge.height]);for(const dt of Ce){const[,it,gt]=dt;De.activeTexture.set(Te.TEXTURE0+0),it.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),De.activeTexture.set(Te.TEXTURE0+1);const Ft=gt.particleTexture0;Ft.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const Je=Vh(1,Ft.size[0],0,it.texture.size,Se,Pe,Xe,it.textureOffset,it.scale,it.offset);Ge.colorAttachment.set(gt.particleTexture1.texture),De.clear({color:s.ao.transparent}),ye.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(ye,Te.TRIANGLES,wn.disabled,Yn.disabled,si.unblended,Hn.disabled,Je,fe.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments)}})(T,D,ae,ue)})(f,n,a,p),f.renderPass==="translucent"&&((function(T,M,D,k,F){const G=T.context,V=G.gl,W=M.getSource().tileSize,K=5*(1-s.ah(s.cK,s.cK+1,T.transform.zoom))*W+D.paint.get("raster-particle-elevation"),J=!T.options.moving,ae=T.transform.projection.name==="globe";if(!k.length)return;const[re,ue]=T.stencilConfigForOverlap(k),ye=[];ae&&ye.push("PROJECTION_GLOBE_VIEW");const fe=T.stencilModeFor3D();for(const Ce of ue){const be=Ce.toUnwrapped(),De=M.getTile(Ce);if(!De.rasterParticleState)continue;const Te=De.rasterParticleState,Se=100;De.registerFadeDuration(Se);const Pe=M.findLoadedParent(Ce,0),Xe=Qp(De,Pe,M,T.transform,Se);let Ge,dt;T.terrain&&T.terrain.prepareDrawTile(),G.activeTexture.set(V.TEXTURE0),Te.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),G.activeTexture.set(V.TEXTURE1),Pe&&Pe.rasterParticleState?(Pe.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Ge=Math.pow(2,Pe.tileID.overscaledZ-De.tileID.overscaledZ),dt=[De.tileID.canonical.x*Ge%1,De.tileID.canonical.y*Ge%1]):Te.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const it=ae?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(be,J),gt=T.transform,Ft=ko(gt),Je=s.dF(Ce.canonical),Ve=s.dG(Je.getCenter().lat);let _t,rt,Pt,Rt,Qt;ae?(_t=Float32Array.from(s.bj(s.dI(Ce.canonical))),rt=Float32Array.from(gt.globeMatrix),Pt=Float32Array.from(s.dE(gt)),Rt=[s.aF(gt.center.lng),s.aJ(gt.center.lat)],Qt=Float32Array.from(s.dH(Ce.canonical,Je,Ve,gt.worldSize/gt._pixelsPerMercatorPixel))):(_t=new Float32Array(16),rt=new Float32Array(9),Pt=new Float32Array(16),Rt=[0,0],Qt=new Float32Array(9));const bt=va(it,_t,rt,Pt,Qt,dt||[0,0],s.aj(T.transform.zoom),Rt,Ft,Ge||1,Xe,K),St=T.isTileAffectedByFog(Ce),Jt=T.getOrCreateProgram("rasterParticle",{defines:ye,overrideFog:St});if(T.uploadCommonUniforms(G,Jt,be),ae){const cn=new wn(V.LEQUAL,wn.ReadOnly,T.depthRangeFor3D),rn=0,pn=T.globeSharedBuffers;if(pn){const[Fn,ui,Jn]=pn.getGridBuffers(Ve,rn!==0);Jt.draw(T,V.TRIANGLES,cn,fe,si.alphaBlended,T.renderElevatedRasterBackface?Hn.frontCCW:Hn.backCCW,bt,D.id,Fn,ui,Jn)}}else{const cn=T.depthModeForSublayer(0,wn.ReadOnly),rn=re[Ce.overscaledZ],{tileBoundsBuffer:pn,tileBoundsIndexBuffer:Fn,tileBoundsSegments:ui}=T.getTileBoundsBuffers(De);Jt.draw(T,V.TRIANGLES,cn,rn,si.alphaBlended,Hn.disabled,bt,D.id,pn,Fn,ui)}}T.resetStencilClippingMasks()})(f,n,a,p),f.style.map.triggerRepaint())},background:function(f,n,a,p){const x=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",T=a.paint.get("background-opacity"),M=a.paint.get("background-emissive-strength"),D=a.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const k=f.context,F=k.gl,G=f.transform,V=G.tileSize,W=a.paint.get("background-pattern");let K;if(W!==void 0&&(W===null||(K=f.imageManager.getPattern(s.I.from(W.toString()),a.scope,f.style.getLut(a.scope)),!K)))return;const J=!W&&x.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==J)return;const ae=Yn.disabled,re=f.depthModeForSublayer(0,J==="opaque"?wn.ReadWrite:wn.ReadOnly),ue=f.colorModeForDrapableLayerRenderPass(M),ye=W?"backgroundPattern":"background";let fe,Ce=p;if(Ce||(fe=f.getBackgroundTiles(),Ce=Object.values(fe).map((be=>be.tileID))),W&&(k.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context,a.scope)),D){const be=f.getOrCreateProgram(ye,{overrideFog:!1,overrideRtt:!0}),De=new Float32Array(s.bz([])),Te=new s.aP(0,0,0,0,0),Se=W?Uh(De,M,T,f,0,a.scope,K,D,{tileID:Te,tileSize:V}):Ru(De,M,T,x.toPremultipliedRenderColor(b?null:a.lut));be.draw(f,F.TRIANGLES,re,ae,ue,Hn.disabled,Se,a.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const be of Ce){const De=f.isTileAffectedByFog(be),Te=f.getOrCreateProgram(ye,{overrideFog:De}),Se=be.toUnwrapped(),Pe=p?be.projMatrix:f.transform.calculateProjMatrix(Se);f.prepareDrawTile();const Xe=n?n.getTile(be):fe?fe[be.key]:new fl(be,V,G.zoom,f),Ge=W?Uh(Pe,M,T,f,0,a.scope,K,D,{tileID:be,tileSize:V}):Ru(Pe,M,T,x.toPremultipliedRenderColor(b?null:a.lut));f.uploadCommonUniforms(k,Te,Se);const{tileBoundsBuffer:dt,tileBoundsIndexBuffer:it,tileBoundsSegments:gt}=f.getTileBoundsBuffers(Xe);Te.draw(f,F.TRIANGLES,re,ae,ue,Hn.disabled,Ge,a.id,dt,it,gt)}},sky:function(f,n,a){const p=f._atmosphere?s.aj(f.transform.zoom):1,x=a.paint.get("sky-opacity")*p;if(x===0)return;const b=f.context,T=a.paint.get("sky-type"),M=new wn(b.gl.LEQUAL,wn.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?a.needsSkyboxCapture(f)&&((function(k,F,G,V){const W=k.context,K=W.gl;let J=F.skyboxFbo;if(!J){J=F.skyboxFbo=W.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new am(W),F.skyboxTexture=W.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ye=0;ye<6;++ye)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(J.framebuffer),W.viewport.set([0,0,32,32]);const ae=F.getCenter(k,!0),re=k.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);s.bz(ue),s.em(ue,ue,.5*-Math.PI),nl(k,F,re,ue,ae,0),s.bz(ue),s.em(ue,ue,.5*Math.PI),nl(k,F,re,ue,ae,1),s.bz(ue),s.cT(ue,ue,.5*-Math.PI),nl(k,F,re,ue,ae,2),s.bz(ue),s.cT(ue,ue,.5*Math.PI),nl(k,F,re,ue,ae,3),s.bz(ue),nl(k,F,re,ue,ae,4),s.bz(ue),s.em(ue,ue,Math.PI),nl(k,F,re,ue,ae,5),W.viewport.set([0,0,k.width,k.height])})(f,a),a.markSkyboxValid(f)):f.renderPass==="sky"&&(function(k,F,G,V,W){const K=k.context,J=K.gl,ae=k.transform,re=k.getOrCreateProgram("skybox");K.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,F.skyboxTexture);const ue=((ye,fe,Ce,be,De)=>({u_matrix:ye,u_sun_direction:fe,u_cubemap:0,u_opacity:be,u_temporal_offset:De}))(ae.skyboxMatrix,F.getCenter(k,!1),0,V,W);k.uploadCommonUniforms(K,re),re.draw(k,J.TRIANGLES,G,Yn.disabled,k.colorModeForRenderPass(),Hn.backCW,ue,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)})(f,a,M,x,D):T==="gradient"&&f.renderPass==="sky"&&(function(k,F,G,V,W){const K=k.context,J=K.gl,ae=k.transform,re=k.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new am(K)),K.activeTexture.set(J.TEXTURE0);let ue=F.colorRampTexture;ue||(ue=F.colorRampTexture=new s.T(K,F.colorRamp,J.RGBA8)),ue.bind(J.LINEAR,J.CLAMP_TO_EDGE);const ye=((fe,Ce,be,De,Te)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:Ce,u_radius:s.an(be),u_opacity:De,u_temporal_offset:Te}))(ae.skyboxMatrix,F.getCenter(k,!1),F.paint.get("sky-gradient-radius"),V,W);k.uploadCommonUniforms(K,re),re.draw(k,J.TRIANGLES,G,Yn.disabled,k.colorModeForRenderPass(),Hn.backCW,ye,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)})(f,a,M,x,D)},custom:function(f,n,a,p){const x=f.context,b=a.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&a.isDraped(n)){if(f.renderPass==="offscreen"){const T=b.prerender;if(T){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;T.call(b,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else T.call(b,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const M=b.renderToTile;if(M){const D=p[0].canonical,k={x:D.x+p[0].wrap*(b.wrapTileId?0:1<<D.z),y:D.y,z:D.z};x.setDepthMode(wn.disabled),x.setStencilMode(Yn.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),M.call(b,x.gl,k),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(Yn.disabled);const T=b.renderingMode==="3d"?new wn(f.context.gl.LEQUAL,wn.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,wn.ReadOnly);if(x.setDepthMode(T),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;b.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.aj(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else b.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,a,p){if(f.renderPass==="opaque")return;const x=a.paint.get("model-opacity").constantOr(1),b=a.paint.get("model-elevation-reference"),T=b==="ground",M=b==="ground";if(x===0)return;const D=a.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!D||f.terrain&&x<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const k=f.shadowRenderer,F=a.paint.get("model-receive-shadows");k&&(k.useNormalOffset=!0,F||(k.enabled=!1));const G=()=>{k&&(k.useNormalOffset=!0,F||(k.enabled=!0))},V=n.getSource();if(f.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return(function(fe,Ce,be,De,Te){const Se=fe.transform,Pe=Se.projection.name==="globe",Xe=Se.getFreeCameraOptions().position;if(!fe.modelManager)return;const Ge=fe.modelManager;be.modelManager=Ge;const dt=fe.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const it=be._unevaluatedLayout._values["model-id"],gt=Object.assign({},be.layout.get("model-id").parameters),Ft=fe.style.order.indexOf(be.fqid);for(const Je of De){const Ve=Ce.getTile(Je).getBucket(be);if(!Ve||Ve.projection.name!==Se.projection.name)continue;const _t=Ve.getModelUris();if(_t&&!Ve.modelsRequested&&(Ge.addModelsFromBucket(_t,Te),Ve.modelsRequested=!0),Pe)gt.zoom=Je.overscaledZ;else{const cn=cm(Je,Se);gt.zoom=cn}const rt=it.possiblyEvaluate(gt);if(Ig(fe,Ve,Je),jo.shadowUniformsInitialized=!1,jo.useSingleShadowCascade=!!dt&&dt.getMaxCascadeForTile(Je.toUnwrapped())===0,fe.renderPass==="shadow"&&dt){if(fe.currentShadowCascade===1&&Ve.isInsideFirstShadowMapFrustum)continue;const cn=Se.calculatePosMatrix(Je.toUnwrapped(),Se.worldSize);if(jo.tileMatrix.set(cn),jo.shadowTileMatrix=Float32Array.from(dt.calculateShadowPassMatrixFromMatrix(cn)),jo.aabb.min=[0,0,0],jo.aabb.max[0]=jo.aabb.max[1]=s.al,jo.aabb.max[2]=0,dp(Ve,jo,fe,be.scope))continue}const Pt=1<<Je.canonical.z,Rt=[((Xe.x-Je.wrap)*Pt-Je.canonical.x)*s.al,(Xe.y*Pt-Je.canonical.y)*s.al,Xe.z*Pt*s.al];fe.conflationActive&&Object.keys(Ve.instancesPerModel).length>0&&fe.style.isLayerClipped(be,Ce.getSource())&&Ve.updateReplacement(Je,fe.replacementSource,Ft,Te)&&(Ve.uploaded=!1,Ve.upload(fe.context));let Qt=0;const bt=new Array,St=new Array,Jt=new Array;for(let cn in Ve.instancesPerModel){const rn=Ve.instancesPerModel[cn];rn.features.length>0&&!Pe&&(cn=rt.evaluate(rn.features[0].feature,{}));const pn=Ge.getModel(cn,Te);if(pn||Ge.hasURLBeenRequested(cn)||Ve.modelUris.includes(cn)||(Ve.modelUris.push(cn),Ve.modelsRequested=!1),pn&&pn.uploaded)if(Pe){const Fn=s.c4([],[Xe.x,Xe.y,Xe.z],fe.transform.worldSize);s.ev(Fn,Fn);for(let ui=0;ui<rn.instancedDataArray.length;++ui){const Jn=[0,0,0],Vi=[1,1,1],Vn=s.ew(),Mi=rn.tileCoordinatesForInstance(ui),Xn=rn.transformForInstance(ui);s.ex(Vi,Xn),s.ey(Vn,Xn),s.ez(Jn,Vn);const Ui=rn.translationForInstance(ui),Ai=new s.aS(0,0);s.eA(Ve.canonical,Ai,Mi.x,Mi.y);const zi=s.bB();s.eB(zi,pn,fe.transform,Ai,Jn,Vi,Ui,!0,!1,!1);const Li=rn.colorForInstance(ui),ii=s.bz([]),qi=s.ee(Ai.lat,fe.transform.zoom),di=s.bp([],[1,1,1/qi]);s.bq(ii,ii,Fn),Jt.push({zScaleMatrix:di,negCameraPosMatrix:ii});for(const gr of pn.nodes)cp(fe,gr,zi,fe.transform.expandedFarZProjMatrix,Qt,bt,St,pn.materialOverrides,Li);++Qt}}else for(const Fn of pn.nodes)Xh(fe,be,Fn,rn,Rt,Je,jo)}if(Pe)if(fe.renderPass==="shadow"){for(const cn of St)Id(cn.mesh,cn.nodeModelMatrix,fe,be);for(const cn of bt)Id(cn.mesh,cn.nodeModelMatrix,fe,be)}else uy(fe,be,1,bt,St,Jt)}})(f,n,a,p,lp(V,a,f.style._importedAsBasemap)),void G();if(!V.loaded())return;if(V.type==="batched-model")return(function(fe,Ce,be,De){be.resetLayerRenderingStats(fe);const Te=fe.context,Se=fe.transform,Pe=fe.style.fog,Xe=fe.shadowRenderer;if(Se.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const Ge=fe.transform.getFreeCameraOptions().position,dt=s.c4([],[Ge.x,Ge.y,Ge.z],fe.transform.worldSize),it=s.ev([],dt),gt=s.bz([]),Ft=s.ee(Se.center.lat,Se.zoom),Je=s.bp([],[1,1,1/Ft]);s.bq(gt,gt,it);const Ve=be.paint.get("model-opacity").constantOr(1),_t=new wn(Te.gl.LEQUAL,wn.ReadWrite,fe.depthRangeFor3D),rt=new wn(Te.gl.LEQUAL,wn.ReadOnly,fe.depthRangeFor3D),Pt=new s.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Rt=fe.renderPass==="shadow",Qt=Rt&&Xe?Xe.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),bt=be.paint.get("model-front-cutoff"),St=bt[2]<1,Jt=Qa(fe,be.paint.get("model-cutoff-fade-range")),cn=be.getLayerRenderingStats();(function(rn,pn,Fn,ui){const Jn=rn.terrain?rn.terrain.exaggeration():0,Vi=rn.transform.zoom;for(const Vn of ui){const Mi=pn.getTile(Vn).getBucket(Fn);Mi&&(Mi.setFilter(Fn.filter),rn.conflationActive&&Mi.updateReplacement(Vn,rn.replacementSource),Mi.evaluateTransform(rn,Fn),rn.terrain&&Jn>0&&Mi.elevationUpdate(rn.terrain,Jn,Vn,Fn.source),Mi.needsReEvaluation(rn,Vi,Fn)&&Mi.evaluate(Fn))}})(fe,Ce,be,De),(function(){let rn,pn,Fn;St?(rn=De.length-1,pn=-1,Fn=-1):(rn=0,pn=De.length,Fn=1);const ui=new Float64Array(16),Jn=s.cz(),Vi=new s.P(0,0);for(let Vn=rn;Vn!==pn;Vn+=Fn){const Mi=De[Vn],Xn=Ce.getTile(Mi).getBucket(be);if(!Xn||!Xn.uploaded)continue;let Ui=!1;Xe&&(Ui=Xe.getMaxCascadeForTile(Mi.toUnwrapped())===0);const Ai=Se.calculatePosMatrix(Mi.toUnwrapped(),Se.worldSize),zi=Xn.modelTraits;!Rt&&St&&(s.bk(ui,Ai),s.af(Jn,dt,ui),Vi.x=Jn[0],Vi.y=Jn[1]);const Li=[];Xn.setFilter(be.filter);for(const ii of Xn.getNodesInfo()){if(ii.hiddenByReplacement||!ii.node.meshes)continue;const qi=ii.node;let di=0;fe.terrain&&qi.elevation&&(di=qi.elevation*fe.terrain.exaggeration());const gr=(()=>{const ps=ii.aabb;return Pt.min=[...ps.min],Pt.max=[...ps.max],Pt.min[2]+=di,Pt.max[2]+=di,s.af(Pt.min,Pt.min,Ai),s.af(Pt.max,Pt.max,Ai),Pt})(),Ii=ii.evaluatedScale;if(Ii[0]<=1&&Ii[1]<=1&&Ii[2]<=1&&gr.intersects(Qt)===0)continue;if(!Rt&&St){const ps=.16666666666666666;ii.cameraCollisionOpacity=dt[0]>gr.min[0]&&dt[0]<gr.max[0]&&dt[1]>gr.min[1]&&dt[1]<gr.max[1]&&dt[2]*Ft<gr.max[2]&&qi.footprint&&s.b$(Vi,qi.footprint)?Math.max(ii.cameraCollisionOpacity-ps,0):Math.min(1,ii.cameraCollisionOpacity+ps)}const Pn=[...Ai],Si=1/s.d6(Mi.canonical),Tr=qi.anchor?qi.anchor[0]:0,Dr=qi.anchor?qi.anchor[1]:0;s.bq(Pn,Pn,[Tr*(Ii[0]-1)+ii.evaluatedTranslation[0]*Si,Dr*(Ii[1]-1)+ii.evaluatedTranslation[1]*Si,di+ii.evaluatedTranslation[2]]),s.cp(Ii,s.eD)||s.cR(Pn,Pn,Ii);const Vr=s.aB([],Pn,qi.globalMatrix),Yr=s.aB([],Se.expandedFarZProjMatrix,Vr),ca=s.aB([],Se.expandedFarZProjMatrix,Pn),mo=s.aC([],[Tr,Dr,di,1],Yr)[2];qi.hidden=!1;let so=Ve;Rt||(St&&(so*=ii.cameraCollisionOpacity,so*=Od(Pn,Se,ii.aabb,bt)),so*=Pd(Jt,mo)),so!==0?Li.push({nodeInfo:ii,depth:mo,opacity:so,wvpForNode:Yr,wvpForTile:ca,nodeModelMatrix:Vr,tileModelMatrix:Pn}):qi.hidden=!0}Rt||Li.sort(((ii,qi)=>!St||ii.opacity===1&&qi.opacity===1?ii.depth<qi.depth?-1:1:ii.opacity===1?-1:qi.opacity===1?1:ii.depth>qi.depth?-1:1));for(const ii of Li){const qi=ii.nodeInfo,di=qi.node;let gr=s.aB([],Je,ii.tileModelMatrix);s.aB(gr,gt,gr);const Ii=s.bk([],gr);s.ef(Ii,Ii),s.cR(Ii,Ii,up),gr=s.aB(gr,gr,di.globalMatrix);const Pn=fe.renderPass==="light-beam",Si=be.paint.get("model-color-use-theme").constantOr("default")==="none",Tr=zi&s.eH.HasMapboxMeshFeatures,Dr=Tr?0:qi.evaluatedRMEA[0][2];for(let Vr=0;Vr<di.meshes.length;++Vr){const Yr=di.meshes[Vr],ca=Vr===di.lightMeshIndex;let mo=ii.wvpForNode;if(ca){if(!Pn&&!fe.terrain&&fe.shadowRenderer){fe.currentLayer<fe.firstLightBeamLayer&&(fe.firstLightBeamLayer=fe.currentLayer);continue}mo=ii.wvpForTile}else if(Pn)continue;const so={defines:[]},ps=[];if(!Rt&&Xe&&(Xe.useNormalOffset=!!Yr.normalBuffer),Md(so.defines,ps,Yr,fe,Si?null:be.lut),Tr||so.defines.push("DIFFUSE_SHADED"),Ui&&so.defines.push("SHADOWS_SINGLE_CASCADE"),cn&&(Rt?cn.numRenderedVerticesInShadowPass+=Yr.vertexArray.length:cn.numRenderedVerticesInTransparentPass+=Yr.vertexArray.length),Rt){Id(Yr,ii.nodeModelMatrix,fe,be);continue}let Ba=null;if(Pe){const is=lm(ii.nodeModelMatrix,fe.transform);if(Ba=new Float32Array(is),Se.projection.name!=="globe"){const ur=Yr.aabb.min,Qr=Yr.aabb.max,[eo,Jr]=Pe.getOpacityForBounds(is,ur[0],ur[1],Qr[0],Qr[1]);so.overrideFog=eo>=nt||Jr>=nt}}const ns=Yr.material;let Va;ns.occlusionTexture&&ns.occlusionTexture.offsetScale&&(Va=ns.occlusionTexture.offsetScale,so.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ol=fe.getOrCreateProgram("model",so);!Rt&&Xe&&Xe.setupShadowsFromMatrix(ii.tileModelMatrix,ol,Xe.useNormalOffset),fe.uploadCommonUniforms(Te,ol,null,Ba);const oo=ns.pbrMetallicRoughness;oo.metallicFactor=.9,oo.roughnessFactor=.5;const Er=Mu(new Float32Array(mo),new Float32Array(gr),new Float32Array(Ii),new Float32Array(di.globalMatrix),fe,ii.opacity,oo.baseColorFactor,ns.emissiveFactor,oo.metallicFactor,oo.roughnessFactor,ns,Dr,be,[0,0,0],Va);!ca&&(qi.hasTranslucentParts||ii.opacity<1)&&ol.draw(fe,Te.gl.TRIANGLES,_t,Yn.disabled,si.disabled,Hn.backCCW,Er,be.id,Yr.vertexBuffer,Yr.indexBuffer,Yr.segments,be.paint,fe.transform.zoom,void 0,ps),ol.draw(fe,Te.gl.TRIANGLES,ca?rt:_t,Yn.disabled,ca||ii.opacity<1||qi.hasTranslucentParts?si.alphaBlended:si.unblended,Hn.backCCW,Er,be.id,Yr.vertexBuffer,Yr.indexBuffer,Yr.segments,be.paint,fe.transform.zoom,void 0,ps)}}}})()})(f,n,a,p),void G();if(V.type!=="model")return;const W=V.getModels(),K=[],J=f.transform.getFreeCameraOptions().position,ae=s.c4([],[J.x,J.y,J.z],f.transform.worldSize);s.ev(ae,ae);const re=[],ue=[];let ye=0;for(const fe of W){const Ce=n.getFeatureState("",fe.id),be={type:"Unknown",id:fe.id,properties:fe.featureProperties},De=a.paint.get("model-rotation").evaluate(be,Ce),Te=a.paint.get("model-scale").evaluate(be,Ce),Se=a.paint.get("model-translation").evaluate(be,Ce);Dd(a,fe.id,Ce,fe.featureProperties,fe.nodeOverrideNames,fe.nodeOverrides),cy(a,fe.id,Ce,fe.featureProperties,fe.materialOverrideNames,fe.materialOverrides),fe.nodeOverrides.size>0&&fe.computeBoundsAndApplyParent(),fe.computeModelMatrix(f,De,Te,Se,M,T,!1);const Pe=s.bz([]),Xe=s.ee(fe.position.lat,f.transform.zoom),Ge=s.bp([],[1,1,1/Xe]);s.bq(Pe,Pe,ae),K.push({zScaleMatrix:Ge,negCameraPosMatrix:Pe});for(const dt of fe.nodes)cp(f,dt,fe.matrix,f.transform.expandedFarZProjMatrix,ye,re,ue,fe.materialOverrides);ye++}if(re.sort(((fe,Ce)=>Ce.depth-fe.depth)),f.renderPass!=="shadow")uy(f,a,x,re,ue,K),G();else{for(const fe of ue)Id(fe.mesh,fe.nodeModelMatrix,f,a);for(const fe of re)Id(fe.mesh,fe.nodeModelMatrix,f,a);G()}}},fp={line:function(f,n,a){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const x of p){const b=n.getTile(x).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,n,a){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson"){const b=lp(p,f,a.style._importedAsBasemap);return void(a.modelManager&&a.modelManager.upload(a,b))}if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const b of x)b.upload(a.context)},raster:function(f,n,a){const p=n.getSource();if(!(p instanceof Xs&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(x);if(b==null)return;const T=n.getIds().map((M=>n.getTileByID(M)));for(const M of T)M.updateNeeded(f.id,b)&&p.prepareTile(M,x,f.id,b)},"raster-particle":function(f,n,a){const p=n.getSource();if(!(p instanceof Xs&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(b==null)return;const T=n.getIds().map((M=>n.getTileByID(M)));for(const M of T)M.updateNeeded(f.id,b)&&p.prepareTile(M,x,f.id,b)}},hm={fill:Sc},il={fill:function(f,n,a,p){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const x=f.context.gl,b=new wn(x.LEQUAL,wn.ReadOnly,f.depthRangeFor3D),T=new Yn({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),M=f.transform.getFreeCameraOptions().position,D=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of p){const F=n.getTile(k),G=F.getBucket(a);if(!G)continue;const V=G.elevatedStructures;if(!V||V.depthSegments.segments[0].primitiveLength===0)continue;const W=Qs(k.toUnwrapped(),M),K=f.translatePosMatrix(k.projMatrix,F,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),J=ep(K,W,0,1,0);D.draw(f,x.TRIANGLES,b,T,si.disabled,Hn.disabled,J,a.id,V.vertexBuffer,V.indexBuffer,V.depthSegments,a.paint,f.transform.zoom)}}};class tu{constructor(n,a,p,x,b,T){this.context=new $h(n,a),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of M)this._debugParams.enabledLayers[k]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of M)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new dy(b),this.setup(),this.numSublayers=Da.maxUnderzooming+Da.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Dh(this),this._wireframeDebugCache=new Pg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,D,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=T}updateTerrain(n,a){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Xc(this,n));const x=this._terrain;this.transform.elevation=p?x:null,x.update(n,this.transform,a),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=a.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const b=p+.78*(x-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Xc(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*s.o.devicePixelRatio,this.height=a*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,a=new s.bc;a.emplaceBack(0,0),a.emplaceBack(s.al,0),a.emplaceBack(0,s.al),a.emplaceBack(s.al,s.al),this.tileExtentBuffer=n.createVertexBuffer(a,s.be.members),this.tileExtentSegments=s.bf.simpleSegment(0,0,4,2);const p=new s.bc;p.emplaceBack(0,0),p.emplaceBack(s.al,0),p.emplaceBack(0,s.al),p.emplaceBack(s.al,s.al),this.debugBuffer=n.createVertexBuffer(p,s.be.members),this.debugSegments=s.bf.simpleSegment(0,0,4,5);const x=new s.bc;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,s.be.members),this.viewportSegments=s.bf.simpleSegment(0,0,4,2);const b=new s.a$;b.emplaceBack(0,0,0,0),b.emplaceBack(s.al,0,s.al,0),b.emplaceBack(0,s.al,0,s.al),b.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.bh.members),this.mercatorBoundsSegments=s.bf.simpleSegment(0,0,4,2);const T=new s.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const M=new s.bd;for(const k of[0,1,3,2,0])M.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new s.T(n,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bB();const D=this.context.gl;this.stencilClearMode=new Yn({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,wn.disabled,this.stencilClearMode,si.disabled,Hn.disabled,wd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,p){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const D of p)if(this._tileClippingMaskIDs[D.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=a.id;const x=this.context,b=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(si.disabled),x.setDepthMode(wn.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const D=a.getTile(M),k=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:G,tileBoundsSegments:V}=this.getTileBoundsBuffers(D);T.draw(this,b.TRIANGLES,wn.disabled,new Yn({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),si.disabled,Hn.disabled,wd(M.projMatrix),"$clipping",F,G,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new Yn({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new Yn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,p=n.sort(((T,M)=>M.overscaledZ-T.overscaledZ)),x=p[p.length-1].overscaledZ,b=p[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let M=0;M<b;M++)T[M+x]=new Yn({func:a.GEQUAL,mask:255},M+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,p]}return[{[x]:Yn.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new si([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new si([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,p,x=!1){if(this.depthOcclusion)return new wn(this.context.gl.GREATER,wn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return wn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new wn(p||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,a=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&p!==0&&(this.depthFBO=new rp(this.context,a,p,!1,"texture"),this.depthTexture=new s.T(this.context,{width:a,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,a,p,0,0,a,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((n,a)=>n+a/this._fpsHistory.length),0))}render(n,a){const p=s.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=a;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter((Je=>{const Ve=x[Je];return!(Ve.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ve.type]}));let M=T(),D=!1,k=!1,F=null;for(const Je of M){const Ve=x[Je];Ve.type==="circle"?D=!0:Ve.type==="building"?F=Ve:Ve.type==="symbol"&&(Ve.hasOcclusionOpacityProperties?k=!0:D=!0)}let G=M.map((Je=>x[Je]));const V=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();let W=0,K=!1;for(const Je in V){const Ve=V[Je];Ve.used&&(Ve.prepare(this.context),Ve.getSource().usedInConflation&&++W)}let J=!1;for(const Je of G)Je.isHidden(this.transform.zoom)||(Je.type==="clip"&&(J=!0),this.prepareLayer(Je));const ae={},re={},ue={},ye={},fe={};for(const Je in V){const Ve=V[Je];ae[Je]=Ve.getVisibleCoordinates(),re[Je]=ae[Je].slice().reverse(),ue[Je]=Ve.getVisibleCoordinates(!0).reverse(),ye[Je]=Ve.getShadowCasterCoordinates(),fe[Je]=Ve.sortCoordinatesByDistance(ae[Je])}const Ce=Je=>{const Ve=this.style.getLayerSourceCache(Je);return Ve&&Ve.used?Ve.getSource():null};if(W||J||this._clippingActiveLastFrame){const Je=[],Ve=[];let _t=0;for(const rt of G)this.isSourceForClippingOrConflation(rt,Ce(rt))&&(Je.push(rt),Ve.push(_t)),_t++;if(Je&&(J||Je.length>1)||this._clippingActiveLastFrame){J=!1;const rt=[];for(let Pt=0;Pt<Je.length;Pt++){const Rt=Je[Pt],Qt=Ve[Pt],bt=this.style.getLayerSourceCache(Rt);if(!bt||!bt.used||!bt.getSource().usedInConflation&&Rt.type!=="clip"&&Rt.type!=="building")continue;let St=s.eP,Jt=s.bZ.None;const cn=[];let rn=!0;if(Rt.type==="building")St=s.eR;else if(Rt.type==="clip"){St=Qt;for(const pn of Rt.layout.get("clip-layer-types"))Jt|=pn==="model"?s.bZ.Model:pn==="symbol"?s.bZ.Symbol:s.bZ.FillExtrusion;for(const pn of Rt.layout.get("clip-layer-scope"))cn.push(pn);Rt.isHidden(this.transform.zoom)?rn=!1:J=!0}rn&&rt.push({layer:Rt.fqid,cache:bt,order:St,clipMask:Jt,clipScope:cn})}this.replacementSource.setSources(rt),K=!0}}this._clippingActiveLastFrame=J,K||this.replacementSource.clear(),this.conflationActive=K,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Je=0;Je<G.length;Je++){const Ve=G[Je],_t=Ve.cutoffRange();if(this.longestCutoffRange=Math.max(_t,this.longestCutoffRange),_t>0){const rt=Ce(Ve);rt&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom)),Ve.minzoom&&(this.minCutoffZoom=Math.max(Ve.minzoom,this.minCutoffZoom))}Ve.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Je),this._lastOcclusionLayer=Je)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0,M=T(),G=M.map((Je=>x[Je])));const De=this._shadowRenderer;if(De){De.updateShadowParameters(this.transform,this.style.directionalLight);for(const Je in V)for(const Ve of ae[Je]){let _t={min:0,max:0};this.terrain&&(_t=this.terrain.getMinMaxForTile(Ve)||_t),De.addShadowReceiver(Ve.toUnwrapped(),_t.min,_t.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ss(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new hp(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),Se&&!this._rain&&(this._rain=new zd(this)),!Se&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ye);const Je=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(Je,F)}if(!Ri.has(this.context.gl))return;this.renderPass="offscreen";for(const Je of G){const Ve=n.getLayerSourceCache(Je);if(!Je.hasOffscreenPass()||Je.isHidden(this.transform.zoom))continue;const _t=Ve?re[Ve.id]:void 0;(Je.type==="custom"||Je.type==="raster"||Je.type==="raster-particle"||Je.isSky()||_t&&_t.length)&&this.renderLayer(this,Ve,Je,_t)}this.depthRangeFor3D=[0,1-(G.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ye)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Pe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Xe=(()=>{if(a.showOverdrawInspector)return s.ao.black;const Je=this.style.fog;if(Je&&this.transform.projection.supportsFog){const Ve=this.style.getLut(Je.scope);if(!Pe){const _t=Je.properties.get("color-use-theme")==="none",rt=Je.properties.get("color").toNonPremultipliedRenderColor(_t?null:Ve).toArray01();return new s.ao(...rt)}if(Pe){const _t=Je.properties.get("space-color-use-theme")==="none",rt=Je.properties.get("space-color").toNonPremultipliedRenderColor(_t?null:Ve).toArray01();return new s.ao(...rt)}}return s.ao.transparent})();if(this.context.clear({color:Xe,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const Je=G[this.currentLayer],Ve=n.getLayerSourceCache(Je);if(Je.isSky())continue;const _t=Ve?(Je.is3D(b)?fe:re)[Ve.id]:void 0;this._renderTileClippingMasks(Je,Ve,_t),this.renderLayer(this,Ve,Je,_t)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Je=G[this.currentLayer],Ve=n.getLayerSourceCache(Je);Je.isSky()&&this.renderLayer(this,Ve,Je,Ve?re[Ve.id]:void 0)}function Ge(Je,Ve){let _t;return Ve&&(_t=(Je.type==="symbol"?ue:Je.is3D(b)?fe:re)[Ve.id]),_t}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const Je=G[this.currentLayer];if(Je.type==="raster"||Je.type==="raster-particle"){const Ve=n.getLayerSourceCache(Je);this.renderLayer(this,Ve,Je,Ge(Je,Ve))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let dt=0;De&&(dt=De.getShadowCastingLayerCount());let it=!1,gt=-1;for(let Je=0;Je<M.length;++Je){const Ve=G[Je];Ve.isHidden(this.transform.zoom)||Ve.is3D(b)&&(gt=Je)}k&&gt===-1&&(D=!0);let Ft=!1;for(;this.currentLayer<M.length;){const Je=G[this.currentLayer],Ve=n.getLayerSourceCache(Je);if(Je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Je)){if(Je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ft&&Je.is3D(b)&&!b){const _t=this.currentLayer,rt=Pt=>{for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const Rt=G[this.currentLayer];if(hm[Rt.type]){const Qt=this.style.getLayerSourceCache(Rt);hm[Rt.type](this,Qt,Rt,Ge(Rt,Qt),Pt)}}};rt("initialize"),rt("reset"),this.currentLayer=_t,Ft=!0}if(D&&!it&&this.terrain&&!this.transform.isOrthographic&&(it=!0,this.blitDepth()),k&&gt!==-1&&this.currentLayer===gt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Je,Ve,Ve?ae[Ve.id]:void 0),this.renderLayer(this,Ve,Je,Ge(Je,Ve)),!this.terrain&&De&&dt>0&&Je.hasShadowPass()&&--dt==0){{this.clearStencil(),this.resetStencilClippingMasks();const _t=this.currentLayer;for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const rt=G[this.currentLayer];if(il[rt.type]){const Pt=this.style.getLayerSourceCache(rt);il[rt.type](this,Pt,rt,Ge(rt,Pt))}}this.currentLayer=_t}if(De.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const _t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=_t;this.currentLayer++){const rt=G[this.currentLayer];if(!rt.hasLightBeamPass())continue;const Pt=n.getLayerSourceCache(rt);this.renderLayer(this,Pt,rt,Pt?re[Pt.id]:void 0)}this.currentLayer=_t,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const _t=this.currentLayer;this.depthOcclusion=!0;for(const rt of this.layersWithOcclusionOpacity){this.currentLayer=rt;const Pt=G[this.currentLayer],Rt=n.getLayerSourceCache(Pt),Qt=Rt?re[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(Pt,Rt,Rt?ae[Rt.id]:void 0),this.renderLayer(this,Rt,Pt,Qt)}this.depthOcclusion=!1,this.currentLayer=_t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Je=null;G.forEach((Ve=>{const _t=n.getLayerSourceCache(Ve);_t&&!Ve.isHidden(this.transform.zoom)&&_t.getVisibleCoordinates().length&&(!Je||Je.getSource().maxzoom<_t.getSource().maxzoom)&&(Je=_t)})),Je&&this.options.showTileBoundaries&&Wh(this,Je,Je.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Wh(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Je){const Ve=Je.transform.padding;ir(Je,Je.transform.height-(Ve.top||0),3,Tc),ir(Je,Ve.bottom||0,3,aa),Iu(Je,Ve.left||0,3,$s),Iu(Je,Je.transform.width-(Ve.right||0),3,Zh);const _t=Je.transform.centerPoint;(function(rt,Pt,Rt,Qt){Du(rt,Pt-1,Rt-10,2,20,Qt),Du(rt,Pt-10,Rt-1,20,2,Qt)})(Je,_t.x,Je.transform.height-_t.y,Cd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),K||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,p=!a||!a.includes(n.type);if(fp[n.type]&&(p||this.terrain&&n.type==="custom")){const x=this.style.getLayerSourceCache(n);fp[n.type](n,x,this)}this.gpuTimingEnd()}renderLayer(n,a,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||dm[p.type](n,a,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[n.id];x||(x=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(a.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,p=a.createQuery();this.deferredRenderGpuTimeQueries.push(p),a.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const p in n){const x=n[p],b=this.context.extTimerQuery,T=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),a[p]=T}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let p=0;for(const x of n)p+=a.getQueryParameter(x,a.QUERY_RESULT)/1e6,a.deleteQuery(x);return p}translatePosMatrix(n,a,p,x,b){if(!p[0]&&!p[1])return n;const T=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){const k=Math.sin(T),F=Math.cos(T);p=[p[0]*F-p[1]*k,p[0]*k+p[1]*F]}const M=[b?p[0]:s.ay(a,p[0],this.transform.zoom),b?p[1]:s.ay(a,p[1],this.transform.zoom),0],D=new Float32Array(16);return s.bq(D,n,M),D}saveTileTexture(n){if(n.context!==this.context)return;const a=n.size[0],p=this._tileTextures[a];p?p.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,a){this.cache=this.cache||{};const p=a&&a.defines||[],x=a&&a.config,b=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(p),T=Kf.cacheKey(sa[n],n,b,x);return this.cache[T]||(this.cache[T]=new Kf(this.context,n,sa[n],x,oy[n],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const b=((T,M,D)=>{const k=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",G=T.properties.get("color").toNonPremultipliedRenderColor(F?null:D.getLut(T.scope)).toArray01(),V=T.properties.get("intensity"),W=M.properties.get("color-use-theme")==="none",K=M.properties.get("color").toNonPremultipliedRenderColor(W?null:D.getLut(M.scope)).toArray01(),J=M.properties.get("intensity"),ae=[k.x,k.y,k.z],re=s.dM(K,J),ue=s.dM(G,V);return{u_lighting_ambient_color:re,u_lighting_directional_dir:ae,u_lighting_directional_color:ue,u_ground_radiance:Xf(ae,ue,re)}})(p,x,this.style);a.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,a,p,x,b){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const M=T.getOpacity(this.transform.pitch),D=((k,F,G,V,W,K,J,ae,re,ue,ye,fe)=>{const Ce=k.transform,be=F.properties.get("color-use-theme")==="none",De=F.properties.get("color").toNonPremultipliedRenderColor(be?null:k.style.getLut(F.scope)).toArray01();De[3]=V;const Te=k.frameCounter/1e3%1,[Se,Pe]=F.properties.get("vertical-range");return{u_fog_matrix:G?Ce.calculateFogTileMatrix(G):fe||k.identityMat,u_fog_range:F.getFovAdjustedRange(Ce._fov),u_fog_color:De,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Pe),Pe],u_fog_temporal_offset:Te,u_frustum_tl:W,u_frustum_tr:K,u_frustum_br:J,u_frustum_bl:ae,u_globe_pos:re,u_globe_radius:ue,u_viewport:ye,u_globe_transition:s.aj(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,T,p,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],x);a.setFogUniformValues(n,D)}b&&a.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)a[x.key]=n[x.key]||new fl(x,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,a){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=nt||a[1]>=nt}setupDepthForOcclusion(n,a,p){const x=this.context,b=x.gl,T=!!p;var M;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),T||a.setTerrainUniformValues(x,p)}}function Gl(f,n){let a=!1,p=null;const x=()=>{p=null,a&&(f(),p=setTimeout(x,n),a=!1)};return()=>(a=!0,p||x(),p)}class Yh{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Gl(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=Ld(n);if(this._hashName){const p=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map((T=>{const M=T.split("=")[0];return M===p?(x=!0,`${M}=${a}`):T})).filter((T=>T));return x||b.push(`${p}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(a=p)})),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some((p=>isNaN(Number(p))))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:p,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ld(f,n){const a=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),T=Math.round(a.lng*b)/b,M=Math.round(a.lat*b)/b,D=f.getBearing(),k=f.getPitch();let F=n?`/${T}/${M}/${p}`:`${p}/${M}/${T}`;return(D||k)&&(F+="/"+Math.round(10*D)/10),k&&(F+=`/${Math.round(k)}`),F}const Nd={linearity:.3,easing:s.eS(0,0,.3,1)},nu=Object.assign({deceleration:2500,maxSpeed:1400},Nd),kd=Object.assign({deceleration:20,maxSpeed:1400},Nd),rl=Object.assign({deceleration:1e3,maxSpeed:360},Nd),pp=Object.assign({deceleration:1e3,maxSpeed:90},Nd);class mp{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.o.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(a.pan.mag()){const b=Lu(a.pan.mag(),p,Object.assign({},nu,n||{}));x.offset=a.pan.mult(b.amount/a.pan.mag()),x.center=this._map.transform.center,zu(x,b)}if(a.zoom){const b=Lu(a.zoom,p,kd);x.zoom=this._map.transform.zoom+b.amount,zu(x,b)}if(a.bearing){const b=Lu(a.bearing,p,rl);x.bearing=this._map.transform.bearing+s.aA(b.amount,-179,179),zu(x,b)}if(a.pitch){const b=Lu(a.pitch,p,pp);x.pitch=this._map.transform.pitch+b.amount,zu(x,b)}if(x.zoom||x.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function zu(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Lu(f,n,a){const{maxSpeed:p,linearity:x,deceleration:b}=a,T=s.aA(f*x/(n/1e3),-p,p),M=Math.abs(T)/(b*x);return{easing:a.easing,duration:1e3*M,amount:T*(M/2)}}class kr extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p,x={}){const b=$e(a.getCanvasContainer(),p),T=a.unproject(b);super(n,Object.assign({point:b,lngLat:T,originalEvent:p},x)),this._defaultPrevented=!1,this.target=a}}class jd extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p){const x=n==="touchend"?p.changedTouches:p.touches,b=st(a.getCanvasContainer(),x),T=b.map((D=>a.unproject(D))),M=b.reduce(((D,k,F,G)=>D.add(k.div(G.length))),new s.P(0,0));super(n,{points:b,point:M,lngLats:T,lngLat:a.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class iu extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class fm{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new iu(this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new kr(n.type,this._map,n))}mouseup(n){this._map.fire(new kr(n.type,this._map,n))}preclick(n){const a=new MouseEvent("preclick",n);this._map.fire(new kr(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new kr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new kr(n.type,this._map,n))}mouseover(n){this._map.fire(new kr(n.type,this._map,n))}mouseout(n){this._map.fire(new kr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new jd(n.type,this._map,n))}touchmove(n){this._map.fire(new jd(n.type,this._map,n))}touchend(n){this._map.fire(new jd(n.type,this._map,n))}touchcancel(n){this._map.fire(new jd(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nu{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new kr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new kr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pm{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Re(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const p=a,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ee("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(x.x,p.x),M=Math.max(x.x,p.x),D=Math.min(x.y,p.y),k=Math.max(x.y,p.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${T}px,${D}px)`,this._box.style.width=M-T+"px",this._box.style.height=k-D+"px")}))}mouseupWindow(n,a){if(!this._active)return;const p=this._startPos,x=a;if(p&&n.button===0){if(this.reset(),Le(),p.x!==x.x||p.y!==x.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),xe(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.z(n,{originalEvent:a}))}}function ku(f,n){const a={};for(let p=0;p<f.length;p++)a[f[p].identifier]=n[p];return a}class mm{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const b=new s.P(0,0);for(const T of x)b._add(T);return b.div(x.length)})(a),this.touches=ku(p,a)))}touchmove(n,a,p){if(this.aborted||!this.centroid)return;const x=ku(p,a);for(const b in this.touches){const T=x[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,a,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Cc{constructor(n){this.singleTap=new mm(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,p){this.singleTap.touchstart(n,a,p)}touchmove(n,a,p){this.singleTap.touchmove(n,a,p)}touchend(n,a,p){const x=this.singleTap.touchend(n,a,p);if(x){const b=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(b&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class gm{constructor(){this._zoomIn=new Cc({numTouches:1,numTaps:2}),this._zoomOut=new Cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,p){this._zoomIn.touchstart(n,a,p),this._zoomOut.touchstart(n,a,p)}touchmove(n,a,p){this._zoomIn.touchmove(n,a,p),this._zoomOut.touchmove(n,a,p)}touchend(n,a,p){const x=this._zoomIn.touchend(n,a,p),b=this._zoomOut.touchend(n,a,p);return x?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gp={0:1,2:2},_m={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ju{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const p=Et(n);this._correctButton(n,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(n,a){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&(function(x,b){const T=gp[b];return x.buttons===void 0||(x.buttons&T)!==T})(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(n){this._lastPoint&&Et(n)===this._eventButton&&(this._moved&&Le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Js extends ju{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class fo extends ju{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?_m[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const p=.8*(a.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class ym extends ju{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?_m[n.pitchRotateKey]:void 0}_correctButton(n,a){return this._pitchRotateKey?a===0&&n[this._pitchRotateKey]:a===0&&n.ctrlKey||a===2}_move(n,a){const p=-.5*(a.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class zg{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,a,p){return this._calculateTransform(n,a,p)}touchmove(n,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,p)}}touchend(n,a,p){this._calculateTransform(n,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,p){p.length>0&&(this._active=!0);const x=ku(p,a),b=new s.P(0,0),T=new s.P(0,0);let M=0;for(const k in x){const F=x[k],G=this._touches[k];G&&(b._add(F),T._add(F.sub(G)),M++,x[k]=F)}if(this._touches=x,M<this._minTouches||!T.mag())return;const D=T.div(M);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ee("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class _p{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,p){return{}}touchstart(n,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,p){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[b,T]=x,M=Qh(p,a,b),D=Qh(p,a,T);if(!M||!D)return;const k=this._aroundCenter?null:M.add(D).div(2);return this._move([M,D],k,n)}touchend(n,a,p){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,T=Qh(p,a,x),M=Qh(p,a,b);T&&M||(this._active&&Le(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qh(f,n,a){for(let p=0;p<f.length;p++)if(f[p].identifier===a)return n[p]}function Fd(f,n){return Math.log2(f/n)}class Lg extends _p{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Fd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fd(this._distance,p),pinchAround:a}}}function Jh(f,n){return 180*f.angleWith(n)/Math.PI}class Ng extends _p{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Jh(this._vector,p),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=Jh(n,p);return Math.abs(x)<a}}function xm(f){return Math.abs(f.y)>Math.abs(f.x)}class yp extends _p{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,xm(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,p){const x=this._lastPoints;if(!x)return;const b=n[0].sub(x[0]),T=n[1].sub(x[1]);return this._map._cooperativeGestures&&!s.eT()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(n,a,p){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,b=a.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=n.y>0==a.y>0;return xm(n)&&xm(a)&&T}}const vm={panStep:100,bearingStep:15,pitchStep:10};class kg{constructor(){const n=vm;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,p=0,x=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:M=>{const D=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:jg,zoom:a?Math.round(D)+a*(n.shiftKey?2:1):D,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jg(f){return f*(2-f)}const Fg=4.000244140625,Bg=1/450;class Vg{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Bg,s.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%Fg==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=$e(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Fg?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&F!==0&&(F=1/F);const G=a(),V=Math.pow(2,G),W=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(W*F))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a(),x=this._startZoom,b=this._easing;let T,M=!1;if(this._type==="wheel"&&x&&b){const k=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),F=b(k);T=s.ak(x,p,F),k<1?this._frameId||(this._frameId=!0):M=!0}else T=p,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let D=T-a();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.eU;if(this._prevEase){const p=this._prevEase,x=(s.o.now()-p.start)/p.duration,b=p.easing(x+.01)-p.easing(x),T=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-T*T);a=s.eS(T,M,.25,1)}return this._prevEase={start:s.o.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ee("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Br{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ug{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $g{constructor(){this._tap=new Cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,a,p))}touchmove(n,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=a[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,a,p)}touchend(n,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,a,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bm{constructor(n,a,p){this._el=n,this._mousePan=a,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gg{constructor(n,a,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ef{constructor(n,a,p,x){this._el=n,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bd=f=>f.zoom||f.drag||f.pitch||f.rotate;class wm extends s.z{}class Sl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const p=s.av([],a,n);this.radius=s.ag(p[2]<0?s.eW([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.eW(n,n,this.constants),s.aw(n,n),s.eX(n,n,this.constants);const a=s.c4([],n,this.radius);if(a[2]>0){const p=s.c4([],[0,0,1],s.bI(a,[0,0,1])),x=s.c4([],s.aw([],[a[0],a[1],0]),this.radius),b=s.d7([],a,s.c4([],s.av([],s.d7([],x,p),a),2));a[0]=b[0],a[1]=b[1]}return a}}function Fa(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Sm{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mp(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Sl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.aX(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,T]of this._listeners){const M=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,M,T)}}destroy(){for(const[n,a,p]of this._listeners){const x=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,x,p)}}_addDefaultHandlers(n){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new fm(a,n));const x=a.boxZoom=new pm(a,n);this._add("boxZoom",x);const b=new gm,T=new Ug;a.doubleClickZoom=new Br(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const M=new $g;this._add("tapDragZoom",M);const D=a.touchPitch=new yp(a);this._add("touchPitch",D);const k=new fo(n),F=new ym(n);a.dragRotate=new Gg(n,k,F),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const G=new Js(n),V=new zg(a,n);a.dragPan=new bm(p,G,V),this._add("mousePan",G),this._add("touchPan",V,["touchZoom","touchRotate"]);const W=new Ng,K=new Lg;a.touchZoomRotate=new ef(p,K,W,M),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nu(a));const J=a.scrollZoom=new Vg(a,this);this._add("scrollZoom",J,["mousePan"]);const ae=a.keyboard=new kg;this._add("keyboard",ae);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[re]&&a[re].enable(n[re])}_add(n,a,p){this._handlers.push({handlerName:n,handler:a,allowed:p}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,p){for(const x in n)if(x!==p&&(!a||a.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const p of n)this._el.contains(p.target)&&a.push(p);return a}handleEvent(n,a){this._updatingCamera=!0;const p=n.type==="renderFrame",x=p?void 0:n,b={needsRenderFrame:!1},T={},M={},D=n.touches?this._getMapTouches(n.touches):void 0,k=D?st(this._el,D):p?void 0:$e(this._el,n);for(const{handlerName:V,handler:W,allowed:K}of this._handlers){if(!W.isEnabled())continue;let J;this._blockedByActive(M,K,V)?W.reset():W[a||n.type]&&(J=W[a||n.type](n,k,D),this.mergeHandlerResult(b,T,J,V,x),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||W.isActive())&&(M[V]=W)}const F={};for(const V in this._previousActiveHandlers)M[V]||(F[V]=x);this._previousActiveHandlers=M,(Object.keys(F).length||Fa(b))&&(this._changes.push([b,T,F]),this._triggerRenderFrame()),(Object.keys(M).length||Fa(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=b;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(n,a,p,x,b){if(!p)return;Object.assign(n,p);const T={handlerName:x,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(a.zoom=T),p.panDelta!==void 0&&(a.drag=T),p.pitchDelta!==void 0&&(a.pitch=T),p.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const n={},a={},p={};for(const[x,b,T]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),Object.assign(a,b),Object.assign(p,T);this._updateMapTransform(n,a,p),this._changes=[]}_updateMapTransform(n,a,p){const x=this._map,b=x.transform,T=ue=>[ue.x,ue.y,ue.z];if((ue=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!Fa(n)){const ue=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),ue!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!Fa(n))return void this._fireEvents(a,p,!0);let{panDelta:M,zoomDelta:D,bearingDelta:k,pitchDelta:F,around:G,aroundCoord:V,pinchAround:W}=n;b._isCameraConstrained&&(D>0&&(D=0),b._isCameraConstrained=!1),W!==void 0&&(G=W),(D||(ue=>a[ue]&&!this._eventsInProgress[ue])("drag"))&&G&&(this._dragOrigin=T(b.pointCoordinate3D(G)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),G=G||x.transform.centerPoint,k&&(b.bearing+=k),F&&(b.pitch+=F),b._updateCameraState();const K=[0,0,0];if(M)if(b.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(G).dir),ye=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(G.sub(M)).dir);K[0]=ye[0]-ue[0],K[1]=ye[1]-ue[1]}else{const ue=b.pointCoordinate(G);if(b.projection.name==="globe"){M=M.rotate(-b.angle);const ye=b._pixelsPerMercatorPixel/b.worldSize;K[0]=-M.x*s.eV(s.a_(ue.y))*ye,K[1]=-M.y*s.eV(b.center.lat)*ye}else{const ye=b.pointCoordinate(G.sub(M));ue&&ye&&(K[0]=ye.x-ue.x,K[1]=ye.y-ue.y)}}const J=b.zoom,ae=[0,0,0];if(D){const ue=T(V||b.pointCoordinate3D(G)),ye={dir:s.aw([],s.av([],ue,b._camera.position))};if(ye.dir[2]<0){const fe=b.zoomDeltaToMovement(ue,D);s.c4(ae,ye.dir,fe)}}const re=s.d7(K,K,ae);b._translateCameraConstrained(re),D&&Math.abs(b.zoom-J)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,p,!0)}_fireEvents(n,a,p){const x=Bd(this._eventsInProgress),b=Bd(n),T={};for(const F in n){const{originalEvent:G}=n[F];this._eventsInProgress[F]||(T[`${F}start`]=G),this._eventsInProgress[F]=n[F]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const F in T)this._fireEvent(F,T[F]);b&&this._fireEvent("move",b.originalEvent);for(const F in n){const{originalEvent:G}=n[F];this._fireEvent(F,G)}const M={};let D;for(const F in this._eventsInProgress){const{handlerName:G,originalEvent:V}=this._eventsInProgress[F];this._handlersById[G].isActive()||(delete this._eventsInProgress[F],D=a[G]||V,M[`${F}end`]=D)}for(const F in M)this._fireEvent(F,M[F]);const k=Bd(this._eventsInProgress);if(p&&(x||b)&&!k){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;F?(G(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:D})):(this._map.fire(new s.z("moveend",{originalEvent:D})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.z(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{this._frameId=void 0,this.handleEvent(new wm("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ss="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fo extends s.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.aX(["_renderFrameCallback"],this)}getCenter(){return new s.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,p){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},a),p)}panTo(n,a,p){return this.easeTo(Object.assign({center:n},a),p)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,p){return this.easeTo(Object.assign({zoom:n},a),p)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,p){return this.easeTo(Object.assign({bearing:n},a),p)}resetNorth(n,a){return this.rotateTo(0,Object.assign({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=s.aI.convert(n);const p=a&&a.bearing||0,x=a&&a.pitch||0,b=n.getNorthWest(),T=n.getSouthEast();return this._cameraForBounds(this.transform,b,T,p,x,a)}_extendPadding(n){const a={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},a,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},a,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,a){const p=a.max[0]-a.min[0],x=a.max[1]-a.min[1];return p/x>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,p,x,b,T){const M=n.clone(),D=this._extendCameraOptions(T);M.bearing=x,M.pitch=b;const k=s.aS.convert(a),F=s.aS.convert(p),G=.5*(k.lat+F.lat),V=.5*(k.lng+F.lng),W=s.eY(G,V),K=s.aw([],W),J=s.aw([],s.bH([],K,[0,1,0])),ae=s.bH([],J,K),re=[J[0],J[1],J[2],0,ae[0],ae[1],ae[2],0,K[0],K[1],K[2],0,0,0,0,1],ue=[W,s.eY(k.lat,k.lng),s.eY(F.lat,k.lng),s.eY(F.lat,F.lng),s.eY(k.lat,F.lng),s.eY(G,k.lng),s.eY(G,F.lng),s.eY(k.lat,V),s.eY(F.lat,V)];let ye=s.d8.fromPoints(ue.map((rt=>[s.bI(J,rt),s.bI(ae,rt),s.bI(K,rt)])));const fe=s.af([],ye.center,re);s.eZ(fe)===0&&s.e_(fe,0,0,1),s.aw(fe,fe),s.c4(fe,fe,s.aD),M.center=s.e$(fe);const Ce=M.getWorldToCameraMatrix(),be=s.bk(new Float64Array(16),Ce);ye=s.d8.applyTransform(ye,s.aB([],Ce,re));const De=this._extendAABB(ye,M,D,x);if(!De)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=De,s.af(fe,fe,Ce);const Te=.5*(ye.max[2]-ye.min[2]),Se=this._minimumAABBFrustumDistance(M,ye),Pe=s.c4([],[0,0,1],Te),Xe=s.d7(Pe,fe,Pe),Ge=Se+(M.pitch===0?0:s.bF(fe,Xe)),dt=M.globeCenterInViewSpace,it=s.av([],fe,[dt[0],dt[1],dt[2]]);s.aw(it,it),s.c4(it,it,Ge);const gt=s.d7([],fe,it);s.af(gt,gt,be);const Ft=s.eL/s.aD,Je=s.ag(gt),Ve=s.ce(Math.max(Je*Ft-s.eL,Number.EPSILON),0),_t=Math.min(M.zoomFromMercatorZAdjusted(Ve),D.maxZoom);return _t>.5*(s.cZ+s.cK)?(M.setProjection({name:"mercator"}),M.zoom=_t,this._cameraForBounds(M,a,p,x,b,T)):{center:M.center,zoom:_t,bearing:x,pitch:b}}_extendAABB(n,a,p,x){const b=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),M=T,D=b,k=b,F=T,G=a.width-(D+k),V=a.height-(M+F),W=s.av([],n.max,n.min),K=Math.min(G/W[0],V/W[1]),J=Math.min(a.scaleZoom(a.scale*K),p.maxZoom);if(isNaN(J))return null;const ae=a.scale/a.zoomScale(J),re=new s.d8([n.min[0]-D*ae,n.min[1]-F*ae,n.min[2]],[n.max[0]+k*ae,n.max[1]+M*ae,n.max[2]]),ue=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.an(x));return re.center[0]-=ue.x*ae,re.center[1]+=ue.y*ae,re}queryTerrainElevation(n,a){const p=this.transform.elevation;return p?(a=Object.assign({},{exaggerated:!0},a),p.getAtPoint(s.ae.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,p,x,b,T){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,p,x,b,T);const M=n.clone(),D=this._extendCameraOptions(T);M.bearing=x,M.pitch=b;const k=s.aS.convert(a),F=s.aS.convert(p),G=new s.aS(k.lng,F.lat),V=new s.aS(F.lng,k.lat),W=M.project(k),K=M.project(F),J=this.queryTerrainElevation(k),ae=this.queryTerrainElevation(F),re=this.queryTerrainElevation(G),ue=this.queryTerrainElevation(V),ye=[[W.x,W.y,Math.min(J||0,ae||0,re||0,ue||0)],[K.x,K.y,Math.max(J||0,ae||0,re||0,ue||0)]];let fe=s.d8.fromPoints(ye);const Ce=M.getWorldToCameraMatrix(),be=s.bk(new Float64Array(16),Ce);fe=s.d8.applyTransform(fe,Ce);const De=this._extendAABB(fe,M,D,x);if(!De)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=De;const Te=.5*s.av([],fe.max,fe.min)[2],Se=this._minimumAABBFrustumDistance(M,fe),Pe=[0,0,1,0];s.aC(Pe,Pe,Ce),s.f0(Pe,Pe);const Xe=s.c4([],Pe,Se+Te),Ge=s.d7([],fe.center,Xe);s.af(fe.center,fe.center,be),s.af(Ge,Ge,be);const dt=M.unproject(new s.P(fe.center[0],fe.center[1])),it=s.f1(M.projection,dt),gt=Math.pow(2,it),Ft=Math.min(M._zoomFromMercatorZ(Ge[2]*M.pixelsPerMeter*gt/M.worldSize),D.maxZoom);return M.mercatorFromTransition&&Ft<.5*(s.cZ+s.cK)?(M.setProjection({name:"globe"}),M.zoom=Ft,this._cameraForBounds(M,a,p,x,b,T)):{center:dt,zoom:Ft,bearing:x,pitch:b}}fitBounds(n,a,p){const x=this.cameraForBounds(n,a);return this._fitInternal(x,a,p)}fitScreenCoordinates(n,a,p,x,b){const T=s.P.convert(n),M=s.P.convert(a),D=new s.P(Math.min(T.x,M.x),Math.min(T.y,M.y)),k=new s.P(Math.max(T.x,M.x),Math.max(T.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,M))return this;const F=this.transform.pointLocation3D(D),G=this.transform.pointLocation3D(k),V=this.transform.pointLocation3D(new s.P(D.x,k.y)),W=this.transform.pointLocation3D(new s.P(k.x,D.y)),K=[Math.min(F.lng,G.lng,V.lng,W.lng),Math.min(F.lat,G.lat,V.lat,W.lat)],J=[Math.max(F.lng,G.lng,V.lng,W.lng),Math.max(F.lat,G.lat,V.lat,W.lat)],ae=x&&x.pitch?x.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,K,J,p,ae,x);return this._fitInternal(re,x,b)}_fitInternal(n,a,p){return n?(a=Object.assign(n,a)).linear?this.easeTo(a,p):this.flyTo(a,p):this}jumpTo(n,a){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,T=!1;"zoom"in n&&p.zoom!==+n.zoom&&(x=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.aS.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(b=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(T=!0,p.pitch=+n.pitch);const M=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(M))if(n.retainPadding===!1){const D=p.clone();D.padding=M,p.setLocationAtPoint(p.center,D.centerPoint)}else p.padding=M;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",a)).fire(new s.z("move",a)),x&&this.fire(new s.z("zoomstart",a)).fire(new s.z("zoom",a)).fire(new s.z("zoomend",a)),b&&this.fire(new s.z("rotatestart",a)).fire(new s.z("rotate",a)).fire(new s.z("rotateend",a)),T&&this.fire(new s.z("pitchstart",a)).fire(new s.z("pitch",a)).fire(new s.z("pitchend",a)),this.fire(new s.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Ss),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(Ss),this;this.stop();const x=p.zoom,b=p.pitch,T=p.bearing;p.setFreeCameraOptions(n);const M=x!==p.zoom,D=b!==p.pitch,k=T!==p.bearing;return this.fire(new s.z("movestart",a)).fire(new s.z("move",a)),M&&this.fire(new s.z("zoomstart",a)).fire(new s.z("zoom",a)).fire(new s.z("zoomend",a)),k&&this.fire(new s.z("rotatestart",a)).fire(new s.z("rotate",a)).fire(new s.z("rotateend",a)),D&&this.fire(new s.z("pitchstart",a)).fire(new s.z("pitch",a)).fire(new s.z("pitchend",a)),this.fire(new s.z("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:s.eU},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),M=this.getPadding(),D="zoom"in n?+n.zoom:x,k="bearing"in n?this._normalizeBearing(n.bearing,b):b,F="pitch"in n?+n.pitch:T,G=this._extendPadding(n.padding),V=s.P.convert(n.offset);let W,K,J;if(p.projection.name==="globe"){const Pe=s.ae.fromLngLat(p.center),Xe=V.rotate(-p.angle);Pe.x+=Xe.x/p.worldSize,Pe.y+=Xe.y/p.worldSize;const Ge=Pe.toLngLat(),dt=s.aS.convert(n.center||Ge);this._normalizeCenter(dt),W=p.centerPoint.add(Xe),K=new s.P(Pe.x,Pe.y).mult(p.worldSize),J=new s.P(s.aF(dt.lng),s.aJ(dt.lat)).mult(p.worldSize).sub(K)}else{W=p.centerPoint.add(V);const Pe=p.pointLocation(W),Xe=s.aS.convert(n.center||Pe);this._normalizeCenter(Xe),K=p.project(Pe),J=p.project(Xe).sub(K)}const ae=p.zoomScale(D-x);let re,ue;n.around&&(re=s.aS.convert(n.around),ue=p.locationPoint(re));const ye=this._zooming||D!==x,fe=this._rotating||b!==k,Ce=this._pitching||F!==T,be=!p.isPaddingEqual(G),De=n.retainPadding===!1?p.clone():p,Te=Pe=>Xe=>{if(ye&&(Pe.zoom=s.ak(x,D,Xe)),fe&&(Pe.bearing=s.ak(b,k,Xe)),Ce&&(Pe.pitch=s.ak(T,F,Xe)),be&&(De.interpolatePadding(M,G,Xe),W=De.centerPoint.add(V)),re)Pe.setLocationAtPoint(re,ue);else{const Ge=Pe.zoomScale(Pe.zoom-x),dt=D>x?Math.min(2,ae):Math.max(.5,ae),it=Math.pow(dt,1-Xe),gt=Pe.unproject(K.add(J.mult(Xe*it)).mult(Ge));Pe.setLocationAtPoint(Pe.renderWorldCopies?gt.wrap():gt,W)}return n.preloadOnly||this._fireMoveEvents(a),Pe};if(n.preloadOnly){const Pe=this._emulate(Te,n.duration,p);return this._preloadTiles(Pe),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=fe,this._pitching=Ce,this._padding=be,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,Se),this._ease(Te(p),(Pe=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(a,Pe)}),n),this}_prepareEase(n,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||p.moving||this.fire(new s.z("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.z("move",n)),this._zooming&&this.fire(new s.z("zoom",n)),this._rotating&&this.fire(new s.z("rotate",n)),this._pitching&&this.fire(new s.z("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",n)),x&&this.fire(new s.z("rotateend",n)),b&&this.fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const rt=s.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(rt,a)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eU},n);const p=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),M=this.getPadding(),D="zoom"in n?s.aA(+n.zoom,p.minZoom,p.maxZoom):x,k="bearing"in n?this._normalizeBearing(n.bearing,b):b,F="pitch"in n?+n.pitch:T,G=this._extendPadding(n.padding),V=p.zoomScale(D-x),W=s.P.convert(n.offset);let K=p.centerPoint.add(W);const J=p.pointLocation(K),ae=s.aS.convert(n.center||J);this._normalizeCenter(ae);const re=p.project(J),ue=p.project(ae).sub(re);let ye=n.curve;const fe=Math.max(p.width,p.height),Ce=fe/V,be=ue.mag();if("minZoom"in n){const rt=s.aA(Math.min(n.minZoom,x,D),p.minZoom,p.maxZoom),Pt=fe/p.zoomScale(rt-x);ye=Math.sqrt(Pt/be*2)}const De=ye*ye;function Te(rt){const Pt=(Ce*Ce-fe*fe+(rt?-1:1)*De*De*be*be)/(2*(rt?Ce:fe)*De*be);return Math.log(Math.sqrt(Pt*Pt+1)-Pt)}function Se(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function Pe(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const Xe=Te(0);let Ge=function(rt){return Pe(Xe)/Pe(Xe+ye*rt)},dt=function(rt){return fe*((Pe(Xe)*(Se(Pt=Xe+ye*rt)/Pe(Pt))-Se(Xe))/De)/be;var Pt},it=(Te(1)-Xe)/ye;if(Math.abs(be)<1e-6||!isFinite(it)){if(Math.abs(fe-Ce)<1e-6)return this.easeTo(n,a);const rt=Ce<fe?-1:1;it=Math.abs(Math.log(Ce/fe))/ye,dt=function(){return 0},Ge=function(Pt){return Math.exp(rt*ye*Pt)}}n.duration="duration"in n?+n.duration:1e3*it/("screenSpeed"in n?+n.screenSpeed/ye:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const gt=b!==k,Ft=F!==T,Je=!p.isPaddingEqual(G),Ve=n.retainPadding===!1?p.clone():p,_t=rt=>Pt=>{const Rt=Pt*it,Qt=1/Ge(Rt);rt.zoom=Pt===1?D:x+rt.scaleZoom(Qt),gt&&(rt.bearing=s.ak(b,k,Pt)),Ft&&(rt.pitch=s.ak(T,F,Pt)),Je&&(Ve.interpolatePadding(M,G,Pt),K=Ve.centerPoint.add(W));const bt=Pt===1?ae:rt.unproject(re.add(ue.mult(dt(Rt))).mult(Qt));return rt.setLocationAtPoint(rt.renderWorldCopies?bt.wrap():bt,K),rt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),rt};if(n.preloadOnly){const rt=this._emulate(_t,n.duration,p);return this._preloadTiles(rt),this}return this._zooming=!0,this._rotating=gt,this._pitching=Ft,this._padding=Je,this._prepareEase(a,!1),this._ease(_t(p),(()=>this._afterEase(a)),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,a)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,a,p){p.animate===!1||p.duration===0?(n(1),a()):(this._easeStart=s.o.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.bS(n,-180,180);const p=Math.abs(n-a);return Math.abs(n-360-a)<p&&(n-=360),Math.abs(n+360-a)<p&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const p=n.lng-a.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,p){const x=Math.ceil(15*a/1e3),b=[],T=n(p.clone());for(let M=0;M<=x;M++){const D=T(M/x);b.push(D.clone())}return b}_preloadTiles(n,a){}}class Fu{constructor(n={}){this.options=n,s.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ee("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=ee("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=ee("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const p=a.reduce(((x,b,T)=>(b.value&&(x+=`${b.key}=${b.value}${T<a.length-1?"&":""}`),x)),"?");n.href=`${s.e.FEEDBACK_URL}/${p}#${Ld(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const a=this._map.style._mergedSourceCaches;for(const x in a){const b=a[x];if(b.used){const T=b.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort(((x,b)=>x.length-b.length)),n=n.filter(((x,b)=>{for(let T=b+1;T<n.length;T++)if(n[T].indexOf(x)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class tf{constructor(){s.aX(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ee("div","mapboxgl-ctrl");const a=ee("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const p=n[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class nf{constructor(){s.aX(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(a=>this._onIndoorUpdate(a))),this._container}_createButton(n,a){const p=ee("button",n,this._container);return p.type="button",p.addEventListener("click",a),p}_createSeparator(){return ee("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,a){this._map&&(n.setAttribute("aria-label",a),n.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const a=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",a&&Array.from(this._container.children).forEach((p=>p.remove())),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const a=this._map;this._model&&a&&a._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));ee("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,a){for(let p=0;p<n.length;p++){const x=n[p],b=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(x.id)}));this._setButtonTitle(b,x.zIndex.toString()),this._model&&x.id===this._model.selectedFloorId&&a&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<n.length-1&&this._createSeparator()}}}class rf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const x of p)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class _s{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.dC((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,p){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+p}}const Qx={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class py extends s.z{constructor(n,a,p,x){const{point:b,lngLat:T,originalEvent:M,target:D}=n;super(n.type,{point:b,lngLat:T,originalEvent:M,target:D}),this.preventDefault=()=>{n.preventDefault()},this.id=a,this.interaction=p,this.feature=x}}class Tm{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,a){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=a.filter;let x=a.type;p&&this.filters.set(n,s.b5(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,a)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(n,a),this.typeById.set(n,x)}get(n){const a=this.typeById.get(n);if(!a)return;const p=this.interactionsByType.get(a);return p?p.get(n):void 0}remove(n){const a=this.typeById.get(n);if(!a)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(a);p&&(p.delete(n),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(a,this.handleType))}queryTargets(n,a){const p=[];for(const[x,b]of a)b.target&&p.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());a.length&&(n.type="mouseenter",this.handleType(n,a));const p=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(b.id,b);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const a=Array.from(this.hoveredFeatures.values()).map((({feature:p})=>p));a.length&&(n.type="mouseleave",this.handleType(n,a)),this.hoveredFeatures.clear()}handleType(n,a){const p=n.type==="mouseenter";if(p&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(n.type)).reverse(),b=!!a;a=a||this.queryTargets(n.point,x);let T=!1;const M=new Set;for(const D of a){for(const[k,F]of x){if(!F.target)continue;const G=D.variants?D.variants[k]:null;if(G){for(const V of G){if(na(V,D,M,k))continue;const W=new s.dw(D,V),K=ul(V,D,k);b&&W.id!==void 0&&(W.state=this.map.getFeatureState(W));const J=p?this.prevHoveredFeatures.get(K):null,ae=new py(n,k,F,W),re=J?J.stop:F.handler(ae);if(p&&this.hoveredFeatures.set(K,{feature:D,stop:re}),re!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[D,k]of x){const{handler:F,target:G}=k;if(!G&&F(new py(n,D,k,null))!==!1)break}}}function Vd(f,n){if(Array.isArray(f)&&Array.isArray(n)){const a=new Set(f),p=new Set(n);return a.size===p.size&&f.every((x=>p.has(x)))}return s.bx(f,n)}const Hl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},xp={showCompass:!0,showZoom:!0,visualizePitch:!1};class sf{constructor(n,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new fo({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new ym({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Re()}move(n,a){const p=this.map,x=this.mouseRotate.mousemoveWindow(n,a),b=x&&x.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,a),M=T&&T.pitchDelta;M&&p.setPitch(p.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){xe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),$e(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,$e(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=st(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=st(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function sl(f,n,a){if(f=new s.aS(f.lng,f.lat),n){const p=new s.aS(f.lng-360,f.lat),x=new s.aS(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-a.center.lng)/360),T=a.locationPoint3D(f).distSqr(n),M=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint3D(p).distSqr(n)<T&&(M||Math.abs(p.lng-a.center.lng)<b)?f=p:a.locationPoint3D(x).distSqr(n)<T&&(M||Math.abs(x.lng-a.center.lng)<b)&&(f=x)}for(;Math.abs(f.lng-a.center.lng)>180;){const p=a.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f}const po={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Co={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ql extends s.E{constructor(n,a){super(),(n instanceof HTMLElement||a)&&(n=Object.assign({element:n},a)),s.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:b=1,draggable:T=!1,clickTolerance:M=0,rotation:D=Co.rotation,rotationAlignment:k=Co.rotationAlignment,pitchAlignment:F=Co.pitchAlignment,occludedOpacity:G=Co.occludedOpacity,altitude:V=Co.altitude}=n||{};this._anchor=p,this._color=x,this._scale=b,this._draggable=T,this._clickTolerance=M,this._rotation=D,this._rotationAlignment=k,this._pitchAlignment=F,this._occludedOpacity=G,this._altitude=V,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(J=>{J.preventDefault()})),this._element.addEventListener("mousedown",(J=>{J.preventDefault()}));const W=this._element.classList;for(const J in po)W.remove(`mapboxgl-marker-anchor-${J}`);W.add(`mapboxgl-marker-anchor-${this._anchor}`);const K=n&&n.className?n.className.trim().split(/\s+/):[];W.add(...K),this._popup=null}_createDefaultMarker(){const n=ee("div"),a=le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=le("radialGradient",{id:"shadowGradient"},le("defs",{},a));le("stop",{offset:"10%","stop-opacity":.4},p),le("stop",{offset:"100%","stop-opacity":.05},p),le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.aS.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Co.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,p=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const p=n.unproject(a,this._altitude),x=n.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(a,this._altitude);let x;n._showingGlobe()&&s.f4(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${po[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,p=this.getPitchAlignment();if(!a||!n||p!=="map")return"";if(!a._showingGlobe()){const D=a.getPitch();return D?`rotateX(${D}deg)`:""}const x=s.cW(s.f5(a.transform,this._lngLat)),b=n.sub(s.f6(a.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const M=x/T;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(a._showingGlobe()){const b=a.project(new s.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=a.project(new s.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=s.cW(Math.atan2(T.y,T.x))-90}else p=-a.getBearing();else if(x==="horizon"){const b=s.ah(4,6,a.getZoom()),T=s.f6(a.transform);T.y+=b*a.transform.height;const M=n.sub(T),D=s.cW(Math.atan2(M.y,M.x));p=(D>90?D-270:D+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=sl(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),a._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(n.point.dist(p)<b)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,p=this._pos;a&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Co.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Co.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Co.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Co.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Tl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Hg={maxWidth:100,unit:"metric"},qg={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Em={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},my=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zl(f=new s.P(0,0),n="bottom"){if(typeof f=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new s.P(0,f);case"top-left":return new s.P(a,a);case"top-right":return new s.P(-a,a);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(a,-a);case"bottom-right":return new s.P(-a,-a);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[n]||[0,0])}return{version:O,supported:oe.supported,setRTLTextPlugin:s.fa,getRTLTextPluginStatus:s.f9,Map:class extends Fo{constructor(f){j.mark(z.create);const n=f;if((f=Object.assign({},Hl,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.f2(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new No(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new rf,this._domRenderTaskQueue=new rf,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b1(),this._locale=Object.assign({},Qx,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _s(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new ut(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const a=document.getElementById(f.container);if(!a)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=a}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,s.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new hy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Sm(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Yh(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const a=f.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Fu({customAttribution:f.customAttribution})),this._logoControl=new tf,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new s.z(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new s.z(`${a.dataType}dataloading`,a))})),this._interactions=new Tm(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),this.fire(new s.z("resize",f)),n&&this.fire(new s.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((n=>n.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map((n=>n==="auto"?navigator.language:n)):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let a;n==="globe"&&f.zoom>=s.cK?(f.setMercatorFromTransition(),a=!0):n==="mercator"&&f.zoom<s.cK&&(f.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;const a=this.transform.mercatorFromTransition;n=f.name==="globe"&&this.transform.zoom>=s.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&a!==this.transform.mercatorFromTransition;return(n||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,n){return this.transform.locationPoint3D(s.aS.convert(f),n)}unproject(f,n){return this.transform.pointLocation3D(s.P.convert(f),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,a){const p=x=>{let b=[];if(Array.isArray(n)){const T=n.filter((M=>this.getLayer(M)));b=T.length?this.queryRenderedFeatures(x,{layers:T}):[]}else b=this.queryRenderedFeatures(x,{target:n});return b};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:a,targets:n,delegates:{mousemove:T=>{const M=p(T.point);M.length?x||(x=!0,a.call(this,new kr(f,this,T.originalEvent,{features:M}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:a,targets:n,delegates:{mousemove:M=>{p(M.point).length?x=!0:x&&(x=!1,a.call(this,new kr(f,this,M.originalEvent)))},mouseout:M=>{x&&(x=!1,a.call(this,new kr(f,this,M.originalEvent)))}}}}{const x=b=>{const T=p(b.point);T.length&&(b.features=T,a.call(this,b),delete b.features)};return{listener:a,targets:n,delegates:{[f]:x}}}}on(f,n,a){if(typeof n=="function"||a===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,n,a){if(typeof n=="function"||a===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,a);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,n,a){if(typeof n=="function"||a===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(x=>{for(let b=0;b<x.length;b++){const T=x[b];if(T.listener===a&&Vd(T.targets,n)){for(const M in T.delegates)this.off(M,T.delegates[M]);return x.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof s.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(T)}let a=!0;if(n.target&&(a=this._isTargetValid(n.target),a&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(f,n,this.transform))),a&&(x=x.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),x}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}queryRasterValue(f,n,a){return this._isValidId(f)?this.style.queryRasterValue(f,n,a):Promise.resolve(null)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,((a,p)=>{if(a){const x=typeof a=="string"?a:a instanceof Error?a.message:a.error;s.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(f,n)}else p&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const a=Object.assign({},n);n&&n.config&&(a.initialConfig=n.config,delete a.config),this.style=new ml(this,a).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ml(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dq(f)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,a)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:a=1,sdf:p=!1,stretchX:x,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const M=s.I.from(f);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:D,height:k,data:F}=s.o.getImageData(n);this.style.addImage(M,{data:new s.q({width:D,height:k},F),pixelRatio:a,stretchX:x,stretchY:b,content:T,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:k}=n,F=n;this.style.addImage(M,{data:new s.q({width:D,height:k},new Uint8Array(F.data)),pixelRatio:a,stretchX:x,stretchY:b,content:T,sdf:p,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const a=s.I.from(f),p=this.style.getImage(a);if(!p)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.o.getImageData(n):n,{width:b,height:T,data:M}=x;if(b===void 0||T===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||T!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const D=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let k=!1;p.usvg?(p.data=new s.q({width:b,height:T},new Uint8Array(M)),p.usvg=!1,p.icon=void 0,k=!0):p.data.replace(M,D),this.style.updateImage(a,p,k)}hasImage(f){return f?!!this.style&&!!this.style.getImage(s.I.from(f)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(s.I.from(f))}loadImage(f,n){s.n(this._requestManager.transformRequest(f,s.R.Image),((a,p)=>{n(a,p instanceof HTMLImageElement?s.o.getImageData(p):p)}))}listImages(){return this.style.listImages().map((f=>f.name))}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n).catch((a=>this.fire(new s.y(new Error("Failed to add import",a))))),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,a){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,a),this._update(!0)):this}setFilter(f,n,a={}){return this._isValidId(f)?(this.style.setFilter(f,n,a),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,a,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,a,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,a,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,a,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}setLayerProperty(f,n,a,p={}){return this._isValidId(f)?(this.style.setLayerProperty(f,n,a,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,a){return this.style.setConfigProperty(f,n,a),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aS.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new nf),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,p,x,b=this._container;for(;b&&(!p||!x);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(p=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(x=a[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new md(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ee("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ee("div","mapboxgl-canvas-container",f);this._canvas=ee("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=ee("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((x=>{p[x]=ee("div",`mapboxgl-ctrl-${x}`,a)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const a=s.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(f),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=Object.assign({},oe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(Rr(n,!0),this.painter=new tu(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.k.testSupport(n)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new s.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,p=s.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=x.createQuery(),x.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,F=this.transform.pitch,G=s.o.now(),V=new s.ac(k,{now:G,fadeDuration:b,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,j.mark(z.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const k=s.o.now()-p;x.endQuery(a.TIME_ELAPSED_EXT),setTimeout((()=>{const F=x.getQueryParameter(n,x.QUERY_RESULT)/1e6;x.deleteQuery(n),this.fire(new s.z("gpu-timing-frame",{cpuTime:k,gpuTime:F}))}),50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout((()=>{const F=this.painter.queryGpuTimers(k);this.fire(new s.z("gpu-timing-layer",{layerTimes:F}))}),50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const F=this.painter.queryGpuTimeDeferredRender(k);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:F}))}),50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(D||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,j.mark(z.fullLoad),this._performanceMetricsCollection&&In(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const a=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const T=Math.abs(x-b);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(f)&&a(this._averageElevation.getValue(f))}_authenticate(){ji(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(f=>{if(f&&(f.message===tt||f.status===401)){const n=this.painter.context.gl;Rr(n,!1),this._logoControl instanceof tf&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Kt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Nn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&On(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function x(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(f,n,a){let p=a[1]-a[0];const x=f.length/4;for(let b=0;b<n.length;b++){const T=n[b];let M=0;for(let D=0;D<T.length;D+=4)T[D]===f[D]&&T[D+1]===f[D+1]&&T[D+2]===f[D+2]&&T[D+3]===f[D+3]&&(M+=1);p+=(a[b+2]-a[b+1])*(1-M/x)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ri.delete(this.painter.context.gl),gi.remove(),vt.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.o.frame((n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)})))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return s.bv(n,((a,p)=>a._preloadTiles(f,p)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,n){s.f3(f,n)}get version(){return O}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},xp,f),this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(s.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(n=>{this._map&&this._map.zoomIn({},{originalEvent:n})})),ee("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(n=>{this._map&&this._map.zoomOut({},{originalEvent:n})})),ee("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))})),this._compassIcon=ee("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),a=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=n)}))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sf(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const a=ee("button",f,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(f,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",a),f.firstElementChild&&f.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.E{constructor(f={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Tl,f),s.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Gl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,f(a)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((a=>n(a.state!=="denied"))).catch((()=>n())):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),a=f.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const n=new s.aS(f.coords.longitude,f.coords.latitude),a=f.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),x,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new s.aS(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=s.ce(1,f._center.lat)*f.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=ee("button","mapboxgl-ctrl-geolocate",this._container),ee("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ee("div","mapboxgl-user-location"),this._dotElement.appendChild(ee("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ee("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ql({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ee("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ql({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))}))}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((n=>{n==="granted"&&f()})).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fu,ScaleControl:class{constructor(f={}){this.options=Object.assign({},Hg,f),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),s.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,p=n._containerWidth/2-f/2,x=n.unproject([p,a]),b=n.unproject([p+f,a]),T=x.distanceTo(b);if(this.options.unit==="imperial"){const M=3.2808*T;M>5280?this._setScale(f,M/5280,"mile"):this._setScale(f,M,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,n,a){this._map._requestDomTask((()=>{const p=(function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/T;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(D){const k=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*k)/k})(M),T*M})(n),x=p/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(p):`${p}&nbsp;${qg[a]}`,this._container.style.width=f*x+"px"}))}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=ee("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ee("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:nf,Popup:class extends s.E{constructor(f){super(),this.options=Object.assign(Object.create(Em),f),this._altitude=this.options.altitude,s.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.aS.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),a=document.createElement("body");let p;for(a.innerHTML=f;p=a.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ee("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const a=this._closeButton=ee("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,p=this._pos;if(!n||!a||!p)return"bottom";const x=a.offsetWidth,b=a.offsetHeight,T=p.x<x/2,M=p.x>n.transform.width-x/2;if(p.y+f<b)return T?"top-left":M?"top-right":"top";if(p.y>n.transform.height-b){if(T)return"bottom-left";if(M)return"bottom-right"}return T?"left":M?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let p=this._container;if(p||(p=this._container=ee("div","mapboxgl-popup",n.getContainer()),this._tip=ee("div","mapboxgl-popup-tip",p),p.appendChild(a)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sl(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof s.P?f:n.project(this._lngLat,this._altitude),b=Zl(this.options.offset),T=this._anchor=this._getAnchor(b.y),M=Zl(this.options.offset,T),D=x.add(M).round();n._requestDomTask((()=>{this._container&&T&&(this._container.style.transform=`${po[T]} translate(${D.x}px,${D.y}px)`)}))}if(!this._marker&&n._showingGlobe()){const x=s.f4(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(my);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:ql,Style:ml,LngLat:s.aS,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:cc,Evented:s.E,config:s.e,prewarm:s.f8,clearPrewarmedResources:s.f7,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.fh.workerCount},set workerCount(f){s.fh.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.fg(f)},get workerUrl(){return s.ff.workerUrl},set workerUrl(f){s.ff.workerUrl=f},get workerClass(){return s.ff.workerClass},set workerClass(f){s.ff.workerClass=f},get workerParams(){return s.ff.workerParams},set workerParams(f){s.ff.workerParams=f},get dracoUrl(){return s.fe()},set dracoUrl(f){s.fd(f)},get meshoptUrl(){return s.fc()},set meshoptUrl(f){s.fb(f)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}}));var E=y;return E}))})(ew)),ew.exports}var X9=W9();const Zu=GE(X9);class K9{cache=new Map;MAPBOX_DIRECTIONS_URL="https://api.mapbox.com/directions/v5/mapbox/driving";async getRoute(i){if(i.length<2)return i;const c=i.map(d=>`${d[0]},${d[1]}`).join("|");if(this.cache.has(c))return console.log("[RoutingService] Using cached route"),this.cache.get(c);try{const d="pk.eyJ1IjoiYmlsYWxhbGliIiwiYSI6ImNtaWlmMHZiazAzNTkzZHNpYTVzeWpueWoifQ.fnHQ0i_G-NInzirfb9ZX6Q",y=i.map(O=>`${O[1]},${O[0]}`).join(";"),w=`${this.MAPBOX_DIRECTIONS_URL}/${y}?geometries=geojson&overview=full&access_token=${d}`;console.log("[RoutingService] Fetching route from Mapbox...");const s=await(await fetch(w)).json();if(s.code==="Ok"&&s.routes&&s.routes.length>0){const O=s.routes[0].geometry.coordinates.map(z=>[z[1],z[0]]);return console.log(`[RoutingService] Got route with ${O.length} points`),this.cache.set(c,O),O}else return console.warn("[RoutingService] Mapbox routing failed, falling back to straight lines:",s),i}catch(d){return console.error("[RoutingService] Error fetching route from Mapbox:",d),i}}clearCache(){this.cache.clear()}async getRouteWithInfo(i){if(i.length<2)return{coordinates:i,distance:0,duration:0};try{const c="pk.eyJ1IjoiYmlsYWxhbGliIiwiYSI6ImNtaWlmMHZiazAzNTkzZHNpYTVzeWpueWoifQ.fnHQ0i_G-NInzirfb9ZX6Q",d=i.map(s=>`${s[1]},${s[0]}`).join(";"),y=`${this.MAPBOX_DIRECTIONS_URL}/${d}?geometries=geojson&overview=full&access_token=${c}`,E=await(await fetch(y)).json();if(E.code==="Ok"&&E.routes&&E.routes.length>0){const s=E.routes[0];return{coordinates:s.geometry.coordinates.map(z=>[z[1],z[0]]),distance:s.distance,duration:s.duration}}}catch(c){console.error("[RoutingService] Error fetching route info from Mapbox:",c)}return{coordinates:i,distance:0,duration:0}}}const Y9=new K9;Zu.accessToken="pk.eyJ1IjoiYmlsYWxhbGliIiwiYSI6ImNtaWlmMHZiazAzNTkzZHNpYTVzeWpueWoifQ.fnHQ0i_G-NInzirfb9ZX6Q";const nS=({initialViewState:t={longitude:73.0479,latitude:33.6844,zoom:12},buses:i=[],stops:c=[],showRoute:d=!1,routeColor:y="#0ea5e9",height:w="400px",interactive:E=!0,showControls:s=!0,fitToBounds:O=!1})=>{const z=Z.useRef(null),j=Z.useRef(null),H=Z.useRef(new Map),Y=Z.useRef(new Map),[ie,oe]=Z.useState(!1);Z.useEffect(()=>{if(!(!z.current||j.current)){try{j.current=new Zu.Map({container:z.current,style:"mapbox://styles/mapbox/streets-v12",center:[t.longitude,t.latitude],zoom:t.zoom,interactive:E}),s&&E&&j.current.addControl(new Zu.NavigationControl,"top-right"),j.current.on("load",()=>{oe(!0)}),j.current.on("error",_e=>{console.error("Mapbox error:",_e)})}catch(_e){console.error("Failed to initialize map:",_e)}return()=>{j.current&&(j.current.remove(),j.current=null)}}},[]);const ee=_e=>{const Re=new Date,xe=new Date(_e),Ze=Re.getTime()-xe.getTime(),Le=Math.floor(Ze/1e3),$e=Math.floor(Le/60),st=Math.floor($e/60),Et=Math.floor(st/24);return Et>0?`${Et}d ago`:st>0?`${st}h ago`:$e>0?`${$e}m ago`:"Just now"},le=_e=>{const Re=new Date,xe=new Date(_e);return Re.getTime()-xe.getTime()>6e4},ge=(_e,Re,xe)=>{const Ze=document.createElement("div");Ze.className="bus-marker";const Le=xe==="active",$e=le(Re.timestamp),st=!Le||$e,Ut={active:{bg:"#1e40af",gradient:"linear-gradient(135deg, #3b82f6 0%, #1e40af 100%)",shadow:"rgba(59, 130, 246, 0.5)"},inactive:{bg:"#6b7280",gradient:"linear-gradient(135deg, #9ca3af 0%, #6b7280 100%)",shadow:"rgba(107, 114, 128, 0.5)"},maintenance:{bg:"#d97706",gradient:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)",shadow:"rgba(217, 119, 6, 0.5)"}}[xe];Ze.style.cssText=`
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    `;const $t=Le?"":`
      <div style="
        background: ${xe==="maintenance"?"#fef3c7":"#f3f4f6"};
        color: ${xe==="maintenance"?"#92400e":"#374151"};
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 2px;
        font-family: system-ui, -apple-system, sans-serif;
      ">${xe}</div>
    `,tt=st?`<div style="
          background: ${Le?"#1e40af":Ut.bg};
          color: white;
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 10px;
          font-weight: 600;
          white-space: nowrap;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
          font-family: system-ui, -apple-system, sans-serif;
        "> ${ee(Re.timestamp)}</div>`:`<div style="
          background: #1e40af;
          color: white;
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 11px;
          font-weight: 700;
          white-space: nowrap;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
          font-family: system-ui, -apple-system, sans-serif;
        ">${Re.speed!=null?Re.speed+" km/h":"N/A"}</div>`,ut=Le&&!$e?`
      <div style="
        position: absolute;
        top: 0;
        left: 0;
        width: 40px;
        height: 40px;
        background: ${Ut.shadow.replace("0.5","0.2")};
        border-radius: 50%;
        animation: busPulse 2s infinite;
        pointer-events: none;
      "></div>
    `:"";return Ze.innerHTML=`
      ${$t}
      ${tt}
      <div style="
        position: relative;
        width: 40px;
        height: 40px;
      ">
        <div style="
          position: absolute;
          width: 40px;
          height: 40px;
          background: ${Ut.gradient};
          border: 3px solid white;
          border-radius: 50%;
          box-shadow: 0 4px 12px ${Ut.shadow};
          display: flex;
          align-items: center;
          justify-content: center;
          transform: rotate(${Re.heading||0}deg);
          ${Le?"":"opacity: 0.7;"}
        ">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M12 2L2 7v10c0 5 10 5 10 5s10 0 10-5V7L12 2z"/>
            <path d="M12 2v20" stroke="white" stroke-width="2"/>
          </svg>
        </div>
        ${ut}
      </div>
      <div style="
        background: white;
        color: ${Ut.bg};
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 700;
        white-space: nowrap;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        border: 1px solid ${Ut.bg};
        font-family: system-ui, -apple-system, sans-serif;
      ">${_e.registration_number}</div>
      <style>
        @keyframes busPulse {
          0% {
            transform: scale(0.8);
            opacity: 1;
          }
          100% {
            transform: scale(2.5);
            opacity: 0;
          }
        }
      </style>
    `,Ze},pe=(_e,Re,xe)=>{const Ze=document.createElement("div");Ze.className="stop-marker",Ze.style.cssText=`
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    `;const Le=Re===0,$e=xe!==void 0&&Re===xe-1;let st=y,Et='<circle cx="12" cy="9" r="3" fill="white"/>',Ut=_e.name,$t="white",tt=y,ut={width:32,height:40,viewBox:"0 0 24 30"};return Le?(st="#22c55e",Et=`
        <text x="12" y="13" text-anchor="middle" fill="white" font-size="10" font-weight="bold">A</text>
      `,$t="#22c55e",tt="white",Ut=` ${_e.name}`):$e?(st="#ef4444",Et=`
        <text x="12" y="13" text-anchor="middle" fill="white" font-size="10" font-weight="bold">B</text>
      `,$t="#ef4444",tt="white",Ut=` ${_e.name}`):Re!==void 0&&(Et=`
        <text x="12" y="13" text-anchor="middle" fill="white" font-size="9" font-weight="bold">${Re+1}</text>
      `),Ze.innerHTML=`
      <svg width="${ut.width}" height="${ut.height}" viewBox="${ut.viewBox}" style="filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" 
              fill="${st}" 
              stroke="white" 
              stroke-width="2"/>
        ${Et}
      </svg>
      <div style="
        margin-top: 2px;
        background: ${$t};
        border: 2px solid ${st};
        border-radius: 12px;
        padding: 2px 8px;
        font-size: 11px;
        font-weight: 700;
        color: ${tt};
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        font-family: system-ui, -apple-system, sans-serif;
      ">${Ut}</div>
    `,Ze};return Z.useEffect(()=>{if(!j.current||!ie||c.length===0)return;const _e=new Set(c.map(xe=>xe.id));Y.current.forEach((xe,Ze)=>{_e.has(Ze)||(xe.remove(),Y.current.delete(Ze))});const Re=c.length;c.forEach((xe,Ze)=>{const Le=Y.current.get(xe.id);if(Le){Le.setLngLat([xe.longitude,xe.latitude]);const $e=pe(xe,Ze,Re);Le.getElement().innerHTML=$e.innerHTML}else{const $e=pe(xe,Ze,Re),st=Ze===0,Et=Ze===Re-1,Ut=st?"Starting Point":Et?"Final Destination":`Stop #${Ze+1}`,$t=st?"#22c55e":Et?"#ef4444":y,tt=new Zu.Marker({element:$e,anchor:"bottom"}).setLngLat([xe.longitude,xe.latitude]).setPopup(new Zu.Popup({offset:25}).setHTML(`
              <div style="font-family: system-ui; padding: 12px; min-width: 150px;">
                <div style="
                  display: inline-block;
                  background: ${$t};
                  color: white;
                  padding: 2px 8px;
                  border-radius: 8px;
                  font-size: 10px;
                  font-weight: 600;
                  margin-bottom: 8px;
                ">${Ut}</div>
                <h3 style="font-weight: 700; color: ${$t}; margin: 0 0 4px 0; font-size: 14px;">
                  ${xe.name}
                </h3>
                ${xe.description?`<div style="font-size: 12px; color: #64748b;">${xe.description}</div>`:""}
              </div>
            `)).addTo(j.current);Y.current.set(xe.id,tt)}})},[c.map(_e=>_e.id).join(","),ie,y]),Z.useEffect(()=>{if(!j.current||!ie||!O||c.length===0)return;const _e=new Zu.LngLatBounds;c.forEach(Re=>{_e.extend([Re.longitude,Re.latitude])}),i.forEach(Re=>{Re.last_location&&_e.extend([Re.last_location.longitude,Re.last_location.latitude])}),j.current.fitBounds(_e,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:15,duration:1e3})},[c.map(_e=>_e.id).join(","),O,ie]),Z.useEffect(()=>!j.current||!ie||!d||c.length<2?void 0:((async()=>{try{const Re=j.current;if(!Re||!Re.getStyle())return;if(Re.getSource("route")){Re.getLayer("route")&&Re.setPaintProperty("route","line-color",y);return}const Ze=c.map(st=>[st.latitude,st.longitude]),$e=(await Y9.getRoute(Ze)).map(st=>[st[1],st[0]]);Re.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:$e}}}),Re.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":y,"line-width":5,"line-opacity":.8}})}catch(Re){console.error("Error drawing route:",Re)}})(),()=>{try{const Re=j.current;Re&&Re.getStyle()&&(Re.getLayer("route")&&Re.removeLayer("route"),Re.getSource("route")&&Re.removeSource("route"))}catch(Re){console.error("Error cleaning up route:",Re)}}),[c.map(_e=>_e.id).join(","),d,y,ie]),Z.useEffect(()=>{if(!j.current||!ie||i.length===0)return;const _e=i.map(xe=>({id:xe.id,registration_number:xe.registration_number,capacity:xe.capacity,status:xe.status,last_location:xe.last_location})),Re=new Set(_e.map(xe=>xe.id));return H.current.forEach((xe,Ze)=>{Re.has(Ze)||(xe.remove(),H.current.delete(Ze))}),_e.forEach(xe=>{if(!xe.last_location){const $t=H.current.get(xe.id);$t&&($t.remove(),H.current.delete(xe.id));return}const Ze=xe.last_location,Le=le(Ze.timestamp),$e=xe.status==="active"?"#059669":xe.status==="maintenance"?"#d97706":"#6b7280",st=H.current.get(xe.id);if(st){st.setLngLat([Ze.longitude,Ze.latitude]);const $t=ge(xe,Ze,xe.status);st.getElement().innerHTML=$t.innerHTML;return}const Et=ge(xe,Ze,xe.status),Ut=new Zu.Marker({element:Et,anchor:"center"}).setLngLat([Ze.longitude,Ze.latitude]).setPopup(new Zu.Popup({offset:25}).setHTML(`
            <div style="font-family: system-ui; padding: 12px; min-width: 220px;">
              <h3 style="font-weight: 700; color: #1e40af; margin: 0 0 12px 0; font-size: 16px;">
                ${xe.registration_number}
              </h3>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 13px;">
                <div>
                  <div style="color: #64748b; font-size: 11px; margin-bottom: 4px;">Speed</div>
                  <div style="font-weight: 600; color: #1e40af;">${Ze.speed!=null?Ze.speed+" km/h":"N/A"}</div>
                </div>
                <div>
                  <div style="color: #64748b; font-size: 11px; margin-bottom: 4px;">Heading</div>
                  <div style="font-weight: 600; color: #1e40af;">${Ze.heading!=null?Ze.heading+"":"N/A"}</div>
                </div>
                <div>
                  <div style="color: #64748b; font-size: 11px; margin-bottom: 4px;">Status</div>
                  <div style="font-weight: 600; color: ${$e}; text-transform: capitalize;">${xe.status}</div>
                </div>
                <div>
                  <div style="color: #64748b; font-size: 11px; margin-bottom: 4px;">Capacity</div>
                  <div style="font-weight: 600; color: #1e40af;">${xe.capacity}</div>
                </div>
              </div>
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                <div style="color: #64748b; font-size: 11px; margin-bottom: 4px;">Last Update</div>
                <div style="font-weight: 600; color: ${Le?"#d97706":"#059669"}; font-size: 12px;">
                  ${Le?" "+ee(Ze.timestamp):" Just now"}
                </div>
                <div style="color: #94a3b8; font-size: 10px; margin-top: 2px;">
                  ${new Date(Ze.timestamp).toLocaleString()}
                </div>
              </div>
            </div>
          `)).addTo(j.current);H.current.set(xe.id,Ut)}),()=>{}},[i,ie]),C.jsx("div",{ref:z,style:{width:"100%",height:w,borderRadius:"12px",overflow:"hidden"}})},Q9=()=>{const{t}=Lc(),{data:i,isLoading:c}=$o({queryKey:["dashboard-stats"],queryFn:()=>J$.getStats()}),{data:d,isLoading:y}=$o({queryKey:["buses"],queryFn:()=>Ku.getBuses()}),w=[{title:t("dashboard.totalBuses"),value:i?.total_buses||0,icon:fu,color:"text-teal-600 bg-teal-50"},{title:t("dashboard.activeBuses"),value:i?.active_buses||0,icon:R0,color:"text-green-600 bg-green-50"},{title:t("dashboard.totalRoutes"),value:i?.total_routes||0,icon:L_,color:"text-blue-600 bg-blue-50"},{title:t("dashboard.totalStops"),value:i?.total_stops||0,icon:Dl,color:"text-purple-600 bg-purple-50"},{title:t("dashboard.onlineDisplays"),value:i?.online_displays||0,icon:M_,color:"text-orange-600 bg-orange-50"},{title:t("dashboard.activeAnnouncements"),value:i?.active_announcements||0,icon:lx,color:"text-red-600 bg-red-50"}];return c?C.jsxs("div",{className:"space-y-6",children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("dashboard.title")}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((E,s)=>C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"})}),C.jsx(hi,{children:C.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded animate-pulse"})})]},s))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("dashboard.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:t("dashboard.overview")})]}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(E=>{const s=E.icon;return C.jsxs(li,{className:"hover:shadow-lg transition-shadow",children:[C.jsxs(zr,{className:"flex flex-row items-center justify-between pb-2",children:[C.jsx(ys,{className:"text-sm font-medium text-muted-foreground",children:E.title}),C.jsx("div",{className:`p-2 rounded-lg ${E.color}`,children:C.jsx(s,{className:"h-5 w-5"})})]}),C.jsx(hi,{children:C.jsx("div",{className:"text-3xl font-bold",children:E.value})})]},E.title)})}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsx(ys,{children:t("dashboard.liveMap")})}),C.jsx(hi,{children:y?C.jsx("div",{className:"h-96 bg-muted rounded-xl flex items-center justify-center",children:C.jsx("p",{className:"text-muted-foreground",children:t("common.loading")})}):C.jsx(nS,{initialViewState:{longitude:73.0479,latitude:33.6844,zoom:12},buses:d?.filter(E=>E.last_location)||[],height:"384px",interactive:!0,showControls:!0})})]})]})},_A=Z.createContext({});function yA(t){const i=Z.useRef(null);return i.current===null&&(i.current=t()),i.current}const xA=typeof window<"u",LN=xA?Z.useLayoutEffect:Z.useEffect,iS=Z.createContext(null);function vA(t,i){t.indexOf(i)===-1&&t.push(i)}function bA(t,i){const c=t.indexOf(i);c>-1&&t.splice(c,1)}const zp=(t,i,c)=>c>i?i:c<t?t:c;let wA=()=>{};const Lp={},NN=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function kN(t){return typeof t=="object"&&t!==null}const jN=t=>/^0[^.\s]+$/u.test(t);function SA(t){let i;return()=>(i===void 0&&(i=t()),i)}const Qu=t=>t,J9=(t,i)=>c=>i(t(c)),eb=(...t)=>t.reduce(J9),M0=(t,i,c)=>{const d=i-t;return d===0?1:(c-t)/d};class TA{constructor(){this.subscriptions=[]}add(i){return vA(this.subscriptions,i),()=>bA(this.subscriptions,i)}notify(i,c,d){const y=this.subscriptions.length;if(y)if(y===1)this.subscriptions[0](i,c,d);else for(let w=0;w<y;w++){const E=this.subscriptions[w];E&&E(i,c,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const bf=t=>t*1e3,Yu=t=>t/1e3;function FN(t,i){return i?t*(1e3/i):0}const BN=(t,i,c)=>(((1-3*c+3*i)*t+(3*c-6*i))*t+3*i)*t,e7=1e-7,t7=12;function n7(t,i,c,d,y){let w,E,s=0;do E=i+(c-i)/2,w=BN(E,d,y)-t,w>0?c=E:i=E;while(Math.abs(w)>e7&&++s<t7);return E}function tb(t,i,c,d){if(t===i&&c===d)return Qu;const y=w=>n7(w,0,1,t,c);return w=>w===0||w===1?w:BN(y(w),i,d)}const VN=t=>i=>i<=.5?t(2*i)/2:(2-t(2*(1-i)))/2,UN=t=>i=>1-t(1-i),$N=tb(.33,1.53,.69,.99),EA=UN($N),GN=VN(EA),HN=t=>(t*=2)<1?.5*EA(t):.5*(2-Math.pow(2,-10*(t-1))),AA=t=>1-Math.sin(Math.acos(t)),qN=UN(AA),ZN=VN(AA),i7=tb(.42,0,1,1),r7=tb(0,0,.58,1),WN=tb(.42,0,.58,1),s7=t=>Array.isArray(t)&&typeof t[0]!="number",XN=t=>Array.isArray(t)&&typeof t[0]=="number",o7={linear:Qu,easeIn:i7,easeInOut:WN,easeOut:r7,circIn:AA,circInOut:ZN,circOut:qN,backIn:EA,backInOut:GN,backOut:$N,anticipate:HN},a7=t=>typeof t=="string",VD=t=>{if(XN(t)){wA(t.length===4);const[i,c,d,y]=t;return tb(i,c,d,y)}else if(a7(t))return o7[t];return t},M1=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function l7(t,i){let c=new Set,d=new Set,y=!1,w=!1;const E=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1};function O(j){E.has(j)&&(z.schedule(j),t()),j(s)}const z={schedule:(j,H=!1,Y=!1)=>{const oe=Y&&y?c:d;return H&&E.add(j),oe.has(j)||oe.add(j),j},cancel:j=>{d.delete(j),E.delete(j)},process:j=>{if(s=j,y){w=!0;return}y=!0,[c,d]=[d,c],c.forEach(O),c.clear(),y=!1,w&&(w=!1,z.process(j))}};return z}const c7=40;function KN(t,i){let c=!1,d=!0;const y={delta:0,timestamp:0,isProcessing:!1},w=()=>c=!0,E=M1.reduce((_e,Re)=>(_e[Re]=l7(w),_e),{}),{setup:s,read:O,resolveKeyframes:z,preUpdate:j,update:H,preRender:Y,render:ie,postRender:oe}=E,ee=()=>{const _e=Lp.useManualTiming?y.timestamp:performance.now();c=!1,Lp.useManualTiming||(y.delta=d?1e3/60:Math.max(Math.min(_e-y.timestamp,c7),1)),y.timestamp=_e,y.isProcessing=!0,s.process(y),O.process(y),z.process(y),j.process(y),H.process(y),Y.process(y),ie.process(y),oe.process(y),y.isProcessing=!1,c&&i&&(d=!1,t(ee))},le=()=>{c=!0,d=!0,y.isProcessing||t(ee)};return{schedule:M1.reduce((_e,Re)=>{const xe=E[Re];return _e[Re]=(Ze,Le=!1,$e=!1)=>(c||le(),xe.schedule(Ze,Le,$e)),_e},{}),cancel:_e=>{for(let Re=0;Re<M1.length;Re++)E[M1[Re]].cancel(_e)},state:y,steps:E}}const{schedule:xo,cancel:ig,state:ll,steps:QT}=KN(typeof requestAnimationFrame<"u"?requestAnimationFrame:Qu,!0);let tw;function u7(){tw=void 0}const Pc={now:()=>(tw===void 0&&Pc.set(ll.isProcessing||Lp.useManualTiming?ll.timestamp:performance.now()),tw),set:t=>{tw=t,queueMicrotask(u7)}},YN=t=>i=>typeof i=="string"&&i.startsWith(t),CA=YN("--"),d7=YN("var(--"),RA=t=>d7(t)?h7.test(t.split("/*")[0].trim()):!1,h7=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Bx={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},I0={...Bx,transform:t=>zp(0,1,t)},I1={...Bx,default:1},p0=t=>Math.round(t*1e5)/1e5,MA=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function f7(t){return t==null}const p7=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,IA=(t,i)=>c=>!!(typeof c=="string"&&p7.test(c)&&c.startsWith(t)||i&&!f7(c)&&Object.prototype.hasOwnProperty.call(c,i)),QN=(t,i,c)=>d=>{if(typeof d!="string")return d;const[y,w,E,s]=d.match(MA);return{[t]:parseFloat(y),[i]:parseFloat(w),[c]:parseFloat(E),alpha:s!==void 0?parseFloat(s):1}},m7=t=>zp(0,255,t),JT={...Bx,transform:t=>Math.round(m7(t))},I_={test:IA("rgb","red"),parse:QN("red","green","blue"),transform:({red:t,green:i,blue:c,alpha:d=1})=>"rgba("+JT.transform(t)+", "+JT.transform(i)+", "+JT.transform(c)+", "+p0(I0.transform(d))+")"};function g7(t){let i="",c="",d="",y="";return t.length>5?(i=t.substring(1,3),c=t.substring(3,5),d=t.substring(5,7),y=t.substring(7,9)):(i=t.substring(1,2),c=t.substring(2,3),d=t.substring(3,4),y=t.substring(4,5),i+=i,c+=c,d+=d,y+=y),{red:parseInt(i,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:y?parseInt(y,16)/255:1}}const nE={test:IA("#"),parse:g7,transform:I_.transform},nb=t=>({test:i=>typeof i=="string"&&i.endsWith(t)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${t}`}),Qm=nb("deg"),wf=nb("%"),cr=nb("px"),_7=nb("vh"),y7=nb("vw"),UD={...wf,parse:t=>wf.parse(t)/100,transform:t=>wf.transform(t*100)},ux={test:IA("hsl","hue"),parse:QN("hue","saturation","lightness"),transform:({hue:t,saturation:i,lightness:c,alpha:d=1})=>"hsla("+Math.round(t)+", "+wf.transform(p0(i))+", "+wf.transform(p0(c))+", "+p0(I0.transform(d))+")"},fa={test:t=>I_.test(t)||nE.test(t)||ux.test(t),parse:t=>I_.test(t)?I_.parse(t):ux.test(t)?ux.parse(t):nE.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?I_.transform(t):ux.transform(t),getAnimatableNone:t=>{const i=fa.parse(t);return i.alpha=0,fa.transform(i)}},x7=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function v7(t){return isNaN(t)&&typeof t=="string"&&(t.match(MA)?.length||0)+(t.match(x7)?.length||0)>0}const JN="number",ek="color",b7="var",w7="var(",$D="${}",S7=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function D0(t){const i=t.toString(),c=[],d={color:[],number:[],var:[]},y=[];let w=0;const s=i.replace(S7,O=>(fa.test(O)?(d.color.push(w),y.push(ek),c.push(fa.parse(O))):O.startsWith(w7)?(d.var.push(w),y.push(b7),c.push(O)):(d.number.push(w),y.push(JN),c.push(parseFloat(O))),++w,$D)).split($D);return{values:c,split:s,indexes:d,types:y}}function tk(t){return D0(t).values}function nk(t){const{split:i,types:c}=D0(t),d=i.length;return y=>{let w="";for(let E=0;E<d;E++)if(w+=i[E],y[E]!==void 0){const s=c[E];s===JN?w+=p0(y[E]):s===ek?w+=fa.transform(y[E]):w+=y[E]}return w}}const T7=t=>typeof t=="number"?0:fa.test(t)?fa.getAnimatableNone(t):t;function E7(t){const i=tk(t);return nk(t)(i.map(T7))}const rg={test:v7,parse:tk,createTransformer:nk,getAnimatableNone:E7};function e2(t,i,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?t+(i-t)*6*c:c<1/2?i:c<2/3?t+(i-t)*(2/3-c)*6:t}function A7({hue:t,saturation:i,lightness:c,alpha:d}){t/=360,i/=100,c/=100;let y=0,w=0,E=0;if(!i)y=w=E=c;else{const s=c<.5?c*(1+i):c+i-c*i,O=2*c-s;y=e2(O,s,t+1/3),w=e2(O,s,t),E=e2(O,s,t-1/3)}return{red:Math.round(y*255),green:Math.round(w*255),blue:Math.round(E*255),alpha:d}}function bw(t,i){return c=>c>0?i:t}const Ro=(t,i,c)=>t+(i-t)*c,t2=(t,i,c)=>{const d=t*t,y=c*(i*i-d)+d;return y<0?0:Math.sqrt(y)},C7=[nE,I_,ux],R7=t=>C7.find(i=>i.test(t));function GD(t){const i=R7(t);if(!i)return!1;let c=i.parse(t);return i===ux&&(c=A7(c)),c}const HD=(t,i)=>{const c=GD(t),d=GD(i);if(!c||!d)return bw(t,i);const y={...c};return w=>(y.red=t2(c.red,d.red,w),y.green=t2(c.green,d.green,w),y.blue=t2(c.blue,d.blue,w),y.alpha=Ro(c.alpha,d.alpha,w),I_.transform(y))},iE=new Set(["none","hidden"]);function M7(t,i){return iE.has(t)?c=>c<=0?t:i:c=>c>=1?i:t}function I7(t,i){return c=>Ro(t,i,c)}function DA(t){return typeof t=="number"?I7:typeof t=="string"?RA(t)?bw:fa.test(t)?HD:O7:Array.isArray(t)?ik:typeof t=="object"?fa.test(t)?HD:D7:bw}function ik(t,i){const c=[...t],d=c.length,y=t.map((w,E)=>DA(w)(w,i[E]));return w=>{for(let E=0;E<d;E++)c[E]=y[E](w);return c}}function D7(t,i){const c={...t,...i},d={};for(const y in c)t[y]!==void 0&&i[y]!==void 0&&(d[y]=DA(t[y])(t[y],i[y]));return y=>{for(const w in d)c[w]=d[w](y);return c}}function P7(t,i){const c=[],d={color:0,var:0,number:0};for(let y=0;y<i.values.length;y++){const w=i.types[y],E=t.indexes[w][d[w]],s=t.values[E]??0;c[y]=s,d[w]++}return c}const O7=(t,i)=>{const c=rg.createTransformer(i),d=D0(t),y=D0(i);return d.indexes.var.length===y.indexes.var.length&&d.indexes.color.length===y.indexes.color.length&&d.indexes.number.length>=y.indexes.number.length?iE.has(t)&&!y.values.length||iE.has(i)&&!d.values.length?M7(t,i):eb(ik(P7(d,y),y.values),c):bw(t,i)};function rk(t,i,c){return typeof t=="number"&&typeof i=="number"&&typeof c=="number"?Ro(t,i,c):DA(t)(t,i)}const z7=t=>{const i=({timestamp:c})=>t(c);return{start:(c=!0)=>xo.update(i,c),stop:()=>ig(i),now:()=>ll.isProcessing?ll.timestamp:Pc.now()}},sk=(t,i,c=10)=>{let d="";const y=Math.max(Math.round(i/c),2);for(let w=0;w<y;w++)d+=Math.round(t(w/(y-1))*1e4)/1e4+", ";return`linear(${d.substring(0,d.length-2)})`},ww=2e4;function PA(t){let i=0;const c=50;let d=t.next(i);for(;!d.done&&i<ww;)i+=c,d=t.next(i);return i>=ww?1/0:i}function L7(t,i=100,c){const d=c({...t,keyframes:[0,i]}),y=Math.min(PA(d),ww);return{type:"keyframes",ease:w=>d.next(y*w).value/i,duration:Yu(y)}}const N7=5;function ok(t,i,c){const d=Math.max(i-N7,0);return FN(c-t(d),i-d)}const Uo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},n2=.001;function k7({duration:t=Uo.duration,bounce:i=Uo.bounce,velocity:c=Uo.velocity,mass:d=Uo.mass}){let y,w,E=1-i;E=zp(Uo.minDamping,Uo.maxDamping,E),t=zp(Uo.minDuration,Uo.maxDuration,Yu(t)),E<1?(y=z=>{const j=z*E,H=j*t,Y=j-c,ie=rE(z,E),oe=Math.exp(-H);return n2-Y/ie*oe},w=z=>{const H=z*E*t,Y=H*c+c,ie=Math.pow(E,2)*Math.pow(z,2)*t,oe=Math.exp(-H),ee=rE(Math.pow(z,2),E);return(-y(z)+n2>0?-1:1)*((Y-ie)*oe)/ee}):(y=z=>{const j=Math.exp(-z*t),H=(z-c)*t+1;return-n2+j*H},w=z=>{const j=Math.exp(-z*t),H=(c-z)*(t*t);return j*H});const s=5/t,O=F7(y,w,s);if(t=bf(t),isNaN(O))return{stiffness:Uo.stiffness,damping:Uo.damping,duration:t};{const z=Math.pow(O,2)*d;return{stiffness:z,damping:E*2*Math.sqrt(d*z),duration:t}}}const j7=12;function F7(t,i,c){let d=c;for(let y=1;y<j7;y++)d=d-t(d)/i(d);return d}function rE(t,i){return t*Math.sqrt(1-i*i)}const B7=["duration","bounce"],V7=["stiffness","damping","mass"];function qD(t,i){return i.some(c=>t[c]!==void 0)}function U7(t){let i={velocity:Uo.velocity,stiffness:Uo.stiffness,damping:Uo.damping,mass:Uo.mass,isResolvedFromDuration:!1,...t};if(!qD(t,V7)&&qD(t,B7))if(t.visualDuration){const c=t.visualDuration,d=2*Math.PI/(c*1.2),y=d*d,w=2*zp(.05,1,1-(t.bounce||0))*Math.sqrt(y);i={...i,mass:Uo.mass,stiffness:y,damping:w}}else{const c=k7(t);i={...i,...c,mass:Uo.mass},i.isResolvedFromDuration=!0}return i}function Sw(t=Uo.visualDuration,i=Uo.bounce){const c=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:i}:t;let{restSpeed:d,restDelta:y}=c;const w=c.keyframes[0],E=c.keyframes[c.keyframes.length-1],s={done:!1,value:w},{stiffness:O,damping:z,mass:j,duration:H,velocity:Y,isResolvedFromDuration:ie}=U7({...c,velocity:-Yu(c.velocity||0)}),oe=Y||0,ee=z/(2*Math.sqrt(O*j)),le=E-w,ge=Yu(Math.sqrt(O/j)),pe=Math.abs(le)<5;d||(d=pe?Uo.restSpeed.granular:Uo.restSpeed.default),y||(y=pe?Uo.restDelta.granular:Uo.restDelta.default);let _e;if(ee<1){const xe=rE(ge,ee);_e=Ze=>{const Le=Math.exp(-ee*ge*Ze);return E-Le*((oe+ee*ge*le)/xe*Math.sin(xe*Ze)+le*Math.cos(xe*Ze))}}else if(ee===1)_e=xe=>E-Math.exp(-ge*xe)*(le+(oe+ge*le)*xe);else{const xe=ge*Math.sqrt(ee*ee-1);_e=Ze=>{const Le=Math.exp(-ee*ge*Ze),$e=Math.min(xe*Ze,300);return E-Le*((oe+ee*ge*le)*Math.sinh($e)+xe*le*Math.cosh($e))/xe}}const Re={calculatedDuration:ie&&H||null,next:xe=>{const Ze=_e(xe);if(ie)s.done=xe>=H;else{let Le=xe===0?oe:0;ee<1&&(Le=xe===0?bf(oe):ok(_e,xe,Ze));const $e=Math.abs(Le)<=d,st=Math.abs(E-Ze)<=y;s.done=$e&&st}return s.value=s.done?E:Ze,s},toString:()=>{const xe=Math.min(PA(Re),ww),Ze=sk(Le=>Re.next(xe*Le).value,xe,30);return xe+"ms "+Ze},toTransition:()=>{}};return Re}Sw.applyToOptions=t=>{const i=L7(t,100,Sw);return t.ease=i.ease,t.duration=bf(i.duration),t.type="keyframes",t};function sE({keyframes:t,velocity:i=0,power:c=.8,timeConstant:d=325,bounceDamping:y=10,bounceStiffness:w=500,modifyTarget:E,min:s,max:O,restDelta:z=.5,restSpeed:j}){const H=t[0],Y={done:!1,value:H},ie=$e=>s!==void 0&&$e<s||O!==void 0&&$e>O,oe=$e=>s===void 0?O:O===void 0||Math.abs(s-$e)<Math.abs(O-$e)?s:O;let ee=c*i;const le=H+ee,ge=E===void 0?le:E(le);ge!==le&&(ee=ge-H);const pe=$e=>-ee*Math.exp(-$e/d),_e=$e=>ge+pe($e),Re=$e=>{const st=pe($e),Et=_e($e);Y.done=Math.abs(st)<=z,Y.value=Y.done?ge:Et};let xe,Ze;const Le=$e=>{ie(Y.value)&&(xe=$e,Ze=Sw({keyframes:[Y.value,oe(Y.value)],velocity:ok(_e,$e,Y.value),damping:y,stiffness:w,restDelta:z,restSpeed:j}))};return Le(0),{calculatedDuration:null,next:$e=>{let st=!1;return!Ze&&xe===void 0&&(st=!0,Re($e),Le($e)),xe!==void 0&&$e>=xe?Ze.next($e-xe):(!st&&Re($e),Y)}}}function $7(t,i,c){const d=[],y=c||Lp.mix||rk,w=t.length-1;for(let E=0;E<w;E++){let s=y(t[E],t[E+1]);if(i){const O=Array.isArray(i)?i[E]||Qu:i;s=eb(O,s)}d.push(s)}return d}function G7(t,i,{clamp:c=!0,ease:d,mixer:y}={}){const w=t.length;if(wA(w===i.length),w===1)return()=>i[0];if(w===2&&i[0]===i[1])return()=>i[1];const E=t[0]===t[1];t[0]>t[w-1]&&(t=[...t].reverse(),i=[...i].reverse());const s=$7(i,d,y),O=s.length,z=j=>{if(E&&j<t[0])return i[0];let H=0;if(O>1)for(;H<t.length-2&&!(j<t[H+1]);H++);const Y=M0(t[H],t[H+1],j);return s[H](Y)};return c?j=>z(zp(t[0],t[w-1],j)):z}function H7(t,i){const c=t[t.length-1];for(let d=1;d<=i;d++){const y=M0(0,i,d);t.push(Ro(c,1,y))}}function q7(t){const i=[0];return H7(i,t.length-1),i}function Z7(t,i){return t.map(c=>c*i)}function W7(t,i){return t.map(()=>i||WN).splice(0,t.length-1)}function m0({duration:t=300,keyframes:i,times:c,ease:d="easeInOut"}){const y=s7(d)?d.map(VD):VD(d),w={done:!1,value:i[0]},E=Z7(c&&c.length===i.length?c:q7(i),t),s=G7(E,i,{ease:Array.isArray(y)?y:W7(i,y)});return{calculatedDuration:t,next:O=>(w.value=s(O),w.done=O>=t,w)}}const X7=t=>t!==null;function OA(t,{repeat:i,repeatType:c="loop"},d,y=1){const w=t.filter(X7),s=y<0||i&&c!=="loop"&&i%2===1?0:w.length-1;return!s||d===void 0?w[s]:d}const K7={decay:sE,inertia:sE,tween:m0,keyframes:m0,spring:Sw};function ak(t){typeof t.type=="string"&&(t.type=K7[t.type])}class zA{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,c){return this.finished.then(i,c)}}const Y7=t=>t/100;class LA extends zA{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:c}=this.options;c&&c.updatedAt!==Pc.now()&&this.tick(Pc.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;ak(i);const{type:c=m0,repeat:d=0,repeatDelay:y=0,repeatType:w,velocity:E=0}=i;let{keyframes:s}=i;const O=c||m0;O!==m0&&typeof s[0]!="number"&&(this.mixKeyframes=eb(Y7,rk(s[0],s[1])),s=[0,100]);const z=O({...i,keyframes:s});w==="mirror"&&(this.mirroredGenerator=O({...i,keyframes:[...s].reverse(),velocity:-E})),z.calculatedDuration===null&&(z.calculatedDuration=PA(z));const{calculatedDuration:j}=z;this.calculatedDuration=j,this.resolvedDuration=j+y,this.totalDuration=this.resolvedDuration*(d+1)-y,this.generator=z}updateTime(i){const c=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=c}tick(i,c=!1){const{generator:d,totalDuration:y,mixKeyframes:w,mirroredGenerator:E,resolvedDuration:s,calculatedDuration:O}=this;if(this.startTime===null)return d.next(0);const{delay:z=0,keyframes:j,repeat:H,repeatType:Y,repeatDelay:ie,type:oe,onUpdate:ee,finalKeyframe:le}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-y/this.speed,this.startTime)),c?this.currentTime=i:this.updateTime(i);const ge=this.currentTime-z*(this.playbackSpeed>=0?1:-1),pe=this.playbackSpeed>=0?ge<0:ge>y;this.currentTime=Math.max(ge,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=y);let _e=this.currentTime,Re=d;if(H){const $e=Math.min(this.currentTime,y)/s;let st=Math.floor($e),Et=$e%1;!Et&&$e>=1&&(Et=1),Et===1&&st--,st=Math.min(st,H+1),!!(st%2)&&(Y==="reverse"?(Et=1-Et,ie&&(Et-=ie/s)):Y==="mirror"&&(Re=E)),_e=zp(0,1,Et)*s}const xe=pe?{done:!1,value:j[0]}:Re.next(_e);w&&(xe.value=w(xe.value));let{done:Ze}=xe;!pe&&O!==null&&(Ze=this.playbackSpeed>=0?this.currentTime>=y:this.currentTime<=0);const Le=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ze);return Le&&oe!==sE&&(xe.value=OA(j,this.options,le,this.speed)),ee&&ee(xe.value),Le&&this.finish(),xe}then(i,c){return this.finished.then(i,c)}get duration(){return Yu(this.calculatedDuration)}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+Yu(i)}get time(){return Yu(this.currentTime)}set time(i){i=bf(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(Pc.now());const c=this.playbackSpeed!==i;this.playbackSpeed=i,c&&(this.time=Yu(this.currentTime))}play(){if(this.isStopped)return;const{driver:i=z7,startTime:c}=this.options;this.driver||(this.driver=i(y=>this.tick(y))),this.options.onPlay?.();const d=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=d):this.holdTime!==null?this.startTime=d-this.holdTime:this.startTime||(this.startTime=c??d),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Pc.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),i.observe(this)}}function Q7(t){for(let i=1;i<t.length;i++)t[i]??(t[i]=t[i-1])}const D_=t=>t*180/Math.PI,oE=t=>{const i=D_(Math.atan2(t[1],t[0]));return aE(i)},J7={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:oE,rotateZ:oE,skewX:t=>D_(Math.atan(t[1])),skewY:t=>D_(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},aE=t=>(t=t%360,t<0&&(t+=360),t),ZD=oE,WD=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),XD=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),eZ={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:WD,scaleY:XD,scale:t=>(WD(t)+XD(t))/2,rotateX:t=>aE(D_(Math.atan2(t[6],t[5]))),rotateY:t=>aE(D_(Math.atan2(-t[2],t[0]))),rotateZ:ZD,rotate:ZD,skewX:t=>D_(Math.atan(t[4])),skewY:t=>D_(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function lE(t){return t.includes("scale")?1:0}function cE(t,i){if(!t||t==="none")return lE(i);const c=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let d,y;if(c)d=eZ,y=c;else{const s=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);d=J7,y=s}if(!y)return lE(i);const w=d[i],E=y[1].split(",").map(nZ);return typeof w=="function"?w(E):E[w]}const tZ=(t,i)=>{const{transform:c="none"}=getComputedStyle(t);return cE(c,i)};function nZ(t){return parseFloat(t.trim())}const Vx=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ux=new Set(Vx),KD=t=>t===Bx||t===cr,iZ=new Set(["x","y","z"]),rZ=Vx.filter(t=>!iZ.has(t));function sZ(t){const i=[];return rZ.forEach(c=>{const d=t.getValue(c);d!==void 0&&(i.push([c,d.get()]),d.set(c.startsWith("scale")?1:0))}),i}const N_={width:({x:t},{paddingLeft:i="0",paddingRight:c="0"})=>t.max-t.min-parseFloat(i)-parseFloat(c),height:({y:t},{paddingTop:i="0",paddingBottom:c="0"})=>t.max-t.min-parseFloat(i)-parseFloat(c),top:(t,{top:i})=>parseFloat(i),left:(t,{left:i})=>parseFloat(i),bottom:({y:t},{top:i})=>parseFloat(i)+(t.max-t.min),right:({x:t},{left:i})=>parseFloat(i)+(t.max-t.min),x:(t,{transform:i})=>cE(i,"x"),y:(t,{transform:i})=>cE(i,"y")};N_.translateX=N_.x;N_.translateY=N_.y;const k_=new Set;let uE=!1,dE=!1,hE=!1;function lk(){if(dE){const t=Array.from(k_).filter(d=>d.needsMeasurement),i=new Set(t.map(d=>d.element)),c=new Map;i.forEach(d=>{const y=sZ(d);y.length&&(c.set(d,y),d.render())}),t.forEach(d=>d.measureInitialState()),i.forEach(d=>{d.render();const y=c.get(d);y&&y.forEach(([w,E])=>{d.getValue(w)?.set(E)})}),t.forEach(d=>d.measureEndState()),t.forEach(d=>{d.suspendedScrollY!==void 0&&window.scrollTo(0,d.suspendedScrollY)})}dE=!1,uE=!1,k_.forEach(t=>t.complete(hE)),k_.clear()}function ck(){k_.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(dE=!0)})}function oZ(){hE=!0,ck(),lk(),hE=!1}class NA{constructor(i,c,d,y,w,E=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=c,this.name=d,this.motionValue=y,this.element=w,this.isAsync=E}scheduleResolve(){this.state="scheduled",this.isAsync?(k_.add(this),uE||(uE=!0,xo.read(ck),xo.resolveKeyframes(lk))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:c,element:d,motionValue:y}=this;if(i[0]===null){const w=y?.get(),E=i[i.length-1];if(w!==void 0)i[0]=w;else if(d&&c){const s=d.readValue(c,E);s!=null&&(i[0]=s)}i[0]===void 0&&(i[0]=E),y&&w===void 0&&y.set(i[0])}Q7(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),k_.delete(this)}cancel(){this.state==="scheduled"&&(k_.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const aZ=t=>t.startsWith("--");function lZ(t,i,c){aZ(i)?t.style.setProperty(i,c):t.style[i]=c}const cZ=SA(()=>window.ScrollTimeline!==void 0),uZ={};function dZ(t,i){const c=SA(t);return()=>uZ[i]??c()}const uk=dZ(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),c0=([t,i,c,d])=>`cubic-bezier(${t}, ${i}, ${c}, ${d})`,YD={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:c0([0,.65,.55,1]),circOut:c0([.55,0,1,.45]),backIn:c0([.31,.01,.66,-.59]),backOut:c0([.33,1.53,.69,.99])};function dk(t,i){if(t)return typeof t=="function"?uk()?sk(t,i):"ease-out":XN(t)?c0(t):Array.isArray(t)?t.map(c=>dk(c,i)||YD.easeOut):YD[t]}function hZ(t,i,c,{delay:d=0,duration:y=300,repeat:w=0,repeatType:E="loop",ease:s="easeOut",times:O}={},z=void 0){const j={[i]:c};O&&(j.offset=O);const H=dk(s,y);Array.isArray(H)&&(j.easing=H);const Y={delay:d,duration:y,easing:Array.isArray(H)?"linear":H,fill:"both",iterations:w+1,direction:E==="reverse"?"alternate":"normal"};return z&&(Y.pseudoElement=z),t.animate(j,Y)}function hk(t){return typeof t=="function"&&"applyToOptions"in t}function fZ({type:t,...i}){return hk(t)&&uk()?t.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class pZ extends zA{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:c,name:d,keyframes:y,pseudoElement:w,allowFlatten:E=!1,finalKeyframe:s,onComplete:O}=i;this.isPseudoElement=!!w,this.allowFlatten=E,this.options=i,wA(typeof i.type!="string");const z=fZ(i);this.animation=hZ(c,d,y,z,w),z.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!w){const j=OA(y,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(j):lZ(c,d,j),this.animation.cancel()}O?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const i=this.animation.effect?.getComputedTiming?.().duration||0;return Yu(Number(i))}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+Yu(i)}get time(){return Yu(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=bf(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:c}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,i&&cZ()?(this.animation.timeline=i,Qu):c(this)}}const fk={anticipate:HN,backInOut:GN,circInOut:ZN};function mZ(t){return t in fk}function gZ(t){typeof t.ease=="string"&&mZ(t.ease)&&(t.ease=fk[t.ease])}const QD=10;class _Z extends pZ{constructor(i){gZ(i),ak(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:c,onUpdate:d,onComplete:y,element:w,...E}=this.options;if(!c)return;if(i!==void 0){c.set(i);return}const s=new LA({...E,autoplay:!1}),O=bf(this.finishedTime??this.time);c.setWithVelocity(s.sample(O-QD).value,s.sample(O).value,QD),s.stop()}}const JD=(t,i)=>i==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(rg.test(t)||t==="0")&&!t.startsWith("url("));function yZ(t){const i=t[0];if(t.length===1)return!0;for(let c=0;c<t.length;c++)if(t[c]!==i)return!0}function xZ(t,i,c,d){const y=t[0];if(y===null)return!1;if(i==="display"||i==="visibility")return!0;const w=t[t.length-1],E=JD(y,i),s=JD(w,i);return!E||!s?!1:yZ(t)||(c==="spring"||hk(c))&&d}function fE(t){t.duration=0,t.type="keyframes"}const vZ=new Set(["opacity","clipPath","filter","transform"]),bZ=SA(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function wZ(t){const{motionValue:i,name:c,repeatDelay:d,repeatType:y,damping:w,type:E}=t;if(!(i?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:O,transformTemplate:z}=i.owner.getProps();return bZ()&&c&&vZ.has(c)&&(c!=="transform"||!z)&&!O&&!d&&y!=="mirror"&&w!==0&&E!=="inertia"}const SZ=40;class TZ extends zA{constructor({autoplay:i=!0,delay:c=0,type:d="keyframes",repeat:y=0,repeatDelay:w=0,repeatType:E="loop",keyframes:s,name:O,motionValue:z,element:j,...H}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Pc.now();const Y={autoplay:i,delay:c,type:d,repeat:y,repeatDelay:w,repeatType:E,name:O,motionValue:z,element:j,...H},ie=j?.KeyframeResolver||NA;this.keyframeResolver=new ie(s,(oe,ee,le)=>this.onKeyframesResolved(oe,ee,Y,!le),O,z,j),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(i,c,d,y){this.keyframeResolver=void 0;const{name:w,type:E,velocity:s,delay:O,isHandoff:z,onUpdate:j}=d;this.resolvedAt=Pc.now(),xZ(i,w,E,s)||((Lp.instantAnimations||!O)&&j?.(OA(i,d,c)),i[0]=i[i.length-1],fE(d),d.repeat=0);const Y={startTime:y?this.resolvedAt?this.resolvedAt-this.createdAt>SZ?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:c,...d,keyframes:i},ie=!z&&wZ(Y)?new _Z({...Y,element:Y.motionValue.owner.current}):new LA(Y);ie.finished.then(()=>this.notifyFinished()).catch(Qu),this.pendingTimeline&&(this.stopTimeline=ie.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=ie}get finished(){return this._animation?this.animation.finished:this._finished}then(i,c){return this.finished.finally(i).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),oZ()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const EZ=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function AZ(t){const i=EZ.exec(t);if(!i)return[,];const[,c,d,y]=i;return[`--${c??d}`,y]}function pk(t,i,c=1){const[d,y]=AZ(t);if(!d)return;const w=window.getComputedStyle(i).getPropertyValue(d);if(w){const E=w.trim();return NN(E)?parseFloat(E):E}return RA(y)?pk(y,i,c+1):y}function kA(t,i){return t?.[i]??t?.default??t}const mk=new Set(["width","height","top","left","right","bottom",...Vx]),CZ={test:t=>t==="auto",parse:t=>t},gk=t=>i=>i.test(t),_k=[Bx,cr,wf,Qm,y7,_7,CZ],eP=t=>_k.find(gk(t));function RZ(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||jN(t):!0}const MZ=new Set(["brightness","contrast","saturate","opacity"]);function IZ(t){const[i,c]=t.slice(0,-1).split("(");if(i==="drop-shadow")return t;const[d]=c.match(MA)||[];if(!d)return t;const y=c.replace(d,"");let w=MZ.has(i)?1:0;return d!==c&&(w*=100),i+"("+w+y+")"}const DZ=/\b([a-z-]*)\(.*?\)/gu,pE={...rg,getAnimatableNone:t=>{const i=t.match(DZ);return i?i.map(IZ).join(" "):t}},tP={...Bx,transform:Math.round},PZ={rotate:Qm,rotateX:Qm,rotateY:Qm,rotateZ:Qm,scale:I1,scaleX:I1,scaleY:I1,scaleZ:I1,skew:Qm,skewX:Qm,skewY:Qm,distance:cr,translateX:cr,translateY:cr,translateZ:cr,x:cr,y:cr,z:cr,perspective:cr,transformPerspective:cr,opacity:I0,originX:UD,originY:UD,originZ:cr},jA={borderWidth:cr,borderTopWidth:cr,borderRightWidth:cr,borderBottomWidth:cr,borderLeftWidth:cr,borderRadius:cr,radius:cr,borderTopLeftRadius:cr,borderTopRightRadius:cr,borderBottomRightRadius:cr,borderBottomLeftRadius:cr,width:cr,maxWidth:cr,height:cr,maxHeight:cr,top:cr,right:cr,bottom:cr,left:cr,padding:cr,paddingTop:cr,paddingRight:cr,paddingBottom:cr,paddingLeft:cr,margin:cr,marginTop:cr,marginRight:cr,marginBottom:cr,marginLeft:cr,backgroundPositionX:cr,backgroundPositionY:cr,...PZ,zIndex:tP,fillOpacity:I0,strokeOpacity:I0,numOctaves:tP},OZ={...jA,color:fa,backgroundColor:fa,outlineColor:fa,fill:fa,stroke:fa,borderColor:fa,borderTopColor:fa,borderRightColor:fa,borderBottomColor:fa,borderLeftColor:fa,filter:pE,WebkitFilter:pE},yk=t=>OZ[t];function xk(t,i){let c=yk(t);return c!==pE&&(c=rg),c.getAnimatableNone?c.getAnimatableNone(i):void 0}const zZ=new Set(["auto","none","0"]);function LZ(t,i,c){let d=0,y;for(;d<t.length&&!y;){const w=t[d];typeof w=="string"&&!zZ.has(w)&&D0(w).values.length&&(y=t[d]),d++}if(y&&c)for(const w of i)t[w]=xk(c,y)}class NZ extends NA{constructor(i,c,d,y,w){super(i,c,d,y,w,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:c,name:d}=this;if(!c||!c.current)return;super.readKeyframes();for(let O=0;O<i.length;O++){let z=i[O];if(typeof z=="string"&&(z=z.trim(),RA(z))){const j=pk(z,c.current);j!==void 0&&(i[O]=j),O===i.length-1&&(this.finalKeyframe=z)}}if(this.resolveNoneKeyframes(),!mk.has(d)||i.length!==2)return;const[y,w]=i,E=eP(y),s=eP(w);if(E!==s)if(KD(E)&&KD(s))for(let O=0;O<i.length;O++){const z=i[O];typeof z=="string"&&(i[O]=parseFloat(z))}else N_[d]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:c}=this,d=[];for(let y=0;y<i.length;y++)(i[y]===null||RZ(i[y]))&&d.push(y);d.length&&LZ(i,d,c)}measureInitialState(){const{element:i,unresolvedKeyframes:c,name:d}=this;if(!i||!i.current)return;d==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=N_[d](i.measureViewportBox(),window.getComputedStyle(i.current)),c[0]=this.measuredOrigin;const y=c[c.length-1];y!==void 0&&i.getValue(d,y).jump(y,!1)}measureEndState(){const{element:i,name:c,unresolvedKeyframes:d}=this;if(!i||!i.current)return;const y=i.getValue(c);y&&y.jump(this.measuredOrigin,!1);const w=d.length-1,E=d[w];d[w]=N_[c](i.measureViewportBox(),window.getComputedStyle(i.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),this.removedTransforms?.length&&this.removedTransforms.forEach(([s,O])=>{i.getValue(s).set(O)}),this.resolveNoneKeyframes()}}function kZ(t,i,c){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let d=document;const y=c?.[t]??d.querySelectorAll(t);return y?Array.from(y):[]}return Array.from(t)}const vk=(t,i)=>i&&typeof t=="number"?i.transform(t):t;function bk(t){return kN(t)&&"offsetHeight"in t}const nP=30,jZ=t=>!isNaN(parseFloat(t));class FZ{constructor(i,c={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=d=>{const y=Pc.now();if(this.updatedAt!==y&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(d),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const w of this.dependents)w.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=c.owner}setCurrent(i){this.current=i,this.updatedAt=Pc.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=jZ(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,c){this.events[i]||(this.events[i]=new TA);const d=this.events[i].add(c);return i==="change"?()=>{d(),xo.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,c){this.passiveEffect=i,this.stopPassiveEffect=c}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,c,d){this.set(c),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-d}jump(i,c=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,c&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=Pc.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>nP)return 0;const c=Math.min(this.updatedAt-this.prevUpdatedAt,nP);return FN(parseFloat(this.current)-parseFloat(this.prevFrameValue),c)}start(i){return this.stop(),new Promise(c=>{this.hasAnimated=!0,this.animation=i(c),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Tx(t,i){return new FZ(t,i)}const{schedule:FA}=KN(queueMicrotask,!1),ih={x:!1,y:!1};function wk(){return ih.x||ih.y}function BZ(t){return t==="x"||t==="y"?ih[t]?null:(ih[t]=!0,()=>{ih[t]=!1}):ih.x||ih.y?null:(ih.x=ih.y=!0,()=>{ih.x=ih.y=!1})}function Sk(t,i){const c=kZ(t),d=new AbortController,y={passive:!0,...i,signal:d.signal};return[c,y,()=>d.abort()]}function iP(t){return!(t.pointerType==="touch"||wk())}function VZ(t,i,c={}){const[d,y,w]=Sk(t,c),E=s=>{if(!iP(s))return;const{target:O}=s,z=i(O,s);if(typeof z!="function"||!O)return;const j=H=>{iP(H)&&(z(H),O.removeEventListener("pointerleave",j))};O.addEventListener("pointerleave",j,y)};return d.forEach(s=>{s.addEventListener("pointerenter",E,y)}),w}const Tk=(t,i)=>i?t===i?!0:Tk(t,i.parentElement):!1,BA=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,UZ=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function $Z(t){return UZ.has(t.tagName)||t.tabIndex!==-1}const nw=new WeakSet;function rP(t){return i=>{i.key==="Enter"&&t(i)}}function i2(t,i){t.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const GZ=(t,i)=>{const c=t.currentTarget;if(!c)return;const d=rP(()=>{if(nw.has(c))return;i2(c,"down");const y=rP(()=>{i2(c,"up")}),w=()=>i2(c,"cancel");c.addEventListener("keyup",y,i),c.addEventListener("blur",w,i)});c.addEventListener("keydown",d,i),c.addEventListener("blur",()=>c.removeEventListener("keydown",d),i)};function sP(t){return BA(t)&&!wk()}function HZ(t,i,c={}){const[d,y,w]=Sk(t,c),E=s=>{const O=s.currentTarget;if(!sP(s))return;nw.add(O);const z=i(O,s),j=(ie,oe)=>{window.removeEventListener("pointerup",H),window.removeEventListener("pointercancel",Y),nw.has(O)&&nw.delete(O),sP(ie)&&typeof z=="function"&&z(ie,{success:oe})},H=ie=>{j(ie,O===window||O===document||c.useGlobalTarget||Tk(O,ie.target))},Y=ie=>{j(ie,!1)};window.addEventListener("pointerup",H,y),window.addEventListener("pointercancel",Y,y)};return d.forEach(s=>{(c.useGlobalTarget?window:s).addEventListener("pointerdown",E,y),bk(s)&&(s.addEventListener("focus",z=>GZ(z,y)),!$Z(s)&&!s.hasAttribute("tabindex")&&(s.tabIndex=0))}),w}function Ek(t){return kN(t)&&"ownerSVGElement"in t}function qZ(t){return Ek(t)&&t.tagName==="svg"}const Pl=t=>!!(t&&t.getVelocity),ZZ=[..._k,fa,rg],WZ=t=>ZZ.find(gk(t)),VA=Z.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function oP(t,i){if(typeof t=="function")return t(i);t!=null&&(t.current=i)}function XZ(...t){return i=>{let c=!1;const d=t.map(y=>{const w=oP(y,i);return!c&&typeof w=="function"&&(c=!0),w});if(c)return()=>{for(let y=0;y<d.length;y++){const w=d[y];typeof w=="function"?w():oP(t[y],null)}}}}function KZ(...t){return Z.useCallback(XZ(...t),t)}class YZ extends Z.Component{getSnapshotBeforeUpdate(i){const c=this.props.childRef.current;if(c&&i.isPresent&&!this.props.isPresent){const d=c.offsetParent,y=bk(d)&&d.offsetWidth||0,w=this.props.sizeRef.current;w.height=c.offsetHeight||0,w.width=c.offsetWidth||0,w.top=c.offsetTop,w.left=c.offsetLeft,w.right=y-w.width-w.left}return null}componentDidUpdate(){}render(){return this.props.children}}function QZ({children:t,isPresent:i,anchorX:c,root:d}){const y=Z.useId(),w=Z.useRef(null),E=Z.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:s}=Z.useContext(VA),O=KZ(w,t?.ref);return Z.useInsertionEffect(()=>{const{width:z,height:j,top:H,left:Y,right:ie}=E.current;if(i||!w.current||!z||!j)return;const oe=c==="left"?`left: ${Y}`:`right: ${ie}`;w.current.dataset.motionPopId=y;const ee=document.createElement("style");s&&(ee.nonce=s);const le=d??document.head;return le.appendChild(ee),ee.sheet&&ee.sheet.insertRule(`
          [data-motion-pop-id="${y}"] {
            position: absolute !important;
            width: ${z}px !important;
            height: ${j}px !important;
            ${oe}px !important;
            top: ${H}px !important;
          }
        `),()=>{le.contains(ee)&&le.removeChild(ee)}},[i]),C.jsx(YZ,{isPresent:i,childRef:w,sizeRef:E,children:Z.cloneElement(t,{ref:O})})}const JZ=({children:t,initial:i,isPresent:c,onExitComplete:d,custom:y,presenceAffectsLayout:w,mode:E,anchorX:s,root:O})=>{const z=yA(eW),j=Z.useId();let H=!0,Y=Z.useMemo(()=>(H=!1,{id:j,initial:i,isPresent:c,custom:y,onExitComplete:ie=>{z.set(ie,!0);for(const oe of z.values())if(!oe)return;d&&d()},register:ie=>(z.set(ie,!1),()=>z.delete(ie))}),[c,z,d]);return w&&H&&(Y={...Y}),Z.useMemo(()=>{z.forEach((ie,oe)=>z.set(oe,!1))},[c]),Z.useEffect(()=>{!c&&!z.size&&d&&d()},[c]),E==="popLayout"&&(t=C.jsx(QZ,{isPresent:c,anchorX:s,root:O,children:t})),C.jsx(iS.Provider,{value:Y,children:t})};function eW(){return new Map}function Ak(t=!0){const i=Z.useContext(iS);if(i===null)return[!0,null];const{isPresent:c,onExitComplete:d,register:y}=i,w=Z.useId();Z.useEffect(()=>{if(t)return y(w)},[t]);const E=Z.useCallback(()=>t&&d&&d(w),[w,d,t]);return!c&&d?[!1,E]:[!0]}const D1=t=>t.key||"";function aP(t){const i=[];return Z.Children.forEach(t,c=>{Z.isValidElement(c)&&i.push(c)}),i}const Ck=({children:t,custom:i,initial:c=!0,onExitComplete:d,presenceAffectsLayout:y=!0,mode:w="sync",propagate:E=!1,anchorX:s="left",root:O})=>{const[z,j]=Ak(E),H=Z.useMemo(()=>aP(t),[t]),Y=E&&!z?[]:H.map(D1),ie=Z.useRef(!0),oe=Z.useRef(H),ee=yA(()=>new Map),[le,ge]=Z.useState(H),[pe,_e]=Z.useState(H);LN(()=>{ie.current=!1,oe.current=H;for(let Ze=0;Ze<pe.length;Ze++){const Le=D1(pe[Ze]);Y.includes(Le)?ee.delete(Le):ee.get(Le)!==!0&&ee.set(Le,!1)}},[pe,Y.length,Y.join("-")]);const Re=[];if(H!==le){let Ze=[...H];for(let Le=0;Le<pe.length;Le++){const $e=pe[Le],st=D1($e);Y.includes(st)||(Ze.splice(Le,0,$e),Re.push($e))}return w==="wait"&&Re.length&&(Ze=Re),_e(aP(Ze)),ge(H),null}const{forceRender:xe}=Z.useContext(_A);return C.jsx(C.Fragment,{children:pe.map(Ze=>{const Le=D1(Ze),$e=E&&!z?!1:H===pe||Y.includes(Le),st=()=>{if(ee.has(Le))ee.set(Le,!0);else return;let Et=!0;ee.forEach(Ut=>{Ut||(Et=!1)}),Et&&(xe?.(),_e(oe.current),E&&j?.(),d&&d())};return C.jsx(JZ,{isPresent:$e,initial:!ie.current||c?void 0:!1,custom:i,presenceAffectsLayout:y,mode:w,root:O,onExitComplete:$e?void 0:st,anchorX:s,children:Ze},Le)})})},Rk=Z.createContext({strict:!1}),lP={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ex={};for(const t in lP)Ex[t]={isEnabled:i=>lP[t].some(c=>!!i[c])};function tW(t){for(const i in t)Ex[i]={...Ex[i],...t[i]}}const nW=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Tw(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||nW.has(t)}let Mk=t=>!Tw(t);function iW(t){typeof t=="function"&&(Mk=i=>i.startsWith("on")?!Tw(i):t(i))}try{iW(require("@emotion/is-prop-valid").default)}catch{}function rW(t,i,c){const d={};for(const y in t)y==="values"&&typeof t.values=="object"||(Mk(y)||c===!0&&Tw(y)||!i&&!Tw(y)||t.draggable&&y.startsWith("onDrag"))&&(d[y]=t[y]);return d}const rS=Z.createContext({});function sS(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function P0(t){return typeof t=="string"||Array.isArray(t)}const UA=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],$A=["initial",...UA];function oS(t){return sS(t.animate)||$A.some(i=>P0(t[i]))}function Ik(t){return!!(oS(t)||t.variants)}function sW(t,i){if(oS(t)){const{initial:c,animate:d}=t;return{initial:c===!1||P0(c)?c:void 0,animate:P0(d)?d:void 0}}return t.inherit!==!1?i:{}}function oW(t){const{initial:i,animate:c}=sW(t,Z.useContext(rS));return Z.useMemo(()=>({initial:i,animate:c}),[cP(i),cP(c)])}function cP(t){return Array.isArray(t)?t.join(" "):t}const O0={};function aW(t){for(const i in t)O0[i]=t[i],CA(i)&&(O0[i].isCSSVariable=!0)}function Dk(t,{layout:i,layoutId:c}){return Ux.has(t)||t.startsWith("origin")||(i||c!==void 0)&&(!!O0[t]||t==="opacity")}const lW={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},cW=Vx.length;function uW(t,i,c){let d="",y=!0;for(let w=0;w<cW;w++){const E=Vx[w],s=t[E];if(s===void 0)continue;let O=!0;if(typeof s=="number"?O=s===(E.startsWith("scale")?1:0):O=parseFloat(s)===0,!O||c){const z=vk(s,jA[E]);if(!O){y=!1;const j=lW[E]||E;d+=`${j}(${z}) `}c&&(i[E]=z)}}return d=d.trim(),c?d=c(i,y?"":d):y&&(d="none"),d}function GA(t,i,c){const{style:d,vars:y,transformOrigin:w}=t;let E=!1,s=!1;for(const O in i){const z=i[O];if(Ux.has(O)){E=!0;continue}else if(CA(O)){y[O]=z;continue}else{const j=vk(z,jA[O]);O.startsWith("origin")?(s=!0,w[O]=j):d[O]=j}}if(i.transform||(E||c?d.transform=uW(i,t.transform,c):d.transform&&(d.transform="none")),s){const{originX:O="50%",originY:z="50%",originZ:j=0}=w;d.transformOrigin=`${O} ${z} ${j}`}}const HA=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Pk(t,i,c){for(const d in i)!Pl(i[d])&&!Dk(d,c)&&(t[d]=i[d])}function dW({transformTemplate:t},i){return Z.useMemo(()=>{const c=HA();return GA(c,i,t),Object.assign({},c.vars,c.style)},[i])}function hW(t,i){const c=t.style||{},d={};return Pk(d,c,t),Object.assign(d,dW(t,i)),d}function fW(t,i){const c={},d=hW(t,i);return t.drag&&t.dragListener!==!1&&(c.draggable=!1,d.userSelect=d.WebkitUserSelect=d.WebkitTouchCallout="none",d.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(c.tabIndex=0),c.style=d,c}const pW={offset:"stroke-dashoffset",array:"stroke-dasharray"},mW={offset:"strokeDashoffset",array:"strokeDasharray"};function gW(t,i,c=1,d=0,y=!0){t.pathLength=1;const w=y?pW:mW;t[w.offset]=cr.transform(-d);const E=cr.transform(i),s=cr.transform(c);t[w.array]=`${E} ${s}`}function Ok(t,{attrX:i,attrY:c,attrScale:d,pathLength:y,pathSpacing:w=1,pathOffset:E=0,...s},O,z,j){if(GA(t,s,z),O){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:H,style:Y}=t;H.transform&&(Y.transform=H.transform,delete H.transform),(Y.transform||H.transformOrigin)&&(Y.transformOrigin=H.transformOrigin??"50% 50%",delete H.transformOrigin),Y.transform&&(Y.transformBox=j?.transformBox??"fill-box",delete H.transformBox),i!==void 0&&(H.x=i),c!==void 0&&(H.y=c),d!==void 0&&(H.scale=d),y!==void 0&&gW(H,y,w,E,!1)}const zk=()=>({...HA(),attrs:{}}),Lk=t=>typeof t=="string"&&t.toLowerCase()==="svg";function _W(t,i,c,d){const y=Z.useMemo(()=>{const w=zk();return Ok(w,i,Lk(d),t.transformTemplate,t.style),{...w.attrs,style:{...w.style}}},[i]);if(t.style){const w={};Pk(w,t.style,t),y.style={...w,...y.style}}return y}const yW=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function qA(t){return typeof t!="string"||t.includes("-")?!1:!!(yW.indexOf(t)>-1||/[A-Z]/u.test(t))}function xW(t,i,c,{latestValues:d},y,w=!1){const s=(qA(t)?_W:fW)(i,d,y,t),O=rW(i,typeof t=="string",w),z=t!==Z.Fragment?{...O,...s,ref:c}:{},{children:j}=i,H=Z.useMemo(()=>Pl(j)?j.get():j,[j]);return Z.createElement(t,{...z,children:H})}function uP(t){const i=[{},{}];return t?.values.forEach((c,d)=>{i[0][d]=c.get(),i[1][d]=c.getVelocity()}),i}function ZA(t,i,c,d){if(typeof i=="function"){const[y,w]=uP(d);i=i(c!==void 0?c:t.custom,y,w)}if(typeof i=="string"&&(i=t.variants&&t.variants[i]),typeof i=="function"){const[y,w]=uP(d);i=i(c!==void 0?c:t.custom,y,w)}return i}function iw(t){return Pl(t)?t.get():t}function vW({scrapeMotionValuesFromProps:t,createRenderState:i},c,d,y){return{latestValues:bW(c,d,y,t),renderState:i()}}function bW(t,i,c,d){const y={},w=d(t,{});for(const Y in w)y[Y]=iw(w[Y]);let{initial:E,animate:s}=t;const O=oS(t),z=Ik(t);i&&z&&!O&&t.inherit!==!1&&(E===void 0&&(E=i.initial),s===void 0&&(s=i.animate));let j=c?c.initial===!1:!1;j=j||E===!1;const H=j?s:E;if(H&&typeof H!="boolean"&&!sS(H)){const Y=Array.isArray(H)?H:[H];for(let ie=0;ie<Y.length;ie++){const oe=ZA(t,Y[ie]);if(oe){const{transitionEnd:ee,transition:le,...ge}=oe;for(const pe in ge){let _e=ge[pe];if(Array.isArray(_e)){const Re=j?_e.length-1:0;_e=_e[Re]}_e!==null&&(y[pe]=_e)}for(const pe in ee)y[pe]=ee[pe]}}}return y}const Nk=t=>(i,c)=>{const d=Z.useContext(rS),y=Z.useContext(iS),w=()=>vW(t,i,d,y);return c?w():yA(w)};function WA(t,i,c){const{style:d}=t,y={};for(const w in d)(Pl(d[w])||i.style&&Pl(i.style[w])||Dk(w,t)||c?.getValue(w)?.liveStyle!==void 0)&&(y[w]=d[w]);return y}const wW=Nk({scrapeMotionValuesFromProps:WA,createRenderState:HA});function kk(t,i,c){const d=WA(t,i,c);for(const y in t)if(Pl(t[y])||Pl(i[y])){const w=Vx.indexOf(y)!==-1?"attr"+y.charAt(0).toUpperCase()+y.substring(1):y;d[w]=t[y]}return d}const SW=Nk({scrapeMotionValuesFromProps:kk,createRenderState:zk}),TW=Symbol.for("motionComponentSymbol");function dx(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function EW(t,i,c){return Z.useCallback(d=>{d&&t.onMount&&t.onMount(d),i&&(d?i.mount(d):i.unmount()),c&&(typeof c=="function"?c(d):dx(c)&&(c.current=d))},[i])}const XA=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),AW="framerAppearId",jk="data-"+XA(AW),Fk=Z.createContext({});function CW(t,i,c,d,y){const{visualElement:w}=Z.useContext(rS),E=Z.useContext(Rk),s=Z.useContext(iS),O=Z.useContext(VA).reducedMotion,z=Z.useRef(null);d=d||E.renderer,!z.current&&d&&(z.current=d(t,{visualState:i,parent:w,props:c,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:O}));const j=z.current,H=Z.useContext(Fk);j&&!j.projection&&y&&(j.type==="html"||j.type==="svg")&&RW(z.current,c,y,H);const Y=Z.useRef(!1);Z.useInsertionEffect(()=>{j&&Y.current&&j.update(c,s)});const ie=c[jk],oe=Z.useRef(!!ie&&!window.MotionHandoffIsComplete?.(ie)&&window.MotionHasOptimisedAnimation?.(ie));return LN(()=>{j&&(Y.current=!0,window.MotionIsMounted=!0,j.updateFeatures(),j.scheduleRenderMicrotask(),oe.current&&j.animationState&&j.animationState.animateChanges())}),Z.useEffect(()=>{j&&(!oe.current&&j.animationState&&j.animationState.animateChanges(),oe.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(ie)}),oe.current=!1),j.enteringChildren=void 0)}),j}function RW(t,i,c,d){const{layoutId:y,layout:w,drag:E,dragConstraints:s,layoutScroll:O,layoutRoot:z,layoutCrossfade:j}=i;t.projection=new c(t.latestValues,i["data-framer-portal-id"]?void 0:Bk(t.parent)),t.projection.setOptions({layoutId:y,layout:w,alwaysMeasureLayout:!!E||s&&dx(s),visualElement:t,animationType:typeof w=="string"?w:"both",initialPromotionConfig:d,crossfade:j,layoutScroll:O,layoutRoot:z})}function Bk(t){if(t)return t.options.allowProjection!==!1?t.projection:Bk(t.parent)}function r2(t,{forwardMotionProps:i=!1}={},c,d){c&&tW(c);const y=qA(t)?SW:wW;function w(s,O){let z;const j={...Z.useContext(VA),...s,layoutId:MW(s)},{isStatic:H}=j,Y=oW(s),ie=y(s,H);if(!H&&xA){IW();const oe=DW(j);z=oe.MeasureLayout,Y.visualElement=CW(t,ie,j,d,oe.ProjectionNode)}return C.jsxs(rS.Provider,{value:Y,children:[z&&Y.visualElement?C.jsx(z,{visualElement:Y.visualElement,...j}):null,xW(t,s,EW(ie,Y.visualElement,O),ie,H,i)]})}w.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const E=Z.forwardRef(w);return E[TW]=t,E}function MW({layoutId:t}){const i=Z.useContext(_A).id;return i&&t!==void 0?i+"-"+t:t}function IW(t,i){Z.useContext(Rk).strict}function DW(t){const{drag:i,layout:c}=Ex;if(!i&&!c)return{};const d={...i,...c};return{MeasureLayout:i?.isEnabled(t)||c?.isEnabled(t)?d.MeasureLayout:void 0,ProjectionNode:d.ProjectionNode}}function PW(t,i){if(typeof Proxy>"u")return r2;const c=new Map,d=(w,E)=>r2(w,E,t,i),y=(w,E)=>d(w,E);return new Proxy(y,{get:(w,E)=>E==="create"?d:(c.has(E)||c.set(E,r2(E,void 0,t,i)),c.get(E))})}function Vk({top:t,left:i,right:c,bottom:d}){return{x:{min:i,max:c},y:{min:t,max:d}}}function OW({x:t,y:i}){return{top:i.min,right:t.max,bottom:i.max,left:t.min}}function zW(t,i){if(!i)return t;const c=i({x:t.left,y:t.top}),d=i({x:t.right,y:t.bottom});return{top:c.y,left:c.x,bottom:d.y,right:d.x}}function s2(t){return t===void 0||t===1}function mE({scale:t,scaleX:i,scaleY:c}){return!s2(t)||!s2(i)||!s2(c)}function T_(t){return mE(t)||Uk(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Uk(t){return dP(t.x)||dP(t.y)}function dP(t){return t&&t!=="0%"}function Ew(t,i,c){const d=t-c,y=i*d;return c+y}function hP(t,i,c,d,y){return y!==void 0&&(t=Ew(t,y,d)),Ew(t,c,d)+i}function gE(t,i=0,c=1,d,y){t.min=hP(t.min,i,c,d,y),t.max=hP(t.max,i,c,d,y)}function $k(t,{x:i,y:c}){gE(t.x,i.translate,i.scale,i.originPoint),gE(t.y,c.translate,c.scale,c.originPoint)}const fP=.999999999999,pP=1.0000000000001;function LW(t,i,c,d=!1){const y=c.length;if(!y)return;i.x=i.y=1;let w,E;for(let s=0;s<y;s++){w=c[s],E=w.projectionDelta;const{visualElement:O}=w.options;O&&O.props.style&&O.props.style.display==="contents"||(d&&w.options.layoutScroll&&w.scroll&&w!==w.root&&fx(t,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),E&&(i.x*=E.x.scale,i.y*=E.y.scale,$k(t,E)),d&&T_(w.latestValues)&&fx(t,w.latestValues))}i.x<pP&&i.x>fP&&(i.x=1),i.y<pP&&i.y>fP&&(i.y=1)}function hx(t,i){t.min=t.min+i,t.max=t.max+i}function mP(t,i,c,d,y=.5){const w=Ro(t.min,t.max,y);gE(t,i,c,w,d)}function fx(t,i){mP(t.x,i.x,i.scaleX,i.scale,i.originX),mP(t.y,i.y,i.scaleY,i.scale,i.originY)}function Gk(t,i){return Vk(zW(t.getBoundingClientRect(),i))}function NW(t,i,c){const d=Gk(t,c),{scroll:y}=i;return y&&(hx(d.x,y.offset.x),hx(d.y,y.offset.y)),d}const gP=()=>({translate:0,scale:1,origin:0,originPoint:0}),px=()=>({x:gP(),y:gP()}),_P=()=>({min:0,max:0}),Yo=()=>({x:_P(),y:_P()}),_E={current:null},Hk={current:!1};function kW(){if(Hk.current=!0,!!xA)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),i=()=>_E.current=t.matches;t.addEventListener("change",i),i()}else _E.current=!1}const jW=new WeakMap;function FW(t,i,c){for(const d in i){const y=i[d],w=c[d];if(Pl(y))t.addValue(d,y);else if(Pl(w))t.addValue(d,Tx(y,{owner:t}));else if(w!==y)if(t.hasValue(d)){const E=t.getValue(d);E.liveStyle===!0?E.jump(y):E.hasAnimated||E.set(y)}else{const E=t.getStaticValue(d);t.addValue(d,Tx(E!==void 0?E:y,{owner:t}))}}for(const d in c)i[d]===void 0&&t.removeValue(d);return i}const yP=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class BW{scrapeMotionValuesFromProps(i,c,d){return{}}constructor({parent:i,props:c,presenceContext:d,reducedMotionConfig:y,blockInitialAnimation:w,visualState:E},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=NA,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Y=Pc.now();this.renderScheduledAt<Y&&(this.renderScheduledAt=Y,xo.render(this.render,!1,!0))};const{latestValues:O,renderState:z}=E;this.latestValues=O,this.baseTarget={...O},this.initialValues=c.initial?{...O}:{},this.renderState=z,this.parent=i,this.props=c,this.presenceContext=d,this.depth=i?i.depth+1:0,this.reducedMotionConfig=y,this.options=s,this.blockInitialAnimation=!!w,this.isControllingVariants=oS(c),this.isVariantNode=Ik(c),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:j,...H}=this.scrapeMotionValuesFromProps(c,{},this);for(const Y in H){const ie=H[Y];O[Y]!==void 0&&Pl(ie)&&ie.set(O[Y])}}mount(i){this.current=i,jW.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,d)=>this.bindToMotionValue(d,c)),Hk.current||kW(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:_E.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ig(this.notifyUpdate),ig(this.render),this.valueSubscriptions.forEach(i=>i()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const i in this.events)this.events[i].clear();for(const i in this.features){const c=this.features[i];c&&(c.unmount(),c.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,c){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const d=Ux.has(i);d&&this.onBindTransform&&this.onBindTransform();const y=c.on("change",E=>{this.latestValues[i]=E,this.props.onUpdate&&xo.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let w;window.MotionCheckAppearSync&&(w=window.MotionCheckAppearSync(this,i,c)),this.valueSubscriptions.set(i,()=>{y(),w&&w(),c.owner&&c.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in Ex){const c=Ex[i];if(!c)continue;const{isEnabled:d,Feature:y}=c;if(!this.features[i]&&y&&d(this.props)&&(this.features[i]=new y(this)),this.features[i]){const w=this.features[i];w.isMounted?w.update():(w.mount(),w.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Yo()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,c){this.latestValues[i]=c}update(i,c){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=c;for(let d=0;d<yP.length;d++){const y=yP[d];this.propEventSubscriptions[y]&&(this.propEventSubscriptions[y](),delete this.propEventSubscriptions[y]);const w="on"+y,E=i[w];E&&(this.propEventSubscriptions[y]=this.on(y,E))}this.prevMotionValues=FW(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const c=this.getClosestVariantNode();if(c)return c.variantChildren&&c.variantChildren.add(i),()=>c.variantChildren.delete(i)}addValue(i,c){const d=this.values.get(i);c!==d&&(d&&this.removeValue(i),this.bindToMotionValue(i,c),this.values.set(i,c),this.latestValues[i]=c.get())}removeValue(i){this.values.delete(i);const c=this.valueSubscriptions.get(i);c&&(c(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,c){if(this.props.values&&this.props.values[i])return this.props.values[i];let d=this.values.get(i);return d===void 0&&c!==void 0&&(d=Tx(c===null?void 0:c,{owner:this}),this.addValue(i,d)),d}readValue(i,c){let d=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return d!=null&&(typeof d=="string"&&(NN(d)||jN(d))?d=parseFloat(d):!WZ(d)&&rg.test(c)&&(d=xk(i,c)),this.setBaseTarget(i,Pl(d)?d.get():d)),Pl(d)?d.get():d}setBaseTarget(i,c){this.baseTarget[i]=c}getBaseTarget(i){const{initial:c}=this.props;let d;if(typeof c=="string"||typeof c=="object"){const w=ZA(this.props,c,this.presenceContext?.custom);w&&(d=w[i])}if(c&&d!==void 0)return d;const y=this.getBaseTargetFromProps(this.props,i);return y!==void 0&&!Pl(y)?y:this.initialValues[i]!==void 0&&d===void 0?void 0:this.baseTarget[i]}on(i,c){return this.events[i]||(this.events[i]=new TA),this.events[i].add(c)}notify(i,...c){this.events[i]&&this.events[i].notify(...c)}scheduleRenderMicrotask(){FA.render(this.render)}}class qk extends BW{constructor(){super(...arguments),this.KeyframeResolver=NZ}sortInstanceNodePosition(i,c){return i.compareDocumentPosition(c)&2?1:-1}getBaseTargetFromProps(i,c){return i.style?i.style[c]:void 0}removeValueFromRenderState(i,{vars:c,style:d}){delete c[i],delete d[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;Pl(i)&&(this.childSubscription=i.on("change",c=>{this.current&&(this.current.textContent=`${c}`)}))}}function Zk(t,{style:i,vars:c},d,y){const w=t.style;let E;for(E in i)w[E]=i[E];y?.applyProjectionStyles(w,d);for(E in c)w.setProperty(E,c[E])}function VW(t){return window.getComputedStyle(t)}class UW extends qk{constructor(){super(...arguments),this.type="html",this.renderInstance=Zk}readValueFromInstance(i,c){if(Ux.has(c))return this.projection?.isProjecting?lE(c):tZ(i,c);{const d=VW(i),y=(CA(c)?d.getPropertyValue(c):d[c])||0;return typeof y=="string"?y.trim():y}}measureInstanceViewportBox(i,{transformPagePoint:c}){return Gk(i,c)}build(i,c,d){GA(i,c,d.transformTemplate)}scrapeMotionValuesFromProps(i,c,d){return WA(i,c,d)}}const Wk=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function $W(t,i,c,d){Zk(t,i,void 0,d);for(const y in i.attrs)t.setAttribute(Wk.has(y)?y:XA(y),i.attrs[y])}class GW extends qk{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Yo}getBaseTargetFromProps(i,c){return i[c]}readValueFromInstance(i,c){if(Ux.has(c)){const d=yk(c);return d&&d.default||0}return c=Wk.has(c)?c:XA(c),i.getAttribute(c)}scrapeMotionValuesFromProps(i,c,d){return kk(i,c,d)}build(i,c,d){Ok(i,c,this.isSVGTag,d.transformTemplate,d.style)}renderInstance(i,c,d,y){$W(i,c,d,y)}mount(i){this.isSVGTag=Lk(i.tagName),super.mount(i)}}const HW=(t,i)=>qA(t)?new GW(i):new UW(i,{allowProjection:t!==Z.Fragment});function gx(t,i,c){const d=t.getProps();return ZA(d,i,c!==void 0?c:d.custom,t)}const yE=t=>Array.isArray(t);function qW(t,i,c){t.hasValue(i)?t.getValue(i).set(c):t.addValue(i,Tx(c))}function ZW(t){return yE(t)?t[t.length-1]||0:t}function WW(t,i){const c=gx(t,i);let{transitionEnd:d={},transition:y={},...w}=c||{};w={...w,...d};for(const E in w){const s=ZW(w[E]);qW(t,E,s)}}function XW(t){return!!(Pl(t)&&t.add)}function xE(t,i){const c=t.getValue("willChange");if(XW(c))return c.add(i);if(!c&&Lp.WillChange){const d=new Lp.WillChange("auto");t.addValue("willChange",d),d.add(i)}}function Xk(t){return t.props[jk]}const KW=t=>t!==null;function YW(t,{repeat:i,repeatType:c="loop"},d){const y=t.filter(KW),w=i&&c!=="loop"&&i%2===1?0:y.length-1;return y[w]}const QW={type:"spring",stiffness:500,damping:25,restSpeed:10},JW=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),eX={type:"keyframes",duration:.8},tX={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},nX=(t,{keyframes:i})=>i.length>2?eX:Ux.has(t)?t.startsWith("scale")?JW(i[1]):QW:tX;function iX({when:t,delay:i,delayChildren:c,staggerChildren:d,staggerDirection:y,repeat:w,repeatType:E,repeatDelay:s,from:O,elapsed:z,...j}){return!!Object.keys(j).length}const KA=(t,i,c,d={},y,w)=>E=>{const s=kA(d,t)||{},O=s.delay||d.delay||0;let{elapsed:z=0}=d;z=z-bf(O);const j={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:i.getVelocity(),...s,delay:-z,onUpdate:Y=>{i.set(Y),s.onUpdate&&s.onUpdate(Y)},onComplete:()=>{E(),s.onComplete&&s.onComplete()},name:t,motionValue:i,element:w?void 0:y};iX(s)||Object.assign(j,nX(t,j)),j.duration&&(j.duration=bf(j.duration)),j.repeatDelay&&(j.repeatDelay=bf(j.repeatDelay)),j.from!==void 0&&(j.keyframes[0]=j.from);let H=!1;if((j.type===!1||j.duration===0&&!j.repeatDelay)&&(fE(j),j.delay===0&&(H=!0)),(Lp.instantAnimations||Lp.skipAnimations)&&(H=!0,fE(j),j.delay=0),j.allowFlatten=!s.type&&!s.ease,H&&!w&&i.get()!==void 0){const Y=YW(j.keyframes,s);if(Y!==void 0){xo.update(()=>{j.onUpdate(Y),j.onComplete()});return}}return s.isSync?new LA(j):new TZ(j)};function rX({protectedKeys:t,needsAnimating:i},c){const d=t.hasOwnProperty(c)&&i[c]!==!0;return i[c]=!1,d}function Kk(t,i,{delay:c=0,transitionOverride:d,type:y}={}){let{transition:w=t.getDefaultTransition(),transitionEnd:E,...s}=i;d&&(w=d);const O=[],z=y&&t.animationState&&t.animationState.getState()[y];for(const j in s){const H=t.getValue(j,t.latestValues[j]??null),Y=s[j];if(Y===void 0||z&&rX(z,j))continue;const ie={delay:c,...kA(w||{},j)},oe=H.get();if(oe!==void 0&&!H.isAnimating&&!Array.isArray(Y)&&Y===oe&&!ie.velocity)continue;let ee=!1;if(window.MotionHandoffAnimation){const ge=Xk(t);if(ge){const pe=window.MotionHandoffAnimation(ge,j,xo);pe!==null&&(ie.startTime=pe,ee=!0)}}xE(t,j),H.start(KA(j,H,Y,t.shouldReduceMotion&&mk.has(j)?{type:!1}:ie,t,ee));const le=H.animation;le&&O.push(le)}return E&&Promise.all(O).then(()=>{xo.update(()=>{E&&WW(t,E)})}),O}function Yk(t,i,c,d=0,y=1){const w=Array.from(t).sort((z,j)=>z.sortNodePosition(j)).indexOf(i),E=t.size,s=(E-1)*d;return typeof c=="function"?c(w,E):y===1?w*d:s-w*d}function vE(t,i,c={}){const d=gx(t,i,c.type==="exit"?t.presenceContext?.custom:void 0);let{transition:y=t.getDefaultTransition()||{}}=d||{};c.transitionOverride&&(y=c.transitionOverride);const w=d?()=>Promise.all(Kk(t,d,c)):()=>Promise.resolve(),E=t.variantChildren&&t.variantChildren.size?(O=0)=>{const{delayChildren:z=0,staggerChildren:j,staggerDirection:H}=y;return sX(t,i,O,z,j,H,c)}:()=>Promise.resolve(),{when:s}=y;if(s){const[O,z]=s==="beforeChildren"?[w,E]:[E,w];return O().then(()=>z())}else return Promise.all([w(),E(c.delay)])}function sX(t,i,c=0,d=0,y=0,w=1,E){const s=[];for(const O of t.variantChildren)O.notify("AnimationStart",i),s.push(vE(O,i,{...E,delay:c+(typeof d=="function"?0:d)+Yk(t.variantChildren,O,d,y,w)}).then(()=>O.notify("AnimationComplete",i)));return Promise.all(s)}function oX(t,i,c={}){t.notify("AnimationStart",i);let d;if(Array.isArray(i)){const y=i.map(w=>vE(t,w,c));d=Promise.all(y)}else if(typeof i=="string")d=vE(t,i,c);else{const y=typeof i=="function"?gx(t,i,c.custom):i;d=Promise.all(Kk(t,y,c))}return d.then(()=>{t.notify("AnimationComplete",i)})}function Qk(t,i){if(!Array.isArray(i))return!1;const c=i.length;if(c!==t.length)return!1;for(let d=0;d<c;d++)if(i[d]!==t[d])return!1;return!0}const aX=$A.length;function Jk(t){if(!t)return;if(!t.isControllingVariants){const c=t.parent?Jk(t.parent)||{}:{};return t.props.initial!==void 0&&(c.initial=t.props.initial),c}const i={};for(let c=0;c<aX;c++){const d=$A[c],y=t.props[d];(P0(y)||y===!1)&&(i[d]=y)}return i}const lX=[...UA].reverse(),cX=UA.length;function uX(t){return i=>Promise.all(i.map(({animation:c,options:d})=>oX(t,c,d)))}function dX(t){let i=uX(t),c=xP(),d=!0;const y=O=>(z,j)=>{const H=gx(t,j,O==="exit"?t.presenceContext?.custom:void 0);if(H){const{transition:Y,transitionEnd:ie,...oe}=H;z={...z,...oe,...ie}}return z};function w(O){i=O(t)}function E(O){const{props:z}=t,j=Jk(t.parent)||{},H=[],Y=new Set;let ie={},oe=1/0;for(let le=0;le<cX;le++){const ge=lX[le],pe=c[ge],_e=z[ge]!==void 0?z[ge]:j[ge],Re=P0(_e),xe=ge===O?pe.isActive:null;xe===!1&&(oe=le);let Ze=_e===j[ge]&&_e!==z[ge]&&Re;if(Ze&&d&&t.manuallyAnimateOnMount&&(Ze=!1),pe.protectedKeys={...ie},!pe.isActive&&xe===null||!_e&&!pe.prevProp||sS(_e)||typeof _e=="boolean")continue;const Le=hX(pe.prevProp,_e);let $e=Le||ge===O&&pe.isActive&&!Ze&&Re||le>oe&&Re,st=!1;const Et=Array.isArray(_e)?_e:[_e];let Ut=Et.reduce(y(ge),{});xe===!1&&(Ut={});const{prevResolvedValues:$t={}}=pe,tt={...$t,...Ut},ut=ze=>{$e=!0,Y.has(ze)&&(st=!0,Y.delete(ze)),pe.needsAnimating[ze]=!0;const Fe=t.getValue(ze);Fe&&(Fe.liveStyle=!1)};for(const ze in tt){const Fe=Ut[ze],kt=$t[ze];if(ie.hasOwnProperty(ze))continue;let fn=!1;yE(Fe)&&yE(kt)?fn=!Qk(Fe,kt):fn=Fe!==kt,fn?Fe!=null?ut(ze):Y.add(ze):Fe!==void 0&&Y.has(ze)?ut(ze):pe.protectedKeys[ze]=!0}pe.prevProp=_e,pe.prevResolvedValues=Ut,pe.isActive&&(ie={...ie,...Ut}),d&&t.blockInitialAnimation&&($e=!1);const on=Ze&&Le;$e&&(!on||st)&&H.push(...Et.map(ze=>{const Fe={type:ge};if(typeof ze=="string"&&d&&!on&&t.manuallyAnimateOnMount&&t.parent){const{parent:kt}=t,fn=gx(kt,ze);if(kt.enteringChildren&&fn){const{delayChildren:Me}=fn.transition||{};Fe.delay=Yk(kt.enteringChildren,t,Me)}}return{animation:ze,options:Fe}}))}if(Y.size){const le={};if(typeof z.initial!="boolean"){const ge=gx(t,Array.isArray(z.initial)?z.initial[0]:z.initial);ge&&ge.transition&&(le.transition=ge.transition)}Y.forEach(ge=>{const pe=t.getBaseTarget(ge),_e=t.getValue(ge);_e&&(_e.liveStyle=!0),le[ge]=pe??null}),H.push({animation:le})}let ee=!!H.length;return d&&(z.initial===!1||z.initial===z.animate)&&!t.manuallyAnimateOnMount&&(ee=!1),d=!1,ee?i(H):Promise.resolve()}function s(O,z){if(c[O].isActive===z)return Promise.resolve();t.variantChildren?.forEach(H=>H.animationState?.setActive(O,z)),c[O].isActive=z;const j=E(O);for(const H in c)c[H].protectedKeys={};return j}return{animateChanges:E,setActive:s,setAnimateFunction:w,getState:()=>c,reset:()=>{c=xP()}}}function hX(t,i){return typeof i=="string"?i!==t:Array.isArray(i)?!Qk(i,t):!1}function S_(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xP(){return{animate:S_(!0),whileInView:S_(),whileHover:S_(),whileTap:S_(),whileDrag:S_(),whileFocus:S_(),exit:S_()}}class cg{constructor(i){this.isMounted=!1,this.node=i}update(){}}class fX extends cg{constructor(i){super(i),i.animationState||(i.animationState=dX(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();sS(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:c}=this.node.prevProps||{};i!==c&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let pX=0;class mX extends cg{constructor(){super(...arguments),this.id=pX++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:c}=this.node.presenceContext,{isPresent:d}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===d)return;const y=this.node.animationState.setActive("exit",!i);c&&!i&&y.then(()=>{c(this.id)})}mount(){const{register:i,onExitComplete:c}=this.node.presenceContext||{};c&&c(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const gX={animation:{Feature:fX},exit:{Feature:mX}};function z0(t,i,c,d={passive:!0}){return t.addEventListener(i,c,d),()=>t.removeEventListener(i,c)}function ib(t){return{point:{x:t.pageX,y:t.pageY}}}const _X=t=>i=>BA(i)&&t(i,ib(i));function g0(t,i,c,d){return z0(t,i,_X(c),d)}const e3=1e-4,yX=1-e3,xX=1+e3,t3=.01,vX=0-t3,bX=0+t3;function ec(t){return t.max-t.min}function wX(t,i,c){return Math.abs(t-i)<=c}function vP(t,i,c,d=.5){t.origin=d,t.originPoint=Ro(i.min,i.max,t.origin),t.scale=ec(c)/ec(i),t.translate=Ro(c.min,c.max,t.origin)-t.originPoint,(t.scale>=yX&&t.scale<=xX||isNaN(t.scale))&&(t.scale=1),(t.translate>=vX&&t.translate<=bX||isNaN(t.translate))&&(t.translate=0)}function _0(t,i,c,d){vP(t.x,i.x,c.x,d?d.originX:void 0),vP(t.y,i.y,c.y,d?d.originY:void 0)}function bP(t,i,c){t.min=c.min+i.min,t.max=t.min+ec(i)}function SX(t,i,c){bP(t.x,i.x,c.x),bP(t.y,i.y,c.y)}function wP(t,i,c){t.min=i.min-c.min,t.max=t.min+ec(i)}function y0(t,i,c){wP(t.x,i.x,c.x),wP(t.y,i.y,c.y)}function Hu(t){return[t("x"),t("y")]}const n3=({current:t})=>t?t.ownerDocument.defaultView:null,SP=(t,i)=>Math.abs(t-i);function TX(t,i){const c=SP(t.x,i.x),d=SP(t.y,i.y);return Math.sqrt(c**2+d**2)}class i3{constructor(i,c,{transformPagePoint:d,contextWindow:y=window,dragSnapToOrigin:w=!1,distanceThreshold:E=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Y=a2(this.lastMoveEventInfo,this.history),ie=this.startEvent!==null,oe=TX(Y.offset,{x:0,y:0})>=this.distanceThreshold;if(!ie&&!oe)return;const{point:ee}=Y,{timestamp:le}=ll;this.history.push({...ee,timestamp:le});const{onStart:ge,onMove:pe}=this.handlers;ie||(ge&&ge(this.lastMoveEvent,Y),this.startEvent=this.lastMoveEvent),pe&&pe(this.lastMoveEvent,Y)},this.handlePointerMove=(Y,ie)=>{this.lastMoveEvent=Y,this.lastMoveEventInfo=o2(ie,this.transformPagePoint),xo.update(this.updatePoint,!0)},this.handlePointerUp=(Y,ie)=>{this.end();const{onEnd:oe,onSessionEnd:ee,resumeAnimation:le}=this.handlers;if(this.dragSnapToOrigin&&le&&le(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ge=a2(Y.type==="pointercancel"?this.lastMoveEventInfo:o2(ie,this.transformPagePoint),this.history);this.startEvent&&oe&&oe(Y,ge),ee&&ee(Y,ge)},!BA(i))return;this.dragSnapToOrigin=w,this.handlers=c,this.transformPagePoint=d,this.distanceThreshold=E,this.contextWindow=y||window;const s=ib(i),O=o2(s,this.transformPagePoint),{point:z}=O,{timestamp:j}=ll;this.history=[{...z,timestamp:j}];const{onSessionStart:H}=c;H&&H(i,a2(O,this.history)),this.removeListeners=eb(g0(this.contextWindow,"pointermove",this.handlePointerMove),g0(this.contextWindow,"pointerup",this.handlePointerUp),g0(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),ig(this.updatePoint)}}function o2(t,i){return i?{point:i(t.point)}:t}function TP(t,i){return{x:t.x-i.x,y:t.y-i.y}}function a2({point:t},i){return{point:t,delta:TP(t,r3(i)),offset:TP(t,EX(i)),velocity:AX(i,.1)}}function EX(t){return t[0]}function r3(t){return t[t.length-1]}function AX(t,i){if(t.length<2)return{x:0,y:0};let c=t.length-1,d=null;const y=r3(t);for(;c>=0&&(d=t[c],!(y.timestamp-d.timestamp>bf(i)));)c--;if(!d)return{x:0,y:0};const w=Yu(y.timestamp-d.timestamp);if(w===0)return{x:0,y:0};const E={x:(y.x-d.x)/w,y:(y.y-d.y)/w};return E.x===1/0&&(E.x=0),E.y===1/0&&(E.y=0),E}function CX(t,{min:i,max:c},d){return i!==void 0&&t<i?t=d?Ro(i,t,d.min):Math.max(t,i):c!==void 0&&t>c&&(t=d?Ro(c,t,d.max):Math.min(t,c)),t}function EP(t,i,c){return{min:i!==void 0?t.min+i:void 0,max:c!==void 0?t.max+c-(t.max-t.min):void 0}}function RX(t,{top:i,left:c,bottom:d,right:y}){return{x:EP(t.x,c,y),y:EP(t.y,i,d)}}function AP(t,i){let c=i.min-t.min,d=i.max-t.max;return i.max-i.min<t.max-t.min&&([c,d]=[d,c]),{min:c,max:d}}function MX(t,i){return{x:AP(t.x,i.x),y:AP(t.y,i.y)}}function IX(t,i){let c=.5;const d=ec(t),y=ec(i);return y>d?c=M0(i.min,i.max-d,t.min):d>y&&(c=M0(t.min,t.max-y,i.min)),zp(0,1,c)}function DX(t,i){const c={};return i.min!==void 0&&(c.min=i.min-t.min),i.max!==void 0&&(c.max=i.max-t.min),c}const bE=.35;function PX(t=bE){return t===!1?t=0:t===!0&&(t=bE),{x:CP(t,"left","right"),y:CP(t,"top","bottom")}}function CP(t,i,c){return{min:RP(t,i),max:RP(t,c)}}function RP(t,i){return typeof t=="number"?t:t[i]||0}const OX=new WeakMap;class zX{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Yo(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=i}start(i,{snapToCursor:c=!1,distanceThreshold:d}={}){const{presenceContext:y}=this.visualElement;if(y&&y.isPresent===!1)return;const w=H=>{const{dragSnapToOrigin:Y}=this.getProps();Y?this.pauseAnimation():this.stopAnimation(),c&&this.snapToCursor(ib(H).point)},E=(H,Y)=>{const{drag:ie,dragPropagation:oe,onDragStart:ee}=this.getProps();if(ie&&!oe&&(this.openDragLock&&this.openDragLock(),this.openDragLock=BZ(ie),!this.openDragLock))return;this.latestPointerEvent=H,this.latestPanInfo=Y,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Hu(ge=>{let pe=this.getAxisMotionValue(ge).get()||0;if(wf.test(pe)){const{projection:_e}=this.visualElement;if(_e&&_e.layout){const Re=_e.layout.layoutBox[ge];Re&&(pe=ec(Re)*(parseFloat(pe)/100))}}this.originPoint[ge]=pe}),ee&&xo.postRender(()=>ee(H,Y)),xE(this.visualElement,"transform");const{animationState:le}=this.visualElement;le&&le.setActive("whileDrag",!0)},s=(H,Y)=>{this.latestPointerEvent=H,this.latestPanInfo=Y;const{dragPropagation:ie,dragDirectionLock:oe,onDirectionLock:ee,onDrag:le}=this.getProps();if(!ie&&!this.openDragLock)return;const{offset:ge}=Y;if(oe&&this.currentDirection===null){this.currentDirection=LX(ge),this.currentDirection!==null&&ee&&ee(this.currentDirection);return}this.updateAxis("x",Y.point,ge),this.updateAxis("y",Y.point,ge),this.visualElement.render(),le&&le(H,Y)},O=(H,Y)=>{this.latestPointerEvent=H,this.latestPanInfo=Y,this.stop(H,Y),this.latestPointerEvent=null,this.latestPanInfo=null},z=()=>Hu(H=>this.getAnimationState(H)==="paused"&&this.getAxisMotionValue(H).animation?.play()),{dragSnapToOrigin:j}=this.getProps();this.panSession=new i3(i,{onSessionStart:w,onStart:E,onMove:s,onSessionEnd:O,resumeAnimation:z},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:j,distanceThreshold:d,contextWindow:n3(this.visualElement)})}stop(i,c){const d=i||this.latestPointerEvent,y=c||this.latestPanInfo,w=this.isDragging;if(this.cancel(),!w||!y||!d)return;const{velocity:E}=y;this.startAnimation(E);const{onDragEnd:s}=this.getProps();s&&xo.postRender(()=>s(d,y))}cancel(){this.isDragging=!1;const{projection:i,animationState:c}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:d}=this.getProps();!d&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),c&&c.setActive("whileDrag",!1)}updateAxis(i,c,d){const{drag:y}=this.getProps();if(!d||!P1(i,y,this.currentDirection))return;const w=this.getAxisMotionValue(i);let E=this.originPoint[i]+d[i];this.constraints&&this.constraints[i]&&(E=CX(E,this.constraints[i],this.elastic[i])),w.set(E)}resolveConstraints(){const{dragConstraints:i,dragElastic:c}=this.getProps(),d=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,y=this.constraints;i&&dx(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&d?this.constraints=RX(d.layoutBox,i):this.constraints=!1,this.elastic=PX(c),y!==this.constraints&&d&&this.constraints&&!this.hasMutatedConstraints&&Hu(w=>{this.constraints!==!1&&this.getAxisMotionValue(w)&&(this.constraints[w]=DX(d.layoutBox[w],this.constraints[w]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:c}=this.getProps();if(!i||!dx(i))return!1;const d=i.current,{projection:y}=this.visualElement;if(!y||!y.layout)return!1;const w=NW(d,y.root,this.visualElement.getTransformPagePoint());let E=MX(y.layout.layoutBox,w);if(c){const s=c(OW(E));this.hasMutatedConstraints=!!s,s&&(E=Vk(s))}return E}startAnimation(i){const{drag:c,dragMomentum:d,dragElastic:y,dragTransition:w,dragSnapToOrigin:E,onDragTransitionEnd:s}=this.getProps(),O=this.constraints||{},z=Hu(j=>{if(!P1(j,c,this.currentDirection))return;let H=O&&O[j]||{};E&&(H={min:0,max:0});const Y=y?200:1e6,ie=y?40:1e7,oe={type:"inertia",velocity:d?i[j]:0,bounceStiffness:Y,bounceDamping:ie,timeConstant:750,restDelta:1,restSpeed:10,...w,...H};return this.startAxisValueAnimation(j,oe)});return Promise.all(z).then(s)}startAxisValueAnimation(i,c){const d=this.getAxisMotionValue(i);return xE(this.visualElement,i),d.start(KA(i,d,0,c,this.visualElement,!1))}stopAnimation(){Hu(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){Hu(i=>this.getAxisMotionValue(i).animation?.pause())}getAnimationState(i){return this.getAxisMotionValue(i).animation?.state}getAxisMotionValue(i){const c=`_drag${i.toUpperCase()}`,d=this.visualElement.getProps(),y=d[c];return y||this.visualElement.getValue(i,(d.initial?d.initial[i]:void 0)||0)}snapToCursor(i){Hu(c=>{const{drag:d}=this.getProps();if(!P1(c,d,this.currentDirection))return;const{projection:y}=this.visualElement,w=this.getAxisMotionValue(c);if(y&&y.layout){const{min:E,max:s}=y.layout.layoutBox[c];w.set(i[c]-Ro(E,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:c}=this.getProps(),{projection:d}=this.visualElement;if(!dx(c)||!d||!this.constraints)return;this.stopAnimation();const y={x:0,y:0};Hu(E=>{const s=this.getAxisMotionValue(E);if(s&&this.constraints!==!1){const O=s.get();y[E]=IX({min:O,max:O},this.constraints[E])}});const{transformTemplate:w}=this.visualElement.getProps();this.visualElement.current.style.transform=w?w({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.resolveConstraints(),Hu(E=>{if(!P1(E,i,null))return;const s=this.getAxisMotionValue(E),{min:O,max:z}=this.constraints[E];s.set(Ro(O,z,y[E]))})}addListeners(){if(!this.visualElement.current)return;OX.set(this.visualElement,this);const i=this.visualElement.current,c=g0(i,"pointerdown",O=>{const{drag:z,dragListener:j=!0}=this.getProps();z&&j&&this.start(O)}),d=()=>{const{dragConstraints:O}=this.getProps();dx(O)&&O.current&&(this.constraints=this.resolveRefConstraints())},{projection:y}=this.visualElement,w=y.addEventListener("measure",d);y&&!y.layout&&(y.root&&y.root.updateScroll(),y.updateLayout()),xo.read(d);const E=z0(window,"resize",()=>this.scalePositionWithinConstraints()),s=y.addEventListener("didUpdate",(({delta:O,hasLayoutChanged:z})=>{this.isDragging&&z&&(Hu(j=>{const H=this.getAxisMotionValue(j);H&&(this.originPoint[j]+=O[j].translate,H.set(H.get()+O[j].translate))}),this.visualElement.render())}));return()=>{E(),c(),w(),s&&s()}}getProps(){const i=this.visualElement.getProps(),{drag:c=!1,dragDirectionLock:d=!1,dragPropagation:y=!1,dragConstraints:w=!1,dragElastic:E=bE,dragMomentum:s=!0}=i;return{...i,drag:c,dragDirectionLock:d,dragPropagation:y,dragConstraints:w,dragElastic:E,dragMomentum:s}}}function P1(t,i,c){return(i===!0||i===t)&&(c===null||c===t)}function LX(t,i=10){let c=null;return Math.abs(t.y)>i?c="y":Math.abs(t.x)>i&&(c="x"),c}class NX extends cg{constructor(i){super(i),this.removeGroupControls=Qu,this.removeListeners=Qu,this.controls=new zX(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Qu}unmount(){this.removeGroupControls(),this.removeListeners()}}const MP=t=>(i,c)=>{t&&xo.postRender(()=>t(i,c))};class kX extends cg{constructor(){super(...arguments),this.removePointerDownListener=Qu}onPointerDown(i){this.session=new i3(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:n3(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:c,onPan:d,onPanEnd:y}=this.node.getProps();return{onSessionStart:MP(i),onStart:MP(c),onMove:d,onEnd:(w,E)=>{delete this.session,y&&xo.postRender(()=>y(w,E))}}}mount(){this.removePointerDownListener=g0(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const rw={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function IP(t,i){return i.max===i.min?0:t/(i.max-i.min)*100}const o0={correct:(t,i)=>{if(!i.target)return t;if(typeof t=="string")if(cr.test(t))t=parseFloat(t);else return t;const c=IP(t,i.target.x),d=IP(t,i.target.y);return`${c}% ${d}%`}},jX={correct:(t,{treeScale:i,projectionDelta:c})=>{const d=t,y=rg.parse(t);if(y.length>5)return d;const w=rg.createTransformer(t),E=typeof y[0]!="number"?1:0,s=c.x.scale*i.x,O=c.y.scale*i.y;y[0+E]/=s,y[1+E]/=O;const z=Ro(s,O,.5);return typeof y[2+E]=="number"&&(y[2+E]/=z),typeof y[3+E]=="number"&&(y[3+E]/=z),w(y)}};let l2=!1;class FX extends Z.Component{componentDidMount(){const{visualElement:i,layoutGroup:c,switchLayoutGroup:d,layoutId:y}=this.props,{projection:w}=i;aW(BX),w&&(c.group&&c.group.add(w),d&&d.register&&y&&d.register(w),l2&&w.root.didUpdate(),w.addEventListener("animationComplete",()=>{this.safeToRemove()}),w.setOptions({...w.options,onExitComplete:()=>this.safeToRemove()})),rw.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:c,visualElement:d,drag:y,isPresent:w}=this.props,{projection:E}=d;return E&&(E.isPresent=w,l2=!0,y||i.layoutDependency!==c||c===void 0||i.isPresent!==w?E.willUpdate():this.safeToRemove(),i.isPresent!==w&&(w?E.promote():E.relegate()||xo.postRender(()=>{const s=E.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),FA.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:c,switchLayoutGroup:d}=this.props,{projection:y}=i;l2=!0,y&&(y.scheduleCheckAfterUnmount(),c&&c.group&&c.group.remove(y),d&&d.deregister&&d.deregister(y))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function s3(t){const[i,c]=Ak(),d=Z.useContext(_A);return C.jsx(FX,{...t,layoutGroup:d,switchLayoutGroup:Z.useContext(Fk),isPresent:i,safeToRemove:c})}const BX={borderRadius:{...o0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:o0,borderTopRightRadius:o0,borderBottomLeftRadius:o0,borderBottomRightRadius:o0,boxShadow:jX};function VX(t,i,c){const d=Pl(t)?t:Tx(t);return d.start(KA("",d,i,c)),d.animation}const UX=(t,i)=>t.depth-i.depth;class $X{constructor(){this.children=[],this.isDirty=!1}add(i){vA(this.children,i),this.isDirty=!0}remove(i){bA(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(UX),this.isDirty=!1,this.children.forEach(i)}}function GX(t,i){const c=Pc.now(),d=({timestamp:y})=>{const w=y-c;w>=i&&(ig(d),t(w-i))};return xo.setup(d,!0),()=>ig(d)}const o3=["TopLeft","TopRight","BottomLeft","BottomRight"],HX=o3.length,DP=t=>typeof t=="string"?parseFloat(t):t,PP=t=>typeof t=="number"||cr.test(t);function qX(t,i,c,d,y,w){y?(t.opacity=Ro(0,c.opacity??1,ZX(d)),t.opacityExit=Ro(i.opacity??1,0,WX(d))):w&&(t.opacity=Ro(i.opacity??1,c.opacity??1,d));for(let E=0;E<HX;E++){const s=`border${o3[E]}Radius`;let O=OP(i,s),z=OP(c,s);if(O===void 0&&z===void 0)continue;O||(O=0),z||(z=0),O===0||z===0||PP(O)===PP(z)?(t[s]=Math.max(Ro(DP(O),DP(z),d),0),(wf.test(z)||wf.test(O))&&(t[s]+="%")):t[s]=z}(i.rotate||c.rotate)&&(t.rotate=Ro(i.rotate||0,c.rotate||0,d))}function OP(t,i){return t[i]!==void 0?t[i]:t.borderRadius}const ZX=a3(0,.5,qN),WX=a3(.5,.95,Qu);function a3(t,i,c){return d=>d<t?0:d>i?1:c(M0(t,i,d))}function zP(t,i){t.min=i.min,t.max=i.max}function Gu(t,i){zP(t.x,i.x),zP(t.y,i.y)}function LP(t,i){t.translate=i.translate,t.scale=i.scale,t.originPoint=i.originPoint,t.origin=i.origin}function NP(t,i,c,d,y){return t-=i,t=Ew(t,1/c,d),y!==void 0&&(t=Ew(t,1/y,d)),t}function XX(t,i=0,c=1,d=.5,y,w=t,E=t){if(wf.test(i)&&(i=parseFloat(i),i=Ro(E.min,E.max,i/100)-E.min),typeof i!="number")return;let s=Ro(w.min,w.max,d);t===w&&(s-=i),t.min=NP(t.min,i,c,s,y),t.max=NP(t.max,i,c,s,y)}function kP(t,i,[c,d,y],w,E){XX(t,i[c],i[d],i[y],i.scale,w,E)}const KX=["x","scaleX","originX"],YX=["y","scaleY","originY"];function jP(t,i,c,d){kP(t.x,i,KX,c?c.x:void 0,d?d.x:void 0),kP(t.y,i,YX,c?c.y:void 0,d?d.y:void 0)}function FP(t){return t.translate===0&&t.scale===1}function l3(t){return FP(t.x)&&FP(t.y)}function BP(t,i){return t.min===i.min&&t.max===i.max}function QX(t,i){return BP(t.x,i.x)&&BP(t.y,i.y)}function VP(t,i){return Math.round(t.min)===Math.round(i.min)&&Math.round(t.max)===Math.round(i.max)}function c3(t,i){return VP(t.x,i.x)&&VP(t.y,i.y)}function UP(t){return ec(t.x)/ec(t.y)}function $P(t,i){return t.translate===i.translate&&t.scale===i.scale&&t.originPoint===i.originPoint}class JX{constructor(){this.members=[]}add(i){vA(this.members,i),i.scheduleRender()}remove(i){if(bA(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const c=this.members[this.members.length-1];c&&this.promote(c)}}relegate(i){const c=this.members.findIndex(y=>i===y);if(c===0)return!1;let d;for(let y=c;y>=0;y--){const w=this.members[y];if(w.isPresent!==!1){d=w;break}}return d?(this.promote(d),!0):!1}promote(i,c){const d=this.lead;if(i!==d&&(this.prevLead=d,this.lead=i,i.show(),d)){d.instance&&d.scheduleRender(),i.scheduleRender(),i.resumeFrom=d,c&&(i.resumeFrom.preserveOpacity=!0),d.snapshot&&(i.snapshot=d.snapshot,i.snapshot.latestValues=d.animationValues||d.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:y}=i.options;y===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:c,resumingFrom:d}=i;c.onExitComplete&&c.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function eK(t,i,c){let d="";const y=t.x.translate/i.x,w=t.y.translate/i.y,E=c?.z||0;if((y||w||E)&&(d=`translate3d(${y}px, ${w}px, ${E}px) `),(i.x!==1||i.y!==1)&&(d+=`scale(${1/i.x}, ${1/i.y}) `),c){const{transformPerspective:z,rotate:j,rotateX:H,rotateY:Y,skewX:ie,skewY:oe}=c;z&&(d=`perspective(${z}px) ${d}`),j&&(d+=`rotate(${j}deg) `),H&&(d+=`rotateX(${H}deg) `),Y&&(d+=`rotateY(${Y}deg) `),ie&&(d+=`skewX(${ie}deg) `),oe&&(d+=`skewY(${oe}deg) `)}const s=t.x.scale*i.x,O=t.y.scale*i.y;return(s!==1||O!==1)&&(d+=`scale(${s}, ${O})`),d||"none"}const c2=["","X","Y","Z"],tK=1e3;let nK=0;function u2(t,i,c,d){const{latestValues:y}=i;y[t]&&(c[t]=y[t],i.setStaticValue(t,0),d&&(d[t]=0))}function u3(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:i}=t.options;if(!i)return;const c=Xk(i);if(window.MotionHasOptimisedAnimation(c,"transform")){const{layout:y,layoutId:w}=t.options;window.MotionCancelOptimisedAnimation(c,"transform",xo,!(y||w))}const{parent:d}=t;d&&!d.hasCheckedOptimisedAppear&&u3(d)}function d3({attachResizeListener:t,defaultParent:i,measureScroll:c,checkIsScrollRoot:d,resetTransform:y}){return class{constructor(E={},s=i?.()){this.id=nK++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(sK),this.nodes.forEach(cK),this.nodes.forEach(uK),this.nodes.forEach(oK)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=E,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let O=0;O<this.path.length;O++)this.path[O].shouldResetTransform=!0;this.root===this&&(this.nodes=new $X)}addEventListener(E,s){return this.eventHandlers.has(E)||this.eventHandlers.set(E,new TA),this.eventHandlers.get(E).add(s)}notifyListeners(E,...s){const O=this.eventHandlers.get(E);O&&O.notify(...s)}hasListeners(E){return this.eventHandlers.has(E)}mount(E){if(this.instance)return;this.isSVG=Ek(E)&&!qZ(E),this.instance=E;const{layoutId:s,layout:O,visualElement:z}=this.options;if(z&&!z.current&&z.mount(E),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(O||s)&&(this.isLayoutDirty=!0),t){let j,H=0;const Y=()=>this.root.updateBlockedByResize=!1;xo.read(()=>{H=window.innerWidth}),t(E,()=>{const ie=window.innerWidth;ie!==H&&(H=ie,this.root.updateBlockedByResize=!0,j&&j(),j=GX(Y,250),rw.hasAnimatedSinceResize&&(rw.hasAnimatedSinceResize=!1,this.nodes.forEach(qP)))})}s&&this.root.registerSharedNode(s,this),this.options.animate!==!1&&z&&(s||O)&&this.addEventListener("didUpdate",({delta:j,hasLayoutChanged:H,hasRelativeLayoutChanged:Y,layout:ie})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const oe=this.options.transition||z.getDefaultTransition()||mK,{onLayoutAnimationStart:ee,onLayoutAnimationComplete:le}=z.getProps(),ge=!this.targetLayout||!c3(this.targetLayout,ie),pe=!H&&Y;if(this.options.layoutRoot||this.resumeFrom||pe||H&&(ge||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const _e={...kA(oe,"layout"),onPlay:ee,onComplete:le};(z.shouldReduceMotion||this.options.layoutRoot)&&(_e.delay=0,_e.type=!1),this.startAnimation(_e),this.setAnimationOrigin(j,pe)}else H||qP(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=ie})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const E=this.getStack();E&&E.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ig(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(dK),this.animationId++)}getTransformTemplate(){const{visualElement:E}=this.options;return E&&E.getProps().transformTemplate}willUpdate(E=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&u3(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let j=0;j<this.path.length;j++){const H=this.path[j];H.shouldResetTransform=!0,H.updateScroll("snapshot"),H.options.layoutRoot&&H.willUpdate(!1)}const{layoutId:s,layout:O}=this.options;if(s===void 0&&!O)return;const z=this.getTransformTemplate();this.prevTransformTemplateValue=z?z(this.latestValues,""):void 0,this.updateSnapshot(),E&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(GP);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(HP);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(lK),this.nodes.forEach(iK),this.nodes.forEach(rK)):this.nodes.forEach(HP),this.clearAllSnapshots();const s=Pc.now();ll.delta=zp(0,1e3/60,s-ll.timestamp),ll.timestamp=s,ll.isProcessing=!0,QT.update.process(ll),QT.preRender.process(ll),QT.render.process(ll),ll.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,FA.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(aK),this.sharedNodes.forEach(hK)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,xo.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){xo.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ec(this.snapshot.measuredBox.x)&&!ec(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let O=0;O<this.path.length;O++)this.path[O].updateScroll();const E=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Yo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,E?E.layoutBox:void 0)}updateScroll(E="measure"){let s=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===E&&(s=!1),s&&this.instance){const O=d(this.instance);this.scroll={animationId:this.root.animationId,phase:E,isRoot:O,offset:c(this.instance),wasRoot:this.scroll?this.scroll.isRoot:O}}}resetTransform(){if(!y)return;const E=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,s=this.projectionDelta&&!l3(this.projectionDelta),O=this.getTransformTemplate(),z=O?O(this.latestValues,""):void 0,j=z!==this.prevTransformTemplateValue;E&&this.instance&&(s||T_(this.latestValues)||j)&&(y(this.instance,z),this.shouldResetTransform=!1,this.scheduleRender())}measure(E=!0){const s=this.measurePageBox();let O=this.removeElementScroll(s);return E&&(O=this.removeTransform(O)),gK(O),{animationId:this.root.animationId,measuredBox:s,layoutBox:O,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:E}=this.options;if(!E)return Yo();const s=E.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(_K))){const{scroll:z}=this.root;z&&(hx(s.x,z.offset.x),hx(s.y,z.offset.y))}return s}removeElementScroll(E){const s=Yo();if(Gu(s,E),this.scroll?.wasRoot)return s;for(let O=0;O<this.path.length;O++){const z=this.path[O],{scroll:j,options:H}=z;z!==this.root&&j&&H.layoutScroll&&(j.wasRoot&&Gu(s,E),hx(s.x,j.offset.x),hx(s.y,j.offset.y))}return s}applyTransform(E,s=!1){const O=Yo();Gu(O,E);for(let z=0;z<this.path.length;z++){const j=this.path[z];!s&&j.options.layoutScroll&&j.scroll&&j!==j.root&&fx(O,{x:-j.scroll.offset.x,y:-j.scroll.offset.y}),T_(j.latestValues)&&fx(O,j.latestValues)}return T_(this.latestValues)&&fx(O,this.latestValues),O}removeTransform(E){const s=Yo();Gu(s,E);for(let O=0;O<this.path.length;O++){const z=this.path[O];if(!z.instance||!T_(z.latestValues))continue;mE(z.latestValues)&&z.updateSnapshot();const j=Yo(),H=z.measurePageBox();Gu(j,H),jP(s,z.latestValues,z.snapshot?z.snapshot.layoutBox:void 0,j)}return T_(this.latestValues)&&jP(s,this.latestValues),s}setTargetDelta(E){this.targetDelta=E,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(E){this.options={...this.options,...E,crossfade:E.crossfade!==void 0?E.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ll.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(E=!1){const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const O=!!this.resumingFrom||this!==s;if(!(E||O&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:j,layoutId:H}=this.options;if(!(!this.layout||!(j||H))){if(this.resolvedRelativeTargetAt=ll.timestamp,!this.targetDelta&&!this.relativeTarget){const Y=this.getClosestProjectingParent();Y&&Y.layout&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Yo(),this.relativeTargetOrigin=Yo(),y0(this.relativeTargetOrigin,this.layout.layoutBox,Y.layout.layoutBox),Gu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Yo(),this.targetWithTransforms=Yo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),SX(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Gu(this.target,this.layout.layoutBox),$k(this.target,this.targetDelta)):Gu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const Y=this.getClosestProjectingParent();Y&&!!Y.resumingFrom==!!this.resumingFrom&&!Y.options.layoutScroll&&Y.target&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Yo(),this.relativeTargetOrigin=Yo(),y0(this.relativeTargetOrigin,this.target,Y.target),Gu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||mE(this.parent.latestValues)||Uk(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const E=this.getLead(),s=!!this.resumingFrom||this!==E;let O=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(O=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(O=!1),this.resolvedRelativeTargetAt===ll.timestamp&&(O=!1),O)return;const{layout:z,layoutId:j}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(z||j))return;Gu(this.layoutCorrected,this.layout.layoutBox);const H=this.treeScale.x,Y=this.treeScale.y;LW(this.layoutCorrected,this.treeScale,this.path,s),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=Yo());const{target:ie}=E;if(!ie){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(LP(this.prevProjectionDelta.x,this.projectionDelta.x),LP(this.prevProjectionDelta.y,this.projectionDelta.y)),_0(this.projectionDelta,this.layoutCorrected,ie,this.latestValues),(this.treeScale.x!==H||this.treeScale.y!==Y||!$P(this.projectionDelta.x,this.prevProjectionDelta.x)||!$P(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",ie))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(E=!0){if(this.options.visualElement?.scheduleRender(),E){const s=this.getStack();s&&s.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=px(),this.projectionDelta=px(),this.projectionDeltaWithTransform=px()}setAnimationOrigin(E,s=!1){const O=this.snapshot,z=O?O.latestValues:{},j={...this.latestValues},H=px();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const Y=Yo(),ie=O?O.source:void 0,oe=this.layout?this.layout.source:void 0,ee=ie!==oe,le=this.getStack(),ge=!le||le.members.length<=1,pe=!!(ee&&!ge&&this.options.crossfade===!0&&!this.path.some(pK));this.animationProgress=0;let _e;this.mixTargetDelta=Re=>{const xe=Re/1e3;ZP(H.x,E.x,xe),ZP(H.y,E.y,xe),this.setTargetDelta(H),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(y0(Y,this.layout.layoutBox,this.relativeParent.layout.layoutBox),fK(this.relativeTarget,this.relativeTargetOrigin,Y,xe),_e&&QX(this.relativeTarget,_e)&&(this.isProjectionDirty=!1),_e||(_e=Yo()),Gu(_e,this.relativeTarget)),ee&&(this.animationValues=j,qX(j,z,this.latestValues,xe,pe,ge)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=xe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(E){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ig(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=xo.update(()=>{rw.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Tx(0)),this.currentAnimation=VX(this.motionValue,[0,1e3],{...E,velocity:0,isSync:!0,onUpdate:s=>{this.mixTargetDelta(s),E.onUpdate&&E.onUpdate(s)},onStop:()=>{},onComplete:()=>{E.onComplete&&E.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const E=this.getStack();E&&E.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(tK),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const E=this.getLead();let{targetWithTransforms:s,target:O,layout:z,latestValues:j}=E;if(!(!s||!O||!z)){if(this!==E&&this.layout&&z&&h3(this.options.animationType,this.layout.layoutBox,z.layoutBox)){O=this.target||Yo();const H=ec(this.layout.layoutBox.x);O.x.min=E.target.x.min,O.x.max=O.x.min+H;const Y=ec(this.layout.layoutBox.y);O.y.min=E.target.y.min,O.y.max=O.y.min+Y}Gu(s,O),fx(s,j),_0(this.projectionDeltaWithTransform,this.layoutCorrected,s,j)}}registerSharedNode(E,s){this.sharedNodes.has(E)||this.sharedNodes.set(E,new JX),this.sharedNodes.get(E).add(s);const z=s.options.initialPromotionConfig;s.promote({transition:z?z.transition:void 0,preserveFollowOpacity:z&&z.shouldPreserveFollowOpacity?z.shouldPreserveFollowOpacity(s):void 0})}isLead(){const E=this.getStack();return E?E.lead===this:!0}getLead(){const{layoutId:E}=this.options;return E?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:E}=this.options;return E?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:E}=this.options;if(E)return this.root.sharedNodes.get(E)}promote({needsReset:E,transition:s,preserveFollowOpacity:O}={}){const z=this.getStack();z&&z.promote(this,O),E&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const E=this.getStack();return E?E.relegate(this):!1}resetSkewAndRotation(){const{visualElement:E}=this.options;if(!E)return;let s=!1;const{latestValues:O}=E;if((O.z||O.rotate||O.rotateX||O.rotateY||O.rotateZ||O.skewX||O.skewY)&&(s=!0),!s)return;const z={};O.z&&u2("z",E,z,this.animationValues);for(let j=0;j<c2.length;j++)u2(`rotate${c2[j]}`,E,z,this.animationValues),u2(`skew${c2[j]}`,E,z,this.animationValues);E.render();for(const j in z)E.setStaticValue(j,z[j]),this.animationValues&&(this.animationValues[j]=z[j]);E.scheduleRender()}applyProjectionStyles(E,s){if(!this.instance||this.isSVG)return;if(!this.isVisible){E.visibility="hidden";return}const O=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,E.visibility="",E.opacity="",E.pointerEvents=iw(s?.pointerEvents)||"",E.transform=O?O(this.latestValues,""):"none";return}const z=this.getLead();if(!this.projectionDelta||!this.layout||!z.target){this.options.layoutId&&(E.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,E.pointerEvents=iw(s?.pointerEvents)||""),this.hasProjected&&!T_(this.latestValues)&&(E.transform=O?O({},""):"none",this.hasProjected=!1);return}E.visibility="";const j=z.animationValues||z.latestValues;this.applyTransformsToTarget();let H=eK(this.projectionDeltaWithTransform,this.treeScale,j);O&&(H=O(j,H)),E.transform=H;const{x:Y,y:ie}=this.projectionDelta;E.transformOrigin=`${Y.origin*100}% ${ie.origin*100}% 0`,z.animationValues?E.opacity=z===this?j.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:j.opacityExit:E.opacity=z===this?j.opacity!==void 0?j.opacity:"":j.opacityExit!==void 0?j.opacityExit:0;for(const oe in O0){if(j[oe]===void 0)continue;const{correct:ee,applyTo:le,isCSSVariable:ge}=O0[oe],pe=H==="none"?j[oe]:ee(j[oe],z);if(le){const _e=le.length;for(let Re=0;Re<_e;Re++)E[le[Re]]=pe}else ge?this.options.visualElement.renderState.vars[oe]=pe:E[oe]=pe}this.options.layoutId&&(E.pointerEvents=z===this?iw(s?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(E=>E.currentAnimation?.stop()),this.root.nodes.forEach(GP),this.root.sharedNodes.clear()}}}function iK(t){t.updateLayout()}function rK(t){const i=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&i&&t.hasListeners("didUpdate")){const{layoutBox:c,measuredBox:d}=t.layout,{animationType:y}=t.options,w=i.source!==t.layout.source;y==="size"?Hu(j=>{const H=w?i.measuredBox[j]:i.layoutBox[j],Y=ec(H);H.min=c[j].min,H.max=H.min+Y}):h3(y,i.layoutBox,c)&&Hu(j=>{const H=w?i.measuredBox[j]:i.layoutBox[j],Y=ec(c[j]);H.max=H.min+Y,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[j].max=t.relativeTarget[j].min+Y)});const E=px();_0(E,c,i.layoutBox);const s=px();w?_0(s,t.applyTransform(d,!0),i.measuredBox):_0(s,c,i.layoutBox);const O=!l3(E);let z=!1;if(!t.resumeFrom){const j=t.getClosestProjectingParent();if(j&&!j.resumeFrom){const{snapshot:H,layout:Y}=j;if(H&&Y){const ie=Yo();y0(ie,i.layoutBox,H.layoutBox);const oe=Yo();y0(oe,c,Y.layoutBox),c3(ie,oe)||(z=!0),j.options.layoutRoot&&(t.relativeTarget=oe,t.relativeTargetOrigin=ie,t.relativeParent=j)}}}t.notifyListeners("didUpdate",{layout:c,snapshot:i,delta:s,layoutDelta:E,hasLayoutChanged:O,hasRelativeLayoutChanged:z})}else if(t.isLead()){const{onExitComplete:c}=t.options;c&&c()}t.options.transition=void 0}function sK(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function oK(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function aK(t){t.clearSnapshot()}function GP(t){t.clearMeasurements()}function HP(t){t.isLayoutDirty=!1}function lK(t){const{visualElement:i}=t.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),t.resetTransform()}function qP(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function cK(t){t.resolveTargetDelta()}function uK(t){t.calcProjection()}function dK(t){t.resetSkewAndRotation()}function hK(t){t.removeLeadSnapshot()}function ZP(t,i,c){t.translate=Ro(i.translate,0,c),t.scale=Ro(i.scale,1,c),t.origin=i.origin,t.originPoint=i.originPoint}function WP(t,i,c,d){t.min=Ro(i.min,c.min,d),t.max=Ro(i.max,c.max,d)}function fK(t,i,c,d){WP(t.x,i.x,c.x,d),WP(t.y,i.y,c.y,d)}function pK(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const mK={duration:.45,ease:[.4,0,.1,1]},XP=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),KP=XP("applewebkit/")&&!XP("chrome/")?Math.round:Qu;function YP(t){t.min=KP(t.min),t.max=KP(t.max)}function gK(t){YP(t.x),YP(t.y)}function h3(t,i,c){return t==="position"||t==="preserve-aspect"&&!wX(UP(i),UP(c),.2)}function _K(t){return t!==t.root&&t.scroll?.wasRoot}const yK=d3({attachResizeListener:(t,i)=>z0(t,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),d2={current:void 0},f3=d3({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!d2.current){const t=new yK({});t.mount(window),t.setOptions({layoutScroll:!0}),d2.current=t}return d2.current},resetTransform:(t,i)=>{t.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),xK={pan:{Feature:kX},drag:{Feature:NX,ProjectionNode:f3,MeasureLayout:s3}};function QP(t,i,c){const{props:d}=t;t.animationState&&d.whileHover&&t.animationState.setActive("whileHover",c==="Start");const y="onHover"+c,w=d[y];w&&xo.postRender(()=>w(i,ib(i)))}class vK extends cg{mount(){const{current:i}=this.node;i&&(this.unmount=VZ(i,(c,d)=>(QP(this.node,d,"Start"),y=>QP(this.node,y,"End"))))}unmount(){}}class bK extends cg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=eb(z0(this.node.current,"focus",()=>this.onFocus()),z0(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function JP(t,i,c){const{props:d}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&d.whileTap&&t.animationState.setActive("whileTap",c==="Start");const y="onTap"+(c==="End"?"":c),w=d[y];w&&xo.postRender(()=>w(i,ib(i)))}class wK extends cg{mount(){const{current:i}=this.node;i&&(this.unmount=HZ(i,(c,d)=>(JP(this.node,d,"Start"),(y,{success:w})=>JP(this.node,y,w?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const wE=new WeakMap,h2=new WeakMap,SK=t=>{const i=wE.get(t.target);i&&i(t)},TK=t=>{t.forEach(SK)};function EK({root:t,...i}){const c=t||document;h2.has(c)||h2.set(c,{});const d=h2.get(c),y=JSON.stringify(i);return d[y]||(d[y]=new IntersectionObserver(TK,{root:t,...i})),d[y]}function AK(t,i,c){const d=EK(i);return wE.set(t,c),d.observe(t),()=>{wE.delete(t),d.unobserve(t)}}const CK={some:0,all:1};class RK extends cg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:c,margin:d,amount:y="some",once:w}=i,E={root:c?c.current:void 0,rootMargin:d,threshold:typeof y=="number"?y:CK[y]},s=O=>{const{isIntersecting:z}=O;if(this.isInView===z||(this.isInView=z,w&&!z&&this.hasEnteredView))return;z&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",z);const{onViewportEnter:j,onViewportLeave:H}=this.node.getProps(),Y=z?j:H;Y&&Y(O)};return AK(this.node.current,E,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:c}=this.node;["amount","margin","root"].some(MK(i,c))&&this.startObserver()}unmount(){}}function MK({viewport:t={}},{viewport:i={}}={}){return c=>t[c]!==i[c]}const IK={inView:{Feature:RK},tap:{Feature:wK},focus:{Feature:bK},hover:{Feature:vK}},DK={layout:{ProjectionNode:f3,MeasureLayout:s3}},PK={...gX,...IK,...xK,...DK},_o=PW(PK,HW);var rb=t=>t.type==="checkbox",P_=t=>t instanceof Date,Dc=t=>t==null;const p3=t=>typeof t=="object";var pa=t=>!Dc(t)&&!Array.isArray(t)&&p3(t)&&!P_(t),OK=t=>pa(t)&&t.target?rb(t.target)?t.target.checked:t.target.value:t,zK=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,LK=(t,i)=>t.has(zK(i)),NK=t=>{const i=t.constructor&&t.constructor.prototype;return pa(i)&&i.hasOwnProperty("isPrototypeOf")},YA=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ha(t){let i;const c=Array.isArray(t),d=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)i=new Date(t);else if(!(YA&&(t instanceof Blob||d))&&(c||pa(t)))if(i=c?[]:Object.create(Object.getPrototypeOf(t)),!c&&!NK(t))i=t;else for(const y in t)t.hasOwnProperty(y)&&(i[y]=Ha(t[y]));else return t;return i}var aS=t=>/^\w*$/.test(t),Qo=t=>t===void 0,QA=t=>Array.isArray(t)?t.filter(Boolean):[],JA=t=>QA(t.replace(/["|']|\]/g,"").split(/\.|\[/)),wi=(t,i,c)=>{if(!i||!pa(t))return c;const d=(aS(i)?[i]:JA(i)).reduce((y,w)=>Dc(y)?y:y[w],t);return Qo(d)||d===t?Qo(t[i])?c:t[i]:d},mf=t=>typeof t=="boolean",Ws=(t,i,c)=>{let d=-1;const y=aS(i)?[i]:JA(i),w=y.length,E=w-1;for(;++d<w;){const s=y[d];let O=c;if(d!==E){const z=t[s];O=pa(z)||Array.isArray(z)?z:isNaN(+y[d+1])?{}:[]}if(s==="__proto__"||s==="constructor"||s==="prototype")return;t[s]=O,t=t[s]}};const eO={BLUR:"blur",FOCUS_OUT:"focusout"},sh={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Dp={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},kK=vr.createContext(null);kK.displayName="HookFormContext";var jK=(t,i,c,d=!0)=>{const y={defaultValues:i._defaultValues};for(const w in t)Object.defineProperty(y,w,{get:()=>{const E=w;return i._proxyFormState[E]!==sh.all&&(i._proxyFormState[E]=!d||sh.all),t[E]}});return y};const FK=typeof window<"u"?vr.useLayoutEffect:vr.useEffect;var du=t=>typeof t=="string",BK=(t,i,c,d,y)=>du(t)?(d&&i.watch.add(t),wi(c,t,y)):Array.isArray(t)?t.map(w=>(d&&i.watch.add(w),wi(c,w))):(d&&(i.watchAll=!0),c),SE=t=>Dc(t)||!p3(t);function tg(t,i,c=new WeakSet){if(SE(t)||SE(i))return Object.is(t,i);if(P_(t)&&P_(i))return t.getTime()===i.getTime();const d=Object.keys(t),y=Object.keys(i);if(d.length!==y.length)return!1;if(c.has(t)||c.has(i))return!0;c.add(t),c.add(i);for(const w of d){const E=t[w];if(!y.includes(w))return!1;if(w!=="ref"){const s=i[w];if(P_(E)&&P_(s)||pa(E)&&pa(s)||Array.isArray(E)&&Array.isArray(s)?!tg(E,s,c):!Object.is(E,s))return!1}}return!0}var eC=(t,i,c,d,y)=>i?{...c[t],types:{...c[t]&&c[t].types?c[t].types:{},[d]:y||!0}}:{},x0=t=>Array.isArray(t)?t:[t],tO=()=>{let t=[];return{get observers(){return t},next:y=>{for(const w of t)w.next&&w.next(y)},subscribe:y=>(t.push(y),{unsubscribe:()=>{t=t.filter(w=>w!==y)}}),unsubscribe:()=>{t=[]}}};function m3(t,i){const c={};for(const d in t)if(t.hasOwnProperty(d)){const y=t[d],w=i[d];if(y&&pa(y)&&w){const E=m3(y,w);pa(E)&&(c[d]=E)}else t[d]&&(c[d]=w)}return c}var Ql=t=>pa(t)&&!Object.keys(t).length,tC=t=>t.type==="file",oh=t=>typeof t=="function",Aw=t=>{if(!YA)return!1;const i=t?t.ownerDocument:0;return t instanceof(i&&i.defaultView?i.defaultView.HTMLElement:HTMLElement)},g3=t=>t.type==="select-multiple",nC=t=>t.type==="radio",VK=t=>nC(t)||rb(t),f2=t=>Aw(t)&&t.isConnected;function UK(t,i){const c=i.slice(0,-1).length;let d=0;for(;d<c;)t=Qo(t)?d++:t[i[d++]];return t}function $K(t){for(const i in t)if(t.hasOwnProperty(i)&&!Qo(t[i]))return!1;return!0}function ha(t,i){const c=Array.isArray(i)?i:aS(i)?[i]:JA(i),d=c.length===1?t:UK(t,c),y=c.length-1,w=c[y];return d&&delete d[w],y!==0&&(pa(d)&&Ql(d)||Array.isArray(d)&&$K(d))&&ha(t,c.slice(0,-1)),t}var GK=t=>{for(const i in t)if(oh(t[i]))return!0;return!1};function _3(t){return Array.isArray(t)||pa(t)&&!GK(t)}function TE(t,i={}){for(const c in t){const d=t[c];_3(d)?(i[c]=Array.isArray(d)?[]:{},TE(d,i[c])):Qo(d)||(i[c]=!0)}return i}function ox(t,i,c){c||(c=TE(i));for(const d in t){const y=t[d];if(_3(y))Qo(i)||SE(c[d])?c[d]=TE(y,Array.isArray(y)?[]:{}):ox(y,Dc(i)?{}:i[d],c[d]);else{const w=i[d];c[d]=!tg(y,w)}}return c}const nO={value:!1,isValid:!1},iO={value:!0,isValid:!0};var y3=t=>{if(Array.isArray(t)){if(t.length>1){const i=t.filter(c=>c&&c.checked&&!c.disabled).map(c=>c.value);return{value:i,isValid:!!i.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Qo(t[0].attributes.value)?Qo(t[0].value)||t[0].value===""?iO:{value:t[0].value,isValid:!0}:iO:nO}return nO},x3=(t,{valueAsNumber:i,valueAsDate:c,setValueAs:d})=>Qo(t)?t:i?t===""?NaN:t&&+t:c&&du(t)?new Date(t):d?d(t):t;const rO={isValid:!1,value:null};var v3=t=>Array.isArray(t)?t.reduce((i,c)=>c&&c.checked&&!c.disabled?{isValid:!0,value:c.value}:i,rO):rO;function sO(t){const i=t.ref;return tC(i)?i.files:nC(i)?v3(t.refs).value:g3(i)?[...i.selectedOptions].map(({value:c})=>c):rb(i)?y3(t.refs).value:x3(Qo(i.value)?t.ref.value:i.value,t)}var HK=(t,i,c,d)=>{const y={};for(const w of t){const E=wi(i,w);E&&Ws(y,w,E._f)}return{criteriaMode:c,names:[...t],fields:y,shouldUseNativeValidation:d}},Cw=t=>t instanceof RegExp,a0=t=>Qo(t)?t:Cw(t)?t.source:pa(t)?Cw(t.value)?t.value.source:t.value:t,oO=t=>({isOnSubmit:!t||t===sh.onSubmit,isOnBlur:t===sh.onBlur,isOnChange:t===sh.onChange,isOnAll:t===sh.all,isOnTouch:t===sh.onTouched});const aO="AsyncFunction";var qK=t=>!!t&&!!t.validate&&!!(oh(t.validate)&&t.validate.constructor.name===aO||pa(t.validate)&&Object.values(t.validate).find(i=>i.constructor.name===aO)),ZK=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),lO=(t,i,c)=>!c&&(i.watchAll||i.watch.has(t)||[...i.watch].some(d=>t.startsWith(d)&&/^\.\w+/.test(t.slice(d.length))));const v0=(t,i,c,d)=>{for(const y of c||Object.keys(t)){const w=wi(t,y);if(w){const{_f:E,...s}=w;if(E){if(E.refs&&E.refs[0]&&i(E.refs[0],y)&&!d)return!0;if(E.ref&&i(E.ref,E.name)&&!d)return!0;if(v0(s,i))break}else if(pa(s)&&v0(s,i))break}}};function cO(t,i,c){const d=wi(t,c);if(d||aS(c))return{error:d,name:c};const y=c.split(".");for(;y.length;){const w=y.join("."),E=wi(i,w),s=wi(t,w);if(E&&!Array.isArray(E)&&c!==w)return{name:c};if(s&&s.type)return{name:w,error:s};if(s&&s.root&&s.root.type)return{name:`${w}.root`,error:s.root};y.pop()}return{name:c}}var WK=(t,i,c,d)=>{c(t);const{name:y,...w}=t;return Ql(w)||Object.keys(w).length>=Object.keys(i).length||Object.keys(w).find(E=>i[E]===(!d||sh.all))},XK=(t,i,c)=>!t||!i||t===i||x0(t).some(d=>d&&(c?d===i:d.startsWith(i)||i.startsWith(d))),KK=(t,i,c,d,y)=>y.isOnAll?!1:!c&&y.isOnTouch?!(i||t):(c?d.isOnBlur:y.isOnBlur)?!t:(c?d.isOnChange:y.isOnChange)?t:!0,YK=(t,i)=>!QA(wi(t,i)).length&&ha(t,i),QK=(t,i,c)=>{const d=x0(wi(t,c));return Ws(d,"root",i[c]),Ws(t,c,d),t};function uO(t,i,c="validate"){if(du(t)||Array.isArray(t)&&t.every(du)||mf(t)&&!t)return{type:c,message:du(t)?t:"",ref:i}}var tx=t=>pa(t)&&!Cw(t)?t:{value:t,message:""},dO=async(t,i,c,d,y,w)=>{const{ref:E,refs:s,required:O,maxLength:z,minLength:j,min:H,max:Y,pattern:ie,validate:oe,name:ee,valueAsNumber:le,mount:ge}=t._f,pe=wi(c,ee);if(!ge||i.has(ee))return{};const _e=s?s[0]:E,Re=$t=>{y&&_e.reportValidity&&(_e.setCustomValidity(mf($t)?"":$t||""),_e.reportValidity())},xe={},Ze=nC(E),Le=rb(E),$e=Ze||Le,st=(le||tC(E))&&Qo(E.value)&&Qo(pe)||Aw(E)&&E.value===""||pe===""||Array.isArray(pe)&&!pe.length,Et=eC.bind(null,ee,d,xe),Ut=($t,tt,ut,on=Dp.maxLength,Ke=Dp.minLength)=>{const ze=$t?tt:ut;xe[ee]={type:$t?on:Ke,message:ze,ref:E,...Et($t?on:Ke,ze)}};if(w?!Array.isArray(pe)||!pe.length:O&&(!$e&&(st||Dc(pe))||mf(pe)&&!pe||Le&&!y3(s).isValid||Ze&&!v3(s).isValid)){const{value:$t,message:tt}=du(O)?{value:!!O,message:O}:tx(O);if($t&&(xe[ee]={type:Dp.required,message:tt,ref:_e,...Et(Dp.required,tt)},!d))return Re(tt),xe}if(!st&&(!Dc(H)||!Dc(Y))){let $t,tt;const ut=tx(Y),on=tx(H);if(!Dc(pe)&&!isNaN(pe)){const Ke=E.valueAsNumber||pe&&+pe;Dc(ut.value)||($t=Ke>ut.value),Dc(on.value)||(tt=Ke<on.value)}else{const Ke=E.valueAsDate||new Date(pe),ze=fn=>new Date(new Date().toDateString()+" "+fn),Fe=E.type=="time",kt=E.type=="week";du(ut.value)&&pe&&($t=Fe?ze(pe)>ze(ut.value):kt?pe>ut.value:Ke>new Date(ut.value)),du(on.value)&&pe&&(tt=Fe?ze(pe)<ze(on.value):kt?pe<on.value:Ke<new Date(on.value))}if(($t||tt)&&(Ut(!!$t,ut.message,on.message,Dp.max,Dp.min),!d))return Re(xe[ee].message),xe}if((z||j)&&!st&&(du(pe)||w&&Array.isArray(pe))){const $t=tx(z),tt=tx(j),ut=!Dc($t.value)&&pe.length>+$t.value,on=!Dc(tt.value)&&pe.length<+tt.value;if((ut||on)&&(Ut(ut,$t.message,tt.message),!d))return Re(xe[ee].message),xe}if(ie&&!st&&du(pe)){const{value:$t,message:tt}=tx(ie);if(Cw($t)&&!pe.match($t)&&(xe[ee]={type:Dp.pattern,message:tt,ref:E,...Et(Dp.pattern,tt)},!d))return Re(tt),xe}if(oe){if(oh(oe)){const $t=await oe(pe,c),tt=uO($t,_e);if(tt&&(xe[ee]={...tt,...Et(Dp.validate,tt.message)},!d))return Re(tt.message),xe}else if(pa(oe)){let $t={};for(const tt in oe){if(!Ql($t)&&!d)break;const ut=uO(await oe[tt](pe,c),_e,tt);ut&&($t={...ut,...Et(tt,ut.message)},Re(ut.message),d&&(xe[ee]=$t))}if(!Ql($t)&&(xe[ee]={ref:_e,...$t},!d))return xe}}return Re(!0),xe};const JK={mode:sh.onSubmit,reValidateMode:sh.onChange,shouldFocusError:!0};function eY(t={}){let i={...JK,...t},c={submitCount:0,isDirty:!1,isReady:!1,isLoading:oh(i.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:i.errors||{},disabled:i.disabled||!1},d={},y=pa(i.defaultValues)||pa(i.values)?Ha(i.defaultValues||i.values)||{}:{},w=i.shouldUnregister?{}:Ha(y),E={action:!1,mount:!1,watch:!1},s={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},O,z=0;const j={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let H={...j};const Y={array:tO(),state:tO()},ie=i.criteriaMode===sh.all,oe=et=>Ot=>{clearTimeout(z),z=setTimeout(et,Ot)},ee=async et=>{if(!i.disabled&&(j.isValid||H.isValid||et)){const Ot=i.resolver?Ql((await Le()).errors):await st(d,!0);Ot!==c.isValid&&Y.state.next({isValid:Ot})}},le=(et,Ot)=>{!i.disabled&&(j.isValidating||j.validatingFields||H.isValidating||H.validatingFields)&&((et||Array.from(s.mount)).forEach(nn=>{nn&&(Ot?Ws(c.validatingFields,nn,Ot):ha(c.validatingFields,nn))}),Y.state.next({validatingFields:c.validatingFields,isValidating:!Ql(c.validatingFields)}))},ge=(et,Ot=[],nn,Kn,yn=!0,Dn=!0)=>{if(Kn&&nn&&!i.disabled){if(E.action=!0,Dn&&Array.isArray(wi(d,et))){const ci=nn(wi(d,et),Kn.argA,Kn.argB);yn&&Ws(d,et,ci)}if(Dn&&Array.isArray(wi(c.errors,et))){const ci=nn(wi(c.errors,et),Kn.argA,Kn.argB);yn&&Ws(c.errors,et,ci),YK(c.errors,et)}if((j.touchedFields||H.touchedFields)&&Dn&&Array.isArray(wi(c.touchedFields,et))){const ci=nn(wi(c.touchedFields,et),Kn.argA,Kn.argB);yn&&Ws(c.touchedFields,et,ci)}(j.dirtyFields||H.dirtyFields)&&(c.dirtyFields=ox(y,w)),Y.state.next({name:et,isDirty:Ut(et,Ot),dirtyFields:c.dirtyFields,errors:c.errors,isValid:c.isValid})}else Ws(w,et,Ot)},pe=(et,Ot)=>{Ws(c.errors,et,Ot),Y.state.next({errors:c.errors})},_e=et=>{c.errors=et,Y.state.next({errors:c.errors,isValid:!1})},Re=(et,Ot,nn,Kn)=>{const yn=wi(d,et);if(yn){const Dn=wi(w,et,Qo(nn)?wi(y,et):nn);Qo(Dn)||Kn&&Kn.defaultChecked||Ot?Ws(w,et,Ot?Dn:sO(yn._f)):ut(et,Dn),E.mount&&!E.action&&ee()}},xe=(et,Ot,nn,Kn,yn)=>{let Dn=!1,ci=!1;const Yi={name:et};if(!i.disabled){if(!nn||Kn){(j.isDirty||H.isDirty)&&(ci=c.isDirty,c.isDirty=Yi.isDirty=Ut(),Dn=ci!==Yi.isDirty);const or=tg(wi(y,et),Ot);ci=!!wi(c.dirtyFields,et),or?ha(c.dirtyFields,et):Ws(c.dirtyFields,et,!0),Yi.dirtyFields=c.dirtyFields,Dn=Dn||(j.dirtyFields||H.dirtyFields)&&ci!==!or}if(nn){const or=wi(c.touchedFields,et);or||(Ws(c.touchedFields,et,nn),Yi.touchedFields=c.touchedFields,Dn=Dn||(j.touchedFields||H.touchedFields)&&or!==nn)}Dn&&yn&&Y.state.next(Yi)}return Dn?Yi:{}},Ze=(et,Ot,nn,Kn)=>{const yn=wi(c.errors,et),Dn=(j.isValid||H.isValid)&&mf(Ot)&&c.isValid!==Ot;if(i.delayError&&nn?(O=oe(()=>pe(et,nn)),O(i.delayError)):(clearTimeout(z),O=null,nn?Ws(c.errors,et,nn):ha(c.errors,et)),(nn?!tg(yn,nn):yn)||!Ql(Kn)||Dn){const ci={...Kn,...Dn&&mf(Ot)?{isValid:Ot}:{},errors:c.errors,name:et};c={...c,...ci},Y.state.next(ci)}},Le=async et=>{le(et,!0);const Ot=await i.resolver(w,i.context,HK(et||s.mount,d,i.criteriaMode,i.shouldUseNativeValidation));return le(et),Ot},$e=async et=>{const{errors:Ot}=await Le(et);if(et)for(const nn of et){const Kn=wi(Ot,nn);Kn?Ws(c.errors,nn,Kn):ha(c.errors,nn)}else c.errors=Ot;return Ot},st=async(et,Ot,nn={valid:!0})=>{for(const Kn in et){const yn=et[Kn];if(yn){const{_f:Dn,...ci}=yn;if(Dn){const Yi=s.array.has(Dn.name),or=yn._f&&qK(yn._f);or&&j.validatingFields&&le([Dn.name],!0);const Gr=await dO(yn,s.disabled,w,ie,i.shouldUseNativeValidation&&!Ot,Yi);if(or&&j.validatingFields&&le([Dn.name]),Gr[Dn.name]&&(nn.valid=!1,Ot))break;!Ot&&(wi(Gr,Dn.name)?Yi?QK(c.errors,Gr,Dn.name):Ws(c.errors,Dn.name,Gr[Dn.name]):ha(c.errors,Dn.name))}!Ql(ci)&&await st(ci,Ot,nn)}}return nn.valid},Et=()=>{for(const et of s.unMount){const Ot=wi(d,et);Ot&&(Ot._f.refs?Ot._f.refs.every(nn=>!f2(nn)):!f2(Ot._f.ref))&&Yt(et)}s.unMount=new Set},Ut=(et,Ot)=>!i.disabled&&(et&&Ot&&Ws(w,et,Ot),!tg(fn(),y)),$t=(et,Ot,nn)=>BK(et,s,{...E.mount?w:Qo(Ot)?y:du(et)?{[et]:Ot}:Ot},nn,Ot),tt=et=>QA(wi(E.mount?w:y,et,i.shouldUnregister?wi(y,et,[]):[])),ut=(et,Ot,nn={})=>{const Kn=wi(d,et);let yn=Ot;if(Kn){const Dn=Kn._f;Dn&&(!Dn.disabled&&Ws(w,et,x3(Ot,Dn)),yn=Aw(Dn.ref)&&Dc(Ot)?"":Ot,g3(Dn.ref)?[...Dn.ref.options].forEach(ci=>ci.selected=yn.includes(ci.value)):Dn.refs?rb(Dn.ref)?Dn.refs.forEach(ci=>{(!ci.defaultChecked||!ci.disabled)&&(Array.isArray(yn)?ci.checked=!!yn.find(Yi=>Yi===ci.value):ci.checked=yn===ci.value||!!yn)}):Dn.refs.forEach(ci=>ci.checked=ci.value===yn):tC(Dn.ref)?Dn.ref.value="":(Dn.ref.value=yn,Dn.ref.type||Y.state.next({name:et,values:Ha(w)})))}(nn.shouldDirty||nn.shouldTouch)&&xe(et,yn,nn.shouldTouch,nn.shouldDirty,!0),nn.shouldValidate&&kt(et)},on=(et,Ot,nn)=>{for(const Kn in Ot){if(!Ot.hasOwnProperty(Kn))return;const yn=Ot[Kn],Dn=et+"."+Kn,ci=wi(d,Dn);(s.array.has(et)||pa(yn)||ci&&!ci._f)&&!P_(yn)?on(Dn,yn,nn):ut(Dn,yn,nn)}},Ke=(et,Ot,nn={})=>{const Kn=wi(d,et),yn=s.array.has(et),Dn=Ha(Ot);Ws(w,et,Dn),yn?(Y.array.next({name:et,values:Ha(w)}),(j.isDirty||j.dirtyFields||H.isDirty||H.dirtyFields)&&nn.shouldDirty&&Y.state.next({name:et,dirtyFields:ox(y,w),isDirty:Ut(et,Dn)})):Kn&&!Kn._f&&!Dc(Dn)?on(et,Dn,nn):ut(et,Dn,nn),lO(et,s)&&Y.state.next({...c,name:et}),Y.state.next({name:E.mount?et:void 0,values:Ha(w)})},ze=async et=>{E.mount=!0;const Ot=et.target;let nn=Ot.name,Kn=!0;const yn=wi(d,nn),Dn=or=>{Kn=Number.isNaN(or)||P_(or)&&isNaN(or.getTime())||tg(or,wi(w,nn,or))},ci=oO(i.mode),Yi=oO(i.reValidateMode);if(yn){let or,Gr;const ea=Ot.type?sO(yn._f):OK(et),vs=et.type===eO.BLUR||et.type===eO.FOCUS_OUT,Ol=!ZK(yn._f)&&!i.resolver&&!wi(c.errors,nn)&&!yn._f.deps||KK(vs,wi(c.touchedFields,nn),c.isSubmitted,Yi,ci),ta=lO(nn,s,vs);Ws(w,nn,ea),vs?(!Ot||!Ot.readOnly)&&(yn._f.onBlur&&yn._f.onBlur(et),O&&O(0)):yn._f.onChange&&yn._f.onChange(et);const dr=xe(nn,ea,vs),lo=!Ql(dr)||ta;if(!vs&&Y.state.next({name:nn,type:et.type,values:Ha(w)}),Ol)return(j.isValid||H.isValid)&&(i.mode==="onBlur"?vs&&ee():vs||ee()),lo&&Y.state.next({name:nn,...ta?{}:dr});if(!vs&&ta&&Y.state.next({...c}),i.resolver){const{errors:Os}=await Le([nn]);if(Dn(ea),Kn){const Za=cO(c.errors,d,nn),Go=cO(Os,d,Za.name||nn);or=Go.error,nn=Go.name,Gr=Ql(Os)}}else le([nn],!0),or=(await dO(yn,s.disabled,w,ie,i.shouldUseNativeValidation))[nn],le([nn]),Dn(ea),Kn&&(or?Gr=!1:(j.isValid||H.isValid)&&(Gr=await st(d,!0)));Kn&&(yn._f.deps&&(!Array.isArray(yn._f.deps)||yn._f.deps.length>0)&&kt(yn._f.deps),Ze(nn,Gr,or,dr))}},Fe=(et,Ot)=>{if(wi(c.errors,Ot)&&et.focus)return et.focus(),1},kt=async(et,Ot={})=>{let nn,Kn;const yn=x0(et);if(i.resolver){const Dn=await $e(Qo(et)?et:yn);nn=Ql(Dn),Kn=et?!yn.some(ci=>wi(Dn,ci)):nn}else et?(Kn=(await Promise.all(yn.map(async Dn=>{const ci=wi(d,Dn);return await st(ci&&ci._f?{[Dn]:ci}:ci)}))).every(Boolean),!(!Kn&&!c.isValid)&&ee()):Kn=nn=await st(d);return Y.state.next({...!du(et)||(j.isValid||H.isValid)&&nn!==c.isValid?{}:{name:et},...i.resolver||!et?{isValid:nn}:{},errors:c.errors}),Ot.shouldFocus&&!Kn&&v0(d,Fe,et?yn:s.mount),Kn},fn=(et,Ot)=>{let nn={...E.mount?w:y};return Ot&&(nn=m3(Ot.dirtyFields?c.dirtyFields:c.touchedFields,nn)),Qo(et)?nn:du(et)?wi(nn,et):et.map(Kn=>wi(nn,Kn))},Me=(et,Ot)=>({invalid:!!wi((Ot||c).errors,et),isDirty:!!wi((Ot||c).dirtyFields,et),error:wi((Ot||c).errors,et),isValidating:!!wi(c.validatingFields,et),isTouched:!!wi((Ot||c).touchedFields,et)}),ct=et=>{et&&x0(et).forEach(Ot=>ha(c.errors,Ot)),Y.state.next({errors:et?c.errors:{}})},vt=(et,Ot,nn)=>{const Kn=(wi(d,et,{_f:{}})._f||{}).ref,yn=wi(c.errors,et)||{},{ref:Dn,message:ci,type:Yi,...or}=yn;Ws(c.errors,et,{...or,...Ot,ref:Kn}),Y.state.next({name:et,errors:c.errors,isValid:!1}),nn&&nn.shouldFocus&&Kn&&Kn.focus&&Kn.focus()},Kt=(et,Ot)=>oh(et)?Y.state.subscribe({next:nn=>"values"in nn&&et($t(void 0,Ot),nn)}):$t(et,Ot,!0),zn=et=>Y.state.subscribe({next:Ot=>{XK(et.name,Ot.name,et.exact)&&WK(Ot,et.formState||j,jn,et.reRenderRoot)&&et.callback({values:{...w},...c,...Ot,defaultValues:y})}}).unsubscribe,Nn=et=>(E.mount=!0,H={...H,...et.formState},zn({...et,formState:H})),Yt=(et,Ot={})=>{for(const nn of et?x0(et):s.mount)s.mount.delete(nn),s.array.delete(nn),Ot.keepValue||(ha(d,nn),ha(w,nn)),!Ot.keepError&&ha(c.errors,nn),!Ot.keepDirty&&ha(c.dirtyFields,nn),!Ot.keepTouched&&ha(c.touchedFields,nn),!Ot.keepIsValidating&&ha(c.validatingFields,nn),!i.shouldUnregister&&!Ot.keepDefaultValue&&ha(y,nn);Y.state.next({values:Ha(w)}),Y.state.next({...c,...Ot.keepDirty?{isDirty:Ut()}:{}}),!Ot.keepIsValid&&ee()},On=({disabled:et,name:Ot})=>{(mf(et)&&E.mount||et||s.disabled.has(Ot))&&(et?s.disabled.add(Ot):s.disabled.delete(Ot))},An=(et,Ot={})=>{let nn=wi(d,et);const Kn=mf(Ot.disabled)||mf(i.disabled);return Ws(d,et,{...nn||{},_f:{...nn&&nn._f?nn._f:{ref:{name:et}},name:et,mount:!0,...Ot}}),s.mount.add(et),nn?On({disabled:mf(Ot.disabled)?Ot.disabled:i.disabled,name:et}):Re(et,!0,Ot.value),{...Kn?{disabled:Ot.disabled||i.disabled}:{},...i.progressive?{required:!!Ot.required,min:a0(Ot.min),max:a0(Ot.max),minLength:a0(Ot.minLength),maxLength:a0(Ot.maxLength),pattern:a0(Ot.pattern)}:{},name:et,onChange:ze,onBlur:ze,ref:yn=>{if(yn){An(et,Ot),nn=wi(d,et);const Dn=Qo(yn.value)&&yn.querySelectorAll&&yn.querySelectorAll("input,select,textarea")[0]||yn,ci=VK(Dn),Yi=nn._f.refs||[];if(ci?Yi.find(or=>or===Dn):Dn===nn._f.ref)return;Ws(d,et,{_f:{...nn._f,...ci?{refs:[...Yi.filter(f2),Dn,...Array.isArray(wi(y,et))?[{}]:[]],ref:{type:Dn.type,name:et}}:{ref:Dn}}}),Re(et,!1,void 0,Dn)}else nn=wi(d,et,{}),nn._f&&(nn._f.mount=!1),(i.shouldUnregister||Ot.shouldUnregister)&&!(LK(s.array,et)&&E.action)&&s.unMount.add(et)}}},In=()=>i.shouldFocusError&&v0(d,Fe,s.mount),gi=et=>{mf(et)&&(Y.state.next({disabled:et}),v0(d,(Ot,nn)=>{const Kn=wi(d,nn);Kn&&(Ot.disabled=Kn._f.disabled||et,Array.isArray(Kn._f.refs)&&Kn._f.refs.forEach(yn=>{yn.disabled=Kn._f.disabled||et}))},0,!1))},ji=(et,Ot)=>async nn=>{let Kn;nn&&(nn.preventDefault&&nn.preventDefault(),nn.persist&&nn.persist());let yn=Ha(w);if(Y.state.next({isSubmitting:!0}),i.resolver){const{errors:Dn,values:ci}=await Le();c.errors=Dn,yn=Ha(ci)}else await st(d);if(s.disabled.size)for(const Dn of s.disabled)ha(yn,Dn);if(ha(c.errors,"root"),Ql(c.errors)){Y.state.next({errors:{}});try{await et(yn,nn)}catch(Dn){Kn=Dn}}else Ot&&await Ot({...c.errors},nn),In(),setTimeout(In);if(Y.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ql(c.errors)&&!Kn,submitCount:c.submitCount+1,errors:c.errors}),Kn)throw Kn},Ri=(et,Ot={})=>{wi(d,et)&&(Qo(Ot.defaultValue)?Ke(et,Ha(wi(y,et))):(Ke(et,Ot.defaultValue),Ws(y,et,Ha(Ot.defaultValue))),Ot.keepTouched||ha(c.touchedFields,et),Ot.keepDirty||(ha(c.dirtyFields,et),c.isDirty=Ot.defaultValue?Ut(et,Ha(wi(y,et))):Ut()),Ot.keepError||(ha(c.errors,et),j.isValid&&ee()),Y.state.next({...c}))},Rr=(et,Ot={})=>{const nn=et?Ha(et):y,Kn=Ha(nn),yn=Ql(et),Dn=yn?y:Kn;if(Ot.keepDefaultValues||(y=nn),!Ot.keepValues){if(Ot.keepDirtyValues){const ci=new Set([...s.mount,...Object.keys(ox(y,w))]);for(const Yi of Array.from(ci))wi(c.dirtyFields,Yi)?Ws(Dn,Yi,wi(w,Yi)):Ke(Yi,wi(Dn,Yi))}else{if(YA&&Qo(et))for(const ci of s.mount){const Yi=wi(d,ci);if(Yi&&Yi._f){const or=Array.isArray(Yi._f.refs)?Yi._f.refs[0]:Yi._f.ref;if(Aw(or)){const Gr=or.closest("form");if(Gr){Gr.reset();break}}}}if(Ot.keepFieldsRef)for(const ci of s.mount)Ke(ci,wi(Dn,ci));else d={}}w=i.shouldUnregister?Ot.keepDefaultValues?Ha(y):{}:Ha(Dn),Y.array.next({values:{...Dn}}),Y.state.next({values:{...Dn}})}s={mount:Ot.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},E.mount=!j.isValid||!!Ot.keepIsValid||!!Ot.keepDirtyValues||!i.shouldUnregister&&!Ql(Dn),E.watch=!!i.shouldUnregister,Y.state.next({submitCount:Ot.keepSubmitCount?c.submitCount:0,isDirty:yn?!1:Ot.keepDirty?c.isDirty:!!(Ot.keepDefaultValues&&!tg(et,y)),isSubmitted:Ot.keepIsSubmitted?c.isSubmitted:!1,dirtyFields:yn?{}:Ot.keepDirtyValues?Ot.keepDefaultValues&&w?ox(y,w):c.dirtyFields:Ot.keepDefaultValues&&et?ox(y,et):Ot.keepDirty?c.dirtyFields:{},touchedFields:Ot.keepTouched?c.touchedFields:{},errors:Ot.keepErrors?c.errors:{},isSubmitSuccessful:Ot.keepIsSubmitSuccessful?c.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:y})},cs=(et,Ot)=>Rr(oh(et)?et(w):et,Ot),wr=(et,Ot={})=>{const nn=wi(d,et),Kn=nn&&nn._f;if(Kn){const yn=Kn.refs?Kn.refs[0]:Kn.ref;yn.focus&&(yn.focus(),Ot.shouldSelect&&oh(yn.select)&&yn.select())}},jn=et=>{c={...c,...et}},rr={control:{register:An,unregister:Yt,getFieldState:Me,handleSubmit:ji,setError:vt,_subscribe:zn,_runSchema:Le,_focusError:In,_getWatch:$t,_getDirty:Ut,_setValid:ee,_setFieldArray:ge,_setDisabledField:On,_setErrors:_e,_getFieldArray:tt,_reset:Rr,_resetDefaultValues:()=>oh(i.defaultValues)&&i.defaultValues().then(et=>{cs(et,i.resetOptions),Y.state.next({isLoading:!1})}),_removeUnmounted:Et,_disableForm:gi,_subjects:Y,_proxyFormState:j,get _fields(){return d},get _formValues(){return w},get _state(){return E},set _state(et){E=et},get _defaultValues(){return y},get _names(){return s},set _names(et){s=et},get _formState(){return c},get _options(){return i},set _options(et){i={...i,...et}}},subscribe:Nn,trigger:kt,register:An,handleSubmit:ji,watch:Kt,setValue:Ke,getValues:fn,reset:cs,resetField:Ri,clearErrors:ct,unregister:Yt,setError:vt,setFocus:wr,getFieldState:Me};return{...rr,formControl:rr}}function ug(t={}){const i=vr.useRef(void 0),c=vr.useRef(void 0),[d,y]=vr.useState({isDirty:!1,isValidating:!1,isLoading:oh(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,isReady:!1,defaultValues:oh(t.defaultValues)?void 0:t.defaultValues});if(!i.current)if(t.formControl)i.current={...t.formControl,formState:d},t.defaultValues&&!oh(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions);else{const{formControl:E,...s}=eY(t);i.current={...s,formState:d}}const w=i.current.control;return w._options=t,FK(()=>{const E=w._subscribe({formState:w._proxyFormState,callback:()=>y({...w._formState}),reRenderRoot:!0});return y(s=>({...s,isReady:!0})),w._formState.isReady=!0,E},[w]),vr.useEffect(()=>w._disableForm(t.disabled),[w,t.disabled]),vr.useEffect(()=>{t.mode&&(w._options.mode=t.mode),t.reValidateMode&&(w._options.reValidateMode=t.reValidateMode)},[w,t.mode,t.reValidateMode]),vr.useEffect(()=>{t.errors&&(w._setErrors(t.errors),w._focusError())},[w,t.errors]),vr.useEffect(()=>{t.shouldUnregister&&w._subjects.state.next({values:w._getWatch()})},[w,t.shouldUnregister]),vr.useEffect(()=>{if(w._proxyFormState.isDirty){const E=w._getDirty();E!==d.isDirty&&w._subjects.state.next({isDirty:E})}},[w,d.isDirty]),vr.useEffect(()=>{var E;t.values&&!tg(t.values,c.current)?(w._reset(t.values,{keepFieldsRef:!0,...w._options.resetOptions}),!((E=w._options.resetOptions)===null||E===void 0)&&E.keepIsValid||w._setValid(),c.current=t.values,y(s=>({...s}))):w._resetDefaultValues()},[w,t.values]),vr.useEffect(()=>{w._state.mount||(w._setValid(),w._state.mount=!0),w._state.watch&&(w._state.watch=!1,w._subjects.state.next({...w._formState})),w._removeUnmounted()}),i.current.formState=jK(d,w),i.current}const hO=(t,i,c)=>{if(t&&"reportValidity"in t){const d=wi(c,i);t.setCustomValidity(d&&d.message||""),t.reportValidity()}},EE=(t,i)=>{for(const c in i.fields){const d=i.fields[c];d&&d.ref&&"reportValidity"in d.ref?hO(d.ref,c,t):d&&d.refs&&d.refs.forEach(y=>hO(y,c,t))}},fO=(t,i)=>{i.shouldUseNativeValidation&&EE(t,i);const c={};for(const d in t){const y=wi(i.fields,d),w=Object.assign(t[d]||{},{ref:y&&y.ref});if(tY(i.names||Object.keys(t),d)){const E=Object.assign({},wi(c,d));Ws(E,"root",w),Ws(c,d,E)}else Ws(c,d,w)}return c},tY=(t,i)=>{const c=pO(i);return t.some(d=>pO(d).match(`^${c}\\.\\d+`))};function pO(t){return t.replace(/\]|\[/g,"")}function En(t,i,c){function d(s,O){if(s._zod||Object.defineProperty(s,"_zod",{value:{def:O,constr:E,traits:new Set},enumerable:!1}),s._zod.traits.has(t))return;s._zod.traits.add(t),i(s,O);const z=E.prototype,j=Object.keys(z);for(let H=0;H<j.length;H++){const Y=j[H];Y in s||(s[Y]=z[Y].bind(s))}}const y=c?.Parent??Object;class w extends y{}Object.defineProperty(w,"name",{value:t});function E(s){var O;const z=c?.Parent?new w:this;d(z,s),(O=z._zod).deferred??(O.deferred=[]);for(const j of z._zod.deferred)j();return z}return Object.defineProperty(E,"init",{value:d}),Object.defineProperty(E,Symbol.hasInstance,{value:s=>c?.Parent&&s instanceof c.Parent?!0:s?._zod?.traits?.has(t)}),Object.defineProperty(E,"name",{value:t}),E}class _x extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class b3 extends Error{constructor(i){super(`Encountered unidirectional transform during encode: ${i}`),this.name="ZodEncodeError"}}const w3={};function $_(t){return w3}function nY(t){const i=Object.values(t).filter(d=>typeof d=="number");return Object.entries(t).filter(([d,y])=>i.indexOf(+d)===-1).map(([d,y])=>y)}function AE(t,i){return typeof i=="bigint"?i.toString():i}function iC(t){return{get value(){{const i=t();return Object.defineProperty(this,"value",{value:i}),i}}}}function rC(t){return t==null}function sC(t){const i=t.startsWith("^")?1:0,c=t.endsWith("$")?t.length-1:t.length;return t.slice(i,c)}function iY(t,i){const c=(t.toString().split(".")[1]||"").length,d=i.toString();let y=(d.split(".")[1]||"").length;if(y===0&&/\d?e-\d?/.test(d)){const O=d.match(/\d?e-(\d?)/);O?.[1]&&(y=Number.parseInt(O[1]))}const w=c>y?c:y,E=Number.parseInt(t.toFixed(w).replace(".","")),s=Number.parseInt(i.toFixed(w).replace(".",""));return E%s/10**w}const mO=Symbol("evaluating");function no(t,i,c){let d;Object.defineProperty(t,i,{get(){if(d!==mO)return d===void 0&&(d=mO,d=c()),d},set(y){Object.defineProperty(t,i,{value:y})},configurable:!0})}function Q_(t,i,c){Object.defineProperty(t,i,{value:c,writable:!0,enumerable:!0,configurable:!0})}function J_(...t){const i={};for(const c of t){const d=Object.getOwnPropertyDescriptors(c);Object.assign(i,d)}return Object.defineProperties({},i)}function gO(t){return JSON.stringify(t)}function rY(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const S3="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function Rw(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const sY=iC(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function L0(t){if(Rw(t)===!1)return!1;const i=t.constructor;if(i===void 0||typeof i!="function")return!0;const c=i.prototype;return!(Rw(c)===!1||Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")===!1)}function T3(t){return L0(t)?{...t}:Array.isArray(t)?[...t]:t}const oY=new Set(["string","number","symbol"]);function lS(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function dg(t,i,c){const d=new t._zod.constr(i??t._zod.def);return(!i||c?.parent)&&(d._zod.parent=t),d}function Wi(t){const i=t;if(!i)return{};if(typeof i=="string")return{error:()=>i};if(i?.message!==void 0){if(i?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");i.error=i.message}return delete i.message,typeof i.error=="string"?{...i,error:()=>i.error}:i}function aY(t){return Object.keys(t).filter(i=>t[i]._zod.optin==="optional"&&t[i]._zod.optout==="optional")}const lY={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function cY(t,i){const c=t._zod.def,d=J_(t._zod.def,{get shape(){const y={};for(const w in i){if(!(w in c.shape))throw new Error(`Unrecognized key: "${w}"`);i[w]&&(y[w]=c.shape[w])}return Q_(this,"shape",y),y},checks:[]});return dg(t,d)}function uY(t,i){const c=t._zod.def,d=J_(t._zod.def,{get shape(){const y={...t._zod.def.shape};for(const w in i){if(!(w in c.shape))throw new Error(`Unrecognized key: "${w}"`);i[w]&&delete y[w]}return Q_(this,"shape",y),y},checks:[]});return dg(t,d)}function dY(t,i){if(!L0(i))throw new Error("Invalid input to extend: expected a plain object");const c=t._zod.def.checks;if(c&&c.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const y=J_(t._zod.def,{get shape(){const w={...t._zod.def.shape,...i};return Q_(this,"shape",w),w},checks:[]});return dg(t,y)}function hY(t,i){if(!L0(i))throw new Error("Invalid input to safeExtend: expected a plain object");const c={...t._zod.def,get shape(){const d={...t._zod.def.shape,...i};return Q_(this,"shape",d),d},checks:t._zod.def.checks};return dg(t,c)}function fY(t,i){const c=J_(t._zod.def,{get shape(){const d={...t._zod.def.shape,...i._zod.def.shape};return Q_(this,"shape",d),d},get catchall(){return i._zod.def.catchall},checks:[]});return dg(t,c)}function pY(t,i,c){const d=J_(i._zod.def,{get shape(){const y=i._zod.def.shape,w={...y};if(c)for(const E in c){if(!(E in y))throw new Error(`Unrecognized key: "${E}"`);c[E]&&(w[E]=t?new t({type:"optional",innerType:y[E]}):y[E])}else for(const E in y)w[E]=t?new t({type:"optional",innerType:y[E]}):y[E];return Q_(this,"shape",w),w},checks:[]});return dg(i,d)}function mY(t,i,c){const d=J_(i._zod.def,{get shape(){const y=i._zod.def.shape,w={...y};if(c)for(const E in c){if(!(E in w))throw new Error(`Unrecognized key: "${E}"`);c[E]&&(w[E]=new t({type:"nonoptional",innerType:y[E]}))}else for(const E in y)w[E]=new t({type:"nonoptional",innerType:y[E]});return Q_(this,"shape",w),w},checks:[]});return dg(i,d)}function mx(t,i=0){if(t.aborted===!0)return!0;for(let c=i;c<t.issues.length;c++)if(t.issues[c]?.continue!==!0)return!0;return!1}function E3(t,i){return i.map(c=>{var d;return(d=c).path??(d.path=[]),c.path.unshift(t),c})}function O1(t){return typeof t=="string"?t:t?.message}function G_(t,i,c){const d={...t,path:t.path??[]};if(!t.message){const y=O1(t.inst?._zod.def?.error?.(t))??O1(i?.error?.(t))??O1(c.customError?.(t))??O1(c.localeError?.(t))??"Invalid input";d.message=y}return delete d.inst,delete d.continue,i?.reportInput||delete d.input,d}function oC(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function N0(...t){const[i,c,d]=t;return typeof i=="string"?{message:i,code:"custom",input:c,inst:d}:{...i}}const A3=(t,i)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:i,enumerable:!1}),t.message=JSON.stringify(i,AE,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},aC=En("$ZodError",A3),cS=En("$ZodError",A3,{Parent:Error});function gY(t,i=c=>c.message){const c={},d=[];for(const y of t.issues)y.path.length>0?(c[y.path[0]]=c[y.path[0]]||[],c[y.path[0]].push(i(y))):d.push(i(y));return{formErrors:d,fieldErrors:c}}function _Y(t,i=c=>c.message){const c={_errors:[]},d=y=>{for(const w of y.issues)if(w.code==="invalid_union"&&w.errors.length)w.errors.map(E=>d({issues:E}));else if(w.code==="invalid_key")d({issues:w.issues});else if(w.code==="invalid_element")d({issues:w.issues});else if(w.path.length===0)c._errors.push(i(w));else{let E=c,s=0;for(;s<w.path.length;){const O=w.path[s];s===w.path.length-1?(E[O]=E[O]||{_errors:[]},E[O]._errors.push(i(w))):E[O]=E[O]||{_errors:[]},E=E[O],s++}}};return d(t),c}const uS=t=>(i,c,d,y)=>{const w=d?Object.assign(d,{async:!1}):{async:!1},E=i._zod.run({value:c,issues:[]},w);if(E instanceof Promise)throw new _x;if(E.issues.length){const s=new(y?.Err??t)(E.issues.map(O=>G_(O,w,$_())));throw S3(s,y?.callee),s}return E.value},yY=uS(cS),dS=t=>async(i,c,d,y)=>{const w=d?Object.assign(d,{async:!0}):{async:!0};let E=i._zod.run({value:c,issues:[]},w);if(E instanceof Promise&&(E=await E),E.issues.length){const s=new(y?.Err??t)(E.issues.map(O=>G_(O,w,$_())));throw S3(s,y?.callee),s}return E.value},xY=dS(cS),hS=t=>(i,c,d)=>{const y=d?{...d,async:!1}:{async:!1},w=i._zod.run({value:c,issues:[]},y);if(w instanceof Promise)throw new _x;return w.issues.length?{success:!1,error:new(t??aC)(w.issues.map(E=>G_(E,y,$_())))}:{success:!0,data:w.value}},vY=hS(cS),fS=t=>async(i,c,d)=>{const y=d?Object.assign(d,{async:!0}):{async:!0};let w=i._zod.run({value:c,issues:[]},y);return w instanceof Promise&&(w=await w),w.issues.length?{success:!1,error:new t(w.issues.map(E=>G_(E,y,$_())))}:{success:!0,data:w.value}},bY=fS(cS),wY=t=>(i,c,d)=>{const y=d?Object.assign(d,{direction:"backward"}):{direction:"backward"};return uS(t)(i,c,y)},SY=t=>(i,c,d)=>uS(t)(i,c,d),TY=t=>async(i,c,d)=>{const y=d?Object.assign(d,{direction:"backward"}):{direction:"backward"};return dS(t)(i,c,y)},EY=t=>async(i,c,d)=>dS(t)(i,c,d),AY=t=>(i,c,d)=>{const y=d?Object.assign(d,{direction:"backward"}):{direction:"backward"};return hS(t)(i,c,y)},CY=t=>(i,c,d)=>hS(t)(i,c,d),RY=t=>async(i,c,d)=>{const y=d?Object.assign(d,{direction:"backward"}):{direction:"backward"};return fS(t)(i,c,y)},MY=t=>async(i,c,d)=>fS(t)(i,c,d),IY=/^[cC][^\s-]{8,}$/,DY=/^[0-9a-z]+$/,PY=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,OY=/^[0-9a-vA-V]{20}$/,zY=/^[A-Za-z0-9]{27}$/,LY=/^[a-zA-Z0-9_-]{21}$/,NY=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,kY=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,_O=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,jY=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,FY="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function BY(){return new RegExp(FY,"u")}const VY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,UY=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,$Y=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,GY=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,HY=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,C3=/^[A-Za-z0-9_-]*$/,qY=/^\+(?:[0-9]){6,14}[0-9]$/,R3="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ZY=new RegExp(`^${R3}$`);function M3(t){const i="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${i}`:t.precision===0?`${i}:[0-5]\\d`:`${i}:[0-5]\\d\\.\\d{${t.precision}}`:`${i}(?::[0-5]\\d(?:\\.\\d+)?)?`}function WY(t){return new RegExp(`^${M3(t)}$`)}function XY(t){const i=M3({precision:t.precision}),c=["Z"];t.local&&c.push(""),t.offset&&c.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const d=`${i}(?:${c.join("|")})`;return new RegExp(`^${R3}T(?:${d})$`)}const KY=t=>{const i=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${i}$`)},YY=/^-?\d+$/,QY=/^-?\d+(?:\.\d+)?/,JY=/^[^A-Z]*$/,eQ=/^[^a-z]*$/,Nc=En("$ZodCheck",(t,i)=>{var c;t._zod??(t._zod={}),t._zod.def=i,(c=t._zod).onattach??(c.onattach=[])}),I3={number:"number",bigint:"bigint",object:"date"},D3=En("$ZodCheckLessThan",(t,i)=>{Nc.init(t,i);const c=I3[typeof i.value];t._zod.onattach.push(d=>{const y=d._zod.bag,w=(i.inclusive?y.maximum:y.exclusiveMaximum)??Number.POSITIVE_INFINITY;i.value<w&&(i.inclusive?y.maximum=i.value:y.exclusiveMaximum=i.value)}),t._zod.check=d=>{(i.inclusive?d.value<=i.value:d.value<i.value)||d.issues.push({origin:c,code:"too_big",maximum:i.value,input:d.value,inclusive:i.inclusive,inst:t,continue:!i.abort})}}),P3=En("$ZodCheckGreaterThan",(t,i)=>{Nc.init(t,i);const c=I3[typeof i.value];t._zod.onattach.push(d=>{const y=d._zod.bag,w=(i.inclusive?y.minimum:y.exclusiveMinimum)??Number.NEGATIVE_INFINITY;i.value>w&&(i.inclusive?y.minimum=i.value:y.exclusiveMinimum=i.value)}),t._zod.check=d=>{(i.inclusive?d.value>=i.value:d.value>i.value)||d.issues.push({origin:c,code:"too_small",minimum:i.value,input:d.value,inclusive:i.inclusive,inst:t,continue:!i.abort})}}),tQ=En("$ZodCheckMultipleOf",(t,i)=>{Nc.init(t,i),t._zod.onattach.push(c=>{var d;(d=c._zod.bag).multipleOf??(d.multipleOf=i.value)}),t._zod.check=c=>{if(typeof c.value!=typeof i.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof c.value=="bigint"?c.value%i.value===BigInt(0):iY(c.value,i.value)===0)||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:i.value,input:c.value,inst:t,continue:!i.abort})}}),nQ=En("$ZodCheckNumberFormat",(t,i)=>{Nc.init(t,i),i.format=i.format||"float64";const c=i.format?.includes("int"),d=c?"int":"number",[y,w]=lY[i.format];t._zod.onattach.push(E=>{const s=E._zod.bag;s.format=i.format,s.minimum=y,s.maximum=w,c&&(s.pattern=YY)}),t._zod.check=E=>{const s=E.value;if(c){if(!Number.isInteger(s)){E.issues.push({expected:d,format:i.format,code:"invalid_type",continue:!1,input:s,inst:t});return}if(!Number.isSafeInteger(s)){s>0?E.issues.push({input:s,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:d,continue:!i.abort}):E.issues.push({input:s,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:d,continue:!i.abort});return}}s<y&&E.issues.push({origin:"number",input:s,code:"too_small",minimum:y,inclusive:!0,inst:t,continue:!i.abort}),s>w&&E.issues.push({origin:"number",input:s,code:"too_big",maximum:w,inst:t})}}),iQ=En("$ZodCheckMaxLength",(t,i)=>{var c;Nc.init(t,i),(c=t._zod.def).when??(c.when=d=>{const y=d.value;return!rC(y)&&y.length!==void 0}),t._zod.onattach.push(d=>{const y=d._zod.bag.maximum??Number.POSITIVE_INFINITY;i.maximum<y&&(d._zod.bag.maximum=i.maximum)}),t._zod.check=d=>{const y=d.value;if(y.length<=i.maximum)return;const E=oC(y);d.issues.push({origin:E,code:"too_big",maximum:i.maximum,inclusive:!0,input:y,inst:t,continue:!i.abort})}}),rQ=En("$ZodCheckMinLength",(t,i)=>{var c;Nc.init(t,i),(c=t._zod.def).when??(c.when=d=>{const y=d.value;return!rC(y)&&y.length!==void 0}),t._zod.onattach.push(d=>{const y=d._zod.bag.minimum??Number.NEGATIVE_INFINITY;i.minimum>y&&(d._zod.bag.minimum=i.minimum)}),t._zod.check=d=>{const y=d.value;if(y.length>=i.minimum)return;const E=oC(y);d.issues.push({origin:E,code:"too_small",minimum:i.minimum,inclusive:!0,input:y,inst:t,continue:!i.abort})}}),sQ=En("$ZodCheckLengthEquals",(t,i)=>{var c;Nc.init(t,i),(c=t._zod.def).when??(c.when=d=>{const y=d.value;return!rC(y)&&y.length!==void 0}),t._zod.onattach.push(d=>{const y=d._zod.bag;y.minimum=i.length,y.maximum=i.length,y.length=i.length}),t._zod.check=d=>{const y=d.value,w=y.length;if(w===i.length)return;const E=oC(y),s=w>i.length;d.issues.push({origin:E,...s?{code:"too_big",maximum:i.length}:{code:"too_small",minimum:i.length},inclusive:!0,exact:!0,input:d.value,inst:t,continue:!i.abort})}}),pS=En("$ZodCheckStringFormat",(t,i)=>{var c,d;Nc.init(t,i),t._zod.onattach.push(y=>{const w=y._zod.bag;w.format=i.format,i.pattern&&(w.patterns??(w.patterns=new Set),w.patterns.add(i.pattern))}),i.pattern?(c=t._zod).check??(c.check=y=>{i.pattern.lastIndex=0,!i.pattern.test(y.value)&&y.issues.push({origin:"string",code:"invalid_format",format:i.format,input:y.value,...i.pattern?{pattern:i.pattern.toString()}:{},inst:t,continue:!i.abort})}):(d=t._zod).check??(d.check=()=>{})}),oQ=En("$ZodCheckRegex",(t,i)=>{pS.init(t,i),t._zod.check=c=>{i.pattern.lastIndex=0,!i.pattern.test(c.value)&&c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:i.pattern.toString(),inst:t,continue:!i.abort})}}),aQ=En("$ZodCheckLowerCase",(t,i)=>{i.pattern??(i.pattern=JY),pS.init(t,i)}),lQ=En("$ZodCheckUpperCase",(t,i)=>{i.pattern??(i.pattern=eQ),pS.init(t,i)}),cQ=En("$ZodCheckIncludes",(t,i)=>{Nc.init(t,i);const c=lS(i.includes),d=new RegExp(typeof i.position=="number"?`^.{${i.position}}${c}`:c);i.pattern=d,t._zod.onattach.push(y=>{const w=y._zod.bag;w.patterns??(w.patterns=new Set),w.patterns.add(d)}),t._zod.check=y=>{y.value.includes(i.includes,i.position)||y.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:i.includes,input:y.value,inst:t,continue:!i.abort})}}),uQ=En("$ZodCheckStartsWith",(t,i)=>{Nc.init(t,i);const c=new RegExp(`^${lS(i.prefix)}.*`);i.pattern??(i.pattern=c),t._zod.onattach.push(d=>{const y=d._zod.bag;y.patterns??(y.patterns=new Set),y.patterns.add(c)}),t._zod.check=d=>{d.value.startsWith(i.prefix)||d.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:i.prefix,input:d.value,inst:t,continue:!i.abort})}}),dQ=En("$ZodCheckEndsWith",(t,i)=>{Nc.init(t,i);const c=new RegExp(`.*${lS(i.suffix)}$`);i.pattern??(i.pattern=c),t._zod.onattach.push(d=>{const y=d._zod.bag;y.patterns??(y.patterns=new Set),y.patterns.add(c)}),t._zod.check=d=>{d.value.endsWith(i.suffix)||d.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:i.suffix,input:d.value,inst:t,continue:!i.abort})}}),hQ=En("$ZodCheckOverwrite",(t,i)=>{Nc.init(t,i),t._zod.check=c=>{c.value=i.tx(c.value)}});class fQ{constructor(i=[]){this.content=[],this.indent=0,this&&(this.args=i)}indented(i){this.indent+=1,i(this),this.indent-=1}write(i){if(typeof i=="function"){i(this,{execution:"sync"}),i(this,{execution:"async"});return}const d=i.split(`
`).filter(E=>E),y=Math.min(...d.map(E=>E.length-E.trimStart().length)),w=d.map(E=>E.slice(y)).map(E=>" ".repeat(this.indent*2)+E);for(const E of w)this.content.push(E)}compile(){const i=Function,c=this?.args,y=[...(this?.content??[""]).map(w=>`  ${w}`)];return new i(...c,y.join(`
`))}}const pQ={major:4,minor:1,patch:13},ma=En("$ZodType",(t,i)=>{var c;t??(t={}),t._zod.def=i,t._zod.bag=t._zod.bag||{},t._zod.version=pQ;const d=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&d.unshift(t);for(const y of d)for(const w of y._zod.onattach)w(t);if(d.length===0)(c=t._zod).deferred??(c.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{const y=(E,s,O)=>{let z=mx(E),j;for(const H of s){if(H._zod.def.when){if(!H._zod.def.when(E))continue}else if(z)continue;const Y=E.issues.length,ie=H._zod.check(E);if(ie instanceof Promise&&O?.async===!1)throw new _x;if(j||ie instanceof Promise)j=(j??Promise.resolve()).then(async()=>{await ie,E.issues.length!==Y&&(z||(z=mx(E,Y)))});else{if(E.issues.length===Y)continue;z||(z=mx(E,Y))}}return j?j.then(()=>E):E},w=(E,s,O)=>{if(mx(E))return E.aborted=!0,E;const z=y(s,d,O);if(z instanceof Promise){if(O.async===!1)throw new _x;return z.then(j=>t._zod.parse(j,O))}return t._zod.parse(z,O)};t._zod.run=(E,s)=>{if(s.skipChecks)return t._zod.parse(E,s);if(s.direction==="backward"){const z=t._zod.parse({value:E.value,issues:[]},{...s,skipChecks:!0});return z instanceof Promise?z.then(j=>w(j,E,s)):w(z,E,s)}const O=t._zod.parse(E,s);if(O instanceof Promise){if(s.async===!1)throw new _x;return O.then(z=>y(z,d,s))}return y(O,d,s)}}t["~standard"]={validate:y=>{try{const w=vY(t,y);return w.success?{value:w.data}:{issues:w.error?.issues}}catch{return bY(t,y).then(E=>E.success?{value:E.data}:{issues:E.error?.issues})}},vendor:"zod",version:1}}),lC=En("$ZodString",(t,i)=>{ma.init(t,i),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??KY(t._zod.bag),t._zod.parse=(c,d)=>{if(i.coerce)try{c.value=String(c.value)}catch{}return typeof c.value=="string"||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:t}),c}}),bo=En("$ZodStringFormat",(t,i)=>{pS.init(t,i),lC.init(t,i)}),mQ=En("$ZodGUID",(t,i)=>{i.pattern??(i.pattern=kY),bo.init(t,i)}),gQ=En("$ZodUUID",(t,i)=>{if(i.version){const d={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[i.version];if(d===void 0)throw new Error(`Invalid UUID version: "${i.version}"`);i.pattern??(i.pattern=_O(d))}else i.pattern??(i.pattern=_O());bo.init(t,i)}),_Q=En("$ZodEmail",(t,i)=>{i.pattern??(i.pattern=jY),bo.init(t,i)}),yQ=En("$ZodURL",(t,i)=>{bo.init(t,i),t._zod.check=c=>{try{const d=c.value.trim(),y=new URL(d);i.hostname&&(i.hostname.lastIndex=0,i.hostname.test(y.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:i.hostname.source,input:c.value,inst:t,continue:!i.abort})),i.protocol&&(i.protocol.lastIndex=0,i.protocol.test(y.protocol.endsWith(":")?y.protocol.slice(0,-1):y.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:i.protocol.source,input:c.value,inst:t,continue:!i.abort})),i.normalize?c.value=y.href:c.value=d;return}catch{c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:t,continue:!i.abort})}}}),xQ=En("$ZodEmoji",(t,i)=>{i.pattern??(i.pattern=BY()),bo.init(t,i)}),vQ=En("$ZodNanoID",(t,i)=>{i.pattern??(i.pattern=LY),bo.init(t,i)}),bQ=En("$ZodCUID",(t,i)=>{i.pattern??(i.pattern=IY),bo.init(t,i)}),wQ=En("$ZodCUID2",(t,i)=>{i.pattern??(i.pattern=DY),bo.init(t,i)}),SQ=En("$ZodULID",(t,i)=>{i.pattern??(i.pattern=PY),bo.init(t,i)}),TQ=En("$ZodXID",(t,i)=>{i.pattern??(i.pattern=OY),bo.init(t,i)}),EQ=En("$ZodKSUID",(t,i)=>{i.pattern??(i.pattern=zY),bo.init(t,i)}),AQ=En("$ZodISODateTime",(t,i)=>{i.pattern??(i.pattern=XY(i)),bo.init(t,i)}),CQ=En("$ZodISODate",(t,i)=>{i.pattern??(i.pattern=ZY),bo.init(t,i)}),RQ=En("$ZodISOTime",(t,i)=>{i.pattern??(i.pattern=WY(i)),bo.init(t,i)}),MQ=En("$ZodISODuration",(t,i)=>{i.pattern??(i.pattern=NY),bo.init(t,i)}),IQ=En("$ZodIPv4",(t,i)=>{i.pattern??(i.pattern=VY),bo.init(t,i),t._zod.bag.format="ipv4"}),DQ=En("$ZodIPv6",(t,i)=>{i.pattern??(i.pattern=UY),bo.init(t,i),t._zod.bag.format="ipv6",t._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:t,continue:!i.abort})}}}),PQ=En("$ZodCIDRv4",(t,i)=>{i.pattern??(i.pattern=$Y),bo.init(t,i)}),OQ=En("$ZodCIDRv6",(t,i)=>{i.pattern??(i.pattern=GY),bo.init(t,i),t._zod.check=c=>{const d=c.value.split("/");try{if(d.length!==2)throw new Error;const[y,w]=d;if(!w)throw new Error;const E=Number(w);if(`${E}`!==w)throw new Error;if(E<0||E>128)throw new Error;new URL(`http://[${y}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:t,continue:!i.abort})}}});function O3(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const zQ=En("$ZodBase64",(t,i)=>{i.pattern??(i.pattern=HY),bo.init(t,i),t._zod.bag.contentEncoding="base64",t._zod.check=c=>{O3(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:t,continue:!i.abort})}});function LQ(t){if(!C3.test(t))return!1;const i=t.replace(/[-_]/g,d=>d==="-"?"+":"/"),c=i.padEnd(Math.ceil(i.length/4)*4,"=");return O3(c)}const NQ=En("$ZodBase64URL",(t,i)=>{i.pattern??(i.pattern=C3),bo.init(t,i),t._zod.bag.contentEncoding="base64url",t._zod.check=c=>{LQ(c.value)||c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:t,continue:!i.abort})}}),kQ=En("$ZodE164",(t,i)=>{i.pattern??(i.pattern=qY),bo.init(t,i)});function jQ(t,i=null){try{const c=t.split(".");if(c.length!==3)return!1;const[d]=c;if(!d)return!1;const y=JSON.parse(atob(d));return!("typ"in y&&y?.typ!=="JWT"||!y.alg||i&&(!("alg"in y)||y.alg!==i))}catch{return!1}}const FQ=En("$ZodJWT",(t,i)=>{bo.init(t,i),t._zod.check=c=>{jQ(c.value,i.alg)||c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:t,continue:!i.abort})}}),z3=En("$ZodNumber",(t,i)=>{ma.init(t,i),t._zod.pattern=t._zod.bag.pattern??QY,t._zod.parse=(c,d)=>{if(i.coerce)try{c.value=Number(c.value)}catch{}const y=c.value;if(typeof y=="number"&&!Number.isNaN(y)&&Number.isFinite(y))return c;const w=typeof y=="number"?Number.isNaN(y)?"NaN":Number.isFinite(y)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:y,inst:t,...w?{received:w}:{}}),c}}),BQ=En("$ZodNumberFormat",(t,i)=>{nQ.init(t,i),z3.init(t,i)}),VQ=En("$ZodUnknown",(t,i)=>{ma.init(t,i),t._zod.parse=c=>c}),UQ=En("$ZodNever",(t,i)=>{ma.init(t,i),t._zod.parse=(c,d)=>(c.issues.push({expected:"never",code:"invalid_type",input:c.value,inst:t}),c)});function yO(t,i,c){t.issues.length&&i.issues.push(...E3(c,t.issues)),i.value[c]=t.value}const $Q=En("$ZodArray",(t,i)=>{ma.init(t,i),t._zod.parse=(c,d)=>{const y=c.value;if(!Array.isArray(y))return c.issues.push({expected:"array",code:"invalid_type",input:y,inst:t}),c;c.value=Array(y.length);const w=[];for(let E=0;E<y.length;E++){const s=y[E],O=i.element._zod.run({value:s,issues:[]},d);O instanceof Promise?w.push(O.then(z=>yO(z,c,E))):yO(O,c,E)}return w.length?Promise.all(w).then(()=>c):c}});function Mw(t,i,c,d){t.issues.length&&i.issues.push(...E3(c,t.issues)),t.value===void 0?c in d&&(i.value[c]=void 0):i.value[c]=t.value}function L3(t){const i=Object.keys(t.shape);for(const d of i)if(!t.shape?.[d]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${d}": expected a Zod schema`);const c=aY(t.shape);return{...t,keys:i,keySet:new Set(i),numKeys:i.length,optionalKeys:new Set(c)}}function N3(t,i,c,d,y,w){const E=[],s=y.keySet,O=y.catchall._zod,z=O.def.type;for(const j in i){if(s.has(j))continue;if(z==="never"){E.push(j);continue}const H=O.run({value:i[j],issues:[]},d);H instanceof Promise?t.push(H.then(Y=>Mw(Y,c,j,i))):Mw(H,c,j,i)}return E.length&&c.issues.push({code:"unrecognized_keys",keys:E,input:i,inst:w}),t.length?Promise.all(t).then(()=>c):c}const GQ=En("$ZodObject",(t,i)=>{if(ma.init(t,i),!Object.getOwnPropertyDescriptor(i,"shape")?.get){const s=i.shape;Object.defineProperty(i,"shape",{get:()=>{const O={...s};return Object.defineProperty(i,"shape",{value:O}),O}})}const d=iC(()=>L3(i));no(t._zod,"propValues",()=>{const s=i.shape,O={};for(const z in s){const j=s[z]._zod;if(j.values){O[z]??(O[z]=new Set);for(const H of j.values)O[z].add(H)}}return O});const y=Rw,w=i.catchall;let E;t._zod.parse=(s,O)=>{E??(E=d.value);const z=s.value;if(!y(z))return s.issues.push({expected:"object",code:"invalid_type",input:z,inst:t}),s;s.value={};const j=[],H=E.shape;for(const Y of E.keys){const oe=H[Y]._zod.run({value:z[Y],issues:[]},O);oe instanceof Promise?j.push(oe.then(ee=>Mw(ee,s,Y,z))):Mw(oe,s,Y,z)}return w?N3(j,z,s,O,d.value,t):j.length?Promise.all(j).then(()=>s):s}}),HQ=En("$ZodObjectJIT",(t,i)=>{GQ.init(t,i);const c=t._zod.parse,d=iC(()=>L3(i)),y=Y=>{const ie=new fQ(["shape","payload","ctx"]),oe=d.value,ee=_e=>{const Re=gO(_e);return`shape[${Re}]._zod.run({ value: input[${Re}], issues: [] }, ctx)`};ie.write("const input = payload.value;");const le=Object.create(null);let ge=0;for(const _e of oe.keys)le[_e]=`key_${ge++}`;ie.write("const newResult = {};");for(const _e of oe.keys){const Re=le[_e],xe=gO(_e);ie.write(`const ${Re} = ${ee(_e)};`),ie.write(`
        if (${Re}.issues.length) {
          payload.issues = payload.issues.concat(${Re}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${xe}, ...iss.path] : [${xe}]
          })));
        }
        
        
        if (${Re}.value === undefined) {
          if (${xe} in input) {
            newResult[${xe}] = undefined;
          }
        } else {
          newResult[${xe}] = ${Re}.value;
        }
        
      `)}ie.write("payload.value = newResult;"),ie.write("return payload;");const pe=ie.compile();return(_e,Re)=>pe(Y,_e,Re)};let w;const E=Rw,s=!w3.jitless,z=s&&sY.value,j=i.catchall;let H;t._zod.parse=(Y,ie)=>{H??(H=d.value);const oe=Y.value;return E(oe)?s&&z&&ie?.async===!1&&ie.jitless!==!0?(w||(w=y(i.shape)),Y=w(Y,ie),j?N3([],oe,Y,ie,H,t):Y):c(Y,ie):(Y.issues.push({expected:"object",code:"invalid_type",input:oe,inst:t}),Y)}});function xO(t,i,c,d){for(const w of t)if(w.issues.length===0)return i.value=w.value,i;const y=t.filter(w=>!mx(w));return y.length===1?(i.value=y[0].value,y[0]):(i.issues.push({code:"invalid_union",input:i.value,inst:c,errors:t.map(w=>w.issues.map(E=>G_(E,d,$_())))}),i)}const qQ=En("$ZodUnion",(t,i)=>{ma.init(t,i),no(t._zod,"optin",()=>i.options.some(y=>y._zod.optin==="optional")?"optional":void 0),no(t._zod,"optout",()=>i.options.some(y=>y._zod.optout==="optional")?"optional":void 0),no(t._zod,"values",()=>{if(i.options.every(y=>y._zod.values))return new Set(i.options.flatMap(y=>Array.from(y._zod.values)))}),no(t._zod,"pattern",()=>{if(i.options.every(y=>y._zod.pattern)){const y=i.options.map(w=>w._zod.pattern);return new RegExp(`^(${y.map(w=>sC(w.source)).join("|")})$`)}});const c=i.options.length===1,d=i.options[0]._zod.run;t._zod.parse=(y,w)=>{if(c)return d(y,w);let E=!1;const s=[];for(const O of i.options){const z=O._zod.run({value:y.value,issues:[]},w);if(z instanceof Promise)s.push(z),E=!0;else{if(z.issues.length===0)return z;s.push(z)}}return E?Promise.all(s).then(O=>xO(O,y,t,w)):xO(s,y,t,w)}}),ZQ=En("$ZodIntersection",(t,i)=>{ma.init(t,i),t._zod.parse=(c,d)=>{const y=c.value,w=i.left._zod.run({value:y,issues:[]},d),E=i.right._zod.run({value:y,issues:[]},d);return w instanceof Promise||E instanceof Promise?Promise.all([w,E]).then(([O,z])=>vO(c,O,z)):vO(c,w,E)}});function CE(t,i){if(t===i)return{valid:!0,data:t};if(t instanceof Date&&i instanceof Date&&+t==+i)return{valid:!0,data:t};if(L0(t)&&L0(i)){const c=Object.keys(i),d=Object.keys(t).filter(w=>c.indexOf(w)!==-1),y={...t,...i};for(const w of d){const E=CE(t[w],i[w]);if(!E.valid)return{valid:!1,mergeErrorPath:[w,...E.mergeErrorPath]};y[w]=E.data}return{valid:!0,data:y}}if(Array.isArray(t)&&Array.isArray(i)){if(t.length!==i.length)return{valid:!1,mergeErrorPath:[]};const c=[];for(let d=0;d<t.length;d++){const y=t[d],w=i[d],E=CE(y,w);if(!E.valid)return{valid:!1,mergeErrorPath:[d,...E.mergeErrorPath]};c.push(E.data)}return{valid:!0,data:c}}return{valid:!1,mergeErrorPath:[]}}function vO(t,i,c){if(i.issues.length&&t.issues.push(...i.issues),c.issues.length&&t.issues.push(...c.issues),mx(t))return t;const d=CE(i.value,c.value);if(!d.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return t.value=d.data,t}const WQ=En("$ZodEnum",(t,i)=>{ma.init(t,i);const c=nY(i.entries),d=new Set(c);t._zod.values=d,t._zod.pattern=new RegExp(`^(${c.filter(y=>oY.has(typeof y)).map(y=>typeof y=="string"?lS(y):y.toString()).join("|")})$`),t._zod.parse=(y,w)=>{const E=y.value;return d.has(E)||y.issues.push({code:"invalid_value",values:c,input:E,inst:t}),y}}),XQ=En("$ZodTransform",(t,i)=>{ma.init(t,i),t._zod.parse=(c,d)=>{if(d.direction==="backward")throw new b3(t.constructor.name);const y=i.transform(c.value,c);if(d.async)return(y instanceof Promise?y:Promise.resolve(y)).then(E=>(c.value=E,c));if(y instanceof Promise)throw new _x;return c.value=y,c}});function bO(t,i){return t.issues.length&&i===void 0?{issues:[],value:void 0}:t}const KQ=En("$ZodOptional",(t,i)=>{ma.init(t,i),t._zod.optin="optional",t._zod.optout="optional",no(t._zod,"values",()=>i.innerType._zod.values?new Set([...i.innerType._zod.values,void 0]):void 0),no(t._zod,"pattern",()=>{const c=i.innerType._zod.pattern;return c?new RegExp(`^(${sC(c.source)})?$`):void 0}),t._zod.parse=(c,d)=>{if(i.innerType._zod.optin==="optional"){const y=i.innerType._zod.run(c,d);return y instanceof Promise?y.then(w=>bO(w,c.value)):bO(y,c.value)}return c.value===void 0?c:i.innerType._zod.run(c,d)}}),YQ=En("$ZodNullable",(t,i)=>{ma.init(t,i),no(t._zod,"optin",()=>i.innerType._zod.optin),no(t._zod,"optout",()=>i.innerType._zod.optout),no(t._zod,"pattern",()=>{const c=i.innerType._zod.pattern;return c?new RegExp(`^(${sC(c.source)}|null)$`):void 0}),no(t._zod,"values",()=>i.innerType._zod.values?new Set([...i.innerType._zod.values,null]):void 0),t._zod.parse=(c,d)=>c.value===null?c:i.innerType._zod.run(c,d)}),QQ=En("$ZodDefault",(t,i)=>{ma.init(t,i),t._zod.optin="optional",no(t._zod,"values",()=>i.innerType._zod.values),t._zod.parse=(c,d)=>{if(d.direction==="backward")return i.innerType._zod.run(c,d);if(c.value===void 0)return c.value=i.defaultValue,c;const y=i.innerType._zod.run(c,d);return y instanceof Promise?y.then(w=>wO(w,i)):wO(y,i)}});function wO(t,i){return t.value===void 0&&(t.value=i.defaultValue),t}const JQ=En("$ZodPrefault",(t,i)=>{ma.init(t,i),t._zod.optin="optional",no(t._zod,"values",()=>i.innerType._zod.values),t._zod.parse=(c,d)=>(d.direction==="backward"||c.value===void 0&&(c.value=i.defaultValue),i.innerType._zod.run(c,d))}),eJ=En("$ZodNonOptional",(t,i)=>{ma.init(t,i),no(t._zod,"values",()=>{const c=i.innerType._zod.values;return c?new Set([...c].filter(d=>d!==void 0)):void 0}),t._zod.parse=(c,d)=>{const y=i.innerType._zod.run(c,d);return y instanceof Promise?y.then(w=>SO(w,t)):SO(y,t)}});function SO(t,i){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:i}),t}const tJ=En("$ZodCatch",(t,i)=>{ma.init(t,i),no(t._zod,"optin",()=>i.innerType._zod.optin),no(t._zod,"optout",()=>i.innerType._zod.optout),no(t._zod,"values",()=>i.innerType._zod.values),t._zod.parse=(c,d)=>{if(d.direction==="backward")return i.innerType._zod.run(c,d);const y=i.innerType._zod.run(c,d);return y instanceof Promise?y.then(w=>(c.value=w.value,w.issues.length&&(c.value=i.catchValue({...c,error:{issues:w.issues.map(E=>G_(E,d,$_()))},input:c.value}),c.issues=[]),c)):(c.value=y.value,y.issues.length&&(c.value=i.catchValue({...c,error:{issues:y.issues.map(w=>G_(w,d,$_()))},input:c.value}),c.issues=[]),c)}}),nJ=En("$ZodPipe",(t,i)=>{ma.init(t,i),no(t._zod,"values",()=>i.in._zod.values),no(t._zod,"optin",()=>i.in._zod.optin),no(t._zod,"optout",()=>i.out._zod.optout),no(t._zod,"propValues",()=>i.in._zod.propValues),t._zod.parse=(c,d)=>{if(d.direction==="backward"){const w=i.out._zod.run(c,d);return w instanceof Promise?w.then(E=>z1(E,i.in,d)):z1(w,i.in,d)}const y=i.in._zod.run(c,d);return y instanceof Promise?y.then(w=>z1(w,i.out,d)):z1(y,i.out,d)}});function z1(t,i,c){return t.issues.length?(t.aborted=!0,t):i._zod.run({value:t.value,issues:t.issues},c)}const iJ=En("$ZodReadonly",(t,i)=>{ma.init(t,i),no(t._zod,"propValues",()=>i.innerType._zod.propValues),no(t._zod,"values",()=>i.innerType._zod.values),no(t._zod,"optin",()=>i.innerType?._zod?.optin),no(t._zod,"optout",()=>i.innerType?._zod?.optout),t._zod.parse=(c,d)=>{if(d.direction==="backward")return i.innerType._zod.run(c,d);const y=i.innerType._zod.run(c,d);return y instanceof Promise?y.then(TO):TO(y)}});function TO(t){return t.value=Object.freeze(t.value),t}const rJ=En("$ZodCustom",(t,i)=>{Nc.init(t,i),ma.init(t,i),t._zod.parse=(c,d)=>c,t._zod.check=c=>{const d=c.value,y=i.fn(d);if(y instanceof Promise)return y.then(w=>EO(w,c,d,t));EO(y,c,d,t)}});function EO(t,i,c,d){if(!t){const y={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(y.params=d._zod.def.params),i.issues.push(N0(y))}}var AO;class sJ{constructor(){this._map=new WeakMap,this._idmap=new Map}add(i,...c){const d=c[0];if(this._map.set(i,d),d&&typeof d=="object"&&"id"in d){if(this._idmap.has(d.id))throw new Error(`ID ${d.id} already exists in the registry`);this._idmap.set(d.id,i)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(i){const c=this._map.get(i);return c&&typeof c=="object"&&"id"in c&&this._idmap.delete(c.id),this._map.delete(i),this}get(i){const c=i._zod.parent;if(c){const d={...this.get(c)??{}};delete d.id;const y={...d,...this._map.get(i)};return Object.keys(y).length?y:void 0}return this._map.get(i)}has(i){return this._map.has(i)}}function oJ(){return new sJ}(AO=globalThis).__zod_globalRegistry??(AO.__zod_globalRegistry=oJ());const L1=globalThis.__zod_globalRegistry;function aJ(t,i){return new t({type:"string",...Wi(i)})}function lJ(t,i){return new t({type:"string",format:"email",check:"string_format",abort:!1,...Wi(i)})}function CO(t,i){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...Wi(i)})}function cJ(t,i){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...Wi(i)})}function uJ(t,i){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Wi(i)})}function dJ(t,i){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Wi(i)})}function hJ(t,i){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Wi(i)})}function fJ(t,i){return new t({type:"string",format:"url",check:"string_format",abort:!1,...Wi(i)})}function pJ(t,i){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...Wi(i)})}function mJ(t,i){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...Wi(i)})}function gJ(t,i){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...Wi(i)})}function _J(t,i){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...Wi(i)})}function yJ(t,i){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...Wi(i)})}function xJ(t,i){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...Wi(i)})}function vJ(t,i){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...Wi(i)})}function bJ(t,i){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...Wi(i)})}function wJ(t,i){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...Wi(i)})}function SJ(t,i){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Wi(i)})}function TJ(t,i){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Wi(i)})}function EJ(t,i){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...Wi(i)})}function AJ(t,i){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...Wi(i)})}function CJ(t,i){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...Wi(i)})}function RJ(t,i){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...Wi(i)})}function MJ(t,i){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Wi(i)})}function IJ(t,i){return new t({type:"string",format:"date",check:"string_format",...Wi(i)})}function DJ(t,i){return new t({type:"string",format:"time",check:"string_format",precision:null,...Wi(i)})}function PJ(t,i){return new t({type:"string",format:"duration",check:"string_format",...Wi(i)})}function OJ(t,i){return new t({type:"number",checks:[],...Wi(i)})}function zJ(t,i){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...Wi(i)})}function LJ(t){return new t({type:"unknown"})}function NJ(t,i){return new t({type:"never",...Wi(i)})}function RO(t,i){return new D3({check:"less_than",...Wi(i),value:t,inclusive:!1})}function p2(t,i){return new D3({check:"less_than",...Wi(i),value:t,inclusive:!0})}function MO(t,i){return new P3({check:"greater_than",...Wi(i),value:t,inclusive:!1})}function m2(t,i){return new P3({check:"greater_than",...Wi(i),value:t,inclusive:!0})}function IO(t,i){return new tQ({check:"multiple_of",...Wi(i),value:t})}function k3(t,i){return new iQ({check:"max_length",...Wi(i),maximum:t})}function Iw(t,i){return new rQ({check:"min_length",...Wi(i),minimum:t})}function j3(t,i){return new sQ({check:"length_equals",...Wi(i),length:t})}function kJ(t,i){return new oQ({check:"string_format",format:"regex",...Wi(i),pattern:t})}function jJ(t){return new aQ({check:"string_format",format:"lowercase",...Wi(t)})}function FJ(t){return new lQ({check:"string_format",format:"uppercase",...Wi(t)})}function BJ(t,i){return new cQ({check:"string_format",format:"includes",...Wi(i),includes:t})}function VJ(t,i){return new uQ({check:"string_format",format:"starts_with",...Wi(i),prefix:t})}function UJ(t,i){return new dQ({check:"string_format",format:"ends_with",...Wi(i),suffix:t})}function $x(t){return new hQ({check:"overwrite",tx:t})}function $J(t){return $x(i=>i.normalize(t))}function GJ(){return $x(t=>t.trim())}function HJ(){return $x(t=>t.toLowerCase())}function qJ(){return $x(t=>t.toUpperCase())}function ZJ(){return $x(t=>rY(t))}function WJ(t,i,c){return new t({type:"array",element:i,...Wi(c)})}function XJ(t,i,c){return new t({type:"custom",check:"custom",fn:i,...Wi(c)})}function KJ(t){const i=YJ(c=>(c.addIssue=d=>{if(typeof d=="string")c.issues.push(N0(d,c.value,i._zod.def));else{const y=d;y.fatal&&(y.continue=!1),y.code??(y.code="custom"),y.input??(y.input=c.value),y.inst??(y.inst=i),y.continue??(y.continue=!i._zod.def.abort),c.issues.push(N0(y))}},t(c.value,c)));return i}function YJ(t,i){const c=new Nc({check:"custom",...Wi(i)});return c._zod.check=t,c}function DO(t,i){try{var c=t()}catch(d){return i(d)}return c&&c.then?c.then(void 0,i):c}function QJ(t,i){for(var c={};t.length;){var d=t[0],y=d.code,w=d.message,E=d.path.join(".");if(!c[E])if("unionErrors"in d){var s=d.unionErrors[0].errors[0];c[E]={message:s.message,type:s.code}}else c[E]={message:w,type:y};if("unionErrors"in d&&d.unionErrors.forEach(function(j){return j.errors.forEach(function(H){return t.push(H)})}),i){var O=c[E].types,z=O&&O[d.code];c[E]=eC(E,i,c,y,z?[].concat(z,d.message):d.message)}t.shift()}return c}function JJ(t,i){for(var c={};t.length;){var d=t[0],y=d.code,w=d.message,E=d.path.join(".");if(!c[E])if(d.code==="invalid_union"&&d.errors.length>0){var s=d.errors[0][0];c[E]={message:s.message,type:s.code}}else c[E]={message:w,type:y};if(d.code==="invalid_union"&&d.errors.forEach(function(j){return j.forEach(function(H){return t.push(H)})}),i){var O=c[E].types,z=O&&O[d.code];c[E]=eC(E,i,c,y,z?[].concat(z,d.message):d.message)}t.shift()}return c}function hg(t,i,c){if(c===void 0&&(c={}),(function(d){return"_def"in d&&typeof d._def=="object"&&"typeName"in d._def})(t))return function(d,y,w){try{return Promise.resolve(DO(function(){return Promise.resolve(t[c.mode==="sync"?"parse":"parseAsync"](d,i)).then(function(E){return w.shouldUseNativeValidation&&EE({},w),{errors:{},values:c.raw?Object.assign({},d):E}})},function(E){if((function(s){return Array.isArray(s?.issues)})(E))return{values:{},errors:fO(QJ(E.errors,!w.shouldUseNativeValidation&&w.criteriaMode==="all"),w)};throw E}))}catch(E){return Promise.reject(E)}};if((function(d){return"_zod"in d&&typeof d._zod=="object"})(t))return function(d,y,w){try{return Promise.resolve(DO(function(){return Promise.resolve((c.mode==="sync"?yY:xY)(t,d,i)).then(function(E){return w.shouldUseNativeValidation&&EE({},w),{errors:{},values:c.raw?Object.assign({},d):E}})},function(E){if((function(s){return s instanceof aC})(E))return{values:{},errors:fO(JJ(E.issues,!w.shouldUseNativeValidation&&w.criteriaMode==="all"),w)};throw E}))}catch(E){return Promise.reject(E)}};throw new Error("Invalid input: not a Zod schema")}const eee=En("ZodISODateTime",(t,i)=>{AQ.init(t,i),Io.init(t,i)});function tee(t){return MJ(eee,t)}const nee=En("ZodISODate",(t,i)=>{CQ.init(t,i),Io.init(t,i)});function iee(t){return IJ(nee,t)}const ree=En("ZodISOTime",(t,i)=>{RQ.init(t,i),Io.init(t,i)});function see(t){return DJ(ree,t)}const oee=En("ZodISODuration",(t,i)=>{MQ.init(t,i),Io.init(t,i)});function aee(t){return PJ(oee,t)}const lee=(t,i)=>{aC.init(t,i),t.name="ZodError",Object.defineProperties(t,{format:{value:c=>_Y(t,c)},flatten:{value:c=>gY(t,c)},addIssue:{value:c=>{t.issues.push(c),t.message=JSON.stringify(t.issues,AE,2)}},addIssues:{value:c=>{t.issues.push(...c),t.message=JSON.stringify(t.issues,AE,2)}},isEmpty:{get(){return t.issues.length===0}}})},id=En("ZodError",lee,{Parent:Error}),cee=uS(id),uee=dS(id),dee=hS(id),hee=fS(id),fee=wY(id),pee=SY(id),mee=TY(id),gee=EY(id),_ee=AY(id),yee=CY(id),xee=RY(id),vee=MY(id),Ma=En("ZodType",(t,i)=>(ma.init(t,i),t.def=i,t.type=i.type,Object.defineProperty(t,"_def",{value:i}),t.check=(...c)=>t.clone(J_(i,{checks:[...i.checks??[],...c.map(d=>typeof d=="function"?{_zod:{check:d,def:{check:"custom"},onattach:[]}}:d)]})),t.clone=(c,d)=>dg(t,c,d),t.brand=()=>t,t.register=((c,d)=>(c.add(t,d),t)),t.parse=(c,d)=>cee(t,c,d,{callee:t.parse}),t.safeParse=(c,d)=>dee(t,c,d),t.parseAsync=async(c,d)=>uee(t,c,d,{callee:t.parseAsync}),t.safeParseAsync=async(c,d)=>hee(t,c,d),t.spa=t.safeParseAsync,t.encode=(c,d)=>fee(t,c,d),t.decode=(c,d)=>pee(t,c,d),t.encodeAsync=async(c,d)=>mee(t,c,d),t.decodeAsync=async(c,d)=>gee(t,c,d),t.safeEncode=(c,d)=>_ee(t,c,d),t.safeDecode=(c,d)=>yee(t,c,d),t.safeEncodeAsync=async(c,d)=>xee(t,c,d),t.safeDecodeAsync=async(c,d)=>vee(t,c,d),t.refine=(c,d)=>t.check(cte(c,d)),t.superRefine=c=>t.check(ute(c)),t.overwrite=c=>t.check($x(c)),t.optional=()=>LO(t),t.nullable=()=>NO(t),t.nullish=()=>LO(NO(t)),t.nonoptional=c=>nte(t,c),t.array=()=>cC(t),t.or=c=>qee([t,c]),t.and=c=>Wee(t,c),t.transform=c=>kO(t,Kee(c)),t.default=c=>Jee(t,c),t.prefault=c=>tte(t,c),t.catch=c=>rte(t,c),t.pipe=c=>kO(t,c),t.readonly=()=>ate(t),t.describe=c=>{const d=t.clone();return L1.add(d,{description:c}),d},Object.defineProperty(t,"description",{get(){return L1.get(t)?.description},configurable:!0}),t.meta=(...c)=>{if(c.length===0)return L1.get(t);const d=t.clone();return L1.add(d,c[0]),d},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),F3=En("_ZodString",(t,i)=>{lC.init(t,i),Ma.init(t,i);const c=t._zod.bag;t.format=c.format??null,t.minLength=c.minimum??null,t.maxLength=c.maximum??null,t.regex=(...d)=>t.check(kJ(...d)),t.includes=(...d)=>t.check(BJ(...d)),t.startsWith=(...d)=>t.check(VJ(...d)),t.endsWith=(...d)=>t.check(UJ(...d)),t.min=(...d)=>t.check(Iw(...d)),t.max=(...d)=>t.check(k3(...d)),t.length=(...d)=>t.check(j3(...d)),t.nonempty=(...d)=>t.check(Iw(1,...d)),t.lowercase=d=>t.check(jJ(d)),t.uppercase=d=>t.check(FJ(d)),t.trim=()=>t.check(GJ()),t.normalize=(...d)=>t.check($J(...d)),t.toLowerCase=()=>t.check(HJ()),t.toUpperCase=()=>t.check(qJ()),t.slugify=()=>t.check(ZJ())}),bee=En("ZodString",(t,i)=>{lC.init(t,i),F3.init(t,i),t.email=c=>t.check(lJ(wee,c)),t.url=c=>t.check(fJ(See,c)),t.jwt=c=>t.check(RJ(jee,c)),t.emoji=c=>t.check(pJ(Tee,c)),t.guid=c=>t.check(CO(PO,c)),t.uuid=c=>t.check(cJ(N1,c)),t.uuidv4=c=>t.check(uJ(N1,c)),t.uuidv6=c=>t.check(dJ(N1,c)),t.uuidv7=c=>t.check(hJ(N1,c)),t.nanoid=c=>t.check(mJ(Eee,c)),t.guid=c=>t.check(CO(PO,c)),t.cuid=c=>t.check(gJ(Aee,c)),t.cuid2=c=>t.check(_J(Cee,c)),t.ulid=c=>t.check(yJ(Ree,c)),t.base64=c=>t.check(EJ(Lee,c)),t.base64url=c=>t.check(AJ(Nee,c)),t.xid=c=>t.check(xJ(Mee,c)),t.ksuid=c=>t.check(vJ(Iee,c)),t.ipv4=c=>t.check(bJ(Dee,c)),t.ipv6=c=>t.check(wJ(Pee,c)),t.cidrv4=c=>t.check(SJ(Oee,c)),t.cidrv6=c=>t.check(TJ(zee,c)),t.e164=c=>t.check(CJ(kee,c)),t.datetime=c=>t.check(tee(c)),t.date=c=>t.check(iee(c)),t.time=c=>t.check(see(c)),t.duration=c=>t.check(aee(c))});function ks(t){return aJ(bee,t)}const Io=En("ZodStringFormat",(t,i)=>{bo.init(t,i),F3.init(t,i)}),wee=En("ZodEmail",(t,i)=>{_Q.init(t,i),Io.init(t,i)}),PO=En("ZodGUID",(t,i)=>{mQ.init(t,i),Io.init(t,i)}),N1=En("ZodUUID",(t,i)=>{gQ.init(t,i),Io.init(t,i)}),See=En("ZodURL",(t,i)=>{yQ.init(t,i),Io.init(t,i)}),Tee=En("ZodEmoji",(t,i)=>{xQ.init(t,i),Io.init(t,i)}),Eee=En("ZodNanoID",(t,i)=>{vQ.init(t,i),Io.init(t,i)}),Aee=En("ZodCUID",(t,i)=>{bQ.init(t,i),Io.init(t,i)}),Cee=En("ZodCUID2",(t,i)=>{wQ.init(t,i),Io.init(t,i)}),Ree=En("ZodULID",(t,i)=>{SQ.init(t,i),Io.init(t,i)}),Mee=En("ZodXID",(t,i)=>{TQ.init(t,i),Io.init(t,i)}),Iee=En("ZodKSUID",(t,i)=>{EQ.init(t,i),Io.init(t,i)}),Dee=En("ZodIPv4",(t,i)=>{IQ.init(t,i),Io.init(t,i)}),Pee=En("ZodIPv6",(t,i)=>{DQ.init(t,i),Io.init(t,i)}),Oee=En("ZodCIDRv4",(t,i)=>{PQ.init(t,i),Io.init(t,i)}),zee=En("ZodCIDRv6",(t,i)=>{OQ.init(t,i),Io.init(t,i)}),Lee=En("ZodBase64",(t,i)=>{zQ.init(t,i),Io.init(t,i)}),Nee=En("ZodBase64URL",(t,i)=>{NQ.init(t,i),Io.init(t,i)}),kee=En("ZodE164",(t,i)=>{kQ.init(t,i),Io.init(t,i)}),jee=En("ZodJWT",(t,i)=>{FQ.init(t,i),Io.init(t,i)}),B3=En("ZodNumber",(t,i)=>{z3.init(t,i),Ma.init(t,i),t.gt=(d,y)=>t.check(MO(d,y)),t.gte=(d,y)=>t.check(m2(d,y)),t.min=(d,y)=>t.check(m2(d,y)),t.lt=(d,y)=>t.check(RO(d,y)),t.lte=(d,y)=>t.check(p2(d,y)),t.max=(d,y)=>t.check(p2(d,y)),t.int=d=>t.check(OO(d)),t.safe=d=>t.check(OO(d)),t.positive=d=>t.check(MO(0,d)),t.nonnegative=d=>t.check(m2(0,d)),t.negative=d=>t.check(RO(0,d)),t.nonpositive=d=>t.check(p2(0,d)),t.multipleOf=(d,y)=>t.check(IO(d,y)),t.step=(d,y)=>t.check(IO(d,y)),t.finite=()=>t;const c=t._zod.bag;t.minValue=Math.max(c.minimum??Number.NEGATIVE_INFINITY,c.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(c.maximum??Number.POSITIVE_INFINITY,c.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),t.isFinite=!0,t.format=c.format??null});function Ax(t){return OJ(B3,t)}const Fee=En("ZodNumberFormat",(t,i)=>{BQ.init(t,i),B3.init(t,i)});function OO(t){return zJ(Fee,t)}const Bee=En("ZodUnknown",(t,i)=>{VQ.init(t,i),Ma.init(t,i)});function zO(){return LJ(Bee)}const Vee=En("ZodNever",(t,i)=>{UQ.init(t,i),Ma.init(t,i)});function Uee(t){return NJ(Vee,t)}const $ee=En("ZodArray",(t,i)=>{$Q.init(t,i),Ma.init(t,i),t.element=i.element,t.min=(c,d)=>t.check(Iw(c,d)),t.nonempty=c=>t.check(Iw(1,c)),t.max=(c,d)=>t.check(k3(c,d)),t.length=(c,d)=>t.check(j3(c,d)),t.unwrap=()=>t.element});function cC(t,i){return WJ($ee,t,i)}const Gee=En("ZodObject",(t,i)=>{HQ.init(t,i),Ma.init(t,i),no(t,"shape",()=>i.shape),t.keyof=()=>Gx(Object.keys(t._zod.def.shape)),t.catchall=c=>t.clone({...t._zod.def,catchall:c}),t.passthrough=()=>t.clone({...t._zod.def,catchall:zO()}),t.loose=()=>t.clone({...t._zod.def,catchall:zO()}),t.strict=()=>t.clone({...t._zod.def,catchall:Uee()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=c=>dY(t,c),t.safeExtend=c=>hY(t,c),t.merge=c=>fY(t,c),t.pick=c=>cY(t,c),t.omit=c=>uY(t,c),t.partial=(...c)=>pY(V3,t,c[0]),t.required=(...c)=>mY(U3,t,c[0])});function fg(t,i){const c={type:"object",shape:t??{},...Wi(i)};return new Gee(c)}const Hee=En("ZodUnion",(t,i)=>{qQ.init(t,i),Ma.init(t,i),t.options=i.options});function qee(t,i){return new Hee({type:"union",options:t,...Wi(i)})}const Zee=En("ZodIntersection",(t,i)=>{ZQ.init(t,i),Ma.init(t,i)});function Wee(t,i){return new Zee({type:"intersection",left:t,right:i})}const RE=En("ZodEnum",(t,i)=>{WQ.init(t,i),Ma.init(t,i),t.enum=i.entries,t.options=Object.values(i.entries);const c=new Set(Object.keys(i.entries));t.extract=(d,y)=>{const w={};for(const E of d)if(c.has(E))w[E]=i.entries[E];else throw new Error(`Key ${E} not found in enum`);return new RE({...i,checks:[],...Wi(y),entries:w})},t.exclude=(d,y)=>{const w={...i.entries};for(const E of d)if(c.has(E))delete w[E];else throw new Error(`Key ${E} not found in enum`);return new RE({...i,checks:[],...Wi(y),entries:w})}});function Gx(t,i){const c=Array.isArray(t)?Object.fromEntries(t.map(d=>[d,d])):t;return new RE({type:"enum",entries:c,...Wi(i)})}const Xee=En("ZodTransform",(t,i)=>{XQ.init(t,i),Ma.init(t,i),t._zod.parse=(c,d)=>{if(d.direction==="backward")throw new b3(t.constructor.name);c.addIssue=w=>{if(typeof w=="string")c.issues.push(N0(w,c.value,i));else{const E=w;E.fatal&&(E.continue=!1),E.code??(E.code="custom"),E.input??(E.input=c.value),E.inst??(E.inst=t),c.issues.push(N0(E))}};const y=i.transform(c.value,c);return y instanceof Promise?y.then(w=>(c.value=w,c)):(c.value=y,c)}});function Kee(t){return new Xee({type:"transform",transform:t})}const V3=En("ZodOptional",(t,i)=>{KQ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType});function LO(t){return new V3({type:"optional",innerType:t})}const Yee=En("ZodNullable",(t,i)=>{YQ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType});function NO(t){return new Yee({type:"nullable",innerType:t})}const Qee=En("ZodDefault",(t,i)=>{QQ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Jee(t,i){return new Qee({type:"default",innerType:t,get defaultValue(){return typeof i=="function"?i():T3(i)}})}const ete=En("ZodPrefault",(t,i)=>{JQ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType});function tte(t,i){return new ete({type:"prefault",innerType:t,get defaultValue(){return typeof i=="function"?i():T3(i)}})}const U3=En("ZodNonOptional",(t,i)=>{eJ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType});function nte(t,i){return new U3({type:"nonoptional",innerType:t,...Wi(i)})}const ite=En("ZodCatch",(t,i)=>{tJ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function rte(t,i){return new ite({type:"catch",innerType:t,catchValue:typeof i=="function"?i:()=>i})}const ste=En("ZodPipe",(t,i)=>{nJ.init(t,i),Ma.init(t,i),t.in=i.in,t.out=i.out});function kO(t,i){return new ste({type:"pipe",in:t,out:i})}const ote=En("ZodReadonly",(t,i)=>{iJ.init(t,i),Ma.init(t,i),t.unwrap=()=>t._zod.def.innerType});function ate(t){return new ote({type:"readonly",innerType:t})}const lte=En("ZodCustom",(t,i)=>{rJ.init(t,i),Ma.init(t,i)});function cte(t,i={}){return XJ(lte,t,i)}function ute(t){return KJ(t)}var dte=HE[" useId ".trim().toString()]||(()=>{}),hte=0;function yx(t){const[i,c]=Z.useState(dte());return cl(()=>{c(d=>d??String(hte++))},[t]),i?`radix-${i}`:""}var g2="focusScope.autoFocusOnMount",_2="focusScope.autoFocusOnUnmount",jO={bubbles:!1,cancelable:!0},fte="FocusScope",uC=Z.forwardRef((t,i)=>{const{loop:c=!1,trapped:d=!1,onMountAutoFocus:y,onUnmountAutoFocus:w,...E}=t,[s,O]=Z.useState(null),z=lh(y),j=lh(w),H=Z.useRef(null),Y=Mo(i,ee=>O(ee)),ie=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(d){let ee=function(_e){if(ie.paused||!s)return;const Re=_e.target;s.contains(Re)?H.current=Re:Jm(H.current,{select:!0})},le=function(_e){if(ie.paused||!s)return;const Re=_e.relatedTarget;Re!==null&&(s.contains(Re)||Jm(H.current,{select:!0}))},ge=function(_e){if(document.activeElement===document.body)for(const xe of _e)xe.removedNodes.length>0&&Jm(s)};document.addEventListener("focusin",ee),document.addEventListener("focusout",le);const pe=new MutationObserver(ge);return s&&pe.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",ee),document.removeEventListener("focusout",le),pe.disconnect()}}},[d,s,ie.paused]),Z.useEffect(()=>{if(s){BO.add(ie);const ee=document.activeElement;if(!s.contains(ee)){const ge=new CustomEvent(g2,jO);s.addEventListener(g2,z),s.dispatchEvent(ge),ge.defaultPrevented||(pte(xte($3(s)),{select:!0}),document.activeElement===ee&&Jm(s))}return()=>{s.removeEventListener(g2,z),setTimeout(()=>{const ge=new CustomEvent(_2,jO);s.addEventListener(_2,j),s.dispatchEvent(ge),ge.defaultPrevented||Jm(ee??document.body,{select:!0}),s.removeEventListener(_2,j),BO.remove(ie)},0)}}},[s,z,j,ie]);const oe=Z.useCallback(ee=>{if(!c&&!d||ie.paused)return;const le=ee.key==="Tab"&&!ee.altKey&&!ee.ctrlKey&&!ee.metaKey,ge=document.activeElement;if(le&&ge){const pe=ee.currentTarget,[_e,Re]=mte(pe);_e&&Re?!ee.shiftKey&&ge===Re?(ee.preventDefault(),c&&Jm(_e,{select:!0})):ee.shiftKey&&ge===_e&&(ee.preventDefault(),c&&Jm(Re,{select:!0})):ge===pe&&ee.preventDefault()}},[c,d,ie.paused]);return C.jsx(As.div,{tabIndex:-1,...E,ref:Y,onKeyDown:oe})});uC.displayName=fte;function pte(t,{select:i=!1}={}){const c=document.activeElement;for(const d of t)if(Jm(d,{select:i}),document.activeElement!==c)return}function mte(t){const i=$3(t),c=FO(i,t),d=FO(i.reverse(),t);return[c,d]}function $3(t){const i=[],c=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const y=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||y?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)i.push(c.currentNode);return i}function FO(t,i){for(const c of t)if(!gte(c,{upTo:i}))return c}function gte(t,{upTo:i}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(i!==void 0&&t===i)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function _te(t){return t instanceof HTMLInputElement&&"select"in t}function Jm(t,{select:i=!1}={}){if(t&&t.focus){const c=document.activeElement;t.focus({preventScroll:!0}),t!==c&&_te(t)&&i&&t.select()}}var BO=yte();function yte(){let t=[];return{add(i){const c=t[0];i!==c&&c?.pause(),t=VO(t,i),t.unshift(i)},remove(i){t=VO(t,i),t[0]?.resume()}}}function VO(t,i){const c=[...t],d=c.indexOf(i);return d!==-1&&c.splice(d,1),c}function xte(t){return t.filter(i=>i.tagName!=="A")}var y2=0;function G3(){Z.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??UO()),document.body.insertAdjacentElement("beforeend",t[1]??UO()),y2++,()=>{y2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),y2--}},[])}function UO(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var gf=function(){return gf=Object.assign||function(i){for(var c,d=1,y=arguments.length;d<y;d++){c=arguments[d];for(var w in c)Object.prototype.hasOwnProperty.call(c,w)&&(i[w]=c[w])}return i},gf.apply(this,arguments)};function H3(t,i){var c={};for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&i.indexOf(d)<0&&(c[d]=t[d]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,d=Object.getOwnPropertySymbols(t);y<d.length;y++)i.indexOf(d[y])<0&&Object.prototype.propertyIsEnumerable.call(t,d[y])&&(c[d[y]]=t[d[y]]);return c}function vte(t,i,c){if(c||arguments.length===2)for(var d=0,y=i.length,w;d<y;d++)(w||!(d in i))&&(w||(w=Array.prototype.slice.call(i,0,d)),w[d]=i[d]);return t.concat(w||Array.prototype.slice.call(i))}var sw="right-scroll-bar-position",ow="width-before-scroll-bar",bte="with-scroll-bars-hidden",wte="--removed-body-scroll-bar-size";function x2(t,i){return typeof t=="function"?t(i):t&&(t.current=i),t}function Ste(t,i){var c=Z.useState(function(){return{value:t,callback:i,facade:{get current(){return c.value},set current(d){var y=c.value;y!==d&&(c.value=d,c.callback(d,y))}}}})[0];return c.callback=i,c.facade}var Tte=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,$O=new WeakMap;function Ete(t,i){var c=Ste(null,function(d){return t.forEach(function(y){return x2(y,d)})});return Tte(function(){var d=$O.get(c);if(d){var y=new Set(d),w=new Set(t),E=c.current;y.forEach(function(s){w.has(s)||x2(s,null)}),w.forEach(function(s){y.has(s)||x2(s,E)})}$O.set(c,t)},[t]),c}function Ate(t){return t}function Cte(t,i){i===void 0&&(i=Ate);var c=[],d=!1,y={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return c.length?c[c.length-1]:t},useMedium:function(w){var E=i(w,d);return c.push(E),function(){c=c.filter(function(s){return s!==E})}},assignSyncMedium:function(w){for(d=!0;c.length;){var E=c;c=[],E.forEach(w)}c={push:function(s){return w(s)},filter:function(){return c}}},assignMedium:function(w){d=!0;var E=[];if(c.length){var s=c;c=[],s.forEach(w),E=c}var O=function(){var j=E;E=[],j.forEach(w)},z=function(){return Promise.resolve().then(O)};z(),c={push:function(j){E.push(j),z()},filter:function(j){return E=E.filter(j),c}}}};return y}function Rte(t){t===void 0&&(t={});var i=Cte(null);return i.options=gf({async:!0,ssr:!1},t),i}var q3=function(t){var i=t.sideCar,c=H3(t,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=i.read();if(!d)throw new Error("Sidecar medium not found");return Z.createElement(d,gf({},c))};q3.isSideCarExport=!0;function Mte(t,i){return t.useMedium(i),q3}var Z3=Rte(),v2=function(){},mS=Z.forwardRef(function(t,i){var c=Z.useRef(null),d=Z.useState({onScrollCapture:v2,onWheelCapture:v2,onTouchMoveCapture:v2}),y=d[0],w=d[1],E=t.forwardProps,s=t.children,O=t.className,z=t.removeScrollBar,j=t.enabled,H=t.shards,Y=t.sideCar,ie=t.noRelative,oe=t.noIsolation,ee=t.inert,le=t.allowPinchZoom,ge=t.as,pe=ge===void 0?"div":ge,_e=t.gapMode,Re=H3(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),xe=Y,Ze=Ete([c,i]),Le=gf(gf({},Re),y);return Z.createElement(Z.Fragment,null,j&&Z.createElement(xe,{sideCar:Z3,removeScrollBar:z,shards:H,noRelative:ie,noIsolation:oe,inert:ee,setCallbacks:w,allowPinchZoom:!!le,lockRef:c,gapMode:_e}),E?Z.cloneElement(Z.Children.only(s),gf(gf({},Le),{ref:Ze})):Z.createElement(pe,gf({},Le,{className:O,ref:Ze}),s))});mS.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};mS.classNames={fullWidth:ow,zeroRight:sw};var Ite=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Dte(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var i=Ite();return i&&t.setAttribute("nonce",i),t}function Pte(t,i){t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i))}function Ote(t){var i=document.head||document.getElementsByTagName("head")[0];i.appendChild(t)}var zte=function(){var t=0,i=null;return{add:function(c){t==0&&(i=Dte())&&(Pte(i,c),Ote(i)),t++},remove:function(){t--,!t&&i&&(i.parentNode&&i.parentNode.removeChild(i),i=null)}}},Lte=function(){var t=zte();return function(i,c){Z.useEffect(function(){return t.add(i),function(){t.remove()}},[i&&c])}},W3=function(){var t=Lte(),i=function(c){var d=c.styles,y=c.dynamic;return t(d,y),null};return i},Nte={left:0,top:0,right:0,gap:0},b2=function(t){return parseInt(t||"",10)||0},kte=function(t){var i=window.getComputedStyle(document.body),c=i[t==="padding"?"paddingLeft":"marginLeft"],d=i[t==="padding"?"paddingTop":"marginTop"],y=i[t==="padding"?"paddingRight":"marginRight"];return[b2(c),b2(d),b2(y)]},jte=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Nte;var i=kte(t),c=document.documentElement.clientWidth,d=window.innerWidth;return{left:i[0],top:i[1],right:i[2],gap:Math.max(0,d-c+i[2]-i[0])}},Fte=W3(),xx="data-scroll-locked",Bte=function(t,i,c,d){var y=t.left,w=t.top,E=t.right,s=t.gap;return c===void 0&&(c="margin"),`
  .`.concat(bte,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(s,"px ").concat(d,`;
  }
  body[`).concat(xx,`] {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([i&&"position: relative ".concat(d,";"),c==="margin"&&`
    padding-left: `.concat(y,`px;
    padding-top: `).concat(w,`px;
    padding-right: `).concat(E,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(d,`;
    `),c==="padding"&&"padding-right: ".concat(s,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(sw,` {
    right: `).concat(s,"px ").concat(d,`;
  }
  
  .`).concat(ow,` {
    margin-right: `).concat(s,"px ").concat(d,`;
  }
  
  .`).concat(sw," .").concat(sw,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(ow," .").concat(ow,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body[`).concat(xx,`] {
    `).concat(wte,": ").concat(s,`px;
  }
`)},GO=function(){var t=parseInt(document.body.getAttribute(xx)||"0",10);return isFinite(t)?t:0},Vte=function(){Z.useEffect(function(){return document.body.setAttribute(xx,(GO()+1).toString()),function(){var t=GO()-1;t<=0?document.body.removeAttribute(xx):document.body.setAttribute(xx,t.toString())}},[])},Ute=function(t){var i=t.noRelative,c=t.noImportant,d=t.gapMode,y=d===void 0?"margin":d;Vte();var w=Z.useMemo(function(){return jte(y)},[y]);return Z.createElement(Fte,{styles:Bte(w,!i,y,c?"":"!important")})},ME=!1;if(typeof window<"u")try{var k1=Object.defineProperty({},"passive",{get:function(){return ME=!0,!0}});window.addEventListener("test",k1,k1),window.removeEventListener("test",k1,k1)}catch{ME=!1}var nx=ME?{passive:!1}:!1,$te=function(t){return t.tagName==="TEXTAREA"},X3=function(t,i){if(!(t instanceof Element))return!1;var c=window.getComputedStyle(t);return c[i]!=="hidden"&&!(c.overflowY===c.overflowX&&!$te(t)&&c[i]==="visible")},Gte=function(t){return X3(t,"overflowY")},Hte=function(t){return X3(t,"overflowX")},HO=function(t,i){var c=i.ownerDocument,d=i;do{typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&(d=d.host);var y=K3(t,d);if(y){var w=Y3(t,d),E=w[1],s=w[2];if(E>s)return!0}d=d.parentNode}while(d&&d!==c.body);return!1},qte=function(t){var i=t.scrollTop,c=t.scrollHeight,d=t.clientHeight;return[i,c,d]},Zte=function(t){var i=t.scrollLeft,c=t.scrollWidth,d=t.clientWidth;return[i,c,d]},K3=function(t,i){return t==="v"?Gte(i):Hte(i)},Y3=function(t,i){return t==="v"?qte(i):Zte(i)},Wte=function(t,i){return t==="h"&&i==="rtl"?-1:1},Xte=function(t,i,c,d,y){var w=Wte(t,window.getComputedStyle(i).direction),E=w*d,s=c.target,O=i.contains(s),z=!1,j=E>0,H=0,Y=0;do{if(!s)break;var ie=Y3(t,s),oe=ie[0],ee=ie[1],le=ie[2],ge=ee-le-w*oe;(oe||ge)&&K3(t,s)&&(H+=ge,Y+=oe);var pe=s.parentNode;s=pe&&pe.nodeType===Node.DOCUMENT_FRAGMENT_NODE?pe.host:pe}while(!O&&s!==document.body||O&&(i.contains(s)||i===s));return(j&&Math.abs(H)<1||!j&&Math.abs(Y)<1)&&(z=!0),z},j1=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},qO=function(t){return[t.deltaX,t.deltaY]},ZO=function(t){return t&&"current"in t?t.current:t},Kte=function(t,i){return t[0]===i[0]&&t[1]===i[1]},Yte=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Qte=0,ix=[];function Jte(t){var i=Z.useRef([]),c=Z.useRef([0,0]),d=Z.useRef(),y=Z.useState(Qte++)[0],w=Z.useState(W3)[0],E=Z.useRef(t);Z.useEffect(function(){E.current=t},[t]),Z.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(y));var ee=vte([t.lockRef.current],(t.shards||[]).map(ZO),!0).filter(Boolean);return ee.forEach(function(le){return le.classList.add("allow-interactivity-".concat(y))}),function(){document.body.classList.remove("block-interactivity-".concat(y)),ee.forEach(function(le){return le.classList.remove("allow-interactivity-".concat(y))})}}},[t.inert,t.lockRef.current,t.shards]);var s=Z.useCallback(function(ee,le){if("touches"in ee&&ee.touches.length===2||ee.type==="wheel"&&ee.ctrlKey)return!E.current.allowPinchZoom;var ge=j1(ee),pe=c.current,_e="deltaX"in ee?ee.deltaX:pe[0]-ge[0],Re="deltaY"in ee?ee.deltaY:pe[1]-ge[1],xe,Ze=ee.target,Le=Math.abs(_e)>Math.abs(Re)?"h":"v";if("touches"in ee&&Le==="h"&&Ze.type==="range")return!1;var $e=HO(Le,Ze);if(!$e)return!0;if($e?xe=Le:(xe=Le==="v"?"h":"v",$e=HO(Le,Ze)),!$e)return!1;if(!d.current&&"changedTouches"in ee&&(_e||Re)&&(d.current=xe),!xe)return!0;var st=d.current||xe;return Xte(st,le,ee,st==="h"?_e:Re)},[]),O=Z.useCallback(function(ee){var le=ee;if(!(!ix.length||ix[ix.length-1]!==w)){var ge="deltaY"in le?qO(le):j1(le),pe=i.current.filter(function(xe){return xe.name===le.type&&(xe.target===le.target||le.target===xe.shadowParent)&&Kte(xe.delta,ge)})[0];if(pe&&pe.should){le.cancelable&&le.preventDefault();return}if(!pe){var _e=(E.current.shards||[]).map(ZO).filter(Boolean).filter(function(xe){return xe.contains(le.target)}),Re=_e.length>0?s(le,_e[0]):!E.current.noIsolation;Re&&le.cancelable&&le.preventDefault()}}},[]),z=Z.useCallback(function(ee,le,ge,pe){var _e={name:ee,delta:le,target:ge,should:pe,shadowParent:ene(ge)};i.current.push(_e),setTimeout(function(){i.current=i.current.filter(function(Re){return Re!==_e})},1)},[]),j=Z.useCallback(function(ee){c.current=j1(ee),d.current=void 0},[]),H=Z.useCallback(function(ee){z(ee.type,qO(ee),ee.target,s(ee,t.lockRef.current))},[]),Y=Z.useCallback(function(ee){z(ee.type,j1(ee),ee.target,s(ee,t.lockRef.current))},[]);Z.useEffect(function(){return ix.push(w),t.setCallbacks({onScrollCapture:H,onWheelCapture:H,onTouchMoveCapture:Y}),document.addEventListener("wheel",O,nx),document.addEventListener("touchmove",O,nx),document.addEventListener("touchstart",j,nx),function(){ix=ix.filter(function(ee){return ee!==w}),document.removeEventListener("wheel",O,nx),document.removeEventListener("touchmove",O,nx),document.removeEventListener("touchstart",j,nx)}},[]);var ie=t.removeScrollBar,oe=t.inert;return Z.createElement(Z.Fragment,null,oe?Z.createElement(w,{styles:Yte(y)}):null,ie?Z.createElement(Ute,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function ene(t){for(var i=null;t!==null;)t instanceof ShadowRoot&&(i=t.host,t=t.host),t=t.parentNode;return i}const tne=Mte(Z3,Jte);var dC=Z.forwardRef(function(t,i){return Z.createElement(mS,gf({},t,{ref:i,sideCar:tne}))});dC.classNames=mS.classNames;var nne=function(t){if(typeof document>"u")return null;var i=Array.isArray(t)?t[0]:t;return i.ownerDocument.body},rx=new WeakMap,F1=new WeakMap,B1={},w2=0,Q3=function(t){return t&&(t.host||Q3(t.parentNode))},ine=function(t,i){return i.map(function(c){if(t.contains(c))return c;var d=Q3(c);return d&&t.contains(d)?d:(console.error("aria-hidden",c,"in not contained inside",t,". Doing nothing"),null)}).filter(function(c){return!!c})},rne=function(t,i,c,d){var y=ine(i,Array.isArray(t)?t:[t]);B1[c]||(B1[c]=new WeakMap);var w=B1[c],E=[],s=new Set,O=new Set(y),z=function(H){!H||s.has(H)||(s.add(H),z(H.parentNode))};y.forEach(z);var j=function(H){!H||O.has(H)||Array.prototype.forEach.call(H.children,function(Y){if(s.has(Y))j(Y);else try{var ie=Y.getAttribute(d),oe=ie!==null&&ie!=="false",ee=(rx.get(Y)||0)+1,le=(w.get(Y)||0)+1;rx.set(Y,ee),w.set(Y,le),E.push(Y),ee===1&&oe&&F1.set(Y,!0),le===1&&Y.setAttribute(c,"true"),oe||Y.setAttribute(d,"true")}catch(ge){console.error("aria-hidden: cannot operate on ",Y,ge)}})};return j(i),s.clear(),w2++,function(){E.forEach(function(H){var Y=rx.get(H)-1,ie=w.get(H)-1;rx.set(H,Y),w.set(H,ie),Y||(F1.has(H)||H.removeAttribute(d),F1.delete(H)),ie||H.removeAttribute(c)}),w2--,w2||(rx=new WeakMap,rx=new WeakMap,F1=new WeakMap,B1={})}},J3=function(t,i,c){c===void 0&&(c="data-aria-hidden");var d=Array.from(Array.isArray(t)?t:[t]),y=nne(t);return y?(d.push.apply(d,Array.from(y.querySelectorAll("[aria-live], script"))),rne(d,y,c,"aria-hidden")):function(){return null}};function sne(t){const i=one(t),c=Z.forwardRef((d,y)=>{const{children:w,...E}=d,s=Z.Children.toArray(w),O=s.find(lne);if(O){const z=O.props.children,j=s.map(H=>H===O?Z.Children.count(z)>1?Z.Children.only(null):Z.isValidElement(z)?z.props.children:null:H);return C.jsx(i,{...E,ref:y,children:Z.isValidElement(z)?Z.cloneElement(z,void 0,j):null})}return C.jsx(i,{...E,ref:y,children:w})});return c.displayName=`${t}.Slot`,c}function one(t){const i=Z.forwardRef((c,d)=>{const{children:y,...w}=c;if(Z.isValidElement(y)){const E=une(y),s=cne(w,y.props);return y.type!==Z.Fragment&&(s.ref=d?kx(d,E):E),Z.cloneElement(y,s)}return Z.Children.count(y)>1?Z.Children.only(null):null});return i.displayName=`${t}.SlotClone`,i}var ane=Symbol("radix.slottable");function lne(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===ane}function cne(t,i){const c={...i};for(const d in i){const y=t[d],w=i[d];/^on[A-Z]/.test(d)?y&&w?c[d]=(...s)=>{const O=w(...s);return y(...s),O}:y&&(c[d]=y):d==="style"?c[d]={...y,...w}:d==="className"&&(c[d]=[y,w].filter(Boolean).join(" "))}return{...t,...c}}function une(t){let i=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=Object.getOwnPropertyDescriptor(t,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}var gS="Dialog",[ej]=K0(gS),[dne,_h]=ej(gS),tj=t=>{const{__scopeDialog:i,children:c,open:d,defaultOpen:y,onOpenChange:w,modal:E=!0}=t,s=Z.useRef(null),O=Z.useRef(null),[z,j]=gw({prop:d,defaultProp:y??!1,onChange:w,caller:gS});return C.jsx(dne,{scope:i,triggerRef:s,contentRef:O,contentId:yx(),titleId:yx(),descriptionId:yx(),open:z,onOpenChange:j,onOpenToggle:Z.useCallback(()=>j(H=>!H),[j]),modal:E,children:c})};tj.displayName=gS;var nj="DialogTrigger",hne=Z.forwardRef((t,i)=>{const{__scopeDialog:c,...d}=t,y=_h(nj,c),w=Mo(i,y.triggerRef);return C.jsx(As.button,{type:"button","aria-haspopup":"dialog","aria-expanded":y.open,"aria-controls":y.contentId,"data-state":pC(y.open),...d,ref:w,onClick:ls(t.onClick,y.onOpenToggle)})});hne.displayName=nj;var hC="DialogPortal",[fne,ij]=ej(hC,{forceMount:void 0}),rj=t=>{const{__scopeDialog:i,forceMount:c,children:d,container:y}=t,w=_h(hC,i);return C.jsx(fne,{scope:i,forceMount:c,children:Z.Children.map(d,E=>C.jsx(Y0,{present:c||w.open,children:C.jsx(Jw,{asChild:!0,container:y,children:E})}))})};rj.displayName=hC;var Dw="DialogOverlay",sj=Z.forwardRef((t,i)=>{const c=ij(Dw,t.__scopeDialog),{forceMount:d=c.forceMount,...y}=t,w=_h(Dw,t.__scopeDialog);return w.modal?C.jsx(Y0,{present:d||w.open,children:C.jsx(mne,{...y,ref:i})}):null});sj.displayName=Dw;var pne=sne("DialogOverlay.RemoveScroll"),mne=Z.forwardRef((t,i)=>{const{__scopeDialog:c,...d}=t,y=_h(Dw,c);return C.jsx(dC,{as:pne,allowPinchZoom:!0,shards:[y.contentRef],children:C.jsx(As.div,{"data-state":pC(y.open),...d,ref:i,style:{pointerEvents:"auto",...d.style}})})}),H_="DialogContent",oj=Z.forwardRef((t,i)=>{const c=ij(H_,t.__scopeDialog),{forceMount:d=c.forceMount,...y}=t,w=_h(H_,t.__scopeDialog);return C.jsx(Y0,{present:d||w.open,children:w.modal?C.jsx(gne,{...y,ref:i}):C.jsx(_ne,{...y,ref:i})})});oj.displayName=H_;var gne=Z.forwardRef((t,i)=>{const c=_h(H_,t.__scopeDialog),d=Z.useRef(null),y=Mo(i,c.contentRef,d);return Z.useEffect(()=>{const w=d.current;if(w)return J3(w)},[]),C.jsx(aj,{...t,ref:y,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ls(t.onCloseAutoFocus,w=>{w.preventDefault(),c.triggerRef.current?.focus()}),onPointerDownOutside:ls(t.onPointerDownOutside,w=>{const E=w.detail.originalEvent,s=E.button===0&&E.ctrlKey===!0;(E.button===2||s)&&w.preventDefault()}),onFocusOutside:ls(t.onFocusOutside,w=>w.preventDefault())})}),_ne=Z.forwardRef((t,i)=>{const c=_h(H_,t.__scopeDialog),d=Z.useRef(!1),y=Z.useRef(!1);return C.jsx(aj,{...t,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:w=>{t.onCloseAutoFocus?.(w),w.defaultPrevented||(d.current||c.triggerRef.current?.focus(),w.preventDefault()),d.current=!1,y.current=!1},onInteractOutside:w=>{t.onInteractOutside?.(w),w.defaultPrevented||(d.current=!0,w.detail.originalEvent.type==="pointerdown"&&(y.current=!0));const E=w.target;c.triggerRef.current?.contains(E)&&w.preventDefault(),w.detail.originalEvent.type==="focusin"&&y.current&&w.preventDefault()}})}),aj=Z.forwardRef((t,i)=>{const{__scopeDialog:c,trapFocus:d,onOpenAutoFocus:y,onCloseAutoFocus:w,...E}=t,s=_h(H_,c),O=Z.useRef(null),z=Mo(i,O);return G3(),C.jsxs(C.Fragment,{children:[C.jsx(uC,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:y,onUnmountAutoFocus:w,children:C.jsx(Qw,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":pC(s.open),...E,ref:z,onDismiss:()=>s.onOpenChange(!1)})}),C.jsxs(C.Fragment,{children:[C.jsx(yne,{titleId:s.titleId}),C.jsx(vne,{contentRef:O,descriptionId:s.descriptionId})]})]})}),fC="DialogTitle",lj=Z.forwardRef((t,i)=>{const{__scopeDialog:c,...d}=t,y=_h(fC,c);return C.jsx(As.h2,{id:y.titleId,...d,ref:i})});lj.displayName=fC;var cj="DialogDescription",uj=Z.forwardRef((t,i)=>{const{__scopeDialog:c,...d}=t,y=_h(cj,c);return C.jsx(As.p,{id:y.descriptionId,...d,ref:i})});uj.displayName=cj;var dj="DialogClose",hj=Z.forwardRef((t,i)=>{const{__scopeDialog:c,...d}=t,y=_h(dj,c);return C.jsx(As.button,{type:"button",...d,ref:i,onClick:ls(t.onClick,()=>y.onOpenChange(!1))})});hj.displayName=dj;function pC(t){return t?"open":"closed"}var fj="DialogTitleWarning",[Aae,pj]=aG(fj,{contentName:H_,titleName:fC,docsSlug:"dialog"}),yne=({titleId:t})=>{const i=pj(fj),c=`\`${i.contentName}\` requires a \`${i.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${i.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${i.docsSlug}`;return Z.useEffect(()=>{t&&(document.getElementById(t)||console.error(c))},[c,t]),null},xne="DialogDescriptionWarning",vne=({contentRef:t,descriptionId:i})=>{const d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${pj(xne).contentName}}.`;return Z.useEffect(()=>{const y=t.current?.getAttribute("aria-describedby");i&&y&&(document.getElementById(i)||console.warn(d))},[d,t,i]),null},bne=tj,wne=rj,mj=sj,gj=oj,_j=lj,yj=uj,Sne=hj;const Tf=bne,Tne=wne,xj=Z.forwardRef(({className:t,...i},c)=>C.jsx(mj,{ref:c,className:xs("fixed inset-0 z-[9999] bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i}));xj.displayName=mj.displayName;const ch=Z.forwardRef(({className:t,children:i,...c},d)=>C.jsxs(Tne,{children:[C.jsx(xj,{}),C.jsxs(gj,{ref:d,className:xs("fixed left-[50%] top-[50%] z-[9999] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-2xl",t),...c,children:[i,C.jsxs(Sne,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[C.jsx(tS,{className:"h-4 w-4"}),C.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ch.displayName=gj.displayName;const uh=({className:t,...i})=>C.jsx("div",{className:xs("flex flex-col space-y-1.5 text-center sm:text-left",t),...i});uh.displayName="DialogHeader";const Pw=({className:t,...i})=>C.jsx("div",{className:xs("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...i});Pw.displayName="DialogFooter";const dh=Z.forwardRef(({className:t,...i},c)=>C.jsx(_j,{ref:c,className:xs("text-lg font-semibold leading-none tracking-tight",t),...i}));dh.displayName=_j.displayName;const k0=Z.forwardRef(({className:t,...i},c)=>C.jsx(yj,{ref:c,className:xs("text-sm text-muted-foreground",t),...i}));k0.displayName=yj.displayName;function WO(t,[i,c]){return Math.min(c,Math.max(i,t))}var Ene=Z.createContext(void 0);function Ane(t){const i=Z.useContext(Ene);return t||i||"ltr"}const Cne=["top","right","bottom","left"],sg=Math.min,uu=Math.max,Ow=Math.round,V1=Math.floor,Sf=t=>({x:t,y:t}),Rne={left:"right",right:"left",bottom:"top",top:"bottom"},Mne={start:"end",end:"start"};function IE(t,i,c){return uu(t,sg(i,c))}function Np(t,i){return typeof t=="function"?t(i):t}function kp(t){return t.split("-")[0]}function Hx(t){return t.split("-")[1]}function mC(t){return t==="x"?"y":"x"}function gC(t){return t==="y"?"height":"width"}const Ine=new Set(["top","bottom"]);function vf(t){return Ine.has(kp(t))?"y":"x"}function _C(t){return mC(vf(t))}function Dne(t,i,c){c===void 0&&(c=!1);const d=Hx(t),y=_C(t),w=gC(y);let E=y==="x"?d===(c?"end":"start")?"right":"left":d==="start"?"bottom":"top";return i.reference[w]>i.floating[w]&&(E=zw(E)),[E,zw(E)]}function Pne(t){const i=zw(t);return[DE(t),i,DE(i)]}function DE(t){return t.replace(/start|end/g,i=>Mne[i])}const XO=["left","right"],KO=["right","left"],One=["top","bottom"],zne=["bottom","top"];function Lne(t,i,c){switch(t){case"top":case"bottom":return c?i?KO:XO:i?XO:KO;case"left":case"right":return i?One:zne;default:return[]}}function Nne(t,i,c,d){const y=Hx(t);let w=Lne(kp(t),c==="start",d);return y&&(w=w.map(E=>E+"-"+y),i&&(w=w.concat(w.map(DE)))),w}function zw(t){return t.replace(/left|right|bottom|top/g,i=>Rne[i])}function kne(t){return{top:0,right:0,bottom:0,left:0,...t}}function vj(t){return typeof t!="number"?kne(t):{top:t,right:t,bottom:t,left:t}}function Lw(t){const{x:i,y:c,width:d,height:y}=t;return{width:d,height:y,top:c,left:i,right:i+d,bottom:c+y,x:i,y:c}}function YO(t,i,c){let{reference:d,floating:y}=t;const w=vf(i),E=_C(i),s=gC(E),O=kp(i),z=w==="y",j=d.x+d.width/2-y.width/2,H=d.y+d.height/2-y.height/2,Y=d[s]/2-y[s]/2;let ie;switch(O){case"top":ie={x:j,y:d.y-y.height};break;case"bottom":ie={x:j,y:d.y+d.height};break;case"right":ie={x:d.x+d.width,y:H};break;case"left":ie={x:d.x-y.width,y:H};break;default:ie={x:d.x,y:d.y}}switch(Hx(i)){case"start":ie[E]-=Y*(c&&z?-1:1);break;case"end":ie[E]+=Y*(c&&z?-1:1);break}return ie}const jne=async(t,i,c)=>{const{placement:d="bottom",strategy:y="absolute",middleware:w=[],platform:E}=c,s=w.filter(Boolean),O=await(E.isRTL==null?void 0:E.isRTL(i));let z=await E.getElementRects({reference:t,floating:i,strategy:y}),{x:j,y:H}=YO(z,d,O),Y=d,ie={},oe=0;for(let ee=0;ee<s.length;ee++){const{name:le,fn:ge}=s[ee],{x:pe,y:_e,data:Re,reset:xe}=await ge({x:j,y:H,initialPlacement:d,placement:Y,strategy:y,middlewareData:ie,rects:z,platform:E,elements:{reference:t,floating:i}});j=pe??j,H=_e??H,ie={...ie,[le]:{...ie[le],...Re}},xe&&oe<=50&&(oe++,typeof xe=="object"&&(xe.placement&&(Y=xe.placement),xe.rects&&(z=xe.rects===!0?await E.getElementRects({reference:t,floating:i,strategy:y}):xe.rects),{x:j,y:H}=YO(z,Y,O)),ee=-1)}return{x:j,y:H,placement:Y,strategy:y,middlewareData:ie}};async function j0(t,i){var c;i===void 0&&(i={});const{x:d,y,platform:w,rects:E,elements:s,strategy:O}=t,{boundary:z="clippingAncestors",rootBoundary:j="viewport",elementContext:H="floating",altBoundary:Y=!1,padding:ie=0}=Np(i,t),oe=vj(ie),le=s[Y?H==="floating"?"reference":"floating":H],ge=Lw(await w.getClippingRect({element:(c=await(w.isElement==null?void 0:w.isElement(le)))==null||c?le:le.contextElement||await(w.getDocumentElement==null?void 0:w.getDocumentElement(s.floating)),boundary:z,rootBoundary:j,strategy:O})),pe=H==="floating"?{x:d,y,width:E.floating.width,height:E.floating.height}:E.reference,_e=await(w.getOffsetParent==null?void 0:w.getOffsetParent(s.floating)),Re=await(w.isElement==null?void 0:w.isElement(_e))?await(w.getScale==null?void 0:w.getScale(_e))||{x:1,y:1}:{x:1,y:1},xe=Lw(w.convertOffsetParentRelativeRectToViewportRelativeRect?await w.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:pe,offsetParent:_e,strategy:O}):pe);return{top:(ge.top-xe.top+oe.top)/Re.y,bottom:(xe.bottom-ge.bottom+oe.bottom)/Re.y,left:(ge.left-xe.left+oe.left)/Re.x,right:(xe.right-ge.right+oe.right)/Re.x}}const Fne=t=>({name:"arrow",options:t,async fn(i){const{x:c,y:d,placement:y,rects:w,platform:E,elements:s,middlewareData:O}=i,{element:z,padding:j=0}=Np(t,i)||{};if(z==null)return{};const H=vj(j),Y={x:c,y:d},ie=_C(y),oe=gC(ie),ee=await E.getDimensions(z),le=ie==="y",ge=le?"top":"left",pe=le?"bottom":"right",_e=le?"clientHeight":"clientWidth",Re=w.reference[oe]+w.reference[ie]-Y[ie]-w.floating[oe],xe=Y[ie]-w.reference[ie],Ze=await(E.getOffsetParent==null?void 0:E.getOffsetParent(z));let Le=Ze?Ze[_e]:0;(!Le||!await(E.isElement==null?void 0:E.isElement(Ze)))&&(Le=s.floating[_e]||w.floating[oe]);const $e=Re/2-xe/2,st=Le/2-ee[oe]/2-1,Et=sg(H[ge],st),Ut=sg(H[pe],st),$t=Et,tt=Le-ee[oe]-Ut,ut=Le/2-ee[oe]/2+$e,on=IE($t,ut,tt),Ke=!O.arrow&&Hx(y)!=null&&ut!==on&&w.reference[oe]/2-(ut<$t?Et:Ut)-ee[oe]/2<0,ze=Ke?ut<$t?ut-$t:ut-tt:0;return{[ie]:Y[ie]+ze,data:{[ie]:on,centerOffset:ut-on-ze,...Ke&&{alignmentOffset:ze}},reset:Ke}}}),Bne=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(i){var c,d;const{placement:y,middlewareData:w,rects:E,initialPlacement:s,platform:O,elements:z}=i,{mainAxis:j=!0,crossAxis:H=!0,fallbackPlacements:Y,fallbackStrategy:ie="bestFit",fallbackAxisSideDirection:oe="none",flipAlignment:ee=!0,...le}=Np(t,i);if((c=w.arrow)!=null&&c.alignmentOffset)return{};const ge=kp(y),pe=vf(s),_e=kp(s)===s,Re=await(O.isRTL==null?void 0:O.isRTL(z.floating)),xe=Y||(_e||!ee?[zw(s)]:Pne(s)),Ze=oe!=="none";!Y&&Ze&&xe.push(...Nne(s,ee,oe,Re));const Le=[s,...xe],$e=await j0(i,le),st=[];let Et=((d=w.flip)==null?void 0:d.overflows)||[];if(j&&st.push($e[ge]),H){const ut=Dne(y,E,Re);st.push($e[ut[0]],$e[ut[1]])}if(Et=[...Et,{placement:y,overflows:st}],!st.every(ut=>ut<=0)){var Ut,$t;const ut=(((Ut=w.flip)==null?void 0:Ut.index)||0)+1,on=Le[ut];if(on&&(!(H==="alignment"?pe!==vf(on):!1)||Et.every(Fe=>vf(Fe.placement)===pe?Fe.overflows[0]>0:!0)))return{data:{index:ut,overflows:Et},reset:{placement:on}};let Ke=($t=Et.filter(ze=>ze.overflows[0]<=0).sort((ze,Fe)=>ze.overflows[1]-Fe.overflows[1])[0])==null?void 0:$t.placement;if(!Ke)switch(ie){case"bestFit":{var tt;const ze=(tt=Et.filter(Fe=>{if(Ze){const kt=vf(Fe.placement);return kt===pe||kt==="y"}return!0}).map(Fe=>[Fe.placement,Fe.overflows.filter(kt=>kt>0).reduce((kt,fn)=>kt+fn,0)]).sort((Fe,kt)=>Fe[1]-kt[1])[0])==null?void 0:tt[0];ze&&(Ke=ze);break}case"initialPlacement":Ke=s;break}if(y!==Ke)return{reset:{placement:Ke}}}return{}}}};function QO(t,i){return{top:t.top-i.height,right:t.right-i.width,bottom:t.bottom-i.height,left:t.left-i.width}}function JO(t){return Cne.some(i=>t[i]>=0)}const Vne=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(i){const{rects:c}=i,{strategy:d="referenceHidden",...y}=Np(t,i);switch(d){case"referenceHidden":{const w=await j0(i,{...y,elementContext:"reference"}),E=QO(w,c.reference);return{data:{referenceHiddenOffsets:E,referenceHidden:JO(E)}}}case"escaped":{const w=await j0(i,{...y,altBoundary:!0}),E=QO(w,c.floating);return{data:{escapedOffsets:E,escaped:JO(E)}}}default:return{}}}}},bj=new Set(["left","top"]);async function Une(t,i){const{placement:c,platform:d,elements:y}=t,w=await(d.isRTL==null?void 0:d.isRTL(y.floating)),E=kp(c),s=Hx(c),O=vf(c)==="y",z=bj.has(E)?-1:1,j=w&&O?-1:1,H=Np(i,t);let{mainAxis:Y,crossAxis:ie,alignmentAxis:oe}=typeof H=="number"?{mainAxis:H,crossAxis:0,alignmentAxis:null}:{mainAxis:H.mainAxis||0,crossAxis:H.crossAxis||0,alignmentAxis:H.alignmentAxis};return s&&typeof oe=="number"&&(ie=s==="end"?oe*-1:oe),O?{x:ie*j,y:Y*z}:{x:Y*z,y:ie*j}}const $ne=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(i){var c,d;const{x:y,y:w,placement:E,middlewareData:s}=i,O=await Une(i,t);return E===((c=s.offset)==null?void 0:c.placement)&&(d=s.arrow)!=null&&d.alignmentOffset?{}:{x:y+O.x,y:w+O.y,data:{...O,placement:E}}}}},Gne=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(i){const{x:c,y:d,placement:y}=i,{mainAxis:w=!0,crossAxis:E=!1,limiter:s={fn:le=>{let{x:ge,y:pe}=le;return{x:ge,y:pe}}},...O}=Np(t,i),z={x:c,y:d},j=await j0(i,O),H=vf(kp(y)),Y=mC(H);let ie=z[Y],oe=z[H];if(w){const le=Y==="y"?"top":"left",ge=Y==="y"?"bottom":"right",pe=ie+j[le],_e=ie-j[ge];ie=IE(pe,ie,_e)}if(E){const le=H==="y"?"top":"left",ge=H==="y"?"bottom":"right",pe=oe+j[le],_e=oe-j[ge];oe=IE(pe,oe,_e)}const ee=s.fn({...i,[Y]:ie,[H]:oe});return{...ee,data:{x:ee.x-c,y:ee.y-d,enabled:{[Y]:w,[H]:E}}}}}},Hne=function(t){return t===void 0&&(t={}),{options:t,fn(i){const{x:c,y:d,placement:y,rects:w,middlewareData:E}=i,{offset:s=0,mainAxis:O=!0,crossAxis:z=!0}=Np(t,i),j={x:c,y:d},H=vf(y),Y=mC(H);let ie=j[Y],oe=j[H];const ee=Np(s,i),le=typeof ee=="number"?{mainAxis:ee,crossAxis:0}:{mainAxis:0,crossAxis:0,...ee};if(O){const _e=Y==="y"?"height":"width",Re=w.reference[Y]-w.floating[_e]+le.mainAxis,xe=w.reference[Y]+w.reference[_e]-le.mainAxis;ie<Re?ie=Re:ie>xe&&(ie=xe)}if(z){var ge,pe;const _e=Y==="y"?"width":"height",Re=bj.has(kp(y)),xe=w.reference[H]-w.floating[_e]+(Re&&((ge=E.offset)==null?void 0:ge[H])||0)+(Re?0:le.crossAxis),Ze=w.reference[H]+w.reference[_e]+(Re?0:((pe=E.offset)==null?void 0:pe[H])||0)-(Re?le.crossAxis:0);oe<xe?oe=xe:oe>Ze&&(oe=Ze)}return{[Y]:ie,[H]:oe}}}},qne=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(i){var c,d;const{placement:y,rects:w,platform:E,elements:s}=i,{apply:O=()=>{},...z}=Np(t,i),j=await j0(i,z),H=kp(y),Y=Hx(y),ie=vf(y)==="y",{width:oe,height:ee}=w.floating;let le,ge;H==="top"||H==="bottom"?(le=H,ge=Y===(await(E.isRTL==null?void 0:E.isRTL(s.floating))?"start":"end")?"left":"right"):(ge=H,le=Y==="end"?"top":"bottom");const pe=ee-j.top-j.bottom,_e=oe-j.left-j.right,Re=sg(ee-j[le],pe),xe=sg(oe-j[ge],_e),Ze=!i.middlewareData.shift;let Le=Re,$e=xe;if((c=i.middlewareData.shift)!=null&&c.enabled.x&&($e=_e),(d=i.middlewareData.shift)!=null&&d.enabled.y&&(Le=pe),Ze&&!Y){const Et=uu(j.left,0),Ut=uu(j.right,0),$t=uu(j.top,0),tt=uu(j.bottom,0);ie?$e=oe-2*(Et!==0||Ut!==0?Et+Ut:uu(j.left,j.right)):Le=ee-2*($t!==0||tt!==0?$t+tt:uu(j.top,j.bottom))}await O({...i,availableWidth:$e,availableHeight:Le});const st=await E.getDimensions(s.floating);return oe!==st.width||ee!==st.height?{reset:{rects:!0}}:{}}}};function _S(){return typeof window<"u"}function qx(t){return wj(t)?(t.nodeName||"").toLowerCase():"#document"}function pu(t){var i;return(t==null||(i=t.ownerDocument)==null?void 0:i.defaultView)||window}function Cf(t){var i;return(i=(wj(t)?t.ownerDocument:t.document)||window.document)==null?void 0:i.documentElement}function wj(t){return _S()?t instanceof Node||t instanceof pu(t).Node:!1}function hh(t){return _S()?t instanceof Element||t instanceof pu(t).Element:!1}function Ef(t){return _S()?t instanceof HTMLElement||t instanceof pu(t).HTMLElement:!1}function ez(t){return!_S()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof pu(t).ShadowRoot}const Zne=new Set(["inline","contents"]);function sb(t){const{overflow:i,overflowX:c,overflowY:d,display:y}=fh(t);return/auto|scroll|overlay|hidden|clip/.test(i+d+c)&&!Zne.has(y)}const Wne=new Set(["table","td","th"]);function Xne(t){return Wne.has(qx(t))}const Kne=[":popover-open",":modal"];function yS(t){return Kne.some(i=>{try{return t.matches(i)}catch{return!1}})}const Yne=["transform","translate","scale","rotate","perspective"],Qne=["transform","translate","scale","rotate","perspective","filter"],Jne=["paint","layout","strict","content"];function yC(t){const i=xC(),c=hh(t)?fh(t):t;return Yne.some(d=>c[d]?c[d]!=="none":!1)||(c.containerType?c.containerType!=="normal":!1)||!i&&(c.backdropFilter?c.backdropFilter!=="none":!1)||!i&&(c.filter?c.filter!=="none":!1)||Qne.some(d=>(c.willChange||"").includes(d))||Jne.some(d=>(c.contain||"").includes(d))}function eie(t){let i=og(t);for(;Ef(i)&&!Cx(i);){if(yC(i))return i;if(yS(i))return null;i=og(i)}return null}function xC(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const tie=new Set(["html","body","#document"]);function Cx(t){return tie.has(qx(t))}function fh(t){return pu(t).getComputedStyle(t)}function xS(t){return hh(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function og(t){if(qx(t)==="html")return t;const i=t.assignedSlot||t.parentNode||ez(t)&&t.host||Cf(t);return ez(i)?i.host:i}function Sj(t){const i=og(t);return Cx(i)?t.ownerDocument?t.ownerDocument.body:t.body:Ef(i)&&sb(i)?i:Sj(i)}function F0(t,i,c){var d;i===void 0&&(i=[]),c===void 0&&(c=!0);const y=Sj(t),w=y===((d=t.ownerDocument)==null?void 0:d.body),E=pu(y);if(w){const s=PE(E);return i.concat(E,E.visualViewport||[],sb(y)?y:[],s&&c?F0(s):[])}return i.concat(y,F0(y,[],c))}function PE(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Tj(t){const i=fh(t);let c=parseFloat(i.width)||0,d=parseFloat(i.height)||0;const y=Ef(t),w=y?t.offsetWidth:c,E=y?t.offsetHeight:d,s=Ow(c)!==w||Ow(d)!==E;return s&&(c=w,d=E),{width:c,height:d,$:s}}function vC(t){return hh(t)?t:t.contextElement}function vx(t){const i=vC(t);if(!Ef(i))return Sf(1);const c=i.getBoundingClientRect(),{width:d,height:y,$:w}=Tj(i);let E=(w?Ow(c.width):c.width)/d,s=(w?Ow(c.height):c.height)/y;return(!E||!Number.isFinite(E))&&(E=1),(!s||!Number.isFinite(s))&&(s=1),{x:E,y:s}}const nie=Sf(0);function Ej(t){const i=pu(t);return!xC()||!i.visualViewport?nie:{x:i.visualViewport.offsetLeft,y:i.visualViewport.offsetTop}}function iie(t,i,c){return i===void 0&&(i=!1),!c||i&&c!==pu(t)?!1:i}function q_(t,i,c,d){i===void 0&&(i=!1),c===void 0&&(c=!1);const y=t.getBoundingClientRect(),w=vC(t);let E=Sf(1);i&&(d?hh(d)&&(E=vx(d)):E=vx(t));const s=iie(w,c,d)?Ej(w):Sf(0);let O=(y.left+s.x)/E.x,z=(y.top+s.y)/E.y,j=y.width/E.x,H=y.height/E.y;if(w){const Y=pu(w),ie=d&&hh(d)?pu(d):d;let oe=Y,ee=PE(oe);for(;ee&&d&&ie!==oe;){const le=vx(ee),ge=ee.getBoundingClientRect(),pe=fh(ee),_e=ge.left+(ee.clientLeft+parseFloat(pe.paddingLeft))*le.x,Re=ge.top+(ee.clientTop+parseFloat(pe.paddingTop))*le.y;O*=le.x,z*=le.y,j*=le.x,H*=le.y,O+=_e,z+=Re,oe=pu(ee),ee=PE(oe)}}return Lw({width:j,height:H,x:O,y:z})}function vS(t,i){const c=xS(t).scrollLeft;return i?i.left+c:q_(Cf(t)).left+c}function Aj(t,i){const c=t.getBoundingClientRect(),d=c.left+i.scrollLeft-vS(t,c),y=c.top+i.scrollTop;return{x:d,y}}function rie(t){let{elements:i,rect:c,offsetParent:d,strategy:y}=t;const w=y==="fixed",E=Cf(d),s=i?yS(i.floating):!1;if(d===E||s&&w)return c;let O={scrollLeft:0,scrollTop:0},z=Sf(1);const j=Sf(0),H=Ef(d);if((H||!H&&!w)&&((qx(d)!=="body"||sb(E))&&(O=xS(d)),Ef(d))){const ie=q_(d);z=vx(d),j.x=ie.x+d.clientLeft,j.y=ie.y+d.clientTop}const Y=E&&!H&&!w?Aj(E,O):Sf(0);return{width:c.width*z.x,height:c.height*z.y,x:c.x*z.x-O.scrollLeft*z.x+j.x+Y.x,y:c.y*z.y-O.scrollTop*z.y+j.y+Y.y}}function sie(t){return Array.from(t.getClientRects())}function oie(t){const i=Cf(t),c=xS(t),d=t.ownerDocument.body,y=uu(i.scrollWidth,i.clientWidth,d.scrollWidth,d.clientWidth),w=uu(i.scrollHeight,i.clientHeight,d.scrollHeight,d.clientHeight);let E=-c.scrollLeft+vS(t);const s=-c.scrollTop;return fh(d).direction==="rtl"&&(E+=uu(i.clientWidth,d.clientWidth)-y),{width:y,height:w,x:E,y:s}}const tz=25;function aie(t,i){const c=pu(t),d=Cf(t),y=c.visualViewport;let w=d.clientWidth,E=d.clientHeight,s=0,O=0;if(y){w=y.width,E=y.height;const j=xC();(!j||j&&i==="fixed")&&(s=y.offsetLeft,O=y.offsetTop)}const z=vS(d);if(z<=0){const j=d.ownerDocument,H=j.body,Y=getComputedStyle(H),ie=j.compatMode==="CSS1Compat"&&parseFloat(Y.marginLeft)+parseFloat(Y.marginRight)||0,oe=Math.abs(d.clientWidth-H.clientWidth-ie);oe<=tz&&(w-=oe)}else z<=tz&&(w+=z);return{width:w,height:E,x:s,y:O}}const lie=new Set(["absolute","fixed"]);function cie(t,i){const c=q_(t,!0,i==="fixed"),d=c.top+t.clientTop,y=c.left+t.clientLeft,w=Ef(t)?vx(t):Sf(1),E=t.clientWidth*w.x,s=t.clientHeight*w.y,O=y*w.x,z=d*w.y;return{width:E,height:s,x:O,y:z}}function nz(t,i,c){let d;if(i==="viewport")d=aie(t,c);else if(i==="document")d=oie(Cf(t));else if(hh(i))d=cie(i,c);else{const y=Ej(t);d={x:i.x-y.x,y:i.y-y.y,width:i.width,height:i.height}}return Lw(d)}function Cj(t,i){const c=og(t);return c===i||!hh(c)||Cx(c)?!1:fh(c).position==="fixed"||Cj(c,i)}function uie(t,i){const c=i.get(t);if(c)return c;let d=F0(t,[],!1).filter(s=>hh(s)&&qx(s)!=="body"),y=null;const w=fh(t).position==="fixed";let E=w?og(t):t;for(;hh(E)&&!Cx(E);){const s=fh(E),O=yC(E);!O&&s.position==="fixed"&&(y=null),(w?!O&&!y:!O&&s.position==="static"&&!!y&&lie.has(y.position)||sb(E)&&!O&&Cj(t,E))?d=d.filter(j=>j!==E):y=s,E=og(E)}return i.set(t,d),d}function die(t){let{element:i,boundary:c,rootBoundary:d,strategy:y}=t;const E=[...c==="clippingAncestors"?yS(i)?[]:uie(i,this._c):[].concat(c),d],s=E[0],O=E.reduce((z,j)=>{const H=nz(i,j,y);return z.top=uu(H.top,z.top),z.right=sg(H.right,z.right),z.bottom=sg(H.bottom,z.bottom),z.left=uu(H.left,z.left),z},nz(i,s,y));return{width:O.right-O.left,height:O.bottom-O.top,x:O.left,y:O.top}}function hie(t){const{width:i,height:c}=Tj(t);return{width:i,height:c}}function fie(t,i,c){const d=Ef(i),y=Cf(i),w=c==="fixed",E=q_(t,!0,w,i);let s={scrollLeft:0,scrollTop:0};const O=Sf(0);function z(){O.x=vS(y)}if(d||!d&&!w)if((qx(i)!=="body"||sb(y))&&(s=xS(i)),d){const ie=q_(i,!0,w,i);O.x=ie.x+i.clientLeft,O.y=ie.y+i.clientTop}else y&&z();w&&!d&&y&&z();const j=y&&!d&&!w?Aj(y,s):Sf(0),H=E.left+s.scrollLeft-O.x-j.x,Y=E.top+s.scrollTop-O.y-j.y;return{x:H,y:Y,width:E.width,height:E.height}}function S2(t){return fh(t).position==="static"}function iz(t,i){if(!Ef(t)||fh(t).position==="fixed")return null;if(i)return i(t);let c=t.offsetParent;return Cf(t)===c&&(c=c.ownerDocument.body),c}function Rj(t,i){const c=pu(t);if(yS(t))return c;if(!Ef(t)){let y=og(t);for(;y&&!Cx(y);){if(hh(y)&&!S2(y))return y;y=og(y)}return c}let d=iz(t,i);for(;d&&Xne(d)&&S2(d);)d=iz(d,i);return d&&Cx(d)&&S2(d)&&!yC(d)?c:d||eie(t)||c}const pie=async function(t){const i=this.getOffsetParent||Rj,c=this.getDimensions,d=await c(t.floating);return{reference:fie(t.reference,await i(t.floating),t.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}};function mie(t){return fh(t).direction==="rtl"}const gie={convertOffsetParentRelativeRectToViewportRelativeRect:rie,getDocumentElement:Cf,getClippingRect:die,getOffsetParent:Rj,getElementRects:pie,getClientRects:sie,getDimensions:hie,getScale:vx,isElement:hh,isRTL:mie};function Mj(t,i){return t.x===i.x&&t.y===i.y&&t.width===i.width&&t.height===i.height}function _ie(t,i){let c=null,d;const y=Cf(t);function w(){var s;clearTimeout(d),(s=c)==null||s.disconnect(),c=null}function E(s,O){s===void 0&&(s=!1),O===void 0&&(O=1),w();const z=t.getBoundingClientRect(),{left:j,top:H,width:Y,height:ie}=z;if(s||i(),!Y||!ie)return;const oe=V1(H),ee=V1(y.clientWidth-(j+Y)),le=V1(y.clientHeight-(H+ie)),ge=V1(j),_e={rootMargin:-oe+"px "+-ee+"px "+-le+"px "+-ge+"px",threshold:uu(0,sg(1,O))||1};let Re=!0;function xe(Ze){const Le=Ze[0].intersectionRatio;if(Le!==O){if(!Re)return E();Le?E(!1,Le):d=setTimeout(()=>{E(!1,1e-7)},1e3)}Le===1&&!Mj(z,t.getBoundingClientRect())&&E(),Re=!1}try{c=new IntersectionObserver(xe,{..._e,root:y.ownerDocument})}catch{c=new IntersectionObserver(xe,_e)}c.observe(t)}return E(!0),w}function yie(t,i,c,d){d===void 0&&(d={});const{ancestorScroll:y=!0,ancestorResize:w=!0,elementResize:E=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:O=!1}=d,z=vC(t),j=y||w?[...z?F0(z):[],...F0(i)]:[];j.forEach(ge=>{y&&ge.addEventListener("scroll",c,{passive:!0}),w&&ge.addEventListener("resize",c)});const H=z&&s?_ie(z,c):null;let Y=-1,ie=null;E&&(ie=new ResizeObserver(ge=>{let[pe]=ge;pe&&pe.target===z&&ie&&(ie.unobserve(i),cancelAnimationFrame(Y),Y=requestAnimationFrame(()=>{var _e;(_e=ie)==null||_e.observe(i)})),c()}),z&&!O&&ie.observe(z),ie.observe(i));let oe,ee=O?q_(t):null;O&&le();function le(){const ge=q_(t);ee&&!Mj(ee,ge)&&c(),ee=ge,oe=requestAnimationFrame(le)}return c(),()=>{var ge;j.forEach(pe=>{y&&pe.removeEventListener("scroll",c),w&&pe.removeEventListener("resize",c)}),H?.(),(ge=ie)==null||ge.disconnect(),ie=null,O&&cancelAnimationFrame(oe)}}const xie=$ne,vie=Gne,bie=Bne,wie=qne,Sie=Vne,rz=Fne,Tie=Hne,Eie=(t,i,c)=>{const d=new Map,y={platform:gie,...c},w={...y.platform,_c:d};return jne(t,i,{...y,platform:w})};var Aie=typeof document<"u",Cie=function(){},aw=Aie?Z.useLayoutEffect:Cie;function Nw(t,i){if(t===i)return!0;if(typeof t!=typeof i)return!1;if(typeof t=="function"&&t.toString()===i.toString())return!0;let c,d,y;if(t&&i&&typeof t=="object"){if(Array.isArray(t)){if(c=t.length,c!==i.length)return!1;for(d=c;d--!==0;)if(!Nw(t[d],i[d]))return!1;return!0}if(y=Object.keys(t),c=y.length,c!==Object.keys(i).length)return!1;for(d=c;d--!==0;)if(!{}.hasOwnProperty.call(i,y[d]))return!1;for(d=c;d--!==0;){const w=y[d];if(!(w==="_owner"&&t.$$typeof)&&!Nw(t[w],i[w]))return!1}return!0}return t!==t&&i!==i}function Ij(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function sz(t,i){const c=Ij(t);return Math.round(i*c)/c}function T2(t){const i=Z.useRef(t);return aw(()=>{i.current=t}),i}function Rie(t){t===void 0&&(t={});const{placement:i="bottom",strategy:c="absolute",middleware:d=[],platform:y,elements:{reference:w,floating:E}={},transform:s=!0,whileElementsMounted:O,open:z}=t,[j,H]=Z.useState({x:0,y:0,strategy:c,placement:i,middlewareData:{},isPositioned:!1}),[Y,ie]=Z.useState(d);Nw(Y,d)||ie(d);const[oe,ee]=Z.useState(null),[le,ge]=Z.useState(null),pe=Z.useCallback(Fe=>{Fe!==Ze.current&&(Ze.current=Fe,ee(Fe))},[]),_e=Z.useCallback(Fe=>{Fe!==Le.current&&(Le.current=Fe,ge(Fe))},[]),Re=w||oe,xe=E||le,Ze=Z.useRef(null),Le=Z.useRef(null),$e=Z.useRef(j),st=O!=null,Et=T2(O),Ut=T2(y),$t=T2(z),tt=Z.useCallback(()=>{if(!Ze.current||!Le.current)return;const Fe={placement:i,strategy:c,middleware:Y};Ut.current&&(Fe.platform=Ut.current),Eie(Ze.current,Le.current,Fe).then(kt=>{const fn={...kt,isPositioned:$t.current!==!1};ut.current&&!Nw($e.current,fn)&&($e.current=fn,ah.flushSync(()=>{H(fn)}))})},[Y,i,c,Ut,$t]);aw(()=>{z===!1&&$e.current.isPositioned&&($e.current.isPositioned=!1,H(Fe=>({...Fe,isPositioned:!1})))},[z]);const ut=Z.useRef(!1);aw(()=>(ut.current=!0,()=>{ut.current=!1}),[]),aw(()=>{if(Re&&(Ze.current=Re),xe&&(Le.current=xe),Re&&xe){if(Et.current)return Et.current(Re,xe,tt);tt()}},[Re,xe,tt,Et,st]);const on=Z.useMemo(()=>({reference:Ze,floating:Le,setReference:pe,setFloating:_e}),[pe,_e]),Ke=Z.useMemo(()=>({reference:Re,floating:xe}),[Re,xe]),ze=Z.useMemo(()=>{const Fe={position:c,left:0,top:0};if(!Ke.floating)return Fe;const kt=sz(Ke.floating,j.x),fn=sz(Ke.floating,j.y);return s?{...Fe,transform:"translate("+kt+"px, "+fn+"px)",...Ij(Ke.floating)>=1.5&&{willChange:"transform"}}:{position:c,left:kt,top:fn}},[c,s,Ke.floating,j.x,j.y]);return Z.useMemo(()=>({...j,update:tt,refs:on,elements:Ke,floatingStyles:ze}),[j,tt,on,Ke,ze])}const Mie=t=>{function i(c){return{}.hasOwnProperty.call(c,"current")}return{name:"arrow",options:t,fn(c){const{element:d,padding:y}=typeof t=="function"?t(c):t;return d&&i(d)?d.current!=null?rz({element:d.current,padding:y}).fn(c):{}:d?rz({element:d,padding:y}).fn(c):{}}}},Iie=(t,i)=>({...xie(t),options:[t,i]}),Die=(t,i)=>({...vie(t),options:[t,i]}),Pie=(t,i)=>({...Tie(t),options:[t,i]}),Oie=(t,i)=>({...bie(t),options:[t,i]}),zie=(t,i)=>({...wie(t),options:[t,i]}),Lie=(t,i)=>({...Sie(t),options:[t,i]}),Nie=(t,i)=>({...Mie(t),options:[t,i]});var kie="Arrow",Dj=Z.forwardRef((t,i)=>{const{children:c,width:d=10,height:y=5,...w}=t;return C.jsx(As.svg,{...w,ref:i,width:d,height:y,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?c:C.jsx("polygon",{points:"0,0 30,0 15,10"})})});Dj.displayName=kie;var jie=Dj;function Fie(t){const[i,c]=Z.useState(void 0);return cl(()=>{if(t){c({width:t.offsetWidth,height:t.offsetHeight});const d=new ResizeObserver(y=>{if(!Array.isArray(y)||!y.length)return;const w=y[0];let E,s;if("borderBoxSize"in w){const O=w.borderBoxSize,z=Array.isArray(O)?O[0]:O;E=z.inlineSize,s=z.blockSize}else E=t.offsetWidth,s=t.offsetHeight;c({width:E,height:s})});return d.observe(t,{box:"border-box"}),()=>d.unobserve(t)}else c(void 0)},[t]),i}var bC="Popper",[Pj,Oj]=K0(bC),[Bie,zj]=Pj(bC),Lj=t=>{const{__scopePopper:i,children:c}=t,[d,y]=Z.useState(null);return C.jsx(Bie,{scope:i,anchor:d,onAnchorChange:y,children:c})};Lj.displayName=bC;var Nj="PopperAnchor",kj=Z.forwardRef((t,i)=>{const{__scopePopper:c,virtualRef:d,...y}=t,w=zj(Nj,c),E=Z.useRef(null),s=Mo(i,E),O=Z.useRef(null);return Z.useEffect(()=>{const z=O.current;O.current=d?.current||E.current,z!==O.current&&w.onAnchorChange(O.current)}),d?null:C.jsx(As.div,{...y,ref:s})});kj.displayName=Nj;var wC="PopperContent",[Vie,Uie]=Pj(wC),jj=Z.forwardRef((t,i)=>{const{__scopePopper:c,side:d="bottom",sideOffset:y=0,align:w="center",alignOffset:E=0,arrowPadding:s=0,avoidCollisions:O=!0,collisionBoundary:z=[],collisionPadding:j=0,sticky:H="partial",hideWhenDetached:Y=!1,updatePositionStrategy:ie="optimized",onPlaced:oe,...ee}=t,le=zj(wC,c),[ge,pe]=Z.useState(null),_e=Mo(i,Yt=>pe(Yt)),[Re,xe]=Z.useState(null),Ze=Fie(Re),Le=Ze?.width??0,$e=Ze?.height??0,st=d+(w!=="center"?"-"+w:""),Et=typeof j=="number"?j:{top:0,right:0,bottom:0,left:0,...j},Ut=Array.isArray(z)?z:[z],$t=Ut.length>0,tt={padding:Et,boundary:Ut.filter(Gie),altBoundary:$t},{refs:ut,floatingStyles:on,placement:Ke,isPositioned:ze,middlewareData:Fe}=Rie({strategy:"fixed",placement:st,whileElementsMounted:(...Yt)=>yie(...Yt,{animationFrame:ie==="always"}),elements:{reference:le.anchor},middleware:[Iie({mainAxis:y+$e,alignmentAxis:E}),O&&Die({mainAxis:!0,crossAxis:!1,limiter:H==="partial"?Pie():void 0,...tt}),O&&Oie({...tt}),zie({...tt,apply:({elements:Yt,rects:On,availableWidth:An,availableHeight:In})=>{const{width:gi,height:ji}=On.reference,Ri=Yt.floating.style;Ri.setProperty("--radix-popper-available-width",`${An}px`),Ri.setProperty("--radix-popper-available-height",`${In}px`),Ri.setProperty("--radix-popper-anchor-width",`${gi}px`),Ri.setProperty("--radix-popper-anchor-height",`${ji}px`)}}),Re&&Nie({element:Re,padding:s}),Hie({arrowWidth:Le,arrowHeight:$e}),Y&&Lie({strategy:"referenceHidden",...tt})]}),[kt,fn]=Vj(Ke),Me=lh(oe);cl(()=>{ze&&Me?.()},[ze,Me]);const ct=Fe.arrow?.x,vt=Fe.arrow?.y,Kt=Fe.arrow?.centerOffset!==0,[zn,Nn]=Z.useState();return cl(()=>{ge&&Nn(window.getComputedStyle(ge).zIndex)},[ge]),C.jsx("div",{ref:ut.setFloating,"data-radix-popper-content-wrapper":"",style:{...on,transform:ze?on.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:zn,"--radix-popper-transform-origin":[Fe.transformOrigin?.x,Fe.transformOrigin?.y].join(" "),...Fe.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:C.jsx(Vie,{scope:c,placedSide:kt,onArrowChange:xe,arrowX:ct,arrowY:vt,shouldHideArrow:Kt,children:C.jsx(As.div,{"data-side":kt,"data-align":fn,...ee,ref:_e,style:{...ee.style,animation:ze?void 0:"none"}})})})});jj.displayName=wC;var Fj="PopperArrow",$ie={top:"bottom",right:"left",bottom:"top",left:"right"},Bj=Z.forwardRef(function(i,c){const{__scopePopper:d,...y}=i,w=Uie(Fj,d),E=$ie[w.placedSide];return C.jsx("span",{ref:w.onArrowChange,style:{position:"absolute",left:w.arrowX,top:w.arrowY,[E]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[w.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[w.placedSide],visibility:w.shouldHideArrow?"hidden":void 0},children:C.jsx(jie,{...y,ref:c,style:{...y.style,display:"block"}})})});Bj.displayName=Fj;function Gie(t){return t!==null}var Hie=t=>({name:"transformOrigin",options:t,fn(i){const{placement:c,rects:d,middlewareData:y}=i,E=y.arrow?.centerOffset!==0,s=E?0:t.arrowWidth,O=E?0:t.arrowHeight,[z,j]=Vj(c),H={start:"0%",center:"50%",end:"100%"}[j],Y=(y.arrow?.x??0)+s/2,ie=(y.arrow?.y??0)+O/2;let oe="",ee="";return z==="bottom"?(oe=E?H:`${Y}px`,ee=`${-O}px`):z==="top"?(oe=E?H:`${Y}px`,ee=`${d.floating.height+O}px`):z==="right"?(oe=`${-O}px`,ee=E?H:`${ie}px`):z==="left"&&(oe=`${d.floating.width+O}px`,ee=E?H:`${ie}px`),{data:{x:oe,y:ee}}}});function Vj(t){const[i,c="center"]=t.split("-");return[i,c]}var qie=Lj,Zie=kj,Wie=jj,Xie=Bj;function Kie(t){const i=Yie(t),c=Z.forwardRef((d,y)=>{const{children:w,...E}=d,s=Z.Children.toArray(w),O=s.find(Jie);if(O){const z=O.props.children,j=s.map(H=>H===O?Z.Children.count(z)>1?Z.Children.only(null):Z.isValidElement(z)?z.props.children:null:H);return C.jsx(i,{...E,ref:y,children:Z.isValidElement(z)?Z.cloneElement(z,void 0,j):null})}return C.jsx(i,{...E,ref:y,children:w})});return c.displayName=`${t}.Slot`,c}function Yie(t){const i=Z.forwardRef((c,d)=>{const{children:y,...w}=c;if(Z.isValidElement(y)){const E=tre(y),s=ere(w,y.props);return y.type!==Z.Fragment&&(s.ref=d?kx(d,E):E),Z.cloneElement(y,s)}return Z.Children.count(y)>1?Z.Children.only(null):null});return i.displayName=`${t}.SlotClone`,i}var Qie=Symbol("radix.slottable");function Jie(t){return Z.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Qie}function ere(t,i){const c={...i};for(const d in i){const y=t[d],w=i[d];/^on[A-Z]/.test(d)?y&&w?c[d]=(...s)=>{const O=w(...s);return y(...s),O}:y&&(c[d]=y):d==="style"?c[d]={...y,...w}:d==="className"&&(c[d]=[y,w].filter(Boolean).join(" "))}return{...t,...c}}function tre(t){let i=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning;return c?t.ref:(i=Object.getOwnPropertyDescriptor(t,"ref")?.get,c=i&&"isReactWarning"in i&&i.isReactWarning,c?t.props.ref:t.props.ref||t.ref)}function nre(t){const i=Z.useRef({value:t,previous:t});return Z.useMemo(()=>(i.current.value!==t&&(i.current.previous=i.current.value,i.current.value=t),i.current.previous),[t])}var ire=[" ","Enter","ArrowUp","ArrowDown"],rre=[" ","Enter"],Z_="Select",[bS,wS,sre]=RL(Z_),[Zx]=K0(Z_,[sre,Oj]),SS=Oj(),[ore,pg]=Zx(Z_),[are,lre]=Zx(Z_),Uj=t=>{const{__scopeSelect:i,children:c,open:d,defaultOpen:y,onOpenChange:w,value:E,defaultValue:s,onValueChange:O,dir:z,name:j,autoComplete:H,disabled:Y,required:ie,form:oe}=t,ee=SS(i),[le,ge]=Z.useState(null),[pe,_e]=Z.useState(null),[Re,xe]=Z.useState(!1),Ze=Ane(z),[Le,$e]=gw({prop:d,defaultProp:y??!1,onChange:w,caller:Z_}),[st,Et]=gw({prop:E,defaultProp:s,onChange:O,caller:Z_}),Ut=Z.useRef(null),$t=le?oe||!!le.closest("form"):!0,[tt,ut]=Z.useState(new Set),on=Array.from(tt).map(Ke=>Ke.props.value).join(";");return C.jsx(qie,{...ee,children:C.jsxs(ore,{required:ie,scope:i,trigger:le,onTriggerChange:ge,valueNode:pe,onValueNodeChange:_e,valueNodeHasChildren:Re,onValueNodeHasChildrenChange:xe,contentId:yx(),value:st,onValueChange:Et,open:Le,onOpenChange:$e,dir:Ze,triggerPointerDownPosRef:Ut,disabled:Y,children:[C.jsx(bS.Provider,{scope:i,children:C.jsx(are,{scope:t.__scopeSelect,onNativeOptionAdd:Z.useCallback(Ke=>{ut(ze=>new Set(ze).add(Ke))},[]),onNativeOptionRemove:Z.useCallback(Ke=>{ut(ze=>{const Fe=new Set(ze);return Fe.delete(Ke),Fe})},[]),children:c})}),$t?C.jsxs(hF,{"aria-hidden":!0,required:ie,tabIndex:-1,name:j,autoComplete:H,value:st,onChange:Ke=>Et(Ke.target.value),disabled:Y,form:oe,children:[st===void 0?C.jsx("option",{value:""}):null,Array.from(tt)]},on):null]})})};Uj.displayName=Z_;var $j="SelectTrigger",Gj=Z.forwardRef((t,i)=>{const{__scopeSelect:c,disabled:d=!1,...y}=t,w=SS(c),E=pg($j,c),s=E.disabled||d,O=Mo(i,E.onTriggerChange),z=wS(c),j=Z.useRef("touch"),[H,Y,ie]=pF(ee=>{const le=z().filter(_e=>!_e.disabled),ge=le.find(_e=>_e.value===E.value),pe=mF(le,ee,ge);pe!==void 0&&E.onValueChange(pe.value)}),oe=ee=>{s||(E.onOpenChange(!0),ie()),ee&&(E.triggerPointerDownPosRef.current={x:Math.round(ee.pageX),y:Math.round(ee.pageY)})};return C.jsx(Zie,{asChild:!0,...w,children:C.jsx(As.button,{type:"button",role:"combobox","aria-controls":E.contentId,"aria-expanded":E.open,"aria-required":E.required,"aria-autocomplete":"none",dir:E.dir,"data-state":E.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":fF(E.value)?"":void 0,...y,ref:O,onClick:ls(y.onClick,ee=>{ee.currentTarget.focus(),j.current!=="mouse"&&oe(ee)}),onPointerDown:ls(y.onPointerDown,ee=>{j.current=ee.pointerType;const le=ee.target;le.hasPointerCapture(ee.pointerId)&&le.releasePointerCapture(ee.pointerId),ee.button===0&&ee.ctrlKey===!1&&ee.pointerType==="mouse"&&(oe(ee),ee.preventDefault())}),onKeyDown:ls(y.onKeyDown,ee=>{const le=H.current!=="";!(ee.ctrlKey||ee.altKey||ee.metaKey)&&ee.key.length===1&&Y(ee.key),!(le&&ee.key===" ")&&ire.includes(ee.key)&&(oe(),ee.preventDefault())})})})});Gj.displayName=$j;var Hj="SelectValue",qj=Z.forwardRef((t,i)=>{const{__scopeSelect:c,className:d,style:y,children:w,placeholder:E="",...s}=t,O=pg(Hj,c),{onValueNodeHasChildrenChange:z}=O,j=w!==void 0,H=Mo(i,O.onValueNodeChange);return cl(()=>{z(j)},[z,j]),C.jsx(As.span,{...s,ref:H,style:{pointerEvents:"none"},children:fF(O.value)?C.jsx(C.Fragment,{children:E}):w})});qj.displayName=Hj;var cre="SelectIcon",Zj=Z.forwardRef((t,i)=>{const{__scopeSelect:c,children:d,...y}=t;return C.jsx(As.span,{"aria-hidden":!0,...y,ref:i,children:d||""})});Zj.displayName=cre;var ure="SelectPortal",Wj=t=>C.jsx(Jw,{asChild:!0,...t});Wj.displayName=ure;var W_="SelectContent",Xj=Z.forwardRef((t,i)=>{const c=pg(W_,t.__scopeSelect),[d,y]=Z.useState();if(cl(()=>{y(new DocumentFragment)},[]),!c.open){const w=d;return w?ah.createPortal(C.jsx(Kj,{scope:t.__scopeSelect,children:C.jsx(bS.Slot,{scope:t.__scopeSelect,children:C.jsx("div",{children:t.children})})}),w):null}return C.jsx(Yj,{...t,ref:i})});Xj.displayName=W_;var rh=10,[Kj,mg]=Zx(W_),dre="SelectContentImpl",hre=Kie("SelectContent.RemoveScroll"),Yj=Z.forwardRef((t,i)=>{const{__scopeSelect:c,position:d="item-aligned",onCloseAutoFocus:y,onEscapeKeyDown:w,onPointerDownOutside:E,side:s,sideOffset:O,align:z,alignOffset:j,arrowPadding:H,collisionBoundary:Y,collisionPadding:ie,sticky:oe,hideWhenDetached:ee,avoidCollisions:le,...ge}=t,pe=pg(W_,c),[_e,Re]=Z.useState(null),[xe,Ze]=Z.useState(null),Le=Mo(i,Yt=>Re(Yt)),[$e,st]=Z.useState(null),[Et,Ut]=Z.useState(null),$t=wS(c),[tt,ut]=Z.useState(!1),on=Z.useRef(!1);Z.useEffect(()=>{if(_e)return J3(_e)},[_e]),G3();const Ke=Z.useCallback(Yt=>{const[On,...An]=$t().map(ji=>ji.ref.current),[In]=An.slice(-1),gi=document.activeElement;for(const ji of Yt)if(ji===gi||(ji?.scrollIntoView({block:"nearest"}),ji===On&&xe&&(xe.scrollTop=0),ji===In&&xe&&(xe.scrollTop=xe.scrollHeight),ji?.focus(),document.activeElement!==gi))return},[$t,xe]),ze=Z.useCallback(()=>Ke([$e,_e]),[Ke,$e,_e]);Z.useEffect(()=>{tt&&ze()},[tt,ze]);const{onOpenChange:Fe,triggerPointerDownPosRef:kt}=pe;Z.useEffect(()=>{if(_e){let Yt={x:0,y:0};const On=In=>{Yt={x:Math.abs(Math.round(In.pageX)-(kt.current?.x??0)),y:Math.abs(Math.round(In.pageY)-(kt.current?.y??0))}},An=In=>{Yt.x<=10&&Yt.y<=10?In.preventDefault():_e.contains(In.target)||Fe(!1),document.removeEventListener("pointermove",On),kt.current=null};return kt.current!==null&&(document.addEventListener("pointermove",On),document.addEventListener("pointerup",An,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",On),document.removeEventListener("pointerup",An,{capture:!0})}}},[_e,Fe,kt]),Z.useEffect(()=>{const Yt=()=>Fe(!1);return window.addEventListener("blur",Yt),window.addEventListener("resize",Yt),()=>{window.removeEventListener("blur",Yt),window.removeEventListener("resize",Yt)}},[Fe]);const[fn,Me]=pF(Yt=>{const On=$t().filter(gi=>!gi.disabled),An=On.find(gi=>gi.ref.current===document.activeElement),In=mF(On,Yt,An);In&&setTimeout(()=>In.ref.current.focus())}),ct=Z.useCallback((Yt,On,An)=>{const In=!on.current&&!An;(pe.value!==void 0&&pe.value===On||In)&&(st(Yt),In&&(on.current=!0))},[pe.value]),vt=Z.useCallback(()=>_e?.focus(),[_e]),Kt=Z.useCallback((Yt,On,An)=>{const In=!on.current&&!An;(pe.value!==void 0&&pe.value===On||In)&&Ut(Yt)},[pe.value]),zn=d==="popper"?OE:Qj,Nn=zn===OE?{side:s,sideOffset:O,align:z,alignOffset:j,arrowPadding:H,collisionBoundary:Y,collisionPadding:ie,sticky:oe,hideWhenDetached:ee,avoidCollisions:le}:{};return C.jsx(Kj,{scope:c,content:_e,viewport:xe,onViewportChange:Ze,itemRefCallback:ct,selectedItem:$e,onItemLeave:vt,itemTextRefCallback:Kt,focusSelectedItem:ze,selectedItemText:Et,position:d,isPositioned:tt,searchRef:fn,children:C.jsx(dC,{as:hre,allowPinchZoom:!0,children:C.jsx(uC,{asChild:!0,trapped:pe.open,onMountAutoFocus:Yt=>{Yt.preventDefault()},onUnmountAutoFocus:ls(y,Yt=>{pe.trigger?.focus({preventScroll:!0}),Yt.preventDefault()}),children:C.jsx(Qw,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:w,onPointerDownOutside:E,onFocusOutside:Yt=>Yt.preventDefault(),onDismiss:()=>pe.onOpenChange(!1),children:C.jsx(zn,{role:"listbox",id:pe.contentId,"data-state":pe.open?"open":"closed",dir:pe.dir,onContextMenu:Yt=>Yt.preventDefault(),...ge,...Nn,onPlaced:()=>ut(!0),ref:Le,style:{display:"flex",flexDirection:"column",outline:"none",...ge.style},onKeyDown:ls(ge.onKeyDown,Yt=>{const On=Yt.ctrlKey||Yt.altKey||Yt.metaKey;if(Yt.key==="Tab"&&Yt.preventDefault(),!On&&Yt.key.length===1&&Me(Yt.key),["ArrowUp","ArrowDown","Home","End"].includes(Yt.key)){let In=$t().filter(gi=>!gi.disabled).map(gi=>gi.ref.current);if(["ArrowUp","End"].includes(Yt.key)&&(In=In.slice().reverse()),["ArrowUp","ArrowDown"].includes(Yt.key)){const gi=Yt.target,ji=In.indexOf(gi);In=In.slice(ji+1)}setTimeout(()=>Ke(In)),Yt.preventDefault()}})})})})})})});Yj.displayName=dre;var fre="SelectItemAlignedPosition",Qj=Z.forwardRef((t,i)=>{const{__scopeSelect:c,onPlaced:d,...y}=t,w=pg(W_,c),E=mg(W_,c),[s,O]=Z.useState(null),[z,j]=Z.useState(null),H=Mo(i,Le=>j(Le)),Y=wS(c),ie=Z.useRef(!1),oe=Z.useRef(!0),{viewport:ee,selectedItem:le,selectedItemText:ge,focusSelectedItem:pe}=E,_e=Z.useCallback(()=>{if(w.trigger&&w.valueNode&&s&&z&&ee&&le&&ge){const Le=w.trigger.getBoundingClientRect(),$e=z.getBoundingClientRect(),st=w.valueNode.getBoundingClientRect(),Et=ge.getBoundingClientRect();if(w.dir!=="rtl"){const gi=Et.left-$e.left,ji=st.left-gi,Ri=Le.left-ji,Rr=Le.width+Ri,cs=Math.max(Rr,$e.width),wr=window.innerWidth-rh,jn=WO(ji,[rh,Math.max(rh,wr-cs)]);s.style.minWidth=Rr+"px",s.style.left=jn+"px"}else{const gi=$e.right-Et.right,ji=window.innerWidth-st.right-gi,Ri=window.innerWidth-Le.right-ji,Rr=Le.width+Ri,cs=Math.max(Rr,$e.width),wr=window.innerWidth-rh,jn=WO(ji,[rh,Math.max(rh,wr-cs)]);s.style.minWidth=Rr+"px",s.style.right=jn+"px"}const Ut=Y(),$t=window.innerHeight-rh*2,tt=ee.scrollHeight,ut=window.getComputedStyle(z),on=parseInt(ut.borderTopWidth,10),Ke=parseInt(ut.paddingTop,10),ze=parseInt(ut.borderBottomWidth,10),Fe=parseInt(ut.paddingBottom,10),kt=on+Ke+tt+Fe+ze,fn=Math.min(le.offsetHeight*5,kt),Me=window.getComputedStyle(ee),ct=parseInt(Me.paddingTop,10),vt=parseInt(Me.paddingBottom,10),Kt=Le.top+Le.height/2-rh,zn=$t-Kt,Nn=le.offsetHeight/2,Yt=le.offsetTop+Nn,On=on+Ke+Yt,An=kt-On;if(On<=Kt){const gi=Ut.length>0&&le===Ut[Ut.length-1].ref.current;s.style.bottom="0px";const ji=z.clientHeight-ee.offsetTop-ee.offsetHeight,Ri=Math.max(zn,Nn+(gi?vt:0)+ji+ze),Rr=On+Ri;s.style.height=Rr+"px"}else{const gi=Ut.length>0&&le===Ut[0].ref.current;s.style.top="0px";const Ri=Math.max(Kt,on+ee.offsetTop+(gi?ct:0)+Nn)+An;s.style.height=Ri+"px",ee.scrollTop=On-Kt+ee.offsetTop}s.style.margin=`${rh}px 0`,s.style.minHeight=fn+"px",s.style.maxHeight=$t+"px",d?.(),requestAnimationFrame(()=>ie.current=!0)}},[Y,w.trigger,w.valueNode,s,z,ee,le,ge,w.dir,d]);cl(()=>_e(),[_e]);const[Re,xe]=Z.useState();cl(()=>{z&&xe(window.getComputedStyle(z).zIndex)},[z]);const Ze=Z.useCallback(Le=>{Le&&oe.current===!0&&(_e(),pe?.(),oe.current=!1)},[_e,pe]);return C.jsx(mre,{scope:c,contentWrapper:s,shouldExpandOnScrollRef:ie,onScrollButtonChange:Ze,children:C.jsx("div",{ref:O,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Re},children:C.jsx(As.div,{...y,ref:H,style:{boxSizing:"border-box",maxHeight:"100%",...y.style}})})})});Qj.displayName=fre;var pre="SelectPopperPosition",OE=Z.forwardRef((t,i)=>{const{__scopeSelect:c,align:d="start",collisionPadding:y=rh,...w}=t,E=SS(c);return C.jsx(Wie,{...E,...w,ref:i,align:d,collisionPadding:y,style:{boxSizing:"border-box",...w.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});OE.displayName=pre;var[mre,SC]=Zx(W_,{}),zE="SelectViewport",Jj=Z.forwardRef((t,i)=>{const{__scopeSelect:c,nonce:d,...y}=t,w=mg(zE,c),E=SC(zE,c),s=Mo(i,w.onViewportChange),O=Z.useRef(0);return C.jsxs(C.Fragment,{children:[C.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),C.jsx(bS.Slot,{scope:c,children:C.jsx(As.div,{"data-radix-select-viewport":"",role:"presentation",...y,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...y.style},onScroll:ls(y.onScroll,z=>{const j=z.currentTarget,{contentWrapper:H,shouldExpandOnScrollRef:Y}=E;if(Y?.current&&H){const ie=Math.abs(O.current-j.scrollTop);if(ie>0){const oe=window.innerHeight-rh*2,ee=parseFloat(H.style.minHeight),le=parseFloat(H.style.height),ge=Math.max(ee,le);if(ge<oe){const pe=ge+ie,_e=Math.min(oe,pe),Re=pe-_e;H.style.height=_e+"px",H.style.bottom==="0px"&&(j.scrollTop=Re>0?Re:0,H.style.justifyContent="flex-end")}}}O.current=j.scrollTop})})})]})});Jj.displayName=zE;var eF="SelectGroup",[gre,_re]=Zx(eF),yre=Z.forwardRef((t,i)=>{const{__scopeSelect:c,...d}=t,y=yx();return C.jsx(gre,{scope:c,id:y,children:C.jsx(As.div,{role:"group","aria-labelledby":y,...d,ref:i})})});yre.displayName=eF;var tF="SelectLabel",nF=Z.forwardRef((t,i)=>{const{__scopeSelect:c,...d}=t,y=_re(tF,c);return C.jsx(As.div,{id:y.id,...d,ref:i})});nF.displayName=tF;var kw="SelectItem",[xre,iF]=Zx(kw),rF=Z.forwardRef((t,i)=>{const{__scopeSelect:c,value:d,disabled:y=!1,textValue:w,...E}=t,s=pg(kw,c),O=mg(kw,c),z=s.value===d,[j,H]=Z.useState(w??""),[Y,ie]=Z.useState(!1),oe=Mo(i,pe=>O.itemRefCallback?.(pe,d,y)),ee=yx(),le=Z.useRef("touch"),ge=()=>{y||(s.onValueChange(d),s.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return C.jsx(xre,{scope:c,value:d,disabled:y,textId:ee,isSelected:z,onItemTextChange:Z.useCallback(pe=>{H(_e=>_e||(pe?.textContent??"").trim())},[]),children:C.jsx(bS.ItemSlot,{scope:c,value:d,disabled:y,textValue:j,children:C.jsx(As.div,{role:"option","aria-labelledby":ee,"data-highlighted":Y?"":void 0,"aria-selected":z&&Y,"data-state":z?"checked":"unchecked","aria-disabled":y||void 0,"data-disabled":y?"":void 0,tabIndex:y?void 0:-1,...E,ref:oe,onFocus:ls(E.onFocus,()=>ie(!0)),onBlur:ls(E.onBlur,()=>ie(!1)),onClick:ls(E.onClick,()=>{le.current!=="mouse"&&ge()}),onPointerUp:ls(E.onPointerUp,()=>{le.current==="mouse"&&ge()}),onPointerDown:ls(E.onPointerDown,pe=>{le.current=pe.pointerType}),onPointerMove:ls(E.onPointerMove,pe=>{le.current=pe.pointerType,y?O.onItemLeave?.():le.current==="mouse"&&pe.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ls(E.onPointerLeave,pe=>{pe.currentTarget===document.activeElement&&O.onItemLeave?.()}),onKeyDown:ls(E.onKeyDown,pe=>{O.searchRef?.current!==""&&pe.key===" "||(rre.includes(pe.key)&&ge(),pe.key===" "&&pe.preventDefault())})})})})});rF.displayName=kw;var u0="SelectItemText",sF=Z.forwardRef((t,i)=>{const{__scopeSelect:c,className:d,style:y,...w}=t,E=pg(u0,c),s=mg(u0,c),O=iF(u0,c),z=lre(u0,c),[j,H]=Z.useState(null),Y=Mo(i,ge=>H(ge),O.onItemTextChange,ge=>s.itemTextRefCallback?.(ge,O.value,O.disabled)),ie=j?.textContent,oe=Z.useMemo(()=>C.jsx("option",{value:O.value,disabled:O.disabled,children:ie},O.value),[O.disabled,O.value,ie]),{onNativeOptionAdd:ee,onNativeOptionRemove:le}=z;return cl(()=>(ee(oe),()=>le(oe)),[ee,le,oe]),C.jsxs(C.Fragment,{children:[C.jsx(As.span,{id:O.textId,...w,ref:Y}),O.isSelected&&E.valueNode&&!E.valueNodeHasChildren?ah.createPortal(w.children,E.valueNode):null]})});sF.displayName=u0;var oF="SelectItemIndicator",aF=Z.forwardRef((t,i)=>{const{__scopeSelect:c,...d}=t;return iF(oF,c).isSelected?C.jsx(As.span,{"aria-hidden":!0,...d,ref:i}):null});aF.displayName=oF;var LE="SelectScrollUpButton",lF=Z.forwardRef((t,i)=>{const c=mg(LE,t.__scopeSelect),d=SC(LE,t.__scopeSelect),[y,w]=Z.useState(!1),E=Mo(i,d.onScrollButtonChange);return cl(()=>{if(c.viewport&&c.isPositioned){let s=function(){const z=O.scrollTop>0;w(z)};const O=c.viewport;return s(),O.addEventListener("scroll",s),()=>O.removeEventListener("scroll",s)}},[c.viewport,c.isPositioned]),y?C.jsx(uF,{...t,ref:E,onAutoScroll:()=>{const{viewport:s,selectedItem:O}=c;s&&O&&(s.scrollTop=s.scrollTop-O.offsetHeight)}}):null});lF.displayName=LE;var NE="SelectScrollDownButton",cF=Z.forwardRef((t,i)=>{const c=mg(NE,t.__scopeSelect),d=SC(NE,t.__scopeSelect),[y,w]=Z.useState(!1),E=Mo(i,d.onScrollButtonChange);return cl(()=>{if(c.viewport&&c.isPositioned){let s=function(){const z=O.scrollHeight-O.clientHeight,j=Math.ceil(O.scrollTop)<z;w(j)};const O=c.viewport;return s(),O.addEventListener("scroll",s),()=>O.removeEventListener("scroll",s)}},[c.viewport,c.isPositioned]),y?C.jsx(uF,{...t,ref:E,onAutoScroll:()=>{const{viewport:s,selectedItem:O}=c;s&&O&&(s.scrollTop=s.scrollTop+O.offsetHeight)}}):null});cF.displayName=NE;var uF=Z.forwardRef((t,i)=>{const{__scopeSelect:c,onAutoScroll:d,...y}=t,w=mg("SelectScrollButton",c),E=Z.useRef(null),s=wS(c),O=Z.useCallback(()=>{E.current!==null&&(window.clearInterval(E.current),E.current=null)},[]);return Z.useEffect(()=>()=>O(),[O]),cl(()=>{s().find(j=>j.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[s]),C.jsx(As.div,{"aria-hidden":!0,...y,ref:i,style:{flexShrink:0,...y.style},onPointerDown:ls(y.onPointerDown,()=>{E.current===null&&(E.current=window.setInterval(d,50))}),onPointerMove:ls(y.onPointerMove,()=>{w.onItemLeave?.(),E.current===null&&(E.current=window.setInterval(d,50))}),onPointerLeave:ls(y.onPointerLeave,()=>{O()})})}),vre="SelectSeparator",dF=Z.forwardRef((t,i)=>{const{__scopeSelect:c,...d}=t;return C.jsx(As.div,{"aria-hidden":!0,...d,ref:i})});dF.displayName=vre;var kE="SelectArrow",bre=Z.forwardRef((t,i)=>{const{__scopeSelect:c,...d}=t,y=SS(c),w=pg(kE,c),E=mg(kE,c);return w.open&&E.position==="popper"?C.jsx(Xie,{...y,...d,ref:i}):null});bre.displayName=kE;var wre="SelectBubbleInput",hF=Z.forwardRef(({__scopeSelect:t,value:i,...c},d)=>{const y=Z.useRef(null),w=Mo(d,y),E=nre(i);return Z.useEffect(()=>{const s=y.current;if(!s)return;const O=window.HTMLSelectElement.prototype,j=Object.getOwnPropertyDescriptor(O,"value").set;if(E!==i&&j){const H=new Event("change",{bubbles:!0});j.call(s,i),s.dispatchEvent(H)}},[E,i]),C.jsx(As.select,{...c,style:{...OL,...c.style},ref:w,defaultValue:i})});hF.displayName=wre;function fF(t){return t===""||t===void 0}function pF(t){const i=lh(t),c=Z.useRef(""),d=Z.useRef(0),y=Z.useCallback(E=>{const s=c.current+E;i(s),(function O(z){c.current=z,window.clearTimeout(d.current),z!==""&&(d.current=window.setTimeout(()=>O(""),1e3))})(s)},[i]),w=Z.useCallback(()=>{c.current="",window.clearTimeout(d.current)},[]);return Z.useEffect(()=>()=>window.clearTimeout(d.current),[]),[c,y,w]}function mF(t,i,c){const y=i.length>1&&Array.from(i).every(z=>z===i[0])?i[0]:i,w=c?t.indexOf(c):-1;let E=Sre(t,Math.max(w,0));y.length===1&&(E=E.filter(z=>z!==c));const O=E.find(z=>z.textValue.toLowerCase().startsWith(y.toLowerCase()));return O!==c?O:void 0}function Sre(t,i){return t.map((c,d)=>t[(i+d)%t.length])}var Tre=Uj,gF=Gj,Ere=qj,Are=Zj,Cre=Wj,_F=Xj,Rre=Jj,yF=nF,xF=rF,Mre=sF,Ire=aF,vF=lF,bF=cF,wF=dF;const Rx=Tre,Mx=Ere,X_=Z.forwardRef(({className:t,children:i,...c},d)=>C.jsxs(gF,{ref:d,className:xs("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...c,children:[i,C.jsx(Are,{asChild:!0,children:C.jsx(sN,{className:"h-4 w-4 opacity-50"})})]}));X_.displayName=gF.displayName;const SF=Z.forwardRef(({className:t,...i},c)=>C.jsx(vF,{ref:c,className:xs("flex cursor-default items-center justify-center py-1",t),...i,children:C.jsx(wH,{className:"h-4 w-4"})}));SF.displayName=vF.displayName;const TF=Z.forwardRef(({className:t,...i},c)=>C.jsx(bF,{ref:c,className:xs("flex cursor-default items-center justify-center py-1",t),...i,children:C.jsx(sN,{className:"h-4 w-4"})}));TF.displayName=bF.displayName;const K_=Z.forwardRef(({className:t,children:i,position:c="popper",...d},y)=>C.jsx(Cre,{children:C.jsxs(_F,{ref:y,className:xs("relative z-[99999] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",c==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:c,...d,children:[C.jsx(SF,{}),C.jsx(Rre,{className:xs("p-1",c==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),C.jsx(TF,{})]})}));K_.displayName=_F.displayName;const Dre=Z.forwardRef(({className:t,...i},c)=>C.jsx(yF,{ref:c,className:xs("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...i}));Dre.displayName=yF.displayName;const hu=Z.forwardRef(({className:t,children:i,...c},d)=>C.jsxs(xF,{ref:d,className:xs("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...c,children:[C.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:C.jsx(Ire,{children:C.jsx(pA,{className:"h-4 w-4"})})}),C.jsx(Mre,{children:i})]}));hu.displayName=xF.displayName;const Pre=Z.forwardRef(({className:t,...i},c)=>C.jsx(wF,{ref:c,className:xs("-mx-1 my-1 h-px bg-muted",t),...i}));Pre.displayName=wF.displayName;const Ore=fg({registration_number:ks().min(3,"Registration number must be at least 3 characters").max(20,"Registration number must not exceed 20 characters"),capacity:Ax().min(10,"Capacity must be at least 10").max(100,"Capacity must not exceed 100"),status:Gx(["active","inactive","maintenance"]).optional(),route_id:Ax().nullable().optional()}),EF=({open:t,onClose:i,bus:c})=>{const d=nd(),y=!!c,{data:w}=$o({queryKey:["routes"],queryFn:()=>Xu.getRoutes()}),{register:E,handleSubmit:s,formState:{errors:O},reset:z,setValue:j,watch:H}=ug({resolver:hg(Ore),defaultValues:{registration_number:"",capacity:50,status:"inactive",route_id:null}}),Y=H("status"),ie=H("route_id");Z.useEffect(()=>{z(c?{registration_number:c.registration_number,capacity:c.capacity,status:c.status,route_id:c.route_id||null}:{registration_number:"",capacity:50,status:"inactive",route_id:null})},[c,z]);const oe=Ns({mutationFn:ge=>Ku.createBus(ge),onSuccess:()=>{d.invalidateQueries({queryKey:["buses"]}),yo({title:"Success",description:"Bus created successfully"}),i(),z()},onError:ge=>{yo({title:"Error",description:ge.message||"Failed to create bus",variant:"destructive"})}}),ee=Ns({mutationFn:ge=>Ku.updateBus(c.id,ge),onSuccess:()=>{d.invalidateQueries({queryKey:["buses"]}),d.invalidateQueries({queryKey:["bus",c.id]}),yo({title:"Success",description:"Bus updated successfully"}),i()},onError:ge=>{yo({title:"Error",description:ge.message||"Failed to update bus",variant:"destructive"})}}),le=ge=>{y?ee.mutate(ge):oe.mutate(ge)};return C.jsx(Tf,{open:t,onOpenChange:i,children:C.jsxs(ch,{className:"max-w-2xl",children:[C.jsx(uh,{children:C.jsx(dh,{children:y?"Edit Bus":"Add New Bus"})}),C.jsxs("form",{onSubmit:s(le),className:"space-y-6",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{htmlFor:"registration_number",children:["Registration Number ",C.jsx("span",{className:"text-red-500",children:"*"})]}),C.jsx(br,{id:"registration_number",placeholder:"e.g., ISB-1234",...E("registration_number")}),O.registration_number&&C.jsx("p",{className:"text-sm text-red-500",children:O.registration_number.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{htmlFor:"capacity",children:["Capacity (passengers) ",C.jsx("span",{className:"text-red-500",children:"*"})]}),C.jsx(br,{id:"capacity",type:"number",min:10,max:100,...E("capacity",{valueAsNumber:!0})}),O.capacity&&C.jsx("p",{className:"text-sm text-red-500",children:O.capacity.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{htmlFor:"status",children:["Status ",C.jsx("span",{className:"text-red-500",children:"*"})]}),C.jsxs(Rx,{value:Y,onValueChange:ge=>j("status",ge),children:[C.jsx(X_,{children:C.jsx(Mx,{placeholder:"Select status"})}),C.jsxs(K_,{children:[C.jsx(hu,{value:"active",children:"Active"}),C.jsx(hu,{value:"inactive",children:"Inactive"}),C.jsx(hu,{value:"maintenance",children:"Maintenance"})]})]}),O.status&&C.jsx("p",{className:"text-sm text-red-500",children:O.status.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"route_id",children:"Assigned Route (Optional)"}),C.jsxs(Rx,{value:ie?String(ie):"none",onValueChange:ge=>j("route_id",ge==="none"?null:parseInt(ge,10)),children:[C.jsx(X_,{children:C.jsx(Mx,{placeholder:"Select route"})}),C.jsxs(K_,{children:[C.jsx(hu,{value:"none",children:"No Route"}),w?.map(ge=>C.jsxs(hu,{value:String(ge.id),children:[ge.name," (",ge.code,")"]},ge.id))]})]})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),C.jsx(Un,{type:"submit",disabled:oe.isPending||ee.isPending,children:oe.isPending||ee.isPending?"Saving...":y?"Update Bus":"Create Bus"})]})]})]})})},zre=()=>{const{t}=Lc(),i=lg(),[c,d]=Z.useState(!1),{data:y,isLoading:w}=$o({queryKey:["buses"],queryFn:()=>Ku.getBuses(),refetchInterval:3e3}),E=s=>{switch(s){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-gray-100 text-gray-800 border-gray-200";case"maintenance":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return w?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("buses.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your fleet of buses"})]})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((s,O)=>C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})}),C.jsx(hi,{children:C.jsxs("div",{className:"space-y-2",children:[C.jsx("div",{className:"h-4 bg-gray-200 rounded"}),C.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})]},O))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("buses.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your fleet of buses"})]}),C.jsxs(Un,{className:"gap-2",onClick:()=>d(!0),children:[C.jsx(ed,{className:"h-4 w-4"}),t("buses.addBus")]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Buses"}),C.jsx("p",{className:"text-2xl font-bold",children:y?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-teal-100 rounded-lg flex items-center justify-center",children:C.jsx(yf,{className:"h-6 w-6 text-teal-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Buses"}),C.jsx("p",{className:"text-2xl font-bold",children:y?.filter(s=>s.status==="active").length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:C.jsx(R0,{className:"h-6 w-6 text-green-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"In Maintenance"}),C.jsx("p",{className:"text-2xl font-bold",children:y?.filter(s=>s.status==="maintenance").length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:C.jsx(R0,{className:"h-6 w-6 text-orange-600"})})]})})})]}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y?.map((s,O)=>C.jsx(_o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:O*.05},children:C.jsxs(li,{className:"hover:shadow-lg transition-all cursor-pointer group",children:[C.jsx(zr,{className:"pb-3",children:C.jsxs("div",{className:"flex justify-between items-start",children:[C.jsxs("div",{children:[C.jsx(ys,{className:"text-lg",children:s.registration_number}),C.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Capacity: ",s.capacity," passengers"]})]}),C.jsx("span",{className:xs("px-2 py-1 rounded-full text-xs font-medium border",E(s.status)),children:s.status})]})}),C.jsxs(hi,{className:"space-y-3",children:[s.route?C.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[C.jsx(yf,{className:"h-4 w-4 text-teal-600"}),C.jsx("span",{className:"font-medium",children:s.route.name}),C.jsxs("span",{className:"text-muted-foreground",children:["(",s.route.code,")"]})]}):C.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[C.jsx(yf,{className:"h-4 w-4"}),C.jsx("span",{children:"No route assigned"})]}),s.last_location?C.jsx("div",{className:"text-sm text-muted-foreground",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsxs("span",{children:["Speed: ",s.last_location.speed," km/h"]}),C.jsx("span",{children:""}),C.jsxs("span",{children:["Last seen: ",T9(s.last_location.timestamp)]})]})}):C.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[C.jsx(Y2,{className:"h-4 w-4 text-amber-500"}),C.jsx("span",{className:"text-amber-600 font-medium",children:"No GPS Data"})]}),C.jsxs(Un,{variant:"outline",size:"sm",className:"w-full gap-2",onClick:()=>i(`/buses/${s.id}`),children:[C.jsx(oN,{className:"h-4 w-4"}),"View Details"]})]})]})},s.id))}),!y||y.length===0?C.jsx(li,{children:C.jsx(hi,{className:"py-12",children:C.jsxs("div",{className:"text-center text-muted-foreground",children:[C.jsx(yf,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),C.jsx("p",{className:"text-lg font-medium",children:"No buses found"}),C.jsx("p",{className:"text-sm mt-2",children:"Add your first bus to get started"})]})})}):null,C.jsx(EF,{open:c,onClose:()=>d(!1)})]})},Lre=()=>{const{id:t}=XE(),i=lg(),c=nd(),[d,y]=Z.useState(!1),w=t?parseInt(t,10):void 0,{data:E,isLoading:s}=$o({queryKey:["bus",w],queryFn:()=>Ku.getBus(w),enabled:!!w,refetchInterval:300}),O=E?.last_location,z=Ns({mutationFn:()=>Ku.deleteBus(w),onSuccess:()=>{c.invalidateQueries({queryKey:["buses"]}),yo({title:"Success",description:"Bus removed successfully"}),i("/buses")},onError:ie=>{yo({title:"Error",description:ie.message||"Failed to remove bus",variant:"destructive"})}}),j=()=>{window.confirm("Are you sure you want to remove this bus? This action cannot be undone.")&&z.mutate()},H=()=>{E?.route_id?i(`/routes/${E.route_id}`):yo({title:"No Route Assigned",description:"This bus is not assigned to any route yet",variant:"destructive"})};if(s)return C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex items-center gap-4",children:C.jsxs(Un,{variant:"ghost",onClick:()=>i("/buses"),children:[C.jsx(C_,{className:"h-4 w-4 mr-2"}),"Back"]})}),C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"})}),C.jsx(hi,{children:C.jsx("div",{className:"h-64 bg-gray-200 rounded"})})]})]});if(!E)return C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex items-center gap-4",children:C.jsxs(Un,{variant:"ghost",onClick:()=>i("/buses"),children:[C.jsx(C_,{className:"h-4 w-4 mr-2"}),"Back"]})}),C.jsx(li,{children:C.jsx(hi,{className:"py-12",children:C.jsxs("div",{className:"text-center text-muted-foreground",children:[C.jsx(fu,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),C.jsx("p",{className:"text-lg font-medium",children:"Bus not found"})]})})})]});const Y=ie=>{switch(ie){case"active":return"bg-green-100 text-green-700";case"inactive":return"bg-gray-100 text-gray-700";case"maintenance":return"bg-orange-100 text-orange-700";default:return"bg-gray-100 text-gray-700"}};return C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsxs(Un,{variant:"ghost",onClick:()=>i("/buses"),children:[C.jsx(C_,{className:"h-4 w-4 mr-2"}),"Back"]}),C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:E.registration_number}),C.jsx("p",{className:"text-muted-foreground",children:"Bus Details"})]})]}),C.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-medium capitalize ${Y(E.status)}`,children:E.status})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx(ys,{className:"text-sm font-medium text-muted-foreground",children:"Capacity"})}),C.jsx(hi,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(fu,{className:"h-5 w-5 text-teal-600"}),C.jsxs("p",{className:"text-2xl font-bold",children:[E.capacity," seats"]})]})})]}),C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx(ys,{className:"text-sm font-medium text-muted-foreground",children:"Assigned Route"})}),C.jsx(hi,{children:E.route?C.jsxs("div",{children:[C.jsx("p",{className:"text-lg font-bold",children:E.route.name}),C.jsx("p",{className:"text-sm text-muted-foreground",children:E.route.code})]}):C.jsx("p",{className:"text-muted-foreground",children:"No route assigned"})})]}),C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx(ys,{className:"text-sm font-medium text-muted-foreground",children:"Registered"})}),C.jsx(hi,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(R_,{className:"h-5 w-5 text-blue-600"}),C.jsx("p",{className:"text-sm",children:new Date(E.created_at).toLocaleDateString()})]})})]})]}),O&&C.jsxs(li,{children:[C.jsx(zr,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(yf,{className:"h-5 w-5 text-teal-600"}),C.jsx(ys,{children:"Location Data"})]})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsx("div",{className:"aspect-video rounded-lg overflow-hidden border-2 border-gray-200 relative",style:{zIndex:1},children:C.jsx(nS,{initialViewState:{longitude:O.longitude,latitude:O.latitude,zoom:14},buses:E.last_location?[E]:[],stops:E.route?.stops?.map(ie=>({id:ie.stop_id,name:ie.stop_name,latitude:ie.latitude,longitude:ie.longitude,created_at:"",updated_at:""}))||[],showRoute:!!E.route?.stops&&E.route.stops.length>1,routeColor:E.route?.color||"#0d9488",height:"100%",interactive:!0,showControls:!0,fitToBounds:!!E.route?.stops&&E.route.stops.length>0})}),C.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[C.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[C.jsx(R0,{className:"h-5 w-5 mx-auto mb-1 text-teal-600"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Speed"}),C.jsx("p",{className:"text-lg font-bold",children:O.speed!=null?`${O.speed} km/h`:"N/A"})]}),C.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[C.jsx(yf,{className:"h-5 w-5 mx-auto mb-1 text-blue-600"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Heading"}),C.jsx("p",{className:"text-lg font-bold",children:O.heading!=null?`${O.heading}`:"N/A"})]}),C.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[C.jsx(Dl,{className:"h-5 w-5 mx-auto mb-1 text-purple-600"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Update"}),C.jsx("p",{className:"text-xs font-medium",children:new Date(O.timestamp).toLocaleTimeString()})]})]})]})]}),!O&&C.jsxs(li,{className:"border-amber-200 bg-amber-50/30",children:[C.jsx(zr,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Y2,{className:"h-5 w-5 text-amber-500"}),C.jsx(ys,{className:"text-amber-700",children:"No GPS Data Available"})]})}),C.jsx(hi,{children:C.jsxs("div",{className:"text-center py-8",children:[C.jsx(Y2,{className:"h-16 w-16 mx-auto mb-4 text-amber-400 opacity-50"}),C.jsx("p",{className:"text-lg font-medium text-amber-700",children:"This bus has not reported its location yet"}),C.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Location data will appear here once the bus starts transmitting GPS signals."}),E.last_location?.timestamp&&C.jsxs("p",{className:"text-xs text-muted-foreground mt-4",children:["Last data received: ",new Date(E.last_location.timestamp).toLocaleString()]})]})})]}),C.jsxs("div",{className:"flex gap-3",children:[C.jsx(Un,{variant:"outline",onClick:()=>y(!0),children:"Edit Bus Details"}),C.jsx(Un,{variant:"outline",onClick:H,children:"View Route"}),C.jsx(Un,{variant:"destructive",className:"ml-auto",onClick:j,disabled:z.isPending,children:z.isPending?"Removing...":"Remove Bus"})]}),C.jsx(EF,{open:d,onClose:()=>y(!1),bus:E})]})},Nre=fg({name:ks().min(2,"Name must be at least 2 characters"),code:ks().min(2,"Code must be at least 2 characters").max(10,"Code must not exceed 10 characters"),description:ks().optional(),color:ks().regex(/^#[0-9A-Fa-f]{6}$/,"Must be a valid hex color (e.g., #14b8a6)")}),AF=({open:t,onClose:i,route:c})=>{const d=nd(),y=!!c,{register:w,handleSubmit:E,formState:{errors:s},reset:O,watch:z,setValue:j}=ug({resolver:hg(Nre),defaultValues:{name:"",code:"",description:"",color:"#14b8a6"}}),H=z("color");Z.useEffect(()=>{O(c?{name:c.name,code:c.code,description:c.description||"",color:c.color||"#14b8a6"}:{name:"",code:"",description:"",color:"#14b8a6"})},[c,O,t]);const Y=Ns({mutationFn:ge=>Xu.createRoute(ge),onSuccess:()=>{d.invalidateQueries({queryKey:["routes"]}),yo({title:"Success",description:"Route created successfully"}),i(),O()},onError:ge=>{yo({title:"Error",description:ge.message||"Failed to create route",variant:"destructive"})}}),ie=Ns({mutationFn:ge=>Xu.updateRoute(c.id,ge),onSuccess:()=>{d.invalidateQueries({queryKey:["routes"]}),d.invalidateQueries({queryKey:["route",c.id]}),yo({title:"Success",description:"Route updated successfully"}),i()},onError:ge=>{yo({title:"Error",description:ge.message||"Failed to update route",variant:"destructive"})}}),oe=ge=>{y?ie.mutate(ge):Y.mutate(ge)},ee=Y.isPending||ie.isPending,le=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"];return C.jsx(Tf,{open:t,onOpenChange:i,children:C.jsxs(ch,{className:"max-w-md",children:[C.jsxs(uh,{children:[C.jsx(dh,{children:y?"Edit Route":"Add New Route"}),C.jsx(k0,{children:y?"Update the route details below.":"Create a new bus route. You can add stops after creating the route."})]}),C.jsxs("form",{onSubmit:E(oe),className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"name",children:"Route Name *"}),C.jsx(br,{id:"name",placeholder:"e.g., Blue Line",...w("name")}),s.name&&C.jsx("p",{className:"text-sm text-destructive",children:s.name.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"code",children:"Route Code *"}),C.jsx(br,{id:"code",placeholder:"e.g., BL-01",...w("code")}),s.code&&C.jsx("p",{className:"text-sm text-destructive",children:s.code.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"description",children:"Description"}),C.jsx(br,{id:"description",placeholder:"e.g., Blue Area to Faizabad",...w("description")}),s.description&&C.jsx("p",{className:"text-sm text-destructive",children:s.description.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{children:"Route Color *"}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("div",{className:"h-10 w-10 rounded-lg border-2 border-gray-300 flex-shrink-0",style:{backgroundColor:H}}),C.jsx(br,{type:"text",placeholder:"#14b8a6",...w("color"),className:"font-mono"})]}),C.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:le.map(ge=>C.jsx("button",{type:"button",className:`h-8 w-8 rounded-lg border-2 transition-transform hover:scale-110 ${H===ge?"border-gray-900 ring-2 ring-offset-2 ring-gray-400":"border-gray-200"}`,style:{backgroundColor:ge},onClick:()=>j("color",ge)},ge))}),s.color&&C.jsx("p",{className:"text-sm text-destructive",children:s.color.message})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,disabled:ee,children:"Cancel"}),C.jsxs(Un,{type:"submit",disabled:ee,children:[ee&&C.jsx(z_,{className:"mr-2 h-4 w-4 animate-spin"}),y?"Update Route":"Create Route"]})]})]})]})})},kre=()=>{const{t}=Lc(),i=lg(),[c,d]=Z.useState(!1),{data:y,isLoading:w}=$o({queryKey:["routes"],queryFn:()=>Xu.getRoutes()});return w?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("routes.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage bus routes and stops"})]})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[...Array(4)].map((E,s)=>C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})}),C.jsx(hi,{children:C.jsxs("div",{className:"space-y-2",children:[C.jsx("div",{className:"h-4 bg-gray-200 rounded"}),C.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})]},s))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("routes.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage bus routes and stops"})]}),C.jsxs(Un,{className:"gap-2",onClick:()=>d(!0),children:[C.jsx(ed,{className:"h-4 w-4"}),t("routes.addRoute")]})]}),C.jsx(AF,{open:c,onClose:()=>d(!1)}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:y?.map((E,s)=>C.jsx(_o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:s*.1},children:C.jsxs(li,{className:"hover:shadow-lg transition-all cursor-pointer group",children:[C.jsx(zr,{children:C.jsx("div",{className:"flex items-start justify-between",children:C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("div",{className:"h-12 w-12 rounded-xl flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:E.color||"#14b8a6"},children:E.code}),C.jsxs("div",{children:[C.jsx(ys,{className:"text-xl",children:E.name}),C.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:E.description||"No description"})]})]})})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[C.jsx(Dl,{className:"h-4 w-4 text-teal-600"}),C.jsxs("span",{className:"font-medium",children:[E.route_stops?.length||0," stops"]})]}),E.route_stops&&E.route_stops.length>0&&C.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-2",children:[C.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[C.jsx("span",{className:"font-medium",children:E.route_stops[0].stop?.name}),C.jsx(uH,{className:"h-4 w-4 text-muted-foreground"}),C.jsx("span",{className:"font-medium",children:E.route_stops[E.route_stops.length-1].stop?.name})]}),E.route_stops.length>2&&C.jsxs("p",{className:"text-xs text-muted-foreground",children:["Via ",E.route_stops.length-2," other stops"]})]}),C.jsxs(Un,{variant:"outline",size:"sm",className:"w-full gap-2 group-hover:bg-primary group-hover:text-primary-foreground transition-colors",onClick:()=>i(`/routes/${E.id}`),children:[C.jsx(oN,{className:"h-4 w-4"}),"View Route Details"]})]})]})},E.id))}),!y||y.length===0?C.jsx(li,{children:C.jsx(hi,{className:"py-12",children:C.jsxs("div",{className:"text-center text-muted-foreground",children:[C.jsx(Dl,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),C.jsx("p",{className:"text-lg font-medium",children:"No routes found"}),C.jsx("p",{className:"text-sm mt-2",children:"Create your first route to get started"})]})})}):null]})};function jre(){for(var t=arguments.length,i=new Array(t),c=0;c<t;c++)i[c]=arguments[c];return Z.useMemo(()=>d=>{i.forEach(y=>y(d))},i)}const TS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Wx(t){const i=Object.prototype.toString.call(t);return i==="[object Window]"||i==="[object global]"}function TC(t){return"nodeType"in t}function kc(t){var i,c;return t?Wx(t)?t:TC(t)&&(i=(c=t.ownerDocument)==null?void 0:c.defaultView)!=null?i:window:window}function EC(t){const{Document:i}=kc(t);return t instanceof i}function ob(t){return Wx(t)?!1:t instanceof kc(t).HTMLElement}function CF(t){return t instanceof kc(t).SVGElement}function Xx(t){return t?Wx(t)?t.document:TC(t)?EC(t)?t:ob(t)||CF(t)?t.ownerDocument:document:document:document}const Af=TS?Z.useLayoutEffect:Z.useEffect;function AC(t){const i=Z.useRef(t);return Af(()=>{i.current=t}),Z.useCallback(function(){for(var c=arguments.length,d=new Array(c),y=0;y<c;y++)d[y]=arguments[y];return i.current==null?void 0:i.current(...d)},[])}function Fre(){const t=Z.useRef(null),i=Z.useCallback((d,y)=>{t.current=setInterval(d,y)},[]),c=Z.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[i,c]}function B0(t,i){i===void 0&&(i=[t]);const c=Z.useRef(t);return Af(()=>{c.current!==t&&(c.current=t)},i),c}function ab(t,i){const c=Z.useRef();return Z.useMemo(()=>{const d=t(c.current);return c.current=d,d},[...i])}function jw(t){const i=AC(t),c=Z.useRef(null),d=Z.useCallback(y=>{y!==c.current&&i?.(y,c.current),c.current=y},[]);return[c,d]}function jE(t){const i=Z.useRef();return Z.useEffect(()=>{i.current=t},[t]),i.current}let E2={};function lb(t,i){return Z.useMemo(()=>{if(i)return i;const c=E2[t]==null?0:E2[t]+1;return E2[t]=c,t+"-"+c},[t,i])}function RF(t){return function(i){for(var c=arguments.length,d=new Array(c>1?c-1:0),y=1;y<c;y++)d[y-1]=arguments[y];return d.reduce((w,E)=>{const s=Object.entries(E);for(const[O,z]of s){const j=w[O];j!=null&&(w[O]=j+t*z)}return w},{...i})}}const bx=RF(1),V0=RF(-1);function Bre(t){return"clientX"in t&&"clientY"in t}function CC(t){if(!t)return!1;const{KeyboardEvent:i}=kc(t.target);return i&&t instanceof i}function Vre(t){if(!t)return!1;const{TouchEvent:i}=kc(t.target);return i&&t instanceof i}function FE(t){if(Vre(t)){if(t.touches&&t.touches.length){const{clientX:i,clientY:c}=t.touches[0];return{x:i,y:c}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:i,clientY:c}=t.changedTouches[0];return{x:i,y:c}}}return Bre(t)?{x:t.clientX,y:t.clientY}:null}const U0=Object.freeze({Translate:{toString(t){if(!t)return;const{x:i,y:c}=t;return"translate3d("+(i?Math.round(i):0)+"px, "+(c?Math.round(c):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:i,scaleY:c}=t;return"scaleX("+i+") scaleY("+c+")"}},Transform:{toString(t){if(t)return[U0.Translate.toString(t),U0.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:i,duration:c,easing:d}=t;return i+" "+c+"ms "+d}}}),oz="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Ure(t){return t.matches(oz)?t:t.querySelector(oz)}const $re={display:"none"};function Gre(t){let{id:i,value:c}=t;return vr.createElement("div",{id:i,style:$re},c)}function Hre(t){let{id:i,announcement:c,ariaLiveType:d="assertive"}=t;const y={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return vr.createElement("div",{id:i,style:y,role:"status","aria-live":d,"aria-atomic":!0},c)}function qre(){const[t,i]=Z.useState("");return{announce:Z.useCallback(d=>{d!=null&&i(d)},[]),announcement:t}}const MF=Z.createContext(null);function Zre(t){const i=Z.useContext(MF);Z.useEffect(()=>{if(!i)throw new Error("useDndMonitor must be used within a children of <DndContext>");return i(t)},[t,i])}function Wre(){const[t]=Z.useState(()=>new Set),i=Z.useCallback(d=>(t.add(d),()=>t.delete(d)),[t]);return[Z.useCallback(d=>{let{type:y,event:w}=d;t.forEach(E=>{var s;return(s=E[y])==null?void 0:s.call(E,w)})},[t]),i]}const Xre={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Kre={onDragStart(t){let{active:i}=t;return"Picked up draggable item "+i.id+"."},onDragOver(t){let{active:i,over:c}=t;return c?"Draggable item "+i.id+" was moved over droppable area "+c.id+".":"Draggable item "+i.id+" is no longer over a droppable area."},onDragEnd(t){let{active:i,over:c}=t;return c?"Draggable item "+i.id+" was dropped over droppable area "+c.id:"Draggable item "+i.id+" was dropped."},onDragCancel(t){let{active:i}=t;return"Dragging was cancelled. Draggable item "+i.id+" was dropped."}};function Yre(t){let{announcements:i=Kre,container:c,hiddenTextDescribedById:d,screenReaderInstructions:y=Xre}=t;const{announce:w,announcement:E}=qre(),s=lb("DndLiveRegion"),[O,z]=Z.useState(!1);if(Z.useEffect(()=>{z(!0)},[]),Zre(Z.useMemo(()=>({onDragStart(H){let{active:Y}=H;w(i.onDragStart({active:Y}))},onDragMove(H){let{active:Y,over:ie}=H;i.onDragMove&&w(i.onDragMove({active:Y,over:ie}))},onDragOver(H){let{active:Y,over:ie}=H;w(i.onDragOver({active:Y,over:ie}))},onDragEnd(H){let{active:Y,over:ie}=H;w(i.onDragEnd({active:Y,over:ie}))},onDragCancel(H){let{active:Y,over:ie}=H;w(i.onDragCancel({active:Y,over:ie}))}}),[w,i])),!O)return null;const j=vr.createElement(vr.Fragment,null,vr.createElement(Gre,{id:d,value:y.draggable}),vr.createElement(Hre,{id:s,announcement:E}));return c?ah.createPortal(j,c):j}var Ca;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Ca||(Ca={}));function Fw(){}function az(t,i){return Z.useMemo(()=>({sensor:t,options:i??{}}),[t,i])}function Qre(){for(var t=arguments.length,i=new Array(t),c=0;c<t;c++)i[c]=arguments[c];return Z.useMemo(()=>[...i].filter(d=>d!=null),[...i])}const ph=Object.freeze({x:0,y:0});function IF(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function DF(t,i){let{data:{value:c}}=t,{data:{value:d}}=i;return c-d}function Jre(t,i){let{data:{value:c}}=t,{data:{value:d}}=i;return d-c}function lz(t){let{left:i,top:c,height:d,width:y}=t;return[{x:i,y:c},{x:i+y,y:c},{x:i,y:c+d},{x:i+y,y:c+d}]}function PF(t,i){if(!t||t.length===0)return null;const[c]=t;return c[i]}function cz(t,i,c){return i===void 0&&(i=t.left),c===void 0&&(c=t.top),{x:i+t.width*.5,y:c+t.height*.5}}const ese=t=>{let{collisionRect:i,droppableRects:c,droppableContainers:d}=t;const y=cz(i,i.left,i.top),w=[];for(const E of d){const{id:s}=E,O=c.get(s);if(O){const z=IF(cz(O),y);w.push({id:s,data:{droppableContainer:E,value:z}})}}return w.sort(DF)},tse=t=>{let{collisionRect:i,droppableRects:c,droppableContainers:d}=t;const y=lz(i),w=[];for(const E of d){const{id:s}=E,O=c.get(s);if(O){const z=lz(O),j=y.reduce((Y,ie,oe)=>Y+IF(z[oe],ie),0),H=Number((j/4).toFixed(4));w.push({id:s,data:{droppableContainer:E,value:H}})}}return w.sort(DF)};function nse(t,i){const c=Math.max(i.top,t.top),d=Math.max(i.left,t.left),y=Math.min(i.left+i.width,t.left+t.width),w=Math.min(i.top+i.height,t.top+t.height),E=y-d,s=w-c;if(d<y&&c<w){const O=i.width*i.height,z=t.width*t.height,j=E*s,H=j/(O+z-j);return Number(H.toFixed(4))}return 0}const ise=t=>{let{collisionRect:i,droppableRects:c,droppableContainers:d}=t;const y=[];for(const w of d){const{id:E}=w,s=c.get(E);if(s){const O=nse(s,i);O>0&&y.push({id:E,data:{droppableContainer:w,value:O}})}}return y.sort(Jre)};function rse(t,i,c){return{...t,scaleX:i&&c?i.width/c.width:1,scaleY:i&&c?i.height/c.height:1}}function OF(t,i){return t&&i?{x:t.left-i.left,y:t.top-i.top}:ph}function sse(t){return function(c){for(var d=arguments.length,y=new Array(d>1?d-1:0),w=1;w<d;w++)y[w-1]=arguments[w];return y.reduce((E,s)=>({...E,top:E.top+t*s.y,bottom:E.bottom+t*s.y,left:E.left+t*s.x,right:E.right+t*s.x}),{...c})}}const ose=sse(1);function ase(t){if(t.startsWith("matrix3d(")){const i=t.slice(9,-1).split(/, /);return{x:+i[12],y:+i[13],scaleX:+i[0],scaleY:+i[5]}}else if(t.startsWith("matrix(")){const i=t.slice(7,-1).split(/, /);return{x:+i[4],y:+i[5],scaleX:+i[0],scaleY:+i[3]}}return null}function lse(t,i,c){const d=ase(i);if(!d)return t;const{scaleX:y,scaleY:w,x:E,y:s}=d,O=t.left-E-(1-y)*parseFloat(c),z=t.top-s-(1-w)*parseFloat(c.slice(c.indexOf(" ")+1)),j=y?t.width/y:t.width,H=w?t.height/w:t.height;return{width:j,height:H,top:z,right:O+j,bottom:z+H,left:O}}const cse={ignoreTransform:!1};function Kx(t,i){i===void 0&&(i=cse);let c=t.getBoundingClientRect();if(i.ignoreTransform){const{transform:z,transformOrigin:j}=kc(t).getComputedStyle(t);z&&(c=lse(c,z,j))}const{top:d,left:y,width:w,height:E,bottom:s,right:O}=c;return{top:d,left:y,width:w,height:E,bottom:s,right:O}}function uz(t){return Kx(t,{ignoreTransform:!0})}function use(t){const i=t.innerWidth,c=t.innerHeight;return{top:0,left:0,right:i,bottom:c,width:i,height:c}}function dse(t,i){return i===void 0&&(i=kc(t).getComputedStyle(t)),i.position==="fixed"}function hse(t,i){i===void 0&&(i=kc(t).getComputedStyle(t));const c=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(y=>{const w=i[y];return typeof w=="string"?c.test(w):!1})}function ES(t,i){const c=[];function d(y){if(i!=null&&c.length>=i||!y)return c;if(EC(y)&&y.scrollingElement!=null&&!c.includes(y.scrollingElement))return c.push(y.scrollingElement),c;if(!ob(y)||CF(y)||c.includes(y))return c;const w=kc(t).getComputedStyle(y);return y!==t&&hse(y,w)&&c.push(y),dse(y,w)?c:d(y.parentNode)}return t?d(t):c}function zF(t){const[i]=ES(t,1);return i??null}function A2(t){return!TS||!t?null:Wx(t)?t:TC(t)?EC(t)||t===Xx(t).scrollingElement?window:ob(t)?t:null:null}function LF(t){return Wx(t)?t.scrollX:t.scrollLeft}function NF(t){return Wx(t)?t.scrollY:t.scrollTop}function BE(t){return{x:LF(t),y:NF(t)}}var qa;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(qa||(qa={}));function kF(t){return!TS||!t?!1:t===document.scrollingElement}function jF(t){const i={x:0,y:0},c=kF(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},d={x:t.scrollWidth-c.width,y:t.scrollHeight-c.height},y=t.scrollTop<=i.y,w=t.scrollLeft<=i.x,E=t.scrollTop>=d.y,s=t.scrollLeft>=d.x;return{isTop:y,isLeft:w,isBottom:E,isRight:s,maxScroll:d,minScroll:i}}const fse={x:.2,y:.2};function pse(t,i,c,d,y){let{top:w,left:E,right:s,bottom:O}=c;d===void 0&&(d=10),y===void 0&&(y=fse);const{isTop:z,isBottom:j,isLeft:H,isRight:Y}=jF(t),ie={x:0,y:0},oe={x:0,y:0},ee={height:i.height*y.y,width:i.width*y.x};return!z&&w<=i.top+ee.height?(ie.y=qa.Backward,oe.y=d*Math.abs((i.top+ee.height-w)/ee.height)):!j&&O>=i.bottom-ee.height&&(ie.y=qa.Forward,oe.y=d*Math.abs((i.bottom-ee.height-O)/ee.height)),!Y&&s>=i.right-ee.width?(ie.x=qa.Forward,oe.x=d*Math.abs((i.right-ee.width-s)/ee.width)):!H&&E<=i.left+ee.width&&(ie.x=qa.Backward,oe.x=d*Math.abs((i.left+ee.width-E)/ee.width)),{direction:ie,speed:oe}}function mse(t){if(t===document.scrollingElement){const{innerWidth:w,innerHeight:E}=window;return{top:0,left:0,right:w,bottom:E,width:w,height:E}}const{top:i,left:c,right:d,bottom:y}=t.getBoundingClientRect();return{top:i,left:c,right:d,bottom:y,width:t.clientWidth,height:t.clientHeight}}function FF(t){return t.reduce((i,c)=>bx(i,BE(c)),ph)}function gse(t){return t.reduce((i,c)=>i+LF(c),0)}function _se(t){return t.reduce((i,c)=>i+NF(c),0)}function yse(t,i){if(i===void 0&&(i=Kx),!t)return;const{top:c,left:d,bottom:y,right:w}=i(t);zF(t)&&(y<=0||w<=0||c>=window.innerHeight||d>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const xse=[["x",["left","right"],gse],["y",["top","bottom"],_se]];class RC{constructor(i,c){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const d=ES(c),y=FF(d);this.rect={...i},this.width=i.width,this.height=i.height;for(const[w,E,s]of xse)for(const O of E)Object.defineProperty(this,O,{get:()=>{const z=s(d),j=y[w]-z;return this.rect[O]+j},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class b0{constructor(i){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(c=>{var d;return(d=this.target)==null?void 0:d.removeEventListener(...c)})},this.target=i}add(i,c,d){var y;(y=this.target)==null||y.addEventListener(i,c,d),this.listeners.push([i,c,d])}}function vse(t){const{EventTarget:i}=kc(t);return t instanceof i?t:Xx(t)}function C2(t,i){const c=Math.abs(t.x),d=Math.abs(t.y);return typeof i=="number"?Math.sqrt(c**2+d**2)>i:"x"in i&&"y"in i?c>i.x&&d>i.y:"x"in i?c>i.x:"y"in i?d>i.y:!1}var Wu;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Wu||(Wu={}));function dz(t){t.preventDefault()}function bse(t){t.stopPropagation()}var as;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(as||(as={}));const BF={start:[as.Space,as.Enter],cancel:[as.Esc],end:[as.Space,as.Enter,as.Tab]},wse=(t,i)=>{let{currentCoordinates:c}=i;switch(t.code){case as.Right:return{...c,x:c.x+25};case as.Left:return{...c,x:c.x-25};case as.Down:return{...c,y:c.y+25};case as.Up:return{...c,y:c.y-25}}};class MC{constructor(i){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=i;const{event:{target:c}}=i;this.props=i,this.listeners=new b0(Xx(c)),this.windowListeners=new b0(kc(c)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Wu.Resize,this.handleCancel),this.windowListeners.add(Wu.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Wu.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:i,onStart:c}=this.props,d=i.node.current;d&&yse(d),c(ph)}handleKeyDown(i){if(CC(i)){const{active:c,context:d,options:y}=this.props,{keyboardCodes:w=BF,coordinateGetter:E=wse,scrollBehavior:s="smooth"}=y,{code:O}=i;if(w.end.includes(O)){this.handleEnd(i);return}if(w.cancel.includes(O)){this.handleCancel(i);return}const{collisionRect:z}=d.current,j=z?{x:z.left,y:z.top}:ph;this.referenceCoordinates||(this.referenceCoordinates=j);const H=E(i,{active:c,context:d.current,currentCoordinates:j});if(H){const Y=V0(H,j),ie={x:0,y:0},{scrollableAncestors:oe}=d.current;for(const ee of oe){const le=i.code,{isTop:ge,isRight:pe,isLeft:_e,isBottom:Re,maxScroll:xe,minScroll:Ze}=jF(ee),Le=mse(ee),$e={x:Math.min(le===as.Right?Le.right-Le.width/2:Le.right,Math.max(le===as.Right?Le.left:Le.left+Le.width/2,H.x)),y:Math.min(le===as.Down?Le.bottom-Le.height/2:Le.bottom,Math.max(le===as.Down?Le.top:Le.top+Le.height/2,H.y))},st=le===as.Right&&!pe||le===as.Left&&!_e,Et=le===as.Down&&!Re||le===as.Up&&!ge;if(st&&$e.x!==H.x){const Ut=ee.scrollLeft+Y.x,$t=le===as.Right&&Ut<=xe.x||le===as.Left&&Ut>=Ze.x;if($t&&!Y.y){ee.scrollTo({left:Ut,behavior:s});return}$t?ie.x=ee.scrollLeft-Ut:ie.x=le===as.Right?ee.scrollLeft-xe.x:ee.scrollLeft-Ze.x,ie.x&&ee.scrollBy({left:-ie.x,behavior:s});break}else if(Et&&$e.y!==H.y){const Ut=ee.scrollTop+Y.y,$t=le===as.Down&&Ut<=xe.y||le===as.Up&&Ut>=Ze.y;if($t&&!Y.x){ee.scrollTo({top:Ut,behavior:s});return}$t?ie.y=ee.scrollTop-Ut:ie.y=le===as.Down?ee.scrollTop-xe.y:ee.scrollTop-Ze.y,ie.y&&ee.scrollBy({top:-ie.y,behavior:s});break}}this.handleMove(i,bx(V0(H,this.referenceCoordinates),ie))}}}handleMove(i,c){const{onMove:d}=this.props;i.preventDefault(),d(c)}handleEnd(i){const{onEnd:c}=this.props;i.preventDefault(),this.detach(),c()}handleCancel(i){const{onCancel:c}=this.props;i.preventDefault(),this.detach(),c()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}MC.activators=[{eventName:"onKeyDown",handler:(t,i,c)=>{let{keyboardCodes:d=BF,onActivation:y}=i,{active:w}=c;const{code:E}=t.nativeEvent;if(d.start.includes(E)){const s=w.activatorNode.current;return s&&t.target!==s?!1:(t.preventDefault(),y?.({event:t.nativeEvent}),!0)}return!1}}];function hz(t){return!!(t&&"distance"in t)}function fz(t){return!!(t&&"delay"in t)}class IC{constructor(i,c,d){var y;d===void 0&&(d=vse(i.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=i,this.events=c;const{event:w}=i,{target:E}=w;this.props=i,this.events=c,this.document=Xx(E),this.documentListeners=new b0(this.document),this.listeners=new b0(d),this.windowListeners=new b0(kc(E)),this.initialCoordinates=(y=FE(w))!=null?y:ph,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:i,props:{options:{activationConstraint:c,bypassActivationConstraint:d}}}=this;if(this.listeners.add(i.move.name,this.handleMove,{passive:!1}),this.listeners.add(i.end.name,this.handleEnd),i.cancel&&this.listeners.add(i.cancel.name,this.handleCancel),this.windowListeners.add(Wu.Resize,this.handleCancel),this.windowListeners.add(Wu.DragStart,dz),this.windowListeners.add(Wu.VisibilityChange,this.handleCancel),this.windowListeners.add(Wu.ContextMenu,dz),this.documentListeners.add(Wu.Keydown,this.handleKeydown),c){if(d!=null&&d({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(fz(c)){this.timeoutId=setTimeout(this.handleStart,c.delay),this.handlePending(c);return}if(hz(c)){this.handlePending(c);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(i,c){const{active:d,onPending:y}=this.props;y(d,i,this.initialCoordinates,c)}handleStart(){const{initialCoordinates:i}=this,{onStart:c}=this.props;i&&(this.activated=!0,this.documentListeners.add(Wu.Click,bse,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Wu.SelectionChange,this.removeTextSelection),c(i))}handleMove(i){var c;const{activated:d,initialCoordinates:y,props:w}=this,{onMove:E,options:{activationConstraint:s}}=w;if(!y)return;const O=(c=FE(i))!=null?c:ph,z=V0(y,O);if(!d&&s){if(hz(s)){if(s.tolerance!=null&&C2(z,s.tolerance))return this.handleCancel();if(C2(z,s.distance))return this.handleStart()}if(fz(s)&&C2(z,s.tolerance))return this.handleCancel();this.handlePending(s,z);return}i.cancelable&&i.preventDefault(),E(O)}handleEnd(){const{onAbort:i,onEnd:c}=this.props;this.detach(),this.activated||i(this.props.active),c()}handleCancel(){const{onAbort:i,onCancel:c}=this.props;this.detach(),this.activated||i(this.props.active),c()}handleKeydown(i){i.code===as.Esc&&this.handleCancel()}removeTextSelection(){var i;(i=this.document.getSelection())==null||i.removeAllRanges()}}const Sse={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class DC extends IC{constructor(i){const{event:c}=i,d=Xx(c.target);super(i,Sse,d)}}DC.activators=[{eventName:"onPointerDown",handler:(t,i)=>{let{nativeEvent:c}=t,{onActivation:d}=i;return!c.isPrimary||c.button!==0?!1:(d?.({event:c}),!0)}}];const Tse={move:{name:"mousemove"},end:{name:"mouseup"}};var VE;(function(t){t[t.RightClick=2]="RightClick"})(VE||(VE={}));class Ese extends IC{constructor(i){super(i,Tse,Xx(i.event.target))}}Ese.activators=[{eventName:"onMouseDown",handler:(t,i)=>{let{nativeEvent:c}=t,{onActivation:d}=i;return c.button===VE.RightClick?!1:(d?.({event:c}),!0)}}];const R2={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Ase extends IC{constructor(i){super(i,R2)}static setup(){return window.addEventListener(R2.move.name,i,{capture:!1,passive:!1}),function(){window.removeEventListener(R2.move.name,i)};function i(){}}}Ase.activators=[{eventName:"onTouchStart",handler:(t,i)=>{let{nativeEvent:c}=t,{onActivation:d}=i;const{touches:y}=c;return y.length>1?!1:(d?.({event:c}),!0)}}];var w0;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(w0||(w0={}));var Bw;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Bw||(Bw={}));function Cse(t){let{acceleration:i,activator:c=w0.Pointer,canScroll:d,draggingRect:y,enabled:w,interval:E=5,order:s=Bw.TreeOrder,pointerCoordinates:O,scrollableAncestors:z,scrollableAncestorRects:j,delta:H,threshold:Y}=t;const ie=Mse({delta:H,disabled:!w}),[oe,ee]=Fre(),le=Z.useRef({x:0,y:0}),ge=Z.useRef({x:0,y:0}),pe=Z.useMemo(()=>{switch(c){case w0.Pointer:return O?{top:O.y,bottom:O.y,left:O.x,right:O.x}:null;case w0.DraggableRect:return y}},[c,y,O]),_e=Z.useRef(null),Re=Z.useCallback(()=>{const Ze=_e.current;if(!Ze)return;const Le=le.current.x*ge.current.x,$e=le.current.y*ge.current.y;Ze.scrollBy(Le,$e)},[]),xe=Z.useMemo(()=>s===Bw.TreeOrder?[...z].reverse():z,[s,z]);Z.useEffect(()=>{if(!w||!z.length||!pe){ee();return}for(const Ze of xe){if(d?.(Ze)===!1)continue;const Le=z.indexOf(Ze),$e=j[Le];if(!$e)continue;const{direction:st,speed:Et}=pse(Ze,$e,pe,i,Y);for(const Ut of["x","y"])ie[Ut][st[Ut]]||(Et[Ut]=0,st[Ut]=0);if(Et.x>0||Et.y>0){ee(),_e.current=Ze,oe(Re,E),le.current=Et,ge.current=st;return}}le.current={x:0,y:0},ge.current={x:0,y:0},ee()},[i,Re,d,ee,w,E,JSON.stringify(pe),JSON.stringify(ie),oe,z,xe,j,JSON.stringify(Y)])}const Rse={x:{[qa.Backward]:!1,[qa.Forward]:!1},y:{[qa.Backward]:!1,[qa.Forward]:!1}};function Mse(t){let{delta:i,disabled:c}=t;const d=jE(i);return ab(y=>{if(c||!d||!y)return Rse;const w={x:Math.sign(i.x-d.x),y:Math.sign(i.y-d.y)};return{x:{[qa.Backward]:y.x[qa.Backward]||w.x===-1,[qa.Forward]:y.x[qa.Forward]||w.x===1},y:{[qa.Backward]:y.y[qa.Backward]||w.y===-1,[qa.Forward]:y.y[qa.Forward]||w.y===1}}},[c,i,d])}function Ise(t,i){const c=i!=null?t.get(i):void 0,d=c?c.node.current:null;return ab(y=>{var w;return i==null?null:(w=d??y)!=null?w:null},[d,i])}function Dse(t,i){return Z.useMemo(()=>t.reduce((c,d)=>{const{sensor:y}=d,w=y.activators.map(E=>({eventName:E.eventName,handler:i(E.handler,d)}));return[...c,...w]},[]),[t,i])}var $0;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})($0||($0={}));var UE;(function(t){t.Optimized="optimized"})(UE||(UE={}));const pz=new Map;function Pse(t,i){let{dragging:c,dependencies:d,config:y}=i;const[w,E]=Z.useState(null),{frequency:s,measure:O,strategy:z}=y,j=Z.useRef(t),H=le(),Y=B0(H),ie=Z.useCallback(function(ge){ge===void 0&&(ge=[]),!Y.current&&E(pe=>pe===null?ge:pe.concat(ge.filter(_e=>!pe.includes(_e))))},[Y]),oe=Z.useRef(null),ee=ab(ge=>{if(H&&!c)return pz;if(!ge||ge===pz||j.current!==t||w!=null){const pe=new Map;for(let _e of t){if(!_e)continue;if(w&&w.length>0&&!w.includes(_e.id)&&_e.rect.current){pe.set(_e.id,_e.rect.current);continue}const Re=_e.node.current,xe=Re?new RC(O(Re),Re):null;_e.rect.current=xe,xe&&pe.set(_e.id,xe)}return pe}return ge},[t,w,c,H,O]);return Z.useEffect(()=>{j.current=t},[t]),Z.useEffect(()=>{H||ie()},[c,H]),Z.useEffect(()=>{w&&w.length>0&&E(null)},[JSON.stringify(w)]),Z.useEffect(()=>{H||typeof s!="number"||oe.current!==null||(oe.current=setTimeout(()=>{ie(),oe.current=null},s))},[s,H,ie,...d]),{droppableRects:ee,measureDroppableContainers:ie,measuringScheduled:w!=null};function le(){switch(z){case $0.Always:return!1;case $0.BeforeDragging:return c;default:return!c}}}function VF(t,i){return ab(c=>t?c||(typeof i=="function"?i(t):t):null,[i,t])}function Ose(t,i){return VF(t,i)}function zse(t){let{callback:i,disabled:c}=t;const d=AC(i),y=Z.useMemo(()=>{if(c||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:w}=window;return new w(d)},[d,c]);return Z.useEffect(()=>()=>y?.disconnect(),[y]),y}function AS(t){let{callback:i,disabled:c}=t;const d=AC(i),y=Z.useMemo(()=>{if(c||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:w}=window;return new w(d)},[c]);return Z.useEffect(()=>()=>y?.disconnect(),[y]),y}function Lse(t){return new RC(Kx(t),t)}function mz(t,i,c){i===void 0&&(i=Lse);const[d,y]=Z.useState(null);function w(){y(O=>{if(!t)return null;if(t.isConnected===!1){var z;return(z=O??c)!=null?z:null}const j=i(t);return JSON.stringify(O)===JSON.stringify(j)?O:j})}const E=zse({callback(O){if(t)for(const z of O){const{type:j,target:H}=z;if(j==="childList"&&H instanceof HTMLElement&&H.contains(t)){w();break}}}}),s=AS({callback:w});return Af(()=>{w(),t?(s?.observe(t),E?.observe(document.body,{childList:!0,subtree:!0})):(s?.disconnect(),E?.disconnect())},[t]),d}function Nse(t){const i=VF(t);return OF(t,i)}const gz=[];function kse(t){const i=Z.useRef(t),c=ab(d=>t?d&&d!==gz&&t&&i.current&&t.parentNode===i.current.parentNode?d:ES(t):gz,[t]);return Z.useEffect(()=>{i.current=t},[t]),c}function jse(t){const[i,c]=Z.useState(null),d=Z.useRef(t),y=Z.useCallback(w=>{const E=A2(w.target);E&&c(s=>s?(s.set(E,BE(E)),new Map(s)):null)},[]);return Z.useEffect(()=>{const w=d.current;if(t!==w){E(w);const s=t.map(O=>{const z=A2(O);return z?(z.addEventListener("scroll",y,{passive:!0}),[z,BE(z)]):null}).filter(O=>O!=null);c(s.length?new Map(s):null),d.current=t}return()=>{E(t),E(w)};function E(s){s.forEach(O=>{const z=A2(O);z?.removeEventListener("scroll",y)})}},[y,t]),Z.useMemo(()=>t.length?i?Array.from(i.values()).reduce((w,E)=>bx(w,E),ph):FF(t):ph,[t,i])}function _z(t,i){i===void 0&&(i=[]);const c=Z.useRef(null);return Z.useEffect(()=>{c.current=null},i),Z.useEffect(()=>{const d=t!==ph;d&&!c.current&&(c.current=t),!d&&c.current&&(c.current=null)},[t]),c.current?V0(t,c.current):ph}function Fse(t){Z.useEffect(()=>{if(!TS)return;const i=t.map(c=>{let{sensor:d}=c;return d.setup==null?void 0:d.setup()});return()=>{for(const c of i)c?.()}},t.map(i=>{let{sensor:c}=i;return c}))}function Bse(t,i){return Z.useMemo(()=>t.reduce((c,d)=>{let{eventName:y,handler:w}=d;return c[y]=E=>{w(E,i)},c},{}),[t,i])}function UF(t){return Z.useMemo(()=>t?use(t):null,[t])}const yz=[];function Vse(t,i){i===void 0&&(i=Kx);const[c]=t,d=UF(c?kc(c):null),[y,w]=Z.useState(yz);function E(){w(()=>t.length?t.map(O=>kF(O)?d:new RC(i(O),O)):yz)}const s=AS({callback:E});return Af(()=>{s?.disconnect(),E(),t.forEach(O=>s?.observe(O))},[t]),y}function Use(t){if(!t)return null;if(t.children.length>1)return t;const i=t.children[0];return ob(i)?i:t}function $se(t){let{measure:i}=t;const[c,d]=Z.useState(null),y=Z.useCallback(z=>{for(const{target:j}of z)if(ob(j)){d(H=>{const Y=i(j);return H?{...H,width:Y.width,height:Y.height}:Y});break}},[i]),w=AS({callback:y}),E=Z.useCallback(z=>{const j=Use(z);w?.disconnect(),j&&w?.observe(j),d(j?i(j):null)},[i,w]),[s,O]=jw(E);return Z.useMemo(()=>({nodeRef:s,rect:c,setRef:O}),[c,s,O])}const Gse=[{sensor:DC,options:{}},{sensor:MC,options:{}}],Hse={current:{}},lw={draggable:{measure:uz},droppable:{measure:uz,strategy:$0.WhileDragging,frequency:UE.Optimized},dragOverlay:{measure:Kx}};class S0 extends Map{get(i){var c;return i!=null&&(c=super.get(i))!=null?c:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(i=>{let{disabled:c}=i;return!c})}getNodeFor(i){var c,d;return(c=(d=this.get(i))==null?void 0:d.node.current)!=null?c:void 0}}const qse={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new S0,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Fw},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:lw,measureDroppableContainers:Fw,windowRect:null,measuringScheduled:!1},Zse={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Fw,draggableNodes:new Map,over:null,measureDroppableContainers:Fw},CS=Z.createContext(Zse),$F=Z.createContext(qse);function Wse(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new S0}}}function Xse(t,i){switch(i.type){case Ca.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:i.initialCoordinates,active:i.active}};case Ca.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:i.coordinates.x-t.draggable.initialCoordinates.x,y:i.coordinates.y-t.draggable.initialCoordinates.y}}};case Ca.DragEnd:case Ca.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ca.RegisterDroppable:{const{element:c}=i,{id:d}=c,y=new S0(t.droppable.containers);return y.set(d,c),{...t,droppable:{...t.droppable,containers:y}}}case Ca.SetDroppableDisabled:{const{id:c,key:d,disabled:y}=i,w=t.droppable.containers.get(c);if(!w||d!==w.key)return t;const E=new S0(t.droppable.containers);return E.set(c,{...w,disabled:y}),{...t,droppable:{...t.droppable,containers:E}}}case Ca.UnregisterDroppable:{const{id:c,key:d}=i,y=t.droppable.containers.get(c);if(!y||d!==y.key)return t;const w=new S0(t.droppable.containers);return w.delete(c),{...t,droppable:{...t.droppable,containers:w}}}default:return t}}function Kse(t){let{disabled:i}=t;const{active:c,activatorEvent:d,draggableNodes:y}=Z.useContext(CS),w=jE(d),E=jE(c?.id);return Z.useEffect(()=>{if(!i&&!d&&w&&E!=null){if(!CC(w)||document.activeElement===w.target)return;const s=y.get(E);if(!s)return;const{activatorNode:O,node:z}=s;if(!O.current&&!z.current)return;requestAnimationFrame(()=>{for(const j of[O.current,z.current]){if(!j)continue;const H=Ure(j);if(H){H.focus();break}}})}},[d,i,y,E,w]),null}function Yse(t,i){let{transform:c,...d}=i;return t!=null&&t.length?t.reduce((y,w)=>w({transform:y,...d}),c):c}function Qse(t){return Z.useMemo(()=>({draggable:{...lw.draggable,...t?.draggable},droppable:{...lw.droppable,...t?.droppable},dragOverlay:{...lw.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function Jse(t){let{activeNode:i,measure:c,initialRect:d,config:y=!0}=t;const w=Z.useRef(!1),{x:E,y:s}=typeof y=="boolean"?{x:y,y}:y;Af(()=>{if(!E&&!s||!i){w.current=!1;return}if(w.current||!d)return;const z=i?.node.current;if(!z||z.isConnected===!1)return;const j=c(z),H=OF(j,d);if(E||(H.x=0),s||(H.y=0),w.current=!0,Math.abs(H.x)>0||Math.abs(H.y)>0){const Y=zF(z);Y&&Y.scrollBy({top:H.y,left:H.x})}},[i,E,s,d,c])}const GF=Z.createContext({...ph,scaleX:1,scaleY:1});var eg;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(eg||(eg={}));const eoe=Z.memo(function(i){var c,d,y,w;let{id:E,accessibility:s,autoScroll:O=!0,children:z,sensors:j=Gse,collisionDetection:H=ise,measuring:Y,modifiers:ie,...oe}=i;const ee=Z.useReducer(Xse,void 0,Wse),[le,ge]=ee,[pe,_e]=Wre(),[Re,xe]=Z.useState(eg.Uninitialized),Ze=Re===eg.Initialized,{draggable:{active:Le,nodes:$e,translate:st},droppable:{containers:Et}}=le,Ut=Le!=null?$e.get(Le):null,$t=Z.useRef({initial:null,translated:null}),tt=Z.useMemo(()=>{var Cs;return Le!=null?{id:Le,data:(Cs=Ut?.data)!=null?Cs:Hse,rect:$t}:null},[Le,Ut]),ut=Z.useRef(null),[on,Ke]=Z.useState(null),[ze,Fe]=Z.useState(null),kt=B0(oe,Object.values(oe)),fn=lb("DndDescribedBy",E),Me=Z.useMemo(()=>Et.getEnabled(),[Et]),ct=Qse(Y),{droppableRects:vt,measureDroppableContainers:Kt,measuringScheduled:zn}=Pse(Me,{dragging:Ze,dependencies:[st.x,st.y],config:ct.droppable}),Nn=Ise($e,Le),Yt=Z.useMemo(()=>ze?FE(ze):null,[ze]),On=js(),An=Ose(Nn,ct.draggable.measure);Jse({activeNode:Le!=null?$e.get(Le):null,config:On.layoutShiftCompensation,initialRect:An,measure:ct.draggable.measure});const In=mz(Nn,ct.draggable.measure,An),gi=mz(Nn?Nn.parentElement:null),ji=Z.useRef({activatorEvent:null,active:null,activeNode:Nn,collisionRect:null,collisions:null,droppableRects:vt,draggableNodes:$e,draggingNode:null,draggingNodeRect:null,droppableContainers:Et,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ri=Et.getNodeFor((c=ji.current.over)==null?void 0:c.id),Rr=$se({measure:ct.dragOverlay.measure}),cs=(d=Rr.nodeRef.current)!=null?d:Nn,wr=Ze?(y=Rr.rect)!=null?y:In:null,jn=!!(Rr.nodeRef.current&&Rr.rect),ti=Nse(jn?null:In),rr=UF(cs?kc(cs):null),et=kse(Ze?Ri??Nn:null),Ot=Vse(et),nn=Yse(ie,{transform:{x:st.x-ti.x,y:st.y-ti.y,scaleX:1,scaleY:1},activatorEvent:ze,active:tt,activeNodeRect:In,containerNodeRect:gi,draggingNodeRect:wr,over:ji.current.over,overlayNodeRect:Rr.rect,scrollableAncestors:et,scrollableAncestorRects:Ot,windowRect:rr}),Kn=Yt?bx(Yt,st):null,yn=jse(et),Dn=_z(yn),ci=_z(yn,[In]),Yi=bx(nn,Dn),or=wr?ose(wr,nn):null,Gr=tt&&or?H({active:tt,collisionRect:or,droppableRects:vt,droppableContainers:Me,pointerCoordinates:Kn}):null,ea=PF(Gr,"id"),[vs,Ol]=Z.useState(null),ta=jn?nn:bx(nn,ci),dr=rse(ta,(w=vs?.rect)!=null?w:null,In),lo=Z.useRef(null),Os=Z.useCallback((Cs,bs)=>{let{sensor:us,options:Ho}=bs;if(ut.current==null)return;const Do=$e.get(ut.current);if(!Do)return;const Po=Cs.nativeEvent,wo=new us({active:ut.current,activeNode:Do,event:Po,options:Ho,context:ji,onAbort(Rs){if(!$e.get(Rs))return;const{onDragAbort:qo}=kt.current,fi={id:Rs};qo?.(fi),pe({type:"onDragAbort",event:fi})},onPending(Rs,ga,qo,fi){if(!$e.get(Rs))return;const{onDragPending:zl}=kt.current,_a={id:Rs,constraint:ga,initialCoordinates:qo,offset:fi};zl?.(_a),pe({type:"onDragPending",event:_a})},onStart(Rs){const ga=ut.current;if(ga==null)return;const qo=$e.get(ga);if(!qo)return;const{onDragStart:fi}=kt.current,Ds={activatorEvent:Po,active:{id:ga,data:qo.data,rect:$t}};ah.unstable_batchedUpdates(()=>{fi?.(Ds),xe(eg.Initializing),ge({type:Ca.DragStart,initialCoordinates:Rs,active:ga}),pe({type:"onDragStart",event:Ds}),Ke(lo.current),Fe(Po)})},onMove(Rs){ge({type:Ca.DragMove,coordinates:Rs})},onEnd:Ct(Ca.DragEnd),onCancel:Ct(Ca.DragCancel)});lo.current=wo;function Ct(Rs){return async function(){const{active:qo,collisions:fi,over:Ds,scrollAdjustedTranslate:zl}=ji.current;let _a=null;if(qo&&zl){const{cancelDrop:We}=kt.current;_a={activatorEvent:Po,active:qo,collisions:fi,delta:zl,over:Ds},Rs===Ca.DragEnd&&typeof We=="function"&&await Promise.resolve(We(_a))&&(Rs=Ca.DragCancel)}ut.current=null,ah.unstable_batchedUpdates(()=>{ge({type:Rs}),xe(eg.Uninitialized),Ol(null),Ke(null),Fe(null),lo.current=null;const We=Rs===Ca.DragEnd?"onDragEnd":"onDragCancel";if(_a){const ne=kt.current[We];ne?.(_a),pe({type:We,event:_a})}})}}},[$e]),Za=Z.useCallback((Cs,bs)=>(us,Ho)=>{const Do=us.nativeEvent,Po=$e.get(Ho);if(ut.current!==null||!Po||Do.dndKit||Do.defaultPrevented)return;const wo={active:Po};Cs(us,bs.options,wo)===!0&&(Do.dndKit={capturedBy:bs.sensor},ut.current=Ho,Os(us,bs))},[$e,Os]),Go=Dse(j,Za);Fse(j),Af(()=>{In&&Re===eg.Initializing&&xe(eg.Initialized)},[In,Re]),Z.useEffect(()=>{const{onDragMove:Cs}=kt.current,{active:bs,activatorEvent:us,collisions:Ho,over:Do}=ji.current;if(!bs||!us)return;const Po={active:bs,activatorEvent:us,collisions:Ho,delta:{x:Yi.x,y:Yi.y},over:Do};ah.unstable_batchedUpdates(()=>{Cs?.(Po),pe({type:"onDragMove",event:Po})})},[Yi.x,Yi.y]),Z.useEffect(()=>{const{active:Cs,activatorEvent:bs,collisions:us,droppableContainers:Ho,scrollAdjustedTranslate:Do}=ji.current;if(!Cs||ut.current==null||!bs||!Do)return;const{onDragOver:Po}=kt.current,wo=Ho.get(ea),Ct=wo&&wo.rect.current?{id:wo.id,rect:wo.rect.current,data:wo.data,disabled:wo.disabled}:null,Rs={active:Cs,activatorEvent:bs,collisions:us,delta:{x:Do.x,y:Do.y},over:Ct};ah.unstable_batchedUpdates(()=>{Ol(Ct),Po?.(Rs),pe({type:"onDragOver",event:Rs})})},[ea]),Af(()=>{ji.current={activatorEvent:ze,active:tt,activeNode:Nn,collisionRect:or,collisions:Gr,droppableRects:vt,draggableNodes:$e,draggingNode:cs,draggingNodeRect:wr,droppableContainers:Et,over:vs,scrollableAncestors:et,scrollAdjustedTranslate:Yi},$t.current={initial:wr,translated:or}},[tt,Nn,Gr,or,$e,cs,wr,vt,Et,vs,et,Yi]),Cse({...On,delta:st,draggingRect:or,pointerCoordinates:Kn,scrollableAncestors:et,scrollableAncestorRects:Ot});const Ia=Z.useMemo(()=>({active:tt,activeNode:Nn,activeNodeRect:In,activatorEvent:ze,collisions:Gr,containerNodeRect:gi,dragOverlay:Rr,draggableNodes:$e,droppableContainers:Et,droppableRects:vt,over:vs,measureDroppableContainers:Kt,scrollableAncestors:et,scrollableAncestorRects:Ot,measuringConfiguration:ct,measuringScheduled:zn,windowRect:rr}),[tt,Nn,In,ze,Gr,gi,Rr,$e,Et,vt,vs,Kt,et,Ot,ct,zn,rr]),Mr=Z.useMemo(()=>({activatorEvent:ze,activators:Go,active:tt,activeNodeRect:In,ariaDescribedById:{draggable:fn},dispatch:ge,draggableNodes:$e,over:vs,measureDroppableContainers:Kt}),[ze,Go,tt,In,ge,fn,$e,vs,Kt]);return vr.createElement(MF.Provider,{value:_e},vr.createElement(CS.Provider,{value:Mr},vr.createElement($F.Provider,{value:Ia},vr.createElement(GF.Provider,{value:dr},z)),vr.createElement(Kse,{disabled:s?.restoreFocus===!1})),vr.createElement(Yre,{...s,hiddenTextDescribedById:fn}));function js(){const Cs=on?.autoScrollEnabled===!1,bs=typeof O=="object"?O.enabled===!1:O===!1,us=Ze&&!Cs&&!bs;return typeof O=="object"?{...O,enabled:us}:{enabled:us}}}),toe=Z.createContext(null),xz="button",noe="Draggable";function ioe(t){let{id:i,data:c,disabled:d=!1,attributes:y}=t;const w=lb(noe),{activators:E,activatorEvent:s,active:O,activeNodeRect:z,ariaDescribedById:j,draggableNodes:H,over:Y}=Z.useContext(CS),{role:ie=xz,roleDescription:oe="draggable",tabIndex:ee=0}=y??{},le=O?.id===i,ge=Z.useContext(le?GF:toe),[pe,_e]=jw(),[Re,xe]=jw(),Ze=Bse(E,i),Le=B0(c);Af(()=>(H.set(i,{id:i,key:w,node:pe,activatorNode:Re,data:Le}),()=>{const st=H.get(i);st&&st.key===w&&H.delete(i)}),[H,i]);const $e=Z.useMemo(()=>({role:ie,tabIndex:ee,"aria-disabled":d,"aria-pressed":le&&ie===xz?!0:void 0,"aria-roledescription":oe,"aria-describedby":j.draggable}),[d,ie,ee,le,oe,j.draggable]);return{active:O,activatorEvent:s,activeNodeRect:z,attributes:$e,isDragging:le,listeners:d?void 0:Ze,node:pe,over:Y,setNodeRef:_e,setActivatorNodeRef:xe,transform:ge}}function roe(){return Z.useContext($F)}const soe="Droppable",ooe={timeout:25};function aoe(t){let{data:i,disabled:c=!1,id:d,resizeObserverConfig:y}=t;const w=lb(soe),{active:E,dispatch:s,over:O,measureDroppableContainers:z}=Z.useContext(CS),j=Z.useRef({disabled:c}),H=Z.useRef(!1),Y=Z.useRef(null),ie=Z.useRef(null),{disabled:oe,updateMeasurementsFor:ee,timeout:le}={...ooe,...y},ge=B0(ee??d),pe=Z.useCallback(()=>{if(!H.current){H.current=!0;return}ie.current!=null&&clearTimeout(ie.current),ie.current=setTimeout(()=>{z(Array.isArray(ge.current)?ge.current:[ge.current]),ie.current=null},le)},[le]),_e=AS({callback:pe,disabled:oe||!E}),Re=Z.useCallback(($e,st)=>{_e&&(st&&(_e.unobserve(st),H.current=!1),$e&&_e.observe($e))},[_e]),[xe,Ze]=jw(Re),Le=B0(i);return Z.useEffect(()=>{!_e||!xe.current||(_e.disconnect(),H.current=!1,_e.observe(xe.current))},[xe,_e]),Z.useEffect(()=>(s({type:Ca.RegisterDroppable,element:{id:d,key:w,disabled:c,node:xe,rect:Y,data:Le}}),()=>s({type:Ca.UnregisterDroppable,key:w,id:d})),[d]),Z.useEffect(()=>{c!==j.current.disabled&&(s({type:Ca.SetDroppableDisabled,id:d,key:w,disabled:c}),j.current.disabled=c)},[d,w,c,s]),{active:E,rect:Y,isOver:O?.id===d,node:xe,over:O,setNodeRef:Ze}}function PC(t,i,c){const d=t.slice();return d.splice(c<0?d.length+c:c,0,d.splice(i,1)[0]),d}function loe(t,i){return t.reduce((c,d,y)=>{const w=i.get(d);return w&&(c[y]=w),c},Array(t.length))}function U1(t){return t!==null&&t>=0}function coe(t,i){if(t===i)return!0;if(t.length!==i.length)return!1;for(let c=0;c<t.length;c++)if(t[c]!==i[c])return!1;return!0}function uoe(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const HF=t=>{let{rects:i,activeIndex:c,overIndex:d,index:y}=t;const w=PC(i,d,c),E=i[y],s=w[y];return!s||!E?null:{x:s.left-E.left,y:s.top-E.top,scaleX:s.width/E.width,scaleY:s.height/E.height}},$1={scaleX:1,scaleY:1},doe=t=>{var i;let{activeIndex:c,activeNodeRect:d,index:y,rects:w,overIndex:E}=t;const s=(i=w[c])!=null?i:d;if(!s)return null;if(y===c){const z=w[E];return z?{x:0,y:c<E?z.top+z.height-(s.top+s.height):z.top-s.top,...$1}:null}const O=hoe(w,y,c);return y>c&&y<=E?{x:0,y:-s.height-O,...$1}:y<c&&y>=E?{x:0,y:s.height+O,...$1}:{x:0,y:0,...$1}};function hoe(t,i,c){const d=t[i],y=t[i-1],w=t[i+1];return d?c<i?y?d.top-(y.top+y.height):w?w.top-(d.top+d.height):0:w?w.top-(d.top+d.height):y?d.top-(y.top+y.height):0:0}const qF="Sortable",ZF=vr.createContext({activeIndex:-1,containerId:qF,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:HF,disabled:{draggable:!1,droppable:!1}});function foe(t){let{children:i,id:c,items:d,strategy:y=HF,disabled:w=!1}=t;const{active:E,dragOverlay:s,droppableRects:O,over:z,measureDroppableContainers:j}=roe(),H=lb(qF,c),Y=s.rect!==null,ie=Z.useMemo(()=>d.map(Ze=>typeof Ze=="object"&&"id"in Ze?Ze.id:Ze),[d]),oe=E!=null,ee=E?ie.indexOf(E.id):-1,le=z?ie.indexOf(z.id):-1,ge=Z.useRef(ie),pe=!coe(ie,ge.current),_e=le!==-1&&ee===-1||pe,Re=uoe(w);Af(()=>{pe&&oe&&j(ie)},[pe,ie,oe,j]),Z.useEffect(()=>{ge.current=ie},[ie]);const xe=Z.useMemo(()=>({activeIndex:ee,containerId:H,disabled:Re,disableTransforms:_e,items:ie,overIndex:le,useDragOverlay:Y,sortedRects:loe(ie,O),strategy:y}),[ee,H,Re.draggable,Re.droppable,_e,ie,le,O,Y,y]);return vr.createElement(ZF.Provider,{value:xe},i)}const poe=t=>{let{id:i,items:c,activeIndex:d,overIndex:y}=t;return PC(c,d,y).indexOf(i)},moe=t=>{let{containerId:i,isSorting:c,wasDragging:d,index:y,items:w,newIndex:E,previousItems:s,previousContainerId:O,transition:z}=t;return!z||!d||s!==w&&y===E?!1:c?!0:E!==y&&i===O},goe={duration:200,easing:"ease"},WF="transform",_oe=U0.Transition.toString({property:WF,duration:0,easing:"linear"}),yoe={roleDescription:"sortable"};function xoe(t){let{disabled:i,index:c,node:d,rect:y}=t;const[w,E]=Z.useState(null),s=Z.useRef(c);return Af(()=>{if(!i&&c!==s.current&&d.current){const O=y.current;if(O){const z=Kx(d.current,{ignoreTransform:!0}),j={x:O.left-z.left,y:O.top-z.top,scaleX:O.width/z.width,scaleY:O.height/z.height};(j.x||j.y)&&E(j)}}c!==s.current&&(s.current=c)},[i,c,d,y]),Z.useEffect(()=>{w&&E(null)},[w]),w}function voe(t){let{animateLayoutChanges:i=moe,attributes:c,disabled:d,data:y,getNewIndex:w=poe,id:E,strategy:s,resizeObserverConfig:O,transition:z=goe}=t;const{items:j,containerId:H,activeIndex:Y,disabled:ie,disableTransforms:oe,sortedRects:ee,overIndex:le,useDragOverlay:ge,strategy:pe}=Z.useContext(ZF),_e=boe(d,ie),Re=j.indexOf(E),xe=Z.useMemo(()=>({sortable:{containerId:H,index:Re,items:j},...y}),[H,y,Re,j]),Ze=Z.useMemo(()=>j.slice(j.indexOf(E)),[j,E]),{rect:Le,node:$e,isOver:st,setNodeRef:Et}=aoe({id:E,data:xe,disabled:_e.droppable,resizeObserverConfig:{updateMeasurementsFor:Ze,...O}}),{active:Ut,activatorEvent:$t,activeNodeRect:tt,attributes:ut,setNodeRef:on,listeners:Ke,isDragging:ze,over:Fe,setActivatorNodeRef:kt,transform:fn}=ioe({id:E,data:xe,attributes:{...yoe,...c},disabled:_e.draggable}),Me=jre(Et,on),ct=!!Ut,vt=ct&&!oe&&U1(Y)&&U1(le),Kt=!ge&&ze,zn=Kt&&vt?fn:null,Yt=vt?zn??(s??pe)({rects:ee,activeNodeRect:tt,activeIndex:Y,overIndex:le,index:Re}):null,On=U1(Y)&&U1(le)?w({id:E,items:j,activeIndex:Y,overIndex:le}):Re,An=Ut?.id,In=Z.useRef({activeId:An,items:j,newIndex:On,containerId:H}),gi=j!==In.current.items,ji=i({active:Ut,containerId:H,isDragging:ze,isSorting:ct,id:E,index:Re,items:j,newIndex:In.current.newIndex,previousItems:In.current.items,previousContainerId:In.current.containerId,transition:z,wasDragging:In.current.activeId!=null}),Ri=xoe({disabled:!ji,index:Re,node:$e,rect:Le});return Z.useEffect(()=>{ct&&In.current.newIndex!==On&&(In.current.newIndex=On),H!==In.current.containerId&&(In.current.containerId=H),j!==In.current.items&&(In.current.items=j)},[ct,On,H,j]),Z.useEffect(()=>{if(An===In.current.activeId)return;if(An!=null&&In.current.activeId==null){In.current.activeId=An;return}const cs=setTimeout(()=>{In.current.activeId=An},50);return()=>clearTimeout(cs)},[An]),{active:Ut,activeIndex:Y,attributes:ut,data:xe,rect:Le,index:Re,newIndex:On,items:j,isOver:st,isSorting:ct,isDragging:ze,listeners:Ke,node:$e,overIndex:le,over:Fe,setNodeRef:Me,setActivatorNodeRef:kt,setDroppableNodeRef:Et,setDraggableNodeRef:on,transform:Ri??Yt,transition:Rr()};function Rr(){if(Ri||gi&&In.current.newIndex===Re)return _oe;if(!(Kt&&!CC($t)||!z)&&(ct||ji))return U0.Transition.toString({...z,property:WF})}}function boe(t,i){var c,d;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(c=t?.draggable)!=null?c:i.draggable,droppable:(d=t?.droppable)!=null?d:i.droppable}}function Vw(t){if(!t)return!1;const i=t.data.current;return!!(i&&"sortable"in i&&typeof i.sortable=="object"&&"containerId"in i.sortable&&"items"in i.sortable&&"index"in i.sortable)}const woe=[as.Down,as.Right,as.Up,as.Left],Soe=(t,i)=>{let{context:{active:c,collisionRect:d,droppableRects:y,droppableContainers:w,over:E,scrollableAncestors:s}}=i;if(woe.includes(t.code)){if(t.preventDefault(),!c||!d)return;const O=[];w.getEnabled().forEach(H=>{if(!H||H!=null&&H.disabled)return;const Y=y.get(H.id);if(Y)switch(t.code){case as.Down:d.top<Y.top&&O.push(H);break;case as.Up:d.top>Y.top&&O.push(H);break;case as.Left:d.left>Y.left&&O.push(H);break;case as.Right:d.left<Y.left&&O.push(H);break}});const z=tse({collisionRect:d,droppableRects:y,droppableContainers:O});let j=PF(z,"id");if(j===E?.id&&z.length>1&&(j=z[1].id),j!=null){const H=w.get(c.id),Y=w.get(j),ie=Y?y.get(Y.id):null,oe=Y?.node.current;if(oe&&ie&&H&&Y){const le=ES(oe).some((Ze,Le)=>s[Le]!==Ze),ge=XF(H,Y),pe=Toe(H,Y),_e=le||!ge?{x:0,y:0}:{x:pe?d.width-ie.width:0,y:pe?d.height-ie.height:0},Re={x:ie.left,y:ie.top};return _e.x&&_e.y?Re:V0(Re,_e)}}}};function XF(t,i){return!Vw(t)||!Vw(i)?!1:t.data.current.sortable.containerId===i.data.current.sortable.containerId}function Toe(t,i){return!Vw(t)||!Vw(i)||!XF(t,i)?!1:t.data.current.sortable.index<i.data.current.sortable.index}const Eoe=({stop:t,index:i})=>{const{attributes:c,listeners:d,setNodeRef:y,transform:w,transition:E,isDragging:s}=voe({id:t.id}),O={transform:U0.Transform.toString(w),transition:E,opacity:s?.5:1};return C.jsxs("div",{ref:y,style:O,...c,...d,className:"flex items-center gap-4 p-3 border rounded-lg hover:bg-muted/50 transition-colors cursor-move",children:[C.jsx("div",{className:"flex items-center justify-center h-8 w-8 rounded-full bg-teal-100 text-teal-700 font-bold text-sm flex-shrink-0",children:i+1}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"font-medium",children:t.stop?.name||"Unknown Stop"}),t.distance_from_prev&&i>0&&C.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.distance_from_prev,"m from previous stop"]})]}),C.jsx(Dl,{className:"h-4 w-4 text-muted-foreground"})]})},Aoe=()=>{const{id:t}=XE(),i=lg(),c=nd(),[d,y]=Z.useState([]),[w,E]=Z.useState(!1),[s,O]=Z.useState(!1),[z,j]=Z.useState(!1),[H,Y]=Z.useState(""),ie=t?parseInt(t,10):void 0,{data:oe,isLoading:ee}=$o({queryKey:["route",ie],queryFn:()=>Xu.getRoute(ie),enabled:!!ie}),{data:le}=$o({queryKey:["buses"],queryFn:()=>Ku.getBuses()}),{data:ge}=$o({queryKey:["stops"],queryFn:()=>Sx.getStops()}),pe=le?.filter(ut=>ut.route_id===ie),_e=ge?.filter(ut=>!d.some(on=>on.stop_id===ut.id));vr.useEffect(()=>{if(oe?.route_stops){const ut=[...oe.route_stops].sort((on,Ke)=>on.sequence_number-Ke.sequence_number);y(ut)}},[oe]);const Re=Ns({mutationFn:()=>Xu.deleteRoute(ie),onSuccess:()=>{c.invalidateQueries({queryKey:["routes"]}),yo({title:"Success",description:"Route deleted successfully"}),i("/routes")},onError:ut=>{yo({title:"Error",description:ut.message||"Failed to delete route",variant:"destructive"})}}),xe=Ns({mutationFn:({stopId:ut})=>Xu.addStopToRoute(ie,{stop_id:ut,sequence_number:d.length+1}),onSuccess:()=>{c.invalidateQueries({queryKey:["route",ie]}),yo({title:"Success",description:"Stop added to route"}),Y("")},onError:ut=>{yo({title:"Error",description:ut.message||"Failed to add stop",variant:"destructive"})}}),Ze=Ns({mutationFn:({routeStopId:ut})=>Xu.removeStopFromRoute(ie,ut),onSuccess:()=>{c.invalidateQueries({queryKey:["route",ie]}),yo({title:"Success",description:"Stop removed from route"})},onError:ut=>{yo({title:"Error",description:ut.message||"Failed to remove stop",variant:"destructive"})}}),Le=Ns({mutationFn:ut=>Xu.reorderRouteStops(ie,ut),onSuccess:()=>{c.invalidateQueries({queryKey:["route",ie]}),yo({title:"Success",description:"Stops reordered successfully"})},onError:ut=>{yo({title:"Error",description:ut.message||"Failed to reorder stops",variant:"destructive"})}}),$e=()=>{Re.mutate()},st=()=>{H&&xe.mutate({stopId:parseInt(H,10)})},Et=ut=>{Ze.mutate({routeStopId:ut})},Ut=Qre(az(DC),az(MC,{coordinateGetter:Soe})),$t=ut=>{const{active:on,over:Ke}=ut;if(Ke&&on.id!==Ke.id){const ze=d.findIndex(Me=>Me.id===on.id),Fe=d.findIndex(Me=>Me.id===Ke.id),kt=PC(d,ze,Fe);y(kt);const fn=kt.map(Me=>Me.id);Le.mutate(fn)}};if(ee)return C.jsxs("div",{className:"space-y-6",children:[C.jsxs(Un,{variant:"ghost",onClick:()=>i("/routes"),children:[C.jsx(C_,{className:"h-4 w-4 mr-2"}),"Back"]}),C.jsx(li,{className:"animate-pulse",children:C.jsx(hi,{className:"h-64"})})]});if(!oe)return C.jsxs("div",{className:"space-y-6",children:[C.jsxs(Un,{variant:"ghost",onClick:()=>i("/routes"),children:[C.jsx(C_,{className:"h-4 w-4 mr-2"}),"Back"]}),C.jsx(li,{children:C.jsxs(hi,{className:"py-12 text-center",children:[C.jsx(L_,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),C.jsx("p",{children:"Route not found"})]})})]});const tt=d.filter(ut=>ut.stop).map(ut=>ut.stop);return C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex items-center justify-between",children:C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsxs(Un,{variant:"ghost",onClick:()=>i("/routes"),children:[C.jsx(C_,{className:"h-4 w-4 mr-2"}),"Back"]}),C.jsxs("div",{children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("h1",{className:"text-3xl font-bold",children:oe.name}),oe.color&&C.jsx("div",{className:"h-8 w-8 rounded",style:{backgroundColor:oe.color}})]}),C.jsx("p",{className:"text-muted-foreground",children:oe.code})]})]})}),oe.description&&C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsx("p",{className:"text-muted-foreground",children:oe.description})})}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx(ys,{className:"text-sm",children:"Total Stops"})}),C.jsx(hi,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Dl,{className:"h-5 w-5 text-teal-600"}),C.jsx("p",{className:"text-2xl font-bold",children:d.length})]})})]}),C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx(ys,{className:"text-sm",children:"Assigned Buses"})}),C.jsx(hi,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(fu,{className:"h-5 w-5 text-blue-600"}),C.jsx("p",{className:"text-2xl font-bold",children:pe?.length||0})]})})]}),C.jsxs(li,{children:[C.jsx(zr,{className:"pb-3",children:C.jsx(ys,{className:"text-sm",children:"Route Code"})}),C.jsx(hi,{children:C.jsx("p",{className:"text-lg font-mono font-bold",children:oe.code})})]})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsx(ys,{children:"Route Visualization"})}),C.jsx(hi,{children:C.jsx(nS,{initialViewState:{longitude:d[0]?.stop?.longitude||73.0479,latitude:d[0]?.stop?.latitude||33.6844,zoom:12},stops:tt,showRoute:tt.length>=2,routeColor:oe.color||"#14b8a6",height:"500px",interactive:!0,showControls:!0,fitToBounds:tt.length>0})})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsx(ys,{children:"Route Stops (Drag to Reorder)"})}),C.jsx(hi,{children:C.jsx(eoe,{sensors:Ut,collisionDetection:ese,onDragEnd:$t,children:C.jsx(foe,{items:d.map(ut=>ut.id),strategy:doe,children:C.jsx("div",{className:"space-y-2",children:d.map((ut,on)=>C.jsx(Eoe,{stop:ut,index:on},ut.id))})})})})]}),pe&&pe.length>0&&C.jsxs(li,{children:[C.jsx(zr,{children:C.jsx(ys,{children:"Assigned Buses"})}),C.jsx(hi,{children:C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:pe.map(ut=>C.jsxs(_o.div,{whileHover:{scale:1.02},className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>i(`/buses/${ut.id}`),children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx(fu,{className:"h-5 w-5 text-teal-600"}),C.jsxs("div",{children:[C.jsx("p",{className:"font-medium",children:ut.registration_number}),C.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:ut.status})]})]}),C.jsx(C_,{className:"h-4 w-4 rotate-180 text-muted-foreground"})]},ut.id))})})]}),C.jsxs("div",{className:"flex gap-3",children:[C.jsx(Un,{variant:"outline",onClick:()=>E(!0),children:"Edit Route"}),C.jsxs(Un,{variant:"outline",onClick:()=>j(!0),children:[C.jsx(ed,{className:"h-4 w-4 mr-2"}),"Manage Stops"]}),C.jsxs(Un,{variant:"destructive",className:"ml-auto",onClick:()=>O(!0),children:[C.jsx(U_,{className:"h-4 w-4 mr-2"}),"Delete Route"]})]}),C.jsx(AF,{open:w,onClose:()=>E(!1),route:oe}),C.jsx(Tf,{open:s,onOpenChange:O,children:C.jsxs(ch,{children:[C.jsxs(uh,{children:[C.jsx(dh,{children:"Delete Route"}),C.jsxs(k0,{children:['Are you sure you want to delete "',oe?.name,'"? This action cannot be undone. All stops will be unassigned from this route.']})]}),C.jsxs(Pw,{children:[C.jsx(Un,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),C.jsxs(Un,{variant:"destructive",onClick:$e,disabled:Re.isPending,children:[Re.isPending&&C.jsx(z_,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Route"]})]})]})}),C.jsx(Tf,{open:z,onOpenChange:j,children:C.jsxs(ch,{className:"max-w-lg",children:[C.jsxs(uh,{children:[C.jsx(dh,{children:"Manage Route Stops"}),C.jsx(k0,{children:"Add or remove stops from this route. Drag stops in the list above to reorder them."})]}),C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx("label",{className:"text-sm font-medium",children:"Add a Stop"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsxs(Rx,{value:H,onValueChange:Y,children:[C.jsx(X_,{className:"flex-1",children:C.jsx(Mx,{placeholder:"Select a stop to add..."})}),C.jsxs(K_,{children:[_e?.map(ut=>C.jsx(hu,{value:String(ut.id),children:ut.name},ut.id)),(!_e||_e.length===0)&&C.jsx(hu,{value:"none",disabled:!0,children:"No more stops available"})]})]}),C.jsx(Un,{onClick:st,disabled:!H||xe.isPending,children:xe.isPending?C.jsx(z_,{className:"h-4 w-4 animate-spin"}):C.jsx(ed,{className:"h-4 w-4"})})]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("label",{className:"text-sm font-medium",children:["Current Stops (",d.length,")"]}),C.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[d.map((ut,on)=>C.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-muted/30",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("span",{className:"flex items-center justify-center h-6 w-6 rounded-full bg-teal-100 text-teal-700 font-bold text-xs",children:on+1}),C.jsx("span",{className:"text-sm",children:ut.stop?.name})]}),C.jsx(Un,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:text-destructive",disabled:Ze.isPending,onClick:()=>Et(ut.id),children:Ze.isPending?C.jsx(z_,{className:"h-4 w-4 animate-spin"}):C.jsx(U_,{className:"h-4 w-4"})})]},ut.id)),d.length===0&&C.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No stops added yet. Add some stops to define the route."})]})]})]}),C.jsx(Pw,{children:C.jsx(Un,{onClick:()=>j(!1),children:"Done"})})]})})]})};Zu.accessToken="pk.eyJ1IjoiYmlsYWxhbGliIiwiYSI6ImNtaWlmMHZiazAzNTkzZHNpYTVzeWpueWoifQ.fnHQ0i_G-NInzirfb9ZX6Q";const Coe=fg({name:ks().min(2,"Name must be at least 2 characters"),description:ks().optional(),latitude:Ax().min(-90).max(90),longitude:Ax().min(-180).max(180)}),Roe=({open:t,onClose:i,stop:c,mode:d})=>{const{t:y}=Lc(),w=nd(),E=vr.useRef(null),s=vr.useRef(null),O=vr.useRef(null),[z,j]=Z.useState(!1),[H,Y]=Z.useState({lng:73.0479,lat:33.6844}),{register:ie,handleSubmit:oe,setValue:ee,reset:le,formState:{errors:ge}}=ug({resolver:hg(Coe),defaultValues:{name:"",description:"",latitude:33.6844,longitude:73.0479}}),[pe,_e]=Z.useState(""),[Re,xe]=Z.useState([]),[Ze,Le]=Z.useState(!1),[$e,st]=Z.useState(!1),Et=vr.useRef(null),Ut=Z.useCallback(ze=>{if(_e(ze),console.log("[StopModal] Search query:",ze),Et.current&&clearTimeout(Et.current),ze.length<3){xe([]),st(!1);return}Et.current=setTimeout(async()=>{Le(!0),console.log("[StopModal] Searching for:",ze);try{const Fe=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(ze)}&format=json&addressdetails=1&limit=8&countrycodes=pk`;console.log("[StopModal] Nominatim URL:",Fe);const fn=await(await fetch(Fe,{headers:{"Accept-Language":"en"}})).json();console.log("[StopModal] Search results:",fn?.length||0,"features");const Me=(fn||[]).map(ct=>({id:String(ct.place_id),place_name:ct.display_name,center:[parseFloat(ct.lon),parseFloat(ct.lat)],text:ct.name||ct.display_name.split(",")[0]}));Me.length>0&&console.log("[StopModal] First result:",Me[0].place_name),xe(Me),st(!0),console.log("[StopModal] showResults set to true, searchResults length:",Me.length)}catch(Fe){console.error("[StopModal] Geocoding search failed:",Fe),xe([])}finally{Le(!1)}},500)},[]),$t=Z.useCallback(ze=>{const[Fe,kt]=ze.center;Y({lng:Fe,lat:kt}),ee("latitude",kt),ee("longitude",Fe),document.getElementById("name")?.value||ee("name",ze.text),s.current&&s.current.flyTo({center:[Fe,kt],zoom:16,duration:1e3}),O.current&&O.current.setLngLat([Fe,kt]),_e(""),xe([]),st(!1)},[ee]);Z.useEffect(()=>{t&&(c&&d==="edit"?(le({name:c.name,description:c.description||"",latitude:c.latitude,longitude:c.longitude}),Y({lng:c.longitude,lat:c.latitude})):(le({name:"",description:"",latitude:33.6844,longitude:73.0479}),Y({lng:73.0479,lat:33.6844})))},[t,c,d,le]),Z.useEffect(()=>{if(!t){j(!1);return}s.current&&(s.current.remove(),s.current=null),O.current=null;const ze=()=>{const ct=E.current;if(!ct)return!1;const vt=ct.getBoundingClientRect();if(vt.width===0||vt.height===0)return!1;const Kt=c&&d==="edit"?[c.longitude,c.latitude]:[73.0479,33.6844];try{s.current=new Zu.Map({container:ct,style:"mapbox://styles/mapbox/streets-v12",center:Kt,zoom:14}),s.current.addControl(new Zu.NavigationControl,"top-right");const zn=document.createElement("div");return zn.innerHTML=`
          <div style="
            width: 40px;
            height: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
          ">
            <svg width="32" height="40" viewBox="0 0 24 30" style="filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" 
                    fill="#14b8a6" 
                    stroke="white" 
                    stroke-width="2"/>
              <circle cx="12" cy="9" r="3" fill="white"/>
            </svg>
          </div>
        `,O.current=new Zu.Marker({element:zn,draggable:!0,anchor:"bottom"}).setLngLat(Kt).addTo(s.current),O.current.on("dragend",()=>{const Nn=O.current.getLngLat();Y({lng:Nn.lng,lat:Nn.lat}),ee("latitude",Nn.lat),ee("longitude",Nn.lng)}),s.current.on("click",Nn=>{const{lng:Yt,lat:On}=Nn.lngLat;O.current?.setLngLat([Yt,On]),Y({lng:Yt,lat:On}),ee("latitude",On),ee("longitude",Yt)}),s.current.on("load",()=>{j(!0)}),!0}catch(zn){return console.error("Failed to initialize map:",zn),!1}};let Fe=0;const kt=10,fn=()=>{ze()||(Fe++,Fe<kt&&setTimeout(fn,100))},Me=setTimeout(fn,50);return()=>{clearTimeout(Me),s.current&&(s.current.remove(),s.current=null),O.current=null}},[t,c?.id,d,ee]),Z.useEffect(()=>{O.current&&s.current&&O.current.setLngLat([H.lng,H.lat])},[H]);const tt=Ns({mutationFn:Sx.createStop,onSuccess:()=>{w.invalidateQueries({queryKey:["stops"]}),yo({title:y("common.success"),description:y("stops.addStop")+" successful"}),i()},onError:()=>{yo({title:y("common.error"),description:"Failed to create stop",variant:"destructive"})}}),ut=Ns({mutationFn:ze=>Sx.updateStop(c.id,ze),onSuccess:()=>{w.invalidateQueries({queryKey:["stops"]}),yo({title:y("common.success"),description:y("stops.editStop")+" successful"}),i()},onError:()=>{yo({title:y("common.error"),description:"Failed to update stop",variant:"destructive"})}}),on=ze=>{d==="add"?tt.mutate({name:ze.name,description:ze.description,latitude:ze.latitude,longitude:ze.longitude}):ut.mutate(ze)},Ke=tt.isPending||ut.isPending;return C.jsx(Tf,{open:t,onOpenChange:i,children:C.jsxs(ch,{className:"max-w-4xl max-h-[90vh] overflow-y-auto overflow-x-visible",children:[C.jsxs(uh,{children:[C.jsx(dh,{children:y(d==="add"?"stops.addStop":"stops.editStop")}),C.jsx(k0,{children:y(d==="add"?"stops.clickToPlace":"stops.dragToAdjust")})]}),C.jsxs("form",{onSubmit:oe(on),className:"space-y-6",children:[C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{htmlFor:"name",children:[y("stops.stopName"),"*"]}),C.jsx(br,{id:"name",...ie("name"),placeholder:"Enter stop name"}),ge.name&&C.jsx("p",{className:"text-sm text-red-500",children:ge.name.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"description",children:y("stops.description")}),C.jsx(br,{id:"description",...ie("description"),placeholder:"Optional description"})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{htmlFor:"latitude",children:[y("stops.latitude"),"*"]}),C.jsx(br,{id:"latitude",type:"number",step:"any",...ie("latitude",{valueAsNumber:!0}),readOnly:!0}),ge.latitude&&C.jsx("p",{className:"text-sm text-red-500",children:ge.latitude.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{htmlFor:"longitude",children:[y("stops.longitude"),"*"]}),C.jsx(br,{id:"longitude",type:"number",step:"any",...ie("longitude",{valueAsNumber:!0}),readOnly:!0}),ge.longitude&&C.jsx("p",{className:"text-sm text-red-500",children:ge.longitude.message})]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs(Zi,{className:"flex items-center gap-2",children:[C.jsx(Dl,{className:"h-4 w-4"}),"Click on map to place stop marker (drag to adjust)"]}),C.jsxs("div",{className:"relative",style:{zIndex:1e3},children:[C.jsxs("div",{className:"relative",children:[C.jsx(J0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),C.jsx(br,{type:"text",value:pe,onChange:ze=>Ut(ze.target.value),placeholder:"Search for a location in Islamabad...",className:"pl-9 pr-9",onFocus:()=>Re.length>0&&st(!0),onBlur:()=>{setTimeout(()=>st(!1),300)}}),pe&&C.jsx("button",{type:"button",onClick:()=>{_e(""),xe([]),st(!1)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:C.jsx(tS,{className:"h-4 w-4"})}),Ze&&C.jsx(z_,{className:"absolute right-9 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),(console.log("[StopModal] Render check - showResults:",$e,"searchResults.length:",Re.length),null),$e&&Re.length>0&&C.jsxs("div",{className:"absolute left-0 right-0 mt-1 bg-white border-2 border-teal-500 rounded-lg shadow-2xl max-h-60 overflow-auto",style:{zIndex:9999,position:"absolute",top:"100%"},children:[C.jsxs("div",{className:"bg-teal-100 px-2 py-1 text-xs text-teal-700",children:["Found ",Re.length," results"]}),Re.map(ze=>C.jsxs("button",{type:"button",onMouseDown:Fe=>{Fe.preventDefault(),Fe.stopPropagation(),$t(ze)},className:"w-full px-4 py-3 text-left text-sm hover:bg-teal-50 flex items-start gap-2 border-b last:border-b-0 cursor-pointer",children:[C.jsx(Dl,{className:"h-4 w-4 mt-0.5 text-teal-600 flex-shrink-0"}),C.jsx("span",{className:"line-clamp-2",children:ze.place_name})]},ze.id))]})]}),C.jsxs("div",{className:"relative",style:{zIndex:1},children:[C.jsx("div",{ref:E,style:{width:"100%",height:"400px",borderRadius:"12px",overflow:"hidden",backgroundColor:"#e5e7eb"}}),!z&&C.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 rounded-xl",children:C.jsxs("div",{className:"flex flex-col items-center gap-2",children:[C.jsx(z_,{className:"h-8 w-8 animate-spin text-teal-600"}),C.jsx("span",{className:"text-sm text-gray-600",children:"Loading map..."})]})})]})]}),C.jsxs(Pw,{children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,disabled:Ke,children:y("common.cancel")}),C.jsxs(Un,{type:"submit",disabled:Ke,children:[Ke&&C.jsx(z_,{className:"mr-2 h-4 w-4 animate-spin"}),y(d==="add"?"common.add":"common.save")]})]})]})]})})},Moe=()=>{const{t}=Lc(),i=nd(),{toast:c}=Y_(),[d,y]=Z.useState(""),[w,E]=Z.useState(!1),[s,O]=Z.useState(),[z,j]=Z.useState("add"),[H,Y]=Z.useState(null),[ie,oe]=Z.useState(null),{data:ee,isLoading:le}=$o({queryKey:["stops"],queryFn:()=>Sx.getStops()}),ge=Ns({mutationFn:xe=>Sx.deleteStop(xe),onSuccess:()=>{i.invalidateQueries({queryKey:["stops"]}),oe(null),c({title:"Stop Deleted",description:"Bus stop has been removed."})},onError:xe=>{const Ze=xe.message?.includes("400")?"Cannot delete stop that is assigned to routes. Remove it from routes first.":"Failed to delete stop.";c({title:"Error",description:Ze,variant:"destructive"}),oe(null)}}),pe=ee?.filter(xe=>xe.name.toLowerCase().includes(d.toLowerCase())),_e=()=>{O(void 0),j("add"),E(!0)},Re=xe=>{O(xe),j("edit"),E(!0)};return le?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("stops.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage bus stops and locations"})]})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((xe,Ze)=>C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})}),C.jsx(hi,{children:C.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})})]},Ze))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("stops.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage bus stops and locations"})]}),C.jsxs(Un,{className:"gap-2",onClick:_e,children:[C.jsx(ed,{className:"h-4 w-4"}),t("stops.addStop")]})]}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"relative",children:[C.jsx(J0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),C.jsx(br,{placeholder:t("stops.searchPlaceholder"),value:d,onChange:xe=>y(xe.target.value),className:"pl-10"})]})})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Stops"}),C.jsx("p",{className:"text-2xl font-bold",children:ee?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-teal-100 rounded-lg flex items-center justify-center",children:C.jsx(Dl,{className:"h-6 w-6 text-teal-600"})})]})})})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:pe?.map((xe,Ze)=>C.jsx(_o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Ze*.05},children:C.jsxs(li,{className:"hover:shadow-lg transition-all hover:border-teal-300 cursor-pointer",children:[C.jsx(zr,{className:"pb-3",children:C.jsxs("div",{className:"flex items-start gap-3",children:[C.jsx("div",{className:"h-10 w-10 bg-teal-100 rounded-lg flex items-center justify-center flex-shrink-0",children:C.jsx(Dl,{className:"h-5 w-5 text-teal-600"})}),C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx(ys,{className:"text-lg truncate",children:xe.name}),xe.description&&C.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:xe.description})]})]})}),C.jsxs(hi,{className:"space-y-3",children:[C.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[C.jsx(yf,{className:"h-4 w-4"}),C.jsxs("span",{className:"font-mono text-xs",children:[xe.latitude.toFixed(4),", ",xe.longitude.toFixed(4)]})]}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx(Un,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>Y(xe),children:"View on Map"}),C.jsx(Un,{variant:"ghost",size:"sm",className:"flex-1",onClick:()=>Re(xe),children:"Edit"}),C.jsx(Un,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>oe(xe.id),children:C.jsx(U_,{className:"h-4 w-4"})})]}),ie===xe.id&&C.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 space-y-2",children:[C.jsx("p",{className:"text-sm text-red-700",children:"Delete this stop?"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx(Un,{variant:"destructive",size:"sm",onClick:()=>ge.mutate(xe.id),disabled:ge.isPending,children:ge.isPending?"Deleting...":"Yes, Delete"}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>oe(null),children:"Cancel"})]})]})]})]})},xe.id))}),pe&&pe.length===0&&C.jsx(li,{children:C.jsx(hi,{className:"py-12",children:C.jsxs("div",{className:"text-center text-muted-foreground",children:[C.jsx(Dl,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),C.jsx("p",{className:"text-lg font-medium",children:d?"No stops match your search":"No stops found"}),C.jsx("p",{className:"text-sm mt-2",children:d?"Try a different search term":"Add your first stop to get started"})]})})}),C.jsx(Ck,{children:H&&C.jsx(_o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>Y(null),children:C.jsxs(_o.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-xl w-full max-w-3xl overflow-hidden",onClick:xe=>xe.stopPropagation(),children:[C.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("div",{className:"h-10 w-10 bg-teal-100 rounded-lg flex items-center justify-center",children:C.jsx(Dl,{className:"h-5 w-5 text-teal-600"})}),C.jsxs("div",{children:[C.jsx("h3",{className:"font-semibold text-lg",children:H.name}),H.description&&C.jsx("p",{className:"text-sm text-muted-foreground",children:H.description})]})]}),C.jsx(Un,{variant:"ghost",size:"icon",onClick:()=>Y(null),children:C.jsx(tS,{className:"h-5 w-5"})})]}),C.jsx("div",{className:"h-[400px]",children:C.jsx(nS,{initialViewState:{longitude:H.longitude,latitude:H.latitude,zoom:15},stops:[H],showRoute:!1,routeColor:"#14b8a6",height:"100%",interactive:!0,showControls:!0})}),C.jsx("div",{className:"p-4 border-t bg-gray-50",children:C.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[C.jsx(yf,{className:"h-4 w-4"}),C.jsxs("span",{className:"font-mono",children:[H.latitude.toFixed(6),", ",H.longitude.toFixed(6)]})]})})]})})}),C.jsx(Roe,{open:w,onClose:()=>E(!1),stop:s,mode:z})]})},Ioe=fg({name:ks().min(2,"Name must be at least 2 characters"),stop_id:ks().min(1,"Stop is required"),location:ks().optional(),status:Gx(["online","offline","error"])}),Doe=({isOpen:t,onClose:i,onSubmit:c,display:d,isLoading:y})=>{const w=!!d,{data:E}=$o({queryKey:["stops"],queryFn:()=>Sx.getStops()}),{register:s,handleSubmit:O,reset:z,setValue:j,watch:H,formState:{errors:Y}}=ug({resolver:hg(Ioe),defaultValues:{name:"",stop_id:"",location:"",status:"offline"}}),ie=H("stop_id"),oe=H("status");Z.useEffect(()=>{t&&z(d?{name:d.name,stop_id:d.stop_id.toString(),location:d.location||"",status:d.status}:{name:"",stop_id:"",location:"",status:"offline"})},[t,d,z]);const ee=le=>{c(le)};return C.jsx(Tf,{open:t,onOpenChange:le=>!le&&i(),children:C.jsxs(ch,{className:"max-w-md",children:[C.jsx(uh,{children:C.jsx(dh,{children:w?"Edit Display Unit":"Add New Display Unit"})}),C.jsxs("form",{onSubmit:O(ee),className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"name",children:"Display Name *"}),C.jsx(br,{id:"name",placeholder:"e.g., Blue Area Display",...s("name")}),Y.name&&C.jsx("p",{className:"text-sm text-red-500",children:Y.name.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"stop_id",children:"Assigned Stop *"}),C.jsxs(Rx,{value:ie,onValueChange:le=>j("stop_id",le),children:[C.jsx(X_,{children:C.jsx(Mx,{placeholder:"Select a stop"})}),C.jsx(K_,{children:E?.map(le=>C.jsx(hu,{value:String(le.id),children:le.name},le.id))})]}),Y.stop_id&&C.jsx("p",{className:"text-sm text-red-500",children:Y.stop_id.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"location",children:"Physical Location (Optional)"}),C.jsx(br,{id:"location",placeholder:"e.g., Main pole near bus shelter",...s("location")}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Describe where the display is physically installed"})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"status",children:"Status"}),C.jsxs(Rx,{value:oe,onValueChange:le=>j("status",le),children:[C.jsx(X_,{children:C.jsx(Mx,{placeholder:"Select status"})}),C.jsxs(K_,{children:[C.jsx(hu,{value:"online",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),"Online"]})}),C.jsx(hu,{value:"offline",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("div",{className:"h-2 w-2 rounded-full bg-gray-400"}),"Offline"]})}),C.jsx(hu,{value:"error",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500"}),"Error"]})})]})]})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),C.jsx(Un,{type:"submit",disabled:y,children:y?"Saving...":w?"Update Display":"Add Display"})]})]})]})})},Poe=()=>{const{t}=Lc(),i=lg(),c=nd(),{toast:d}=Y_(),[y,w]=Z.useState(!1),[E,s]=Z.useState(null),[O,z]=Z.useState(null),{data:j,isLoading:H}=$o({queryKey:["displays"],queryFn:()=>ax.getDisplays()}),Y=Ns({mutationFn:Le=>ax.createDisplay(Le),onSuccess:()=>{c.invalidateQueries({queryKey:["displays"]}),w(!1),d({title:"Display Added",description:"New display unit has been created successfully."})},onError:()=>{d({title:"Error",description:"Failed to create display unit.",variant:"destructive"})}}),ie=Ns({mutationFn:({id:Le,data:$e})=>ax.updateDisplay(Le,$e),onSuccess:()=>{c.invalidateQueries({queryKey:["displays"]}),w(!1),s(null),d({title:"Display Updated",description:"Display unit has been updated successfully."})},onError:()=>{d({title:"Error",description:"Failed to update display unit.",variant:"destructive"})}}),oe=Ns({mutationFn:Le=>ax.deleteDisplay(Le),onSuccess:()=>{c.invalidateQueries({queryKey:["displays"]}),z(null),d({title:"Display Deleted",description:"Display unit has been removed."})},onError:()=>{d({title:"Error",description:"Failed to delete display unit.",variant:"destructive"})}}),ee=j?.filter(Le=>Le.status==="online").length||0,le=j?.filter(Le=>Le.status==="offline").length||0,ge=j?.filter(Le=>Le.status==="error").length||0,pe=()=>{s(null),w(!0)},_e=Le=>{s(Le),w(!0)},Re=Le=>{z(Le)},xe=()=>{O&&oe.mutate(O)},Ze=Le=>{const $e={name:Le.name,stop_id:parseInt(Le.stop_id,10),location:Le.location,status:Le.status};E?ie.mutate({id:E.id,data:$e}):Y.mutate($e)};return H?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("displays.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage SMD display units"})]})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((Le,$e)=>C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})}),C.jsx(hi,{children:C.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})})]},$e))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("displays.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage SMD display units"})]}),C.jsxs(Un,{className:"gap-2",onClick:pe,children:[C.jsx(ed,{className:"h-4 w-4"}),t("displays.addDisplay")]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Displays"}),C.jsx("p",{className:"text-2xl font-bold",children:j?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:C.jsx(M_,{className:"h-6 w-6 text-blue-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Online"}),C.jsx("p",{className:"text-2xl font-bold text-green-600",children:ee})]}),C.jsx("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:C.jsx(rq,{className:"h-6 w-6 text-green-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Offline"}),C.jsx("p",{className:"text-2xl font-bold text-gray-600",children:le})]}),C.jsx("div",{className:"h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center",children:C.jsx(nq,{className:"h-6 w-6 text-gray-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Error"}),C.jsx("p",{className:"text-2xl font-bold text-red-600",children:ge})]}),C.jsx("div",{className:"h-12 w-12 bg-red-100 rounded-lg flex items-center justify-center",children:C.jsx(xf,{className:"h-6 w-6 text-red-600"})})]})})})]}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j?.map((Le,$e)=>C.jsx(_o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$e*.1},children:C.jsxs(li,{className:"hover:shadow-lg transition-all hover:border-blue-300",children:[C.jsx(zr,{className:"pb-3",children:C.jsx("div",{className:"flex items-start justify-between",children:C.jsxs("div",{className:"flex items-start gap-3",children:[C.jsx("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:C.jsx(M_,{className:"h-5 w-5 text-blue-600"})}),C.jsxs("div",{children:[C.jsx(ys,{className:"text-lg",children:Le.name}),C.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[C.jsx("div",{className:`h-2 w-2 rounded-full ${Le.status==="online"?"bg-green-500 animate-pulse":Le.status==="error"?"bg-red-500":"bg-gray-400"}`}),C.jsx("span",{className:`text-xs font-medium ${Le.status==="online"?"text-green-600":Le.status==="error"?"text-red-600":"text-gray-500"}`,children:Le.status==="online"?"Online":Le.status==="error"?"Error":"Offline"})]})]})]})})}),C.jsxs(hi,{className:"space-y-3",children:[C.jsxs("div",{className:"space-y-2 text-sm",children:[C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(Dl,{className:"h-4 w-4"}),C.jsx("span",{children:Le.stop?.name||"Unknown Stop"})]}),Le.location&&C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(R0,{className:"h-4 w-4"}),C.jsx("span",{className:"text-xs",children:Le.location})]})]}),O===Le.id?C.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 space-y-2",children:[C.jsx("p",{className:"text-sm text-red-700",children:"Are you sure you want to delete this display?"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx(Un,{variant:"destructive",size:"sm",onClick:xe,disabled:oe.isPending,children:oe.isPending?"Deleting...":"Yes, Delete"}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>z(null),children:"Cancel"})]})]}):C.jsxs("div",{className:"flex gap-2 pt-2",children:[C.jsxs(Un,{variant:"default",size:"sm",className:"flex-1",onClick:()=>i(`/smd-simulator/${Le.id}`),children:[C.jsx(M_,{className:"h-4 w-4 mr-1"}),"Simulate"]}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>_e(Le),children:C.jsx(_w,{className:"h-4 w-4"})}),C.jsx(Un,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>Re(Le.id),children:C.jsx(U_,{className:"h-4 w-4"})})]})]})]})},Le.id))}),j?.length===0&&C.jsx(li,{className:"p-12",children:C.jsxs("div",{className:"text-center",children:[C.jsx(M_,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),C.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Display Units"}),C.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by adding your first SMD display unit."}),C.jsxs(Un,{onClick:pe,children:[C.jsx(ed,{className:"h-4 w-4 mr-2"}),"Add Display"]})]})}),C.jsx(Doe,{isOpen:y,onClose:()=>{w(!1),s(null)},onSubmit:Ze,display:E,isLoading:Y.isPending||ie.isPending})]})},Ooe=t=>{const i=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/^([a-zA-Z0-9_-]{11})$/];for(const c of i){const d=t.match(c);if(d)return d[1]}return null},l0={resolution:"19201080",brightness:"5000 nits",connectivity:"4G LTE",temperature:42,powerMode:"Normal"},zoe=t=>{const i=new Map;return t.forEach(c=>{i.has(c.route_id)||i.set(c.route_id,{route_name:c.route_name,route_code:c.route_code,color:c.route_color,buses:[]}),i.get(c.route_id).buses.push({bus_name:c.registration_number,eta_minutes:c.eta_minutes,status:c.arrival_status})}),i.forEach(c=>{c.buses.sort((d,y)=>d.eta_minutes-y.eta_minutes)}),Array.from(i.values())},Loe=t=>t.map(i=>({id:i.id,title:i.title,message:i.message,message_ur:i.message_ur||i.message,severity:i.severity,active:!0})),Noe=t=>t.map(i=>({id:i.id,title:i.title,media_type:i.media_type,content_url:i.content_url,duration_seconds:i.duration_seconds})),vz=10,M2=8,bz=30,G1=60,koe=5e3,wz=()=>{const{displayId:t}=XE(),i=t?parseInt(t,10):null,{data:c,isLoading:d,isError:y}=$o({queryKey:["displayContent",i],queryFn:()=>ax.getDisplayContent(i),enabled:!!i,refetchInterval:koe,staleTime:2e3}),[w,E]=Z.useState(new Date),[s,O]=Z.useState(!1),[z,j]=Z.useState(!1),[H,Y]=Z.useState(!0),[ie,oe]=Z.useState("en"),[ee,le]=Z.useState(!0),[ge,pe]=Z.useState([]),[_e,Re]=Z.useState([]),[xe,Ze]=Z.useState([]),[Le,$e]=Z.useState([]),[st,Et]=Z.useState(0),[Ut,$t]=Z.useState(0),[tt,ut]=Z.useState(!1),[on,Ke]=Z.useState(0),[ze,Fe]=Z.useState(G1),[kt,fn]=Z.useState(new Set),Me=Z.useRef(0),[ct,vt]=Z.useState(null),[Kt,zn]=Z.useState(!1),Nn=Z.useRef({contentIndex:0,wasShowingAd:!1,adIndex:0});Z.useEffect(()=>{if(c){const jn=zoe(c.upcoming_buses);pe(jn);const ti=Loe(c.announcements);Re(ti);const rr=Noe(c.advertisements);Ze(rr)}},[c]);const Yt=Z.useCallback(()=>{const jn=[];ge.forEach(rr=>{const et=rr.buses.filter(Ot=>Ot.eta_minutes<=60).slice(0,5);et.length>0&&jn.push({type:"route",data:{...rr,buses:et},duration:vz})});const ti=_e.filter(rr=>rr.severity!=="emergency");if(ti.length>0)if(jn.length>0){const rr={type:"announcement",data:ti[0],duration:M2};jn.splice(1,0,rr);for(let et=1;et<ti.length;et++)jn.push({type:"announcement",data:ti[et],duration:M2})}else ti.forEach(rr=>{jn.push({type:"announcement",data:rr,duration:M2})});$e(jn)},[ge,_e]),On=Z.useCallback(()=>xe.length===0?null:xe[on%xe.length],[on,xe]),An=Z.useCallback(()=>{if(tt){const jn=On();if(jn){fn(yn=>new Set(yn).add(jn.id));const ti=ze-jn.duration_seconds,rr=(on+1)%xe.length,et=xe[rr],Ot=new Set(kt).add(jn.id),nn=xe.length>0&&xe.every(yn=>Ot.has(yn.id));ti>0&&et&&et.duration_seconds<=ti&&!nn?(Fe(ti),Ke(rr)):(Me.current=rr,ut(!1),Et(0),Fe(G1),fn(new Set))}}else{const jn=st+1;if(jn>=Le.length)if(xe.length>0&&ze>0){const ti=xe[Me.current%xe.length];ti&&ti.duration_seconds<=ze?(ut(!0),Ke(Me.current),fn(new Set)):(Et(0),Fe(G1))}else Et(0),Fe(G1);else Et(jn)}$t(0)},[tt,on,ze,st,Le.length,On,xe,kt]);Z.useEffect(()=>{const jn=setInterval(()=>{E(new Date)},1e3);return()=>clearInterval(jn)},[]),Z.useEffect(()=>{const jn=setInterval(()=>{pe(ti=>ti.map(rr=>({...rr,buses:rr.buses.map(et=>({...et,eta_minutes:Math.max(0,et.eta_minutes-1),status:et.eta_minutes<=2?"arriving":et.eta_minutes<=4?"approaching":et.status})).filter(et=>et.eta_minutes>0)})))},6e4);return()=>clearInterval(jn)},[]),Z.useEffect(()=>{Yt()},[Yt]),Z.useEffect(()=>{const jn=_e.find(ti=>ti.severity==="emergency");jn?(Nn.current={contentIndex:st,wasShowingAd:tt,adIndex:on},vt(jn),zn(!0)):(Kt&&(Et(Nn.current.contentIndex),ut(Nn.current.wasShowingAd),Ke(Nn.current.adIndex)),zn(!1),vt(null))},[_e]),Z.useEffect(()=>{if(z||Kt||d)return;let jn=vz;if(tt){const rr=On();jn=rr?Math.min(rr.duration_seconds,bz):10}else Le[st]&&(jn=Le[st].duration);const ti=setInterval(()=>{$t(rr=>{const et=100/(jn*10);return rr+et>=100?(An(),0):rr+et})},100);return()=>clearInterval(ti)},[z,Kt,d,tt,st,Le,On,An]),Z.useEffect(()=>{const jn=()=>{O(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",jn),()=>document.removeEventListener("fullscreenchange",jn)},[]);const In=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},gi=jn=>C.jsxs(_o.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.5},className:"absolute inset-0 flex flex-col",children:[C.jsxs("div",{className:"flex items-center gap-6 mb-8",children:[C.jsx("div",{className:"px-8 py-4 rounded-2xl text-white font-black text-5xl shadow-2xl",style:{backgroundColor:jn.color},children:jn.route_code}),C.jsxs("div",{children:[C.jsx("h2",{className:"text-white text-4xl font-bold",children:jn.route_name}),C.jsx("p",{className:"text-gray-400 text-xl mt-1",children:ie==="en"?"Next Arrivals":" "})]})]}),C.jsx("div",{className:"flex-1 grid gap-4",children:jn.buses.length>0?jn.buses.map((ti,rr)=>C.jsxs(_o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:rr*.1},className:`flex items-center justify-between p-6 rounded-2xl border-2 ${ti.status==="arriving"||ti.status==="approaching"?"bg-green-500/20 border-green-500":"bg-white/5 border-white/10"}`,children:[C.jsxs("div",{className:"flex items-center gap-6",children:[C.jsx("div",{className:"h-16 w-16 bg-white/10 rounded-xl flex items-center justify-center",children:C.jsx(fu,{className:"h-8 w-8 text-white"})}),C.jsxs("div",{children:[C.jsx("p",{className:"text-white text-2xl font-bold",children:ti.bus_name}),C.jsx("p",{className:"text-gray-400",children:ie==="en"?"Bus ID":"  "})]})]}),C.jsxs("div",{className:"flex items-center gap-8",children:[C.jsx("div",{className:`px-4 py-2 rounded-xl text-lg font-semibold ${ti.status==="arriving"?"bg-green-500 text-white animate-pulse":ti.status==="approaching"?"bg-yellow-500 text-white":"bg-white/20 text-white"}`,children:ti.status==="arriving"?ie==="en"?" ARRIVING NOW":"    ":ti.status==="approaching"?ie==="en"?" APPROACHING":"    ":ie==="en"?" ON ROUTE":"  "}),C.jsxs("div",{className:"text-right min-w-[120px]",children:[C.jsx("p",{className:"text-white text-5xl font-black",children:ti.eta_minutes}),C.jsx("p",{className:"text-gray-400 text-lg",children:ie==="en"?"minutes":""})]}),C.jsx("div",{className:"w-24 h-3 bg-white/10 rounded-full overflow-hidden",children:C.jsx(_o.div,{className:"h-full rounded-full",style:{backgroundColor:jn.color},initial:{width:"100%"},animate:{width:`${Math.max(0,100-ti.eta_minutes/60*100)}%`}})})]})]},ti.bus_name)):C.jsx("div",{className:"flex items-center justify-center h-full",children:C.jsx("p",{className:"text-gray-500 text-3xl",children:ie==="en"?"No arrivals in the next hour":"     "})})})]},`route-${jn.route_code}`),ji=jn=>C.jsx(_o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.5},className:"absolute inset-0 flex items-center justify-center",children:C.jsxs("div",{className:`max-w-4xl p-12 rounded-3xl text-center ${jn.severity==="warning"?"bg-amber-500/20 border-4 border-amber-500":"bg-blue-500/20 border-4 border-blue-500"}`,children:[C.jsx("div",{className:`h-24 w-24 mx-auto mb-6 rounded-full flex items-center justify-center ${jn.severity==="warning"?"bg-amber-500":"bg-blue-500"}`,children:C.jsx(xf,{className:"h-12 w-12 text-white"})}),C.jsx("h2",{className:`text-4xl font-bold mb-4 ${jn.severity==="warning"?"text-amber-400":"text-blue-400"}`,children:jn.severity==="warning"?ie==="en"?"NOTICE":"":ie==="en"?"INFORMATION":""}),C.jsx("p",{className:"text-white text-3xl leading-relaxed",children:ie==="en"?jn.message:jn.message_ur})]})},`announcement-${jn.id}`),Ri=jn=>{const ti=()=>{if(jn.media_type==="youtube"){const rr=Ooe(jn.content_url);if(rr)return C.jsx("iframe",{src:`https://www.youtube.com/embed/${rr}?autoplay=1&mute=1&controls=0&loop=1&playlist=${rr}`,className:"w-full h-full",allow:"autoplay; encrypted-media; compute-pressure",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:jn.title,style:{border:"none"}},`youtube-${rr}`)}return C.jsx("img",{src:jn.content_url,alt:jn.title,className:"max-w-full max-h-full object-contain"})};return C.jsxs(_o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"absolute inset-0 flex items-center justify-center bg-black",children:[ti(),C.jsxs("div",{className:"absolute bottom-8 right-8 bg-black/50 backdrop-blur px-4 py-2 rounded-lg flex items-center gap-2",children:[jn.media_type==="youtube"&&C.jsx("svg",{className:"w-5 h-5 text-red-500",viewBox:"0 0 24 24",fill:"currentColor",children:C.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),C.jsx("p",{className:"text-white/60 text-sm",children:ie==="en"?"Advertisement":""})]})]},`ad-${jn.id}`)},Rr=()=>C.jsxs(_o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-red-900 flex items-center justify-center z-50",children:[C.jsx(_o.div,{className:"absolute inset-4 border-8 border-red-500 rounded-3xl",animate:{opacity:[1,.3,1]},transition:{duration:1,repeat:1/0}}),C.jsxs("div",{className:"text-center p-12 max-w-5xl",children:[C.jsx(_o.div,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},className:"h-32 w-32 mx-auto mb-8 bg-red-500 rounded-full flex items-center justify-center",children:C.jsx(xf,{className:"h-20 w-20 text-white"})}),C.jsx("h1",{className:"text-red-300 text-6xl font-black mb-8 tracking-wider",children:ie==="en"?" EMERGENCY ALERT ":"   "}),C.jsx("p",{className:"text-white text-4xl leading-relaxed font-bold",children:ct?ie==="en"?ct.message:ct.message_ur:""}),C.jsx("p",{className:"text-red-300 text-2xl mt-12",children:ie==="en"?"Please follow instructions from authorities":"       "})]})]}),wr=(()=>{if(tt){const ti=On();return{type:"ad",data:ti,duration:ti?Math.min(ti.duration_seconds,bz):10}}const jn=Le[st];return jn?{type:jn.type,data:jn.data,duration:jn.duration}:{type:"loading",data:null,duration:0}})();return C.jsxs("div",{className:`min-h-screen bg-gray-950 ${s?"":"p-4 md:p-8"}`,children:[H&&!s&&C.jsxs(_o.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 bg-white rounded-2xl p-6 shadow-xl max-w-7xl mx-auto",children:[C.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"SMD Display Simulator"}),C.jsxs("p",{className:"text-gray-500 text-sm",children:["Simulating LED display at bus stop  ",l0.resolution," @ ",l0.brightness]})]}),C.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[C.jsxs(Un,{variant:z?"default":"outline",size:"sm",onClick:()=>j(!z),className:"gap-2",children:[z?C.jsx(Q2,{className:"h-4 w-4"}):C.jsx(YH,{className:"h-4 w-4"}),z?"Resume":"Pause"]}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>{$t(0),tt?on>0?Ke(on-1):(ut(!1),Et(Math.max(0,Le.length-1))):st>0&&Et(st-1)},children:C.jsx(vH,{className:"h-4 w-4"})}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>{$t(0),An()},children:C.jsx(yH,{className:"h-4 w-4"})}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>oe(jn=>jn==="en"?"ur":"en"),className:"gap-2 min-w-[80px]",children:ie==="en"?"EN":""}),C.jsxs(Un,{variant:ee?"outline":"default",size:"sm",onClick:()=>le(!ee),className:"gap-2",title:ee?"Unmute audio":"Mute audio",children:[ee?C.jsx(Iq,{className:"h-4 w-4"}):C.jsx(Rq,{className:"h-4 w-4"}),ee?"Unmute":"Mute"]}),C.jsxs(Un,{variant:Kt?"destructive":"outline",size:"sm",onClick:()=>{Kt?(zn(!1),vt(null)):(vt({id:0,title:"Test Emergency",message:"This is a test emergency announcement",message_ur:"     ",severity:"emergency",active:!0}),zn(!0))},className:"gap-2",children:[C.jsx(xf,{className:"h-4 w-4"}),Kt?"Clear Emergency":"Trigger Emergency"]}),C.jsxs(Un,{variant:"outline",size:"sm",onClick:In,className:"gap-2",children:[C.jsx(UH,{className:"h-4 w-4"}),"Fullscreen"]})]})]}),C.jsxs("div",{className:"mt-4 pt-4 border-t",children:[C.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[C.jsxs("span",{children:[tt?"Ad":"Content"," ",tt?on+1:st+1," of ",tt?xe.length:Le.length]}),C.jsx("span",{children:""}),C.jsxs("span",{className:"capitalize",children:[wr.type||"Loading",wr.type==="route"&&wr.data&&` - ${wr.data.route_code}`]}),C.jsx("span",{children:""}),C.jsxs("span",{children:[wr.duration,"s duration"]}),tt&&C.jsxs(C.Fragment,{children:[C.jsx("span",{children:""}),C.jsxs("span",{className:"text-amber-600 font-medium",children:["Ad Budget: ",ze,"s remaining"]})]})]}),C.jsx("div",{className:"mt-2 h-2 bg-gray-200 rounded-full overflow-hidden",children:C.jsx(_o.div,{className:`h-full rounded-full ${tt?"bg-amber-500":"bg-teal-500"}`,style:{width:`${Ut}%`}})})]})]}),C.jsxs(_o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:`${s?"w-full h-screen":"max-w-7xl mx-auto aspect-video"} bg-black rounded-2xl overflow-hidden shadow-2xl relative border-4 border-gray-800`,style:{fontFamily:"'Inter', 'Segoe UI', sans-serif"},dir:ie==="ur"?"rtl":"ltr",children:[C.jsxs("div",{className:"absolute top-0 left-0 right-0 h-20 bg-gradient-to-b from-black via-black/90 to-transparent z-40 px-8 flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-teal-400 to-teal-600 rounded-xl flex items-center justify-center shadow-lg",children:C.jsx(fu,{className:"h-7 w-7 text-white"})}),C.jsxs("div",{children:[C.jsx("h1",{className:"text-white font-bold text-xl",children:ie==="en"?"Smart Metro Bus":"  "}),C.jsx("p",{className:"text-gray-400 text-sm",children:c?.stop?.name?ie==="en"?`Islamabad  ${c.stop.name}`:`   ${c.stop.name}`:ie==="en"?"Loading stop info...":"      ..."})]})]}),C.jsx("div",{className:"flex-1 mx-8 overflow-hidden",children:C.jsx(_o.div,{className:"flex items-center gap-8 text-gray-400 text-sm whitespace-nowrap",animate:{x:[0,-500]},transition:{duration:20,repeat:1/0,ease:"linear"},children:_e.filter(jn=>jn.severity==="info"&&jn.active).map(jn=>C.jsxs("span",{className:"flex items-center gap-2",children:[C.jsx("span",{className:"h-2 w-2 bg-blue-500 rounded-full"}),ie==="en"?jn.message:jn.message_ur]},jn.id))})}),C.jsxs("div",{className:"flex items-center gap-6",children:[C.jsxs("div",{className:"flex items-center gap-3 text-gray-400 text-sm",children:[C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx(pq,{className:"h-4 w-4 text-green-500"}),C.jsx("span",{children:l0.connectivity})]}),C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx(xq,{className:"h-4 w-4 text-orange-400"}),C.jsxs("span",{children:[l0.temperature,"C"]})]}),C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx(yw,{className:"h-4 w-4 text-yellow-400"}),C.jsx("span",{children:l0.powerMode})]})]}),C.jsxs("div",{className:"text-right",children:[C.jsx("p",{className:"text-white text-3xl font-bold tabular-nums",children:w.toLocaleTimeString(ie==="en"?"en-US":"ur-PK",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}),C.jsx("p",{className:"text-gray-400 text-sm",children:w.toLocaleDateString(ie==="en"?"en-US":"ur-PK",{weekday:"long",day:"numeric",month:"short",year:"numeric"})})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Pq,{className:"h-5 w-5 text-green-500"}),C.jsx("div",{className:"h-3 w-3 bg-green-500 rounded-full animate-pulse"})]})]})]}),C.jsx("div",{className:"absolute inset-0 pt-24 pb-6 px-8",children:C.jsx(Ck,{mode:"wait",children:Kt&&ct?Rr():d?C.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[C.jsx(fu,{className:"h-16 w-16 text-teal-500 animate-bounce mb-4"}),C.jsx("p",{className:"text-gray-500 text-2xl",children:"Loading display content..."})]}):y?C.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[C.jsx(xf,{className:"h-16 w-16 text-red-500 mb-4"}),C.jsx("p",{className:"text-red-400 text-2xl",children:"Failed to load display content"}),C.jsx("p",{className:"text-gray-500 text-lg mt-2",children:"Please check your connection"})]}):i?wr.data?wr.type==="route"?gi(wr.data):wr.type==="announcement"?ji(wr.data):wr.type==="ad"?Ri(wr.data):null:C.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[C.jsx(fu,{className:"h-16 w-16 text-gray-600 mb-4"}),C.jsx("p",{className:"text-gray-500 text-2xl",children:"No content available"}),C.jsx("p",{className:"text-gray-600 text-lg mt-2",children:"Waiting for bus data..."})]}):C.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[C.jsx(J2,{className:"h-16 w-16 text-amber-500 mb-4"}),C.jsx("p",{className:"text-amber-400 text-2xl",children:"No Display Selected"}),C.jsx("p",{className:"text-gray-500 text-lg mt-2",children:"Select a display from the Displays page"})]})})}),!Kt&&C.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 bg-gray-800",children:C.jsx(_o.div,{className:"h-full bg-gradient-to-r from-teal-500 to-teal-400",style:{width:`${Ut}%`}})}),!Kt&&(Le.length>0||xe.length>0)&&C.jsxs("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 flex items-center gap-2",children:[Le.map((jn,ti)=>C.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${!tt&&ti===st?"w-8 bg-teal-500":"w-2 bg-gray-600"}`},`content-${ti}`)),xe.length>0&&C.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${tt?"w-8 bg-amber-500":"w-2 bg-gray-600"}`})]}),s&&C.jsx("button",{onClick:In,className:"absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-black/70 rounded-lg transition-colors",children:C.jsx(ZH,{className:"h-6 w-6 text-white"})}),s&&C.jsx("button",{onClick:()=>Y(!H),className:"absolute top-4 left-4 z-50 p-2 bg-black/50 hover:bg-black/70 rounded-lg transition-colors",children:C.jsx(J2,{className:"h-6 w-6 text-white"})})]}),!s&&C.jsxs(_o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-6 max-w-7xl mx-auto bg-white rounded-2xl p-6 shadow-xl",children:[C.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:"SMD Hardware Specifications"}),C.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 text-sm",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Display"}),C.jsx("p",{className:"font-semibold",children:"3.9mm LED"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Resolution"}),C.jsx("p",{className:"font-semibold",children:"19201080"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Brightness"}),C.jsx("p",{className:"font-semibold",children:"5000 nits"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Material"}),C.jsx("p",{className:"font-semibold",children:"Tamper-proof"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Power"}),C.jsx("p",{className:"font-semibold",children:"220-240V AC"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Connectivity"}),C.jsx("p",{className:"font-semibold",children:"4G/Wi-Fi/ETH"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Dimensions"}),C.jsx("p",{className:"font-semibold",children:"15001000mm"})]}),C.jsxs("div",{children:[C.jsx("p",{className:"text-gray-500",children:"Weight"}),C.jsx("p",{className:"font-semibold",children:"45 kg"})]})]})]})]})},joe=t=>{const i=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/^([a-zA-Z0-9_-]{11})$/];for(const c of i){const d=t.match(c);if(d)return d[1]}return null},Foe=fg({title:ks().min(1,"Title is required"),media_type:Gx(["image","youtube"]),content_url:ks().min(1,"Content URL is required"),duration_seconds:Ax().min(1,"Duration must be at least 1 second").max(60,"Duration cannot exceed 60 seconds"),advertiser_name:ks().min(1,"Advertiser name is required"),advertiser_contact:ks().optional()}),Boe=({isOpen:t,onClose:i,onSubmit:c,ad:d,isLoading:y})=>{const w=!!d,[E,s]=Z.useState(null),{register:O,handleSubmit:z,reset:j,setValue:H,watch:Y,formState:{errors:ie}}=ug({resolver:hg(Foe),defaultValues:{title:"",media_type:"image",content_url:"",duration_seconds:10,advertiser_name:"",advertiser_contact:""}}),oe=Y("media_type"),ee=Y("content_url");Z.useEffect(()=>{t&&j(d?{title:d.title,media_type:d.media_type,content_url:d.content_url,duration_seconds:d.duration_seconds,advertiser_name:d.advertiser_name||"",advertiser_contact:d.advertiser_contact||""}:{title:"",media_type:"image",content_url:"",duration_seconds:10,advertiser_name:"",advertiser_contact:""})},[t,d,j]),Z.useEffect(()=>{if(oe==="youtube"){const ge=joe(ee);s(ge?`https://img.youtube.com/vi/${ge}/mqdefault.jpg`:null)}else s(ee||null)},[ee,oe]),Z.useEffect(()=>{oe==="youtube"&&H("duration_seconds",30)},[oe,H]);const le=ge=>{c(ge)};return C.jsx(Tf,{open:t,onOpenChange:ge=>!ge&&i(),children:C.jsxs(ch,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[C.jsx(uh,{children:C.jsx(dh,{children:w?"Edit Advertisement":"Add New Advertisement"})}),C.jsxs("form",{onSubmit:z(le),className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"title",children:"Ad Title *"}),C.jsx(br,{id:"title",placeholder:"e.g., Jazz 4G Promotion",...O("title")}),ie.title&&C.jsx("p",{className:"text-sm text-red-500",children:ie.title.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{children:"Media Type *"}),C.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.jsxs("button",{type:"button",onClick:()=>H("media_type","image"),className:`p-4 border-2 rounded-lg flex flex-col items-center gap-2 transition-all ${oe==="image"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:[C.jsx(cx,{className:`h-8 w-8 ${oe==="image"?"text-purple-600":"text-gray-400"}`}),C.jsx("span",{className:`text-sm font-medium ${oe==="image"?"text-purple-700":"text-gray-600"}`,children:"Image"})]}),C.jsxs("button",{type:"button",onClick:()=>H("media_type","youtube"),className:`p-4 border-2 rounded-lg flex flex-col items-center gap-2 transition-all ${oe==="youtube"?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"}`,children:[C.jsx(dN,{className:`h-8 w-8 ${oe==="youtube"?"text-red-600":"text-gray-400"}`}),C.jsx("span",{className:`text-sm font-medium ${oe==="youtube"?"text-red-700":"text-gray-600"}`,children:"YouTube Video"})]})]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"content_url",children:oe==="youtube"?"YouTube URL *":"Image URL *"}),C.jsx(br,{id:"content_url",placeholder:oe==="youtube"?"https://www.youtube.com/watch?v=...":"https://example.com/image.jpg",...O("content_url")}),ie.content_url&&C.jsx("p",{className:"text-sm text-red-500",children:ie.content_url.message}),oe==="youtube"&&C.jsx("p",{className:"text-xs text-muted-foreground",children:"Supports youtube.com/watch, youtu.be, and embed URLs"})]}),E&&C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{children:"Preview"}),C.jsxs("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden relative",children:[C.jsx("img",{src:E,alt:"Preview",className:"w-full h-full object-cover",onError:ge=>{ge.target.style.display="none"}}),oe==="youtube"&&C.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:C.jsx("div",{className:"bg-red-600 rounded-full p-3",children:C.jsx("svg",{className:"w-8 h-8 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:C.jsx("path",{d:"M8 5v14l11-7z"})})})})]}),oe==="youtube"&&ee&&C.jsxs("a",{href:ee,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline flex items-center gap-1",children:[C.jsx(RH,{className:"h-3 w-3"}),"Open in YouTube"]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"duration_seconds",children:"Duration (seconds) *"}),C.jsx(br,{id:"duration_seconds",type:"number",min:1,max:60,...O("duration_seconds",{valueAsNumber:!0})}),ie.duration_seconds&&C.jsx("p",{className:"text-sm text-red-500",children:ie.duration_seconds.message}),C.jsx("p",{className:"text-xs text-muted-foreground",children:oe==="youtube"?"Recommended: 15-30 seconds for video ads":"Recommended: 8-15 seconds for image ads"})]}),C.jsxs("div",{className:"border-t pt-4 mt-4",children:[C.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[C.jsx(rN,{className:"h-4 w-4"}),"Advertiser Details"]}),C.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"advertiser_name",children:"Company/Name *"}),C.jsx(br,{id:"advertiser_name",placeholder:"e.g., Jazz Pakistan",...O("advertiser_name")}),ie.advertiser_name&&C.jsx("p",{className:"text-sm text-red-500",children:ie.advertiser_name.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"advertiser_contact",children:"Contact (Optional)"}),C.jsx(br,{id:"advertiser_contact",placeholder:"Email or phone",...O("advertiser_contact")})]})]})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),C.jsx(Un,{type:"submit",disabled:y,children:y?"Saving...":w?"Update Ad":"Add Ad"})]})]})]})})},Voe=fg({ad_id:ks().min(1,"Ad is required"),display_ids:cC(ks()).min(1,"At least one display is required"),start_time:ks().min(1,"Start time is required"),end_time:ks().min(1,"End time is required"),priority:Ax().min(1,"Priority must be at least 1").max(10,"Priority cannot exceed 10")}).refine(t=>new Date(t.end_time)>new Date(t.start_time),{message:"End time must be after start time",path:["end_time"]}),Uoe=({isOpen:t,onClose:i,onSubmit:c,ads:d,schedule:y,preselectedAdId:w,isLoading:E})=>{const s=!!y,[O,z]=Z.useState([]),{data:j}=$o({queryKey:["displays"],queryFn:()=>ax.getDisplays()}),{register:H,handleSubmit:Y,reset:ie,setValue:oe,watch:ee,formState:{errors:le}}=ug({resolver:hg(Voe),defaultValues:{ad_id:"",display_ids:[],start_time:"",end_time:"",priority:1}}),ge=ee("ad_id"),pe=d.find($e=>$e.id.toString()===ge),_e=$e=>$e.toISOString().slice(0,16);Z.useEffect(()=>{if(t)if(y)z([y.display_id.toString()]),ie({ad_id:y.ad_id.toString(),display_ids:[y.display_id.toString()],start_time:_e(new Date(y.start_time)),end_time:_e(new Date(y.end_time)),priority:y.priority});else{const $e=new Date,st=new Date($e.getTime()+10080*60*1e3);z([]),ie({ad_id:w?.toString()||"",display_ids:[],start_time:_e($e),end_time:_e(st),priority:1})}},[t,y,w,ie]),Z.useEffect(()=>{oe("display_ids",O)},[O,oe]);const Re=$e=>{z(st=>st.includes($e)?st.filter(Et=>Et!==$e):[...st,$e])},xe=()=>{j&&z(j.map($e=>$e.id.toString()))},Ze=()=>{z([])},Le=$e=>{const st={ad_id:parseInt($e.ad_id,10),display_ids:$e.display_ids.map(Et=>parseInt(Et,10)),start_time:new Date($e.start_time).toISOString(),end_time:new Date($e.end_time).toISOString(),priority:$e.priority};c(st)};return C.jsx(Tf,{open:t,onOpenChange:$e=>!$e&&i(),children:C.jsxs(ch,{className:"max-w-lg",children:[C.jsx(uh,{children:C.jsxs(dh,{className:"flex items-center gap-2",children:[C.jsx(R_,{className:"h-5 w-5"}),s?"Edit Schedule":"Schedule Advertisement"]})}),C.jsxs("form",{onSubmit:Y(Le),className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"ad_id",children:"Advertisement *"}),C.jsxs(Rx,{value:ge,onValueChange:$e=>oe("ad_id",$e),children:[C.jsx(X_,{children:C.jsx(Mx,{placeholder:"Select an ad"})}),C.jsx(K_,{children:d.map($e=>C.jsx(hu,{value:$e.id.toString(),children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("span",{className:`px-1.5 py-0.5 text-xs rounded ${$e.media_type==="youtube"?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700"}`,children:$e.media_type}),$e.title]})},$e.id))})]}),le.ad_id&&C.jsx("p",{className:"text-sm text-red-500",children:le.ad_id.message}),pe&&C.jsxs("p",{className:"text-xs text-muted-foreground",children:["Duration: ",pe.duration_seconds,"s  Type: ",pe.media_type]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx(Zi,{children:"Display Units *"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx("button",{type:"button",onClick:xe,className:"text-xs text-blue-600 hover:underline",children:"Select All"}),C.jsx("span",{className:"text-gray-300",children:"|"}),C.jsx("button",{type:"button",onClick:Ze,className:"text-xs text-gray-500 hover:underline",children:"Clear"})]})]}),C.jsx("div",{className:"border rounded-lg max-h-40 overflow-y-auto",children:j?.map($e=>{const st=$e.id.toString(),Et=O.includes(st);return C.jsxs("div",{onClick:()=>Re(st),className:`flex items-center gap-3 p-2 cursor-pointer hover:bg-gray-50 border-b last:border-b-0 ${Et?"bg-blue-50":""}`,children:[C.jsx("div",{className:`h-5 w-5 rounded border-2 flex items-center justify-center ${Et?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:Et&&C.jsx(pA,{className:"h-3 w-3 text-white"})}),C.jsx(M_,{className:"h-4 w-4 text-gray-500"}),C.jsx("span",{className:"flex-1 text-sm",children:$e.name}),C.jsx("span",{className:`h-2 w-2 rounded-full ${$e.status==="online"?"bg-green-500":$e.status==="error"?"bg-red-500":"bg-gray-400"}`})]},$e.id)})}),O.length>0&&C.jsxs("p",{className:"text-xs text-muted-foreground",children:[O.length," display",O.length>1?"s":""," selected"]}),le.display_ids&&C.jsx("p",{className:"text-sm text-red-500",children:le.display_ids.message})]}),C.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"start_time",children:"Start Time *"}),C.jsx(br,{id:"start_time",type:"datetime-local",...H("start_time")}),le.start_time&&C.jsx("p",{className:"text-sm text-red-500",children:le.start_time.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"end_time",children:"End Time *"}),C.jsx(br,{id:"end_time",type:"datetime-local",...H("end_time")}),le.end_time&&C.jsx("p",{className:"text-sm text-red-500",children:le.end_time.message})]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"priority",children:"Priority (1-10) *"}),C.jsx(br,{id:"priority",type:"number",min:1,max:10,...H("priority",{valueAsNumber:!0})}),le.priority&&C.jsx("p",{className:"text-sm text-red-500",children:le.priority.message}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Higher priority ads are shown more frequently. 1 = lowest, 10 = highest"})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),C.jsx(Un,{type:"submit",disabled:E,children:E?"Saving...":s?"Update Schedule":"Create Schedule"})]})]})]})})},$oe=t=>{const i=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/];for(const c of i){const d=t.match(c);if(d)return`https://img.youtube.com/vi/${d[1]}/mqdefault.jpg`}return null},Goe=()=>{const{t}=Lc(),i=nd(),{toast:c}=Y_(),[d,y]=Z.useState(!1),[w,E]=Z.useState(null),[s,O]=Z.useState(!1),[z,j]=Z.useState(null),[H,Y]=Z.useState(void 0),[ie,oe]=Z.useState(null),[ee,le]=Z.useState(null),[ge,pe]=Z.useState(""),{data:_e,isLoading:Re}=$o({queryKey:["ads"],queryFn:()=>Km.getAds()}),{data:xe,isLoading:Ze}=$o({queryKey:["ad-schedules"],queryFn:()=>Km.getSchedules()}),Le=Z.useMemo(()=>{if(!_e)return[];if(!ge.trim())return _e;const Me=ge.toLowerCase();return _e.filter(ct=>ct.title.toLowerCase().includes(Me)||ct.advertiser_name?.toLowerCase().includes(Me)||ct.media_type.toLowerCase().includes(Me))},[_e,ge]),$e=Ns({mutationFn:Me=>Km.createAd(Me),onSuccess:()=>{i.invalidateQueries({queryKey:["ads"]}),y(!1),c({title:"Ad Created",description:"Advertisement has been added successfully."})},onError:()=>{c({title:"Error",description:"Failed to create advertisement.",variant:"destructive"})}}),st=Ns({mutationFn:({id:Me,data:ct})=>Km.updateAd(Me,ct),onSuccess:()=>{i.invalidateQueries({queryKey:["ads"]}),i.invalidateQueries({queryKey:["ad-schedules"]}),y(!1),E(null),c({title:"Ad Updated",description:"Advertisement has been updated successfully."})},onError:()=>{c({title:"Error",description:"Failed to update advertisement.",variant:"destructive"})}}),Et=Ns({mutationFn:Me=>Km.deleteAd(Me),onSuccess:()=>{i.invalidateQueries({queryKey:["ads"]}),i.invalidateQueries({queryKey:["ad-schedules"]}),oe(null),c({title:"Ad Deleted",description:"Advertisement has been removed."})},onError:()=>{c({title:"Error",description:"Failed to delete advertisement.",variant:"destructive"})}}),Ut=Ns({mutationFn:Me=>Km.createSchedule(Me),onSuccess:()=>{i.invalidateQueries({queryKey:["ad-schedules"]}),O(!1),Y(void 0),c({title:"Schedule Created",description:"Ad schedule has been created successfully."})},onError:()=>{c({title:"Error",description:"Failed to create schedule.",variant:"destructive"})}}),$t=Ns({mutationFn:({id:Me,data:ct})=>Km.updateSchedule(Me,ct),onSuccess:()=>{i.invalidateQueries({queryKey:["ad-schedules"]}),O(!1),j(null),c({title:"Schedule Updated",description:"Ad schedule has been updated successfully."})},onError:()=>{c({title:"Error",description:"Failed to update schedule.",variant:"destructive"})}}),tt=Ns({mutationFn:Me=>Km.deleteSchedule(Me),onSuccess:()=>{i.invalidateQueries({queryKey:["ad-schedules"]}),le(null),c({title:"Schedule Deleted",description:"Ad schedule has been removed."})},onError:()=>{c({title:"Error",description:"Failed to delete schedule.",variant:"destructive"})}}),ut=Re||Ze,on=(Me,ct)=>{const vt=new Date;return vt>=new Date(Me)&&vt<=new Date(ct)},Ke=()=>{E(null),y(!0)},ze=Me=>{E(Me),y(!0)},Fe=Me=>{j(null),Y(Me),O(!0)},kt=Me=>{w?st.mutate({id:w.id,data:Me}):$e.mutate(Me)},fn=Me=>{z?$t.mutate({id:z.id,data:Me}):Ut.mutate(Me)};return ut?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("ads.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage advertisements and promotions"})]})}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((Me,ct)=>C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})}),C.jsx(hi,{children:C.jsx("div",{className:"h-32 bg-gray-200 rounded w-full"})})]},ct))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("ads.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage advertisements and promotions"})]}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsxs("div",{className:"relative",children:[C.jsx(J0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),C.jsx(br,{placeholder:"Search ads...",value:ge,onChange:Me=>pe(Me.target.value),className:"pl-9 w-64"})]}),C.jsxs(Un,{className:"gap-2",onClick:Ke,children:[C.jsx(ed,{className:"h-4 w-4"}),"Upload Ad"]})]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Ads"}),C.jsx("p",{className:"text-2xl font-bold",children:_e?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:C.jsx(cx,{className:"h-6 w-6 text-purple-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Scheduled"}),C.jsx("p",{className:"text-2xl font-bold text-blue-600",children:xe?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:C.jsx(R_,{className:"h-6 w-6 text-blue-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Now"}),C.jsx("p",{className:"text-2xl font-bold text-green-600",children:xe?.filter(Me=>on(Me.start_time,Me.end_time)).length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:C.jsx(ID,{className:"h-6 w-6 text-green-600"})})]})})})]}),xe&&xe.length>0&&C.jsxs(li,{children:[C.jsx(zr,{children:C.jsx("div",{className:"flex items-center justify-between",children:C.jsxs(ys,{className:"flex items-center gap-2",children:[C.jsx(R_,{className:"h-5 w-5"}),"Ad Schedules"]})})}),C.jsx(hi,{children:C.jsx("div",{className:"space-y-3",children:xe.map(Me=>{const ct=_e?.find(Kt=>Kt.id===Me.ad_id),vt=on(Me.start_time,Me.end_time);return C.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${vt?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:[C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("div",{className:`h-2 w-2 rounded-full ${vt?"bg-green-500":"bg-gray-400"}`}),C.jsxs("div",{children:[C.jsx("p",{className:"font-medium text-sm",children:ct?.title||"Unknown Ad"}),C.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(Me.start_time).toLocaleString()," - ",new Date(Me.end_time).toLocaleString()]})]})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsxs("span",{className:`text-xs px-2 py-1 rounded ${vt?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:["Priority: ",Me.priority]}),ee===Me.id?C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx(Un,{variant:"destructive",size:"sm",onClick:()=>tt.mutate(Me.id),disabled:tt.isPending,children:tt.isPending?"...":"Yes"}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>le(null),children:"No"})]}):C.jsxs(C.Fragment,{children:[C.jsx(Un,{variant:"ghost",size:"sm",onClick:()=>{j(Me),Y(void 0),O(!0)},children:C.jsx(_w,{className:"h-4 w-4"})}),C.jsx(Un,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>le(Me.id),children:C.jsx(U_,{className:"h-4 w-4"})})]})]})]},Me.id)})})})]}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Le?.map((Me,ct)=>{const vt=xe?.filter(Yt=>Yt.ad_id===Me.id)||[],Kt=vt.find(Yt=>on(Yt.start_time,Yt.end_time)),zn=Me.media_type==="youtube",Nn=zn?$oe(Me.content_url):Me.content_url;return C.jsx(_o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:ct*.1},children:C.jsxs(li,{className:"hover:shadow-lg transition-all hover:border-purple-300",children:[C.jsxs(zr,{className:"pb-3",children:[C.jsxs("div",{className:"flex items-start justify-between",children:[C.jsx(ys,{className:"text-lg",children:Me.title}),Kt&&C.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 bg-green-100 text-green-700",children:[C.jsx(ID,{className:"h-3 w-3"}),"Active"]})]}),C.jsx("div",{className:"flex items-center gap-1 mt-1",children:C.jsxs("span",{className:`text-xs px-2 py-0.5 rounded flex items-center gap-1 ${zn?"bg-red-100 text-red-700":"bg-purple-100 text-purple-700"}`,children:[zn?C.jsx(dN,{className:"h-3 w-3"}):C.jsx(cx,{className:"h-3 w-3"}),Me.media_type]})})]}),C.jsxs(hi,{className:"space-y-3",children:[C.jsx("div",{className:"aspect-video bg-gradient-to-br from-purple-100 to-blue-100 rounded-lg flex items-center justify-center overflow-hidden relative",children:Nn?C.jsxs(C.Fragment,{children:[C.jsx("img",{src:Nn,alt:Me.title,className:"w-full h-full object-cover"}),zn&&C.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:C.jsx("div",{className:"bg-red-600 rounded-full p-2",children:C.jsx("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:C.jsx("path",{d:"M8 5v14l11-7z"})})})})]}):C.jsx(cx,{className:"h-12 w-12 text-purple-300"})}),C.jsxs("div",{className:"space-y-2 text-sm",children:[C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(mA,{className:"h-4 w-4"}),C.jsxs("span",{className:"text-xs",children:["Duration: ",Me.duration_seconds,"s"]})]}),Me.advertiser_name&&C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(rN,{className:"h-4 w-4"}),C.jsx("span",{className:"text-xs",children:Me.advertiser_name})]}),vt.length>0&&C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(R_,{className:"h-4 w-4"}),C.jsxs("span",{className:"text-xs",children:[vt.length," schedule(s)"]})]}),Kt&&C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(_q,{className:"h-4 w-4"}),C.jsxs("span",{className:"text-xs",children:["Priority: ",Kt.priority]})]})]}),ie===Me.id?C.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 space-y-2",children:[C.jsx("p",{className:"text-sm text-red-700",children:"Delete this ad and all its schedules?"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx(Un,{variant:"destructive",size:"sm",onClick:()=>Et.mutate(Me.id),disabled:Et.isPending,children:Et.isPending?"Deleting...":"Yes, Delete"}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>oe(null),children:"Cancel"})]})]}):C.jsxs("div",{className:"flex gap-2 pt-2",children:[C.jsxs(Un,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>Fe(Me.id),children:[C.jsx(R_,{className:"h-4 w-4 mr-1"}),"Schedule"]}),C.jsx(Un,{variant:"outline",size:"sm",onClick:()=>ze(Me),children:C.jsx(_w,{className:"h-4 w-4"})}),C.jsx(Un,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>oe(Me.id),children:C.jsx(U_,{className:"h-4 w-4"})})]})]})]})},Me.id)})}),_e?.length===0&&C.jsx(li,{className:"p-12",children:C.jsxs("div",{className:"text-center",children:[C.jsx(cx,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),C.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Advertisements"}),C.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by adding your first advertisement."}),C.jsxs(Un,{onClick:Ke,children:[C.jsx(ed,{className:"h-4 w-4 mr-2"}),"Add Advertisement"]})]})}),C.jsx(Boe,{isOpen:d,onClose:()=>{y(!1),E(null)},onSubmit:kt,ad:w,isLoading:$e.isPending||st.isPending}),C.jsx(Uoe,{isOpen:s,onClose:()=>{O(!1),j(null),Y(void 0)},onSubmit:fn,ads:_e||[],schedule:z,preselectedAdId:H,isLoading:Ut.isPending||$t.isPending})]})},Hoe=fg({title:ks().min(1,"Title is required"),message:ks().min(1,"Message is required"),message_ur:ks().optional(),severity:Gx(["info","warning","emergency"]),route_ids:cC(ks()),start_time:ks().min(1,"Start time is required"),end_time:ks().min(1,"End time is required")}).refine(t=>new Date(t.end_time)>new Date(t.start_time),{message:"End time must be after start time",path:["end_time"]}),qoe=[{value:"info",label:"Info",icon:K1,color:"bg-blue-100 text-blue-700"},{value:"warning",label:"Warning",icon:xf,color:"bg-yellow-100 text-yellow-700"},{value:"emergency",label:"Emergency",icon:lx,color:"bg-red-100 text-red-700"}],Zoe=({isOpen:t,onClose:i,onSubmit:c,announcement:d,isLoading:y})=>{const w=!!d,[E,s]=Z.useState([]),{data:O}=$o({queryKey:["routes"],queryFn:()=>Xu.getRoutes()}),{register:z,handleSubmit:j,reset:H,setValue:Y,watch:ie,formState:{errors:oe}}=ug({resolver:hg(Hoe),defaultValues:{title:"",message:"",message_ur:"",severity:"info",route_ids:[],start_time:"",end_time:""}}),ee=ie("severity"),le=xe=>xe.toISOString().slice(0,16);Z.useEffect(()=>{if(t)if(d)s(d.route_ids?.map(xe=>xe.toString())||[]),H({title:d.title,message:d.message,message_ur:d.message_ur||"",severity:d.severity,route_ids:d.route_ids?.map(xe=>xe.toString())||[],start_time:le(new Date(d.start_time)),end_time:le(new Date(d.end_time))});else{const xe=new Date,Ze=new Date(xe.getTime()+1440*60*1e3);s([]),H({title:"",message:"",message_ur:"",severity:"info",route_ids:[],start_time:le(xe),end_time:le(Ze)})}},[t,d,H]),Z.useEffect(()=>{Y("route_ids",E)},[E,Y]);const ge=xe=>{s(Ze=>Ze.includes(xe)?Ze.filter(Le=>Le!==xe):[...Ze,xe])},pe=()=>{O&&s(O.map(xe=>String(xe.id)))},_e=()=>{s([])},Re=xe=>{const Ze={title:xe.title,message:xe.message,message_ur:xe.message_ur,severity:xe.severity,route_ids:xe.route_ids.map(Le=>parseInt(Le,10)),start_time:new Date(xe.start_time).toISOString(),end_time:new Date(xe.end_time).toISOString()};c(Ze)};return C.jsx(Tf,{open:t,onOpenChange:xe=>!xe&&i(),children:C.jsxs(ch,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[C.jsx(uh,{children:C.jsxs(dh,{className:"flex items-center gap-2",children:[C.jsx(lN,{className:"h-5 w-5"}),w?"Edit Announcement":"Create Announcement"]})}),C.jsxs("form",{onSubmit:j(Re),className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"title",children:"Title *"}),C.jsx(br,{id:"title",placeholder:"e.g., Service Disruption on Route 5",...z("title")}),oe.title&&C.jsx("p",{className:"text-sm text-red-500",children:oe.title.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"message",children:"Message (English) *"}),C.jsx("textarea",{id:"message",placeholder:"Enter the announcement message...",className:"w-full min-h-[80px] px-3 py-2 border rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-ring",...z("message")}),oe.message&&C.jsx("p",{className:"text-sm text-red-500",children:oe.message.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"message_ur",children:"Message (Urdu) - Optional"}),C.jsx("textarea",{id:"message_ur",placeholder:"    ...",className:"w-full min-h-[60px] px-3 py-2 border rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-ring text-right",dir:"rtl",...z("message_ur")})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{children:"Severity *"}),C.jsx("div",{className:"grid grid-cols-3 gap-2",children:qoe.map(xe=>{const Ze=xe.icon,Le=ee===xe.value;return C.jsxs("button",{type:"button",onClick:()=>Y("severity",xe.value),className:`flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-all ${Le?`${xe.color} border-current`:"border-gray-200 hover:border-gray-300"}`,children:[C.jsx(Ze,{className:"h-4 w-4"}),C.jsx("span",{className:"text-sm font-medium",children:xe.label})]},xe.value)})})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx(Zi,{children:"Target Routes"}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx("button",{type:"button",onClick:pe,className:"text-xs text-blue-600 hover:underline",children:"Select All"}),C.jsx("span",{className:"text-gray-300",children:"|"}),C.jsx("button",{type:"button",onClick:_e,className:"text-xs text-gray-500 hover:underline",children:"Clear"})]})]}),C.jsx("div",{className:"border rounded-lg max-h-40 overflow-y-auto",children:O?.map(xe=>{const Ze=E.includes(String(xe.id));return C.jsxs("div",{onClick:()=>ge(String(xe.id)),className:`flex items-center gap-3 p-2 cursor-pointer hover:bg-gray-50 border-b last:border-b-0 ${Ze?"bg-blue-50":""}`,children:[C.jsx("div",{className:`h-5 w-5 rounded border-2 flex items-center justify-center ${Ze?"bg-blue-600 border-blue-600":"border-gray-300"}`,children:Ze&&C.jsx(pA,{className:"h-3 w-3 text-white"})}),C.jsx("div",{className:"h-4 w-4 rounded-full",style:{backgroundColor:xe.color||"#6B7280"}}),C.jsx("span",{className:"flex-1 text-sm",children:xe.name}),C.jsx("span",{className:"text-xs text-muted-foreground",children:xe.code})]},xe.id)})}),C.jsx("p",{className:"text-xs text-muted-foreground",children:E.length===0?"No routes selected - announcement will show on all routes":`${E.length} route${E.length>1?"s":""} selected`})]}),C.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"start_time",children:"Start Time *"}),C.jsx(br,{id:"start_time",type:"datetime-local",...z("start_time")}),oe.start_time&&C.jsx("p",{className:"text-sm text-red-500",children:oe.start_time.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"end_time",children:"End Time *"}),C.jsx(br,{id:"end_time",type:"datetime-local",...z("end_time")}),oe.end_time&&C.jsx("p",{className:"text-sm text-red-500",children:oe.end_time.message})]})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),C.jsx(Un,{type:"submit",disabled:y,children:y?"Saving...":w?"Update Announcement":"Create Announcement"})]})]})]})})},Woe=()=>{const{t}=Lc(),i=nd(),{toast:c}=Y_(),[d,y]=Z.useState(!1),[w,E]=Z.useState(null),[s,O]=Z.useState(null),[z,j]=Z.useState(""),{data:H,isLoading:Y}=$o({queryKey:["announcements"],queryFn:()=>T1.getAnnouncements()}),{data:ie}=$o({queryKey:["routes"],queryFn:()=>Xu.getRoutes()}),oe=Z.useMemo(()=>{if(!H)return[];if(!z.trim())return H;const tt=z.toLowerCase();return H.filter(ut=>ut.title.toLowerCase().includes(tt)||ut.message.toLowerCase().includes(tt)||ut.severity.toLowerCase().includes(tt))},[H,z]),ee=Ns({mutationFn:tt=>T1.createAnnouncement(tt),onSuccess:()=>{i.invalidateQueries({queryKey:["announcements"]}),y(!1),c({title:"Announcement Created",description:"The announcement has been created successfully."})},onError:()=>{c({title:"Error",description:"Failed to create announcement.",variant:"destructive"})}}),le=Ns({mutationFn:({id:tt,data:ut})=>T1.updateAnnouncement(tt,ut),onSuccess:()=>{i.invalidateQueries({queryKey:["announcements"]}),y(!1),E(null),c({title:"Announcement Updated",description:"The announcement has been updated successfully."})},onError:()=>{c({title:"Error",description:"Failed to update announcement.",variant:"destructive"})}}),ge=Ns({mutationFn:tt=>T1.deleteAnnouncement(tt),onSuccess:()=>{i.invalidateQueries({queryKey:["announcements"]}),O(null),c({title:"Announcement Deleted",description:"The announcement has been removed."})},onError:()=>{c({title:"Error",description:"Failed to delete announcement.",variant:"destructive"})}}),pe=()=>{E(null),y(!0)},_e=tt=>{E(tt),y(!0)},Re=tt=>{s===tt?ge.mutate(tt):(O(tt),setTimeout(()=>O(null),3e3))},xe=tt=>{w?le.mutate({id:w.id,data:tt}):ee.mutate(tt)},Ze=tt=>{switch(tt){case"emergency":return"bg-red-100 text-red-700 border-red-300";case"warning":return"bg-orange-100 text-orange-700 border-orange-300";case"info":return"bg-blue-100 text-blue-700 border-blue-300";default:return"bg-gray-100 text-gray-700"}},Le=tt=>{switch(tt){case"emergency":return lx;case"warning":return xf;case"info":return K1;default:return K1}},$e=tt=>!ie||tt.length===0?"All Routes":tt.map(ut=>ie.find(on=>on.id===ut)?.name).filter(Boolean).join(", ")||"All Routes",st=(tt,ut)=>{const on=new Date;return new Date(tt)<=on&&new Date(ut)>=on},Et=H?.filter(tt=>tt.severity==="info").length||0,Ut=H?.filter(tt=>tt.severity==="warning").length||0,$t=H?.filter(tt=>tt.severity==="emergency").length||0;return Y?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("announcements.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage system announcements and alerts"})]})}),C.jsx("div",{className:"grid grid-cols-1 gap-4",children:[...Array(3)].map((tt,ut)=>C.jsxs(li,{className:"animate-pulse",children:[C.jsx(zr,{children:C.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})}),C.jsx(hi,{children:C.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})})]},ut))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("announcements.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage system announcements and alerts"})]}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsxs("div",{className:"relative",children:[C.jsx(J0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),C.jsx(br,{placeholder:"Search announcements...",value:z,onChange:tt=>j(tt.target.value),className:"pl-9 w-64"})]}),C.jsxs(Un,{className:"gap-2",onClick:pe,children:[C.jsx(ed,{className:"h-4 w-4"}),"Add Announcement"]})]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),C.jsx("p",{className:"text-2xl font-bold",children:H?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:C.jsx(lx,{className:"h-6 w-6 text-blue-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Info"}),C.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Et})]}),C.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:C.jsx(K1,{className:"h-6 w-6 text-blue-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Warning"}),C.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Ut})]}),C.jsx("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:C.jsx(xf,{className:"h-6 w-6 text-orange-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Emergency"}),C.jsx("p",{className:"text-2xl font-bold text-red-600",children:$t})]}),C.jsx("div",{className:"h-12 w-12 bg-red-100 rounded-lg flex items-center justify-center",children:C.jsx(lx,{className:"h-6 w-6 text-red-600"})})]})})})]}),C.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[oe?.map((tt,ut)=>{const on=Le(tt.severity),Ke=st(tt.start_time,tt.end_time);return C.jsx(_o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:ut*.05},children:C.jsxs(li,{className:`hover:shadow-lg transition-all border-l-4 ${Ze(tt.severity)}`,children:[C.jsx(zr,{className:"pb-3",children:C.jsxs("div",{className:"flex items-start justify-between",children:[C.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[C.jsx("div",{className:`h-10 w-10 rounded-lg flex items-center justify-center flex-shrink-0 ${Ze(tt.severity)}`,children:C.jsx(on,{className:"h-5 w-5"})}),C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(ys,{className:"text-lg",children:tt.title}),Ke&&C.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full",children:"Active"})]}),C.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:tt.message}),tt.message_ur&&C.jsx("p",{className:"text-sm text-muted-foreground mt-1 font-urdu",dir:"rtl",children:tt.message_ur})]})]}),C.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold uppercase ${Ze(tt.severity)}`,children:tt.severity})]})}),C.jsxs(hi,{className:"space-y-3",children:[C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(R_,{className:"h-4 w-4"}),C.jsxs("div",{children:[C.jsxs("p",{className:"text-xs",children:["Start: ",new Date(tt.start_time).toLocaleString()]}),C.jsxs("p",{className:"text-xs",children:["End: ",new Date(tt.end_time).toLocaleString()]})]})]}),C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(L_,{className:"h-4 w-4"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-xs font-medium",children:"Routes"}),C.jsx("p",{className:"text-xs",children:$e(tt.route_ids||[])})]})]}),C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(mA,{className:"h-4 w-4"}),C.jsxs("p",{className:"text-xs",children:["Created: ",new Date(tt.created_at).toLocaleDateString()]})]})]}),C.jsxs("div",{className:"flex gap-2 pt-2",children:[C.jsxs(Un,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>_e(tt),children:[C.jsx(_w,{className:"h-3 w-3"}),"Edit"]}),C.jsxs(Un,{variant:"ghost",size:"sm",className:`gap-1 ${s===tt.id?"bg-red-100 text-red-700":"text-red-600 hover:text-red-700"}`,onClick:()=>Re(tt.id),children:[C.jsx(U_,{className:"h-3 w-3"}),s===tt.id?"Confirm Delete?":"Delete"]})]})]})]})},tt.id)}),oe?.length===0&&C.jsx(li,{children:C.jsxs(hi,{className:"py-12 text-center",children:[C.jsx(lx,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),C.jsx("h3",{className:"text-lg font-medium",children:"No Announcements Found"}),C.jsx("p",{className:"text-muted-foreground mt-1",children:z?"Try a different search term":"Create your first announcement to get started"}),!z&&C.jsxs(Un,{className:"mt-4 gap-2",onClick:pe,children:[C.jsx(ed,{className:"h-4 w-4"}),"Add Announcement"]})]})})]}),C.jsx(Zoe,{isOpen:d,onClose:()=>{y(!1),E(null)},onSubmit:xe,announcement:w,isLoading:ee.isPending||le.isPending})]})},Xoe=fg({email:ks().email("Invalid email address"),password:ks().min(6,"Password must be at least 6 characters"),first_name:ks().min(1,"First name is required"),last_name:ks().min(1,"Last name is required"),user_type:Gx(["ADMIN","STAFF"])}),Koe=({isOpen:t,onClose:i,onSubmit:c,isLoading:d})=>{const{register:y,handleSubmit:w,reset:E,setValue:s,watch:O,formState:{errors:z}}=ug({resolver:hg(Xoe),defaultValues:{email:"",password:"",first_name:"",last_name:"",user_type:"STAFF"}}),j=O("user_type");Z.useEffect(()=>{t&&E({email:"",password:"",first_name:"",last_name:"",user_type:"STAFF"})},[t,E]);const H=Y=>{c(Y)};return C.jsx(Tf,{open:t,onOpenChange:Y=>!Y&&i(),children:C.jsxs(ch,{className:"max-w-md",children:[C.jsx(uh,{children:C.jsxs(dh,{className:"flex items-center gap-2",children:[C.jsx(Tq,{className:"h-5 w-5"}),"Add New User"]})}),C.jsxs("form",{onSubmit:w(H),className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"first_name",children:"First Name *"}),C.jsx(br,{id:"first_name",placeholder:"John",...y("first_name")}),z.first_name&&C.jsx("p",{className:"text-sm text-red-500",children:z.first_name.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"last_name",children:"Last Name *"}),C.jsx(br,{id:"last_name",placeholder:"Doe",...y("last_name")}),z.last_name&&C.jsx("p",{className:"text-sm text-red-500",children:z.last_name.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"email",children:"Email *"}),C.jsx(br,{id:"email",type:"email",placeholder:"john.doe@example.com",...y("email")}),z.email&&C.jsx("p",{className:"text-sm text-red-500",children:z.email.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"password",children:"Password *"}),C.jsx(br,{id:"password",type:"password",placeholder:"",...y("password")}),z.password&&C.jsx("p",{className:"text-sm text-red-500",children:z.password.message})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{children:"User Type *"}),C.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.jsxs("button",{type:"button",onClick:()=>s("user_type","STAFF"),className:`flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-all ${j==="STAFF"?"bg-teal-100 text-teal-700 border-teal-500":"border-gray-200 hover:border-gray-300"}`,children:[C.jsx(eE,{className:"h-4 w-4"}),C.jsx("span",{className:"font-medium",children:"Staff"})]}),C.jsxs("button",{type:"button",onClick:()=>s("user_type","ADMIN"),className:`flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-all ${j==="ADMIN"?"bg-purple-100 text-purple-700 border-purple-500":"border-gray-200 hover:border-gray-300"}`,children:[C.jsx(Y1,{className:"h-4 w-4"}),C.jsx("span",{className:"font-medium",children:"Admin"})]})]}),C.jsx("p",{className:"text-xs text-muted-foreground",children:j==="ADMIN"?"Admins can manage users and have full access to all features.":"Staff members can view data but cannot edit or delete."})]}),C.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[C.jsx(Un,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),C.jsx(Un,{type:"submit",disabled:d,children:d?"Creating...":"Create User"})]})]})]})})},Yoe=()=>{const{t}=Lc(),{user:i,isAdmin:c}=Nx(),d=nd(),{toast:y}=Y_(),[w,E]=Z.useState(!1),[s,O]=Z.useState(""),{data:z,isLoading:j,error:H}=$o({queryKey:["users"],queryFn:()=>xD.getUsers(),enabled:c}),Y=Z.useMemo(()=>{if(!z)return[];if(!s.trim())return z;const pe=s.toLowerCase();return z.filter(_e=>_e.email.toLowerCase().includes(pe)||_e.first_name.toLowerCase().includes(pe)||_e.last_name.toLowerCase().includes(pe))},[z,s]),ie=Ns({mutationFn:pe=>xD.registerUser(pe),onSuccess:()=>{d.invalidateQueries({queryKey:["users"]}),E(!1),y({title:"User Created",description:"New user has been registered successfully."})},onError:pe=>{const _e=pe.response?.data?.error||pe.response?.data?.email?.[0]||"Failed to create user.";y({title:"Error",description:_e,variant:"destructive"})}}),oe=()=>{E(!0)},ee=pe=>{ie.mutate(pe)};if(!c)return C.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:C.jsxs(li,{className:"w-full max-w-md",children:[C.jsx(zr,{children:C.jsx(ys,{className:"text-center",children:"Access Denied"})}),C.jsx(hi,{children:C.jsxs("div",{className:"text-center text-muted-foreground",children:[C.jsx(Y1,{className:"h-16 w-16 mx-auto mb-4 text-red-400"}),C.jsx("p",{children:"Only administrators can access user management."})]})})]})});if(H)return C.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:C.jsxs(li,{className:"w-full max-w-md",children:[C.jsx(zr,{children:C.jsx(ys,{className:"text-center text-red-600",children:"Error Loading Users"})}),C.jsx(hi,{children:C.jsx("div",{className:"text-center text-muted-foreground",children:C.jsx("p",{children:"Unable to fetch user list. Please try again later."})})})]})});const le=z?.filter(pe=>pe.user_type==="ADMIN").length||0,ge=z?.filter(pe=>pe.user_type==="STAFF").length||0;return j?C.jsxs("div",{className:"space-y-6",children:[C.jsx("div",{className:"flex justify-between items-center",children:C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("users.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage system users and permissions"})]})}),C.jsx("div",{className:"grid grid-cols-1 gap-4",children:[...Array(4)].map((pe,_e)=>C.jsx(li,{className:"animate-pulse",children:C.jsx(hi,{className:"pt-6",children:C.jsx("div",{className:"h-16 bg-gray-200 rounded"})})},_e))})]}):C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("users.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage system users and permissions"})]}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsxs("div",{className:"relative",children:[C.jsx(J0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),C.jsx(br,{placeholder:"Search users...",value:s,onChange:pe=>O(pe.target.value),className:"pl-9 w-64"})]}),C.jsxs(Un,{className:"gap-2",onClick:oe,children:[C.jsx(ed,{className:"h-4 w-4"}),"Add User"]})]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"}),C.jsx("p",{className:"text-2xl font-bold",children:z?.length||0})]}),C.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:C.jsx(uN,{className:"h-6 w-6 text-blue-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Administrators"}),C.jsx("p",{className:"text-2xl font-bold text-purple-600",children:le})]}),C.jsx("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:C.jsx(Y1,{className:"h-6 w-6 text-purple-600"})})]})})}),C.jsx(li,{children:C.jsx(hi,{className:"pt-6",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"text-sm text-muted-foreground",children:"Staff Members"}),C.jsx("p",{className:"text-2xl font-bold text-teal-600",children:ge})]}),C.jsx("div",{className:"h-12 w-12 bg-teal-100 rounded-lg flex items-center justify-center",children:C.jsx(eE,{className:"h-6 w-6 text-teal-600"})})]})})})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsx(ys,{children:"User List"})}),C.jsx(hi,{children:C.jsxs("div",{className:"space-y-3",children:[Y?.map((pe,_e)=>{const Re=`${pe.first_name} ${pe.last_name}`.trim()||pe.email,xe=pe.first_name&&pe.last_name?`${pe.first_name.charAt(0)}${pe.last_name.charAt(0)}`.toUpperCase():pe.email.charAt(0).toUpperCase();return C.jsxs(_o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:_e*.05},className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-teal-400 to-blue-500 rounded-full flex items-center justify-center text-white font-semibold",children:xe}),C.jsxs("div",{children:[C.jsx("p",{className:"font-medium",children:Re}),C.jsx("p",{className:"text-sm text-muted-foreground",children:pe.email})]})]}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${pe.user_type==="ADMIN"?"bg-purple-100 text-purple-700":"bg-teal-100 text-teal-700"}`,children:pe.user_type==="ADMIN"?C.jsxs("span",{className:"flex items-center gap-1",children:[C.jsx(Y1,{className:"h-3 w-3"}),"Admin"]}):C.jsxs("span",{className:"flex items-center gap-1",children:[C.jsx(eE,{className:"h-3 w-3"}),"Staff"]})}),i&&pe.id===i.id&&C.jsx("span",{className:"text-xs text-muted-foreground px-3 py-1 bg-blue-100 rounded-full",children:"You"})]})]},pe.id)}),Y?.length===0&&C.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s?"No users found matching your search.":"No users found."})]})})]}),C.jsx(Koe,{isOpen:w,onClose:()=>E(!1),onSubmit:ee,isLoading:ie.isPending})]})},Qoe=()=>{const{t,i18n:i}=Lc(),{user:c}=Nx(),d=()=>{const y=i.language==="en"?"ur":"en";i.changeLanguage(y)};return C.jsxs("div",{className:"space-y-6 max-w-4xl",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl font-bold",children:t("settings.title")}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your preferences and system configuration"})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(cN,{className:"h-5 w-5 text-teal-600"}),C.jsx(ys,{children:"Profile Information"})]})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"first_name",children:"First Name"}),C.jsx(br,{id:"first_name",defaultValue:c?.first_name})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"last_name",children:"Last Name"}),C.jsx(br,{id:"last_name",defaultValue:c?.last_name})]})]}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"email",children:"Email"}),C.jsx(br,{id:"email",type:"email",defaultValue:c?.email,disabled:!0,className:"bg-muted"})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"role",children:"Role"}),C.jsx(br,{id:"role",defaultValue:c?.user_type==="ADMIN"?"Administrator":"Staff",disabled:!0,className:"bg-muted"})]})]}),C.jsxs(Un,{className:"gap-2",children:[C.jsx(cq,{className:"h-4 w-4"}),"Save Changes"]})]})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(aN,{className:"h-5 w-5 text-blue-600"}),C.jsx(ys,{children:"Language & Localization"})]})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"font-medium",children:"Interface Language"}),C.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current: ",i.language==="en"?"English":" (Urdu)"]})]}),C.jsxs(Un,{variant:"outline",onClick:d,children:["Switch to ",i.language==="en"?"":"English"]})]}),C.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[C.jsxs("div",{children:[C.jsx("p",{className:"font-medium",children:"Right-to-Left (RTL) Support"}),C.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically enabled for Urdu"})]}),C.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${i.language==="ur"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:i.language==="ur"?"Active":"Inactive"})]})]})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(iN,{className:"h-5 w-5 text-orange-600"}),C.jsx(ys,{children:"Notifications"})]})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{children:[C.jsx("p",{className:"font-medium",children:"Emergency Announcements"}),C.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive alerts for critical system events"})]}),C.jsx(Un,{variant:"outline",children:"Configure"})]}),C.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[C.jsxs("div",{children:[C.jsx("p",{className:"font-medium",children:"System Updates"}),C.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about bus status changes"})]}),C.jsx(Un,{variant:"outline",children:"Configure"})]})]})]}),C.jsxs(li,{children:[C.jsx(zr,{children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(DD,{className:"h-5 w-5 text-purple-600"}),C.jsx(ys,{children:"API Configuration"})]})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"api-url",children:"API Base URL"}),C.jsx(br,{id:"api-url",defaultValue:"http://localhost:8000/api",placeholder:"http://localhost:8000/api"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Backend API endpoint for all data operations"})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx(Zi,{htmlFor:"ws-url",children:"WebSocket URL (Real-time Updates)"}),C.jsx(br,{id:"ws-url",defaultValue:"ws://localhost:8000",placeholder:"ws://localhost:8000/ws"})]}),C.jsxs(Un,{variant:"outline",className:"gap-2",children:[C.jsx(DD,{className:"h-4 w-4"}),"Test Connection"]})]})]}),C.jsxs(li,{className:"border-blue-200 bg-blue-50/50",children:[C.jsx(zr,{children:C.jsx(ys,{className:"text-blue-700",children:"About This Application"})}),C.jsxs(hi,{className:"space-y-2 text-sm text-blue-900",children:[C.jsx("p",{children:C.jsx("strong",{children:"Smart Bus Islamabad Management Dashboard"})}),C.jsx("p",{children:"Full-featured admin dashboard for managing the Smart Bus Islamabad transit system."}),C.jsx("p",{className:"pt-2 border-t border-blue-200",children:"Built with: React 19  TypeScript  Vite  Tailwind CSS  React Query  Framer Motion"})]})]})]})},Joe="pk.eyJ1IjoiYmlsYWxhbGliIiwiYSI6ImNtaWlmMHZiazAzNTkzZHNpYTVzeWpueWoifQ.fnHQ0i_G-NInzirfb9ZX6Q",sx={lat:33.6844,lng:73.0479};function $E(t,i,c,d){const w=(c-t)*Math.PI/180,E=(d-i)*Math.PI/180,s=Math.sin(w/2)*Math.sin(w/2)+Math.cos(t*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(E/2)*Math.sin(E/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}async function eae(t){if(t.length<2)return[];const i=t.map(y=>`${y.longitude},${y.latitude}`).join(";");try{const y=`https://api.mapbox.com/directions/v5/mapbox/driving/${i}?geometries=geojson&overview=full&access_token=${Joe}`,E=await(await fetch(y)).json();if(E.routes&&E.routes[0]&&E.routes[0].geometry){const s=E.routes[0].geometry.coordinates,O=[];let z=0;for(let j=0;j<s.length;j++){const[H,Y]=s[j];if(j>0){const ie=s[j-1];z+=$E(ie[1],ie[0],Y,H)}O.push({lat:Y,lng:H,distanceFromStart:z})}return console.log(`[GPSSimulator] Fetched route with ${O.length} points, total distance: ${Math.round(z)}m`),O}}catch(y){console.error("[GPSSimulator] Failed to fetch route geometry:",y)}console.log("[GPSSimulator] Using fallback linear path between stops");const c=[];let d=0;for(let y=0;y<t.length;y++)y>0&&(d+=$E(t[y-1].latitude,t[y-1].longitude,t[y].latitude,t[y].longitude)),c.push({lat:t[y].latitude,lng:t[y].longitude,distanceFromStart:d});return c}const tae=()=>{const{toast:t}=Y_(),[i,c]=Z.useState(new Map),d=Z.useRef(new Map),y=Z.useRef(new Map),w=Z.useRef(new Set),[E,s]=Z.useState(!1),[O,z]=Z.useState({speedKmh:40,updateIntervalMs:1e3,speedMultiplier:10}),j=Z.useRef(O);Z.useEffect(()=>{d.current=i},[i]),Z.useEffect(()=>{j.current=O},[O]);const{data:H,isLoading:Y,refetch:ie}=$o({queryKey:["buses"],queryFn:()=>Ku.getBuses(),staleTime:0}),{data:oe}=$o({queryKey:["routes"],queryFn:()=>Xu.getRoutes(),staleTime:0}),ee=Ns({mutationFn:({busId:ze,latitude:Fe,longitude:kt,speed:fn,heading:Me})=>Ku.updateLocation(ze,{latitude:Fe,longitude:kt,speed:fn,heading:Me}),onError:ze=>{console.error("[GPSSimulator] Error updating location:",ze)}}),le=Ns({mutationFn:ze=>Ku.startTrip(ze),onError:ze=>{console.error("[GPSSimulator] Error starting trip:",ze)}}),ge=Ns({mutationFn:ze=>Ku.endTrip(ze),onError:ze=>{console.error("[GPSSimulator] Error ending trip:",ze)}}),pe=Z.useCallback((ze,Fe,kt,fn)=>{const Me=(fn-Fe)*Math.PI/180,ct=ze*Math.PI/180,vt=kt*Math.PI/180,Kt=Math.sin(Me)*Math.cos(vt),zn=Math.cos(ct)*Math.sin(vt)-Math.sin(ct)*Math.cos(vt)*Math.cos(Me);return(Math.atan2(Kt,zn)*180/Math.PI+360)%360},[]),_e=Z.useCallback((ze,Fe)=>{if(ze.length===0)return{lat:sx.lat,lng:sx.lng,pathIndex:0};const kt=ze[ze.length-1].distanceFromStart,fn=Math.max(0,Math.min(Fe,kt));for(let ct=0;ct<ze.length-1;ct++){const vt=ze[ct],Kt=ze[ct+1];if(fn>=vt.distanceFromStart&&fn<=Kt.distanceFromStart){const zn=Kt.distanceFromStart-vt.distanceFromStart,Nn=zn>0?(fn-vt.distanceFromStart)/zn:0;return{lat:vt.lat+(Kt.lat-vt.lat)*Nn,lng:vt.lng+(Kt.lng-vt.lng)*Nn,pathIndex:ct}}}const Me=ze[ze.length-1];return{lat:Me.lat,lng:Me.lng,pathIndex:ze.length-1}},[]),Re=Z.useCallback(ze=>{const{pathPoints:Fe,distanceTraveled:kt}=ze;if(!Fe||Fe.length<2)return{latitude:sx.lat,longitude:sx.lng,speed:0,heading:0};const fn=_e(Fe,kt);let Me=0;const ct=fn.pathIndex;if(ct<Fe.length-1){const vt=Fe[ct],Kt=Fe[ct+1];Me=pe(vt.lat,vt.lng,Kt.lat,Kt.lng)}return{latitude:fn.lat,longitude:fn.lng,speed:j.current.speedKmh,heading:Math.round(Me)}},[pe,_e]),xe=Z.useCallback(async(ze,Fe,kt=!0)=>{const fn=y.current.get(ze);fn&&(clearInterval(fn),y.current.delete(ze)),c(Me=>{const ct=new Map(Me);return ct.delete(ze),ct});try{await ge.mutateAsync(ze),console.log(`[GPSSimulator] Trip ended for bus ${ze}`)}catch(Me){console.error(`[GPSSimulator] Failed to end trip for bus ${ze}:`,Me)}kt&&t({title:"Trip Completed",description:`${Fe} has reached the destination`})},[ge,t]),Ze=Z.useCallback(async ze=>{if(w.current.has(ze)){console.log(`[GPSSimulator] Skipping update for bus ${ze} - previous update still pending`);return}const Fe=d.current.get(ze);if(!Fe||!Fe.isSimulating)return;const{pathPoints:kt,totalRouteDistance:fn,busName:Me}=Fe;if(!(!kt||kt.length<2||fn<=0)){w.current.add(ze);try{const ct=j.current.speedKmh*j.current.updateIntervalMs*j.current.speedMultiplier/3600;let{distanceTraveled:vt}=Fe;if(vt+=ct,vt>=fn){vt=fn;const Nn={...Fe,distanceTraveled:vt,isSimulating:!1},Yt=Re(Nn);await ee.mutateAsync({busId:ze,...Yt}),await xe(ze,Me);return}const Kt={...Fe,distanceTraveled:vt};c(Nn=>{const Yt=new Map(Nn);return Yt.set(ze,Kt),Yt});const zn=Re(Kt);await ee.mutateAsync({busId:ze,...zn})}catch(ct){console.error(`Failed to update bus ${ze}:`,ct)}finally{w.current.delete(ze)}}},[Re,xe,ee]),Le=Z.useCallback(async ze=>{console.log("[GPSSimulator] Starting simulation for bus:",ze.id,ze.registration_number);let Fe=ze;try{Fe=await Ku.getBus(ze.id),console.log("[GPSSimulator] Fresh bus data:",Fe)}catch(Yt){console.error("Failed to fetch fresh bus data, using cached:",Yt)}let kt=[],fn="";if(Fe.route?.stops&&Fe.route.stops.length>=2)kt=[...Fe.route.stops].sort((Yt,On)=>Yt.sequence-On.sequence),fn=Fe.route.name,console.log("[GPSSimulator] Using embedded route stops:",kt.length);else if(Fe.route_id&&oe){const Yt=oe.find(On=>On.id===Fe.route_id);Yt?.route_stops&&Yt.route_stops.length>=2&&(kt=Yt.route_stops.filter(On=>On.stop).sort((On,An)=>On.sequence_number-An.sequence_number).map(On=>({sequence:On.sequence_number,stop_id:On.stop_id,stop_name:On.stop?.name||"Unknown",latitude:On.stop?.latitude||0,longitude:On.stop?.longitude||0,distance_from_prev_meters:On.distance_from_prev||0})),fn=Yt.name,console.log("[GPSSimulator] Using stops from routes query:",kt.length))}if(kt.length<2){console.log("[GPSSimulator] No route found, setting static position");const Yt=(Math.random()-.5)*.02,On=(Math.random()-.5)*.02;try{await ee.mutateAsync({busId:Fe.id,latitude:sx.lat+Yt,longitude:sx.lng+On,speed:0,heading:0}),t({title:"Static Position Set",description:`${Fe.registration_number} placed in Islamabad (no route with stops)`})}catch(An){console.error("Failed to set static position:",An)}return}console.log("[GPSSimulator] Fetching road geometry for",kt.length,"stops...");let Me=[],ct=0;try{Me=await eae(kt),Me.length>0&&(ct=Me[Me.length-1].distanceFromStart),console.log("[GPSSimulator] Got",Me.length,"path points, total distance:",ct,"m")}catch(Yt){console.error("[GPSSimulator] Failed to fetch route geometry, falling back to straight lines:",Yt);let On=0;Me=kt.map((An,In)=>(In>0&&(On+=$E(kt[In-1].latitude,kt[In-1].longitude,An.latitude,An.longitude)),{lat:An.latitude,lng:An.longitude,distanceFromStart:On})),ct=On}if(Me.length<2){console.error("[GPSSimulator] Not enough path points");return}const vt={busId:Fe.id,busName:Fe.registration_number,routeName:fn,isSimulating:!0,currentPathIndex:0,distanceTraveled:0,totalRouteDistance:ct,pathPoints:Me,stops:kt};try{await le.mutateAsync(Fe.id),console.log(`[GPSSimulator] Trip started for bus ${Fe.id}`)}catch(Yt){console.error(`[GPSSimulator] Failed to start trip for bus ${Fe.id}:`,Yt),t({title:"Failed to Start Trip",description:`Could not start trip for ${Fe.registration_number}. The bus may already be on a trip.`,variant:"destructive"});return}c(Yt=>{const On=new Map(Yt);return On.set(Fe.id,vt),On});const Kt=y.current.get(Fe.id);Kt&&clearInterval(Kt);const zn=setInterval(()=>{Ze(Fe.id)},O.updateIntervalMs);y.current.set(Fe.id,zn);const Nn=Re(vt);try{await ee.mutateAsync({busId:Fe.id,...Nn})}catch(Yt){console.error("Failed to send initial position:",Yt)}t({title:"Trip Started",description:`${Fe.registration_number} starting from ${kt[0].stop_name} (${kt.length} stops)`})},[Ze,Re,O.updateIntervalMs,oe,le,t,ee]),$e=Z.useCallback(async(ze,Fe)=>{const kt=y.current.get(ze);kt&&(clearInterval(kt),y.current.delete(ze)),c(fn=>{const Me=new Map(fn);return Me.delete(ze),Me});try{await ge.mutateAsync(ze),console.log(`[GPSSimulator] Trip ended for bus ${ze}`)}catch(fn){console.error(`[GPSSimulator] Failed to end trip for bus ${ze}:`,fn)}t({title:"Trip Stopped",description:`${Fe} trip has been stopped`})},[ge,t]),st=Z.useCallback(async()=>{console.log("[GPSSimulator] Refreshing buses..."),await ie(),t({title:"Refreshed",description:"Bus data has been refreshed"})},[ie,t]),Et=Z.useCallback(async()=>{if(!H||H.length===0){t({title:"No Buses",description:"Add some buses first to simulate.",variant:"destructive"});return}const ze=H.filter(Fe=>Fe.status==="active"||Fe.status==="inactive");if(ze.length===0){t({title:"No Simulatable Buses",description:"Add buses with active or inactive status to simulate.",variant:"destructive"});return}s(!0);for(const Fe of ze)i.has(Fe.id)||(await Le(Fe),await new Promise(kt=>setTimeout(kt,100)));t({title:"All Simulations Started",description:`Started simulation for ${ze.length} buses`})},[H,i,Le,t]),Ut=Z.useCallback(()=>{y.current.forEach(ze=>{clearInterval(ze)}),y.current.clear(),c(new Map),s(!1),t({title:"All Simulations Stopped",description:"All bus simulations have been stopped"})},[t]);Z.useEffect(()=>()=>{y.current.forEach(ze=>{clearInterval(ze)})},[]);const $t=Z.useCallback(ze=>{if(ze.route?.stops&&ze.route.stops.length>=2)return!0;if(ze.route_id&&oe){const Fe=oe.find(kt=>kt.id===ze.route_id);if(Fe?.route_stops&&Fe.route_stops.length>=2)return Fe.route_stops.filter(fn=>fn.stop).length>=2}return!1},[oe]),tt=Z.useCallback(ze=>{if(ze.route?.stops&&ze.route.stops.length>=2)return{name:ze.route.name,stopCount:ze.route.stops.length};if(ze.route_id&&oe){const Fe=oe.find(kt=>kt.id===ze.route_id);if(Fe?.route_stops&&Fe.route_stops.length>=2){const kt=Fe.route_stops.filter(fn=>fn.stop);return{name:Fe.name,stopCount:kt.length}}if(Fe)return{name:Fe.name,stopCount:Fe.route_stops?.length||0}}return null},[oe]);if(Y)return C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{children:[C.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[C.jsx(yw,{className:"h-8 w-8 text-amber-500"}),"GPS Simulator"]}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Loading buses..."})]}),C.jsx(li,{className:"animate-pulse",children:C.jsx(hi,{className:"py-12",children:C.jsx("div",{className:"h-64 bg-gray-200 rounded"})})})]});const ut=H?.filter(ze=>ze.status==="active"||ze.status==="inactive")||[],on=ut.filter(ze=>$t(ze)),Ke=ut.filter(ze=>!$t(ze));return C.jsxs("div",{className:"space-y-6",children:[C.jsxs("div",{className:"flex justify-between items-start",children:[C.jsxs("div",{children:[C.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[C.jsx(yw,{className:"h-8 w-8 text-amber-500"}),"GPS Simulator"]}),C.jsx("p",{className:"text-muted-foreground mt-1",children:"Simulate GPS location updates. Buses follow their routes from start to end."})]}),C.jsxs(Un,{variant:"outline",onClick:st,className:"gap-2",children:[C.jsx(oq,{className:"h-4 w-4"}),"Refresh Buses"]})]}),C.jsxs(li,{className:"border-amber-200 bg-amber-50/50",children:[C.jsx(zr,{className:"pb-3",children:C.jsxs(ys,{className:"text-lg flex items-center gap-2",children:[C.jsx(yf,{className:"h-5 w-5 text-amber-600"}),"Global Controls"]})}),C.jsxs(hi,{className:"space-y-4",children:[C.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[C.jsxs("div",{children:[C.jsx(Zi,{className:"text-xs",children:"Speed (km/h)"}),C.jsx(br,{type:"number",value:O.speedKmh,onChange:ze=>z(Fe=>({...Fe,speedKmh:Number(ze.target.value)})),className:"h-9",min:1,max:120})]}),C.jsxs("div",{children:[C.jsx(Zi,{className:"text-xs",children:"Speed Multiplier"}),C.jsx(br,{type:"number",value:O.speedMultiplier,onChange:ze=>z(Fe=>({...Fe,speedMultiplier:Number(ze.target.value)})),className:"h-9",min:1,max:100,step:1}),C.jsxs("span",{className:"text-xs text-muted-foreground",children:[O.speedKmh*O.speedMultiplier," km/h effective"]})]}),C.jsxs("div",{children:[C.jsx(Zi,{className:"text-xs",children:"Update Interval (ms)"}),C.jsx(br,{type:"number",value:O.updateIntervalMs,onChange:ze=>z(Fe=>({...Fe,updateIntervalMs:Number(ze.target.value)})),className:"h-9",min:100,step:100})]}),C.jsx("div",{className:"flex items-end",children:C.jsxs("div",{className:"text-sm",children:[C.jsx("span",{className:"font-bold text-lg",children:ut.length}),C.jsx("span",{className:"text-muted-foreground ml-1",children:"simulatable buses"})]})}),C.jsx("div",{className:"flex items-end gap-2",children:E?C.jsxs(Un,{variant:"destructive",onClick:Ut,className:"gap-2 flex-1",children:[C.jsx(OD,{className:"h-4 w-4"}),"Stop All"]}):C.jsxs(Un,{onClick:Et,disabled:ut.length===0,className:"gap-2 flex-1 bg-amber-500 hover:bg-amber-600",children:[C.jsx(Q2,{className:"h-4 w-4"}),"Start All"]})})]}),C.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-2",children:[C.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border",children:[C.jsx(L_,{className:"h-5 w-5 mx-auto mb-1 text-green-600"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"With Route"}),C.jsx("p",{className:"text-lg font-bold text-green-600",children:on.length})]}),C.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border",children:[C.jsx(xf,{className:"h-5 w-5 mx-auto mb-1 text-orange-500"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"No Route"}),C.jsx("p",{className:"text-lg font-bold text-orange-500",children:Ke.length})]}),C.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border",children:[C.jsx(PD,{className:"h-5 w-5 mx-auto mb-1 text-blue-600"}),C.jsx("p",{className:"text-xs text-muted-foreground",children:"Simulating"}),C.jsx("p",{className:"text-lg font-bold text-blue-600",children:i.size})]})]})]})]}),on.length>0&&C.jsxs("div",{className:"space-y-3",children:[C.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[C.jsx(L_,{className:"h-5 w-5 text-green-600"}),"Buses with Routes",C.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"(will follow route from start to end)"})]}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:on.map(ze=>{const Fe=i.get(ze.id),kt=Fe?.isSimulating||!1,fn=tt(ze);return C.jsxs(li,{className:xs("transition-all",kt&&"border-green-300 bg-green-50/30"),children:[C.jsx(zr,{className:"pb-2",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(fu,{className:"h-5 w-5 text-teal-600"}),C.jsx(ys,{className:"text-base",children:ze.registration_number})]}),kt&&C.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[C.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),"LIVE"]})]})}),C.jsxs(hi,{className:"space-y-3",children:[C.jsxs("div",{className:"text-sm space-y-1",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(L_,{className:"h-4 w-4 text-muted-foreground"}),C.jsx("span",{className:"font-medium",children:fn?.name})]}),C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(Dl,{className:"h-4 w-4"}),C.jsxs("span",{children:[fn?.stopCount||0," stops"]})]}),kt&&Fe&&C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[C.jsx(mA,{className:"h-4 w-4"}),C.jsxs("span",{children:[Fe.stops.length," stops  Simulating"]})]}),C.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[C.jsx(yf,{className:"h-3 w-3"}),C.jsxs("span",{children:[Math.round(Fe.distanceTraveled),"m / ",Math.round(Fe.totalRouteDistance),"m (",Math.round(Fe.distanceTraveled/Fe.totalRouteDistance*100),"%)"]})]})]}),ze.last_location&&C.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[C.jsx(PD,{className:"h-3 w-3"}),C.jsxs("span",{children:["Last: ",ze.last_location.speed," km/h"]})]})]}),kt?C.jsxs(Un,{variant:"outline",size:"sm",className:"w-full gap-2 border-red-200 text-red-600 hover:bg-red-50",onClick:()=>$e(ze.id,ze.registration_number),children:[C.jsx(OD,{className:"h-4 w-4"}),"Stop"]}):C.jsxs(Un,{size:"sm",className:"w-full gap-2 bg-green-600 hover:bg-green-700",onClick:()=>Le(ze),children:[C.jsx(Q2,{className:"h-4 w-4"}),"Start Simulation"]})]})]},ze.id)})})]}),Ke.length>0&&C.jsxs("div",{className:"space-y-3",children:[C.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[C.jsx(xf,{className:"h-5 w-5 text-orange-500"}),"Buses without Routes",C.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"(assign a route with stops first)"})]}),C.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ke.map(ze=>{const Fe=tt(ze);return C.jsxs(li,{className:"border-orange-200 bg-orange-50/30",children:[C.jsx(zr,{className:"pb-2",children:C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(fu,{className:"h-5 w-5 text-orange-600"}),C.jsx(ys,{className:"text-base",children:ze.registration_number})]})}),C.jsxs(hi,{className:"space-y-3",children:[C.jsx("div",{className:"text-sm text-orange-600 bg-orange-100 p-2 rounded",children:Fe?C.jsxs(C.Fragment,{children:['Route "',Fe.name,'" has no stops. Add stops to the route first.']}):C.jsx(C.Fragment,{children:"No route assigned. Assign a route with stops in the Buses page."})}),ze.last_location&&C.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last seen: ",new Date(ze.last_location.timestamp).toLocaleString()]}),C.jsxs(Un,{variant:"outline",size:"sm",className:"w-full gap-2",onClick:()=>Le(ze),children:[C.jsx(Dl,{className:"h-4 w-4"}),"Set Static Position"]})]})]},ze.id)})})]}),ut.length===0&&C.jsx(li,{children:C.jsx(hi,{className:"py-12",children:C.jsxs("div",{className:"text-center text-muted-foreground",children:[C.jsx(fu,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),C.jsx("p",{className:"text-lg font-medium",children:"No Simulatable Buses"}),C.jsx("p",{className:"text-sm mt-2",children:'Add buses with "active" or "inactive" status to simulate GPS. Buses in "maintenance" cannot be simulated.'})]})})})]})},nae=()=>{const{t}=Lc(),{user:i,logout:c}=Nx(),{toggleSidebar:d,language:y,setLanguage:w}=Yw(),E=()=>{w(y==="en"?"ur":"en")};return C.jsx("nav",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-border z-50 px-4",children:C.jsxs("div",{className:"flex items-center justify-between h-full",children:[C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsx(Un,{variant:"ghost",size:"icon",onClick:d,children:C.jsx(HH,{className:"h-5 w-5"})}),C.jsxs(eA,{to:"/dashboard",className:"flex items-center gap-2",children:[C.jsx("div",{className:"h-8 w-8 bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg flex items-center justify-center",children:C.jsx("span",{className:"text-white font-bold text-sm",children:"SB"})}),C.jsxs("div",{className:"flex flex-col",children:[C.jsx("span",{className:"font-bold text-lg leading-none",children:t("app.title")}),C.jsx("span",{className:"text-xs text-muted-foreground",children:t("app.subtitle")})]})]})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx(Un,{variant:"ghost",size:"icon",onClick:E,children:C.jsx(aN,{className:"h-5 w-5"})}),C.jsx(Un,{variant:"ghost",size:"icon",children:C.jsx(iN,{className:"h-5 w-5"})}),C.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-accent",children:[C.jsx(cN,{className:"h-5 w-5"}),C.jsxs("div",{className:"flex flex-col",children:[C.jsxs("span",{className:"text-sm font-medium",children:[i?.first_name," ",i?.last_name]}),C.jsx("span",{className:"text-xs text-muted-foreground",children:i?.user_type==="ADMIN"?"Admin":"Staff"})]})]}),C.jsx(Un,{variant:"ghost",size:"icon",onClick:c,children:C.jsx(jH,{className:"h-5 w-5"})})]})]})})},iae=()=>{const{t}=Lc(),{isAdmin:i}=Nx(),c=Yw(y=>y.sidebarOpen),d=[{to:"/dashboard",icon:LH,label:t("nav.dashboard")},{to:"/buses",icon:fu,label:t("nav.buses")},{to:"/routes",icon:L_,label:t("nav.routes")},{to:"/stops",icon:Dl,label:t("nav.stops")},{to:"/display-units",icon:M_,label:t("nav.displays")},{to:"/ads",icon:cx,label:t("nav.ads")},{to:"/announcements",icon:lN,label:t("nav.announcements")},{to:"/gps-simulator",icon:yw,label:"GPS Simulator"},...i?[{to:"/users",icon:uN,label:t("nav.users")}]:[],{to:"/settings",icon:J2,label:t("nav.settings")}];return c?C.jsx("aside",{className:"fixed left-0 top-16 bottom-0 w-64 bg-white border-r border-border z-40 overflow-y-auto",children:C.jsx("nav",{className:"p-4 space-y-1",children:d.map(y=>{const w=y.icon;return C.jsxs(jz,{to:y.to,className:({isActive:E})=>xs("flex items-center gap-3 px-4 py-3 rounded-xl transition-all","hover:bg-accent hover:scale-[1.02] active:scale-[0.98]",E?"bg-primary text-primary-foreground":"text-foreground"),children:[C.jsx(w,{className:"h-5 w-5"}),C.jsx("span",{className:"font-medium",children:y.label})]},y.to)})})}):null},rae=()=>{const t=Yw(i=>i.sidebarOpen);return C.jsxs("div",{className:"min-h-screen bg-background",children:[C.jsx(nae,{}),C.jsxs("div",{className:"flex pt-16",children:[C.jsx(iae,{}),C.jsx("main",{className:xs("flex-1 transition-all duration-300 ease-in-out p-6",t?"ml-64":"ml-0"),children:C.jsx(BV,{})})]})]})},Sz=({children:t,requireAdmin:i=!1})=>{const{isAuthenticated:c,isLoading:d,isAdmin:y}=Nx();return d?C.jsx("div",{className:"flex items-center justify-center min-h-screen",children:C.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):c?i&&!y?C.jsx(E0,{to:"/dashboard",replace:!0}):C.jsx(C.Fragment,{children:t}):C.jsx(E0,{to:"/login",replace:!0})};function sae(){const{i18n:t}=Lc(),i=Yw(c=>c.language);return Z.useEffect(()=>{t.changeLanguage(i),document.documentElement.dir=i==="ur"?"rtl":"ltr",document.documentElement.lang=i},[i,t]),C.jsxs(eG,{children:[C.jsxs(UV,{children:[C.jsx(Aa,{path:"/login",element:C.jsx(q9,{})}),C.jsx(Aa,{path:"/smd-simulator",element:C.jsx(wz,{})}),C.jsx(Aa,{path:"/smd-simulator/:displayId",element:C.jsx(wz,{})}),C.jsxs(Aa,{element:C.jsx(Sz,{children:C.jsx(rae,{})}),children:[C.jsx(Aa,{path:"/",element:C.jsx(E0,{to:"/dashboard",replace:!0})}),C.jsx(Aa,{path:"/dashboard",element:C.jsx(Q9,{})}),C.jsx(Aa,{path:"/buses",element:C.jsx(zre,{})}),C.jsx(Aa,{path:"/buses/:id",element:C.jsx(Lre,{})}),C.jsx(Aa,{path:"/routes",element:C.jsx(kre,{})}),C.jsx(Aa,{path:"/routes/:id",element:C.jsx(Aoe,{})}),C.jsx(Aa,{path:"/stops",element:C.jsx(Moe,{})}),C.jsx(Aa,{path:"/display-units",element:C.jsx(Poe,{})}),C.jsx(Aa,{path:"/ads",element:C.jsx(Goe,{})}),C.jsx(Aa,{path:"/announcements",element:C.jsx(Woe,{})}),C.jsx(Aa,{path:"/gps-simulator",element:C.jsx(tae,{})}),C.jsx(Aa,{path:"/users",element:C.jsx(Sz,{requireAdmin:!0,children:C.jsx(Yoe,{})})}),C.jsx(Aa,{path:"/settings",element:C.jsx(Qoe,{})})]}),C.jsx(Aa,{path:"*",element:C.jsx(E0,{to:"/dashboard",replace:!0})})]}),C.jsx(P9,{})]})}W5.createRoot(document.getElementById("root")).render(C.jsx(Z.StrictMode,{children:C.jsx(dU,{children:C.jsx(r6,{children:C.jsx(sae,{})})})}));
